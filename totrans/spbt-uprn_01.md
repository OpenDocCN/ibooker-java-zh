# 第一章. 简介 Spring Boot

本章探讨了 Spring Boot 的三个核心特性以及它们如何作为开发者的增强因子。

# Spring Boot 的三大核心特性

Spring Boot 的三个核心特性是简化的依赖管理、简化的部署和自动配置，这些是构建一切的基础。

## 简化依赖管理的起步

Spring Boot 的一个天才之处在于它使依赖管理变得…可管理。

如果您已经开发了任何重要的软件一段时间，您几乎肯定不得不应对围绕依赖管理的几个头痛。您在应用程序中提供的任何功能通常都需要一些“前线”依赖项。例如，如果您想提供一个 RESTful web API，您必须提供一种方法来通过 HTTP 公开端点，监听请求，将这些端点与处理这些请求的方法/函数绑定，然后构建并返回适当的响应。

几乎每个主要依赖项都包含许多其他次要依赖项，以实现其承诺的功能。继续我们提供 RESTful API 的示例，我们可能期望看到一组依赖项（在某种合理但有争议的结构中），其中包括提供特定格式（例如 JSON、XML、HTML）响应的代码；编组/解编组对象以请求的格式；监听和处理请求并返回相同响应的代码；解码用于创建多功能 API 的复杂 URI 的代码；支持各种传输协议的代码；以及更多。

即使对于这个相当简单的示例，我们在我们的构建文件中已经可能需要大量依赖项。而且在此时，我们甚至还没有考虑我们可能希望在我们的应用程序中包含的功能。

现在，让我们谈谈版本。谈谈每一个依赖项的版本。

将库一起使用需要一定的严谨性，因为特定依赖项的一个版本可能仅已与另一个特定依赖项的特定版本一起测试（或者甚至能够正确工作）。当这些问题不可避免地出现时，它导致了我所说的“依赖性打地鼠”。

就像其同名的嘉年华游戏一样，“依赖性打地鼠”可能是一种令人沮丧的经历。与其同名不同的是，在追逐和解决由于依赖关系之间的不匹配而引起的错误时，没有奖品，只有难以捉摸的结论性诊断和*浪费的小时*。

Spring Boot 及其起步项目登场。Spring Boot 起步项目是围绕一个被证明的前提建立的材料清单（BOM），即您几乎每次提供特定功能时都以几乎相同的方式提供它。

在上一个例子中，每次我们构建一个 API 时，我们都会暴露端点，监听请求，处理请求，对象之间的转换，以及使用一个特定协议通过电线发送和接收数据等等。这种设计/开发/使用模式变化不大；它是整个行业广泛采用的方法，几乎没有变化。像其他类似的模式一样，它方便地被 Spring Boot starter 捕获。

添加一个单一的 starter，例如`spring-boot-starter-web`，提供所有相关功能在*单一应用程序依赖项*中。由该单一 starter 包含的所有依赖项也是版本同步的，这意味着它们已经成功地一起测试过，包含的库 A 版本与包含的库 B、C、D 等版本一起正常运行。这极大地简化了您的依赖列表和您的生活，几乎消除了您需要提供应用程序关键功能时可能遇到的难以识别的版本冲突的可能性。

在那些罕见的情况下，当您必须整合由包含的依赖项的不同版本提供的功能时，您可以简单地覆盖已测试的版本。

###### 注意

如果必须覆盖依赖项的默认版本，请这样做...但您应该增加测试的级别，以减少因此引入的风险。

如果对于您的应用程序来说，某些依赖项是不必要的，您也可以将它们排除在外，但同样要注意谨慎。

总的来说，Spring Boot 的 starter 概念大大简化了您的依赖关系，并减少了向应用程序添加整套功能所需的工作。它还显著减少了您测试、维护和升级它们所需的开销。

## 可执行的 JAR 文件，简化部署过程。

很久以前，在应用服务器漫游地球的日子里，Java 应用程序的部署是一件复杂的事情。

为了提供一个工作的应用程序，比如具有数据库访问权限的微服务今天和几乎所有的单体应用过去和现在，你需要做以下几点：

1.  安装并配置应用服务器。

1.  安装数据库驱动程序。

1.  创建数据库连接。

1.  创建连接池。

1.  构建并测试你的应用程序。

1.  将你的应用程序及其（通常很多的）依赖项部署到应用服务器。

注意，此列表假定您已由管理员配置了机器/虚拟机，并且在某些时候您独立于此过程创建了数据库。

Spring Boot 彻底改变了这种繁琐的部署过程，并将以前的步骤合并为一个，或者也许是两个，如果将一个单一文件复制或`cf push`到目标视为一个实际的*步骤*的话。

Spring Boot 并不是所谓的超级 JAR 的起源，但它革新了它。与从应用程序 JAR 文件和所有依赖的 JAR 文件中分离出每个文件，然后将它们组合成单个目标 JAR 文件（有时称为*阴影*）不同，Spring Boot 的设计者们从一个真正新颖的角度来看待问题：如果我们可以*嵌套 JAR 文件*，保留它们的预期和交付格式呢？

将 JAR 文件进行嵌套而不是对它们进行阴影处理可以减轻*许多*潜在问题，因为在依赖 JAR A 和依赖 JAR B 使用不同版本的 C 时，不会遇到潜在的版本冲突问题；它还消除了由于重新打包软件并与其他使用不同许可证的软件组合而导致的潜在法律问题。保持所有依赖的 JAR 文件以其原始格式干净地避免了这些及其他问题。

如果有需要，提取 Spring Boot 可执行 JAR 文件的内容也是非常简单的。在某些情况下这样做有一些很好的理由，我在本书中也会讨论这些理由。现在，只需知道 Spring Boot 可执行 JAR 文件已经为你准备好了。

那个单一的 Spring Boot JAR 文件及其所有依赖使得部署变得轻而易举。与收集和验证所有依赖项是否已部署相比，Spring Boot 插件确保它们全部被压缩到输出的 JAR 文件中。一旦你有了这个，应用程序可以在任何有 Java 虚拟机（JVM）的地方运行，只需执行类似`java -jar <SpringBootAppName.jar>`的命令。

还有更多。

通过在构建文件中设置一个属性，Spring Boot 构建插件还可以使单个 JAR 完全（自行）可执行。假设 JVM 存在，而不是必须键入或脚本化整个麻烦的`java -jar <SpringBootAppName.jar>`命令行，你只需简单地键入`<SpringBootAppName.jar>`（当然，替换为你的文件名），一切都搞定。没有比这更简单的了。

## 自动配置

对于那些对 Spring Boot 还不熟悉的人来说，自动配置有时被称为“魔术”，可能是 Spring Boot 为开发者带来的最大“乘数效应”。我经常把它称为开发者的超能力：Spring Boot 通过为广泛使用和重复使用的案例带来观点，*极大地提升了生产力*。

软件中的观点？这有什么帮助？!?

如果你做开发时间很长，无疑会注意到某些模式经常重复出现。当然，不是完全一样，但高达 80-90%的时间，事情都在某种设计、开发或活动范围内。

我前面提到过软件中的这种重复，这就是使得 Spring Boot 的启动器惊人一致和有用的原因。这种重复也意味着，当涉及到必须编写的代码以完成特定任务时，这些活动非常适合优化。

借用 Spring Data 的例子，这是一个与 Spring Boot 相关且启用的项目，我们知道每次访问数据库时，我们需要打开某种类型的连接到该数据库。我们也知道当我们的应用程序完成其任务时，必须关闭该连接以避免潜在问题。在此期间，我们可能会使用查询（简单和复杂、只读和写入使能）向数据库发出许多请求，并且这些查询将需要一些努力来正确创建。

现在想象一下我们能够简化所有这些。在我们指定数据库时自动打开连接。在应用程序终止时自动关闭连接。遵循简单而预期的约定，以最小的努力从开发者那里*自动*创建查询。甚至通过简单约定再次轻松定制那些最小代码，创建可靠一致且高效的复杂定制查询。

这种编码方式有时被称为*约定优于配置*，如果您对某种约定不熟悉，乍一看可能会有些不适（无论是打算的还是其他）。但如果您以前实现过类似功能，写过数百行重复、令人昏昏欲睡的设置/拆卸/配置代码以完成甚至最简单的任务，那么这就像一股清新的空气。Spring Boot（以及大多数 Spring 项目）遵循*约定优于配置*的口号，确保如果您遵循简单、成熟和详细记录的约定来做某事，您需要编写的配置代码将是最小甚至完全没有。

自动配置给你超能力的另一种方式是 Spring 团队对“开发者优先”环境配置的激烈关注。作为开发者，当我们能够专注于手头的任务而不是无数的设置琐事时，我们的生产力最高。Spring Boot 是如何实现这一点的呢？

让我们借用另一个与 Spring Boot 相关的项目 Spring Cloud Stream 的例子：当连接到消息平台如 RabbitMQ 或 Apache Kafka 时，开发者通常必须指定某些设置以连接和使用该平台——主机名、端口、凭据等。专注于开发体验意味着在未指定任何设置时提供默认值，有利于开发者在本地工作：localhost、默认端口等。这在*观点*上是有意义的，因为在开发环境中几乎 100%一致，但在生产环境中则不然。在生产环境中，由于平台和托管环境差异很大，您需要提供特定的值。

使用这些默认设置的共享开发项目还可以消除开发环境设置所需的大量时间。这对你有利，也对你的团队有利。

在一些情况下，您的具体用例可能并不完全符合典型用例的 80–90%，而是属于另外的 10–20%有效用例。在这些情况下，可以有选择地覆盖自动配置，甚至完全禁用它，但当然，您会失去所有的超能力。覆盖某些默认设置通常是通过设置一个或多个属性为您希望的值，或者提供一个或多个 Bean 来完成 Spring Boot 通常会为您自动配置的某些任务。换句话说，当您必须这样做时，通常这是一个非常简单的事情。总之，自动配置是一个强大的工具，默默无闻地为您工作，使您的生活更轻松，您的生产力更高。

# 摘要

Spring Boot 的三个核心特性是简化的依赖管理、简化的部署以及自动配置。这三者都是可定制的，但您很少需要这样做。这三者共同努力，让您成为一个更好、更高效的开发者。Spring Boot 给您带来飞跃的感觉！

在下一章中，我们将探讨一些在创建 Spring Boot 应用程序时可供选择的优秀选项。选择多多益善！
