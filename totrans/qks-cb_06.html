<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Packaging Quarkus Applications"><div class="chapter" id="packaging_quark_applications_chapter">
<h1><span class="label">Chapter 6. </span>Packaging Quarkus Applications</h1>


<p><a data-type="indexterm" data-primary="packaging" id="pac_ch"/>In this chapter, you will learn about packaging a Quarkus service into a JVM or a native format so that it can be distributed and deployed.
Today, when containers are becoming the standard way to distribute applications, you need to know how to 
<span class="keep-together">containerize</span> them.</p>

<p>We’ll cover the following topics:</p>

<ul>
<li>
<p>How to package a Quarkus application for running in the JVM</p>
</li>
<li>
<p>How to package a Quarkus application in a native executable</p>
</li>
<li>
<p>How to containerize a Quarkus application</p>
</li>
</ul>






<section data-type="sect1" data-pdf-bookmark="6.1 Running in Command Mode"><div class="sect1" id="idm45128520055128">
<h1>6.1 Running in Command Mode</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128520054248">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="command mode, running in" id="idm45128520053240"/><a data-type="indexterm" data-primary="packaging" data-secondary="running in command mode" id="idm45128520052632"/><a data-type="indexterm" data-primary="running" data-secondary="in command mode" id="idm45128520051784"/>You want to create a CLI application.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128520050552">
<h2>Solution</h2>

<p>With Quarkus, you can also write applications that run and then optionally exit.</p>

<p>To enable command mode in Quarkus, you need to create a class that implements the <code>io.quarkus.runtime.QuarkusApplication</code> interface:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.runtime.Quarkus</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.runtime.QuarkusApplication</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingMain</code><code> </code><code class="kd">implements</code><code> </code><code class="n">QuarkusApplication</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_packaging_quarkus_applications_CO1-1" href="#callout_packaging_quarkus_applications_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="nf">run</code><code class="o">(</code><code class="n">String</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">Exception</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_packaging_quarkus_applications_CO1-2" href="#callout_packaging_quarkus_applications_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Hello World"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">Quarkus</code><code class="o">.</code><code class="na">waitForExit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_packaging_quarkus_applications_CO1-3" href="#callout_packaging_quarkus_applications_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="mi">0</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_packaging_quarkus_applications_CO1-1" href="#co_packaging_quarkus_applications_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Interface to set Quarkus in command mode</p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO1-2" href="#co_packaging_quarkus_applications_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The method executed when the <code>main</code> is called</p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO1-3" href="#co_packaging_quarkus_applications_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Do not exit but wait until Quarkus process is stopped</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="main method" id="idm45128519969304"/>Then you can implement the well-known Java <code>main</code> method.
One of the requirements is that the class with the <code>main</code> method must be annotated with the <code>@io.quarkus.runtime.annotations.QuarkusMain</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.runtime.Quarkus</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.runtime.annotations.QuarkusMain</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@QuarkusMain</code><code> </code><a class="co" id="co_packaging_quarkus_applications_CO2-1" href="#callout_packaging_quarkus_applications_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">JavaMain</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">Quarkus</code><code class="o">.</code><code class="na">run</code><code class="o">(</code><code class="n">GreetingMain</code><code class="o">.</code><code class="na">class</code><code class="o">,</code><code> </code><code class="n">args</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_packaging_quarkus_applications_CO2-2" href="#callout_packaging_quarkus_applications_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_packaging_quarkus_applications_CO2-1" href="#co_packaging_quarkus_applications_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets the class as <code>main</code></p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO2-2" href="#co_packaging_quarkus_applications_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Starts the process</p></dd>
</dl>

<p>If you want to access the command arguments, you can inject them using the <code>@io.quarkus.runtime.annotations.CommandLineArguments</code> annotation:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.GET</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Path</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Produces</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.runtime.annotations.CommandLineArguments</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/hello"</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingResource</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="nd">@CommandLineArguments</code><code> </code><a class="co" id="co_packaging_quarkus_applications_CO3-1" href="#callout_packaging_quarkus_applications_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="nd">@GET</code><code>
</code><code>    </code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">hello</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_packaging_quarkus_applications_CO3-1" href="#co_packaging_quarkus_applications_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Injects the command-line arguments</p></dd>
</dl>

<p>Finally, you can build the project and run it:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean package -DskipTests</code>

<code class="go">java -jar target/greeting-started-cli-1.0-SNAPSHOT-runner.jar Aloha</code>

<code class="go">curl localhost:8080/hello</code>
<code class="go">Aloha</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128519728728">
<h2>Discussion</h2>

<p>Two different methods can be used to implement applications that exit. We explained the first method in the previous section; the second method is by annotating the class that is implementing the <code>io.quarkus.runtime.QuarkusApplication</code> interface with <code>@io.quarkus.runtime.annotations.QuarkusMain annotation</code>.</p>

<p>The drawback of the second solution is that you cannot run it from the IDE, and this is the reason we suggest you use the former approach.</p>

<p>As you’ve seen in the example, if you want to run some logic on startup and then run it like a normal application (i.e., not exit), then you should call <code>Quarkus.waitForExit</code> from the main thread.
If you don’t call this method, then the Quarkus application is started and then terminated, so your application effectively behaves like any other CLI program.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.2 Creating a Runnable JAR File"><div class="sect1" id="runnable_jar">
<h1>6.2 Creating a Runnable JAR File</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128519694920">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="JAR files" data-secondary="creating runnable" id="idm45128519734520"/><a data-type="indexterm" data-primary="packaging" data-secondary="building runnable JAR files" id="idm45128519733544"/>You want to create a runnable JAR file to be distributed/containerized into a machine with a JVM installed.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128519732120">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="Quarkus Maven plug-in" id="idm45128519730552"/>Use the <em>Quarkus Maven plug-in</em> to create a runnable JAR.</p>

<p>The Quarkus Maven plug-in is installed by default if you have scaffolded the project using any of the starters mentioned in previous recipes:</p>

<pre data-type="programlisting" data-code-language="java"><code class="o">&lt;</code><code class="n">plugin</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">groupId</code><code class="o">&gt;</code><code class="n">io</code><code class="o">.</code><code class="na">quarkus</code><code class="o">&lt;/</code><code class="n">groupId</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">artifactId</code><code class="o">&gt;</code><code class="n">quarkus</code><code class="o">-</code><code class="n">maven</code><code class="o">-</code><code class="n">plugin</code><code class="o">&lt;/</code><code class="n">artifactId</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">version</code><code class="o">&gt;</code><code class="n">$</code><code class="o">{</code><code class="n">quarkus</code><code class="o">.</code><code class="na">version</code><code class="o">}&lt;/</code><code class="n">version</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">executions</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="n">execution</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="n">goals</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="n">goal</code><code class="o">&gt;</code><code class="n">build</code><code class="o">&lt;/</code><code class="n">goal</code><code class="o">&gt;</code>
      <code class="o">&lt;/</code><code class="n">goals</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="n">execution</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="n">executions</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="n">plugin</code><code class="o">&gt;</code></pre>

<p>Then run <code>package</code> goal to build the JAR file:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean package</code></pre>

<p>The <code>target</code> directory contains the following contents:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">target
</code><code class="go">├── classes
</code><code class="go">├── generated-sources
</code><code class="go">├── generated-test-sources
</code><code class="go">├── getting-started-1.0-SNAPSHOT-runner.jar </code><a class="co" id="co_packaging_quarkus_applications_CO4-1" href="#callout_packaging_quarkus_applications_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="go">
</code><code class="go">├── getting-started-1.0-SNAPSHOT.jar </code><a class="co" id="co_packaging_quarkus_applications_CO4-2" href="#callout_packaging_quarkus_applications_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code class="go">
</code><code class="go">├── lib </code><a class="co" id="co_packaging_quarkus_applications_CO4-3" href="#callout_packaging_quarkus_applications_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code class="go">
</code><code class="go">├── maven-archiver
</code><code class="go">├── maven-status
</code><code class="go">├── test-classes
</code><code class="go">├── transformed-classes
</code><code class="go">└── wiring-classes</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_packaging_quarkus_applications_CO4-1" href="#co_packaging_quarkus_applications_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>An executable JAR (not über-JAR)</p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO4-2" href="#co_packaging_quarkus_applications_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Location of dependencies</p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO4-3" href="#co_packaging_quarkus_applications_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Lib folder with application dependencies</p></dd>
</dl>

<p>If you want to deploy the application, it is important to copy together the <em>executable JAR</em> with the <code>lib</code> directory.</p>

<p>You can run the application by running the next command:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">java -jar target/getting-started-1.0-SNAPSHOT-runner.jar</code></pre>

<p><a data-type="indexterm" data-primary="JVM mode" id="idm45128519519080"/>Running Quarkus in this way is known as running Quarkus in the <em>JVM mode</em>.
This means that you are not producing a native compilation but are running your application inside the JVM.</p>
<div data-type="tip"><h6>Tip</h6>
<p>If you want to package a Quarkus application in JVM mode into a container, we recommend using this approach because the layers created during the container build stage are cached to be reused later. Libraries are something that do not usually change, so this dependency layer might be reused several times in future executions, speeding up the container build time.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128519731656">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="Gradle" data-secondary="creating runnable JAR files with" id="idm45128519514712"/>To create a runnable JAR file with Gradle, you can run the <code>quarkusBuild</code> task:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./gradlew quarkusBuild</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128519498936">
<h2>See Also</h2>

<p>If you are interested in how to create an über-JAR or how to containerize a Quarkus application, see <a data-type="xref" href="#uber_jar_packaging">Recipe 6.3</a>.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.3 Über-JAR Packaging"><div class="sect1" id="uber_jar_packaging">
<h1>6.3 Über-JAR Packaging</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128519508712">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="packaging" data-secondary="building uber-JAR" id="idm45128519507480"/><a data-type="indexterm" data-primary="uber-JAR, creating" id="idm45128519506504"/>You want to create an über-JAR of your Quarkus application.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128519505448">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="Qaurkus Maven plug-in" id="idm45128519504280"/>Quarkus Maven plug-in supports the generation of über-JARs by specifying an <code>uberJar</code> configuration option in your <em>pom.xml</em>.</p>

<p>To create an über-JAR, a JAR that contains your code <code>runnable classes</code> and 
<span class="keep-together">all required</span> dependencies, you need to configure Quarkus accordingly in the 
<span class="keep-together"><em>application.properties</em></span> file by setting <code>quarkus.package.uber-jar</code> to <code>true</code>:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.package.uber-jar</code><code class="o">=</code><code class="s">true</code></pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.4 Building a Native Executable"><div class="sect1" id="native_executable">
<h1>6.4 Building a Native Executable</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128519435976">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="native executable files" id="idm45128519478088"/><a data-type="indexterm" data-primary="packaging" data-secondary="building native executable files" id="idm45128519477496"/>You want to build your Quarkus application as a native executable file.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128519476200">
<h2>Solution</h2>

<p>Use Quarkus and GraalVM to build a native runnable file that is ideal for containers and serverless loads.</p>

<p><a data-type="indexterm" data-primary="GraalVM" id="idm45128519472568"/>Native executables make Quarkus applications ideal for containers and serverless workloads.
Quarkus relies on <a href="https://www.graalvm.org">GraalVM</a> to build a Java application as a native executable.</p>

<p>Before building a native executable, make sure to have the <code>GRAALVM_HOME</code> environment variable set to the GraalVM 19.3.1 or 20.0.0 installation directory.</p>
<div data-type="important"><h6>Important</h6>
<p>If you are using macOS, the variable should point to the <em>Home</em> sub-directory: <code>export GRAALVM_HOME=&lt;installation_dir&gt;/Development/graalvm/Contents/Home/</code>.</p>
</div>

<p>When a Quarkus project is generated using any of the methods explained before, it registers a default Maven profile with the name <code>native</code> that can be used to build a Quarkus native executable application:</p>

<pre data-type="programlisting" data-code-language="java"><code class="o">&lt;</code><code class="n">profile</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">id</code><code class="o">&gt;</code><code class="kd">native</code><code class="o">&lt;/</code><code class="n">id</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">activation</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="n">property</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="n">name</code><code class="o">&gt;</code><code class="kd">native</code><code class="o">&lt;/</code><code class="n">name</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="n">property</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="n">activation</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">build</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="n">plugins</code><code class="o">&gt;</code>
      <code class="o">&lt;</code><code class="n">plugin</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="n">artifactId</code><code class="o">&gt;</code><code class="n">maven</code><code class="o">-</code><code class="n">failsafe</code><code class="o">-</code><code class="n">plugin</code><code class="o">&lt;/</code><code class="n">artifactId</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="n">version</code><code class="o">&gt;</code><code class="n">$</code><code class="o">{</code><code class="n">surefire</code><code class="o">-</code><code class="n">plugin</code><code class="o">.</code><code class="na">version</code><code class="o">}&lt;/</code><code class="n">version</code><code class="o">&gt;</code>
        <code class="o">&lt;</code><code class="n">executions</code><code class="o">&gt;</code>
          <code class="o">&lt;</code><code class="n">execution</code><code class="o">&gt;</code>
            <code class="o">&lt;</code><code class="n">goals</code><code class="o">&gt;</code>
              <code class="o">&lt;</code><code class="n">goal</code><code class="o">&gt;</code><code class="n">integration</code><code class="o">-</code><code class="n">test</code><code class="o">&lt;/</code><code class="n">goal</code><code class="o">&gt;</code>
              <code class="o">&lt;</code><code class="n">goal</code><code class="o">&gt;</code><code class="n">verify</code><code class="o">&lt;/</code><code class="n">goal</code><code class="o">&gt;</code>
            <code class="o">&lt;/</code><code class="n">goals</code><code class="o">&gt;</code>
            <code class="o">&lt;</code><code class="n">configuration</code><code class="o">&gt;</code>
              <code class="o">&lt;</code><code class="n">systemProperties</code><code class="o">&gt;</code>
                <code class="o">&lt;</code><code class="kd">native</code><code class="o">.</code><code class="na">image</code><code class="o">.</code><code class="na">path</code><code class="o">&gt;</code>
                  <code class="n">$</code><code class="o">{</code><code class="n">project</code><code class="o">.</code><code class="na">build</code><code class="o">.</code><code class="na">directory</code><code class="o">}/</code><code class="n">$</code><code class="o">{</code><code class="n">project</code><code class="o">.</code><code class="na">build</code><code class="o">.</code><code class="na">finalName</code><code class="o">}-</code><code class="n">runner</code>
                <code class="o">&lt;/</code><code class="kd">native</code><code class="o">.</code><code class="na">image</code><code class="o">.</code><code class="na">path</code><code class="o">&gt;</code>
              <code class="o">&lt;/</code><code class="n">systemProperties</code><code class="o">&gt;</code>
            <code class="o">&lt;/</code><code class="n">configuration</code><code class="o">&gt;</code>
          <code class="o">&lt;/</code><code class="n">execution</code><code class="o">&gt;</code>
        <code class="o">&lt;/</code><code class="n">executions</code><code class="o">&gt;</code>
      <code class="o">&lt;/</code><code class="n">plugin</code><code class="o">&gt;</code>
    <code class="o">&lt;/</code><code class="n">plugins</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="n">build</code><code class="o">&gt;</code>
  <code class="o">&lt;</code><code class="n">properties</code><code class="o">&gt;</code>
    <code class="o">&lt;</code><code class="n">quarkus</code><code class="o">.</code><code class="na">package</code><code class="o">.</code><code class="na">type</code><code class="o">&gt;</code><code class="kd">native</code><code class="o">&lt;/</code><code class="n">quarkus</code><code class="o">.</code><code class="na">package</code><code class="o">.</code><code class="na">type</code><code class="o">&gt;</code>
  <code class="o">&lt;/</code><code class="n">properties</code><code class="o">&gt;</code>
<code class="o">&lt;/</code><code class="n">profile</code><code class="o">&gt;</code></pre>

<p>Then you need to build the project with the <code>native</code> profile enabled:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw package -Pnative</code></pre>

<p>After a few minutes, a native executable will be present in <code>target</code> directory:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">[INFO] --- quarkus-maven-plugin:1.4.1.Final:native-image (default) @</code>
<code class="go">        getting-started ---</code>
<code class="go">[INFO] [io.quarkus.creator.phase.nativeimage.NativeImagePhase] Running Quarkus</code>
<code class="go">        native-image plugin on Java HotSpot(TM) 64-Bit Server VM</code>
<code class="go">...</code>
<code class="go">[getting-started-1.0-SNAPSHOT-runner:19]    classlist:  13,614.07 ms</code>
<code class="go">[getting-started-1.0-SNAPSHOT-runner:19]        (cap):   2,306.78 ms</code>
<code class="go">[getting-started-1.0-SNAPSHOT-runner:19]        setup:   4,793.43 ms</code>
<code class="go">...</code>
<code class="go">Printing list of used packages to</code>
<code class="go">  /project/reports/used_packages_getting-started-1.0-SNAPSHOT-</code>
<code class="go">                                    runner_20190927_134032.txt</code>
<code class="go">[getting-started-1.0-SNAPSHOT-runner:19]    (compile):  42,452.12 ms</code>
<code class="go">[getting-started-1.0-SNAPSHOT-runner:19]      compile:  62,356.07 ms</code>
<code class="go">[getting-started-1.0-SNAPSHOT-runner:19]        image:   2,939.16 ms</code>
<code class="go">[getting-started-1.0-SNAPSHOT-runner:19]        write:     696.65 ms</code>
<code class="go">[getting-started-1.0-SNAPSHOT-runner:19]      [total]: 151,743.29 ms</code>

<code class="go">target/getting-started-1.0-SNAPSHOT-runner</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128519243256">
<h2>Discussion</h2>

<p>To build a native executable in Gradle, you can use the <code>buildNative</code> task:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./gradlew buildNative</code></pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.5 Building a Docker Container for JAR File"><div class="sect1" id="idm45128519207320">
<h1>6.5 Building a Docker Container for JAR File</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128519213608">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="Docker containers" data-secondary="building for JAR files" id="idm45128519110600"/><a data-type="indexterm" data-primary="JAR files" data-secondary="building Docker containers for" id="idm45128519149064"/><a data-type="indexterm" data-primary="packaging" data-secondary="building Docker containers for JAR files" id="idm45128519148152"/>You want to build a container with the JAR built in the <a data-type="xref" href="#runnable_jar">Recipe 6.2</a> recipe.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128519145928">
<h2>Solution</h2>

<p>Use the <em>Dockerfile.jvm</em> file provided to build the container.</p>

<p>When a Quarkus project is generated using any of the methods explained before, two Dockerfiles are created in <em>src/main/docker</em>: one for generating a Docker container using Quarkus in the JVM mode and another one for the native executable.</p>

<p>To generate a container for running Quarkus inside the JVM (no native), you can use the <em>Dockerfile.jvm</em> file to build the container.
This Dockerfile adds the <em>lib</em> directory and the runnable JAR and exposes JMX.</p>

<p>To build the Docker image, you need to package the project as shown in <a data-type="xref" href="#runnable_jar">Recipe 6.2</a> and then build the container:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw clean package

docker build -f src/main/docker/Dockerfile.jvm -t example/greetings-app .</pre>

<p>The container can be started by running the following:</p>

<pre data-type="programlisting" data-code-language="bash">docker run -it --rm -p 8080:8080 example/greetings-app</pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.6 Building a Docker Container for Native File"><div class="sect1" id="building-a-docker-container-native-file">
<h1>6.6 Building a Docker Container for Native File</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128519137256">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="Docker containers" data-secondary="building for native files" id="idm45128519136120"/><a data-type="indexterm" data-primary="native files, building Docker containers for" id="idm45128519206904"/><a data-type="indexterm" data-primary="packaging" data-secondary="building Docker containers for native files" id="idm45128519206136"/>You want to build a native executable container image.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128519204776">
<h2>Solution</h2>

<p>To generate a container for running a Quarkus native executable, you can use the <em>Dockerfile.native</em> file to build the container.</p>

<p>To build the Docker image, you need to create a native file that can be run in a Docker container.
For this reason, don’t use local GraalVM to build the native 
<span class="keep-together">executable</span> because the result file will be specific to your operating system and will not be able to run inside a container.</p>

<p>To create an executable that will run in a container, use the following command in your terminal:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw clean package -Pnative -Dquarkus.native.container-build<code class="o">=</code><code class="nb">true</code></pre>

<p>This command creates a Docker image that contains GraalVM installed to produce a 64-bit Linux executable from your code.</p>
<div data-type="important"><h6>Important</h6>
<p>You need to have <code>native</code> profile defined in your <em>pom.xml</em>, as explained in the <a data-type="xref" href="#native_executable">Recipe 6.4</a> recipe.</p>
</div>

<p>The last step is to build the Docker image with the native executable that was generated in the previous step:</p>

<pre data-type="programlisting" data-code-language="bash">docker build -f src/main/docker/Dockerfile.native -t example/greetings-app .</pre>

<p>Then the container can be started by running the following:</p>

<pre data-type="programlisting" data-code-language="bash">docker run -it --rm -p 8080:8080 example/greetings-app</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128519204184">
<h2>Discussion</h2>

<p>By default, Quarkus uses <code>docker</code> to build the container.
The container runtime can be changed by using the <code>quarkus.native.container-runtime</code> property.
At the time of writing the book, <code>docker</code> and <code>podman</code> are the supported options:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw package -Pnative -Dquarkus.native.container-build<code class="o">=</code><code class="nb">true</code> <code class="se">\</code>
               -Dquarkus.native.container-runtime<code class="o">=</code>podman</pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="6.7 Build and Dockerize a Native SSL Application"><div class="sect1" id="idm45128519020440">
<h1>6.7 Build and Dockerize a Native SSL Application</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128518982552">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="packaging" data-secondary="building native SSL applications" id="idm45128518981416"/><a data-type="indexterm" data-primary="packaging" data-secondary="dockerizing native SSL applications" id="idm45128518980472"/><a data-type="indexterm" data-primary="SSL" data-secondary="building/dockerizing native" id="idm45128519026696"/>When building a native executable, you want to secure connections to prevent an attacker from stealing sensitive information.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128519025256">
<h2>Solution</h2>

<p>Enable Quarkus to use SSL to secure connections in a native executable.</p>

<p>If you are running the Quarkus application in JVM mode, SSL is supported without any problem, just as any other JVM application.
But SSL is not supported out of the box in the case of native executables, and some extra steps (especially when Dockerizing the application) must be executed to enable SSL support.</p>

<p>Let’s enable SSL support for native executables in Quarkus by adding the <code>quarkus.ssl.native</code> configuration property at <em>application.properties</em>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="n">quarkus</code><code class="o">.</code><code class="na">ssl</code><code class="o">.</code><code class="na">native</code><code class="o">=</code><code class="kc">true</code></pre>

<p>Enabling this property allows the Graal VM <code>native-image</code> process to enable SSL.
Create a native executable using the next command:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean package -Pnative -DskipTests -Dquarkus.native.container-build=true</code>

<code class="go">...</code>

<code class="go">docker run -v \</code>
<code class="go"> gretting-started/target/gretting-started-1.0-SNAPSHOT-native-image-source-jar: \</code>
<code class="go"> /project:z</code></pre>

<p>The following are the important flags that are added automatically by the process to enable SSL:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">-H:EnableURLProtocols=http,https --enable-all-security-services -H:+JNI</code></pre>

<p>To Dockerize this native executable, the Docker-related scripts need to be modified slightly to support SSL.</p>

<p>Open <code>.dockeringnore</code> and add the <code>keystore.jks</code> file as a nonignorable file to be added into the resulted container.
This is necessary because the keystore file needs to be copied together with the executable:</p>

<pre data-type="programlisting">*
!target/classes/keystore.jks
!target/*-runner
!target/*-runner.jar
!target/lib/*</pre>

<p>The <em>src/main/docker/Dockerfile.native</em> file must also be adapted to package the 
<span class="keep-together">following</span> elements:</p>

<ul>
<li>
<p>The SunEC library</p>
</li>
<li>
<p>The collection of trusted certificate authority files needed to verify certificates used in the application.</p>
</li>
</ul>

<pre data-type="programlisting" data-code-language="docker"><code class="k">FROM</code><code class="s"> quay.io/quarkus/ubi-quarkus-native-image:19.2.1 as nativebuilder </code><a class="co" id="co_packaging_quarkus_applications_CO5-1" href="#callout_packaging_quarkus_applications_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="k">FROM</code><code class="s"> quay.io/quarkus/ubi-quarkus-native-image:19.3.1-java11 as nativebuilder</code><code>
</code><code class="k">RUN</code><code> </code><code>mkdir</code><code> </code><code>-p</code><code> </code><code>/tmp/ssl</code><code> </code><code class="se">\
</code><code>  </code><code class="o">&amp;&amp;</code><code> </code><code>cp</code><code> </code><code>/opt/graalvm/lib/security/cacerts</code><code> </code><code>/tmp/ssl/</code><code>
</code><code>
</code><code class="k">FROM</code><code class="s"> registry.access.redhat.com/ubi8/ubi-minimal</code><code>
</code><code class="k">WORKDIR</code><code class="s"> /work/</code><code>
</code><code>COPY</code><code> </code><code>--from</code><code class="o">=</code><code>nativebuilder</code><code> </code><code>/tmp/ssl/</code><code> </code><code>/work/</code><code> </code><a class="co" id="co_packaging_quarkus_applications_CO5-2" href="#callout_packaging_quarkus_applications_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>COPY</code><code> </code><code>target/*-runner</code><code> </code><code>/work/application</code><code>
</code><code class="k">RUN</code><code> </code><code>chmod</code><code> </code><code class="m">775</code><code> </code><code>/work</code><code> </code><code>/work/application</code><code> </code><code class="se">\ </code><a class="co" id="co_packaging_quarkus_applications_CO5-3" href="#callout_packaging_quarkus_applications_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>  </code><code class="o">&amp;&amp;</code><code> </code><code>chown</code><code> </code><code>-R</code><code> </code><code class="m">1001</code><code> </code><code>/work</code><code> </code><code class="se">\
</code><code>  </code><code class="o">&amp;&amp;</code><code> </code><code>chmod</code><code> </code><code>-R</code><code> </code><code class="s2">"g+rwX"</code><code> </code><code>/work</code><code> </code><code class="se">\
</code><code>  </code><code class="o">&amp;&amp;</code><code> </code><code>chown</code><code> </code><code>-R</code><code> </code><code>1001:root</code><code> </code><code>/work</code><code>
</code><code class="k">EXPOSE</code><code class="s"> 8080 8443 </code><a class="co" id="co_packaging_quarkus_applications_CO5-4" href="#callout_packaging_quarkus_applications_CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>USER</code><code> </code><code class="m">1001</code><code>
</code><code class="k">CMD</code><code class="s"> ["./application",</code><code>
</code><code class="s2">"-Dquarkus.http.host=0.0.0.0"</code><code>,</code><code>
</code><code class="s2">"-Djavax.net.ssl.trustStore=/work/cacerts"</code><code class="o">]</code><code> </code><a class="co" id="co_packaging_quarkus_applications_CO5-5" href="#callout_packaging_quarkus_applications_CO5-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_packaging_quarkus_applications_CO5-1" href="#co_packaging_quarkus_applications_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Gets SunEC library and <code>cacerts</code> from GraalVM Docker image</p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO5-2" href="#co_packaging_quarkus_applications_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Copies custom <code>keystore.jks</code> at root working directory</p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO5-3" href="#co_packaging_quarkus_applications_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Sets up permissions</p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO5-4" href="#co_packaging_quarkus_applications_CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Exposes HTTPS port</p></dd>
<dt><a class="co" id="callout_packaging_quarkus_applications_CO5-5" href="#co_packaging_quarkus_applications_CO5-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Loads SunEC and <code>cacerts</code> when running the application</p></dd>
</dl>

<p>The container image can be built by running the next command:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">docker build -f src/main/docker/Dockerfile.native -t greeting-ssl .</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128519024664">
<h2>Discussion</h2>

<p>Security and SSL are common now, and it is good practice to always have all your services communicate using SSL.
For this reason, Quarkus enables SSL support automatically when any of the following extensions are registered<a data-type="indexterm" data-primary="" data-startref="pac_ch" id="idm45128518714456"/>:</p>

<ul>
<li>
<p>Agroal connection pooling</p>
</li>
<li>
<p>Amazon DynamoDB</p>
</li>
<li>
<p>Hibernate Search Elasticsearch</p>
</li>
<li>
<p>Infinispan Client</p>
</li>
<li>
<p>Jaeger</p>
</li>
<li>
<p>JGit</p>
</li>
<li>
<p>Keycloak</p>
</li>
<li>
<p>Kubernetes client</p>
</li>
<li>
<p>Mailer</p>
</li>
<li>
<p>MongoDB</p>
</li>
<li>
<p>Neo4j</p>
</li>
<li>
<p>OAuth2</p>
</li>
<li>
<p>REST client</p>
</li>
</ul>

<p>As long as you have one of those extensions in your project, the <code>quarkus.native.ssl</code> property is set to <code>true</code> by default.</p>
</div></section>





</div></section>







</div></section></div>



  </body></html>