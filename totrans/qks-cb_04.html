<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Configuration"><div class="chapter" id="configuration_chapter">
<h1><span class="label">Chapter 4. </span>Configuration</h1>


<p><a data-type="indexterm" data-primary="configuration" id="con_ch"/>In this chapter, you’ll learn the following about setting configuration parameters:</p>

<ul>
<li>
<p>How to configure a Quarkus service</p>
</li>
<li>
<p>How to inject configuration parameters in the service</p>
</li>
<li>
<p>How to apply values depending on the environment</p>
</li>
<li>
<p>How to correctly configure the logging system</p>
</li>
<li>
<p>How to create customizations for the configuration system</p>
</li>
</ul>






<section data-type="sect1" data-pdf-bookmark="4.1 Configuring the Application with Custom Properties"><div class="sect1" id="config-app-with-cust-properties">
<h1>4.1 Configuring the Application with Custom Properties</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128537296120">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="applications" data-secondary="configuring with custom properties" id="app_con"/><a data-type="indexterm" data-primary="configuration" data-secondary="application with custom properties" id="con_app"/><a data-type="indexterm" data-primary="properties" id="pro_ab"/>You want to configure the Quarkus application with custom properties.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128537291192">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="Eclipse MicroProfile Configuration" id="idm45128537268792"/>Quarkus makes use of a number of the Eclipse MicroProfile specifications.
One of those is the Configuration specification; however, to simplify configuration, Quarkus uses just one file for all configurations, <em>application.properties</em>, which must be placed in the root of the classpath.</p>

<p>This file can be used to configure Quarkus properties such as logging or default path, Quarkus extensions like data source or Kafka, or custom properties that you define for the application.
You are going to see all of them in the book, but in this recipe, you’ll see the latter one.</p>

<p>Open the <em>src/main/resources/application.properties</em> file and add the following 
<span class="keep-together">property:</span></p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">greeting.message</code><code class="o">=</code><code class="s">Hello World</code></pre>

<p>You can inject the property value defined in <em>application.properties</em> by using the <code>org.eclipse.microprofile.config.inject.ConfigProperty</code> annotation in a field.</p>

<p>Open <code>org.acme.quickstart.GreetingResource.java</code> and inject <code>greeting.message</code> property value:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ConfigProperty</code><code class="o">(</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s">"greeting.message"</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO1-1" href="#callout_configuration_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">String</code><code> </code><code class="n">message</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO1-2" href="#callout_configuration_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">hello</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">message</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO1-3" href="#callout_configuration_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO1-1" href="#co_configuration_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Injects the value of <code>greeting.message</code> property</p></dd>
<dt><a class="co" id="callout_configuration_CO1-2" href="#co_configuration_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Places fields in package-protected scope</p></dd>
<dt><a class="co" id="callout_configuration_CO1-3" href="#co_configuration_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Returns the configured value</p></dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p><a data-type="indexterm" data-primary="GraalVM" id="idm45128537192120"/><a data-type="indexterm" data-primary="protected-package scope" id="idm45128537164120"/>For performance reasons when using GraalVM and reflection, we encourage you to use <em>protected-package</em> scope on fields that will be injected at runtime. You can read more about it in the <a href="https://oreil.ly/8e1Sd">Quarkus CDI Reference Guide</a>.</p>
</div>

<p>In a new terminal window, make a request to <code>/hello</code> to see that the output message is the configured value in <em>application.properties</em>:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello</code>

<code class="go">Hello World</code></pre>

<p><a data-type="indexterm" data-primary="@ConfigProperty annotation" id="idm45128537135896"/>If you want to make a configuration field not mandatory and provide a default value, you can use the <code>defaultValue</code> attribute of <code>@ConfigProperty</code> annotation.</p>

<p>Open the <code>org.acme.quickstart.GreetingResource.java</code> file and inject the <code>greeting.upper-case</code> property value:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ConfigProperty</code><code class="o">(</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s">"greeting.upper-case"</code><code class="o">,</code><code>
</code><code>                </code><code class="n">defaultValue</code><code> </code><code class="o">=</code><code> </code><code class="s">"true"</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO2-1" href="#callout_configuration_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kt">boolean</code><code> </code><code class="n">upperCase</code><code class="o">;</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/optional"</code><code class="o">)</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">helloOptional</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">upperCase</code><code> </code><code class="o">?</code><code> </code><code class="n">message</code><code class="o">.</code><code class="na">toUpperCase</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">:</code><code> </code><code class="n">message</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO2-1" href="#co_configuration_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets the default of <code>greeting.upper-case</code> property to true</p></dd>
</dl>

<p>And in a terminal window, make a request to <code>/hello/optional</code> to see that the output message is in upper case:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello/optional</code>

<code class="go">HELLO WORLD</code></pre>

<p><a data-type="indexterm" data-primary="multivalue properties" id="idm45128537027240"/><a data-type="indexterm" data-primary="escape character" id="idm45128537026408"/>Multivalue properties are supported—you need to define only the field type as one of <code>Arrays</code>, <code>java.util.List</code> or <code>java.util.Set</code>, depending on your requirements/preference.
The delimiter for the property value is a comma (<code>,</code>) and the escape character is the backslash (<code>\</code>).</p>

<p>Open the <em>src/main/resources/application.properties</em> file and add the following property with three values:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">greeting.suffix</code><code class="o">=</code><code class="s">!!, How are you???</code></pre>

<p>Open <em>org.acme.quickstart.GreetingResource.java</em> and inject <code>greeting.suffix</code> property values:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ConfigProperty</code><code class="o">(</code><code class="n">name</code> <code class="o">=</code> <code class="s">"greeting.suffix"</code><code class="o">)</code>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">suffixes</code><code class="o">;</code>
<code class="nd">@GET</code>
<code class="nd">@Path</code><code class="o">(</code><code class="s">"/list"</code><code class="o">)</code>
<code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code>
<code class="kd">public</code> <code class="n">String</code> <code class="nf">helloList</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">message</code> <code class="o">+</code> <code class="n">suffixes</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>
<code class="o">}</code></pre>

<p>And in a terminal window make a request to <code>/hello/list</code> to see that the output message contains the second suffix:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello/list</code>

<code class="go">Hello World How are you?</code></pre>

<p><a data-type="indexterm" data-primary="YAML files" id="idm45128536905736"/>The YAML format is also supported for configuring the application.
In this case, the file is named <em>application.yaml</em> or <em>application.yml</em>.</p>

<p>To start using the YAML configuration file, you need to add the <code>config-yaml</code> 
<span class="keep-together">extension:</span></p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="config-yaml"</code></pre>
<div style="page-break-after: always;"/>

<p><a data-type="indexterm" data-primary="properties format" id="idm45128536937064"/>Given the following configuration file using the <code>properties</code> format:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">greeting.message</code><code class="o">=</code><code class="s">Hello World</code>

<code class="na">%staging.quarkus.http.port</code><code class="o">=</code><code class="s">8182</code>

<code class="na">quarkus.http.cors</code><code class="o">=</code><code class="s">true</code>
<code class="na">quarkus.http.cors.methods</code><code class="o">=</code><code class="s">GET,PUT,POST</code></pre>

<p>The equivalent in YAML format follows:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">greeting</code><code class="p">:</code><code>
</code><code>  </code><code class="nt">message</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">Hello</code><code class="l-Scalar-Plain"> </code><code class="l-Scalar-Plain">World</code><code> </code><a class="co" id="co_configuration_CO3-1" href="#callout_configuration_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="s">"</code><code class="s">%staging</code><code class="s">"</code><code class="p-Indicator">:</code><code> </code><a class="co" id="co_configuration_CO3-2" href="#callout_configuration_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>  </code><code class="nt">quarkus</code><code class="p">:</code><code>
</code><code>    </code><code class="nt">http</code><code class="p">:</code><code>
</code><code>      </code><code class="nt">port</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">8182</code><code>
</code><code class="nt">quarkus</code><code class="p">:</code><code>
</code><code>  </code><code class="nt">http</code><code class="p">:</code><code>
</code><code>    </code><code class="nt">cors</code><code class="p">:</code><code>
</code><code>      </code><code class="nt">~</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">true</code><code> </code><a class="co" id="co_configuration_CO3-3" href="#callout_configuration_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>      </code><code class="nt">methods</code><code class="p">:</code><code> </code><code class="l-Scalar-Plain">GET,PUT,POST</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO3-1" href="#co_configuration_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Simple properties are set as a structure</p></dd>
<dt><a class="co" id="callout_configuration_CO3-2" href="#co_configuration_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Profiles are supported wrapped in quotation marks</p></dd>
<dt><a class="co" id="callout_configuration_CO3-3" href="#co_configuration_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>When there are subkeys the <code>~</code> is used to refer to the unprefixed part</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128537290360">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="Eclipse MicroProfile Configuration" id="idm45128536796488"/>Eclipse MicroProfile Configuration comes with the following built-in converters to map a configuration value into a Java object:</p>

<ul>
<li>
<p><code>boolean</code> and <code>java.lang.Boolean</code>; the values for true are <code>true</code>, <code>1</code>, <code>YES</code>, <code>Y</code>, and <code>ON</code>, while any other value is considered <code>false</code></p>
</li>
<li>
<p><code>byte</code> and <code>java.lang.Byte</code></p>
</li>
<li>
<p><code>short</code> and <code>java.lang.Short</code></p>
</li>
<li>
<p><code>int</code> and <code>java.lang.Integer</code></p>
</li>
<li>
<p><code>long</code> and <code>java.lang.Long</code></p>
</li>
<li>
<p><code>float</code> and <code>java.lang.Float</code></p>
</li>
<li>
<p><code>double</code> and <code>java.lang.Double</code></p>
</li>
<li>
<p><code>char</code> and <code>java.lang.Character</code></p>
</li>
<li>
<p><code>java.lang.Class</code> based on the result of the call of <code>Class.forName</code></p>
</li>
</ul>

<p><a data-type="indexterm" data-primary="built-in converter" id="idm45128536750216"/><a data-type="indexterm" data-primary="custom converters" id="idm45128536749512"/>If a built-in converter or custom converter does not exist, then the following methods are checked in the target object. If a built-in converter or custom converter <em>does</em> exist, the discovered/found method is used to instantiate the converter object and the string argument is passed for conversion<a data-type="indexterm" data-primary="" data-startref="app_con" id="idm45128536748008"/><a data-type="indexterm" data-primary="" data-startref="con_app" id="idm45128536747032"/><a data-type="indexterm" data-primary="" data-startref="pro_ab" id="idm45128536746088"/>:</p>

<ul>
<li>
<p>Target type has <code>public static T of(String)</code> method</p>
</li>
<li>
<p>Target type has <code>public static T valueOf(String)</code> method</p>
</li>
<li>
<p>Target type has public constructor with a <code>String</code> parameter</p>
</li>
<li>
<p>Target type has <code>public static T parse(CharSequence)</code> method</p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.2 Accessing Configuration Properties Programmatically"><div class="sect1" id="idm45128536739192">
<h1>4.2 Accessing Configuration Properties Programmatically</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128536738184">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="accessing properties programmatically" id="idm45128536736984"/><a data-type="indexterm" data-primary="properties" id="idm45128536736040"/>You want to access configuration properties programmatically instead of injecting them using the <code>org.eclipse.microprofile.config.inject.ConfigProperty</code> 
<span class="keep-together">annotation</span>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128536733800">
<h2>Solution</h2>

<p>Inject the <code>org.eclipse.microprofile.config.Config</code> class in the object for which you want to access properties programmatically.</p>

<p><a data-type="indexterm" data-primary="Eclipse MicroProfile Configuration" id="idm45128536731496"/>The Eclipse MicroProfile Configuration spec allows you to inject <code>org.eclipse.microprofile.config.Config</code> to get properties programmatically instead of injecting directly with <code>ConfigProperty</code>.</p>

<p>Open <code>org.acme.quickstart.GreetingResource.java</code> and inject <code>Config</code> class:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Inject</code><code> </code><a class="co" id="co_configuration_CO4-1" href="#callout_configuration_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">Config</code><code> </code><code class="n">config</code><code class="o">;</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/config"</code><code class="o">)</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">helloConfig</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">config</code><code class="o">.</code><code class="na">getPropertyNames</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code> </code><code class="n">p</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">p</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO4-2" href="#callout_configuration_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">config</code><code class="o">.</code><code class="na">getValue</code><code class="o">(</code><code class="s">"greeting.message"</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO4-3" href="#callout_configuration_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO4-1" href="#co_configuration_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use <code>Inject</code> CDI annotation to inject the instance</p></dd>
<dt><a class="co" id="callout_configuration_CO4-2" href="#co_configuration_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>You can now access the list of properties</p></dd>
<dt><a class="co" id="callout_configuration_CO4-3" href="#co_configuration_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Property needs to be cast to final type</p></dd>
</dl>

<p>You can access the <code>Config</code> class without using CDI by calling <code>ConfigProvider.getConfig()</code> method.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.3 Overwriting Configuration Values Externally"><div class="sect1" id="idm45128536639384">
<h1>4.3 Overwriting Configuration Values Externally</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128536615912">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="values" data-secondary="overwriting externally" id="idm45128536614744"/><a data-type="indexterm" data-primary="configuration" data-secondary="overwriting values externally" id="idm45128536613768"/><a data-type="indexterm" data-primary="overwriting configuration values externally" id="idm45128536612856"/>You want to overwrite any configuration value at runtime.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128536611832">
<h2>Solution</h2>

<p>You can overwrite any property at runtime by setting it as a system property or environment variable.</p>

<p>Quarkus lets you overwrite any configuration property by setting a configuration 
<span class="keep-together">as a system property</span> (<code>-Dproperty.name=value</code>) and/or as an environment variable (<code>export PROPERTY_NAME=value</code>).
System properties have more priority than environment variables.</p>

<p>Examples of externalizing these properties can be a database URL, username, or password because they are known only in the target environment.
But you need to know that there is a trade-off because the more runtime properties are available, the less build time prework Quarkus can do.</p>

<p>Let’s package the application used in <a data-type="xref" href="#config-app-with-cust-properties">Recipe 4.1</a> and override the <code>greeting.message</code> property by setting a system property:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean package -DskipTests</code>

<code class="go">java -Dgreeting.message=Aloha -jar target/getting-started-1.0-SNAPSHOT-runner.jar</code></pre>

<p>In a new terminal window, validate that the property has been overridden from <code>Hello World</code> to <code>Aloha</code> by running:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl localhost:8080/hello</code>

<code class="go">Aloha</code></pre>

<p>In the case of environment variables, three naming conventions for a given property name are supported.
This is because some operating systems allow only alphabetic characters and underscores (<code>_</code>) but no other characters, like dots (<code>.</code>).
To support all possible cases, the following rules are used:</p>
<ol>
<li>
<p>Exactly match (<code>greeting.message</code>).</p>
</li>
<li>
<p>Replace nonalphanumeric characters to underscore (<code>greeting_message</code>).</p>
</li>
<li>
<p>Replace nonalphanumeric characters to underscore and convert the rest to upper case (<code>GREETING_MESSAGE</code>).</p>
</li>

</ol>

<p>Here is the <em>application.properties</em> file:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">greeting.message</code><code class="o">=</code><code class="s">Hello World</code></pre>

<p>You can override its value using any of the following environment variable names because all of them are equivalent:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">export greeting.message=Aloha</code>
<code class="go">export greeting_message=Aloha</code>
<code class="go">export GREETING_MESSAGE=Aloha</code></pre>

<p><a data-type="indexterm" data-primary="config directory" id="idm45128536597960"/>There is also a special place where you can put the <em>application.properties</em> file outside the application itself, inside a directory named <em>config</em> where the application runs.
Any runtime properties defined in that file will override the default configuration.</p>
<div data-type="important"><h6>Important</h6>
<p><a data-type="indexterm" data-primary="config/application.properties" id="idm45128528413256"/><em>config/application.properties</em> works in development mode as well, but you need to add it on your build tool output directory to make it work (in case of the Maven, the <em>target</em> directory; in case of Gradle, <em>build</em>), so you need to be aware of the need to re-create it when running the <code>clean</code> task.</p>
</div>

<p>Apart from environment variables and the <em>application.properties</em> file, you can also place a <em>.env</em> file in the current working directory to override configuration values, 
<span class="keep-together">following</span> the environment variables format (<code>GREETING_MESSAGE=Aloha</code>).</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.4 Configuring with Profiles"><div class="sect1" id="idm45128536587976">
<h1>4.4 Configuring with Profiles</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128536586888">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="profiles" id="idm45128528409064"/><a data-type="indexterm" data-primary="profiles, configuring" id="idm45128528408088"/>You want to overwrite configuration values depending on the environment in which you are running Quarkus.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128528406904">
<h2>Solution</h2>

<p>Quarkus supports the notion of configuration profiles.
These allow you to have multiple configuration values for the same property in the same file and enable different values to suit the environment in which you are running the service.</p>

<p>The syntax for configuration profiles is <code>%{profile}.config.key=value</code>.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discuss"><div class="sect2" id="idm45128528404152">
<h2>Discuss</h2>

<p><a data-type="indexterm" data-primary="built-in profiles" id="idm45128528402712"/><a data-type="indexterm" data-primary="dev profile" id="idm45128528385496"/><a data-type="indexterm" data-primary="prod profile" id="idm45128528384824"/><a data-type="indexterm" data-primary="test profile" id="idm45128528384152"/>Quarkus comes with three built-in profiles.</p>
<dl>
<dt>dev</dt>
<dd>
<p>Activated when in development mode (i.e., <code>quarkus:dev</code>).</p>
</dd>
<dt>test</dt>
<dd>
<p>Activated when running tests.</p>
</dd>
<dt>prod</dt>
<dd>
<p>The default profile when not running in development or test mode; you don’t need to set it in <em>application.properties</em>, as it is implicitly set.</p>
</dd>
</dl>

<p>Open <em>src/main/resources/application.properties</em> file and set to start Quarkus at port 8181 in development mode:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">%dev.quarkus.http.port</code><code class="o">=</code><code class="s">8181</code></pre>

<p>After this change, start the service to again check that the listening port is 8181 instead of the default one (8080):</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw compile quarkus:dev</code>

<code class="go">INFO  [io.qua.dep.QuarkusAugmentor] (main) Beginning quarkus augmentation</code>
<code class="go">INFO  [io.qua.dep.QuarkusAugmentor] (main) Quarkus augmentation completed</code>
<code class="go">    in 671ms</code>
<code class="go">INFO  [io.quarkus] (main) Quarkus 1.4.1 started in 1.385s. Listening on:</code>
<code class="go">    http://0.0.0.0:8181</code>
<code class="go">INFO  [io.quarkus] (main) Profile dev activated. Live Coding activated.</code>
<code class="go">INFO  [io.quarkus] (main) Installed features:</code>
<code class="go">    [cdi, hibernate-validator, resteasy]</code></pre>

<p>Notice that now the listening address is 
<span class="orm-hideurl"><a href="http://0.0.0.0:8181"><em class="hyperlink">http://0.0.0.0:8181</em></a></span> instead of the default one.</p>

<p>Finally, rollback to 8080 port, remove <code>%dev.quarkus.http.port=8181</code> line in <em>application.properties</em> to align with the port that is used in the rest of the book.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.5 Changing Logger Configuration"><div class="sect1" id="idm45128528349704">
<h1>4.5 Changing Logger Configuration</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128528348696">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="changing logger configuration" id="idm45128528347496"/><a data-type="indexterm" data-primary="logging" data-secondary="changing configuration" id="idm45128528345736"/>You want to change the default logging configuration.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128528344344">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="unified configuration model" id="idm45128528342776"/><a data-type="indexterm" data-primary="application.properties file" id="idm45128528342056"/>Quarkus uses a unified configuration model in which all configuration properties are placed in the same file.
In the case of Quarkus, this file is <em>application.properties</em>, and you can configure many aspects of logging there.</p>

<p>For example, if you want to change the logging level, you just set <code>quarkus.log.level</code> to the minimum log level.</p>
<div style="page-break-after: always;"/>

<p>Open <em>src/main/resources/application.properties</em> and add the following content:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.log.level</code><code class="o">=</code><code class="s">DEBUG</code></pre>

<p>Now start the application to see that a lot of new logging messages are printed in the console:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw compile quarkus:dev</code>

<code class="go">...</code>
<code class="go">[INFO] --- quarkus-maven-plugin:0.22.0:dev (default-cli) @ getting-started ---</code>
<code class="go">Listening for transport dt_socket at address: 5005</code>
<code class="go">DEBUG [org.jbo.logging] (main) Logging Provider: \</code>
<code class="go">    org.jboss.logging.JBossLogManagerProvider</code>
<code class="go">INFO  [io.qua.dep.QuarkusAugmentor] (main) Beginning quarkus augmentation</code>
<code class="go">DEBUG [io.qua.run.con.ConverterSupport] (main) Populate SmallRye config builder</code>
<code class="go">    with converter for class java.net.InetSocketAddress of priority 200</code>
<code class="go">DEBUG [io.qua.run.con.ConverterSupport] (main) Populate SmallRye config builder</code>
<code class="go">    with converter for class org.wildfly.common.net.CidrAddress of priority 200</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>We had to span multiple lines for formatting in the book; we have used the backslash to indicate this.</p>
</div>

<p><a data-type="indexterm" data-primary="target directory" id="idm45128528277000"/>You can also enable storing logs in a file by using <code>quarkus.log.file.enable</code> property.
The output is written by default to a file named <em>quarkus.log</em>:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.log.file.enable</code><code class="o">=</code><code class="s">true</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>While you are in development and working out of the source directory, your logging file will be in <em>target</em> directory.</p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.6 Adding Application Logs"><div class="sect1" id="idm45128528243320">
<h1>4.6 Adding Application Logs</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128528223752">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="application logs" id="idm45128528222520"/><a data-type="indexterm" data-primary="configuration" data-secondary="adding application logs" id="idm45128528221816"/>You want to add log lines to your application.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128528220424">
<h2>Solution</h2>

<p>Most of the time, your applications need to write their own logging messages and not rely solely on the default logs provided by Quarkus.
Applications may use any of the supported APIs for logging, and the logs will be merged.</p>
<div style="page-break-after: always;"/>

<p><a data-type="indexterm" data-primary="logging" data-secondary="libraries for" id="idm45128528241368"/><a data-type="indexterm" data-primary="JDK java.util.logging" id="idm45128528240392"/><a data-type="indexterm" data-primary="JBoss" id="idm45128528239720"/><a data-type="indexterm" data-primary="SLF4J" id="idm45128528239048"/><a data-type="indexterm" data-primary="Apache Commons Logging" id="idm45128528238376"/>Quarkus supports these logging libraries:</p>

<ul>
<li>
<p>JDK java.util.logging</p>
</li>
<li>
<p>JBoss logging</p>
</li>
<li>
<p>SLF4J</p>
</li>
<li>
<p>Apache Commons Logging</p>
</li>
</ul>

<p>Let’s see how to use <code>JBoss Logging</code> to log content.
Open <code>org.acme.quickstart.GreetingResource.java</code> and log a message when an special endpoint is called:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kd">private</code><code> </code><code class="kd">static</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">jboss</code><code class="o">.</code><code class="na">logging</code><code class="o">.</code><code class="na">Logger</code><code> </code><code class="n">logger</code><code> </code><code class="o">=</code><code>
</code><code>                </code><code class="n">org</code><code class="o">.</code><code class="na">jboss</code><code class="o">.</code><code class="na">logging</code><code class="o">.</code><code class="na">Logger</code><code class="o">.</code><code class="na">getLogger</code><code class="o">(</code><code class="n">GreetingResource</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO5-1" href="#callout_configuration_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/log"</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO5-2" href="#callout_configuration_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">helloLog</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">logger</code><code class="o">.</code><code class="na">info</code><code class="o">(</code><code class="s">"I said Hello"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO5-3" href="#callout_configuration_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="s">"hello"</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO5-1" href="#co_configuration_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Creates the logger instance</p></dd>
<dt><a class="co" id="callout_configuration_CO5-2" href="#co_configuration_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Endpoint subpath is <em>/log</em></p></dd>
<dt><a class="co" id="callout_configuration_CO5-3" href="#co_configuration_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Logs at <code>info</code> level</p></dd>
</dl>

<p>Now start the application:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw compile quarkus:dev</code></pre>

<p>In a new terminal, window make a request to <code>/hello/log</code>:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello/log</code></pre>

<p>If you inspect the terminal where you started Quarkus, you’ll see the next logline:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">INFO  [org.acm.qui.GreetingResource] (executor-thread-1) I said Hello</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128528219832">
<h2>Discussion</h2>

<p>Logging is done on a per-category basis.
A configuration that applies to a category also applies to all subcategories of that category, unless there is a more specific matching subcategory configuration.</p>

<p><a data-type="indexterm" data-primary="class location" id="idm45128528085128"/>Categories are represented by class location (i.e., the package, or subpackages, 
<span class="keep-together">where they</span> are defined).
For example, if you want to set Undertow security logging 
<span class="keep-together">to trace level,</span> you need to set the
<code>quarkus.log.category."io.undertow.request.security".level=TRACE</code>
property in <em>application.properties</em>.</p>

<p>Following the previous example, let’s restrict log lines from classes residing in <code>org.acme.quickstart</code> (and subclasses) so the minimum log level is <code>WARNING</code>:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.log.category."org.acme.quickstart".level</code><code class="o">=</code><code class="s">WARNING </code><a class="co" id="co_configuration_CO6-1" href="#callout_configuration_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO6-1" href="#co_configuration_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="double quotes" id="idm45128528045080"/>Double quotes are mandatory to set the category</p></dd>
</dl>

<p>If you repeat the request to 
<span class="orm-hideurl"><a href="http://localhost:8080/hello/log"><em class="hyperlink">http://localhost:8080/hello/log</em></a></span>, logline is no longer written down.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.7 Advanced Logging"><div class="sect1" id="idm45128528042120">
<h1>4.7 Advanced Logging</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128528040968">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="advanced logging" id="con_adv"/><a data-type="indexterm" data-primary="logging" data-secondary="advanced" id="log_adv"/>You want to centrally log all your services.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128527987736">
<h2>Solution</h2>

<p>When working with microservice architectures and Kubernetes, logging is an important thing to take into consideration because each service is logging individually; but as a developer or operator, you might want to have all the logs centralized in one place so they can be consumed as a whole.</p>

<p><a data-type="indexterm" data-primary="JSON" id="idm45128527985608"/><a data-type="indexterm" data-primary="GELF (Graylog extended log format)" id="idm45128527985000"/>Quarkus logging also supports JSON and GELF output.</p>

<p>These logs can be written in JSON format instead of plain text for machine processing by registering the <code>logging-json</code> extension:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="logging-json"</code></pre>

<p>Use the GELF extension to produce logs in GELF format and send them using either TCP or UDP.</p>

<p><em>Graylog extended log format</em> (GELF) is understood by three of the most centralized logs systems that are used nowadays<a data-type="indexterm" data-primary="EFK (Elasticsearch, Fluentf, Kibana)" id="idm45128527960120"/><a data-type="indexterm" data-primary="MongoDB" data-secondary="about" id="idm45128527959512"/><a data-type="indexterm" data-primary="Elasticsearch" id="idm45128527958600"/><a data-type="indexterm" data-primary="ELK (Elasticsearch, Logstash, Kibana)" id="idm45128527982568"/><a data-type="indexterm" data-primary="Fluentd" id="idm45128527981928"/><a data-type="indexterm" data-primary="Kibana" id="idm45128527981256"/><a data-type="indexterm" data-primary="Logstash" id="idm45128527980584"/>:</p>

<ul>
<li>
<p>Graylog (MongoDB, Elasticsearch, Graylog)</p>
</li>
<li>
<p>ELK (Elasticsearch, Logstash, Kibana)</p>
</li>
<li>
<p>EFK (Elasticsearch, Fluentd, Kibana)</p>
</li>
</ul>

<p><a data-type="indexterm" data-primary="logging-gelf extension" id="idm45128527974872"/>To start logging in GELF format, all you need to do is add the <code>logging-gelf</code> 
<span class="keep-together">extension:</span></p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="logging-gelf"</code></pre>

<p>Logging code is not changing, so the same interfaces are used:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kd">private</code><code> </code><code class="kd">static</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">jboss</code><code class="o">.</code><code class="na">logging</code><code class="o">.</code><code class="na">Logger</code><code> </code><code class="n">logger</code><code> </code><code class="o">=</code><code>
</code><code>                </code><code class="n">org</code><code class="o">.</code><code class="na">jboss</code><code class="o">.</code><code class="na">logging</code><code class="o">.</code><code class="na">Logger</code><code class="o">.</code><code class="na">getLogger</code><code class="o">(</code><code class="n">GreetingResource</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO7-1" href="#callout_configuration_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/log"</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO7-2" href="#callout_configuration_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">helloLog</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">logger</code><code class="o">.</code><code class="na">info</code><code class="o">(</code><code class="s">"I said Hello"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO7-3" href="#callout_configuration_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="s">"hello"</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO7-1" href="#co_configuration_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Creates the logger instance</p></dd>
<dt><a class="co" id="callout_configuration_CO7-2" href="#co_configuration_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Endpoint subpath is <em>/log</em></p></dd>
<dt><a class="co" id="callout_configuration_CO7-3" href="#co_configuration_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Logs at <code>info</code> level</p></dd>
</dl>

<p>The GELF handler must be configured in <em>application.properties</em>:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.log.handler.gelf.enabled</code><code class="o">=</code><code class="s">true </code><a class="co" id="co_configuration_CO8-1" href="#callout_configuration_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="na">quarkus.log.handler.gelf.host</code><code class="o">=</code><code class="s">localhost </code><a class="co" id="co_configuration_CO8-2" href="#callout_configuration_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="na">quarkus.log.handler.gelf.port</code><code class="o">=</code><code class="s">12201 </code><a class="co" id="co_configuration_CO8-3" href="#callout_configuration_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO8-1" href="#co_configuration_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Enables extension</p></dd>
<dt><a class="co" id="callout_configuration_CO8-2" href="#co_configuration_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Sets host where log messages are sent</p></dd>
<dt><a class="co" id="callout_configuration_CO8-3" href="#co_configuration_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Sets the endpoint port</p></dd>
</dl>
<div data-type="important"><h6>Important</h6>
<p>If you are using Logstash (ELK), you need to enable the Input plug-in that understands the GELF format:</p>

<pre data-type="programlisting">input {
  gelf {
    port =&gt; 12201
  }
}
output {
  stdout {}
  elasticsearch {
    hosts =&gt; ["http://elasticsearch:9200"]
  }
}</pre>
</div>
<div data-type="important"><h6>Important</h6>
<p>If you are using Fluentd (EFK), you need to enable the Input plug-in that understands the GELF format:</p>

<pre data-type="programlisting">&lt;source&gt;
  type gelf
  tag example.gelf
  bind 0.0.0.0
  port 12201
&lt;/source&gt;

&lt;match example.gelf&gt;
  @type elasticsearch
  host elasticsearch
  port 9200
  logstash_format true
&lt;/match&gt;</pre>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128527987144">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="Syslog format" id="idm45128527774456"/>Quarkus logging also supports syslog format by default without the requirement of adding any extension.
Syslog format can be used in Fluentd as an alternative to GELF format in Quarkus:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.log.syslog.enable</code><code class="o">=</code><code class="s">true</code>
<code class="na">quarkus.log.syslog.endpoint</code><code class="o">=</code><code class="s">localhost:5140</code>
<code class="na">quarkus.log.syslog.protocol</code><code class="o">=</code><code class="s">udp</code>
<code class="na">quarkus.log.syslog.app-name</code><code class="o">=</code><code class="s">quarkus</code>
<code class="na">quarkus.log.syslog.hostname</code><code class="o">=</code><code class="s">quarkus-test</code></pre>
<div data-type="important"><h6>Important</h6>
<p>You need to enable the Input plug-in that understands the syslog format in Fluentd:</p>

<pre data-type="programlisting">&lt;source&gt;
  @type syslog
  port 5140
  bind 0.0.0.0
  message_format rfc5424
  tag system
&lt;/source&gt;

&lt;match **&gt;
  @type elasticsearch
  host elasticsearch
  port 9200
  logstash_format true
&lt;/match&gt;</pre>
</div>

<p>If you are using Kubernetes, the simplest way to log is to log to the console and install into the cluster a central log manager that collects all log lines.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128527760056">
<h2>See Also</h2>

<p>To learn more about advanced logging topics, visit the following website:<a data-type="indexterm" data-primary="" data-startref="con_adv" id="idm45128527758840"/><a data-type="indexterm" data-primary="" data-startref="log_adv" id="idm45128527757864"/></p>

<ul>
<li>
<p><a href="https://oreil.ly/Mj9Ha">Logstash/Gelf Loggers</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.8 Configuring with Custom Profiles"><div class="sect1" id="idm45128527754952">
<h1>4.8 Configuring with Custom Profiles</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128527753944">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="with custom profiles" id="idm45128527752744"/><a data-type="indexterm" data-primary="custom profiles, configuring with" id="idm45128527751768"/>You want to set different configuration values for the custom profiles you’ve created.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128527750632">
<h2>Solution</h2>

<p>So far, you’ve seen that Quarkus comes with built-in profiles so that you can set different configuration values for the same property and enable them to suit the environment.
But with Quarkus, you can also set your own profiles.</p>

<p>The only thing you need to do is specify which profile you want to enable by either using the <code>quarkus.profile</code> system property or the <code>QUARKUS_PROFILE</code> environment variable.
If both are set, the system property takes precedence over the environment 
<span class="keep-together">variable</span>.</p>

<p>Then the only thing you need to do is create the property with the profile name and set the current profile to that name.
Let’s create a new <em>staging</em> profile that overwrites the listening port of Quarkus.</p>

<p>Open <em>src/main/resources/application.properties</em> file and set to start Quarkus at port 8182 when the <code>staging</code> profile is enabled:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">%staging.quarkus.http.port</code><code class="o">=</code><code class="s">8182</code></pre>

<p>Then start the application with <code>staging</code> profile enabled:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw -Dquarkus.profile=staging compile quarkus:dev</code>

<code class="go">INFO  [io.qua.dep.QuarkusAugmentor] (main) Beginning quarkus augmentation</code>
<code class="go">INFO  [io.qua.dep.QuarkusAugmentor] (main) Quarkus augmentation completed</code>
<code class="go">    in 640ms</code>
<code class="go">INFO  [io.quarkus] (main) Quarkus 0.23.2 started in 1.300s. Listening on:</code>
<code class="go">    http://0.0.0.0:8182</code>
<code class="go">INFO  [io.quarkus] (main) Profile staging activated. Live Coding activated.</code>
<code class="go">INFO  [io.quarkus] (main) Installed features: [cdi, hibernate-validator,</code>
<code class="go">    resteasy]</code></pre>

<p>In this case, the system property approach is used, but you could also set it using the <code>QUARKUS_PROFILE</code> environment variable.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128527702728">
<h2>Discussion</h2>

<p>If you want to set the running profile in tests, you only need to set the <code>quarkus.test.profile</code> system property to the given profile in your build script—for example, in Maven:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="nt">&lt;groupId&gt;</code>org.apache.maven.plugins<code class="nt">&lt;/groupId&gt;</code>
<code class="nt">&lt;artifactId&gt;</code>maven-surefire-plugin<code class="nt">&lt;/artifactId&gt;</code>
<code class="nt">&lt;version&gt;</code>${surefire-plugin.version}<code class="nt">&lt;/version&gt;</code>
<code class="nt">&lt;configuration&gt;</code>
    <code class="nt">&lt;systemPropertyVariables&gt;</code>
        <code class="nt">&lt;quarkus.test.profile&gt;</code>foo<code class="nt">&lt;/quarkus.test.profile&gt;</code>
        <code class="nt">&lt;buildDirectory&gt;</code>${project.build.directory}<code class="nt">&lt;/buildDirectory&gt;</code>
    <code class="nt">&lt;/systemPropertyVariables&gt;</code>
<code class="nt">&lt;/configuration&gt;</code></pre>

<p>or, in Gradle:</p>

<pre data-type="programlisting" data-code-language="groovy"><code class="n">test</code> <code class="o">{</code>
    <code class="n">useJUnitPlatform</code><code class="o">()</code>
    <code class="n">systemProperty</code> <code class="s2">"quarkus.test.profile"</code><code class="o">,</code> <code class="s2">"foo"</code>
<code class="o">}</code></pre>

<p>Also, you can change the default production profile.
The built-in profile in Quarkus is <code>prod</code>, so when you are running your application without any profile, this is the default one where the values are taken.
But you can change that at build time so that, without specifying any profile, your profile is the default one when the application is running.</p>

<p>The only thing you need to do is build the application using the <code>quarkus.profile</code> system property with the profile value you want set as the default:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw package -Pnative -Dquarkus.profile=prod-kubernetes`
</code><code class="go">./target/getting-started-1.0-runner </code><a class="co" id="co_configuration_CO9-1" href="#callout_configuration_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO9-1" href="#co_configuration_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="prod-kubernetes profile" id="idm45128527608408"/>The command will run with the <code>prod-kubernetes</code> profile enabled by default</p></dd>
</dl>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.9 Creating Custom Sources"><div class="sect1" id="idm45128527606808">
<h1>4.9 Creating Custom Sources</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128527605832">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="creating custom sources" id="idm45128527604600"/><a data-type="indexterm" data-primary="custom sources" id="idm45128527603624"/>You want to load configuration parameters from any other source instead of/apart from <em>application.properties</em> file.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128527602184">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="Eclipse MicroProfile Configuration" id="idm45128527600552"/>Quarkus uses the Eclipse MicroProfile Configuration spec to implement all the logic regarding configuration.
The specification offers
<code>o⁠r⁠g⁠.⁠e⁠c⁠l⁠i⁠p⁠s⁠e⁠.⁠m⁠i⁠c⁠r⁠o⁠p⁠r⁠o⁠f⁠i⁠l⁠e​.⁠c⁠o⁠n⁠f⁠i⁠g⁠.⁠s⁠p⁠i⁠.⁠C⁠o⁠n⁠f⁠i⁠g⁠S⁠o⁠u⁠r⁠c⁠e</code>
<a href="https://oreil.ly/o0A51">Java SPI</a> interface to implement a 
<span class="keep-together">custom</span> way to load configuration properties instead of/apart from the default one 
<span class="keep-together">provided</span> by Quarkus.</p>

<p>For example, you could load configuration properties from a database, an XML file, or a REST API.</p>

<p><a data-type="indexterm" data-primary="in-memory config source" id="idm45128527548376"/>Let’s create a simple <em>in-memory config source</em> that gets configuration properties from <code>Map</code> populated at instantiation time.
Create a new class called <code>org.acme.quickstart.InMemoryConfigSource.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.HashMap</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Map</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.config.spi.ConfigSource</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">InMemoryConfigSource</code><code> </code><code class="kd">implements</code><code> </code><code class="n">ConfigSource</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">prop</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="nf">InMemoryConfigSource</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_configuration_CO10-1" href="#callout_configuration_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">prop</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"greeting.color"</code><code class="o">,</code><code> </code><code class="s">"red"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="nf">getOrdinal</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_configuration_CO10-2" href="#callout_configuration_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="mi">500</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">getProperties</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_configuration_CO10-3" href="#callout_configuration_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">prop</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getValue</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">propertyName</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_configuration_CO10-4" href="#callout_configuration_CO10-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">prop</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">propertyName</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getName</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_configuration_CO10-5" href="#callout_configuration_CO10-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="s">"MemoryConfigSource"</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO10-1" href="#co_configuration_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Populates map with a property</p></dd>
<dt><a class="co" id="callout_configuration_CO10-2" href="#co_configuration_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Used to determine the importance of the values; the highest ordinal takes precedence over the lower-priority ordinal</p></dd>
<dt><a class="co" id="callout_configuration_CO10-3" href="#co_configuration_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Gets all properties as <code>Map</code>; in this case it is direct</p></dd>
<dt><a class="co" id="callout_configuration_CO10-4" href="#co_configuration_CO10-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Gets the value for a single property</p></dd>
<dt><a class="co" id="callout_configuration_CO10-5" href="#co_configuration_CO10-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Returns the name of this config source</p></dd>
</dl>

<p>Then you need to register this as a Java SPI.
Create the <em>services</em> folder at <em>src/main/resources/META-INF</em>.
Next, create a file inside <em>services</em> named <em>org.eclipse.microprofile.config.spi.ConfigSource</em> with the following content:</p>

<pre data-type="programlisting">org.acme.quickstart.InMemoryConfigSource</pre>

<p>Finally, you can modify the <code>org.acme.quickstart.GreetingResource.java</code> class to inject this property:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ConfigProperty</code><code class="o">(</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s">"greeting.color"</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO11-1" href="#callout_configuration_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">String</code><code> </code><code class="n">color</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/color"</code><code class="o">)</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">color</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">color</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO11-1" href="#co_configuration_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Inject the value of the property defined in the <code>InMemoryConfigSource</code></p></dd>
</dl>

<p>And in a terminal window make a request to <code>/hello/color</code> to see that the output message is the configured value in the custom source:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello/color</code>

<code class="go">red</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128527601528">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="ConfigSource" id="idm45128527274760"/>Each <code>ConfigSource</code> has a specified ordinal, which is used to set the importance of the values taken from the <code>ConfigSource</code> in the case of multiple config sources defined for the same application.
A higher ordinal <code>ConfigSource</code> is used over a <code>ConfigSource</code> with a lower value.
Using the defaults in the following list as a reference, a system property will be used over everything, and the <em>application.properties</em> file in the <em>src/main/resources</em> directory will be used if no other <code>ConfigSources</code> are found:</p>

<ul>
<li>
<p>System properties to 400</p>
</li>
<li>
<p>Environment variables to 300</p>
</li>
</ul>
<div style="page-break-after: always;"/>

<ul>
<li>
<p><em>application.properties</em> at <em>config</em> directory to 260</p>
</li>
<li>
<p><em>application.properties</em> at project to 250</p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.10 Creating Custom Converters"><div class="sect1" id="idm45128527237784">
<h1>4.10 Creating Custom Converters</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128527236856">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="creating custom converters" id="con_ccc"/><a data-type="indexterm" data-primary="custom converters" id="cc_ab"/>You want to implement a custom converter.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128527233112">
<h2>Solution</h2>

<p>You can convert a property from <code>String</code> to any kind of object by implementing the <code>org.eclipse.microprofile.config.spi.Converter</code> Java SPI.</p>

<p><a data-type="indexterm" data-primary="Eclipse MicroProfile Configuration" id="idm45128527230296"/>Quarkus uses the Eclipse MicroProfile Configuration spec to implement all the logic regarding configuration.
The specification offers the <code>org.eclipse.microprofile.config.spi.Converter</code> <a href="https://oreil.ly/kcqQw">Java SPI</a> interface to implement the conversion of configuration values to a custom type.</p>

<p><a data-type="indexterm" data-primary="percentage values, transforming" id="idm45128527227912"/>For example, you could transform a percentage value (i.e., 15%) to a <code>Percentage</code> type, wrapping the percentage as <code>double</code> type.</p>

<p>Create a new POJO class <code>org.acme.quickstart.Percentage.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Percentage</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kt">double</code> <code class="n">percentage</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">Percentage</code><code class="o">(</code><code class="kt">double</code> <code class="n">percentage</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">percentage</code> <code class="o">=</code> <code class="n">percentage</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getPercentage</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">percentage</code><code class="o">;</code>
    <code class="o">}</code>

<code class="o">}</code></pre>

<p>And then create a class <code>org.acme.quickstart.PercentageConverter.java</code> that converts from <code>String</code> representation to <code>Percentage</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.annotation.Priority</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.config.spi.Converter</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Priority</code><code class="o">(</code><code class="mi">300</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO12-1" href="#callout_configuration_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">PercentageConverter</code><code> </code><code class="kd">implements</code><code> </code><code class="n">Converter</code><code class="o">&lt;</code><code class="n">Percentage</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_configuration_CO12-2" href="#callout_configuration_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">Percentage</code><code> </code><code class="nf">convert</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">value</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>        </code><code class="n">String</code><code> </code><code class="n">numeric</code><code> </code><code class="o">=</code><code> </code><code class="n">value</code><code class="o">.</code><code class="na">substring</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code><code> </code><code class="n">value</code><code class="o">.</code><code class="na">length</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="k">new</code><code> </code><code class="nf">Percentage</code><code> </code><code class="o">(</code><code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="n">numeric</code><code class="o">)</code><code> </code><code class="o">/</code><code> </code><code class="mi">100</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO12-1" href="#co_configuration_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets the priority; in this specific case it might be optional</p></dd>
<dt><a class="co" id="callout_configuration_CO12-2" href="#co_configuration_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Generic type that sets the type to convert to</p></dd>
</dl>

<p>Then you need to register this as a Java SPI.
Create the <em>services</em> folder at <em>src/main/resources/META-INF</em>.
Next, create a file inside the <em>services</em> folder named 
<span class="keep-together"><em>org.eclipse.microprofile.config.spi.Converter</em></span> with the following content:</p>

<pre data-type="programlisting">org.acme.quickstart.PercentageConverter</pre>

<p>Then, you can modify the <code>org.acme.quickstart.GreetingResource.java</code> class to inject this property:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ConfigProperty</code><code class="o">(</code><code class="n">name</code> <code class="o">=</code> <code class="s">"greeting.vat"</code><code class="o">)</code>
<code class="n">Percentage</code> <code class="n">vat</code><code class="o">;</code>

<code class="nd">@GET</code>
<code class="nd">@Path</code><code class="o">(</code><code class="s">"/vat"</code><code class="o">)</code>
<code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code>
<code class="kd">public</code> <code class="n">String</code> <code class="nf">vat</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">Double</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="n">vat</code><code class="o">.</code><code class="na">getPercentage</code><code class="o">());</code>
<code class="o">}</code></pre>

<p>Lastly, you will need to add a new property into the <em>application.properties</em> file in your <em>src/main/resources</em> directory:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">greeting.vat</code> <code class="o">=</code> <code class="s">21%</code></pre>

<p>And in a terminal window, make a request to <code>/hello/vat</code> to see that the output message is the transformed vat as double:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello/vat</code>

<code class="go">0.21</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128527232520">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="@Priority annotation" id="idm45128526958856"/>By default, if no <code>@Priority</code> annotation can be found on a converter, it is registered with a priority of 100.
Quarkus converters are registered with a priority of 200, so if you want to replace a Quarkus converter, you should use a higher value; if you don’t need to replace a Quarkus converter, then the default one is perfectly fine.</p>

<p><a data-type="indexterm" data-primary="" data-startref="con_ccc" id="idm45128526957000"/><a data-type="indexterm" data-primary="" data-startref="cc_ab" id="idm45128526933736"/>A list of Quarkus core converters has been shown in <a data-type="xref" href="#config-app-with-cust-properties">Recipe 4.1</a>.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.11 Grouping Configuration Values"><div class="sect1" id="idm45128526931448">
<h1>4.11 Grouping Configuration Values</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128526930440">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="grouping values" id="idm45128526929240"/><a data-type="indexterm" data-primary="values" data-secondary="grouping configuration" id="idm45128526928264"/>You want to avoid setting the common prefix of a configuration property over and over again.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128526952616">
<h2>Solution</h2>

<p>You can group common properties (those with the same prefix) using the <code>@⁠i⁠o​.⁠q⁠u⁠a⁠r⁠k⁠u⁠s⁠.⁠a⁠r⁠c⁠.⁠c⁠o⁠n⁠f⁠i⁠g⁠.⁠C⁠o⁠n⁠f⁠i⁠g⁠P⁠r⁠o⁠p⁠e⁠r⁠t⁠i⁠e⁠s</code> annotation.</p>

<p><a data-type="indexterm" data-primary="@ConfigProperty annotation" id="idm45128526950040"/>When you are creating ad hoc configuration properties in your application, typically these properties will have the same prefix (i.e., <code>greetings</code>).
To inject all these properties, you can use the <code>@ConfigProperty</code> annotation (as shown in <a data-type="xref" href="#config-app-with-cust-properties">Recipe 4.1</a>), or 
<span class="keep-together">you can</span> use the <code>io.quarkus.arc.config.ConfigProperties</code> annotation to group 
<span class="keep-together">properties</span> together.</p>

<p>Using the <em>application.properties</em> file:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">greeting.message</code><code class="o">=</code><code class="s">Hello World</code>
<code class="na">greeting.suffix</code><code class="o">=</code><code class="s">!!, How are you???</code></pre>

<p>let’s implement a class that maps the configuration properties into Java objects using the <code>io.quarkus.arc.config.ConfigProperties</code> annotation.
Create a new class <code>org.acme.quickstart.GreetingConfiguration.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.List</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Optional</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.constraints.Max</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.constraints.Min</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.arc.config.ConfigProperties</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@ConfigProperties</code><code class="o">(</code><code class="n">prefix</code><code> </code><code class="o">=</code><code> </code><code class="s">"greeting"</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO13-1" href="#callout_configuration_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingConfiguration</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="n">message</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO13-2" href="#callout_configuration_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="n">suffix</code><code> </code><code class="o">=</code><code> </code><code class="s">"!"</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO13-3" href="#callout_configuration_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO13-1" href="#co_configuration_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets this as a configuration POJO with a common prefix</p></dd>
<dt><a class="co" id="callout_configuration_CO13-2" href="#co_configuration_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Maps the <code>greeting.message</code> property</p></dd>
<dt><a class="co" id="callout_configuration_CO13-3" href="#co_configuration_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The default value for <code>greeting.suffix</code> in case the property is not set</p></dd>
</dl>

<p>One of the important things to notice in the preceding code is that the <code>prefix</code> attribute is not mandatory.
If it is not set, then the prefix to be used will be determined by the class name (removing the suffix part <code>Configuration</code>).
In this case, the <code>prefix</code> attribute could be auto-resolved to <code>greeting</code>.</p>

<p>Then you can inject this configuration POJO to start consuming the configuration values.</p>

<p>You can modify the <code>org.acme.quickstart.GreetingResource.java</code> class to inject this class:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Inject</code><code> </code><a class="co" id="co_configuration_CO14-1" href="#callout_configuration_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">GreetingConfiguration</code><code> </code><code class="n">greetingConfiguration</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/configurations"</code><code class="o">)</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">helloConfigurations</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">greetingConfiguration</code><code class="o">.</code><code class="na">message</code><code> </code><code class="o">+</code><code> </code><code class="n">greetingConfiguration</code><code class="o">.</code><code class="na">suffix</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO14-1" href="#co_configuration_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The configuration is injected with the CDI <code>@Inject</code> annotation</p></dd>
</dl>

<p>And in a terminal window make a request to <code>/hello/configurations</code> to see that the configuration values are populated inside Java, for instance:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello/configurations</code>

<code class="go">Hello World!!, How are you???</code></pre>

<p>As you can now see, you don’t need to annotate every field by using <code>@ConfigProperty</code>—you just leverage the class definition to get the property name or the default value.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128526952024">
<h2>Discussion</h2>

<p>Furthermore, Quarkus supports nested object configuration so that you can also map subcategories by using inner classes.</p>

<p>Suppose we add a new property named <code>greeting.output.recipients</code> in 
<span class="keep-together"><em>application.properties</em>:</span></p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">greeting.output.recipients</code><code class="o">=</code><code class="s">Ada,Alexandra</code></pre>

<p>You could use an inner class to map it into the configuration object.
Modify the class <code>org.acme.quickstart.GreetingConfiguration.java</code>. Then add a new inner class representing the subcategory <code>output</code> and register it as a field:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code><code> </code><code class="n">OutputConfiguration</code><code> </code><code class="n">output</code><code class="o">;</code><code> </code><a class="co" id="co_configuration_CO15-1" href="#callout_configuration_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kd">class</code><code> </code><code class="nc">OutputConfiguration</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">recipients</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO15-1" href="#co_configuration_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Name of the subcategory is the field name (<code>output</code>)</p></dd>
</dl>

<p>Then you can access the <code>greetingConfiguration.output.recipients</code> field to get the value.
<a data-type="indexterm" data-primary="Bean Validation" data-secondary="annotations" id="idm45128526574232"/>You can also annotate the fields with Bean Validation annotations to validate at start-up time that all configuration values are valid.
If they are not valid, the application will fail to start and will indicate the validation errors in the log.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="4.12 Validating Configuration Values"><div class="sect1" id="idm45128526572744">
<h1>4.12 Validating Configuration Values</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128526571976">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="configuration" data-secondary="validating values" id="idm45128526570968"/><a data-type="indexterm" data-primary="values" data-secondary="validating configuration" id="idm45128526570120"/>You want to validate that configuration values are correct.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128526568888">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="@ConfigProperty annotation" id="idm45128526567448"/><a data-type="indexterm" data-primary="Bean Validation" data-secondary="specification" id="idm45128526566840"/>Use the Bean Validation specification to validate that a property value is valid when it is injected using the <code>@ConfigProperty</code> annotation on a class.</p>

<p><a data-type="indexterm" data-primary="Eclipse MicroProfile Configuration" id="idm45128526565096"/>The Bean Validation spec allows you to set constraints on objects using annotations.
Quarkus integrates the Eclipse MicroProfile Configuration spec with the Bean Validation spec so you can use them together to validate that a configuration value meets certain criteria.
This verification is executed at boot time, and if there is any violation, an error message is shown in the console and the boot process is aborted.</p>

<p><a data-type="indexterm" data-primary="Quarkus Bean Validation dependency" id="idm45128526563672"/>The first thing you need to do is to register the <em>Quarkus Bean Validation</em> dependency.
You can do it manually by editing your <em>pom.xml</em> or by running the next Maven command from the root directory of the project:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="quarkus-hibernate-validator"</code></pre>

<p>After that, you will need to create a configuration object, which you learned about in the previous recipe.
In the next example, a constraint on the <code>greeting.repeat</code> configuration property is set so that repetitions outside of the range 1–3 inclusive cannot be set.</p>

<p>To validate integer range, the following Bean Validation annotations are used: <code>j⁠a⁠v⁠a⁠x​.⁠v⁠a⁠l⁠i⁠d⁠a⁠t⁠i⁠o⁠n⁠.⁠c⁠o⁠n⁠s⁠t⁠r⁠a⁠i⁠n⁠t⁠s⁠.⁠M⁠a⁠x</code> and <code>javax.validation.constraints.Min</code>.
Open <code>org.acme.quickstart.GreetingConfiguration.java</code> and add Bean Validation annotations:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Min</code><code class="o">(</code><code class="mi">1</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO16-1" href="#callout_configuration_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nd">@Max</code><code class="o">(</code><code class="mi">3</code><code class="o">)</code><code> </code><a class="co" id="co_configuration_CO16-2" href="#callout_configuration_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="n">Integer</code><code> </code><code class="n">repeat</code><code class="o">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_configuration_CO16-1" href="#co_configuration_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Min value accepted</p></dd>
<dt><a class="co" id="callout_configuration_CO16-2" href="#co_configuration_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Max value accepted</p></dd>
</dl>

<p>Open <em>src/main/resources/application.properties</em> file and set the <code>greeting.repeat</code> configuration property to 7:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">greeting.repeat</code><code class="o">=</code><code class="s">7</code></pre>

<p>Start the application, and you’ll see an error message notifying that a configuration value is violating one of the defined constraints:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw compile quarkus:dev</pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128526568296">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="" data-startref="con_ch" id="idm45128526487576"/>In this example, you’ve seen a brief introduction to Bean Validation specification, as well as some annotations you can use to validate fields. However, more constraints are supported by Hibernate Validation and the Bean Validation implementation used, such as <code>@Digits</code>, <code>@Email</code>, <code>@NotNull</code>, and <code>@NotBlank</code>.</p>
</div></section>





</div></section>







</div></section></div>



  </body></html>