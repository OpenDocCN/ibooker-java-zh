<html><head></head><body><section data-pdf-bookmark="Chapter 9. Third-Party Integrations" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch09">&#13;
<h1><span class="label">Chapter 9. </span>Third-Party Integrations</h1>&#13;
&#13;
&#13;
<p>This chapter introduces <a data-primary="third-party technologies" data-secondary="about" data-type="indexterm" id="idm45849699701344"/>different third-party technologies (such as libraries or frameworks) that we can use with Selenium WebDriver. We need to use these technologies when the Selenium WebDriver API is insufficient to carry out specific tasks. This is the case for file downloading, in which we need to use a third-party utility to wait until the files are correctly downloaded or, alternatively, use an HTTP client to control the download. We also capture the HTTP traffic using a third-party proxy.</p>&#13;
&#13;
<p>Another scenario in which we need to use external utilities with Selenium WebDriver is when implementing nonfunctional tests, such as performance, security, accessibility, or A/B testing. We can also use third-party libraries to develop Selenium WebDriver tests using a fluent API, generate fake test data, or improve test reporting. Finally, we can integrate relevant frameworks such as Cucumber for Behavior Driven Development (BDD) or the Spring Framework (for developing web applications). We will go through all of these uses in this chapter.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>To use the <a data-primary="dependency(ies)" data-secondary="for third-party integration" data-secondary-sortas="third-party integration" data-type="indexterm" id="idm45849699698832"/><a data-primary="third-party technologies" data-secondary="dependencies for" data-type="indexterm" id="idm45849699697536"/>third-party utilities presented in this chapter, you must first include the required dependencies in your project. You can find the details for resolving each dependency using Maven and Gradle in <a data-type="xref" href="app03.html#appendix03">Appendix C</a>.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="File Download" data-type="sect1"><div class="sect1" id="idm45849699695392">&#13;
<h1>File Download</h1>&#13;
&#13;
<p>Selenium WebDriver has <a data-primary="file downloading" data-type="indexterm" id="ch9_term1"/><a data-primary="third-party technologies" data-secondary="for file downloading" data-secondary-sortas="file downloading" data-type="indexterm" id="ch9_term2"/>limited support for file downloading because its API does not expose download progress. In other words, we can use Selenium WebDriver to download files from web applications, but we cannot control the required time to copy these files into the local file system. For this reason, we can use third-party <span class="keep-together">libraries</span> to enhance the experience of web downloads with Selenium WebDriver. There are different alternatives to this aim. The following subsections explain how.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Browser-Specific Capabilities" data-type="sect2"><div class="sect2" id="idm45849699690640">&#13;
<h2>Using Browser-Specific Capabilities</h2>&#13;
&#13;
<p>We can use <a data-primary="Chrome" data-secondary="file downloading with Awaitility and" data-type="indexterm" id="ch9_term3"/><a data-primary="target folders, specifying" data-type="indexterm" id="ch9_term4"/><a data-primary="waiting strategies" data-type="indexterm" id="ch9_term5"/><a data-primary="Awaitility" data-type="indexterm" id="ch9_term6"/><a data-primary="third-party technologies" data-secondary="Awaitility" data-type="indexterm" id="ch9_term7"/><a data-primary="browser-specific capabilities" data-secondary="file downloading" data-type="indexterm" id="ch9_term8"/>browser-specific capabilities (as we did in <a data-type="xref" href="ch05.html#ch05">Chapter 5</a>) to configure several parameters for file downloading, such as the target folder. This approach is convenient since these features are available in the Selenium WebDriver API out of the box, but it also has several disadvantages. First, it is incompatible with different browser types (Chrome, Firefox, etc.). In other words, the required capabilities are distinct for individual browsers. Second, and more importantly, we do not have the control to track download progress. To solve this problem, we need to use a third-party library. In this book, I propose using the open source library <a href="http://www.awaitility.org">Awaitility</a>.</p>&#13;
&#13;
<p>Awaitility is a popular library that provides features to handle asynchronous operations. This way, it provides a fluent API for managing threads, timeouts, and concurrency issues. In the case of downloading files with Selenium WebDriver, we use the Awaitility API to wait until the downloaded files are stored in the file system. <a data-type="xref" href="#file-download-1">Example 9-1</a> shows an example using Chrome and Awaitility. <a data-type="xref" href="#file-download-2">Example 9-2</a> shows the equivalent test setup when using Firefox.</p>&#13;
<div data-type="example" id="file-download-1">&#13;
<h5><span class="label">Example 9-1. </span>Test download files using Chrome and Awaitility</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">DownloadChromeJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">File</code><code> </code><code class="n">targetFolder</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">targetFolder</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">"user.home"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="s">"Downloads"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO1-1" id="co_third_party_integrations_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">prefs</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">prefs</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"download.default_directory"</code><code class="o">,</code><code> </code><code class="n">targetFolder</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO1-2" id="co_third_party_integrations_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setExperimentalOption</code><code class="o">(</code><code class="s">"prefs"</code><code class="o">,</code><code> </code><code class="n">prefs</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testDownloadChrome</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>                </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/download.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO1-3" id="co_third_party_integrations_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">xpath</code><code class="o">(</code><code class="s">"(//a)[2]"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO1-4" id="co_third_party_integrations_CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">xpath</code><code class="o">(</code><code class="s">"(//a)[3]"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">ConditionFactory</code><code> </code><code class="n">await</code><code> </code><code class="o">=</code><code> </code><code class="n">Awaitility</code><code class="o">.</code><code class="na">await</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">atMost</code><code class="o">(</code><code class="n">Duration</code><code class="o">.</code><code class="na">ofSeconds</code><code class="o">(</code><code class="mi">5</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO1-5" id="co_third_party_integrations_CO1-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="n">File</code><code> </code><code class="n">wdmLogo</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="n">targetFolder</code><code class="o">,</code><code> </code><code class="s">"webdrivermanager.png"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">await</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">wdmLogo</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO1-6" id="co_third_party_integrations_CO1-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">File</code><code> </code><code class="n">wdmDoc</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="n">targetFolder</code><code class="o">,</code><code> </code><code class="s">"webdrivermanager.pdf"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">await</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">wdmDoc</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO1-7" id="co_third_party_integrations_CO1-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO1-1" id="callout_third_party_integrations_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We specify a folder to save the downloaded files. Nevertheless, you should be aware that Chrome allows only certain directories for download. For example, it allows the download directory (and subfolder) but forbids employing other paths, such as the desktop folder or the home directory.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO1-2" id="callout_third_party_integrations_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We use a Chrome preference to specify the target folder.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO1-3" id="callout_third_party_integrations_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We use a web page available on the practice site to download different files by clicking on buttons (see <a data-type="xref" href="#download-files">Figure 9-1</a>).</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO1-4" id="callout_third_party_integrations_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We click on two of the buttons available on the page. As a result, the browser starts downloading two files: a PNG picture and a PDF document, respectively.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO1-5" id="callout_third_party_integrations_CO1-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We use Awaitility to configure a wait timeout of five seconds.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO1-6" id="callout_third_party_integrations_CO1-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We wait until the first file is in the file system.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO1-7" id="callout_third_party_integrations_CO1-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>We also wait until the second file is <a data-startref="ch9_term3" data-type="indexterm" id="idm45849699340720"/><a data-startref="ch9_term4" data-type="indexterm" id="idm45849699340016"/><a data-startref="ch9_term5" data-type="indexterm" id="idm45849699339344"/><a data-startref="ch9_term6" data-type="indexterm" id="idm45849699338672"/><a data-startref="ch9_term7" data-type="indexterm" id="idm45849699338000"/><a data-primary="Firefox" data-secondary="file downloading with" data-type="indexterm" id="idm45849699337328"/>downloaded.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="file-download-2">&#13;
<h5><span class="label">Example 9-2. </span>Test setup for downloading files using Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">FirefoxOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">FirefoxOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">targetFolder</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="s">"."</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO2-1" id="co_third_party_integrations_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"browser.download.dir"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">targetFolder</code><code class="o">.</code><code class="na">getAbsolutePath</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO2-2" id="co_third_party_integrations_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"browser.download.folderList"</code><code class="o">,</code><code> </code><code class="mi">2</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO2-3" id="co_third_party_integrations_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"browser.helperApps.neverAsk.saveToDisk"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"image/png, application/pdf"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO2-4" id="co_third_party_integrations_CO2-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"pdfjs.disabled"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO2-5" id="co_third_party_integrations_CO2-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO2-1" id="callout_third_party_integrations_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Firefox allows specifying any folder for downloading files. In this case, we use the local project folder.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO2-2" id="callout_third_party_integrations_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We use a Firefox preference to specify a custom download directory.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO2-3" id="callout_third_party_integrations_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We need to set to <code>2</code> the preference <code>browser.download.folderList</code> to select a custom download folder. The other possible values are <code>0</code> to download files into the user desktop and <code>1</code>  to use the download folder (default value).</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO2-4" id="callout_third_party_integrations_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We specify the content types that Firefox will not ask to save in the local file <span class="keep-together">system</span>.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO2-5" id="callout_third_party_integrations_CO2-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We disable the previsualization of PDF files.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="download-files">&#13;
<img alt="hosw 0901" src="assets/hosw_0901.png"/>&#13;
<h6><span class="label">Figure 9-1. </span>Practice web page for downloading file</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using an HTTP Client" data-type="sect2"><div class="sect2" id="idm45849699145008">&#13;
<h2>Using an HTTP Client</h2>&#13;
&#13;
<p>An alternative <a data-startref="ch9_term8" data-type="indexterm" id="idm45849699143648"/><a data-primary="HTTP client library" data-type="indexterm" id="ch9_term9"/><a data-primary="Apache HttpCLient" data-type="indexterm" id="ch9_term10"/><a data-primary="third-party technologies" data-secondary="Apache HttpCLient" data-type="indexterm" id="ch9_term11"/><a data-primary="WebDriverManager" data-secondary="Apache HttpCLient and" data-type="indexterm" id="ch9_term12"/>mechanism to download files with Selenium WebDriver is to use an HTTP client library. I propose using <a href="https://hc.apache.org/httpcomponents-client-5.1.x">Apache HttpClient</a>, since WebDriverManager internally uses this library, and therefore, you can use it as a transitive dependency in your project. <a data-type="xref" href="#file-download-3">Example 9-3</a> shows a complete test case that downloads several files with Apache HttpClient from the practice site. Notice that in this case, it is not necessary to explicitly wait until the file download finishes since Apache HttpClient handles the HTTP responses <span class="keep-together">synchronously</span>.</p>&#13;
<div data-type="example" id="file-download-3">&#13;
<h5><span class="label">Example 9-3. </span>Test download files using an HTTP client</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">DownloadHttpClientJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testDownloadHttpClient</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">IOException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>                </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/download.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO3-1" id="co_third_party_integrations_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">WebElement</code><code> </code><code class="n">pngLink</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">xpath</code><code class="o">(</code><code class="s">"(//a)[2]"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO3-2" id="co_third_party_integrations_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">File</code><code> </code><code class="n">pngFile</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="s">"."</code><code class="o">,</code><code> </code><code class="s">"webdrivermanager.png"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">download</code><code class="o">(</code><code class="n">pngLink</code><code class="o">.</code><code class="na">getAttribute</code><code class="o">(</code><code class="s">"href"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">pngFile</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO3-3" id="co_third_party_integrations_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">pngFile</code><code class="o">)</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">WebElement</code><code> </code><code class="n">pdfLink</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">xpath</code><code class="o">(</code><code class="s">"(//a)[3]"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO3-4" id="co_third_party_integrations_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="n">File</code><code> </code><code class="n">pdfFile</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="s">"."</code><code class="o">,</code><code> </code><code class="s">"webdrivermanager.pdf"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">download</code><code class="o">(</code><code class="n">pdfLink</code><code class="o">.</code><code class="na">getAttribute</code><code class="o">(</code><code class="s">"href"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">pdfFile</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">pdfFile</code><code class="o">)</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">download</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">link</code><code class="o">,</code><code> </code><code class="n">File</code><code> </code><code class="n">destination</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">IOException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="k">try</code><code> </code><code class="o">(</code><code class="n">CloseableHttpClient</code><code> </code><code class="n">client</code><code> </code><code class="o">=</code><code> </code><code class="n">HttpClientBuilder</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_third_party_integrations_CO3-5" id="co_third_party_integrations_CO3-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>            </code><code class="n">HttpUriRequestBase</code><code> </code><code class="n">request</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HttpGet</code><code class="o">(</code><code class="n">link</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="k">try</code><code> </code><code class="o">(</code><code class="n">CloseableHttpResponse</code><code> </code><code class="n">response</code><code> </code><code class="o">=</code><code> </code><code class="n">client</code><code class="o">.</code><code class="na">execute</code><code class="o">(</code><code class="n">request</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_third_party_integrations_CO3-6" id="co_third_party_integrations_CO3-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>                </code><code class="n">FileUtils</code><code class="o">.</code><code class="na">copyInputStreamToFile</code><code class="o">(</code><code>&#13;
</code><code>                        </code><code class="n">response</code><code class="o">.</code><code class="na">getEntity</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getContent</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">destination</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO3-7" id="co_third_party_integrations_CO3-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>            </code><code class="o">}</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO3-1" id="callout_third_party_integrations_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the practice web page again for downloading files.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO3-2" id="callout_third_party_integrations_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We click on a button to download a file.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO3-3" id="callout_third_party_integrations_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We refactor the common logic for downloading files in the class method <span class="keep-together"><code>download</code></span>.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO3-4" id="callout_third_party_integrations_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We repeat the operation for a second file to be downloaded.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO3-5" id="callout_third_party_integrations_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We create an Apache HTTPClient <a data-primary="try-with-resources statement" data-type="indexterm" id="idm45849698803968"/>instance inside a try-with-resources. This client is automatically closed at the end of the statement scope.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO3-6" id="callout_third_party_integrations_CO3-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We use another try-with-resources statement to send an HTTP request to the provided URL and, as a result, get an HTTP response.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO3-7" id="callout_third_party_integrations_CO3-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>We copy the resulting file in the local <a data-startref="ch9_term1" data-type="indexterm" id="idm45849698798256"/><a data-startref="ch9_term2" data-type="indexterm" id="idm45849698797552"/><a data-startref="ch9_term9" data-type="indexterm" id="idm45849698796880"/><a data-startref="ch9_term10" data-type="indexterm" id="idm45849698796208"/><a data-startref="ch9_term11" data-type="indexterm" id="idm45849698795536"/><a data-startref="ch9_term12" data-type="indexterm" id="idm45849698794864"/>file system.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Capture Network Traffic" data-type="sect1"><div class="sect1" id="capture_network_traffic">&#13;
<h1>Capture Network Traffic</h1>&#13;
&#13;
<p><a data-type="xref" href="ch05.html#section-network-monitoring">“Network monitoring”</a> and <a data-type="xref" href="ch05.html#network-interceptor">“Network interceptor”</a> explain how to <a data-primary="network traffic" data-secondary="intercepting" data-type="indexterm" id="idm45849698757280"/><a data-primary="network traffic" data-secondary="monitoring" data-type="indexterm" id="idm45849698756432"/><a data-primary="BrowserMob proxy" data-type="indexterm" id="ch9_term13"/><a data-primary="browser-specific capabilities" data-secondary="web proxies for" data-type="indexterm" id="ch9_term14"/><a data-primary="HTTP" data-secondary="network traffic" data-type="indexterm" id="ch9_term15"/><a data-primary="network traffic" data-secondary="third-party technologies for capturing" data-type="indexterm" id="ch9_term16"/><a data-primary="proxies, web" data-type="indexterm" id="ch9_term17"/><a data-primary="third-party technologies" data-secondary="BrowserMob proxy" data-type="indexterm" id="ch9_term18"/><a data-primary="third-party technologies" data-secondary="for network traffic tracing" data-secondary-sortas="network traffic tracing" data-type="indexterm" id="ch9_term19"/><a data-primary="web proxies" data-type="indexterm" id="ch9_term20"/>use browser-specific capabilities to capture the HTTP traffic between Selenium WebDriver and the web application under test. The drawback of this mechanism is that it is only available in browsers that support CDP. Nevertheless, we can use a third-party proxy for other browsers. In this book, I propose you use <a href="https://bmp.lightbody.net">BrowserMob</a> proxy for this purpose.</p>&#13;
&#13;
<p>BrowserMob is an open source proxy that allows manipulating HTTP traffic using a Java library. <a data-type="xref" href="#capture-network-proxy">Example 9-4</a> shows a complete test using this proxy in a Selenium WebDriver test. In this example, we use the BrowserMob proxy to intercept the HTTP traffic between the test and the target website, tracing this traffic (request-response) as logging traces.</p>&#13;
<div data-type="example" id="capture-network-proxy">&#13;
<h5><span class="label">Example 9-4. </span>Test capturing network traffic through BrowserMob proxy</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">CaptureNetworkTrafficFirefoxJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="n">Logger</code><code> </code><code class="n">log</code><code> </code><code class="o">=</code><code> </code><code class="n">getLogger</code><code class="o">(</code><code class="n">lookup</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">lookupClass</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">BrowserMobProxy</code><code> </code><code class="n">proxy</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">proxy</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">BrowserMobProxyServer</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-1" id="co_third_party_integrations_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">start</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-2" id="co_third_party_integrations_CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">newHar</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-3" id="co_third_party_integrations_CO4-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">enableHarCaptureTypes</code><code class="o">(</code><code class="n">CaptureType</code><code class="o">.</code><code class="na">REQUEST_CONTENT</code><code class="o">,</code><code>&#13;
</code><code>                </code><code class="n">CaptureType</code><code class="o">.</code><code class="na">RESPONSE_CONTENT</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-4" id="co_third_party_integrations_CO4-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">Proxy</code><code> </code><code class="n">seleniumProxy</code><code> </code><code class="o">=</code><code> </code><code class="n">ClientUtil</code><code class="o">.</code><code class="na">createSeleniumProxy</code><code class="o">(</code><code class="n">proxy</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-5" id="co_third_party_integrations_CO4-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="n">FirefoxOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">FirefoxOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setProxy</code><code class="o">(</code><code class="n">seleniumProxy</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-6" id="co_third_party_integrations_CO4-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setAcceptInsecureCerts</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-7" id="co_third_party_integrations_CO4-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">stop</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-8" id="co_third_party_integrations_CO4-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testCaptureNetworkTrafficFirefox</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">List</code><code class="o">&lt;</code><code class="n">HarEntry</code><code class="o">&gt;</code><code> </code><code class="n">logEntries</code><code> </code><code class="o">=</code><code> </code><code class="n">proxy</code><code class="o">.</code><code class="na">getHar</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getLog</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getEntries</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">logEntries</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">logEntry</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_third_party_integrations_CO4-9" id="co_third_party_integrations_CO4-9"><img alt="9" src="assets/9.png"/></a><code>&#13;
</code><code>            </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"Request: {} - Response: {}"</code><code class="o">,</code><code>&#13;
</code><code>                    </code><code class="n">logEntry</code><code class="o">.</code><code class="na">getRequest</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getUrl</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>                    </code><code class="n">logEntry</code><code class="o">.</code><code class="na">getResponse</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getStatus</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-1" id="callout_third_party_integrations_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create an instance of a BrowserMob.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-2" id="callout_third_party_integrations_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We start this proxy.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-3" id="callout_third_party_integrations_CO4-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We capture <a data-primary="HAR (HTTP Archive)" data-type="indexterm" id="ch9_term23"/><a data-primary="HTTP Archive (HAR)" data-type="indexterm" id="ch9_term24"/>the HTTP traffic using HAR (HTTP Archive), a JSON-based file format used to capture and export this traffic.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-4" id="callout_third_party_integrations_CO4-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We enable capturing the exchanged HTTP requests and responses.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-5" id="callout_third_party_integrations_CO4-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We transform the BrowserMob server into a Selenium WebDriver proxy.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-6" id="callout_third_party_integrations_CO4-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We set this proxy as a browser option (in this case, for Firefox).</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-7" id="callout_third_party_integrations_CO4-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>We need to allow insecure certificates since the communication with the proxy is done using HTTP (and not HTTPS).</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-8" id="callout_third_party_integrations_CO4-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>We stop the proxy after the test.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO4-9" id="callout_third_party_integrations_CO4-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>We use the proxy instance to gather the HTTP traffic (requests and responses). We use a <a data-primary="browser log" data-type="indexterm" id="idm45849698456112"/><a data-primary="log gathering" data-type="indexterm" id="idm45849698370064"/>logger to write this information in the standard output in this basic <a data-startref="ch9_term14" data-type="indexterm" id="idm45849698369328"/><a data-startref="ch9_term15" data-type="indexterm" id="idm45849698368720"/><a data-startref="ch9_term16" data-type="indexterm" id="idm45849698368112"/><a data-startref="ch9_term17" data-type="indexterm" id="idm45849698367504"/><a data-startref="ch9_term19" data-type="indexterm" id="idm45849698366896"/>example.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Nonfunctional Testing" data-type="sect1"><div class="sect1" id="idm45849698442880">&#13;
<h1>Nonfunctional Testing</h1>&#13;
&#13;
<p>As explained in <a data-type="xref" href="ch01.html#ch01">Chapter 1</a>, Selenium WebDriver is primarily used to assess the functional requirements of web applications. In other words, testers use the Selenium WebDriver API to verify that a web application under test behaves as expected. Nevertheless, we <a data-primary="nonfunctional testing" data-secondary="about" data-type="indexterm" id="idm45849698364048"/><a data-primary="testing" data-secondary="nonfunctional" data-type="indexterm" id="ch9_term21"/><a data-primary="third-party technologies" data-secondary="for nonfunctional testing" data-secondary-sortas="nonfunctional testing" data-type="indexterm" id="ch9_term22"/>can leverage this API to test nonfunctional requirements, i.e., quality attributes such as performance, security, accessibility, etc. A common strategy to accomplish this goal is to integrate with specific third-party utilities. The following subsections explain different integrations with Selenium WebDriver for nonfunctional testing.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Performance" data-type="sect2"><div class="sect2" id="idm45849698360528">&#13;
<h2>Performance</h2>&#13;
&#13;
<p>Performance testing <a data-primary="nonfunctional testing" data-secondary="of performance" data-secondary-sortas="performance" data-type="indexterm" id="ch9_term29"/><a data-primary="performance testing" data-type="indexterm" id="ch9_term30"/><a data-primary="third-party technologies" data-secondary="for performance testing" data-secondary-sortas="performance testing" data-type="indexterm" id="ch9_term31"/>evaluates the responsiveness and stability of a SUT under a particular workload. Instead of Selenium WebDriver, testers usually <a data-primary="Apache JMeter" data-type="indexterm" id="ch9_term27"/><a data-primary="JMeter, Apache" data-type="indexterm" id="ch9_term28"/>adopt specific tools like <a href="https://jmeter.apache.org">Apache JMeter</a> for performance testing. Apache JMeter is an open source tool that allows sending multiple HTTP requests to a given URL endpoint while measuring the response time and other metrics. Although the direct integration between Selenium WebDriver and Apache JMeter is not trivial, we can leverage an existing Selenium WebDriver test as a JMeter test plan (i.e., the series of steps that JMeter executes). The benefit of this approach is that the resulting JMeter test plan will mimic the same user workflow used in the Selenium WebDriver test, reusing the same HTTP traffic the browser makes (e.g., for JavaScript libraries, CSS, etc.). To that aim, I propose the following procedure:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Use the BrowserMob proxy (introduced in the previous section) to capture the exchanged network traffic in Selenium WebDriver as a HAR file.</p>&#13;
</li>&#13;
<li>&#13;
<p>Convert the resulting HAR file to a JMeter test plan. Test plans in JMeter are stored as XML-based files with the extension JMX.</p>&#13;
</li>&#13;
<li>&#13;
<p>Load the JMX test plan in JMeter and tune it for simulating concurrent users and including result listeners</p>&#13;
</li>&#13;
<li>&#13;
<p>Run the test plan and evaluate the results.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p><a data-type="xref" href="#har-creation">Example 9-5</a> shows a complete test case that implements the first step. As you can see, the required login to start and create the HAR file is done before and after each test. You can use this approach to leverage existing functional tests (i.e., the logic in the <code>@Test</code> methods) as performance tests (to be executed in JMeter).</p>&#13;
<div class="pagebreak-before less_space" data-type="example" id="har-creation">&#13;
<h5><span class="label">Example 9-5. </span>Test creating a HAR file</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">HarCreatorJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">BrowserMobProxy</code><code> </code><code class="n">proxy</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">proxy</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">BrowserMobProxyServer</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO5-1" id="co_third_party_integrations_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">start</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">newHar</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">enableHarCaptureTypes</code><code class="o">(</code><code class="n">CaptureType</code><code class="o">.</code><code class="na">REQUEST_CONTENT</code><code class="o">,</code><code>&#13;
</code><code>                </code><code class="n">CaptureType</code><code class="o">.</code><code class="na">RESPONSE_CONTENT</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">Proxy</code><code> </code><code class="n">seleniumProxy</code><code> </code><code class="o">=</code><code> </code><code class="n">ClientUtil</code><code class="o">.</code><code class="na">createSeleniumProxy</code><code class="o">(</code><code class="n">proxy</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setProxy</code><code class="o">(</code><code class="n">seleniumProxy</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setAcceptInsecureCerts</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">IOException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">Har</code><code> </code><code class="n">har</code><code> </code><code class="o">=</code><code> </code><code class="n">proxy</code><code class="o">.</code><code class="na">getHar</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO5-2" id="co_third_party_integrations_CO5-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">File</code><code> </code><code class="n">harFile</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="s">"login.har"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">har</code><code class="o">.</code><code class="na">writeTo</code><code class="o">(</code><code class="n">harFile</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">stop</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testHarCreator</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>                </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/login-form.html"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"username"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="s">"user"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"password"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="s">"user"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">cssSelector</code><code class="o">(</code><code class="s">"button"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">bodyText</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">bodyText</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Login successful"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO5-1" id="callout_third_party_integrations_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We start BrowserMob before the test and configure it in the <code>WebDriver</code> session.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO5-2" id="callout_third_party_integrations_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We get the HAR file after the test and write it as a local file.</p></dd>&#13;
</dl>&#13;
&#13;
<p>After running the previous test, we get a HAR file called <code>login.har</code>. Now, we need to <a data-startref="ch9_term23" data-type="indexterm" id="idm45849698223792"/><a data-startref="ch9_term24" data-type="indexterm" id="idm45849698223056"/><a data-startref="ch9_term13" data-type="indexterm" id="idm45849698222384"/><a data-startref="ch9_term18" data-type="indexterm" id="idm45849698283712"/>convert it to a JMeter test plan. There are different alternatives to do that. You can find several programs (e.g., in Ruby or Java) that make this job freely available on the web. Also, you can <a data-primary="BlazeMeter JMX Converter" data-type="indexterm" id="idm45849698282912"/>use online converters services, such as the <a href="https://converter.blazemeter.com">BlazeMeter JMX Converter</a>. In this example, I use this online service and open the resulting JMX test plan in JMeter. At this point, you can tune the JMeter configuration at your convenience (you can find further information about JMeter in its official <a href="https://jmeter.apache.org/usermanual/index.html">user manual</a>). For instance, <a data-type="xref" href="#jmeter-screenshots-1">Figure 9-2</a>  shows the <a data-primary="GUI (Graphical User Interface)" data-secondary="of JMeter test plan" data-secondary-sortas="JMeter test plan" data-type="indexterm" id="ch9_term32"/>JMeter GUI after loading the resulting JMX test plan plus the following changes:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Increase the number of concurrent users to one hundred (in the “Thread Group” tab)</p>&#13;
</li>&#13;
<li>&#13;
<p>Include some result listeners, such as “Aggregate Graph” and “Graph Results</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<figure><div class="figure" id="jmeter-screenshots-1">&#13;
<img alt="hosw 0902" src="assets/hosw_0902.png"/>&#13;
<h6><span class="label">Figure 9-2. </span>JMeter GUI loading the resulting test plan</h6>&#13;
</div></figure>&#13;
&#13;
<p>Now, we can run the test plan with JMeter (for example, clicking on the button with a green triangle in the JMeter GUI). As a result, a load of one hundred concurrent users is generated following the interactions initially developed as a Selenium WebDriver test (<a data-type="xref" href="#har-creation">Example 9-5</a>). <a data-type="xref" href="#jmeter-screenshots-results">Figure 9-3</a> shows the results for the previously added listeners.</p>&#13;
&#13;
<figure><div class="figure" id="jmeter-screenshots-results">&#13;
<img alt="hosw 0903" src="assets/hosw_0903.png"/>&#13;
<h6><span class="label">Figure 9-3. </span>JMeter results</h6>&#13;
</div></figure>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using browsers to generate the load" data-type="sect3"><div class="sect3" id="idm45849698309264">&#13;
<h3>Using browsers to generate the load</h3>&#13;
&#13;
<p>Using tools like JMeter is convenient for many performance testing scenarios for web applications. Nevertheless, this approach is unsuitable when you need actual browsers to recreate the complete user workflow (e.g., in videoconferencing web apps). In <a data-startref="ch9_term27" data-type="indexterm" id="idm45849698244144"/><a data-startref="ch9_term28" data-type="indexterm" id="idm45849698243552"/><a data-startref="ch9_term32" data-type="indexterm" id="idm45849698242880"/><a data-primary="Docker containers" data-secondary="with WebManager for load testing" data-secondary-sortas="WebManager for load testing" data-type="indexterm" id="ch9_term33"/><a data-primary="load testing" data-type="indexterm" id="ch9_term34"/><a data-primary="WebDriver" data-secondary="and WebDriverManager" data-secondary-sortas="WebDriverManager" data-type="indexterm" id="ch9_term35"/><a data-primary="WebDriverManager" data-secondary="with Docker for load testing" data-secondary-sortas="Docker for load testing" data-type="indexterm" id="ch9_term36"/><a data-primary="WebDriverManager" data-secondary="and WebDriver" data-secondary-sortas="WebDriver" data-type="indexterm" id="ch9_term37"/>that case, a possible solution is to use WebDriverManager in conjunction with Docker. <a data-type="xref" href="#load-wdm-docker">Example 9-6</a> demonstrates this use. As you can see in this test, WebDriverManager allows creating a list of <code>WebDriver</code> instances simply by <a data-primary="create() method" data-type="indexterm" id="idm45849698253232"/>specifying the size as a parameter in the <code>create()</code> method. Then, for example, we can use standard Java to exercise the web application under test in parallel using a thread pool.</p>&#13;
<div data-type="example" id="load-wdm-docker">&#13;
<h5><span class="label">Example 9-6. </span>Load test using WebDriverManager and Docker</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">LoadJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="kt">int</code><code> </code><code class="n">NUM_BROWSERS</code><code> </code><code class="o">=</code><code> </code><code class="mi">5</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">final</code><code> </code><code class="n">Logger</code><code> </code><code class="n">log</code><code> </code><code class="o">=</code><code> </code><code class="n">getLogger</code><code class="o">(</code><code class="n">lookup</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">lookupClass</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">WebDriver</code><code class="o">&gt;</code><code> </code><code class="n">driverList</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriverManager</code><code> </code><code class="n">wdm</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">browserInDocker</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO6-1" id="co_third_party_integrations_CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setupTest</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">isDockerAvailable</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isTrue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO6-2" id="co_third_party_integrations_CO6-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">driverList</code><code> </code><code class="o">=</code><code> </code><code class="n">wdm</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="n">NUM_BROWSERS</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO6-3" id="co_third_party_integrations_CO6-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">wdm</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testLoad</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">InterruptedException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">ExecutorService</code><code> </code><code class="n">executorService</code><code> </code><code class="o">=</code><code> </code><code class="n">newFixedThreadPool</code><code class="o">(</code><code class="n">NUM_BROWSERS</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO6-4" id="co_third_party_integrations_CO6-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="n">CountDownLatch</code><code> </code><code class="n">latch</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">CountDownLatch</code><code class="o">(</code><code class="n">NUM_BROWSERS</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driverList</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="o">(</code><code class="n">driver</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_third_party_integrations_CO6-5" id="co_third_party_integrations_CO6-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>            </code><code class="n">executorService</code><code class="o">.</code><code class="na">submit</code><code class="o">(</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                </code><code class="k">try</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                    </code><code class="n">checkHomePage</code><code class="o">(</code><code class="n">driver</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>                </code><code class="o">}</code><code> </code><code class="k">finally</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                    </code><code class="n">latch</code><code class="o">.</code><code class="na">countDown</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>                </code><code class="o">}</code><code>&#13;
</code><code>            </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">latch</code><code class="o">.</code><code class="na">await</code><code class="o">(</code><code class="mi">60</code><code class="o">,</code><code> </code><code class="n">SECONDS</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO6-6" id="co_third_party_integrations_CO6-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>        </code><code class="n">executorService</code><code class="o">.</code><code class="na">shutdown</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">checkHomePage</code><code class="o">(</code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"Session id {}"</code><code class="o">,</code><code> </code><code class="o">(</code><code class="o">(</code><code class="n">RemoteWebDriver</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">)</code><code class="o">.</code><code class="na">getSessionId</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO6-1" id="callout_third_party_integrations_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create an instance of the Chrome manager, using Docker to execute the browsers as containers.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO6-2" id="callout_third_party_integrations_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We assume that Docker is installed in the machine running this test. Otherwise, the test is skipped.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO6-3" id="callout_third_party_integrations_CO6-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We create a <code>WebDriver</code> list (containing five instances in this example).</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO6-4" id="callout_third_party_integrations_CO6-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We create a thread pool using the same size as the <code>WebDriver</code> list.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO6-5" id="callout_third_party_integrations_CO6-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We use the thread pool to execute in parallel the SUT assessment.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO6-6" id="callout_third_party_integrations_CO6-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We wait until each parallel evaluation finishes. We use a synchronization method based on a counter latch to do <a data-startref="ch9_term29" data-type="indexterm" id="idm45849697687408"/><a data-startref="ch9_term30" data-type="indexterm" id="idm45849697686704"/><a data-startref="ch9_term31" data-type="indexterm" id="idm45849697686032"/><a data-startref="ch9_term33" data-type="indexterm" id="idm45849697685360"/><a data-startref="ch9_term34" data-type="indexterm" id="idm45849697684688"/><a data-startref="ch9_term35" data-type="indexterm" id="idm45849697684016"/><a data-startref="ch9_term36" data-type="indexterm" id="idm45849697683344"/><a data-startref="ch9_term37" data-type="indexterm" id="idm45849697682672"/>that.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Security" data-type="sect2"><div class="sect2" id="idm45849698360064">&#13;
<h2>Security</h2>&#13;
&#13;
<p>A relevant organization in the <a data-primary="nonfunctional testing" data-secondary="of security issues" data-secondary-sortas="security issues" data-type="indexterm" id="ch9_term38"/><a data-primary="security testing" data-type="indexterm" id="ch9_term39"/><a data-primary="third-party technologies" data-secondary="for security testing" data-secondary-sortas="security testing" data-type="indexterm" id="ch9_term40"/><a data-primary="OWASP ZAP" data-type="indexterm" id="ch9_term41"/><a data-primary="third-party technologies" data-secondary="OWASP ZAP" data-type="indexterm" id="ch9_term42"/><a data-primary="OWASP (Open Web Application Security Project)" data-type="indexterm" id="idm45849697588368"/>software security domain is <a href="https://owasp.org">OWASP</a> (Open Web Application Security Project), a nonprofit foundation that promotes open solutions to improve software security. One of the <a data-primary="ZAP (Zed Attack Proxy)" data-type="indexterm" id="idm45849697587008"/>most popular OWASP projects is the Zed Attack Proxy (ZAP). <a href="https://www.zaproxy.org">OWASP ZAP</a> is an open source <a data-primary="vulnerability assessment" data-type="indexterm" id="ch9_term43"/><a data-primary="penetration testing" data-type="indexterm" id="idm45849697584800"/>web application security scanner used to implement <em>vulnerability assessment</em> (i.e., look for security issues) or <em>penetration testing</em> (i.e., a simulated cyberattack) to find exploitable web application <span class="keep-together">vulnerabilities</span>.</p>&#13;
&#13;
<p>We can use OWASP ZAP as a standalone desktop <a data-primary="GUI (Graphical User Interface)" data-secondary="of OWASP ZAP" data-secondary-sortas="OWASP ZAP" data-type="indexterm" id="idm45849697582544"/>application. <a data-type="xref" href="#zap-gui">Figure 9-4</a> shows a screenshot of its GUI.</p>&#13;
&#13;
<figure><div class="figure" id="zap-gui">&#13;
<img alt="hosw 0904" src="assets/hosw_0904.png"/>&#13;
<h6><span class="label">Figure 9-4. </span>OWASP ZAP GUI</h6>&#13;
</div></figure>&#13;
&#13;
<p>This GUI provides different features for automated scans to detect security threats that a web application might face, such as SQL injection, cross-site scripting (XSS), or cross-site request forgery (CSRF), to name a few.</p>&#13;
&#13;
<p>In addition to the standalone application, we can <a data-primary="security scanner test" data-type="indexterm" id="ch9_term44"/><a data-primary="Selenium WebDriver API" data-secondary="with OWASP ZAP test" data-secondary-sortas="OWASP ZAP test" data-type="indexterm" id="ch9_term45"/>integrate a Selenium WebDriver test with ZAP. <a data-type="xref" href="#zap-proxy-test">Example 9-7</a> provides a test case illustrating this integration. The steps required to execute this test properly are:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Start OWAS ZAP in the localhost. By default, OWASP starts a proxy that listens to port 8080. You can change this port using the OWASP GUI using the menu option Tools → Options → Local Proxies.</p>&#13;
</li>&#13;
<li>&#13;
<p>Disable the <a data-primary="API key, disabling" data-type="indexterm" id="idm45849697573248"/>API key (or copy its value in the Selenium WebDriver test). You can change this value in the menu option Tools → Options → API.</p>&#13;
</li>&#13;
<li>&#13;
<p>Implement a Selenium WebDriver test that uses OWASP ZAP as a proxy (like <a data-type="xref" href="#zap-proxy-test">Example 9-7</a>).</p>&#13;
</li>&#13;
<li>&#13;
<p>Execute the Selenium WebDriver test. At this point, you should see the generated vulnerability report in the ZAP GUI.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
<div data-type="example" id="zap-proxy-test">&#13;
<h5><span class="label">Example 9-7. </span>Test using OWASP ZAP as security scanner</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">SecurityJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="n">Logger</code><code> </code><code class="n">log</code><code> </code><code class="o">=</code><code> </code><code class="n">getLogger</code><code class="o">(</code><code class="n">lookup</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">lookupClass</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">ZAP_PROXY_ADDRESS</code><code> </code><code class="o">=</code><code> </code><code class="s">"localhost"</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO7-1" id="co_third_party_integrations_CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="kt">int</code><code> </code><code class="n">ZAP_PROXY_PORT</code><code> </code><code class="o">=</code><code> </code><code class="mi">8080</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">ZAP_API_KEY</code><code> </code><code class="o">=</code><code> </code><code class="s">"&lt;put-api-key-here-or-disable-it&gt;"</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO7-2" id="co_third_party_integrations_CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ClientApi</code><code> </code><code class="n">api</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">proxyStr</code><code> </code><code class="o">=</code><code> </code><code class="n">ZAP_PROXY_ADDRESS</code><code> </code><code class="o">+</code><code> </code><code class="s">":"</code><code> </code><code class="o">+</code><code> </code><code class="n">ZAP_PROXY_PORT</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">isOnline</code><code class="o">(</code><code class="s">"http://"</code><code> </code><code class="o">+</code><code> </code><code class="n">proxyStr</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isTrue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">Proxy</code><code> </code><code class="n">proxy</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Proxy</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO7-3" id="co_third_party_integrations_CO7-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">setHttpProxy</code><code class="o">(</code><code class="n">proxyStr</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">proxy</code><code class="o">.</code><code class="na">setSslProxy</code><code class="o">(</code><code class="n">proxyStr</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setAcceptInsecureCerts</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setProxy</code><code class="o">(</code><code class="n">proxy</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">api</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ClientApi</code><code class="o">(</code><code class="n">ZAP_PROXY_ADDRESS</code><code class="o">,</code><code> </code><code class="n">ZAP_PROXY_PORT</code><code class="o">,</code><code> </code><code class="n">ZAP_API_KEY</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO7-4" id="co_third_party_integrations_CO7-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">ClientApiException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">api</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>            </code><code class="n">String</code><code> </code><code class="n">title</code><code> </code><code class="o">=</code><code> </code><code class="s">"My ZAP report"</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="n">String</code><code> </code><code class="n">template</code><code> </code><code class="o">=</code><code> </code><code class="s">"traditional-html"</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="n">String</code><code> </code><code class="n">description</code><code> </code><code class="o">=</code><code> </code><code class="s">"This is a sample report"</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="n">String</code><code> </code><code class="n">reportfilename</code><code> </code><code class="o">=</code><code> </code><code class="s">"zap-report.html"</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="n">String</code><code> </code><code class="n">targetFolder</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="s">""</code><code class="o">)</code><code class="o">.</code><code class="na">getAbsolutePath</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="n">ApiResponse</code><code> </code><code class="n">response</code><code> </code><code class="o">=</code><code> </code><code class="n">api</code><code class="o">.</code><code class="na">reports</code><code class="o">.</code><code class="na">generate</code><code class="o">(</code><code class="n">title</code><code class="o">,</code><code> </code><code class="n">template</code><code class="o">,</code><code> </code><code class="kc">null</code><code class="o">,</code><code>&#13;
</code><code>                    </code><code class="n">description</code><code class="o">,</code><code> </code><code class="kc">null</code><code class="o">,</code><code> </code><code class="kc">null</code><code class="o">,</code><code> </code><code class="kc">null</code><code class="o">,</code><code> </code><code class="kc">null</code><code class="o">,</code><code> </code><code class="kc">null</code><code class="o">,</code><code> </code><code class="n">reportfilename</code><code class="o">,</code><code>&#13;
</code><code>                    </code><code class="kc">null</code><code class="o">,</code><code> </code><code class="n">targetFolder</code><code class="o">,</code><code> </code><code class="kc">null</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO7-5" id="co_third_party_integrations_CO7-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>            </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"ZAP report generated at {}"</code><code class="o">,</code><code> </code><code class="n">response</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">driver</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>            </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testSecurity</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>                </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/web-form.html"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO7-1" id="callout_third_party_integrations_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We configure the address and port where the ZAP local proxy is listening.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO7-2" id="callout_third_party_integrations_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>If the ZAP API key is not disabled, we need to set its value here.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO7-3" id="callout_third_party_integrations_CO7-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We configure ZAP as a Selenium WebDriver proxy.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO7-4" id="callout_third_party_integrations_CO7-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We interact with ZAP using its API.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO7-5" id="callout_third_party_integrations_CO7-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>After the test, we create an HTML report with vulnerabilities found during the execution of the Selenium WebDriver test. <a data-type="xref" href="#zap-report">Figure 9-5</a> shows a screenshot of this report.</p></dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>We can also use OWASP ZAP as a standalone GUI, as introduced previously. The potential benefit of the integration with Selenium WebDriver could be reusing existing functional tests for assessing security or automated <a data-startref="ch9_term43" data-type="indexterm" id="idm45849697537840"/><a data-startref="ch9_term38" data-type="indexterm" id="idm45849697099472"/><a data-startref="ch9_term39" data-type="indexterm" id="idm45849697098800"/><a data-startref="ch9_term40" data-type="indexterm" id="idm45849697098128"/><a data-startref="ch9_term41" data-type="indexterm" id="idm45849697097456"/><a data-startref="ch9_term42" data-type="indexterm" id="idm45849697096784"/><a data-startref="ch9_term44" data-type="indexterm" id="idm45849697096112"/><a data-startref="ch9_term45" data-type="indexterm" id="idm45849697095440"/>security assessment (e.g., a regression test suite executed by a CI server).</p>&#13;
</div>&#13;
&#13;
<figure><div class="figure" id="zap-report">&#13;
<img alt="hosw 0905" src="assets/hosw_0905.png"/>&#13;
<h6><span class="label">Figure 9-5. </span>Report generated by ZAP after executing a Selenium WebDriver test</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Accessibility" data-type="sect2"><div class="sect2" id="idm45849697681280">&#13;
<h2>Accessibility</h2>&#13;
&#13;
<p>Digital accessibility <a data-primary="accessibility testing" data-type="indexterm" id="ch9_term48"/><a data-primary="nonfunctional testing" data-secondary="of accessibility" data-secondary-sortas="accessibility" data-type="indexterm" id="ch9_term49"/><a data-primary="third-party technologies" data-secondary="for accessibility testing" data-secondary-sortas="accessibility testing" data-type="indexterm" id="ch9_term50"/>refers to the ability of users with disabilities to effectively use software systems such as websites, mobile apps, etc. An essential <a data-primary="Web Content Accessibility Guidelines (WCAG)" data-type="indexterm" id="idm45849697086720"/><a data-primary="WCAG (Web Content Accessibility Guidelines)" data-type="indexterm" id="idm45849697086080"/><a data-primary="Web Accessibility Initiative (WAI)" data-type="indexterm" id="idm45849697085440"/><a data-primary="WAI (Web Accessibility Initiative)" data-type="indexterm" id="idm45849697084752"/><a data-primary="W3C specifications" data-secondary="Web Accessibility Initiative (WAI) and" data-type="indexterm" id="idm45849697084064"/>reference in this domain is the <a href="https://www.w3.org/WAI/standards-guidelines/wcag">Web Content Accessibility Guidelines</a> (WCAG), which are a set of standard recommendations created by the W3C <a href="https://www.w3.org/WAI">Web Accessibility Initiative</a> (WAI) that explain how to make web content more accessible to people with disabilities.</p>&#13;
&#13;
<p>There are several <a data-primary="Axe Selenium Integration" data-type="indexterm" id="ch9_term46"/><a data-primary="third-party technologies" data-secondary="Axe Selenium Integration" data-type="indexterm" id="ch9_term47"/>methods to test the accessibility of web applications.&#13;
The most common approach consists of checking the WCAG recommendations. To that aim, we can use automated accessibility scanners like <a href="https://www.deque.com/axe">Axe</a>, an open source engine for automated accessibility testing of web applications following WCAG rules. Axe provides seamless integration with the Java bindings of Selenium WebDriver using a <a href="https://github.com/dequelabs/axe-core-maven-html">helper library</a>. <a data-type="xref" href="#axe-test">Example 9-8</a> shows a test using this library.</p>&#13;
<div data-type="example" id="axe-test">&#13;
<h5><span class="label">Example 9-8. </span>Test using Axe to generate an accessibility report</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testAccessibility</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">Results</code><code> </code><code class="n">result</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">AxeBuilder</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">analyze</code><code class="o">(</code><code class="n">driver</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO8-1" id="co_third_party_integrations_CO8-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">Rule</code><code class="o">&gt;</code><code> </code><code class="n">violations</code><code> </code><code class="o">=</code><code> </code><code class="n">result</code><code class="o">.</code><code class="na">getViolations</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO8-2" id="co_third_party_integrations_CO8-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">violations</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">rule</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"{}"</code><code class="o">,</code><code> </code><code class="n">rule</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO8-3" id="co_third_party_integrations_CO8-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">AxeReporter</code><code class="o">.</code><code class="na">writeResultsToJsonFile</code><code class="o">(</code><code class="s">"testAccessibility"</code><code class="o">,</code><code> </code><code class="n">result</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO8-4" id="co_third_party_integrations_CO8-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO8-1" id="callout_third_party_integrations_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We analyze the current <code>WebDriver</code> session with Axe. This way, all pages loaded in the browser will be scanned by Axe.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO8-2" id="callout_third_party_integrations_CO8-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We get a report of the accessibility violations found.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO8-3" id="callout_third_party_integrations_CO8-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We log each violation in the standard output. In this example, the found issues are:</p>&#13;
<dl>&#13;
<dt>color-contrast</dt>&#13;
<dd>&#13;
<p>Elements must have sufficient color contrast.</p>&#13;
</dd>&#13;
<dt>heading-order</dt>&#13;
<dd>&#13;
<p>Heading levels should only increase by one.</p>&#13;
</dd>&#13;
<dt>image-alt</dt>&#13;
<dd>&#13;
<p>Images must have alternate text.</p>&#13;
</dd>&#13;
<dt>link-name</dt>&#13;
<dd>&#13;
<p>Links must have discernible text.</p>&#13;
</dd>&#13;
</dl></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO8-4" id="callout_third_party_integrations_CO8-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We write the results as a local JSON <a data-startref="ch9_term46" data-type="indexterm" id="idm45849696907520"/><a data-startref="ch9_term47" data-type="indexterm" id="idm45849696906912"/><a data-startref="ch9_term48" data-type="indexterm" id="idm45849696906304"/><a data-startref="ch9_term49" data-type="indexterm" id="idm45849696905696"/><a data-startref="ch9_term50" data-type="indexterm" id="idm45849696905088"/>file.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A/B Testing" data-type="sect2"><div class="sect2" id="idm45849696904224">&#13;
<h2>A/B Testing</h2>&#13;
&#13;
<p>A/B testing <a data-primary="A/B testing" data-type="indexterm" id="idm45849696902752"/><a data-primary="nonfunctional testing" data-secondary="and A/B testing" data-secondary-sortas="A/B testing" data-type="indexterm" id="idm45849696902144"/><a data-primary="third-party technologies" data-secondary="for A/B testing" data-secondary-sortas="A/B testing" data-type="indexterm" id="idm45849696901056"/><a data-primary="web pages" data-secondary="comparison of variations in" data-type="indexterm" id="idm45849696899968"/><a data-primary="usability evaluation, A/B testing for" data-type="indexterm" id="idm45849696899120"/>is a form of usability evaluation that compares variations of the same application to discover which one is more effective to its end users. Different <a data-primary="Applitools Eyes" data-type="indexterm" id="idm45849696898224"/><a data-primary="third-party technologies" data-secondary="Applitools Eyes" data-type="indexterm" id="idm45849696897616"/><a data-primary="Optimizely" data-type="indexterm" id="idm45849696896768"/><a data-primary="third-party technologies" data-secondary="Optimizely" data-type="indexterm" id="idm45849696896160"/>commercial products facilitate advanced features for A/B tests in Selenium WebDriver tests. For example, <a href="https://applitools.com/products-eyes">Applitools Eyes</a> provides an automated visual comparison of multiple web page variations. Another option is <a href="https://www.optimizely.com">Optimizely</a>, a company that provides tools for customizing and experimenting with A/B testing.</p>&#13;
&#13;
<p>Another way to <a data-primary="Selenium WebDriver API" data-secondary="vanilla version of" data-type="indexterm" id="idm45849696893440"/><a data-primary="vanilla Selenium WebDriver API" data-type="indexterm" id="idm45849696892592"/>carry out A/B testing is to use the vanilla Selenium WebDriver API and custom conditions for the different variations of a web page.  <a data-type="xref" href="#basic-ab-testing">Example 9-9</a> shows a basic test following a manual approach for a multivariant web page. Notice that this test shows a simple way to implement an A/B test based on assessing the different page variations.</p>&#13;
<div class="pagebreak-before less_space" data-type="example" id="basic-ab-testing">&#13;
<h5><span class="label">Example 9-9. </span>Basic A/B test using Selenium WebDriver</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testABTesting</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/ab-testing.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO9-1" id="co_third_party_integrations_CO9-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">WebDriverWait</code><code> </code><code class="n">wait</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">WebDriverWait</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">Duration</code><code class="o">.</code><code class="na">ofSeconds</code><code class="o">(</code><code class="mi">10</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">WebElement</code><code> </code><code class="n">header</code><code> </code><code class="o">=</code><code> </code><code class="n">wait</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="n">ExpectedConditions</code><code class="o">.</code><code class="na">presenceOfElementLocated</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"h6"</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">header</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"variation A"</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_third_party_integrations_CO9-2" id="co_third_party_integrations_CO9-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">assertBodyContains</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="s">"Lorem ipsum"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code> </code><code class="k">else</code><code> </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">header</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"variation B"</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">assertBodyContains</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="s">"Nibh netus"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code> </code><code class="k">else</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">fail</code><code class="o">(</code><code class="s">"Unknown variation"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">assertBodyContains</code><code class="o">(</code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">String</code><code> </code><code class="n">text</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">bodyText</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">bodyText</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="n">text</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO9-1" id="callout_third_party_integrations_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We open a multivariant practice web page. The content of this page is randomly loaded 50% of the time.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO9-2" id="callout_third_party_integrations_CO9-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We check the page variations are as <a data-startref="ch9_term21" data-type="indexterm" id="idm45849696737280"/><a data-startref="ch9_term22" data-type="indexterm" id="idm45849696736784"/>expected.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Fluent API" data-type="sect1"><div class="sect1" id="idm45849696735792">&#13;
<h1>Fluent API</h1>&#13;
&#13;
<p>As introduced in <a data-type="xref" href="ch01.html#ch01">Chapter 1</a>, Selenium is the foundation technology for other frameworks and libraries. For instance, we can <a data-primary="WebDriver" data-secondary="Selenide and" data-type="indexterm" id="ch9_term51"/><a data-primary="Selenide" data-type="indexterm" id="ch9_term52"/><a data-primary="third-party technologies" data-secondary="Selenide" data-type="indexterm" id="ch9_term53"/><a data-primary="fluent APIs" data-type="indexterm" id="ch9_term54"/><a data-primary="third-party technologies" data-secondary="for fluent APIs" data-type="indexterm" id="ch9_term55"/>find several libraries wrapping Selenium WebDriver to expose a fluent API for creating end-to-end tests for web applications. An example of this kind of library is <a href="https://selenide.org">Selenide</a>, an open source (MIT license) library that defines a concise fluent API on top of Selenium WebDriver. Selenide provides several benefits, such as automated waiting for web elements or support for AJAX applications.</p>&#13;
&#13;
<p>A relevant difference of a Selenide test compared to Selenium WebDriver is that Selenide handles the <code>WebDriver</code> objects internally. For that, it uses WebDriverManager to resolve the required driver (e.g., chromedriver, geckodriver, etc.), holding the <code>WebDriver</code> instance in a separate thread that is closed at the end of the test. As a result, the required test boilerplate related to the creation and termination of <code>WebDriver</code> objects is not required. <a data-type="xref" href="#selenide-test">Example 9-10</a> demonstrates this feature by showing a basic Selenide test.</p>&#13;
<div data-type="example" id="selenide-test">&#13;
<h5><span class="label">Example 9-10. </span>Test using Selenide</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">SelenideJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testSelenide</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">open</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/login-form.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO10-1" id="co_third_party_integrations_CO10-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">$</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"username"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">val</code><code class="o">(</code><code class="s">"user"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO10-2" id="co_third_party_integrations_CO10-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">$</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"password"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">val</code><code class="o">(</code><code class="s">"user"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">$</code><code class="o">(</code><code class="s">"button"</code><code class="o">)</code><code class="o">.</code><code class="na">pressEnter</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO10-3" id="co_third_party_integrations_CO10-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">$</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"success"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">shouldBe</code><code class="o">(</code><code class="n">visible</code><code class="o">)</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">shouldHave</code><code class="o">(</code><code class="n">text</code><code class="o">(</code><code class="s">"Login successful"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO10-4" id="co_third_party_integrations_CO10-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO10-1" id="callout_third_party_integrations_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the static method <code>open</code> provided by Selenide to navigate a given URL. By default, Selenide uses a local Chrome, although the browser can be changed using a configuration class (e.g., <code>Configuration.browser = "firefox";</code>) or using a Java system property (e.g., <code>-Dselenide.browser=firefox</code>).</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO10-2" id="callout_third_party_integrations_CO10-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The Selenide method <code>$</code> allows you to locate web elements by CSS selector or using Selenium WebDriver <code>By</code> locators. This line of code uses the latter to type text into an input field.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO10-3" id="callout_third_party_integrations_CO10-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We locate another web element, this time by CSS selector, and click on it.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO10-4" id="callout_third_party_integrations_CO10-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We verify that the web element for successful login is present on the page and contains <a data-startref="ch9_term51" data-type="indexterm" id="idm45849696516416"/><a data-startref="ch9_term52" data-type="indexterm" id="idm45849696515808"/><a data-startref="ch9_term53" data-type="indexterm" id="idm45849696515200"/><a data-startref="ch9_term54" data-type="indexterm" id="idm45849696514592"/><a data-startref="ch9_term55" data-type="indexterm" id="idm45849696513984"/>the expected text.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Test Data" data-type="sect1"><div class="sect1" id="idm45849696512992">&#13;
<h1>Test Data</h1>&#13;
&#13;
<p>A relevant part <a data-primary="data selection for tests" data-type="indexterm" id="ch9_term56"/><a data-primary="input elements/data" data-type="indexterm" id="ch9_term57"/><a data-primary="test data selection" data-type="indexterm" id="ch9_term58"/><a data-primary="third-party technologies" data-secondary="test data selection" data-type="indexterm" id="ch9_term59"/>of any test case is the test data, i.e., the input data used to exercise the SUT. The selection of suitable test data is paramount for implementing effective tests. Differing techniques in classic testing theory for test data selection include:</p>&#13;
<dl>&#13;
<dt>Equivalence partitioning</dt>&#13;
<dd>&#13;
<p>The process <a data-primary="equivalence partitioning, input data and" data-type="indexterm" id="idm45849696506576"/>of testing by dividing all possible input test data into value sets that we assume to be processed in the same way.</p>&#13;
</dd>&#13;
<dt>Boundary testing</dt>&#13;
<dd>&#13;
<p>The process <a data-primary="boundary testing" data-type="indexterm" id="idm45849696504560"/>of testing between extreme ends or between partitions of the input values. The basic idea of this approach is to select the representative limit values in an input domain (for example, below the minimum, minimum, just above the minimum, nominal, just below the maximum, maximum, and above the maximum value).</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>These approaches <a data-primary="end-to-end (E2E) testing" data-secondary="challenges with" data-type="indexterm" id="idm45849696503184"/>can be impractical in end-to-end testing since the required number of tests (and the resulting execution time) to carry out these strategies can be enormous. Alternatively, we typically select some representative test data manually to verify the <em>happy path</em> (i.e., <em>positive</em> testing), and optionally, some test data for unexpected conditions (<em>negative</em> testing).</p>&#13;
&#13;
<p>Another alternative <a data-primary="fake data" data-type="indexterm" id="ch9_term60"/><a data-primary="Java Faker" data-type="indexterm" id="ch9_term61"/><a data-primary="third-party technologies" data-secondary="Java Faker" data-type="indexterm" id="ch9_term62"/>for selecting test data is using <em>fake</em> data, i.e., random data of different domains, such as personal names, surnames, addresses, countries, emails, phone numbers, etc. A simple alternative to this aim is using <a href="https://dius.github.io/java-faker">Java Faker</a>, a port of the popular <a href="https://github.com/faker-ruby/faker">faker</a> Ruby gem. <a data-type="xref" href="#javafaker-test">Example 9-11</a> shows a test using this library. This test uses fake data to submit a web form available on the practice site. <a data-type="xref" href="#fake-data">Figure 9-6</a> shows this web page after submitting the form with that fake data.</p>&#13;
<div data-type="example" id="javafaker-test">&#13;
<h5><span class="label">Example 9-11. </span>Test using Java Faker to generate different types of fake data</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testFakeData</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/data-types.html"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">Faker</code><code> </code><code class="n">faker</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Faker</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO11-1" id="co_third_party_integrations_CO11-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"first-name"</code><code class="o">)</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO11-2" id="co_third_party_integrations_CO11-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">firstName</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"last-name"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">lastName</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"address"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">address</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">fullAddress</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"zip-code"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">address</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">zipCode</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"city"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">address</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">city</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"country"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">address</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">country</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"e-mail"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">internet</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">emailAddress</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"phone"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">phoneNumber</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">phoneNumber</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"job-position"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">job</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">position</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="s">"company"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">faker</code><code class="o">.</code><code class="na">company</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">name</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"form"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">submit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">WebElement</code><code class="o">&gt;</code><code> </code><code class="n">successElement</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">findElements</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">className</code><code class="o">(</code><code class="s">"alert-success"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">successElement</code><code class="o">)</code><code class="o">.</code><code class="na">hasSize</code><code class="o">(</code><code class="mi">10</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO11-3" id="co_third_party_integrations_CO11-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">WebElement</code><code class="o">&gt;</code><code> </code><code class="n">errorElement</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">findElements</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">className</code><code class="o">(</code><code class="s">"alert-danger"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">errorElement</code><code class="o">)</code><code class="o">.</code><code class="na">isEmpty</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO11-4" id="co_third_party_integrations_CO11-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO11-1" id="callout_third_party_integrations_CO11-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create an instance of Java Faker.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO11-2" id="callout_third_party_integrations_CO11-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We send random data of different types (name, address, country, etc.).</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO11-3" id="callout_third_party_integrations_CO11-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We verify that the data is submitted correctly.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO11-4" id="callout_third_party_integrations_CO11-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We check there are no errors on the page.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="fake-data">&#13;
<img alt="hosw 0906" src="assets/hosw_0906.png"/>&#13;
<h6><span class="label">Figure 9-6. </span>Practice page using fake data</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Reporting" data-type="sect1"><div class="sect1" id="idm45849696404720">&#13;
<h1>Reporting</h1>&#13;
&#13;
<p>A <em>test report</em> is a <a data-startref="ch9_term56" data-type="indexterm" id="idm45849696402320"/><a data-startref="ch9_term57" data-type="indexterm" id="idm45849696401584"/><a data-startref="ch9_term58" data-type="indexterm" id="idm45849696400912"/><a data-startref="ch9_term59" data-type="indexterm" id="idm45849696400240"/><a data-startref="ch9_term60" data-type="indexterm" id="idm45849696399568"/><a data-startref="ch9_term61" data-type="indexterm" id="idm45849696398896"/><a data-startref="ch9_term62" data-type="indexterm" id="idm45849696398224"/><a data-primary="reporting of test results" data-type="indexterm" id="ch9_term63"/><a data-primary="third-party technologies" data-secondary="for reporting of test results" data-secondary-sortas="reporting of test results" data-type="indexterm" id="ch9_term64"/>document that summarizes the results after executing a test suite. This document typically contains the number of tests executed plus their verdicts (pass, fail, skip) and execution time. There are different ways to obtain a test report in our Java project. For example, <a data-primary="Maven" data-secondary="test report creation in" data-type="indexterm" id="idm45849696394976"/>when using Maven, we can create a basic test report using the following commands:</p>&#13;
&#13;
<pre data-type="programlisting">mvn test <a class="co" href="#callout_third_party_integrations_CO12-1" id="co_third_party_integrations_CO12-1"><img alt="1" src="assets/1.png"/></a>&#13;
mvn surefire-report:report-only <a class="co" href="#callout_third_party_integrations_CO12-2" id="co_third_party_integrations_CO12-2"><img alt="2" src="assets/2.png"/></a>&#13;
mvn site -DgenerateReports=false <a class="co" href="#callout_third_party_integrations_CO12-3" id="co_third_party_integrations_CO12-3"><img alt="3" src="assets/3.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO12-1" id="callout_third_party_integrations_CO12-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We execute the test with Maven. As a result, the <a data-primary="Surefire plug-in" data-type="indexterm" id="idm45849695633392"/>Maven Surefire plug-in generated a set of XML files in the <code>target</code> folder. These files contain the results of the test execution.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO12-2" id="callout_third_party_integrations_CO12-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We convert <a data-primary="HTML" data-secondary="reports in" data-type="indexterm" id="ch9_term65"/>the XML reports into an HTML report. You can find this HTML report in your project folder <code>target/site</code>.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO12-3" id="callout_third_party_integrations_CO12-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We force a copy of the CSS and images required in the HTML report. <a data-type="xref" href="#surefire-report">Figure 9-7</a> shows a screenshot of this report.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="surefire-report">&#13;
<img alt="hosw 0907" src="assets/hosw_0907.png"/>&#13;
<h6><span class="label">Figure 9-7. </span>Test report  generated with Maven</h6>&#13;
</div></figure>&#13;
&#13;
<p>We can also generate an <a data-primary="Gradle" data-secondary="test report creation in" data-type="indexterm" id="idm45849695622144"/>equivalent report using Gradle. After executing a test suite with this build tool, Gradle automatically generates an HTML report in the folder <code>build/reports</code>. <a data-type="xref" href="#gradle-report">Figure 9-8</a> shows an example of the test report generated for executing a group of tests (using the shell command <code>gradle test --tests Hello*</code>).</p>&#13;
&#13;
<figure><div class="figure" id="gradle-report">&#13;
<img alt="hosw 0908" src="assets/hosw_0908.png"/>&#13;
<h6><span class="label">Figure 9-8. </span>Test report  generated with Gradle</h6>&#13;
</div></figure>&#13;
&#13;
<p>In addition to Maven and Gradle, we can use existing reporting libraries to create richer reports. A possible <a data-primary="Extent Reports" data-type="indexterm" id="ch9_term66"/><a data-primary="third-party technologies" data-secondary="Extent Reports" data-type="indexterm" id="ch9_term67"/>alternative is <a href="https://www.extentreports.com">Extent Reports</a>, a library to create interactive test reports. Extent Reports provides professional (commercial) and community (open source) editions. <a data-type="xref" href="#extentreports-test">Example 9-12</a> shows a test using the latter.</p>&#13;
<div data-type="example" id="extentreports-test">&#13;
<h5><span class="label">Example 9-12. </span>Test using Extent Reports to generate an HTML report</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">ReportingJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="n">ExtentReports</code><code> </code><code class="n">reports</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeAll</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setupClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">reports</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ExtentReports</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO13-1" id="co_third_party_integrations_CO13-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">ExtentSparkReporter</code><code> </code><code class="n">htmlReporter</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ExtentSparkReporter</code><code class="o">(</code><code>&#13;
</code><code>                </code><code class="s">"extentReport.html"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">reports</code><code class="o">.</code><code class="na">attachReporter</code><code class="o">(</code><code class="n">htmlReporter</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO13-2" id="co_third_party_integrations_CO13-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="n">TestInfo</code><code> </code><code class="n">testInfo</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">reports</code><code class="o">.</code><code class="na">createTest</code><code class="o">(</code><code class="n">testInfo</code><code class="o">.</code><code class="na">getDisplayName</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_third_party_integrations_CO13-3" id="co_third_party_integrations_CO13-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterAll</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">teardownClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">reports</code><code class="o">.</code><code class="na">flush</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1">// Test methods </code><a class="co" href="#callout_third_party_integrations_CO13-4" id="co_third_party_integrations_CO13-4"><img alt="4" src="assets/4.png"/></a><code class="c1">&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO13-1" id="callout_third_party_integrations_CO13-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create an instance of the test reporter.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO13-2" id="callout_third_party_integrations_CO13-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We configure it to generate an HTML report.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO13-3" id="callout_third_party_integrations_CO13-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>After each test, we create an entry in the test report using the test name as an identifier. In JUnit 5, <a data-primary="TestInfo parameter" data-type="indexterm" id="idm45849695920080"/>we use <code>TestInfo</code>, a built-in parameter resolver that allows retrieving information about the current test.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO13-4" id="callout_third_party_integrations_CO13-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>As usual, you can find the complete source code in the <a href="https://github.com/bonigarcia/selenium-webdriver-java">examples repository</a>. In particular, this class has two test methods. <a data-type="xref" href="#extent-report">Figure 9-9</a> shows the resulting test report generated when this test class is executed.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="extent-report">&#13;
<img alt="hosw 0909" src="assets/hosw_0909.png"/>&#13;
<h6><span class="label">Figure 9-9. </span>Test report generated with Extent Reports</h6>&#13;
</div></figure>&#13;
&#13;
<p>An inconvenience of Extent Reports is that we need to add each test explicitly to the reporter. A possible <a data-primary="listeners" data-secondary="test (for groupings)" data-type="indexterm" id="idm45849696027312"/><a data-primary="test listeners" data-type="indexterm" id="idm45849696026336"/>solution to this problem is using custom test listeners (as explained in <a data-type="xref" href="ch08.html#sect-test-listeners">“Test Listeners”</a>) to group the common logic for <a data-startref="ch9_term65" data-type="indexterm" id="idm45849696024736"/><a data-startref="ch9_term66" data-type="indexterm" id="idm45849696024064"/><a data-startref="ch9_term67" data-type="indexterm" id="idm45849696023392"/>reporting.</p>&#13;
&#13;
<p>Another possible <a data-primary="Allure" data-type="indexterm" id="idm45849696021952"/><a data-primary="third-party technologies" data-secondary="Allure" data-type="indexterm" id="idm45849696021216"/>library for generating rich test reports is <a href="http://allure.qatools.ru">Allure</a>, an open source reporting framework for generating test reports for different programming languages, including Java, Python, and JavaScript, among others. A notable difference between Allure and Extent Reports is that <a data-primary="configuration" data-secondary="for Gradle" data-secondary-sortas="Gradle" data-type="indexterm" id="idm45849696019456"/><a data-primary="configuration" data-secondary="for Maven" data-secondary-sortas="Maven" data-type="indexterm" id="idm45849696018208"/><a data-primary="Gradle" data-secondary="configuration in" data-type="indexterm" id="idm45849696016992"/><a data-primary="Gradle" data-secondary="test report creation in" data-type="indexterm" id="idm45849696016048"/><a data-primary="Maven" data-secondary="configuration in" data-type="indexterm" id="idm45849696015104"/><a data-primary="Maven" data-secondary="test report creation in" data-type="indexterm" id="idm45849696014160"/>Allure uses a test listener configured in the build tool Maven or Gradle (see <a data-type="xref" href="app03.html#appendix03">Appendix C</a> for further details about this configuration). This way, we did not need to change our test suite for generating Allure reports. <a data-type="xref" href="#allure-commands">Table 9-1</a> summarizes the necessary commands to create Allure reports with Maven and Gradle.</p>&#13;
<table id="allure-commands">&#13;
<caption><span class="label">Table 9-1. </span>Maven and Gradle commands to generate test reports with Allure</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Maven</th>&#13;
<th>Gradle</th>&#13;
<th>Description</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-type="programlisting">mvn test&#13;
mvn allure:report&#13;
mvn allure:serve</pre></div></td>&#13;
<td><div>&#13;
<pre data-type="programlisting">gradle test&#13;
gradle allureReport&#13;
gradle allureServe</pre></div></td>&#13;
<td><p>Run test cases<br/>&#13;
Create the reports on the target folder<br/>&#13;
Open the HTML report using a local web server (as shown in <a data-type="xref" href="#allure-report">Figure 9-10</a>)</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<figure><div class="figure" id="allure-report">&#13;
<img alt="hosw 0910" src="assets/hosw_0910.png"/>&#13;
<h6><span class="label">Figure 9-10. </span>Test report  generated with Allure and served locally</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Behavior Driven Development" data-type="sect1"><div class="sect1" id="idm45849696404160">&#13;
<h1>Behavior Driven Development</h1>&#13;
&#13;
<p>As <a data-startref="ch9_term63" data-type="indexterm" id="idm45849695999744"/><a data-startref="ch9_term64" data-type="indexterm" id="idm45849695998624"/>introduced in <a data-type="xref" href="ch01.html#ch01">Chapter 1</a>, Behavior Driven Development (BDD) is a software <a data-primary="Behavior Driven Development (BDD)" data-type="indexterm" id="ch9_term68"/><a data-primary="Cucumber" data-type="indexterm" id="ch9_term69"/><a data-primary="Gherkin notation" data-type="indexterm" id="ch9_term70"/><a data-primary="scenarios" data-secondary="with Gherkin for BDD" data-secondary-sortas="Gherkin for BDD" data-type="indexterm" id="ch9_term71"/><a data-primary="third-party technologies" data-secondary="with BDD user scenarios" data-secondary-sortas="BDD user scenarios" data-type="indexterm" id="ch9_term72"/><a data-primary="third-party technologies" data-secondary="Cucumber" data-type="indexterm" id="ch9_term73"/><a data-primary="user scenarios" data-type="indexterm" id="ch9_term74"/><a data-primary="user testing" data-type="indexterm" id="ch9_term75"/>methodology that promotes the development and testing of software systems using high-level user scenarios. Different tools implement the BDD methodology. One of the most popular is <a href="https://cucumber.io">Cucumber</a>. Cucumber executes tests based on user stories written in <em>Gherkin</em>, a human-readable notation based on natural languages (e.g., English and others). Gherkin was designed to be used by nonprogrammers (e.g., customers or end users), and its main keywords are listed next (see the <a href="https://cucumber.io/docs/gherkin">Gherkin user manual</a> for further information):</p>&#13;
<dl>&#13;
<dt>Feature</dt>&#13;
<dd>&#13;
<p>High-level description of the software feature tested.</p>&#13;
</dd>&#13;
<dt>Scenario</dt>&#13;
<dd>&#13;
<p>Concrete test that illustrates a business rule. Scenarios describe different pieces of information (called <em>steps</em> in the Gherkin jargon), such as:</p>&#13;
<dl>&#13;
<dt>Given</dt>&#13;
<dd>&#13;
<p>Preconditions and initial state</p>&#13;
</dd>&#13;
<dt>When</dt>&#13;
<dd>&#13;
<p>User actions</p>&#13;
</dd>&#13;
<dt>And</dt>&#13;
<dd>&#13;
<p>Additional user actions</p>&#13;
</dd>&#13;
<dt>Then</dt>&#13;
<dd>&#13;
<p>Expected outcome</p>&#13;
</dd>&#13;
</dl>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#gherkin-scenario">Example 9-13</a> shows a Gherkin feature <a data-primary="login form, test cases with" data-type="indexterm" id="ch9_term76"/>containing two scenarios for a test login (successful and failed).</p>&#13;
<div data-type="example" id="gherkin-scenario">&#13;
<h5><span class="label">Example 9-13. </span>Gherkin scenarios for login into the practice site</h5>&#13;
&#13;
<pre data-type="programlisting">Feature: Login in practice site <a class="co" href="#callout_third_party_integrations_CO14-1" id="co_third_party_integrations_CO14-1"><img alt="1" src="assets/1.png"/></a>&#13;
&#13;
  Scenario: Successful login <a class="co" href="#callout_third_party_integrations_CO14-2" id="co_third_party_integrations_CO14-2"><img alt="2" src="assets/2.png"/></a>&#13;
    Given I use "Chrome" <a class="co" href="#callout_third_party_integrations_CO14-3" id="co_third_party_integrations_CO14-3"><img alt="3" src="assets/3.png"/></a>&#13;
    When I navigate to&#13;
        "https://bonigarcia.dev/selenium-webdriver-java/login-form.html" <a class="co" href="#callout_third_party_integrations_CO14-4" id="co_third_party_integrations_CO14-4"><img alt="4" src="assets/4.png"/></a>&#13;
    And I log in with the username "user" and password "user" <a class="co" href="#callout_third_party_integrations_CO14-5" id="co_third_party_integrations_CO14-5"><img alt="5" src="assets/5.png"/></a>&#13;
    And I click Submit&#13;
    Then I should see the message "Login successful" <a class="co" href="#callout_third_party_integrations_CO14-6" id="co_third_party_integrations_CO14-6"><img alt="6" src="assets/6.png"/></a>&#13;
&#13;
  Scenario: Failure login <a class="co" href="#callout_third_party_integrations_CO14-7" id="co_third_party_integrations_CO14-7"><img alt="7" src="assets/7.png"/></a>&#13;
    Given I use "Chrome"&#13;
    When I navigate to&#13;
        "https://bonigarcia.dev/selenium-webdriver-java/login-form.html"&#13;
    And I log in with the username "bad-user" and password "bad-password"&#13;
    And I click Submit&#13;
    Then I should see the message "Invalid credentials"</pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO14-1" id="callout_third_party_integrations_CO14-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Feature description</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO14-2" id="callout_third_party_integrations_CO14-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>First scenario (login successful)</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO14-3" id="callout_third_party_integrations_CO14-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Browser to be used</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO14-4" id="callout_third_party_integrations_CO14-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Web page URL</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO14-5" id="callout_third_party_integrations_CO14-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Set of actions (type credentials and click the Submit button)</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO14-6" id="callout_third_party_integrations_CO14-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>Expected message</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO14-7" id="callout_third_party_integrations_CO14-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>Second scenario (login failed)</p></dd>&#13;
</dl>&#13;
&#13;
<p>To run Gherkin scenarios as test cases, we <a data-primary="step definitions in Gherkin" data-type="indexterm" id="ch9_term77"/>must first create the corresponding <em>step definitions</em>. A step <a data-primary="glue code" data-type="indexterm" id="idm45849696289984"/>definition is a <em>glue code</em> that exercises the SUT using the information specified in the scenario. In Java, we use annotations (such as <code>@Given</code>, <code>@Then</code>, <code>@When</code>, or <code>@And</code>) to decorate methods implementing each step. These annotations contain a string value to map each step definition and the parameters. <a data-type="xref" href="#cucumber-steps">Example 9-14</a> shows a step definition for the Gherkin scenario defined on <a data-type="xref" href="#gherkin-scenario">Example 9-13</a>. We use the Selenium WebDriver API to implement the required actions for navigation, web element interaction, etc.</p>&#13;
<div data-type="example" id="cucumber-steps">&#13;
<h5><span class="label">Example 9-14. </span>Steps to log in to the practice site with Cucumber</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">LoginSteps</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Given</code><code class="o">(</code><code class="s">"I use {string}"</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO15-1" id="co_third_party_integrations_CO15-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">iUse</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">browser</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">getInstance</code><code class="o">(</code><code class="n">browser</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@When</code><code class="o">(</code><code class="s">"I navigate to {string}"</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO15-2" id="co_third_party_integrations_CO15-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">iNavigateTo</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">url</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">url</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@And</code><code class="o">(</code><code class="s">"I log in with the username {string} and password {string}"</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO15-3" id="co_third_party_integrations_CO15-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">iLogin</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">username</code><code class="o">,</code><code> </code><code class="n">String</code><code> </code><code class="n">password</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"username"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">username</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"password"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">password</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@And</code><code class="o">(</code><code class="s">"I click Submit"</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO15-4" id="co_third_party_integrations_CO15-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">iPressEnter</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">cssSelector</code><code class="o">(</code><code class="s">"button"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Then</code><code class="o">(</code><code class="s">"I should see the message {string}"</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO15-5" id="co_third_party_integrations_CO15-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">iShouldSee</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">result</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="k">try</code><code> </code><code class="o">{</code><code>&#13;
</code><code>            </code><code class="n">String</code><code> </code><code class="n">bodyText</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="n">assertThat</code><code class="o">(</code><code class="n">bodyText</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="n">result</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code> </code><code class="k">finally</code><code> </code><code class="o">{</code><code>&#13;
</code><code>            </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO15-1" id="callout_third_party_integrations_CO15-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the first step to create a <code>WebDriver</code> instance.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO15-2" id="callout_third_party_integrations_CO15-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We open the URL.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO15-3" id="callout_third_party_integrations_CO15-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We type the <a data-primary="credentials, authentication" data-type="indexterm" id="idm45849695524400"/>credentials.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO15-4" id="callout_third_party_integrations_CO15-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We click on the Submit button.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO15-5" id="callout_third_party_integrations_CO15-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We verify that the expected message is on the page.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Finally, we need to run our step definition as a test case. As usual, we create that test using a unit testing framework. This test is unit testing framework-dependent in the integration with Cucumber. In other words, the required <a data-primary="JUnit 4" data-secondary="Cucumber test with" data-type="indexterm" id="idm45849695518720"/><a data-primary="JUnit 5" data-secondary="Cucumber test with" data-type="indexterm" id="ch9_term78"/><a data-primary="TestNG" data-secondary="Cucumber test with" data-type="indexterm" id="ch9_term79"/>code is different in JUnit 4 (see <a data-type="xref" href="#cucumber-junit4">Example 9-15</a>), JUnit 5 (see <a data-type="xref" href="#cucumber-junit5">Example 9-16</a>), and TestNG (see <a data-type="xref" href="#cucumber-testng">Example 9-17</a>). The resulting tests are executed in the <a data-startref="ch9_term76" data-type="indexterm" id="idm45849695430880"/>usual way (i.e., using the shell or an IDE).</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Selenium-Jupiter does not provide any additional features for integrating with Cucumber, so the default JUnit 5 procedure is the same in the Selenium-Jupiter project in the examples repository.</p>&#13;
</div>&#13;
<div class="pagebreak-before less_space" data-type="example" id="cucumber-junit4">&#13;
<h5><span class="label">Example 9-15. </span>Cucumber test using JUnit 4</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@RunWith</code><code class="o">(</code><code class="n">Cucumber</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO16-1" id="co_third_party_integrations_CO16-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="nd">@CucumberOptions</code><code class="o">(</code><code class="n">features</code><code> </code><code class="o">=</code><code> </code><code class="s">"classpath:io/github/bonigarcia"</code><code class="o">,</code><code> </code><code class="n">glue</code><code> </code><code class="o">=</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="s">"io.github.bonigarcia"</code><code> </code><code class="o">}</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO16-2" id="co_third_party_integrations_CO16-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">CucumberTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO16-1" id="callout_third_party_integrations_CO16-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the Cucumber runner to execute the step definitions as test cases.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO16-2" id="callout_third_party_integrations_CO16-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We specify the location of the Gherkin scenarios. In this case, the feature is the folder <code>io/github/bonigarcia</code> in the project classpath (concretely, in the <code>src/test/resources</code> folder). This <a data-primary="glue code" data-type="indexterm" id="idm45849695397216"/>annotation also specified the initial package to search the glue code (i.e., the steps definition).</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="cucumber-junit5">&#13;
<h5><span class="label">Example 9-16. </span>Cucumber test using JUnit 5</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Suite</code><code> </code><a class="co" href="#callout_third_party_integrations_CO17-1" id="co_third_party_integrations_CO17-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="nd">@IncludeEngines</code><code class="o">(</code><code class="s">"cucumber"</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO17-2" id="co_third_party_integrations_CO17-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="nd">@SelectClasspathResource</code><code class="o">(</code><code class="s">"io/github/bonigarcia"</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO17-3" id="co_third_party_integrations_CO17-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="nd">@ConfigurationParameter</code><code class="o">(</code><code class="n">key</code><code> </code><code class="o">=</code><code> </code><code class="n">GLUE_PROPERTY_NAME</code><code class="o">,</code><code> </code><code class="n">value</code><code> </code><code class="o">=</code><code> </code><code class="s">"io.github.bonigarcia"</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO17-4" id="co_third_party_integrations_CO17-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">CucumberTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO17-1" id="callout_third_party_integrations_CO17-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We need to use the JUnit 5 suite module to run Cucumber tests.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO17-2" id="callout_third_party_integrations_CO17-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We include the <a data-primary="JUnit Platform Launcher API" data-type="indexterm" id="idm45849695326528"/>Cucumber engine in the JUnit Platform.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO17-3" id="callout_third_party_integrations_CO17-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We specify the path for features within the project classpath.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO17-4" id="callout_third_party_integrations_CO17-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We set the initial package to search the glue code.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="cucumber-testng">&#13;
<h5><span class="label">Example 9-17. </span>Cucumber test using TestNG</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@CucumberOptions</code><code class="o">(</code><code class="n">features</code><code> </code><code class="o">=</code><code> </code><code class="s">"classpath:io/github/bonigarcia"</code><code class="o">,</code><code> </code><code class="n">glue</code><code> </code><code class="o">=</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="s">"io.github.bonigarcia"</code><code> </code><code class="o">}</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO18-1" id="co_third_party_integrations_CO18-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">CucumberTest</code><code> </code><code class="kd">extends</code><code> </code><code class="n">AbstractTestNGCucumberTests</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_third_party_integrations_CO18-2" id="co_third_party_integrations_CO18-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO18-1" id="callout_third_party_integrations_CO18-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We specify the location of the Gherkin scenarios and the package to search the glue code.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO18-2" id="callout_third_party_integrations_CO18-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We extend a TestNG parent test class for Cucumber <a data-startref="ch9_term68" data-type="indexterm" id="idm45849695254080"/><a data-startref="ch9_term69" data-type="indexterm" id="idm45849695253376"/><a data-startref="ch9_term70" data-type="indexterm" id="idm45849695252704"/><a data-startref="ch9_term71" data-type="indexterm" id="idm45849695252032"/><a data-startref="ch9_term72" data-type="indexterm" id="idm45849695251360"/><a data-startref="ch9_term73" data-type="indexterm" id="idm45849695250688"/><a data-startref="ch9_term74" data-type="indexterm" id="idm45849695222352"/><a data-startref="ch9_term75" data-type="indexterm" id="idm45849695221712"/><a data-startref="ch9_term77" data-type="indexterm" id="idm45849695221040"/><a data-startref="ch9_term78" data-type="indexterm" id="idm45849695220368"/><a data-startref="ch9_term79" data-type="indexterm" id="idm45849695219696"/>tests.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Frameworks" data-type="sect1"><div class="sect1" id="idm45849696000688">&#13;
<h1>Web Frameworks</h1>&#13;
&#13;
<p>Web frameworks are <a data-primary="software project development" data-secondary="web frameworks for" data-type="indexterm" id="idm45849695217104"/><a data-primary="Spring portfolio" data-type="indexterm" id="idm45849695216128"/><a data-primary="Java" data-secondary="for Spring framework" data-secondary-sortas="Spring framework" data-type="indexterm" id="idm45849695215456"/><a data-primary="web frameworks" data-type="indexterm" id="ch9_term80"/><a data-primary="third-party technologies" data-secondary="for web frameworks" data-secondary-sortas="web frameworks" data-type="indexterm" id="ch9_term81"/>software frameworks designed to support the development of web applications and services. One of the most popular frameworks for the Java language is the <a href="https://spring.io">Spring Framework</a>. Spring is an open source framework for building Java applications, including enterprise web applications and services. The <a data-primary="Inversion of Control (IoC)" data-type="indexterm" id="idm45849695211056"/>core technology of Spring is known as <em>Inversion of Control</em> (IoC), which is a procedure to create instances outside the class in which these objects are used. These objects, called <em>beans</em> or <em>components</em> in the Spring jargon, are later injected on demand as dependencies by the Spring IoC container.</p>&#13;
&#13;
<p>The following <a data-primary="Spring-Boot" data-type="indexterm" id="ch9_term82"/><a data-primary="third-party technologies" data-secondary="Spring-Boot" data-type="indexterm" id="ch9_term83"/>examples show basic tests that verify a local web application created with <a href="https://spring.io/projects/spring-boot">Spring-Boot</a>, a subproject of the Spring portfolio that simplifies the development of Spring-based applications thanks to convention over configuration and autodiscovery features. In addition, Spring-Boot provides an embedded web server to ease the development of web applications. The integration with Selenium WebDriver in this kind of project facilitates the testing process of Spring-based web applications by deploying automatically in the embedded web server per test case.</p>&#13;
&#13;
<p>The code to <a data-primary="JUnit 4" data-secondary="Spring-Boot test with" data-type="indexterm" id="idm45849695204752"/><a data-primary="JUnit 5" data-secondary="Spring-Boot test with" data-type="indexterm" id="idm45849695203776"/><a data-primary="JUnit 5 with Selenium-Jupiter" data-secondary="Spring-Boot test with" data-type="indexterm" id="idm45849695202800"/><a data-primary="TestNG" data-secondary="Spring-Boot test with" data-type="indexterm" id="ch9_term84"/>integrate Spring-Boot with Selenium WebDriver and the unit testing frameworks used in this book is different. <a data-type="xref" href="#spring-junit4">Example 9-18</a> shows a test integrating Spring-Boot and JUnit 4. <a data-type="xref" href="#spring-testng">Example 9-19</a> shows the differences when using TestNG, <a data-type="xref" href="#spring-junit5">Example 9-20</a> illustrates how to use JUnit 5, and finally, <a data-type="xref" href="#spring-sel-jup">Example 9-21</a> shows a Spring test based on JUnit 5 with Selenium-Jupiter.</p>&#13;
<div data-type="example" id="spring-junit4">&#13;
<h5><span class="label">Example 9-18. </span>Test using Spring-Boot and JUnit 4</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@RunWith</code><code class="o">(</code><code class="n">SpringRunner</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO19-1" id="co_third_party_integrations_CO19-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="nd">@SpringBootTest</code><code class="o">(</code><code class="n">classes</code><code> </code><code class="o">=</code><code> </code><code class="n">SpringBootDemoApp</code><code class="o">.</code><code class="na">class</code><code class="o">,</code><code>&#13;
</code><code>        </code><code class="n">webEnvironment</code><code> </code><code class="o">=</code><code> </code><code class="n">SpringBootTest</code><code class="o">.</code><code class="na">WebEnvironment</code><code class="o">.</code><code class="na">RANDOM_PORT</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO19-2" id="co_third_party_integrations_CO19-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">SpringBootJUnit4Test</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@LocalServerPort</code><code> </code><a class="co" href="#callout_third_party_integrations_CO19-3" id="co_third_party_integrations_CO19-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="kd">protected</code><code> </code><code class="kt">int</code><code> </code><code class="n">serverPort</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Before</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@After</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">testSpringBoot</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"http://localhost:"</code><code> </code><code class="o">+</code><code> </code><code class="n">serverPort</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">bodyText</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">bodyText</code><code class="o">)</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"This is a local site served by Spring-Boot"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO19-1" id="callout_third_party_integrations_CO19-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the Spring runner in JUnit 4.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO19-2" id="callout_third_party_integrations_CO19-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We use a Spring-Boot annotation for tests to define the Spring-Boot class name. Also, we specify the web application is deployed using a random available port.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO19-3" id="callout_third_party_integrations_CO19-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We inject the web application port as a class attribute.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="spring-testng">&#13;
<h5><span class="label">Example 9-19. </span>Test using Spring-Boot and TestNG</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@SpringBootTest</code><code class="o">(</code><code class="n">classes</code><code> </code><code class="o">=</code><code> </code><code class="n">SpringBootDemoApp</code><code class="o">.</code><code class="na">class</code><code class="o">,</code><code>&#13;
</code><code>        </code><code class="n">webEnvironment</code><code> </code><code class="o">=</code><code> </code><code class="n">SpringBootTest</code><code class="o">.</code><code class="na">WebEnvironment</code><code class="o">.</code><code class="na">RANDOM_PORT</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO20-1" id="co_third_party_integrations_CO20-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">SpringBootNGTest</code><code> </code><code class="kd">extends</code><code> </code><code class="n">AbstractTestNGSpringContextTests</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_third_party_integrations_CO20-2" id="co_third_party_integrations_CO20-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1">// Same logic as the previous test&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO20-1" id="callout_third_party_integrations_CO20-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the <a data-primary="@SpringBootTest annotation" data-primary-sortas="SpringBootTest annotation" data-type="indexterm" id="idm45849694957408"/>annotation <code>@SpringBootTest</code> in the same way in JUnit 4.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO20-2" id="callout_third_party_integrations_CO20-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We extend a TestNG parent to run this test using the Spring <a data-startref="ch9_term84" data-type="indexterm" id="idm45849694953344"/><a data-primary="JUnit 5" data-secondary="Spring-Boot test with" data-type="indexterm" id="idm45849694952640"/><a data-primary="JUnit 5" data-secondary="Jupiter and" data-type="indexterm" id="idm45849694951696"/><a data-primary="Jupiter" data-secondary="JUnit 5 and" data-type="indexterm" id="idm45849694950752"/>context.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="spring-junit5">&#13;
<h5><span class="label">Example 9-20. </span>Test using Spring-Boot and JUnit 5</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@ExtendWith</code><code class="o">(</code><code class="n">SpringExtension</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO21-1" id="co_third_party_integrations_CO21-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="nd">@SpringBootTest</code><code class="o">(</code><code class="n">classes</code><code> </code><code class="o">=</code><code> </code><code class="n">SpringBootDemoApp</code><code class="o">.</code><code class="na">class</code><code class="o">,</code><code>&#13;
</code><code>        </code><code class="n">webEnvironment</code><code> </code><code class="o">=</code><code> </code><code class="n">SpringBootTest</code><code class="o">.</code><code class="na">WebEnvironment</code><code class="o">.</code><code class="na">RANDOM_PORT</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO21-2" id="co_third_party_integrations_CO21-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="kd">class</code><code> </code><code class="nc">SpringBootJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1">// Same logic as the previous test&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO21-1" id="callout_third_party_integrations_CO21-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the JUnit 5 Spring extension to integrate the Spring context in a Jupiter test.</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO21-2" id="callout_third_party_integrations_CO21-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We use Spring-Boot to start our Spring application context as in <a data-primary="JUnit 5 with Selenium-Jupiter" data-secondary="Spring-Boot test with" data-type="indexterm" id="idm45849694881072"/>the previous examples.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="spring-sel-jup">&#13;
<h5><span class="label">Example 9-21. </span>Test using Spring-Boot and JUnit 5 plus Selenium-Jupiter</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@ExtendWith</code><code class="o">(</code><code class="o">{</code><code> </code><code class="n">SeleniumJupiter</code><code class="o">.</code><code class="na">class</code><code class="o">,</code><code> </code><code class="n">SpringExtension</code><code class="o">.</code><code class="na">class</code><code> </code><code class="o">}</code><code class="o">)</code><code> </code><a class="co" href="#callout_third_party_integrations_CO22-1" id="co_third_party_integrations_CO22-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="nd">@SpringBootTest</code><code class="o">(</code><code class="n">classes</code><code> </code><code class="o">=</code><code> </code><code class="n">SpringBootDemoApp</code><code class="o">.</code><code class="na">class</code><code class="o">,</code><code>&#13;
</code><code>        </code><code class="n">webEnvironment</code><code> </code><code class="o">=</code><code> </code><code class="n">SpringBootTest</code><code class="o">.</code><code class="na">WebEnvironment</code><code class="o">.</code><code class="na">RANDOM_PORT</code><code class="o">)</code><code>&#13;
</code><code class="kd">class</code><code> </code><code class="nc">SpringBootSelJupTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@LocalServerPort</code><code>&#13;
</code><code>    </code><code class="kd">protected</code><code> </code><code class="kt">int</code><code> </code><code class="n">serverPort</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testSpringBoot</code><code class="o">(</code><code class="n">ChromeDriver</code><code> </code><code class="n">driver</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_third_party_integrations_CO22-2" id="co_third_party_integrations_CO22-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"http://localhost:"</code><code> </code><code class="o">+</code><code> </code><code class="n">serverPort</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">bodyText</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">bodyText</code><code class="o">)</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"This is a local site served by Spring-Boot"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_third_party_integrations_CO22-1" id="callout_third_party_integrations_CO22-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>In the case of Selenium-Jupiter, we use two JUnit 5 extensions (for Spring and Selenium WebDriver).</p></dd>&#13;
<dt><a class="co" href="#co_third_party_integrations_CO22-2" id="callout_third_party_integrations_CO22-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>As usual in Selenium-Jupiter, we use the JUnit 5 parameter resolution mechanism to declare the type of <code>WebDriver</code> instance we use in this <a data-startref="ch9_term80" data-type="indexterm" id="idm45849694747296"/><a data-startref="ch9_term81" data-type="indexterm" id="idm45849694746592"/><a data-startref="ch9_term82" data-type="indexterm" id="idm45849694745920"/><a data-startref="ch9_term83" data-type="indexterm" id="idm45849694745248"/>test.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary and Outlook" data-type="sect1"><div class="sect1" id="idm45849695218304">&#13;
<h1>Summary and Outlook</h1>&#13;
&#13;
<p>This chapter provided a <a data-primary="third-party technologies" data-secondary="about" data-type="indexterm" id="idm45849694742976"/>practical overview for integrating different technologies (such as tools, libraries, and frameworks) in the development of end-to-end tests for web applications with Selenium WebDriver. First, we used Awaitility (a library to handle asynchronous operations) for waiting until files are downloaded with Selenium WebDriver. An alternative library to execute the same use case (i.e., downloading files) is Apache HttpClient. Then, we used the BrowserMob proxy to intercept the HTTP traffic exchanged by a Selenium WebDriver test. The next group of technologies focused on enabling nonfunctional testing with Selenium WebDriver: BrowserMob (to create a JMeter test plan for performance testing), OWASP ZAP (for security testing), and Axe (for accessibility testing). Then, we used the fluent API provided by Selenide, Java Faker, to create fake test data for Selenium WebDriver tests, and Extent Reports and Allure to generate rich test reports. Finally, we discovered how to integrate Cucumber (a BDD framework) and Spring (a Java and web framework) with Selenium WebDriver.</p>&#13;
&#13;
<p class="pagebreak-before">The next chapter concludes this book by presenting complementary frameworks <span class="keep-together">to Selenium</span> WebDriver, namely REST Assured (for testing REST services) and <span class="keep-together">Appium (for</span> testing mobile applications). Finally, the chapter presents several popular alternatives to Selenium WebDriver in the browser automation space: Cypress, <span class="keep-together">WebDriverIO</span>, TestCafe, Puppeteer, and Playwright.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>