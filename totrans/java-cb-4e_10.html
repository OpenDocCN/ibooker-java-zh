<html><head></head><body><section data-pdf-bookmark="Chapter 10. Input and Output: Reading, Writing, and Directory Tricks" data-type="chapter" epub:type="chapter"><div class="chapter" id="javacook-io">&#13;
<h1><span class="label">Chapter 10. </span>Input and Output: Reading, Writing, <span class="keep-together">and Directory Tricks</span></h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.0 Introduction" data-type="sect1"><div class="sect1" id="javacook-io-intro">&#13;
<h1>10.0 Introduction</h1>&#13;
&#13;
<p><a data-primary="input/output" data-type="indexterm" id="io_ch"/><a data-primary="Java" data-secondary="input/output in" data-type="indexterm" id="jav_io"/>Most programs need to interact with the outside world, and one&#13;
common way of doing so is by reading and writing files. Files are&#13;
normally on some persistent medium such as a disk drive; and, for&#13;
the most part, we shall happily ignore the differences between files on a&#13;
hard disk (and all the operating system–dependent filesystem types),&#13;
a USB drive or SD card, a DVD-ROM, and other memory devices. For now, they’re&#13;
just files. And, like most other languages and OSes, Java extends&#13;
the reading-and-writing model to network (socket) communications,&#13;
which we’ll touch on in Chapters <a data-type="xref" data-xrefstyle="select: labelnumber" href="ch12.html#javacook-netclient">12</a> and <a data-type="xref" data-xrefstyle="select: labelnumber" href="ch13.html#javacook-netserver">13</a>.</p>&#13;
&#13;
<p>Java provides many classes for input and output; they are summarized in <a data-type="xref" href="#javacook-io-FIG-1">Figure 10-1</a>. This chapter covers all the normal input/output operations such as opening/closing and reading/writing files. Files are assumed to reside on some kind of file store or permanent storage. Distributed filesystems such as Apache Hadoop HDFS, Sun’s Network File System (NFS, common on Unix and available for Windows), SMB (the Windows network filesystem, available for Unix via the open source Samba program), and FUSE (Filesystem in User SpacE, implementations for most Unix/Linux systems) are assumed to work just like disk filesystems, except where noted.</p>&#13;
&#13;
<p>The support for reading and writing is in two major parts:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The <code>InputStream</code>/<code>OutputStream</code>/<code>Reader</code>/<code>Writer</code> classes, which are the traditional ways of reading/writing files,&#13;
have been largely unchanged since the days of Java 1.0 and 1.1.&#13;
In modern Java, a new class, <code>java.nio.file.Files</code>, is <span class="keep-together">provided.</span></p>&#13;
</li>&#13;
<li>&#13;
<p>All modern operating systems provide the means to organize&#13;
groups of files into directories, or folders.&#13;
This chapter covers directories: how to create them, how to navigate them.&#13;
<code>Files</code> provides most of the support for processing directories,&#13;
but it also introduces a number of&#13;
convenience routines for easily reading, writing, and copying&#13;
files that are covered in this chapter.&#13;
These are generally more convenient than using the&#13;
traditional I/O classes.&#13;
We cover both in this chapter.</p>&#13;
</li>&#13;
</ul>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>There are two different uses of the term <em>stream</em>. The first is for a stream of bytes to be read or written, and is&#13;
unrelated to the second use, which is used in modern Java to refer to a connection among cooperating methods. I’ll try to keep these meanings straight by only using <code>InputStream</code> and/or <code>OutputStream</code>&#13;
for the former, and <code>Stream</code> for the latter.</p>&#13;
</div>&#13;
&#13;
<p>To give you control over the format of data that you read and write,&#13;
the <code>Formatter</code> and <code>Scanner</code> classes provide formatting and scanning operations.&#13;
<code>Formatter</code> allows many&#13;
formatting tasks to be performed either into a <code>String</code> or to almost&#13;
any output destination. <code>Scanner</code> parses many kinds of objects,&#13;
again either from a <code>String</code> or from almost any input source. These&#13;
are fairly powerful; each is given its own recipe in this&#13;
chapter.</p>&#13;
&#13;
<p>The second part of the chapter is largely devoted to the <code>Files</code> and <code>Path</code> classes in <code>java.nio.file</code>.&#13;
These two classes provide the ability to list directories, obtain file status, rename and delete files on disk, create directories, and perform other filesystem operations.&#13;
They also provide the ability to read a file line by line into a <code>Stream&lt;String&gt;</code>.&#13;
These two classes together largely supplant the older <code>java.io.File</code> class.&#13;
They were introduced in Java 7, so very little new code should be using the older <code>File</code> class.</p>&#13;
&#13;
<p>Note that many of the methods of this class attempt to modify the permanent file store, or disk filesystem, of the computer you run them on. Naturally, you might not have permission to change certain files in certain ways. This can be detected by the Java Virtual Machine’s <code>SecurityManager</code>, which will throw the unchecked exception <code>SecurityException</code> if you don’t have permission to do the attempted operation. But failure can also be detected by the underlying operating system: if the security manager approves it, but the user running your program lacks permissions on the directory, for example, you will either get back an indication (such as false) or an instance of the checked exception <code>IOException</code>. This must be caught (or declared in the <code>throws</code> clause) in any code that calls any method that tries to change the filesystem.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.1 About InputStreams/OutputStreams and Readers/Writers" data-type="sect1"><div class="sect1" id="javacook-io-intro.2">&#13;
<h1>10.1 About InputStreams/OutputStreams and <span class="keep-together">Readers/Writers</span></h1>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="streams" data-type="indexterm" id="idm45290657829928"/><a data-primary="streams" data-secondary="input/output" data-type="indexterm" id="idm45290657828728"/>Java provides two sets of classes for reading and writing. The <code>InputStream</code>/<code>OutputStream</code>&#13;
section of package <code>java.io</code> (see <a data-type="xref" href="#javacook-io-FIG-1">Figure 10-1</a>) is for reading&#13;
or writing bytes of data.&#13;
Older languages tended to assume that a byte&#13;
(which is a machine-specific collection of bits, usually eight bits on&#13;
modern computers) is exactly the same thing as a character—a letter,&#13;
digit, or other linguistic element. However, Java is designed to be used&#13;
internationally, and eight bits is simply not enough to handle the many&#13;
different character sets used around the world. Script-based languages, and pictographic languages like Chinese&#13;
and Japanese, each have many more than 256 characters, the maximum that&#13;
can be represented in an eight-bit byte. The unification of these many&#13;
character code sets is called, not surprisingly, Unicode. Both Java and&#13;
XML use Unicode as their character sets, allowing you to read and write&#13;
text in any of these human languages. But you should use <code>Reader</code>s&#13;
and <code>Writer</code>s, not <code>Stream</code>s, for textual data.</p>&#13;
&#13;
<p>Unicode itself doesn’t solve the entire problem. Many of these human languages were used on computers long before Unicode was invented, and they didn’t all pick the same representation as Unicode. And they all have zillions of files encoded in a particular representation that isn’t Unicode. So routines are needed when reading and writing to convert between Unicode <code>String</code> objects used inside the Java machine and the particular external representation in which a user’s files are written. These converters are packaged inside a powerful set of classes called <code>Reader</code>s and <code>Writer</code>s. <code>Reader</code>s and <code>Writer</code>s should always be used instead of <code>InputStream</code>s and <code>OutputStream</code>s when you want to deal with characters instead of bytes. We’ll see more on this conversion, and how to specify which conversion, a little later in this chapter.</p>&#13;
&#13;
<figure><div class="figure" id="javacook-io-FIG-1">&#13;
<img alt="jcb4 1001" src="assets/jcb4_1001.png"/>&#13;
<h6><span class="label">Figure 10-1. </span>java.io classes</h6>&#13;
</div></figure>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="javacook-io-intro.3">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>One topic <em>not</em> addressed in depth here is the reading/writing capabilities of <code>Channel</code>s classes in the Java “new I/O” package.<sup><a data-type="noteref" href="ch10.html#idm45290657814168" id="idm45290657814168-marker">1</a></sup> This part of NIO is more complex to use than either <code>Files</code> or the input/output streams, and the benefits accrue primarily in large-scale server-side processing. <a data-type="xref" href="ch04.html#javacook-regex-SECT-5">Recipe 4.5</a> provides one example of using NIO. The NIO package is given full coverage in the book <a data-primary="Hitchens, Ron" data-secondary="Java NIO" data-type="indexterm" id="idm45290657810296"/><a data-primary="Java NIO (Hitchens)" data-type="indexterm" id="idm45290657809352"/><em><a class="orm:hideurl" href="http://shop.oreilly.com/product/9780596002886.do">Java NIO</a></em> by Ron Hitchens (O’Reilly).</p>&#13;
&#13;
<p>Another topic not covered here is that of having the read or write occur concurrently with other program activity. This requires the use of threads, or multiple flows of control within a single program. Threaded I/O is a necessity in many programs: those reading from slow devices such as tape drives, those reading from or writing to network connections, and those with a GUI. For this reason, the topic is given considerable attention, in the context of multithreaded applications, in <a data-type="xref" href="ch16.html#javacook-threads">Chapter 16</a>.</p>&#13;
&#13;
<p>For traditional I/O topics, Elliotte Rusty Harold’s <a data-primary="Java I/O (Harold)" data-type="indexterm" id="idm45290657805496"/><a data-primary="Harold, Elliotte" data-secondary="Java I/O" data-type="indexterm" id="idm45290657804792"/><em><a class="orm:hideurl" href="http://shop.oreilly.com/product/9780596527501.do">Java I/O</a></em>, although somewhat dated, should be considered the antepenultimate documentation. The penultimate reference is the javadoc documentation, while the ultimate reference is, if you really need it, the source code for the Java API. Due in part to the quality of the javadoc documentation, I have not needed to refer to the source code in writing this chapter.&#13;
<a data-primary="" data-startref="jav_io" data-type="indexterm" id="idm45290657802296"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.2 Reading a Text File" data-type="sect1"><div class="sect1" id="javacook-io-lineatatime">&#13;
<h1>10.2 Reading a Text File</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290657799736">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="files" data-secondary="reading" data-type="indexterm" id="fil_re"/><a data-primary="input/output" data-secondary="reading text files" data-type="indexterm" id="io_rtf"/>The Java documentation doesn’t have methods for opening files.&#13;
How do I open and read a text file and then either process it a line at a time,&#13;
or get a collection of all the lines?</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290657795464">&#13;
<h2>Solution</h2>&#13;
&#13;
<p><a data-primary="Files::lines() method" data-type="indexterm" id="idm45290657794296"/>Use the <code>Files::lines()</code> method, which returns a <code>Stream</code> of <code>String</code>s.&#13;
Or, use <code>Files.newBufferedReader()</code>, <code>Files.newBufferedWriter()</code>, <code>Files.newInputStream()</code>, and <code>Files.newOutputStream()</code>.&#13;
Or, construct a <code>FileReader</code> or a <code>FileInputStream</code>.&#13;
Once you have that, construct a <code>BufferedReader</code>, and&#13;
use the older <code>$$while ((line == readLine()) != null)$$</code> pattern.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290657793768">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>There is no explicit open operation,<sup><a data-type="noteref" href="ch10.html#idm45290657786632" id="idm45290657786632-marker">2</a></sup> perhaps as a kind of rhetorical flourish&#13;
of the Java API’s object-oriented design.</p>&#13;
&#13;
<p>The quickest way to process a text file a line at a time is to use <code>Files.lines()</code>, which takes a <code>Path</code>&#13;
argument and returns a functional <code>Stream&lt;String&gt;</code> into which it feeds the lines from the file:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">Files</code><code class="o">.</code><code class="na">lines</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"myFile.txt"</code><code class="o">)).</code><code class="na">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">::</code><code class="n">println</code><code class="o">);</code></pre>&#13;
&#13;
<p>The <code>Files</code> class has several other static methods which open a file and&#13;
read some or all of it:</p>&#13;
<dl>&#13;
<dt><code>List&lt;String&gt; Files.readAllLines(Path)</code></dt>&#13;
<dd>&#13;
<p>Reads the whole file into a <code>List&lt;String&gt;</code>.</p>&#13;
</dd>&#13;
<dt><code>byte[] Files.readAllBytes</code></dt>&#13;
<dd>&#13;
<p>Reads the whole file into an array of bytes.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>There is a series of methods with names like <code>newReader()</code>, <code>newBufferedWriter()</code>, etc., each of which takes a <code>Path</code> argument and return the appropriate&#13;
<code>Reader/Writer</code> or <code>InputStream/OutputStream</code>.&#13;
A <code>Path</code> is a descriptor for an abstract path (filename) that may or may not exist.&#13;
The explicit constructors for a <code>FileReader</code>, <code>FileWriter</code>, <code>FileInputStream</code>, or <code>FileOutputStream</code>&#13;
take a filename or an instance of the older <code>File</code> class containing the path.&#13;
These operations correspond to the “open” operation in most other languages’ I/O packages.</p>&#13;
&#13;
<p>Historically, Java used to require use of the&#13;
code pattern <code>while ((line == readLine()) != null</code> to read&#13;
lines from a <code>BufferedReader</code>.&#13;
This still works, of course, and will continue to work until the&#13;
last JavaBean sets in the west, in the far future.</p>&#13;
&#13;
<p><a data-type="xref" href="#javacook-CHAPTER-EX-readlines">Example 10-1</a> shows the code for each of these ways&#13;
of reading lines from a file.</p>&#13;
<div data-type="example" id="javacook-CHAPTER-EX-readlines">&#13;
<h5><span class="label">Example 10-1. </span>main/src/main/java/io/ReadLines.java (reading lines from a file)</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Using Path.lines()"</code><code class="o">);</code>&#13;
        <code class="n">Files</code><code class="o">.</code><code class="na">lines</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">fileName</code><code class="o">)).</code><code class="na">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">::</code><code class="n">println</code><code class="o">);</code>&#13;
&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Using Path.readAllLines()"</code><code class="o">);</code>&#13;
        <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllLines</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">fileName</code><code class="o">));</code>&#13;
        <code class="n">lines</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">::</code><code class="n">println</code><code class="o">);</code>&#13;
&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Using BufferedReader.lines().forEach()"</code><code class="o">);</code>&#13;
        <code class="k">new</code> <code class="nf">BufferedReader</code><code class="o">(</code><code class="k">new</code> <code class="n">FileReader</code><code class="o">(</code><code class="n">fileName</code><code class="o">)).</code><code class="na">lines</code><code class="o">().</code><code class="na">forEach</code><code class="o">(</code><code class="n">s</code> <code class="o">-&gt;</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">s</code><code class="o">);</code>&#13;
        <code class="o">});</code>&#13;
&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The old-fashioned way"</code><code class="o">);</code>&#13;
        <code class="n">BufferedReader</code> <code class="n">is</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BufferedReader</code><code class="o">(</code><code class="k">new</code> <code class="n">FileReader</code><code class="o">(</code><code class="n">fileName</code><code class="o">));</code>&#13;
        <code class="n">String</code> <code class="n">line</code><code class="o">;</code>&#13;
        <code class="k">while</code> <code class="o">((</code><code class="n">line</code> <code class="o">=</code> <code class="n">is</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">line</code><code class="o">);</code>&#13;
        <code class="o">}</code></pre></div>&#13;
&#13;
<p>Most of these methods can throw the checked exception <code>IOException</code>, so you must&#13;
have a <code>throws</code> clause or a <code>try/catch</code> around these invocations.</p>&#13;
&#13;
<p>If you create an <code>InputStream</code>, <code>OutputStream</code>, <code>Reader</code>, or <code>Writer</code>, you should close it when finished. This avoids memory leaks and, in the&#13;
case of writing, ensures that all buffered data is actually written to disk.&#13;
One way to ensure this is not forgotten is to use the try-with-resources syntax.&#13;
This puts the declaration and definition of a <code>Closeable</code> resource into the <code>try</code> statement:</p>&#13;
&#13;
<pre data-type="programlisting">    static void oldWayShorter() throws IOException {&#13;
        try (BufferedReader is =&#13;
            new BufferedReader(new FileReader(INPUT_FILE_NAME));&#13;
            BufferedOutputStream bytesOut = new BufferedOutputStream(&#13;
              new FileOutputStream(OUTPUT_FILE_NAME.replace("\\.", "-1.")));) {&#13;
&#13;
            // Read from is, write to bytesOut&#13;
            String line;&#13;
            while ((line = is.readLine()) != null) {&#13;
                line = doSomeProcessingOn(line);&#13;
                bytesOut.write(line.getBytes("UTF-8"));&#13;
                bytesOut.write('\n');&#13;
            }&#13;
&#13;
        }&#13;
    }</pre>&#13;
&#13;
<p>The <a data-primary="line() method (Files class)" data-type="indexterm" id="idm45290657595096"/><code>lines()</code> and read-related methods in <code>Files</code> obviate the need for closing&#13;
the resource, but not the need for handling <code>IOException</code>; the compiler or IDE&#13;
will remind you if you forget those.</p>&#13;
&#13;
<p>There are options that can be passed to the <code>Files</code> methods that open a file;&#13;
these are discussed in the sidebar <a data-type="xref" href="#javacook-ioOptions">“Understanding I/O Options: StandardOpenOptions, FileAttribute, PosixFileAttribute, and More”</a>.</p>&#13;
&#13;
<p>To read the entire contents of a file into single string, in Java 8+, use <code>Files.readString()</code>:</p>&#13;
&#13;
<pre data-type="programlisting">String input = Files.readString(Path.of(INPUT_FILE_NAME)));</pre>&#13;
&#13;
<p>In older Java versions, use my <code>FileIO.readerToString()</code> method. This will read the entire named file into one long string, with embedded newline (<em>\n</em>) characters&#13;
between each line. To read a binary file, use <code>Files.readAllBytes()</code> instead.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290657787784">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>There is formal documentation online for&#13;
<a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html"><code>File</code>s</a>&#13;
and&#13;
<a href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Path.html"><code>Path</code></a>.<a data-primary="" data-startref="fil_re" data-type="indexterm" id="idm45290657584840"/><a data-primary="" data-startref="io_rtf" data-type="indexterm" id="idm45290657583864"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.3 Reading from the Standard Input or from the Console/Controlling Terminal" data-type="sect1"><div class="sect1" id="javacook-io-console-1">&#13;
<h1>10.3 Reading from the Standard Input or from the Console/Controlling Terminal</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-console-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="consoles, reading from" data-type="indexterm" id="con_re"/><a data-primary="input/output" data-secondary="from console" data-type="indexterm" id="io_fc"/><a data-primary="input/output" data-secondary="standard in" data-type="indexterm" id="io_si"/><a data-primary="input/output" data-secondary="from terminal" data-type="indexterm" id="io_ft"/><a data-primary="standard input" data-type="indexterm" id="si_ab"/><a data-primary="terminals, reading from" data-type="indexterm" id="te_re"/>You want to read from the program’s standard input or directly from the program’s controlling terminal or console terminal.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-console-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>For the standard input,&#13;
read bytes by wrapping a <code>BufferedInputStream()</code> around <code>System.in</code>. For reading text, use an <code>InputStreamReader</code> and a <code>BufferedReader</code>.&#13;
For the console or controlling terminal, use Java’s <code>System.console()</code> method to obtain a <code>Console</code> object, and use its methods.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-console-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p id="javacook-io-SECT-1.1">Sometimes you really do need to read from the standard input, or console. One reason is that simple test programs are often console-driven. Another is that some programs naturally require a lot of interaction with the user and you want something faster than a GUI (consider an interactive mathematics or statistical exploration program). Yet another is piping the output of one program directly to the input of another, a very common operation among Unix users and quite valuable on other platforms, such as Windows, that support this operation.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Standard input" data-type="sect3"><div class="sect3" id="idm45290657565512">&#13;
<h3>Standard input</h3>&#13;
&#13;
<p>Most desktop platforms support the notion of <a data-primary="standard input" data-type="indexterm" id="idm45290657563832"/><em>standard input</em> (a keyboard, a file, or the output from another program) and <em>standard output</em> (a terminal window, a printer, a file on disk, or the input to yet another program). Most such systems also support a standard error output so that error messages can be seen by the user even if the standard output is being redirected. When programs on these platforms start up, the three streams are preassigned to particular platform-dependent handles, or <em>file descriptors</em>. The net result is that ordinary programs on these operating systems can read the standard input or write to the standard output or standard error stream without having to open any files or make any other special arrangements.</p>&#13;
&#13;
<p>Java continues this tradition and enshrines it in the <code>System</code> class. The static variables <code>System.in</code>, <code>System.out</code>, and <code>System.err</code> are connected to the three operating system streams before your program begins execution (an application is free to reassign these; see <a data-type="xref" href="#javacook-io-SECT-10">Recipe 10.10</a>). So, to read the standard input, you need only refer to the variable <code>System.in</code> and call its methods. For example, to read one byte from the standard input, you call the read method of <code>System.in</code>, which returns the byte in an <code>int</code> variable:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">b</code> <code class="o">=</code> <code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">.</code><code class="na">read</code><code class="o">(</code> <code class="o">);</code></pre>&#13;
&#13;
<p>But is that enough? No, because the <a data-primary="read() method" data-type="indexterm" id="idm45290657547624"/><code>read()</code> method can throw an <code>IOException</code>. So you must either declare that your program throws an <code>IOException</code>:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code> <code class="n">args</code><code class="o">[])</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
<code class="o">...</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Or you can put a <code>try</code>/<code>catch</code> block around the <code>read()</code> method:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="kt">int</code> <code class="n">b</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
        <code class="k">try</code> <code class="o">{</code>&#13;
            <code class="n">b</code> <code class="o">=</code> <code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">.</code><code class="na">read</code><code class="o">();</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Read this data: "</code> <code class="o">+</code> <code class="o">(</code><code class="kt">char</code><code class="o">)</code><code class="n">b</code><code class="o">);</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Caught "</code> <code class="o">+</code> <code class="n">e</code><code class="o">);</code>&#13;
        <code class="o">}</code></pre>&#13;
&#13;
<p>In this case, it makes sense to print the results inside the <code>try</code> block because there’s no&#13;
point in trying to print the value you read, if the <code>read()</code> threw an <code>IOException</code>.</p>&#13;
&#13;
<p>That code works and gives you the ability to read a byte at a time from the standard input. But most applications are designed in terms of larger units, such as integers, or a line of text. To read a value of a known type, such as <code>int</code>, from the standard input, you can use the <code>Scanner</code> class (covered in more detail in <a data-type="xref" href="#javacook-io-SECT-5">Recipe 10.6</a>):</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">Scanner</code> <code class="n">sc</code> <code class="o">=</code> <code class="n">Scanner</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">);</code>&#13;
<code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="n">sc</code><code class="o">.</code><code class="na">nextInt</code><code class="o">();</code></pre>&#13;
&#13;
<p>For reading characters of text with an input character converter so that your program will work with multiple input encodings around the world, use a <code>Reader</code> class. The particular subclass that allows you to read lines of characters is a <code>BufferedReader</code>. But there’s a hitch. Remember I mentioned those two categories of input classes, <code>Stream</code>s and <code>Reader</code>s? But I also said that <code>System.in</code> is a <code>Stream</code>, and you want a <code>Reader</code>. How do you get from a <code>Stream</code> to a <code>Reader</code>? A crossover class called <code>InputStreamReader</code> is tailor-made for this purpose. Just pass your <code>Stream</code> (like <code>System.in</code>) to the <code>InputStreamReader</code> constructor and you get back a <code>Reader</code>, which you in turn pass to the <code>BufferedReader</code> constructor. The usual idiom for writing this in Java is to nest the constructor calls:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">BufferedReader</code> <code class="n">is</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BufferedReader</code><code class="o">(</code><code class="k">new</code> <code class="n">InputStreamReader</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">));</code></pre>&#13;
&#13;
<p>You can then read lines of text using the <a data-primary="readLine() method" data-type="indexterm" id="idm45290657331816"/><code>readLine()</code> method. This method takes no argument and returns a <code>String</code> that is made up for you by <code>readLine()</code> containing the characters (converted to Unicode) from the next line of text in the file. When there are no more lines of text, the literal value <code>null</code> is returned:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">CatStdin</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">av</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">try</code> <code class="o">(</code><code class="n">BufferedReader</code> <code class="n">is</code> <code class="o">=</code>&#13;
                <code class="k">new</code> <code class="nf">BufferedReader</code><code class="o">(</code><code class="k">new</code> <code class="n">InputStreamReader</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">)))</code> <code class="o">{</code>&#13;
            <code class="n">String</code> <code class="n">inputLine</code><code class="o">;</code>&#13;
&#13;
            <code class="k">while</code> <code class="o">((</code><code class="n">inputLine</code> <code class="o">=</code> <code class="n">is</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">inputLine</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"IOException: "</code> <code class="o">+</code> <code class="n">e</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>To read a single <code>Integer</code> from the standard input, read a line and parse it using<a data-primary="Integer.parseInt() method" data-type="indexterm" id="idm45290660492904"/> <code>Integer.parseInt()</code>.&#13;
To read a series of integers, one per line, you could combine these with a functional style,&#13;
since the <code>BufferedReader</code> has a <a data-primary="lines() method (Files class)" data-type="indexterm" id="idm45290657155240"/><code>lines()</code> method that produces a <code>Stream&lt;String&gt;</code>:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ReadStdinIntsFunctional</code> <code class="o">{</code>&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="n">Stream</code><code class="o">&lt;</code><code class="n">Integer</code><code class="o">&gt;</code> <code class="nf">parseIntSafe</code><code class="o">(</code><code class="n">String</code> <code class="n">s</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">try</code> <code class="o">{</code>&#13;
            <code class="k">return</code> <code class="n">Stream</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">Integer</code><code class="o">.</code><code class="na">parseInt</code><code class="o">(</code><code class="n">s</code><code class="o">));</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">NumberFormatException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">return</code> <code class="n">Stream</code><code class="o">.</code><code class="na">empty</code><code class="o">();</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">try</code> <code class="o">(</code><code class="n">BufferedReader</code> <code class="n">is</code> <code class="o">=</code>&#13;
                <code class="k">new</code> <code class="nf">BufferedReader</code><code class="o">(</code><code class="k">new</code> <code class="n">InputStreamReader</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">));)</code> <code class="o">{</code>&#13;
            <code class="n">is</code><code class="o">.</code><code class="na">lines</code><code class="o">()</code>&#13;
                <code class="o">.</code><code class="na">flatMap</code><code class="o">(</code><code class="nl">ReadStdinIntsFunctional:</code><code class="o">:</code><code class="n">parseIntSafe</code><code class="o">)</code>&#13;
                <code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">::</code><code class="n">println</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Console (Controlling Terminal)" data-type="sect2"><div class="sect2" id="idm45290657151640">&#13;
<h2>The Console (Controlling Terminal)</h2>&#13;
&#13;
<p>The <code>Console</code> class is intended for reading directly from a program’s controlling terminal.&#13;
When you run an application from a <em>terminal window</em> or<a data-primary="command prompt window" data-type="indexterm" id="idm45290657039864"/> <em>command prompt window</em> on most systems,&#13;
its console and its standard input are both connected to the terminal, by default.&#13;
However, the standard input can be changed by piping or redirection on most OSes.&#13;
If you really want to read from wherever the user is sitting, bypassing any indirections,&#13;
then the <code>Console</code> class is usually your friend.</p>&#13;
&#13;
<p>You cannot instantiate <code>Console</code> yourself; you must get an instance&#13;
from the <code>System</code> class’s <a data-primary="console() method" data-type="indexterm" id="idm45290657036488"/><code>console()</code> method. You can then call methods&#13;
such as <code>readLine()</code>, which behaves largely like the method of the&#13;
same name in the <code>BufferedReader</code> class used in the previous recipe.</p>&#13;
&#13;
<p>The following code shows an example of prompting for a name and reading it from the console:</p>&#13;
&#13;
<p><em>main/src/main/java/io/ConsoleRead.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ConsoleRead</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">System</code><code class="o">.</code><code class="na">console</code><code class="o">().</code><code class="na">readLine</code><code class="o">(</code><code class="s">"What is your name?"</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Hello, "</code> <code class="o">+</code> <code class="n">name</code><code class="o">.</code><code class="na">toUpperCase</code><code class="o">());</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>One complication is that the <code>System.console()</code> method can return <code>null</code> if the console isn’t connected. Annoyingly, some IDEs, including Eclipse, don’t manage to set up a controlling terminal when you use the Run As→Java Application mechanism. So production-quality code should always check for <code>null</code> before trying to use the <code>Console</code>.&#13;
If it fails, use a logger or just plain <code>System.out</code>.</p>&#13;
&#13;
<p>One facility the <code>Console</code> class is quite useful for is reading a password without having it echo.&#13;
This has been a standard facility of command-line applications for decades, as the most obvious&#13;
way of preventing <a data-primary="shoulder surfing" data-type="indexterm" id="idm45290656892552"/><em>shoulder surfing</em>—somebody looking over your shoulder to see your password.&#13;
Nonecho password reading is now supported in Java: the <code>Console</code> class has a <a data-primary="readPassword() method" data-type="indexterm" id="idm45290657000792"/><code>readPassword()</code> method that takes a <code>prompt</code> argument, intended to be used like: <code>cons.readPassword("Password:")</code>. This method returns an array of bytes, which can be used directly in some encryption and security APIs, or can easily be converted into a <code>String</code>. It is generally advised to overwrite the byte array after use to prevent security leaks when other code can access the stack, although the benefits of this are probably reduced when you’ve constructed a <code>String</code>. There’s an example of this in the online code in <em>io/ReadPassword.java</em>.<a data-primary="" data-startref="con_re" data-type="indexterm" id="idm45290656997208"/><a data-primary="" data-startref="io_fc" data-type="indexterm" id="idm45290656996200"/><a data-primary="" data-startref="io_si" data-type="indexterm" id="idm45290656995256"/><a data-primary="" data-startref="io_ft" data-type="indexterm" id="idm45290656994312"/><a data-primary="" data-startref="si_ab" data-type="indexterm" id="idm45290656993368"/><a data-primary="" data-startref="te_re" data-type="indexterm" id="idm45290656992424"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.4 Printing with Formatter and printf" data-type="sect1"><div class="sect1" id="javacook-io-SECT-3">&#13;
<h1>10.4 Printing with Formatter and printf</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-3.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want an easy way to use<a data-primary="java.util.Formatter" data-type="indexterm" id="idm45290656988712"/><a data-primary="input/output" data-secondary="java.util.Formatter" data-type="indexterm" id="idm45290656988008"/> <code>java.util.Formatter</code> class’s capability for simple printing tasks.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-3.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>Formatter</code> for printing values with fine-grained control over the formatting.&#13;
Use <code>String.format()</code> or <code>PrintWriter.printf()</code> / <code>PrintStream.printf()</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-3.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>Formatter</code> class is patterned after C’s <code>printf</code> routines. In fact, <code>PrintStream</code> and <code>PrintWriter</code> have convenience routines named <a data-primary="printf() method" data-type="indexterm" id="idm45290656978040"/><code>printf()</code> that simply delegate to the stream or writer’s <a data-primary="format() method" data-type="indexterm" id="idm45290656977000"/><code>format()</code> method, which uses a default <code>Formatter</code> instance. Unlike in C, however, Java is a strongly typed language, so invalid arguments will throw an exception rather than generating gibberish.&#13;
There are also convenience routines <code>static String.format()</code> and <code>printf()</code> in <code>PrintWRiter/PrintStream</code>&#13;
for use when you want to format a <code>String</code> without the bother of creating the <code>Formatter</code> explicitly.</p>&#13;
&#13;
<p>The underlying <code>Formatter</code> class in <code>java.util</code> works on a <code>String</code> containing format codes. For each item that you want to format, you put a format code. The format code consists of a percent sign, optionally an argument number followed by a dollar sign, optionally a field width or precision, and a format type (e.g., <code>d</code> for decimal integer, that is, an integer with no decimal point, and <code>f</code> for floating point). A simple use might look like the following:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"%1$04d - the year of %2$f%n"</code><code class="o">,</code> <code class="mi">1956</code><code class="o">,</code> <code class="n">Math</code><code class="o">.</code><code class="na">PI</code><code class="o">);</code>&#13;
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"%04d - the year of %f%n"</code><code class="o">,</code> <code class="mi">1956</code><code class="o">,</code> <code class="n">Math</code><code class="o">.</code><code class="na">PI</code><code class="o">);</code></pre>&#13;
&#13;
<p>As shown in <a data-type="xref" href="#javacook-io-FIG-2">Figure 10-2</a>, the “%1$04d” controls formatting of the year, and the “%2$f” controls formatting of the value of PI.<sup><a data-type="noteref" href="ch10.html#idm45290656852712" id="idm45290656852712-marker">3</a></sup></p>&#13;
&#13;
<figure><div class="figure" id="javacook-io-FIG-2">&#13;
<img alt="jcb4 1002" src="assets/jcb4_1002.png"/>&#13;
<h6><span class="label">Figure 10-2. </span>Format codes examined</h6>&#13;
</div></figure>&#13;
&#13;
<p>Many format codes are available; <a data-type="xref" href="#javacook-io-TABLE-1">Table 10-1</a> lists some of the more common ones. For a complete description, refer to the javadoc for <code>java.util.Formatter</code>.</p>&#13;
<table id="javacook-io-TABLE-1">&#13;
<caption><span class="label">Table 10-1. </span>Formatter format codes</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Code</th>&#13;
<th>Meaning</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>c</p></td>&#13;
<td><p>Character (argument must be <code>char</code> or integral type containing valid character value).</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>d</p></td>&#13;
<td><p>“decimal int”—integer to be printed as a decimal (radix 10) with no decimal point (argument must be integral type).</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>f</p></td>&#13;
<td><p>Floating-point value with decimal fraction (must be numeric); field width may be followed by decimal point and fractional digit field width; e.g., 7.2f.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>e</p></td>&#13;
<td><p>Floating-point value in scientific notation.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>g</p></td>&#13;
<td><p>Floating-point value, as per f or e, depending on magnitude.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>s</p></td>&#13;
<td><p>Generic format; if value is null, prints “null”; else if arg implements <code>Formattable</code>, format as per <code>arg.formatTo()</code>; else format as per <code>arg.toString()</code>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>t</p></td>&#13;
<td><p>Date codes; follow with secondary code. Common date codes are shown in <a data-type="xref" href="#javacook-io-TABLE-2">Table 10-2</a>. Argument must be <code>long</code>, <code>Long</code>, <code>Calendar</code>, or <code>Date</code>.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>n</p></td>&#13;
<td><p>Newline; insert the platform-dependent line ending character.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>%</p></td>&#13;
<td><p>Insert a literal <code>%</code> character.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>Note also that you may, but are not required to, put a<a data-primary="parameter order" data-type="indexterm" id="idm45290656823608"/> <em>parameter order</em> number between the <code>%</code> and the format code. For example, in&#13;
“%2$04d”, the “2$” means to format the <em>second</em> parameter, regardless&#13;
of the order of the parameters. This is primarily useful with dates&#13;
(see the following example, where you need to format several different portions of the same <code>Date</code> or <code>Calendar</code>, or any time you want to format the same object more than once)&#13;
and in internationalization, where different languages&#13;
may require words to be in a different order within a sentence.</p>&#13;
&#13;
<p>Some examples of using a <code>Formatter</code> are shown in <a data-type="xref" href="#javacook-io-EX-1">Example 10-2</a>.</p>&#13;
<div data-type="example" id="javacook-io-EX-1">&#13;
<h5><span class="label">Example 10-2. </span>main/src/main/java/io/FormatterDemo.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">FormatterDemo</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// The arguments to all these format methods consist of</code>&#13;
        <code class="c1">// a format code String and 1 or more arguments.</code>&#13;
        <code class="c1">// Each format code consists of the following:</code>&#13;
        <code class="c1">// % - code lead-in</code>&#13;
        <code class="c1">// N$ - OPTIONAL parameter number (1-based) after the format code</code>&#13;
        <code class="c1">// N - field width</code>&#13;
        <code class="c1">// L - format letter (d: decimal(int); f: float; s: general; many more)</code>&#13;
        <code class="c1">// For the full(!) story, see javadoc for java.util.Formatter.</code>&#13;
&#13;
        <code class="c1">// Most general (cumbersome) way of proceding.</code>&#13;
        <code class="n">Formatter</code> <code class="n">fmtr</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Formatter</code><code class="o">();</code>&#13;
        <code class="n">Object</code> <code class="n">result</code> <code class="o">=</code> <code class="n">fmtr</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"%1$04d - the year of %2$f"</code><code class="o">,</code> <code class="mi">1956</code><code class="o">,</code> <code class="n">Math</code><code class="o">.</code><code class="na">PI</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">result</code><code class="o">);</code>&#13;
        <code class="n">fmtr</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
&#13;
        <code class="c1">// Shorter way using static String.format(), default parameter numbering.</code>&#13;
        <code class="n">Object</code> <code class="n">stringResult</code> <code class="o">=</code> <code class="n">String</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"%04d - the year of %f"</code><code class="o">,</code> <code class="mi">1956</code><code class="o">,</code> <code class="n">Math</code><code class="o">.</code><code class="na">PI</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">stringResult</code><code class="o">);</code>&#13;
&#13;
        <code class="c1">// A shorter way using PrintStream/PrintWriter.format, more in line with</code>&#13;
        <code class="c1">// other languages. But this way you should provide the newline delimiter</code>&#13;
        <code class="c1">// using %n (rather than \n as that is platform-dependent!).</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"%04d - the year of %f%n"</code><code class="o">,</code> <code class="mi">1956</code><code class="o">,</code> <code class="n">Math</code><code class="o">.</code><code class="na">PI</code><code class="o">);</code>&#13;
&#13;
        <code class="c1">// Format doubles with more control</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"PI is approximately %4.2f%n"</code><code class="o">,</code> <code class="n">Math</code><code class="o">.</code><code class="na">PI</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>Running <code>FormatterDemo</code> produces this:</p>&#13;
<pre data-type="programlisting" id="I_10_tt328">C:&gt; <strong>javac FormatterDates.java</strong>&#13;
C:&gt; <strong>java io.FormatterDates </strong>&#13;
1956 - The year of 3.141593&#13;
1956 - The year of 3.141593&#13;
1956 - The year of 3.141593&#13;
PI is about 3.14</pre>&#13;
&#13;
<p>For formatting date and time objects, a large variety of format codes are available—about 40 in all.&#13;
Date and time objects are discussed in <a data-type="xref" href="ch06.html#javacook-dates">Chapter 6</a>.&#13;
<a data-type="xref" href="#javacook-io-TABLE-3">Table 10-3</a> shows the more common date/time format codes.&#13;
Each must be preceded by a <code>t</code>, so to format the first argument as a year, you would use <code>%1$tY</code>.</p>&#13;
<table id="javacook-io-TABLE-2">&#13;
<caption><span class="label">Table 10-2. </span>Formatting codes for dates and times</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Format code</th>&#13;
<th>Meaning</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>Y</p></td>&#13;
<td><p>Year (at least four digits)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>m</p></td>&#13;
<td><p>Month as two-digit (leading zeros) number</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>B</p></td>&#13;
<td><p>Locale-specific month name (b for abbreviated)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>d</p></td>&#13;
<td><p>Day of month (two digits, leading zeros)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>e</p></td>&#13;
<td><p>Day of month (one or two digits)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>A</p></td>&#13;
<td><p>Locale-specific day of week (<em>a</em> for abbreviated)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>H or I</p></td>&#13;
<td><p>Hour in 24-hour (H) or 12-hour (I) format (two digits, leading zeros)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>M</p></td>&#13;
<td><p>Minute (two digits)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>S</p></td>&#13;
<td><p>Second (two digits)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>P/p</p></td>&#13;
<td><p>Locale-specific AM or PM in uppercase (if P) or lowercase (if p)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>R or T</p></td>&#13;
<td><p>24-hour time combination: %tH:%tM (if R) or %tH:%tM:%tS (if T)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>D</p></td>&#13;
<td><p>Date formatted as <em><code>%tm/%td/%ty</code></em></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>In my opinion, embedding these codes directly in applications that you&#13;
distribute <span class="keep-together">or make</span> available as web applications is often a bad&#13;
idea, because any direct use of them assumes that you know the correct&#13;
order to print these fields in all locales around the world. Trust&#13;
me, you don’t. Instead of these, I recommend the use of <code>DateTimeFormatter</code>,&#13;
covered in <a data-type="xref" href="ch06.html#javacook-dates-format">Recipe 6.2</a>, to control the order of arguments.&#13;
However, for quick-and-dirty work, as well as for writing log or data files that must be&#13;
in a given format because some other program reads them, these are OK.</p>&#13;
&#13;
<p>Some date examples are shown in <a data-type="xref" href="#javacook-io-EX-2">Example 10-3</a>.</p>&#13;
<div data-type="example" id="javacook-io-EX-2">&#13;
<h5><span class="label">Example 10-3. </span>main/src/main/java/io/FormatterDates.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">FormatterDates</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// Format number as dates e.g., 2020-06-28</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"%4d-%02d-%2d%n"</code><code class="o">,</code> <code class="mi">2020</code><code class="o">,</code> <code class="mi">6</code><code class="o">,</code> <code class="mi">28</code><code class="o">);</code>&#13;
&#13;
        <code class="c1">// Format fields directly from a Date object: multiple fields from "1$"</code>&#13;
        <code class="c1">// (hard-coded formatting for Date not advisable; see I/O chapter)</code>&#13;
        <code class="n">LocalDate</code> <code class="n">today</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">();</code>&#13;
        <code class="c1">// Print in a form like e.g., "July 4, 2020"</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"Today is %1$tB %1$td, %1$tY%n"</code><code class="o">,</code> <code class="n">today</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>Running this <code>FormatterDates</code> class produces the following output:</p>&#13;
<pre data-type="programlisting" id="I_10_tt329">C:&gt; <strong>java io.FormatterDates</strong>&#13;
2020-06-28&#13;
Today is January 01, 2020</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.5 Scanning Input with StreamTokenizer" data-type="sect1"><div class="sect1" id="javacook-io-SECT-4">&#13;
<h1>10.5 Scanning Input with StreamTokenizer</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-4.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="StreamTokenizer and" data-type="indexterm" id="io_sta"/><a data-primary="StreamTokenizer" data-type="indexterm" id="st_ab"/>You need to scan a file with more fine-grained resolution than the <a data-primary="readLine() method" data-type="indexterm" id="idm45290656609576"/><code>readLine()</code> method of the <code>BufferedReader</code> class and its subclasses.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-4.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use a <code>StreamTokenizer</code>, <code>readLine()</code> and a <code>StringTokenizer</code>, the <code>Scanner</code> class (see <a data-type="xref" href="#javacook-io-SECT-5">Recipe 10.6</a>), regular expressions (<a data-type="xref" href="ch04.html#javacook-regex">Chapter 4</a>), or one of several third-party&#13;
parser generators.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-4.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Though you could, in theory, read a file one character at a time and analyze each character, that is a pretty low-level approach. The <a data-primary="read() method" data-type="indexterm" id="idm45290656600008"/><code>read()</code> method in the <code>Reader</code> class is defined to return <code>int</code> so that it can use the time-honored value <code>-1</code> (defined as EOF in Unix <em>&lt;stdio.h&gt;</em> for years) to indicate that you have read to the end of the file:</p>&#13;
&#13;
<p><em>main/src/main/java/io/ReadCharsOneAtATime.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ReadCharsOneAtATime</code> <code class="o">{</code>&#13;
&#13;
    <code class="kt">void</code> <code class="nf">doFile</code><code class="o">(</code><code class="n">Reader</code> <code class="n">is</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="kt">int</code> <code class="n">c</code><code class="o">;</code>&#13;
        <code class="k">while</code> <code class="o">((</code><code class="n">c</code><code class="o">=</code><code class="n">is</code><code class="o">.</code><code class="na">read</code><code class="o">(</code> <code class="o">))</code> <code class="o">!=</code> <code class="o">-</code><code class="mi">1</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">((</code><code class="kt">char</code><code class="o">)</code><code class="n">c</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Notice the cast to <code>char</code>; the program compiles fine without it, but it does not print correctly because <code>c</code> is declared as <code>int</code>. Variable <code>c</code> must be declared <code>int</code> to be able to compare against the end-of-file value <code>-1</code>. For example, the integer value corresponding to capital A treated as an <code>int</code> prints as 65, whereas with <code>(char)</code> prints the <span class="keep-together">character</span> <code>A</code>.</p>&#13;
&#13;
<p>We discussed the <code>StringTokenizer</code> class extensively in <a data-type="xref" href="ch03.html#javacook-strings-SECT-1">Recipe 3.1</a>. The combination of <code>readLine()</code>  and <code>StringTokenizer</code> provides a simple means of scanning a file. Suppose you need to read a file in which each line consists of a name like <em>user@host.domain</em>, and you want to split the lines into users and host addresses. You could use this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ScanStringTok</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">av</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">av</code><code class="o">.</code><code class="na">length</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"Usage: %s filename [...]%n"</code><code class="o">,</code>&#13;
                <code class="n">ScanStringTok</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getSimpleName</code><code class="o">());</code>&#13;
        <code class="k">else</code>&#13;
            <code class="nf">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">=</code><code class="mi">0</code><code class="o">;</code> <code class="n">i</code><code class="o">&lt;</code><code class="n">av</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code>&#13;
                <code class="n">process</code><code class="o">(</code><code class="n">av</code><code class="o">[</code><code class="n">i</code><code class="o">]);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">static</code> <code class="kt">void</code> <code class="nf">process</code><code class="o">(</code><code class="n">String</code> <code class="n">fileName</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">String</code> <code class="n">s</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>&#13;
        <code class="k">try</code> <code class="o">(</code><code class="n">BufferedReader</code> <code class="n">is</code> <code class="o">=</code>&#13;
                <code class="k">new</code> <code class="nf">BufferedReader</code><code class="o">(</code><code class="k">new</code> <code class="n">FileReader</code><code class="o">(</code><code class="n">fileName</code><code class="o">));)</code> <code class="o">{</code>&#13;
            <code class="k">while</code> <code class="o">((</code><code class="n">s</code> <code class="o">=</code> <code class="n">is</code><code class="o">.</code><code class="na">readLine</code><code class="o">())</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="n">StringTokenizer</code> <code class="n">st</code> <code class="o">=</code> <code class="k">new</code> <code class="n">StringTokenizer</code><code class="o">(</code><code class="n">s</code><code class="o">,</code> <code class="s">"@"</code><code class="o">,</code> <code class="kc">true</code><code class="o">);</code>&#13;
                <code class="n">String</code> <code class="n">user</code> <code class="o">=</code> <code class="o">(</code><code class="n">String</code><code class="o">)</code><code class="n">st</code><code class="o">.</code><code class="na">nextElement</code><code class="o">();</code>&#13;
                <code class="n">st</code><code class="o">.</code><code class="na">nextElement</code><code class="o">();</code>&#13;
                <code class="n">String</code> <code class="n">host</code> <code class="o">=</code> <code class="o">(</code><code class="n">String</code><code class="o">)</code><code class="n">st</code><code class="o">.</code><code class="na">nextElement</code><code class="o">();</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"User name: "</code> <code class="o">+</code> <code class="n">user</code> <code class="o">+</code>&#13;
                    <code class="s">"; host part: "</code> <code class="o">+</code> <code class="n">host</code><code class="o">);</code>&#13;
&#13;
                <code class="c1">// Do something useful with the user and host parts...</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">NoSuchElementException</code> <code class="n">ix</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Malformed input "</code> <code class="o">+</code> <code class="n">s</code><code class="o">);</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>The <code>StreamTokenizer</code> class in <code>java.util</code> provides slightly more capabilities for scanning a file. It reads characters and assembles them into words, or tokens. It returns these tokens to you along with a type code describing the kind of token it found. This type code is one of four predefined types (<code>StringTokenizer.TT_WORD</code>, <code>TT_NUMBER</code>, <code>TT_EOF</code>, or <code>TT_EOL</code> for the end-of-line) or the <code>char</code> value of an ordinary character (such as 32 for the space character). Methods such as <code>ordinaryCharacter()</code>   allow you to specify how to categorize characters, while others such as <a data-primary="slashSlashComment() method" data-type="indexterm" id="idm45290656164904"/><code>slashSlashComment()</code> allow you to enable or disable features.</p>&#13;
&#13;
<p><a data-type="xref" href="#javacook-io-EX-3">Example 10-4</a> shows a <code>StreamTokenizer</code> used to implement a simple immediate-mode  stack-based calculator:</p>&#13;
&#13;
<pre data-type="programlisting">2 2 + =&#13;
4&#13;
22 7 / =&#13;
3.141592857</pre>&#13;
&#13;
<p>I read tokens as they arrive from the <code>StreamTokenizer</code>. Numbers are put on the stack. The four operators (<code>+</code>, <code>-</code>, <code>\*</code>, and <code>/</code>) are immediately performed on the two elements at the top of the stack, and the result is put back on the top of the stack. The <code>=</code> operator causes the top element to be printed, but is left on the stack so that you can say this:<a data-primary="" data-startref="io_sta" data-type="indexterm" id="idm45290656158200"/><a data-primary="" data-startref="st_ab" data-type="indexterm" id="idm45290656157224"/></p>&#13;
&#13;
<pre data-type="programlisting">4 5 * = 2 / =&#13;
20.0&#13;
10.0</pre>&#13;
<div data-type="example" id="javacook-io-EX-3">&#13;
<h5><span class="label">Example 10-4. </span>main/src/main/java/io/SimpleCalcStreamTok.java (simple calculator using StreamTokenizer)</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">SimpleCalcStreamTok</code> <code class="o">{</code>&#13;
    <code class="cm">/** The StreamTokenizer input */</code>&#13;
    <code class="kd">protected</code>  <code class="n">StreamTokenizer</code> <code class="n">tf</code><code class="o">;</code>&#13;
    <code class="cm">/** The output file */</code>&#13;
    <code class="kd">protected</code> <code class="n">PrintWriter</code> <code class="n">out</code> <code class="o">=</code> <code class="k">new</code> <code class="n">PrintWriter</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">,</code> <code class="kc">true</code><code class="o">);</code>&#13;
    <code class="cm">/** The variable name (not used in this version) */</code>&#13;
    <code class="kd">protected</code> <code class="n">String</code> <code class="n">variable</code><code class="o">;</code>&#13;
    <code class="cm">/** The operand stack */</code>&#13;
    <code class="kd">protected</code> <code class="n">Stack</code><code class="o">&lt;</code><code class="n">Double</code><code class="o">&gt;</code> <code class="n">s</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Stack</code><code class="o">&lt;&gt;();</code>&#13;
&#13;
    <code class="cm">/* Driver - main program */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">av</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">av</code><code class="o">.</code><code class="na">length</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code>&#13;
            <code class="k">new</code> <code class="nf">SimpleCalcStreamTok</code><code class="o">(</code>&#13;
                <code class="k">new</code> <code class="nf">InputStreamReader</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">)).</code><code class="na">doCalc</code><code class="o">();</code>&#13;
        <code class="k">else</code>&#13;
            <code class="nf">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">=</code><code class="mi">0</code><code class="o">;</code> <code class="n">i</code><code class="o">&lt;</code><code class="n">av</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code>&#13;
                <code class="k">new</code> <code class="nf">SimpleCalcStreamTok</code><code class="o">(</code><code class="n">av</code><code class="o">[</code><code class="n">i</code><code class="o">]).</code><code class="na">doCalc</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct by filename */</code>&#13;
    <code class="kd">public</code> <code class="nf">SimpleCalcStreamTok</code><code class="o">(</code><code class="n">String</code> <code class="n">fileName</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="k">new</code> <code class="n">FileReader</code><code class="o">(</code><code class="n">fileName</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct from an existing Reader */</code>&#13;
    <code class="kd">public</code> <code class="nf">SimpleCalcStreamTok</code><code class="o">(</code><code class="n">Reader</code> <code class="n">rdr</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="n">tf</code> <code class="o">=</code> <code class="k">new</code> <code class="n">StreamTokenizer</code><code class="o">(</code><code class="n">rdr</code><code class="o">);</code>&#13;
        <code class="c1">// Control the input character set:</code>&#13;
        <code class="n">tf</code><code class="o">.</code><code class="na">slashSlashComments</code><code class="o">(</code><code class="kc">true</code><code class="o">);</code>    <code class="c1">// treat "//" as comments</code>&#13;
        <code class="n">tf</code><code class="o">.</code><code class="na">ordinaryChar</code><code class="o">(</code><code class="sc">'-'</code><code class="o">);</code>        <code class="c1">// used for subtraction</code>&#13;
        <code class="n">tf</code><code class="o">.</code><code class="na">ordinaryChar</code><code class="o">(</code><code class="sc">'/'</code><code class="o">);</code>    <code class="c1">// used for division</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct from a Reader and a PrintWriter</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="nf">SimpleCalcStreamTok</code><code class="o">(</code><code class="n">Reader</code> <code class="n">in</code><code class="o">,</code> <code class="n">PrintWriter</code> <code class="n">out</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="n">in</code><code class="o">);</code>&#13;
        <code class="n">setOutput</code><code class="o">(</code><code class="n">out</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/**</code>&#13;
<code class="cm">     * Change the output destination.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setOutput</code><code class="o">(</code><code class="n">PrintWriter</code> <code class="n">out</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">out</code> <code class="o">=</code> <code class="n">out</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">doCalc</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="kt">int</code> <code class="n">iType</code><code class="o">;</code>&#13;
        <code class="kt">double</code> <code class="n">tmp</code><code class="o">;</code>&#13;
&#13;
        <code class="k">while</code> <code class="o">((</code><code class="n">iType</code> <code class="o">=</code> <code class="n">tf</code><code class="o">.</code><code class="na">nextToken</code><code class="o">())</code> <code class="o">!=</code> <code class="n">StreamTokenizer</code><code class="o">.</code><code class="na">TT_EOF</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">switch</code><code class="o">(</code><code class="n">iType</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">case</code> <code class="n">StreamTokenizer</code><code class="o">.</code><code class="na">TT_NUMBER</code><code class="o">:</code> <code class="c1">// Found a number, push value to stack</code>&#13;
                <code class="n">push</code><code class="o">(</code><code class="n">tf</code><code class="o">.</code><code class="na">nval</code><code class="o">);</code>&#13;
                <code class="k">break</code><code class="o">;</code>&#13;
            <code class="k">case</code> <code class="n">StreamTokenizer</code><code class="o">.</code><code class="na">TT_WORD</code><code class="o">:</code>&#13;
                <code class="c1">// Found a variable, save its name. Not used here.</code>&#13;
                <code class="n">variable</code> <code class="o">=</code> <code class="n">tf</code><code class="o">.</code><code class="na">sval</code><code class="o">;</code>&#13;
                <code class="k">break</code><code class="o">;</code>&#13;
            <code class="k">case</code> <code class="sc">'+'</code><code class="o">:</code>&#13;
                <code class="c1">// + operator is commutative.</code>&#13;
                <code class="n">push</code><code class="o">(</code><code class="n">pop</code><code class="o">()</code> <code class="o">+</code> <code class="n">pop</code><code class="o">());</code>&#13;
                <code class="k">break</code><code class="o">;</code>&#13;
            <code class="k">case</code> <code class="sc">'-'</code><code class="o">:</code>&#13;
                <code class="c1">// - operator: order matters.</code>&#13;
                <code class="n">tmp</code> <code class="o">=</code> <code class="n">pop</code><code class="o">();</code>&#13;
                <code class="n">push</code><code class="o">(</code><code class="n">pop</code><code class="o">()</code> <code class="o">-</code> <code class="n">tmp</code><code class="o">);</code>&#13;
                <code class="k">break</code><code class="o">;</code>&#13;
            <code class="k">case</code> <code class="sc">'*'</code><code class="o">:</code>&#13;
                <code class="c1">// Multiply is commutative.</code>&#13;
                <code class="n">push</code><code class="o">(</code><code class="n">pop</code><code class="o">()</code> <code class="o">*</code> <code class="n">pop</code><code class="o">());</code>&#13;
                <code class="k">break</code><code class="o">;</code>&#13;
            <code class="k">case</code> <code class="sc">'/'</code><code class="o">:</code>&#13;
                <code class="c1">// Handle division carefully: order matters!</code>&#13;
                <code class="n">tmp</code> <code class="o">=</code> <code class="n">pop</code><code class="o">();</code>&#13;
                <code class="n">push</code><code class="o">(</code><code class="n">pop</code><code class="o">()</code> <code class="o">/</code> <code class="n">tmp</code><code class="o">);</code>&#13;
                <code class="k">break</code><code class="o">;</code>&#13;
            <code class="k">case</code> <code class="sc">'='</code><code class="o">:</code>&#13;
                <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">peek</code><code class="o">());</code>&#13;
                <code class="k">break</code><code class="o">;</code>&#13;
            <code class="k">default</code><code class="o">:</code>&#13;
                <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"What's this? iType = "</code> <code class="o">+</code> <code class="n">iType</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
    <code class="kt">void</code> <code class="nf">push</code><code class="o">(</code><code class="kt">double</code> <code class="n">val</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">s</code><code class="o">.</code><code class="na">push</code><code class="o">(</code><code class="n">Double</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">val</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
    <code class="kt">double</code> <code class="nf">pop</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="o">((</code><code class="n">Double</code><code class="o">)</code><code class="n">s</code><code class="o">.</code><code class="na">pop</code><code class="o">()).</code><code class="na">doubleValue</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
    <code class="kt">double</code> <code class="nf">peek</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="o">((</code><code class="n">Double</code><code class="o">)</code><code class="n">s</code><code class="o">.</code><code class="na">peek</code><code class="o">()).</code><code class="na">doubleValue</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
    <code class="kt">void</code> <code class="nf">clearStack</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">s</code><code class="o">.</code><code class="na">removeAllElements</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.6 Scanning Input with the Scanner Class" data-type="sect1"><div class="sect1" id="javacook-io-SECT-5">&#13;
<h1>10.6 Scanning Input with the Scanner Class</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-5.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="Scanner class" data-type="indexterm" id="io_sc"/><a data-primary="Scanner class" data-type="indexterm" id="sc_abo"/>You want to scan a simple input file consisting of various numbers and strings in a known format.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-5.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Read with <code>Scanner</code>’s <a data-primary="next() method" data-type="indexterm" id="idm45290655729256"/><code>next()</code> methods.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-5.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>Scanner</code> class lets you read an input source by tokens, somewhat analogous to the&#13;
<code>StreamTokenizer</code> described in <a data-type="xref" href="#javacook-io-SECT-4">Recipe 10.5</a>. The <code>Scanner</code> is more flexible&#13;
in some ways (it lets you break tokens based on spaces or regular expressions) but&#13;
less in others (you need to know the kind of token you are reading). This class&#13;
bears some resemblance to the C-language <a data-primary="scanf() method" data-type="indexterm" id="idm45290655723400"/><code>scanf()</code> function, but in the <code>Scanner</code>&#13;
you specify the input token types by calling methods like <a data-primary="nextInt() method" data-type="indexterm" id="idm45290655721864"/><code>nextInt()</code>, <a data-primary="nextDouble() method" data-type="indexterm" id="idm45290655720776"/><code>nextDouble()</code>, and so on. Here is a simple example of scanning:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="n">String</code> <code class="n">sampleDate</code> <code class="o">=</code> <code class="s">"25 Dec 1988"</code><code class="o">;</code>&#13;
&#13;
        <code class="k">try</code> <code class="o">(</code><code class="n">Scanner</code> <code class="n">sDate</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Scanner</code><code class="o">(</code><code class="n">sampleDate</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="kt">int</code> <code class="n">dayOfMonth</code> <code class="o">=</code> <code class="n">sDate</code><code class="o">.</code><code class="na">nextInt</code><code class="o">();</code>&#13;
            <code class="n">String</code> <code class="n">month</code> <code class="o">=</code> <code class="n">sDate</code><code class="o">.</code><code class="na">next</code><code class="o">();</code>&#13;
            <code class="kt">int</code> <code class="n">year</code> <code class="o">=</code> <code class="n">sDate</code><code class="o">.</code><code class="na">nextInt</code><code class="o">();</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"%d-%s-%02d%n"</code><code class="o">,</code> <code class="n">year</code><code class="o">,</code> <code class="n">month</code><code class="o">,</code> <code class="n">dayOfMonth</code><code class="o">);</code>&#13;
        <code class="o">}</code></pre>&#13;
&#13;
<p>The <code>Scanner</code> recognizes Java’s eight built-in types, in addition to <code>BigInteger</code> and <code>BigDecimal</code>. It can also return input tokens as <code>String</code>s or by matching regular expressions (see <a data-type="xref" href="ch04.html#javacook-regex">Chapter 4</a>). <a data-type="xref" href="#javacook-io-TABLE-3">Table 10-3</a> lists the “next” methods and corresponding “has” methods; the “has” method returns true if the corresponding “next” method would succeed. There is no <a data-primary="nextString() method" data-type="indexterm" id="idm45290655659816"/><code>nextString()</code> method; just use <code>next()</code> to get the next token as a <code>String</code>.</p>&#13;
<table id="javacook-io-TABLE-3">&#13;
<caption><span class="label">Table 10-3. </span>Scanner methods</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Returned type</th>&#13;
<th>“has” method</th>&#13;
<th>“next” method</th>&#13;
<th>Comment</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>String</code></p></td>&#13;
<td><p><code>hasNext()</code></p></td>&#13;
<td><p><code>next()</code></p></td>&#13;
<td><p>The next complete token from this scanner</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>String</code></p></td>&#13;
<td><p><code>hasNext(Pattern)</code></p></td>&#13;
<td><p><code>next(Pattern)</code></p></td>&#13;
<td><p>The next string that matches the given regular expression (regex)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>String</code></p></td>&#13;
<td><p><code>hasNext(String)</code></p></td>&#13;
<td><p><code>next(String)</code></p></td>&#13;
<td><p>The next token that matches the regex pattern constructed from the specified string</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>BigDecimal</code></p></td>&#13;
<td><p><code>hasNextBigDecimal()</code></p></td>&#13;
<td><p><code>nextBigDecimal()</code></p></td>&#13;
<td><p>The next token of the input as a <code>BigDecimal</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>BigInteger</code></p></td>&#13;
<td><p><code>hasNextBigInteger()</code></p></td>&#13;
<td><p><code>nextBigInteger()</code></p></td>&#13;
<td><p>The next token of the input as a <code>BigInteger</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>boolean</code></p></td>&#13;
<td><p><code>hasNextBoolean()</code></p></td>&#13;
<td><p><code>nextBoolean()</code></p></td>&#13;
<td><p>The next token of the input as a <code>boolean</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>byte</code></p></td>&#13;
<td><p><code>hasNextByte()</code></p></td>&#13;
<td><p><code>nextByte()</code></p></td>&#13;
<td><p>The next token of the input as a <code>byte</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>double</code></p></td>&#13;
<td><p><code>hasNextDouble()</code></p></td>&#13;
<td><p><code>nextDouble()</code></p></td>&#13;
<td><p>The next token of the input as a <code>double</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>float</code></p></td>&#13;
<td><p><code>hasNextFloat()</code></p></td>&#13;
<td><p><code>nextFloat()</code></p></td>&#13;
<td><p>The next token of the input as a <code>float</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>int</code></p></td>&#13;
<td><p><code>hasNextInt()</code></p></td>&#13;
<td><p><code>nextInt()</code></p></td>&#13;
<td><p>The next token of the input as an <code>int</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>String</code></p></td>&#13;
<td><p>N/A</p></td>&#13;
<td><p><code>nextLine()</code></p></td>&#13;
<td><p>Reads up to the end-of-line, including the line ending</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>long</code></p></td>&#13;
<td><p><code>hasNextLong()</code></p></td>&#13;
<td><p><code>nextLong()</code></p></td>&#13;
<td><p>The next token of the input as a <code>long</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>short</code></p></td>&#13;
<td><p><code>hasNextShort()</code></p></td>&#13;
<td><p><code>nextShort()</code></p></td>&#13;
<td><p>The next token of the input as a <code>short</code></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>The <code>Scanner</code> class is constructed with an input source, which can be an <code>InputStream</code>, a <code>String</code>, or <code>Readable</code>  (<code>Readable</code> is an interface that <code>Reader</code> and all its subclasses implement).</p>&#13;
&#13;
<p>One way to use the <code>Scanner</code> class is based on the Iterator pattern, using <code>while (scanner.hasNext())</code> to control the iteration. <a data-type="xref" href="#javacook-io-EX-4">Example 10-5</a> shows the simple calculator from <a data-type="xref" href="#javacook-io-SECT-4">Recipe 10.5</a> rewritten<sup><a data-type="noteref" href="ch10.html#idm45290655572552" id="idm45290655572552-marker">4</a></sup> to use the <code>Scanner</code> class.<a data-primary="" data-startref="io_sc" data-type="indexterm" id="idm45290655570280"/><a data-primary="" data-startref="sc_abo" data-type="indexterm" id="idm45290655569272"/></p>&#13;
<div data-type="example" id="javacook-io-EX-4">&#13;
<h5><span class="label">Example 10-5. </span>main/src/main/java/io/simpleCalcScanner.java (simple calculator using java.util.Scanner)</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">SimpleCalcScanner</code> <code class="o">{</code>&#13;
    <code class="cm">/** The Scanner */</code>&#13;
    <code class="kd">protected</code> <code class="n">Scanner</code> <code class="n">scan</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** The output */</code>&#13;
    <code class="kd">protected</code> <code class="n">PrintWriter</code> <code class="n">out</code> <code class="o">=</code> <code class="k">new</code> <code class="n">PrintWriter</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">,</code> <code class="kc">true</code><code class="o">);</code>&#13;
&#13;
    <code class="cm">/** The variable name (not used in this version) */</code>&#13;
    <code class="kd">protected</code> <code class="n">String</code> <code class="n">variable</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** The operand stack; no operators are pushed,</code>&#13;
<code class="cm">     * so it can be a stack of Double</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">protected</code> <code class="n">Stack</code><code class="o">&lt;</code><code class="n">Double</code><code class="o">&gt;</code> <code class="n">s</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Stack</code><code class="o">&lt;&gt;();</code>&#13;
&#13;
    <code class="cm">/* Driver - main program */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">args</code><code class="o">.</code><code class="na">length</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code>&#13;
            <code class="k">new</code> <code class="nf">SimpleCalcScanner</code><code class="o">(</code>&#13;
                <code class="k">new</code> <code class="nf">InputStreamReader</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">in</code><code class="o">)).</code><code class="na">doCalc</code><code class="o">();</code>&#13;
        <code class="k">else</code>&#13;
            <code class="nf">for</code> <code class="o">(</code><code class="n">String</code> <code class="n">arg</code> <code class="o">:</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="k">new</code> <code class="nf">SimpleCalcScanner</code><code class="o">(</code><code class="n">arg</code><code class="o">).</code><code class="na">doCalc</code><code class="o">();</code>&#13;
            <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct a SimpleCalcScanner by name */</code>&#13;
    <code class="kd">public</code> <code class="nf">SimpleCalcScanner</code><code class="o">(</code><code class="n">String</code> <code class="n">fileName</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="k">new</code> <code class="n">FileReader</code><code class="o">(</code><code class="n">fileName</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct a SimpleCalcScanner from an open Reader */</code>&#13;
    <code class="kd">public</code> <code class="nf">SimpleCalcScanner</code><code class="o">(</code><code class="n">Reader</code> <code class="n">rdr</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="n">scan</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Scanner</code><code class="o">(</code><code class="n">rdr</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct a SimpleCalcScanner from a Reader and a PrintWriter */</code>&#13;
    <code class="kd">public</code> <code class="nf">SimpleCalcScanner</code><code class="o">(</code><code class="n">Reader</code> <code class="n">rdr</code><code class="o">,</code> <code class="n">PrintWriter</code> <code class="n">pw</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="n">rdr</code><code class="o">);</code>&#13;
        <code class="n">setWriter</code><code class="o">(</code><code class="n">pw</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Change the output to go to a new PrintWriter */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setWriter</code><code class="o">(</code><code class="n">PrintWriter</code> <code class="n">pw</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">out</code> <code class="o">=</code> <code class="n">pw</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">doCalc</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="kt">double</code> <code class="n">tmp</code><code class="o">;</code>&#13;
&#13;
        <code class="k">while</code> <code class="o">(</code><code class="n">scan</code><code class="o">.</code><code class="na">hasNext</code><code class="o">())</code> <code class="o">{</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">scan</code><code class="o">.</code><code class="na">hasNextDouble</code><code class="o">())</code> <code class="o">{</code>&#13;
                <code class="n">push</code><code class="o">(</code><code class="n">scan</code><code class="o">.</code><code class="na">nextDouble</code><code class="o">());</code>&#13;
            <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
                <code class="n">String</code> <code class="n">token</code><code class="o">;</code>&#13;
                <code class="k">switch</code><code class="o">(</code><code class="n">token</code> <code class="o">=</code> <code class="n">scan</code><code class="o">.</code><code class="na">next</code><code class="o">())</code> <code class="o">{</code>&#13;
                <code class="k">case</code> <code class="s">"+"</code><code class="o">:</code>&#13;
                    <code class="c1">// Found + operator, perform it immediately.</code>&#13;
                    <code class="n">push</code><code class="o">(</code><code class="n">pop</code><code class="o">()</code> <code class="o">+</code> <code class="n">pop</code><code class="o">());</code>&#13;
                    <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="s">"-"</code><code class="o">:</code>&#13;
                    <code class="c1">// Found - operator, perform it (order matters).</code>&#13;
                    <code class="n">tmp</code> <code class="o">=</code> <code class="n">pop</code><code class="o">();</code>&#13;
                    <code class="n">push</code><code class="o">(</code><code class="n">pop</code><code class="o">()</code> <code class="o">-</code> <code class="n">tmp</code><code class="o">);</code>&#13;
                    <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="s">"*"</code><code class="o">:</code>&#13;
                    <code class="c1">// Multiply is commutative.</code>&#13;
                    <code class="n">push</code><code class="o">(</code><code class="n">pop</code><code class="o">()</code> <code class="o">*</code> <code class="n">pop</code><code class="o">());</code>&#13;
                    <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="s">"/"</code><code class="o">:</code>&#13;
                    <code class="c1">// Handle division carefully: order matters!</code>&#13;
                    <code class="n">tmp</code> <code class="o">=</code> <code class="n">pop</code><code class="o">();</code>&#13;
                    <code class="n">push</code><code class="o">(</code><code class="n">pop</code><code class="o">()</code> <code class="o">/</code> <code class="n">tmp</code><code class="o">);</code>&#13;
                    <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="s">"="</code><code class="o">:</code>&#13;
                    <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">peek</code><code class="o">());</code>&#13;
                    <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">default</code><code class="o">:</code>&#13;
                    <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"What's this? "</code> <code class="o">+</code> <code class="n">token</code><code class="o">);</code>&#13;
                    <code class="k">break</code><code class="o">;</code>&#13;
                <code class="o">}</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kt">void</code> <code class="nf">push</code><code class="o">(</code><code class="kt">double</code> <code class="n">val</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">s</code><code class="o">.</code><code class="na">push</code><code class="o">(</code><code class="n">Double</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">val</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kt">double</code> <code class="nf">pop</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="o">((</code><code class="n">Double</code><code class="o">)</code><code class="n">s</code><code class="o">.</code><code class="na">pop</code><code class="o">()).</code><code class="na">doubleValue</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kt">double</code> <code class="nf">peek</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="o">((</code><code class="n">Double</code><code class="o">)</code><code class="n">s</code><code class="o">.</code><code class="na">peek</code><code class="o">()).</code><code class="na">doubleValue</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kt">void</code> <code class="nf">clearStack</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">s</code><code class="o">.</code><code class="na">removeAllElements</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.7 Scanning Input with Grammatical Structure" data-type="sect1"><div class="sect1" id="javacook-io-parsers">&#13;
<h1>10.7 Scanning Input with Grammatical Structure</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-parsers.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="grammatical structures, input/output with" data-type="indexterm" id="gs_io"/><a data-primary="input/output" data-secondary="with grammatical structures" data-type="indexterm" id="io_gs"/>You need to parse a file whose structure can be described as grammatical (in the sense of computer languages, not natural languages).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-parsers.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use one of many parser generators.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-parsers.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Although the <code>StreamTokenizer</code> class (see <a data-type="xref" href="#javacook-io-SECT-4">Recipe 10.5</a>) and <code>Scanner</code> (see <a data-type="xref" href="#javacook-io-SECT-5">Recipe 10.6</a>) are useful, they know only a limited number of tokens and have no way of specifying that the tokens must appear in a particular order. To do more advanced scanning, you need some special-purpose scanning tools. Parser generators have a long history in computer science.&#13;
The best-known examples are the C-language <a data-primary="yacc" data-type="indexterm" id="idm45290655023192"/><code>yacc</code> (Yet Another Compiler Compiler) and <a data-primary="lex" data-type="indexterm" id="idm45290655022136"/><code>lex</code>, released with Seventh Edition Unix in the 1970s and discussed in <em><a class="orm:hideurl" href="http://shop.oreilly.com/product/9781565920002.do">lex &amp; yacc</a></em> by<a data-primary="Brown, Doug" data-type="indexterm" id="idm45290655019960"/> Doug Brown et al. (O’Reilly), and their open source clones <a data-primary="bison" data-type="indexterm" id="idm45290655019128"/><em>bison</em> and<a data-primary="flex" data-type="indexterm" id="idm45290655018072"/> <em>flex</em>. These tools let you specify the lexical structure of your input using some pattern language such as regular expressions (see <a data-type="xref" href="ch04.html#javacook-regex">Chapter 4</a>). For example, you might say that an email address consists of a series of alphanumerics, followed by an at sign (@), followed by a series of alphanumerics with periods embedded, like this:</p>&#13;
&#13;
<pre data-type="programlisting">name:  [A-Za-z0-9]+@[A-Za-z0-0.]&#13;
or&#13;
name: \w+#[\w.]</pre>&#13;
&#13;
<p>The tool then writes code that recognizes the characters you have described.&#13;
These tools also have a grammatical specification, which says, for example,&#13;
that the keyword <code class="keep-together">EMAIL</code> must appear, followed by a colon,&#13;
followed by a <code>name</code> token, as previously defined.</p>&#13;
&#13;
<p>There are several good third-party parser generator tools for Java.&#13;
They vary widely based on complexity, power, and ease of use:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>One of the best known and most elaborate is<a data-primary="ANTLR" data-type="indexterm" id="idm45290655011704"/> <a href="http://www.antlr.org">ANTLR</a>.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-primary="Java CC" data-type="indexterm" id="idm45290655009416"/>JavaCC is an open source project at <a href="https://javacc.org"><em class="hyperlink">https://javacc.org</em></a>.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-primary="JParsec" data-type="indexterm" id="idm45290655006760"/>JParsec lets you write the parser in straight Java, so it’s all built&#13;
at compile time (most of the others require a separate parse generation step, with the build and debugging issues that raises). JParsec is on <a href="https://github.com/abailly/jparsec">GitHub</a>.&#13;
*<a data-primary="JFlex" data-type="indexterm" id="idm45290655004856"/><a data-primary="CUP" data-type="indexterm" id="idm45290655004120"/> <a href="http://jflex.de">JFlex</a> and <a href="http://www2.cs.tum.edu/projects/cup">CUP</a> work together like the original <em>yacc</em> and <em>lex</em>, as grammar parser and lexical scanner, respectively.</p>&#13;
</li>&#13;
<li>&#13;
<p>Parboiled uses<a data-primary="Parsing Expression Grammar (PEG)" data-type="indexterm" id="idm45290655000008"/><a data-primary="PEG (Parsing Expression Grammar)" data-type="indexterm" id="idm45290654999304"/> <em>Parsing Expression Grammar</em> (PEG) to also build the parser at compile time. See <a href="https://github.com/sirthias/parboiled">GitHub</a> for more information.&#13;
*<a data-primary="Rats! (parser generator)" data-type="indexterm" id="idm45290654997288"/> The <em>Rats!</em> parser generator is part of the <a href="http://cs.nyu.edu/rgrimm/xtc">eXTensible Compiler Project</a> at New York University.</p>&#13;
</li>&#13;
<li>&#13;
<p>There are others; a more complete list is maintained at <a href="http://java-source.net/open-source/parser-generators">Java Source</a>.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>These parser generators can be used to write grammars for a&#13;
wide variety of programs, from simple calculators—such as the one&#13;
in <a data-type="xref" href="#javacook-io-SECT-5">Recipe 10.6</a>—through HTML and CORBA/IDL, up to full Java&#13;
and C/C++ parsers. Examples of these are included with the&#13;
downloads. Unfortunately, the learning curve for parsers in general&#13;
precludes providing a simple and comprehensive example here, let alone comparing them intelligently. Refer to the documentation&#13;
and the numerous examples provided with each distribution.</p>&#13;
&#13;
<p>As an alternative to using one of these, you could simply roll your own recursive descent parser; and once you learn how to do so, you may find it’s not really that difficult, quite possibly even less hassle than dealing with the extra parser generator software (depending on the complexity of the grammar involved, obviously).</p>&#13;
&#13;
<p>Java developers have a range of choices, including simple line-at-a-time scanners using <code>StringTokenizer</code>, fancier token-based scanners using <code>StreamTokenizer</code>, a <code>Scanner</code> class to scan simple tokens (see <a data-type="xref" href="#javacook-io-SECT-5">Recipe 10.6</a>), regular expressions (see <a data-type="xref" href="ch04.html#javacook-regex">Chapter 4</a>), and third-party solutions including grammar-based scanners based on the parsing tools listed here.</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="javacook-ioOptions">&#13;
<h5>Understanding I/O Options: StandardOpenOptions, FileAttribute, PosixFileAttribute, and More</h5>&#13;
<p>There are several sets of options that can be applied when creating or opening a file.&#13;
The main option sets that can be applied include those listed in  <a data-type="xref" href="#javacook-ioOptions-main">Table 10-4</a>:</p>&#13;
<table id="javacook-ioOptions-main">&#13;
<caption><span class="label">Table 10-4. </span>Sets of options</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Name</th>&#13;
<th>Examples</th>&#13;
<th>Usage/notes</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>CopyOption</code></p></td>&#13;
<td><p><code>StandardCopyOption.REPLACE_EXISTING</code></p></td>&#13;
<td><p><code>Files</code> methods that copy</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>LinkOption</code></p></td>&#13;
<td><p><code>LinkOption.NOFOLLOW_LINKS</code></p></td>&#13;
<td><p><code>Files</code> methods that write data or read attributes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>FileAttribute</code></p></td>&#13;
<td/>&#13;
<td><p>Name-value pair, used in <code>Files.create*()</code> methods</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>OpenOption</code></p></td>&#13;
<td><p><code>StandardOpenOption.READ,APPEND</code></p></td>&#13;
<td><p><code>Files.new{In,Out}putStream()</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>PosixFilePermission</code></p></td>&#13;
<td><p><code>OWNER_READ,OTHER_WRITE</code></p></td>&#13;
<td><p><code>FileAttribute</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>PosixFilePermissions</code></p></td>&#13;
<td><p><code>Set&lt;PosixFilePermission&gt;</code></p></td>&#13;
<td><p>Conversions to/from rwx strings</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>A list of the standard <code>OpenOption</code> values is in <a data-type="xref" href="#javacook-dir_file-OPEN-OPTIONS">Table 10-5</a>.&#13;
These control how a file is to be accessed.</p>&#13;
<table id="javacook-dir_file-OPEN-OPTIONS">&#13;
<caption><span class="label">Table 10-5. </span>OpenOption StandardOpenOption values</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Name</th>&#13;
<th>Meaning</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>APPEND</code></p></td>&#13;
<td><p>Write at the end of an existing file instead of overwriting it.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>CREATE</code></p></td>&#13;
<td><p>Create the file if it does not exist.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>CREATE_NEW</code></p></td>&#13;
<td><p>Create the file only if it is new; fails with <code>FileAlreadyExistsException</code> if file already exists.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>DELETE_ON_CLOSE</code></p></td>&#13;
<td><p>Delete the file when the stream is closed. Useful for temporary files.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>DSYNC</code></p></td>&#13;
<td><p>Write data synchronously, i.e., every write is to be synchronized to disk immediately.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>READ</code></p></td>&#13;
<td><p>Open the file for reading.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>SPARSE</code></p></td>&#13;
<td><p>Create as a sparse file, e.g., for random-access writing.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>SYNC</code></p></td>&#13;
<td><p>Write data and metadata synchronously, i.e., every write or attribute change is to be synchronized to disk immediately.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>TRUNCATE_EXISTING</code></p></td>&#13;
<td><p>If the file exists, open for writing at the beginning, removing all contents at open time.</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>WRITE</code></p></td>&#13;
<td><p>Open for write access.</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>POSIX is the IEEE’s Portable Operating System Specification for Unix-like operating systems. Java’s&#13;
<code>PosixPermission</code> and its wrapper <code>PosixPermissions</code> are used to control who can do what to a file on disk.&#13;
These are based on the Unix/POSIX permissions laid down in early Unix systems in the early 1970s.&#13;
There are three actors: owner (which Unix calls user), group, and other (everyone else).&#13;
Groups is a Unix/POSIX mechanism: a user can be in one or many groups and has permissions&#13;
based on all the groups they are in; this is an early form of privilege separation.&#13;
There are three permissions: read, write, and execute.&#13;
The latter grants permission to execute a file, but is also used to grant permission to&#13;
search (list) a directory.&#13;
For decades these have been expressed as a nine-character permissions string.&#13;
For example, <code>rwxr—r--</code> means the user has read, write, and execute permissions&#13;
on a given file; other members of the file owner’s group have read-only access,&#13;
and everyone else also has read-only access.&#13;
The <code>PosixPermissions</code> wrapper class has methods for converting between these concise strings&#13;
and a <code>Set</code> of individual <code>PosixPermission</code> enum constants.&#13;
The enum constants are the nine combinations of <code>OWNER</code>, <code>GROUP</code>, and <code>OTHERS</code> with <code>READ</code>, <code>WRITE</code>, and <code>EXECUTE</code>. Here is a JShell example showing these file permission conversion routines:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">Set</code><code class="o">&lt;</code><code class="n">PosixFilePermission</code><code class="o">&gt;</code> <code class="n">perms</code> <code class="o">=</code>&#13;
  <code class="n">PosixFilePermissions</code><code class="o">.</code><code class="na">fromString</code><code class="o">(</code><code class="s">"rwxr-xr--"</code><code class="o">);</code>&#13;
<code class="n">perms</code> <code class="o">==&gt;</code> <code class="o">[</code><code class="n">OWNER_READ</code><code class="o">,</code> <code class="n">OWNER_WRITE</code><code class="o">,</code> <code class="n">OWNER_EXECUTE</code><code class="o">,</code> <code class="n">GROUP_READ</code><code class="o">,</code>&#13;
  <code class="n">GROUP_EXECUTE</code><code class="o">,</code> <code class="n">OTHERS_READ</code><code class="o">]</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">Set</code><code class="o">&lt;</code><code class="n">PosixFilePermission</code><code class="o">&gt;</code> <code class="n">nPerms</code> <code class="o">=</code>&#13;
  <code class="n">Set</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">PosixFilePermission</code><code class="o">.</code><code class="na">OWNER_READ</code><code class="o">,</code> <code class="n">PosixFilePermission</code><code class="o">.</code><code class="na">GROUP_READ</code><code class="o">);</code>&#13;
<code class="n">nPerms</code> <code class="o">==&gt;</code> <code class="o">[</code><code class="n">GROUP_READ</code><code class="o">,</code> <code class="n">OWNER_READ</code><code class="o">]</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">PosixFilePermissions</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="n">nPerms</code><code class="o">)</code>&#13;
<code class="n">$7</code> <code class="o">==&gt;</code> <code class="s">"r--r-----"</code></pre>&#13;
&#13;
<p>You can further convert the <code>Set&lt;PosixFilePermission&gt;</code> into a <code>FileAttribute</code> to be used with the <code>Files</code> class <a data-primary="createFile() method" data-type="indexterm" id="idm45290654888120"/><a data-primary="createDirectory() method" data-type="indexterm" id="idm45290654887416"/><code>createFile()</code> or <code>createDirectory()</code> operations:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">PosixFilePermissions</code><code class="o">.</code><code class="na">asFileAttribute</code><code class="o">(</code><code class="n">nPerms</code><code class="o">)</code>&#13;
<code class="n">$8</code> <code class="o">==&gt;</code> <code class="n">java</code><code class="o">.</code><code class="na">nio</code><code class="o">.</code><code class="na">file</code><code class="o">.</code><code class="na">attribute</code><code class="o">.</code><code class="na">PosixFilePermissions</code><code class="n">$1</code><code class="nd">@ed17bee</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">$8</code><code class="o">.</code><code class="na">name</code><code class="o">()</code>&#13;
<code class="n">$9</code> <code class="o">==&gt;</code> <code class="s">"posix:permissions"</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">$8</code><code class="o">.</code><code class="na">value</code><code class="o">()</code>&#13;
<code class="n">$10</code> <code class="o">==&gt;</code> <code class="o">[</code><code class="n">OWNER_READ</code><code class="o">,</code> <code class="n">GROUP_READ</code><code class="o">]</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">Files</code><code class="o">.</code><code class="na">createFile</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/tmp/xx"</code><code class="o">),</code> <code class="n">$8</code><code class="o">);</code>&#13;
<code class="n">$41</code> <code class="o">==&gt;</code> <code class="o">/</code><code class="n">tmp</code><code class="o">/</code><code class="n">xx</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="o">/</code><code class="n">exit</code>&#13;
&#13;
<code class="n">$</code> <code class="n">ls</code> <code class="o">-</code><code class="n">l</code> <code class="o">/</code><code class="n">tmp</code><code class="o">/</code><code class="n">xx</code>&#13;
<code class="o">-</code><code class="n">r</code><code class="o">--</code><code class="n">r</code><code class="o">-----</code>  <code class="mi">1</code> <code class="n">ian</code>  <code class="n">wheel</code>  <code class="mi">0</code> <code class="n">Dec</code> <code class="mi">23</code> <code class="mi">11</code><code class="o">:</code><code class="mi">14</code> <code class="o">/</code><code class="n">tmp</code><code class="o">/</code><code class="n">xx</code>&#13;
<code class="n">$</code></pre>&#13;
&#13;
<p>We see the file was created with only owner-read and group-read permissions, as requested.&#13;
Note that on *nix systems there is a user setting <code>umask</code> that may remove or mask out&#13;
permissions, so what you ask for may not be exactly what you get.</p>&#13;
&#13;
<p>You can examine the attributes of a file using the <code>FileAttribute</code> interface&#13;
or its filesystem-specific subtypes. Here we’ll use the <code>PosixFileAttributeView</code>&#13;
to show the owner and permissions of the file we created:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="n">PosixFileAttributes</code> <code class="n">attrs</code> <code class="o">=</code>&#13;
            <code class="n">Files</code><code class="o">.</code><code class="na">getFileAttributeView</code><code class="o">(</code><code class="n">filePath</code><code class="o">,</code>&#13;
                <code class="n">PosixFileAttributeView</code><code class="o">.</code><code class="na">class</code><code class="o">)</code>&#13;
            <code class="o">.</code><code class="na">readAttributes</code><code class="o">();</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"File %s Owned by %s has perms %s%n"</code><code class="o">,</code>&#13;
            <code class="n">filePath</code><code class="o">,</code>&#13;
            <code class="n">attrs</code><code class="o">.</code><code class="na">owner</code><code class="o">().</code><code class="na">getName</code><code class="o">(),</code>&#13;
            <code class="n">PosixFilePermissions</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="n">attrs</code><code class="o">.</code><code class="na">permissions</code><code class="o">()));</code></pre>&#13;
&#13;
<p>There are other filesystem-specific views, such as <code>DosFilewAttributeView</code>&#13;
for use on FAT filesystems. FAT was copied from CPM-86 into the earliest releases&#13;
of MS-DOS, and expanded versions of it are still in use on USB memory cards&#13;
and in consumer devices.<a data-primary="" data-startref="gs_io" data-type="indexterm" id="idm45290654471160"/><a data-primary="" data-startref="io_gs" data-type="indexterm" id="idm45290654470312"/></p>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.8 Copying a File" data-type="sect1"><div class="sect1" id="javacook-io-SECT-7">&#13;
<h1>10.8 Copying a File</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-7.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="files, copying" data-type="indexterm" id="idm45290654466648"/><a data-primary="files" data-secondary="copying" data-type="indexterm" id="idm45290654465672"/>You need to copy a file in its entirety.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-7.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use one of the Java 11 <a data-primary="Files.copy() method" data-type="indexterm" id="idm45290654585560"/><code>Files.copy()</code> methods.&#13;
If on an older release,&#13;
use the explicit read and write methods in the <code>Readers/Writer</code>s or <code>InputStream/OutputStream</code>s.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-7.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>Files</code> class has several overloads of a <code>copy</code> method that makes quick work of this requirement:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">Path</code> <code class="nf">copy</code><code class="o">(</code><code class="n">Path</code><code class="o">,</code> <code class="n">Path</code><code class="o">,</code> <code class="n">CopyOption</code><code class="o">...)</code> <code class="kd">throws</code> <code class="n">java</code><code class="o">.</code><code class="na">io</code><code class="o">.</code><code class="na">IOException</code><code class="o">;</code>&#13;
<code class="kt">long</code> <code class="nf">copy</code><code class="o">(</code><code class="n">InputStream</code><code class="o">,</code> <code class="n">Path</code><code class="o">,</code> <code class="n">CopyOption</code><code class="o">...)</code> <code class="kd">throws</code> <code class="n">IOException</code><code class="o">;</code>&#13;
<code class="kt">long</code> <code class="nf">copy</code><code class="o">(</code><code class="n">Path</code><code class="o">,</code> <code class="n">OutputStream</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code><code class="o">;</code></pre>&#13;
&#13;
<p>For example:</p>&#13;
&#13;
<pre data-type="programlisting">Path p = Paths.get("my_new_file");&#13;
InputStream is = // open some file for reading&#13;
long newFileSize = Files.copy(is, p);</pre>&#13;
&#13;
<p>Long ago, Java’s I/O facilities did not package a lot of the common operations&#13;
like copying one file to another or reading a file into a <code>String</code>. So back then I wrote my own&#13;
package of helper methods.&#13;
Users of older JDK versions may want to use <code>FileIO</code> from my utilities package <code>com.darwinsys.util</code>.&#13;
Here’s a simple demo program that uses <code>FileIO</code> to copy a source file to a backup file:</p>&#13;
&#13;
<p><em>main/src/demo/java/io/FileIoDemo.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kn">package</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">io</code><code class="o">;</code>&#13;
&#13;
<code class="kn">import</code> <code class="nn">java.io.IOException</code><code class="o">;</code>&#13;
&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">FileIoDemo</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">av</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">try</code> <code class="o">{</code>&#13;
            <code class="n">FileIO</code><code class="o">.</code><code class="na">copyFile</code><code class="o">(</code><code class="s">"FileIO.java"</code><code class="o">,</code> <code class="s">"FileIO.bak"</code><code class="o">);</code>&#13;
            <code class="n">FileIO</code><code class="o">.</code><code class="na">copyFile</code><code class="o">(</code><code class="s">"FileIO.class"</code><code class="o">,</code> <code class="s">"FileIO-class.bak"</code><code class="o">);</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>My <code>copyFile</code> method takes several forms, depending on whether you have two filenames, a filename and a <code>PrintWriter</code>, and so on. The code for <code>FileIO</code> itself is not shown here but is&#13;
online, in the darwinsys API download.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.9 Reassigning the Standard Streams" data-type="sect1"><div class="sect1" id="idm45290654582856">&#13;
<h1>10.9 Reassigning the Standard Streams</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-9.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="streams" data-type="indexterm" id="io_stre"/><a data-primary="streams" data-secondary="reassigning" data-type="indexterm" id="stre_re"/>You need to reassign one or more of the standard streams <code>System.in</code>, <code>System.out</code>, or <code>System.err</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-9.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Construct an <code>InputStream</code> or <code>PrintStream</code> as appropriate, and pass it to the appropriate set method in the <code>System</code> class.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-9.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The ability to reassign these streams corresponds to what Unix (or DOS command line) users think of as <a data-primary="redirection" data-type="indexterm" id="idm45290654344568"/><a data-primary="piping" data-type="indexterm" id="idm45290654343864"/><em>redirection</em>, or <em>piping</em>. This mechanism is commonly used to make a program read from or write to a file without having to explicitly open it and go through every line of code changing the read, write, print, etc. calls to refer to a different stream object. The open operation is performed by the command-line interpreter in Unix or DOS or by the calling class in Java.</p>&#13;
&#13;
<p>Although you could just assign a new <code>PrintStream</code> to the variable <code>System.out</code>, best practice&#13;
is to use the defined method to replace it:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="n">String</code> <code class="n">LOGFILENAME</code> <code class="o">=</code> <code class="s">"error.log"</code><code class="o">;</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">setErr</code><code class="o">(</code><code class="k">new</code> <code class="n">PrintStream</code><code class="o">(</code><code class="k">new</code> <code class="n">FileOutputStream</code><code class="o">(</code><code class="n">LOGFILENAME</code><code class="o">)));</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Please look for errors in "</code> <code class="o">+</code> <code class="n">LOGFILENAME</code><code class="o">);</code>&#13;
        <code class="c1">// Now assume this is somebody else's code; you'll see it</code>&#13;
        <code class="c1">//   writing to stderr...</code>&#13;
        <code class="kt">int</code><code class="o">[]</code> <code class="n">a</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">int</code><code class="o">[</code><code class="mi">5</code><code class="o">];</code>&#13;
        <code class="n">a</code><code class="o">[</code><code class="mi">10</code><code class="o">]</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>    <code class="c1">// here comes an ArrayIndexOutOfBoundsException</code></pre>&#13;
&#13;
<p>The stream you use can be one that you’ve opened, as here, or one you inherited:</p>&#13;
&#13;
<pre data-type="programlisting">System.setErr(System.out);    // merge stderr and stdout to same output file.</pre>&#13;
&#13;
<p>It could also be a stream connected to or from another <code>Process</code> you’ve started (see <a data-type="xref" href="ch18.html#javacook-otherlang-SECT-1">Recipe 18.1</a>), a network socket, or a URL. Anything that gives you a stream can be used.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.10 Duplicating a Stream as It Is Written; Reassigning Standard Streams" data-type="sect1"><div class="sect1" id="javacook-io-SECT-10">&#13;
<h1>10.10 Duplicating a Stream as It Is Written; Reassigning Standard Streams</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-10.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="reassigning standard streams" data-type="indexterm" id="io_rss"/><a data-primary="input/output" data-secondary="streams, duplicating" data-type="indexterm" id="io_sd"/><a data-primary="streams" data-secondary="duplicating" data-type="indexterm" id="stre_du"/>You want anything written to a stream, such as the standard output <code>System.out</code> or the standard error <code>System.err</code>, to appear there but <em>also</em> be logged in to a file.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-10.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Subclass <code>PrintStream</code> and have its<a data-primary="write() method" data-type="indexterm" id="idm45290654232408"/> <code>write()</code> methods write to two streams.&#13;
Then use <code>system.setErr()</code> or <code>setOut()</code> to replace the existing standard stream&#13;
with a <code>PrintStream</code> subclass.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-10.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Some classes are meant to be subclassed. Here we’re just subclassing <code>PrintStream</code> and adding a bit of functionality: a second <code>PrintStream</code>! I wrote a class called <code>TeePrintStream</code>, named after the ancient Unix command <em>tee</em>. That command allowed you to duplicate, or tee off (from plumber’s pipe tee, not the game of golf or the local pest) a copy of the data being written on a pipeline between two programs.</p>&#13;
&#13;
<p>The original Unix <a data-primary="tee command (Unix)" data-type="indexterm" id="idm45290654225224"/><em>tee</em> command is used like this: the <code>|</code> character creates a pipeline in which the standard output of one program becomes the standard input to the next. This often-used example of pipes shows how many users are logged into a Unix server:</p>&#13;
&#13;
<pre data-type="programlisting">who | wc -l</pre>&#13;
&#13;
<p>This runs the<a data-primary="who program (Unix)" data-type="indexterm" id="idm45290654222072"/> <em>who</em> program (which lists who is logged in to the system, one name per line, along with the terminal port and login time) and sends its output, not to the terminal, but rather into the standard input of the word count (<em>wc</em>) program. Here, <em>wc</em> is being asked to count lines, not words, hence the <code>-l</code> option. To <em>tee</em> a copy of the intermediate data into a file, you might say:</p>&#13;
&#13;
<pre data-type="programlisting">who | tee wholist | wc -l</pre>&#13;
&#13;
<p>which creates a file<a data-primary="wholist" data-type="indexterm" id="idm45290654217752"/> <em>wholist</em> containing the data. For the curious, the file <em>wholist</em> might look something like this:</p>&#13;
&#13;
<pre data-type="programlisting">ian      ttyC0    Mar 14 09:59&#13;
ben      ttyC3    Mar 14 10:23&#13;
ian      ttyp4    Mar 14 13:46  (laptop.darwinsys.com)</pre>&#13;
&#13;
<p>So both the previous command sequences would print <code>3</code> as their output.</p>&#13;
&#13;
<p><code>TeePrintStream</code> is an attempt to capture the spirit of the <em>tee</em> command.&#13;
It can be used like this:</p>&#13;
&#13;
<pre data-type="programlisting">System.setErr(new TeePrintStream(System.err, "err.log"));&#13;
// ...lots of code that occasionally writes to System.err... Or might.</pre>&#13;
&#13;
<p><a data-primary="System.setErr() method" data-type="indexterm" id="idm45290654211848"/><code>System.setErr()</code> <a data-primary="System.setOut() method" data-type="indexterm" id="idm45290654210568"/>is a means of specifying the destination of text printed to <code class="keep-together">System.err</code> (there are also <code>System.setOut()</code> and <code>System.setIn()</code>). This code results in any messages that printed to <code>System.err</code> to print to wherever <code>System.err</code> was previously directed (normally the terminal, but possibly a text window in an IDE) and to the file <em>err.log</em>.</p>&#13;
&#13;
<p>This technique is not limited to the three standard streams. A <code>TeePrintStream</code> can be passed to any method that wants a <code>PrintStream</code>. Or, for that matter, an <code>OutputStream</code>. And you can adapt the technique for <code>BufferedInputStreams</code>, <code>PrintWriters</code>, <code>BufferedReaders</code>, and so on.</p>&#13;
&#13;
<p><a data-type="xref" href="#javacook-io-TeePrintStream">Example 10-6</a> shows the source code for <code>TeePrintStream</code>.</p>&#13;
<div data-type="example" id="javacook-io-TeePrintStream">&#13;
<h5><span class="label">Example 10-6. </span>main/src/main/java/io/TeePrintStream.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">TeePrintStream</code> <code class="kd">extends</code> <code class="n">PrintStream</code> <code class="o">{</code>&#13;
    <code class="cm">/** The original/direct print stream */</code>&#13;
    <code class="kd">protected</code> <code class="n">PrintStream</code> <code class="n">parent</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** The filename we are tee-ing too, if known;</code>&#13;
<code class="cm">     * intended for use in future error reporting.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">protected</code> <code class="n">String</code> <code class="n">fileName</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** The name for when the input filename is not known */</code>&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">UNKNOWN_NAME</code> <code class="o">=</code> <code class="s">"(opened Stream)"</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** Construct a TeePrintStream given an existing PrintStream,</code>&#13;
<code class="cm">     * an opened OutputStream, and a boolean to control auto-flush.</code>&#13;
<code class="cm">     * This is the main constructor, to which others delegate via "this".</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="nf">TeePrintStream</code><code class="o">(</code><code class="n">PrintStream</code> <code class="n">orig</code><code class="o">,</code> <code class="n">OutputStream</code> <code class="n">os</code><code class="o">,</code> <code class="kt">boolean</code> <code class="n">flush</code><code class="o">)</code>&#13;
    <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="kd">super</code><code class="o">(</code><code class="n">os</code><code class="o">,</code> <code class="kc">true</code><code class="o">);</code>&#13;
        <code class="n">fileName</code> <code class="o">=</code> <code class="n">UNKNOWN_NAME</code><code class="o">;</code>&#13;
        <code class="n">parent</code> <code class="o">=</code> <code class="n">orig</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct a TeePrintStream given an existing PrintStream and</code>&#13;
<code class="cm">     * an opened OutputStream.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="nf">TeePrintStream</code><code class="o">(</code><code class="n">PrintStream</code> <code class="n">orig</code><code class="o">,</code> <code class="n">OutputStream</code> <code class="n">os</code><code class="o">)</code>&#13;
    <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="n">orig</code><code class="o">,</code> <code class="n">os</code><code class="o">,</code> <code class="kc">true</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/* Construct a TeePrintStream given an existing Stream and a filename.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="nf">TeePrintStream</code><code class="o">(</code><code class="n">PrintStream</code> <code class="n">os</code><code class="o">,</code> <code class="n">String</code> <code class="n">fn</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="n">os</code><code class="o">,</code> <code class="n">fn</code><code class="o">,</code> <code class="kc">true</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/* Construct a TeePrintStream given an existing Stream, a filename,</code>&#13;
<code class="cm">     * and a boolean to control the flush operation.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="nf">TeePrintStream</code><code class="o">(</code><code class="n">PrintStream</code> <code class="n">orig</code><code class="o">,</code> <code class="n">String</code> <code class="n">fn</code><code class="o">,</code> <code class="kt">boolean</code> <code class="n">flush</code><code class="o">)</code>&#13;
    <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="n">orig</code><code class="o">,</code> <code class="k">new</code> <code class="n">FileOutputStream</code><code class="o">(</code><code class="n">fn</code><code class="o">),</code> <code class="n">flush</code><code class="o">);</code>&#13;
        <code class="n">fileName</code> <code class="o">=</code> <code class="n">fn</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Return true if either stream has an error. */</code>&#13;
    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">checkError</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">parent</code><code class="o">.</code><code class="na">checkError</code><code class="o">()</code> <code class="o">||</code> <code class="kd">super</code><code class="o">.</code><code class="na">checkError</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** override write(). This is the actual "tee" operation. */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">write</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">parent</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">x</code><code class="o">);</code>    <code class="c1">// "write once;</code>&#13;
        <code class="kd">super</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">x</code><code class="o">);</code>        <code class="c1">// write somewhere else."</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** override write(). This is the actual "tee" operation. */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">write</code><code class="o">(</code><code class="kt">byte</code><code class="o">[]</code> <code class="n">x</code><code class="o">,</code> <code class="kt">int</code> <code class="n">o</code><code class="o">,</code> <code class="kt">int</code> <code class="n">l</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">parent</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">o</code><code class="o">,</code> <code class="n">l</code><code class="o">);</code>    <code class="c1">// "write once;</code>&#13;
        <code class="kd">super</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">x</code><code class="o">,</code> <code class="n">o</code><code class="o">,</code> <code class="n">l</code><code class="o">);</code>    <code class="c1">// write somewhere else."</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Close both streams. */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">close</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">parent</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
        <code class="kd">super</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Flush both streams. */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">flush</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">parent</code><code class="o">.</code><code class="na">flush</code><code class="o">();</code>&#13;
        <code class="kd">super</code><code class="o">.</code><code class="na">flush</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>It’s worth mentioning that I do <em>not</em> need to override all the polymorphic forms of <a data-primary="print() method" data-type="indexterm" id="idm45290654168040"/><a data-primary="println() method" data-type="indexterm" id="idm45290654167544"/><code>print()</code> and <code>println()</code>. Because these all ultimately use one of the forms of <code>write()</code>, if you override the <code>print</code> and <code>println</code> methods to do the <em>tee</em>-ing as well, you can get several additional copies of the data written out.<a data-primary="" data-startref="io_stre" data-type="indexterm" id="idm45290654164312"/><a data-primary="" data-startref="stre_re" data-type="indexterm" id="idm45290653918808"/><a data-primary="" data-startref="io_rss" data-type="indexterm" id="idm45290653917864"/><a data-primary="" data-startref="io_sd" data-type="indexterm" id="idm45290653916920"/><a data-primary="" data-startref="stre_du" data-type="indexterm" id="idm45290653915976"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.11 Reading/Writing a Different Character Set" data-type="sect1"><div class="sect1" id="javacook-io-SECT-11">&#13;
<h1>10.11 Reading/Writing a Different Character Set</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-11.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="character sets, converting" data-type="indexterm" id="idm45290653912408"/><a data-primary="input/output" data-secondary="converting character sets" data-type="indexterm" id="idm45290653911688"/>You need to read or write a text file using a particular encoding.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-11.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Convert the text to or from internal Unicode by specifying a converter when you construct an <code>InputStreamReader</code> or <code>PrintWriter</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-11.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Classes <code>InputStreamReader</code> and <code>OutputStreamWriter</code> are the bridge from byte-oriented&#13;
<code>Stream</code>s to character-based <code>Reader</code>s. These classes read or write bytes and&#13;
translate them to or from characters according to a specified character encoding. The&#13;
UTF-16 character set used inside Java (<code>char</code> and <code>String</code> types) is a 16-bit&#13;
character set. But most character sets—such as ASCII, Swedish, Spanish, Greek,&#13;
Turkish, and many others—use only a small subset of that. In fact, many European&#13;
language character sets fit nicely into 8-bit characters. Even the larger character&#13;
sets (script-based and pictographic languages) don’t all use the same bit values for&#13;
each particular character. The encoding, then, is a mapping between Java characters&#13;
and an external storage format for characters drawn from a particular national or&#13;
linguistic character set.</p>&#13;
&#13;
<p>To simplify matters, the <code>InputStreamReader</code> and <code>OutputStreamWriter</code> constructors are the only places where you can specify the name of an encoding to be used in this translation. If you do not specify an encoding, the platform’s (or user’s) default <span class="keep-together">encoding is</span> used. <code>PrintWriters</code>, <code>BufferedReaders</code>, and the like all use whatever encoding the <code>InputStreamReader</code> or <code>OutputStreamWriter</code> class uses. Because these bridge classes only accept <code>Stream</code> arguments in their constructors, the implication is that if you want to specify a nondefault converter to read or write a file on disk, you must start by constructing not a <code>FileReader</code> or <code>FileWriter</code>, but a <code>FileInputStream</code> or <code>FileOutputStream</code>!</p>&#13;
&#13;
<pre data-type="programlisting">// io/UseConverters.java&#13;
BufferedReader fromKanji = new BufferedReader(&#13;
    new InputStreamReader(new FileInputStream("kanji.txt"), "EUC_JP"));&#13;
PrintWriter toSwedish = new PrinterWriter(&#13;
    new OutputStreamWriter(new FileOutputStream("sverige.txt"), "Cp278"));</pre>&#13;
&#13;
<p>Not that it would necessarily make sense to read a single file from Kanji and output it in a Swedish encoding. For one thing, most fonts would not have all the characters of both character sets; and, at any rate, the Swedish encoding certainly has far fewer characters in it than the Kanji encoding. Besides, if that were all you wanted, you could use a JDK tool with the ill-fitting name <a data-primary="native2ascii" data-type="indexterm" id="idm45290653894104"/><em>native2ascii</em> (see its documentation for details). A list of the supported encodings is also in the JDK documentation, in the file <em>docs/guide/internat/encoding.doc.html</em>. A more detailed description is found in Appendix B of <em><a class="orm:hideurl" href="http://shop.oreilly.com/product/9780596527501.do">Java I/O</a></em>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.12 Those Pesky End-of-Line Characters" data-type="sect1"><div class="sect1" id="javacook-io-SECT-12">&#13;
<h1>10.12 Those Pesky End-of-Line Characters</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-12.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="end-of-line characters" data-type="indexterm" id="idm45290653888248"/><a data-primary="input/output" data-secondary="end-of-line characters" data-type="indexterm" id="idm45290653887544"/>You really want to know about end-of-line characters.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-12.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>\r</code> and <code>\n</code> in whatever combination makes sense.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-12.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>If you are reading text (or bytes containing ASCII characters) in line mode&#13;
using the <a data-primary="readLine() method" data-type="indexterm" id="idm45290653881432"/><code>readLine()</code> method, you’ll never see the end-of-line characters,&#13;
and if you’re using a <code>PrintWriter</code> with its <a data-primary="println() method" data-type="indexterm" id="idm45290653879928"/><code>println()</code> method, the same applies.&#13;
Thus you won’t be cursed with having to figure out whether <code>\n</code>, <code>\r</code>, or&#13;
<code>\r\n</code> appears at the end of each line.</p>&#13;
&#13;
<p>If you want that level of detail, you have to read the characters or bytes&#13;
one at a time, using the<a data-primary="read() method" data-type="indexterm" id="idm45290653876760"/> <code>read()</code> methods. The only time I’ve found this&#13;
necessary is in networking code, where some of the line-mode protocols&#13;
assume that the line ending is <code>\r\n</code>.  Even here, though, you can still&#13;
work in line mode. When writing, pass <code>\r\n</code> into the <a data-primary="print() method" data-type="indexterm" id="idm45290653874520"/><code>print()</code> (not&#13;
+deal with the characters:</p>&#13;
&#13;
<pre data-type="programlisting">outputSocket.print("HELO " + myName + "\r\n");&#13;
String response = inputSocket.readLine();</pre>&#13;
&#13;
<p>For the curious, the strange spelling of “hello” is used in SMTP, the mail sending protocol, where commands&#13;
are four letters.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.13 Beware Platform-Dependent File Code" data-type="sect1"><div class="sect1" id="javacook-io-SECT-13">&#13;
<h1>10.13 Beware Platform-Dependent File Code</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-13.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="platform-independent code" data-type="indexterm" id="idm45290653869224"/><a data-primary="platform-independent code" data-type="indexterm" id="idm45290653868184"/>Chastened by the previous recipe, you now wish to write only platform-independent code.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-13.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>readLine()</code> and <code>println()</code>. Avoid use of <code>\n</code> by itself; use <code>File.separator</code> if you must.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-13.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>As mentioned in <a data-type="xref" href="#javacook-io-SECT-12">Recipe 10.12</a>, if you just use <code>readLine()</code> and <code>println()</code>, you won’t have to think about the line endings. But a particular problem, especially for former programmers of C and related languages, is using the <code>\n</code> character in text strings to mean a newline. What is particularly distressing about this code is that it works—sometimes—usually on the developer’s own platform. But it will probably fail someday, on some other system:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">    <code class="n">String</code> <code class="n">myName</code><code class="o">;</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">BadNewline</code> <code class="n">jack</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BadNewline</code><code class="o">(</code><code class="s">"Jack Adolphus Schmidt, III"</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">jack</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
    <code class="cm">/**</code>&#13;
<code class="cm">     * DON'T DO THIS. THIS IS BAD CODE.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">toString</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="s">"BadNewlineDemo@"</code> <code class="o">+</code> <code class="n">hashCode</code><code class="o">()</code> <code class="o">+</code> <code class="s">"\n"</code> <code class="o">+</code> <code class="n">myName</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="c1">// The obvious Constructor is not shown for brevity; it's in the code</code></pre>&#13;
&#13;
<p>The real problem is not that it fails on some platforms, though. What’s really wrong is that it mixes formatting and I/O, or tries to. Don’t mix line-based display with <a data-primary="toString() method" data-type="indexterm" id="idm45290653855720"/><code>toString()</code>; avoid <a data-primary="multiline strings" data-type="indexterm" id="idm45290653698232"/><em>multiline strings</em>—output from <code>toString()</code> or any other string-returning method. If you need to write multiple strings, then say what you mean:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">    <code class="n">String</code> <code class="n">myName</code><code class="o">;</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">GoodNewline</code> <code class="n">jack</code> <code class="o">=</code> <code class="k">new</code> <code class="n">GoodNewline</code><code class="o">(</code><code class="s">"Jack Adolphus Schmidt, III"</code><code class="o">);</code>&#13;
        <code class="n">jack</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">print</code><code class="o">(</code><code class="n">PrintStream</code> <code class="n">out</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">toString</code><code class="o">());</code>    <code class="c1">// classname and hashcode</code>&#13;
        <code class="n">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">myName</code><code class="o">);</code>        <code class="c1">// print name  on next line</code>&#13;
    <code class="o">}</code></pre>&#13;
&#13;
<p>Alternatively, if you need multiple lines, you could return an array or <code>List</code> of strings.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.14 Reading/Writing Binary Data" data-type="sect1"><div class="sect1" id="javacook-io-SECT-15">&#13;
<h1>10.14 Reading/Writing Binary Data</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-15.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="binary data" data-secondary="as input/output" data-type="indexterm" id="idm45290653526968"/><a data-primary="input/output" data-secondary="binary data as" data-type="indexterm" id="idm45290653825336"/>You need to read or write binary data, as opposed to text.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-15.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use a <code>DataInputStream</code> or <code>DataOutputStream</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-15.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>Stream</code> classes have been in Java since the beginning of time and are optimal for reading and writing bytes rather than characters. The data layer over them, comprising <code>DataInputStream</code> and <code>DataOutputStream</code>, is configured for reading and writing binary values, including all of Java’s built-in types. Suppose that you want to write a binary integer plus a binary floating-point value into a file and read it back later. This code shows the writing part:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">WriteBinary</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">42</code><code class="o">;</code>&#13;
        <code class="kt">double</code> <code class="n">d</code> <code class="o">=</code> <code class="n">Math</code><code class="o">.</code><code class="na">PI</code><code class="o">;</code>&#13;
        <code class="n">String</code> <code class="n">FILENAME</code> <code class="o">=</code> <code class="s">"binary.dat"</code><code class="o">;</code>&#13;
        <code class="n">DataOutputStream</code> <code class="n">os</code> <code class="o">=</code> <code class="k">new</code> <code class="n">DataOutputStream</code><code class="o">(</code>&#13;
            <code class="k">new</code> <code class="nf">FileOutputStream</code><code class="o">(</code><code class="n">FILENAME</code><code class="o">));</code>&#13;
        <code class="n">os</code><code class="o">.</code><code class="na">writeInt</code><code class="o">(</code><code class="n">i</code><code class="o">);</code>&#13;
        <code class="n">os</code><code class="o">.</code><code class="na">writeDouble</code><code class="o">(</code><code class="n">d</code><code class="o">);</code>&#13;
        <code class="n">os</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Wrote "</code> <code class="o">+</code> <code class="n">i</code> <code class="o">+</code> <code class="s">", "</code> <code class="o">+</code> <code class="n">d</code> <code class="o">+</code> <code class="s">" to file "</code> <code class="o">+</code> <code class="n">FILENAME</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Should you need to write all the fields from an object, you should probably use one of the methods described in <a data-type="xref" href="ch12.html#javacook-netclient-SECT-5">Recipe 12.6</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.15 Reading and Writing JAR or ZIP Archives" data-type="sect1"><div class="sect1" id="javacook-io-SECT-20">&#13;
<h1>10.15 Reading and Writing JAR or ZIP Archives</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-SECT-20.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="of JAR files" data-type="indexterm" id="io_jf"/><a data-primary="input/output" data-secondary="of ZIP files" data-type="indexterm" id="io_zf"/><a data-primary="JAR files" data-secondary="input/output of" data-type="indexterm" id="jf_io"/><a data-primary="ZIP files, input/output of" data-type="indexterm" id="zf_io"/>You need to create and/or extract from a JAR archive or a file in the well-known ZIP archive format, as established by PkZip and used by Unix zip/unzip and WinZip.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-SECT-20.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>You could use the <em>jar</em> program in the Java Development Kit because its file format is identical to the ZIP format with the addition of the <em>META-INF</em> directory to contain additional structural information. But because this is a book about programming, you are probably more interested in the <code>ZipFile</code> and <code>ZipEntry</code>  classes and the stream classes to which they provide access.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-SECT-20.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The class <code>java.util.zip.ZipFile</code>  is not an I/O class <em>per se</em>, but a utility class that allows you to read or write the contents of a JAR or ZIP-format file.<sup><a data-type="noteref" href="ch10.html#idm45290653458856" id="idm45290653458856-marker">5</a></sup> When constructed, it creates a series of <code>ZipEntry</code> objects, one to represent each entry in the archive. In other words, the <code>ZipFile</code> represents the entire archive, and the <code>ZipEntry</code> represents one entry, or one file that has been stored (and compressed) in the archive. The <code>ZipEntry</code>  has methods like<a data-primary="getName() method" data-type="indexterm" id="idm45290653456248"/> <code>getName()</code>, which returns the name that the file had before it was put into the archive, and <a data-primary="getInputStream() method" data-type="indexterm" id="idm45290653454968"/><code>getInputStream()</code>, which gives you an <code>InputStream</code> that will transparently uncompress the archive entry by filtering it as you read it. To create a <code>ZipFile</code> object, you need either the name of the archive file or a <code>File</code> object representing it:</p>&#13;
&#13;
<pre data-type="programlisting">ZipFile zippy = new ZipFile(fileName);</pre>&#13;
&#13;
<p>To see whether a given file is present in the archive, you can call the <code>getEntry()</code> method with a filename. More commonly, you’ll want to process all the entries; for this, use the <code>ZipFile</code> object to get a list of the entries in the archive, in the form of an <code>Enumeration</code> (see <a data-type="xref" href="ch07.html#javacook-structure-iterate">Recipe 7.6</a>), as is done here:</p>&#13;
&#13;
<pre data-type="programlisting">Enumeration all = zippy.entries( );&#13;
while (all.hasMoreElements( )) {&#13;
    ZipEntry entry = (ZipEntry)all.nextElement( );&#13;
    ...&#13;
}</pre>&#13;
&#13;
<p>We can then process each entry as we wish. A simple listing program could be this:</p>&#13;
&#13;
<pre data-type="programlisting">if (entry.isDirectory( ))&#13;
    println("Directory: " + e.getName( ));&#13;
else&#13;
    println("File: " + e.getName( ));</pre>&#13;
&#13;
<p>A fancier version would extract the files. The program in <a data-type="xref" href="#javacook-io-EX-8">Example 10-7</a> does both: it lists by default, but with the <code>-x</code> (extract) switch, it actually extracts the  files from the archive.</p>&#13;
<div data-type="example" id="javacook-io-EX-8">&#13;
<h5><span class="label">Example 10-7. </span>main/src/main/java/io/UnZip.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">UnZip</code> <code class="o">{</code>&#13;
    <code class="cm">/** Constants for mode listing or mode extracting. */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kd">enum</code> <code class="n">Mode</code> <code class="o">{</code>&#13;
        <code class="n">LIST</code><code class="o">,</code>&#13;
        <code class="n">EXTRACT</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
    <code class="cm">/** Whether we are extracting or just printing TOC */</code>&#13;
    <code class="kd">protected</code> <code class="n">Mode</code> <code class="n">mode</code> <code class="o">=</code> <code class="n">Mode</code><code class="o">.</code><code class="na">LIST</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** The ZipFile that is used to read an archive */</code>&#13;
    <code class="kd">protected</code> <code class="n">ZipFile</code> <code class="n">zippy</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** The buffer for reading/writing the ZipFile data */</code>&#13;
    <code class="kd">protected</code> <code class="kt">byte</code><code class="o">[]</code> <code class="n">b</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">byte</code><code class="o">[</code><code class="mi">8092</code><code class="o">];</code>&#13;
&#13;
    <code class="cm">/** Simple main program, construct an UnZipper, process each</code>&#13;
<code class="cm">     * .ZIP file from argv[] through that object.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">UnZip</code> <code class="n">u</code> <code class="o">=</code> <code class="k">new</code> <code class="n">UnZip</code><code class="o">();</code>&#13;
&#13;
        <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">=</code><code class="mi">0</code><code class="o">;</code> <code class="n">i</code><code class="o">&lt;</code><code class="n">argv</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="s">"-x"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">argv</code><code class="o">[</code><code class="n">i</code><code class="o">]))</code> <code class="o">{</code>&#13;
                <code class="n">u</code><code class="o">.</code><code class="na">setMode</code><code class="o">(</code><code class="n">Mode</code><code class="o">.</code><code class="na">EXTRACT</code><code class="o">);</code>&#13;
                <code class="k">continue</code><code class="o">;</code>&#13;
            <code class="o">}</code>&#13;
            <code class="n">String</code> <code class="n">candidate</code> <code class="o">=</code> <code class="n">argv</code><code class="o">[</code><code class="n">i</code><code class="o">];</code>&#13;
            <code class="c1">// System.err.println("Trying path " + candidate);</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">candidate</code><code class="o">.</code><code class="na">endsWith</code><code class="o">(</code><code class="s">".zip"</code><code class="o">)</code> <code class="o">||</code>&#13;
                <code class="n">candidate</code><code class="o">.</code><code class="na">endsWith</code><code class="o">(</code><code class="s">".jar"</code><code class="o">))</code>&#13;
                    <code class="n">u</code><code class="o">.</code><code class="na">unZip</code><code class="o">(</code><code class="n">candidate</code><code class="o">);</code>&#13;
            <code class="k">else</code> <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Not a zip file? "</code> <code class="o">+</code> <code class="n">candidate</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"All done!"</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Set the Mode (list, extract). */</code>&#13;
    <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">setMode</code><code class="o">(</code><code class="n">Mode</code> <code class="n">m</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">mode</code> <code class="o">=</code> <code class="n">m</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Cache of paths we've mkdir()ed. */</code>&#13;
    <code class="kd">protected</code> <code class="n">SortedSet</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">dirsMade</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** For a given Zip file, process each entry. */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">unZip</code><code class="o">(</code><code class="n">String</code> <code class="n">fileName</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">dirsMade</code> <code class="o">=</code> <code class="k">new</code> <code class="n">TreeSet</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;();</code>&#13;
        <code class="k">try</code> <code class="o">{</code>&#13;
            <code class="n">zippy</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ZipFile</code><code class="o">(</code><code class="n">fileName</code><code class="o">);</code>&#13;
            <code class="nd">@SuppressWarnings</code><code class="o">(</code><code class="s">"unchecked"</code><code class="o">)</code>&#13;
            <code class="n">Enumeration</code><code class="o">&lt;</code><code class="n">ZipEntry</code><code class="o">&gt;</code> <code class="n">all</code> <code class="o">=</code> <code class="o">(</code><code class="n">Enumeration</code><code class="o">&lt;</code><code class="n">ZipEntry</code><code class="o">&gt;)</code> <code class="n">zippy</code><code class="o">.</code><code class="na">entries</code><code class="o">();</code>&#13;
            <code class="k">while</code> <code class="o">(</code><code class="n">all</code><code class="o">.</code><code class="na">hasMoreElements</code><code class="o">())</code> <code class="o">{</code>&#13;
                <code class="n">getFile</code><code class="o">((</code><code class="n">ZipEntry</code><code class="o">)</code><code class="n">all</code><code class="o">.</code><code class="na">nextElement</code><code class="o">());</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">err</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"IO Error: "</code> <code class="o">+</code> <code class="n">err</code><code class="o">);</code>&#13;
            <code class="k">return</code><code class="o">;</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">protected</code> <code class="kt">boolean</code> <code class="n">warnedMkDir</code> <code class="o">=</code> <code class="kc">false</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** Process one file from the zip, given its name.</code>&#13;
<code class="cm">     * Either print the name, or create the file on disk.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">protected</code> <code class="kt">void</code> <code class="nf">getFile</code><code class="o">(</code><code class="n">ZipEntry</code> <code class="n">e</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="n">String</code> <code class="n">zipName</code> <code class="o">=</code> <code class="n">e</code><code class="o">.</code><code class="na">getName</code><code class="o">();</code>&#13;
        <code class="k">switch</code> <code class="o">(</code><code class="n">mode</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">case</code> <code class="nl">EXTRACT:</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">zipName</code><code class="o">.</code><code class="na">startsWith</code><code class="o">(</code><code class="s">"/"</code><code class="o">))</code> <code class="o">{</code>&#13;
                <code class="k">if</code> <code class="o">(!</code><code class="n">warnedMkDir</code><code class="o">)</code>&#13;
                    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Ignoring absolute paths"</code><code class="o">);</code>&#13;
                <code class="n">warnedMkDir</code> <code class="o">=</code> <code class="kc">true</code><code class="o">;</code>&#13;
                <code class="n">zipName</code> <code class="o">=</code> <code class="n">zipName</code><code class="o">.</code><code class="na">substring</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
            <code class="c1">// if a directory, just return. We mkdir for every file,</code>&#13;
            <code class="c1">// since some widely used Zip creators don't put out</code>&#13;
            <code class="c1">// any directory entries, or put them in the wrong place.</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">zipName</code><code class="o">.</code><code class="na">endsWith</code><code class="o">(</code><code class="s">"/"</code><code class="o">))</code> <code class="o">{</code>&#13;
                <code class="k">return</code><code class="o">;</code>&#13;
            <code class="o">}</code>&#13;
            <code class="c1">// Else must be a file; open the file for output</code>&#13;
            <code class="c1">// Get the directory part.</code>&#13;
            <code class="kt">int</code> <code class="n">ix</code> <code class="o">=</code> <code class="n">zipName</code><code class="o">.</code><code class="na">lastIndexOf</code><code class="o">(</code><code class="sc">'/'</code><code class="o">);</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">ix</code> <code class="o">&gt;</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="n">String</code> <code class="n">dirName</code> <code class="o">=</code> <code class="n">zipName</code><code class="o">.</code><code class="na">substring</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="n">ix</code><code class="o">);</code>&#13;
                <code class="k">if</code> <code class="o">(!</code><code class="n">dirsMade</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="n">dirName</code><code class="o">))</code> <code class="o">{</code>&#13;
                    <code class="n">File</code> <code class="n">d</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="n">dirName</code><code class="o">);</code>&#13;
                    <code class="c1">// If it already exists as a dir, don't do anything</code>&#13;
                    <code class="k">if</code> <code class="o">(!(</code><code class="n">d</code><code class="o">.</code><code class="na">exists</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">d</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">()))</code> <code class="o">{</code>&#13;
                        <code class="c1">// Try to create the directory, warn if it fails</code>&#13;
                        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Creating Directory: "</code> <code class="o">+</code> <code class="n">dirName</code><code class="o">);</code>&#13;
                        <code class="k">if</code> <code class="o">(!</code><code class="n">d</code><code class="o">.</code><code class="na">mkdirs</code><code class="o">())</code> <code class="o">{</code>&#13;
                            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code>&#13;
                            <code class="s">"Warning: unable to mkdir "</code> <code class="o">+</code> <code class="n">dirName</code><code class="o">);</code>&#13;
                        <code class="o">}</code>&#13;
                        <code class="n">dirsMade</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">dirName</code><code class="o">);</code>&#13;
                    <code class="o">}</code>&#13;
                <code class="o">}</code>&#13;
            <code class="o">}</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Creating "</code> <code class="o">+</code> <code class="n">zipName</code><code class="o">);</code>&#13;
            <code class="n">FileOutputStream</code> <code class="n">os</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FileOutputStream</code><code class="o">(</code><code class="n">zipName</code><code class="o">);</code>&#13;
            <code class="n">InputStream</code>  <code class="n">is</code> <code class="o">=</code> <code class="n">zippy</code><code class="o">.</code><code class="na">getInputStream</code><code class="o">(</code><code class="n">e</code><code class="o">);</code>&#13;
            <code class="kt">int</code> <code class="n">n</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
            <code class="k">while</code> <code class="o">((</code><code class="n">n</code> <code class="o">=</code> <code class="n">is</code><code class="o">.</code><code class="na">read</code><code class="o">(</code><code class="n">b</code><code class="o">))</code> <code class="o">&gt;</code><code class="mi">0</code><code class="o">)</code>&#13;
                <code class="n">os</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">b</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">n</code><code class="o">);</code>&#13;
            <code class="n">is</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
            <code class="n">os</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
            <code class="k">break</code><code class="o">;</code>&#13;
        <code class="k">case</code> <code class="nl">LIST:</code>&#13;
            <code class="c1">// Not extracting, just list</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">e</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">())</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Directory "</code> <code class="o">+</code> <code class="n">zipName</code><code class="o">);</code>&#13;
            <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"File "</code> <code class="o">+</code> <code class="n">zipName</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
            <code class="k">break</code><code class="o">;</code>&#13;
        <code class="k">default</code><code class="o">:</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalStateException</code><code class="o">(</code><code class="s">"mode value ("</code> <code class="o">+</code> <code class="n">mode</code> <code class="o">+</code> <code class="s">") bad"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290653461784">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>People sometimes confuse the ZIP archive file format with the similarly named <a data-primary="gzip compression" data-type="indexterm" id="idm45290653214472"/>gzip&#13;
compression format. Gzip-compressed files can be read or written with&#13;
the <code>GZipInputStream</code> and <code>GZipOutputStream</code> classes from <code>java.io</code>.<a data-primary="" data-startref="io_jf" data-type="indexterm" id="idm45290653212392"/><a data-primary="" data-startref="io_zf" data-type="indexterm" id="idm45290653211384"/><a data-primary="" data-startref="jf_io" data-type="indexterm" id="idm45290653210440"/><a data-primary="" data-startref="zf_io" data-type="indexterm" id="idm45290653209496"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.16 Finding Files in a Filesystem-Neutral Way with getResource() and getResourceAsStream()" data-type="sect1"><div class="sect1" id="javacook-io-getRes-1">&#13;
<h1>10.16 Finding Files in a Filesystem-Neutral Way with getResource() and getResourceAsStream()</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-io-getRes-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="files" data-secondary="finding" data-type="indexterm" id="fi_fi"/><a data-primary="getResource() method" data-type="indexterm" id="grm_ab"/><a data-primary="getResourceAsStream() method" data-type="indexterm" id="grasm_ab"/><a data-primary="input/output" data-secondary="files, finding" data-type="indexterm" id="io_ff"/>You want to load objects or files without referring to their absolute location in the filesystem. You might want to do this for one of the following reasons:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>You are in a server (Java EE) environment.</p>&#13;
</li>&#13;
<li>&#13;
<p>You want to be independent of file paths.</p>&#13;
</li>&#13;
<li>&#13;
<p>You want to read a file in a unit test.</p>&#13;
</li>&#13;
<li>&#13;
<p>You expect users to deploy the resource “somewhere” on the <code>LASSPATH</code> (possibly even inside a JAR file).</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-io-getRes-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <a data-primary="getClass() method" data-type="indexterm" id="idm45290652709224"/><a data-primary="getClassLoader() method" data-type="indexterm" id="idm45290652708488"/><a data-primary="getResource() method" data-type="indexterm" id="idm45290652707816"/><a data-primary="getResourceAsStream() method" data-type="indexterm" id="idm45290652707144"/><code>getClass()</code> or <code>getClassLoader()</code> and either <code>getResource()</code> or <code>getResourceAsStream()</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-io-getRes-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>There are three varieties of <code>getResource()</code> methods, some of which exist (with the exact same signature) both in the <code>Class</code> class (see <a data-type="xref" href="ch17.html#javacook-reflection">Chapter 17</a>) and in the <code>ClassLoader</code> class (see <a data-type="xref" href="ch17.html#javacook-reflection-SECT-4">Recipe 17.5</a>). The methods in <code>Class</code> delegate to the <code>ClassLoader</code>, so there is little difference between them. The methods are summarized in <a data-type="xref" href="#javacook-io-TABLE-getRes">Table 10-6</a>.</p>&#13;
<table id="javacook-io-TABLE-getRes">&#13;
<caption><span class="label">Table 10-6. </span>The getResource* methods</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Method signature</th>&#13;
<th>In Class</th>&#13;
<th>In ClassLoader</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>public InputStream getResourceAsStream(String);</code></p></td>&#13;
<td><p>Y</p></td>&#13;
<td><p>Y</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>public URL getResource(String);</code></p></td>&#13;
<td><p>Y</p></td>&#13;
<td><p>Y</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>public Enumeration&lt;URL&gt; getResources(String) throws IOException;</code></p></td>&#13;
<td><p>N</p></td>&#13;
<td><p>Y</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>The first method is designed to quickly and easily locate a resource, or file, on your <code>CLASSPATH</code>.&#13;
Using the <code>Class</code> version, or the other one with a standard <code>ClassLoader</code> implementation,&#13;
the resource can be a physical file or a file inside a JAR file.&#13;
If you define your own classloader, your imagination is the limit, as long as it can be&#13;
represented as an <code>InputStream</code>. This is commonly used as shown here:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">InputStream</code> <code class="n">is</code> <code class="o">=</code> <code class="n">getClass</code><code class="o">().</code><code class="na">getResourceAsStream</code><code class="o">(</code><code class="s">"foo.properties"</code><code class="o">);</code>&#13;
<code class="c1">// then do something with the InputStream...</code></pre>&#13;
&#13;
<p>The second form returns a <code>URL</code>, which can be interpreted&#13;
in various ways (see the discussion of reading from a URL in&#13;
<a data-type="xref" href="ch12.html#javacook-netclient-rest-1">Recipe 12.1</a>).</p>&#13;
&#13;
<p>The third form, only usable with a <code>ClassLoader</code> instance, returns an <code>Enumeration</code> of <code>URL</code> objects. This is intended to return all the resources that match a given string; remember that a <code>CLASSPATH</code> can consist of pretty much any number of directories and/or JAR files, so this will search all of them. This is useful for finding a series of configuration files and merging them, perhaps.&#13;
Or for finding out whether there is more than one resource/file of a given name on your <code>CLASSPATH</code>.</p>&#13;
&#13;
<p>Note that the resource name can be given as either a relative path or as an absolute path.&#13;
Assuming you are using Maven (see <a data-type="xref" href="ch01.html#javacook-getstarted-maven">Recipe 1.7</a>), then for the absolute path,&#13;
place the file relative to <em>src/main/resources/</em> directory.&#13;
For the relative path, place the file in the same directory as your source code.&#13;
The same rules apply in an IDE, assuming you have made <em>src/main/java</em> and <em>src/main/resources</em>&#13;
be treated as source folders in your IDE configuration.&#13;
The idea is that resource files get copied to your <code>CLASSPATH</code> folder.&#13;
For example, if you have two resource files, <em>src/main/resources/one.txt</em> and&#13;
<em>src/main/java/MyPackage/two.txt</em>, and your project is configured as described,&#13;
these two lines would work, if accessed from a program in <code>MyPackage</code>:</p>&#13;
&#13;
<pre data-type="programlisting">Class&lt;?&gt; c = getClass();&#13;
InputStream isOne = getResourceAsStream("/one.txt");	// note leading slash&#13;
InputStream isTwo = getResourceAsStream("two.txt");	// without leading slash</pre>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>In either case, <code>getResource()</code> and <code>getResourceAsStream()</code> will&#13;
return <code>null</code> if they don’t find the resource; you should always&#13;
check for <code>null</code> to guard against faulty deployment.&#13;
If it doesn’t find <span class="keep-together">anything matching,</span> <code>getResources()</code> will return an empty <span class="keep-together"><code>Enumeration</code>.</span></p>&#13;
</div>&#13;
&#13;
<p>If the file path has slashes between components (as in <em>package/subpackage</em>), the name you path&#13;
into any of the <code>getResource</code> methods should have a period in place of the slash.<a data-primary="" data-startref="fi_fi" data-type="indexterm" id="idm45290652653496"/><a data-primary="" data-startref="grm_ab" data-type="indexterm" id="idm45290652652520"/><a data-primary="" data-startref="grasm_ab" data-type="indexterm" id="idm45290652651576"/><a data-primary="" data-startref="io_ff" data-type="indexterm" id="idm45290652650632"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.17 Getting File Information: Files and Path" data-type="sect1"><div class="sect1" id="javacook-dirfile-SECT-1">&#13;
<h1>10.17 Getting File Information: Files and Path</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="files" data-secondary="path and" data-type="indexterm" id="fi_pa"/><a data-primary="input/output" data-secondary="files and path" data-type="indexterm" id="io_fp"/><a data-primary="paths, files and" data-type="indexterm" id="pa_fi"/>You need to know all you can about a given file on disk.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>java.nio.file.Files</code> methods.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>java.nio.file.Files</code> class has a plural name both to differentiate it from the legacy <code>File</code> class&#13;
that it replaces and to remind us that it sometimes works on multiple files.&#13;
There are two types of static methods in the <code>Files</code> class,&#13;
information and operational. The informational ones (see&#13;
<a data-type="xref" href="#javacook-dirfile-Files-Methods-1">Table 10-7</a>) simply give you information about&#13;
one file, such as <code>boolean exists()</code> or <code>long size()</code>.  The operational&#13;
ones (see <a data-type="xref" href="#javacook-dirfile-Files-Methods-2">Table 10-8</a>) either make changes to the&#13;
filesystem or open a file for reading or writing.  Each of the operational&#13;
ones can throw the checked exception <code>IOException</code>; only a few of the&#13;
informational ones can.</p>&#13;
&#13;
<p>The vast majority of these methods have argument(s) of type <code>java.nio.file.Path</code>.&#13;
A <code>Path</code> represents a path into the filesystem, that is, a set of directories&#13;
and possibly a file, like “C:\Users\user\Downloads” or “/home/ian/Downloads”.&#13;
The path may or may not exist as a file on disk at the time you create a <code>Path</code> representing it.&#13;
The <code>Files</code> class can tell you whether the file represented by a given <code>Path</code> exists, can bring&#13;
that <code>Path</code> into being as a file or as a directory, and can either change the corresponding file’s&#13;
attributes or even destroy it if it does exist.&#13;
<code>Path</code> objects are easily created with <code>Path.of(String name)</code>, which has several overloads.</p>&#13;
&#13;
<p><code>Files</code> in conjunction with <code>Path</code> offers pretty well everything you’d need to write&#13;
a full-blown file manager application,&#13;
let alone the needs of a more typical application needing file information and/or directory access.&#13;
The <code>Files</code> class has a series of static <code>boolean</code> methods that give basic information.</p>&#13;
<table id="javacook-dirfile-Files-Methods-1">&#13;
<caption><span class="label">Table 10-7. </span>Public static informational methods in java.nio.file.Files</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Return type</th>&#13;
<th>Method</th>&#13;
<th>Notes</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>exists(Path, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Object</p></td>&#13;
<td><p>getAttribute(Path, String, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>&lt;V extends FileAttributeView&gt; V</p></td>&#13;
<td><p>getFileAttributeView(Path, Class&lt;V&gt;, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>FileTime</p></td>&#13;
<td><p>getLastModifiedTime(Path, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>UserPrincipal</p></td>&#13;
<td><p>getOwner(Path, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Set&lt;PosixFilePermission&gt;</p></td>&#13;
<td><p>getPosixFilePermissions(Path, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isDirectory(Path, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isExecutable(Path);</p></td>&#13;
<td><p>If Executable by current user</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isHidden(Path);</p></td>&#13;
<td><p>If a “dot file” on Unix, or “hidden” attribute set on some OSes</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isReadable(Path);</p></td>&#13;
<td><p>If Readable by current user</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isRegularFile(Path, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isSameFile(Path, Path) throws IOException;</p></td>&#13;
<td><p>Has to unwind filesys complexities like “..”, symlinks, …</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isSymbolicLink(Path);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isWritable(Path);</p></td>&#13;
<td><p>If Writable by current user</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>long</p></td>&#13;
<td><p>mismatch(Path, Path);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>notExists(Path, LinkOption…);</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>String</p></td>&#13;
<td><p>probeContentType(Path) throws IOException;</p></td>&#13;
<td><p>Tries to return MIME type of data</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>readSymbolicLink(Path) throws IOException;</p></td>&#13;
<td/>&#13;
</tr>&#13;
<tr>&#13;
<td><p>long</p></td>&#13;
<td><p>size(Path);</p></td>&#13;
<td/>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>By “current user” we mean the account under which the current JVM instance is being run.</p>&#13;
&#13;
<p>Most of these methods are demonstrated in <a data-type="xref" href="#javacook-ch10-EX-files-infos">Example 10-8</a>.</p>&#13;
<div data-type="example" id="javacook-ch10-EX-files-infos">&#13;
<h5><span class="label">Example 10-8. </span>main/src/main/java/io/FilesInfos.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="n">println</code><code class="o">(</code><code class="s">"exists"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isDirectory"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isExecutable"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isExecutable</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/bin/cat"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isHidden"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isHidden</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"~/.profile"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isReadable"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isReadable</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"lines.txt"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isRegularFile"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isRegularFile</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"lines.txt"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isSameFile"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isSameFile</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"lines.txt"</code><code class="o">),</code>&#13;
            <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"../main/lines.txt"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isSymbolicLink"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isSymbolicLink</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/var"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isWritable"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isWritable</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/tmp"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"isDirectory"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"notexists"</code><code class="o">,</code>&#13;
            <code class="n">Files</code><code class="o">.</code><code class="na">notExists</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"no_such_file_as_skjfsjljwerjwj"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"probeContentType"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">probeContentType</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"lines.txt"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"readSymbolicLink"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">readSymbolicLink</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/var"</code><code class="o">)));</code>&#13;
        <code class="n">println</code><code class="o">(</code><code class="s">"size"</code><code class="o">,</code> <code class="n">Files</code><code class="o">.</code><code class="na">size</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"lines.txt"</code><code class="o">)));</code></pre></div>&#13;
&#13;
<p>Obviously the paths chosen are somewhat system-specific, but when run&#13;
on my Unix system, the <code>boolean</code> methods all returned <code>true</code>, and the last three returned this:</p>&#13;
&#13;
<pre data-type="programlisting">probeContentType returned text/plain&#13;
readSymbolicLink returned private/var&#13;
size returned 78</pre>&#13;
&#13;
<p><a data-type="xref" href="#javacook-dirfile-Files-Methods-2">Table 10-8</a> shows the methods that make changes&#13;
to filesystem entities.</p>&#13;
<table id="javacook-dirfile-Files-Methods-2">&#13;
<caption><span class="label">Table 10-8. </span>Public static operational methods in java.nio.file.Files</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Return type</th>&#13;
<th>Method</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>long</p></td>&#13;
<td><p>copy(InputStream, Path, CopyOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>long</p></td>&#13;
<td><p>copy(Path, OutputStream);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>copy(Path, Path, CopyOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createDirectories(Path, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createDirectory(Path, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createFile(Path, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createLink(Path, Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createSymbolicLink(Path, Path, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createTempDirectory(Path, String, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createTempDirectory(String, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createTempFile(Path, String, String, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>createTempFile(String, String, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>void</p></td>&#13;
<td><p>delete(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>boolean</p></td>&#13;
<td><p>deleteIfExists(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Stream&lt;Path&gt;</p></td>&#13;
<td><p>find(Path, int, BiPredicate&lt;Path, BasicFileAttributes&gt;, FileVisitOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Stream&lt;String&gt;</p></td>&#13;
<td><p>lines(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Stream&lt;String&gt;</p></td>&#13;
<td><p>lines(Path, Charset);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Stream&lt;Path&gt;</p></td>&#13;
<td><p>list(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>move(Path, Path, CopyOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>BufferedReader</p></td>&#13;
<td><p>newBufferedReader(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>BufferedReader</p></td>&#13;
<td><p>newBufferedReader(Path, Charset);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>BufferedWriter</p></td>&#13;
<td><p>newBufferedWriter(Path, Charset, OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>BufferedWriter</p></td>&#13;
<td><p>newBufferedWriter(Path, OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>SeekableByteChannel</p></td>&#13;
<td><p>newByteChannel(Path, OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>SeekableByteChannel</p></td>&#13;
<td><p>newByteChannel(Path, Set&lt;? extends OpenOption&gt;, FileAttribute&lt;?&gt;…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>DirectoryStream&lt;Path&gt;</p></td>&#13;
<td><p>newDirectoryStream(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>DirectoryStream&lt;Path&gt;</p></td>&#13;
<td><p>newDirectoryStream(Path, String);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>InputStream</p></td>&#13;
<td><p>newInputStream(Path, OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>OutputStream</p></td>&#13;
<td><p>newOutputStream(Path, OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>byte[]</p></td>&#13;
<td><p>readAllBytes(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>List&lt;String&gt;</p></td>&#13;
<td><p>readAllLines(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>List&lt;String&gt;</p></td>&#13;
<td><p>readAllLines(Path, Charset);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>&lt;A extends BasicFileAttributes&gt; A</p></td>&#13;
<td><p>readAttributes(Path, Class&lt;A&gt;, LinkOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Map&lt;String, Object&gt;</p></td>&#13;
<td><p>readAttributes(Path, String, LinkOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>String</p></td>&#13;
<td><p>readString(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>String</p></td>&#13;
<td><p>readString(Path, Charset);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>setAttribute(Path, String, Object, LinkOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>setLastModifiedTime(Path, FileTime);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>setOwner(Path, UserPrincipal);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>setPosixFilePermissions(Path, Set&lt;PosixFilePermission&gt;);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>write(Path, Iterable&lt;? extends CharSequence&gt;, Charset, OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>write(Path, Iterable&lt;? extends CharSequence&gt;, OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>write(Path, byte[], OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>writeString(Path, CharSequence, Charset, OpenOption…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Path</p></td>&#13;
<td><p>writeString(Path, CharSequence, OpenOption…);</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p><code>Path</code> is an interface whose implementation is provided by a provider class&#13;
called <code>Filesystem</code>. <code>Path</code> has many methods, listed in <a data-type="xref" href="#javacook-dirfile-Path-Methods">Table 10-9</a>.</p>&#13;
<table id="javacook-dirfile-Path-Methods">&#13;
<caption><span class="label">Table 10-9. </span>Public static operational methods in java.nio.file.Path</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Access</th>&#13;
<th>Return type</th>&#13;
<th>Method</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>static</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>of(String, String…);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>static</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>of(URI);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>FileSystem</p></td>&#13;
<td><p>getFileSystem();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>boolean</p></td>&#13;
<td><p>isAbsolute();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>getRoot();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>getFileName();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>getParent();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>int</p></td>&#13;
<td><p>getNameCount();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>getName(int);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>subpath(int, int);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>boolean</p></td>&#13;
<td><p>startsWith(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>boolean</p></td>&#13;
<td><p>startsWith(String);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>boolean</p></td>&#13;
<td><p>endsWith(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>boolean</p></td>&#13;
<td><p>endsWith(String);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>normalize();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>resolve(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>resolve(String);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>resolveSibling(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>resolveSibling(String);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>relativize(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>URI</p></td>&#13;
<td><p>toUri();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>toAbsolutePath();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>Path</p></td>&#13;
<td><p>toRealPath(LinkOption…) throws IOException;</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>File</p></td>&#13;
<td><p>toFile();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>WatchKey</p></td>&#13;
<td><p>register(WatchService, WatchEvent$Kind&lt;?&gt;[], WatchEvent$Modifier…) throws IOException;</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>WatchKey</p></td>&#13;
<td><p>register(WatchService, WatchEvent$Kind&lt;?&gt;…) throws IOException;</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>Iterator&lt;Path&gt;</p></td>&#13;
<td><p>iterator();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>int</p></td>&#13;
<td><p>compareTo(Path);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>boolean</p></td>&#13;
<td><p>equals(Object);</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>int</p></td>&#13;
<td><p>hashCode();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>abstract</p></td>&#13;
<td><p>String</p></td>&#13;
<td><p>toString();</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>default</p></td>&#13;
<td><p>int</p></td>&#13;
<td><p>compareTo(Object);</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>To find the information about one file, you can use the informational methods in <code>Files</code> and <code>Path</code>,&#13;
as shown in <a data-type="xref" href="#javacook-dirfile-filestat">Example 10-9</a>.</p>&#13;
<div data-type="example" id="javacook-dirfile-filestat">&#13;
<h5><span class="label">Example 10-9. </span>main/src/main/java/dir_file/FileStatus.java (getting file information)</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">FileStatus</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// Ensure that a filename (or something) was given in argv[0]</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">argv</code><code class="o">.</code><code class="na">length</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Usage: FileStatus filename"</code><code class="o">);</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">exit</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="n">String</code> <code class="n">a</code> <code class="o">:</code> <code class="n">argv</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">status</code><code class="o">(</code><code class="n">a</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">status</code><code class="o">(</code><code class="n">String</code> <code class="n">fileName</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"---"</code> <code class="o">+</code> <code class="n">fileName</code> <code class="o">+</code> <code class="s">"---"</code><code class="o">);</code>&#13;
&#13;
        <code class="c1">// Construct a Path object for the given file.</code>&#13;
        <code class="n">Path</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">fileName</code><code class="o">);</code>&#13;
&#13;
        <code class="c1">// See if it actually exists</code>&#13;
        <code class="k">if</code> <code class="o">(!</code><code class="n">Files</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="n">p</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"file not found"</code><code class="o">);</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">();</code>    <code class="c1">// Blank line</code>&#13;
            <code class="k">return</code><code class="o">;</code>&#13;
        <code class="o">}</code>&#13;
        <code class="c1">// Print full name</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Canonical name "</code> <code class="o">+</code> <code class="n">p</code><code class="o">.</code><code class="na">normalize</code><code class="o">());</code>&#13;
        <code class="c1">// Print parent directory if possible</code>&#13;
        <code class="n">Path</code> <code class="n">parent</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">getParent</code><code class="o">();</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">parent</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Parent directory: "</code> <code class="o">+</code> <code class="n">parent</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="c1">// Check if the file is readable</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">isReadable</code><code class="o">(</code><code class="n">p</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">fileName</code> <code class="o">+</code> <code class="s">" is readable."</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="c1">// Check if the file is writable</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">isWritable</code><code class="o">(</code><code class="n">p</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">fileName</code> <code class="o">+</code> <code class="s">" is writable."</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="c1">// See if file, directory, or other. If file, print size.</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">isRegularFile</code><code class="o">(</code><code class="n">p</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="c1">// Report on the file's size and possibly its type</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"File size is %d bytes, content type %s\n"</code><code class="o">,</code>&#13;
                    <code class="n">Files</code><code class="o">.</code><code class="na">size</code><code class="o">(</code><code class="n">p</code><code class="o">),</code>&#13;
                    <code class="n">Files</code><code class="o">.</code><code class="na">probeContentType</code><code class="o">(</code><code class="n">p</code><code class="o">));</code>&#13;
        <code class="o">}</code> <code class="k">else</code> <code class="k">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">(</code><code class="n">p</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"It's a directory"</code><code class="o">);</code>&#13;
        <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"I dunno! Neither a file nor a directory!"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="c1">// Report on the modification time.</code>&#13;
        <code class="kd">final</code> <code class="n">FileTime</code> <code class="n">d</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">getLastModifiedTime</code><code class="o">(</code><code class="n">p</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Last modified "</code> <code class="o">+</code> <code class="n">d</code><code class="o">);</code>&#13;
&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">();</code>    <code class="c1">// blank line between entries</code>&#13;
    <code class="o">}</code></pre></div>&#13;
&#13;
<p>When run on MS Windows with the three arguments shown, it produces this output:</p>&#13;
<pre data-type="programlisting" id="I_11_tt371">C:\javasrc\dir_file&gt;<strong>java dir_file.FileStatus   / /tmp/id /autoexec.bat</strong>&#13;
---/---&#13;
Canonical name C:\&#13;
File is readable.&#13;
File is writable.&#13;
Last modified 1970-01-01T00:00:00.00000Z&#13;
It's a directory&#13;
&#13;
---/tmp/id---&#13;
file not found&#13;
&#13;
---/autoexec.bat---&#13;
Canonical name C:\AUTOEXEC.BAT&#13;
Parent directory: \&#13;
File is readable.&#13;
File is writable.&#13;
Last modified 2019-10-13T12:43:05.123918Z&#13;
File size is 308 bytes.</pre>&#13;
&#13;
<p>As you can see, the so-called <a data-primary="canonical name" data-type="indexterm" id="idm45290652061000"/><em>canonical name</em> not only includes a leading directory root of <em>C:\</em>, but also has had the name converted to uppercase. You can tell I ran that on Windows.&#13;
That version of Windows did not maintain timestamps on directories; the value <code>0L</code> gets interpreted&#13;
as January 1, 1970 (not accidentally the same time base as used on Unix since that time).&#13;
On Unix, it behaves differently:</p>&#13;
<pre data-type="programlisting" id="I_11_tt372">$ <strong>java dir_file.FileStatus / /tmp/id /autoexec.bat</strong>&#13;
---/---&#13;
Canonical name /&#13;
File is readable.&#13;
It's a directory&#13;
Last modified 2019-12-16T01:14:05.226108Z&#13;
&#13;
---/tmp/id---&#13;
Canonical name /tmp/id&#13;
Parent directory: /tmp&#13;
File is readable.&#13;
File is writable.&#13;
File size is 36768 bytes, content type null&#13;
Last modified 2019-12-21T18:46:27.402108Z&#13;
&#13;
---/autoexec.bat---&#13;
file not found&#13;
&#13;
$</pre>&#13;
&#13;
<p>A typical Unix system has no <em>autoexec.bat</em> file. And Unix filenames (like those on a Mac) can consist of upper- and lowercase characters: what you type is what you get.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Legacy compatibility" data-type="sect3"><div class="sect3" id="idm45290651792120">&#13;
<h3>Legacy compatibility</h3>&#13;
&#13;
<p>To use a <code>Path</code> with legacy code that needs the older <code>java.io.File</code>, simply use&#13;
<code>File oldType = Path.toFile()</code>:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">Path</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/"</code><code class="o">);</code>&#13;
<code class="n">p</code> <code class="o">==&gt;</code> <code class="o">/</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">File</code> <code class="n">f</code> <code class="o">=</code> <code class="n">p</code><code class="o">.</code><code class="na">toFile</code><code class="o">();</code>&#13;
<code class="n">f</code> <code class="o">==&gt;</code> <code class="o">/</code></pre>&#13;
&#13;
<p>To go the other way, the <code>File</code> class has been retrofitted with a <code>toPath()</code> method:<a data-primary="" data-startref="fi_pa" data-type="indexterm" id="idm45290651767960"/><a data-primary="" data-startref="io_fp" data-type="indexterm" id="idm45290651767192"/><a data-primary="" data-startref="pa_fi" data-type="indexterm" id="idm45290651766248"/></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">File</code> <code class="n">f</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="s">"/"</code><code class="o">);</code>&#13;
<code class="n">f</code> <code class="o">==&gt;</code> <code class="o">/</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">Path</code> <code class="n">p</code> <code class="o">=</code> <code class="n">f</code><code class="o">.</code><code class="na">toPath</code><code class="o">();</code>&#13;
<code class="n">p</code> <code class="o">==&gt;</code> <code class="o">/</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.18 Creating a New File or Directory" data-type="sect1"><div class="sect1" id="javacook-dirfile-SECT-2">&#13;
<h1>10.18 Creating a New File or Directory</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-2.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="directories" data-secondary="creating" data-type="indexterm" id="idm45290651707208"/><a data-primary="files" data-secondary="creating" data-type="indexterm" id="idm45290651706232"/><a data-primary="input/output" data-secondary="directories, creating" data-type="indexterm" id="idm45290651705288"/><a data-primary="input/output" data-secondary="files, creating" data-type="indexterm" id="idm45290651704344"/>You need to create a new file on disk but not write&#13;
any data into it; you need to create a directory before you can create files in it.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-2.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>For an empty file, use a <code>java.nio.file.Files</code> object’s <code>createFile(Path)</code> method.&#13;
Use the <code>Files</code> class’s <a data-primary="createDirectory() method" data-type="indexterm" id="idm45290651699800"/><a data-primary="createDirectories() method" data-type="indexterm" id="idm45290651699096"/><a data-primary="createFile() method" data-type="indexterm" id="idm45290651698456"/><code>createDirectory()</code> or <code>createDirectories()</code> method to create a directory.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-2.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Files" data-type="sect3"><div class="sect3" id="idm45290651695528">&#13;
<h3>Files</h3>&#13;
&#13;
<p>You could easily create a new file by constructing a <code>FileOutputStream</code> or <code>FileWriter</code>&#13;
(see <a data-type="xref" href="ch12.html#javacook-netclient-SECT-5">Recipe 12.6</a>).&#13;
But then you’d have to remember to close it as well. Sometimes you want a file to exist, but you don’t want to bother putting anything into it. This might be used, for example, as a simple form of interprogram communication: one program could test for the presence of a file and interpret that to mean that the other program has reached a certain state.&#13;
<a data-type="xref" href="#javacook-dirfile-creation">Example 10-10</a> is code that simply creates an empty file for each name you give.</p>&#13;
<div data-type="example" id="javacook-dirfile-creation">&#13;
<h5><span class="label">Example 10-10. </span>main/src/main/java/dir_file/Creat.java (creation of a file on disk)</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/** Create file(s) by name. Final "e" omitted in homage to UNIX system call. */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Creat</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// Ensure that a filename (or something) was given in argv[0]</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">argv</code><code class="o">.</code><code class="na">length</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">"Usage: Creat filename [...]"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="k">for</code> <code class="o">(</code><code class="n">String</code> <code class="n">arg</code> <code class="o">:</code> <code class="n">argv</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="c1">// Constructing a Path object doesn't affect the disk, but</code>&#13;
            <code class="c1">// the Files.createFile() method does.</code>&#13;
            <code class="kd">final</code> <code class="n">Path</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">arg</code><code class="o">);</code>&#13;
            <code class="kd">final</code> <code class="n">Path</code> <code class="n">created</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">createFile</code><code class="o">(</code><code class="n">p</code><code class="o">);</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">created</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p><code>java.nio.file.createFile()</code> has an overload that takes a second argument of type <code>OpenOption</code>.&#13;
This is an empty interface that is implemented by the <code>StandardOpenOption</code> enumeration.&#13;
These options are listed in <a data-type="xref" href="#javacook-dir_file-OPEN-OPTIONS">Table 10-5</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Directories" data-type="sect3"><div class="sect3" id="idm45290651362776">&#13;
<h3>Directories</h3>&#13;
&#13;
<p>Of the two methods used for creating directories, <code>createDirectory()</code> creates just one directory,&#13;
whereas <code>createDirectories()</code> creates any intermediate directories that are needed.&#13;
For example, if <em>/home/ian</em> exists and is a directory, the call</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">shell</code><code class="o">&gt;</code> <code class="n">Files</code><code class="o">.</code><code class="na">createDirectory</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/Users/ian/abc"</code><code class="o">))</code>&#13;
<code class="n">$11</code> <code class="o">==&gt;</code> <code class="o">/</code><code class="n">Users</code><code class="o">/</code><code class="n">ian</code><code class="o">/</code><code class="n">abc</code></pre>&#13;
&#13;
<p>will succeed (unless the directory is already there), but the call</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">Files</code><code class="o">.</code><code class="na">createDirectory</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"/Users/ian/once/twice/again"</code><code class="o">))</code></pre>&#13;
&#13;
<p>will fail with a <code>java.nio.file.NoSuchFileException</code> because the directory named <em>once</em> does not exist. To create this path of directories, as you might expect by now,&#13;
use <code>createDirectories()</code> (plural):</p>&#13;
&#13;
<pre data-type="programlisting">jshell&gt; Files.createDirectories(Path.of("/Users/ian/once/twice/again"))&#13;
$14 ==&gt; /Users/ian/once/twice/again</pre>&#13;
&#13;
<p>Both variants return a <code>Path</code> object referring to the new directory if they succeed&#13;
and throw an exception if they fail.&#13;
Notice that it is possible (but not likely) for <code>createDirectories()</code> to create some of the directories and then fail; in this case, the newly created directories are left in the filesystem.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.19 Changing a File’s Name or Other Attributes" data-type="sect1"><div class="sect1" id="javacook-dirfile-SECT-3">&#13;
<h1>10.19 Changing a File’s Name or Other Attributes</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-3.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="files" data-secondary="renaming" data-type="indexterm" id="fi_ren"/><a data-primary="input/output" data-secondary="files, renaming" data-type="indexterm" id="io_firen"/>You need to change a file’s name on disk or some of its other attributes, such as&#13;
setting the file to read-only or changing its modification time.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-3.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>To change the name (or location), use a <code>java.nio.file.Files</code> static <code>move()</code> method.&#13;
For other attributes, use <a data-primary="setLastModifiedTime() method" data-type="indexterm" id="idm45290651340344"/><code>setLastModifiedTime()</code> to change the timestamp,&#13;
or one of several other setters for mode or permission attributes.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-3.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Similar to the Unix command line, there is no separate rename operation; the move methods&#13;
provide all functions for putting a file somewhere else, whether that is to the same name in&#13;
a different directory, a different name in the same directory, or a different name on a different&#13;
disk or filesystem.&#13;
Accordingly, the <a data-primary="Files.move() method" data-type="indexterm" id="idm45290651336568"/><code>Files.move()</code> method requires two <code>Path</code> objects, one referring to the existing&#13;
file and another referring to the new name. Then call the <code>Files.move()</code> method,  passing&#13;
both path objects, first the existing and then the desired name.&#13;
This is easier to see than to explain, so here goes:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Rename</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// Construct the Path object. Does NOT create a file on disk!</code>&#13;
        <code class="kd">final</code> <code class="n">Path</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"MyCoolDocument"</code><code class="o">);</code> <code class="c1">// The file we will rename</code>&#13;
&#13;
        <code class="c1">// Setup for the demo: create a new "old" file</code>&#13;
        <code class="kd">final</code> <code class="n">Path</code> <code class="n">oldName</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="n">p</code><code class="o">)</code> <code class="o">?</code> <code class="n">p</code> <code class="o">:</code> <code class="n">Files</code><code class="o">.</code><code class="na">createFile</code><code class="o">(</code><code class="n">p</code><code class="o">);</code>&#13;
&#13;
        <code class="c1">// Rename the backup file to "mydoc.bak"</code>&#13;
        <code class="c1">// Renaming requires a Path object for the target.</code>&#13;
        <code class="kd">final</code> <code class="n">Path</code> <code class="n">newName</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"mydoc.bak"</code><code class="o">);</code>&#13;
        <code class="n">Files</code><code class="o">.</code><code class="na">deleteIfExists</code><code class="o">(</code><code class="n">newName</code><code class="o">);</code> <code class="c1">// In case previous run left it there</code>&#13;
        <code class="n">Path</code> <code class="n">p2</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">move</code><code class="o">(</code><code class="n">oldName</code><code class="o">,</code> <code class="n">newName</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">p</code> <code class="o">+</code> <code class="s">" renamed to "</code> <code class="o">+</code> <code class="n">p2</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>For changing the attributes, there are several methods available, listed in&#13;
<a data-type="xref" href="#javacook-dir_file-filesetops">Table 10-10</a>.&#13;
Each of these has a return value of type <code>boolean</code>, with <code>true</code> meaning success.</p>&#13;
<table id="javacook-dir_file-filesetops">&#13;
<caption><span class="label">Table 10-10. </span>Files attribute setters</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Method signature</th>&#13;
<th>Description</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>setExecutable(boolean executable)</code></p></td>&#13;
<td><p>Convenience method to set owner’s execute permission for this file</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>setExecutable(boolean executable, boolean ownerOnly)</code></p></td>&#13;
<td><p>Sets the owner’s or everybody’s execute permission for this file</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>setLastModified(long time)</code></p></td>&#13;
<td><p>Sets the last-modified time of the file or directory that this file names</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>setReadable(boolean readable)</code></p></td>&#13;
<td><p>Convenience method to set owner’s read permission for this file</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>setReadable(boolean readable, boolean ownerOnly)</code></p></td>&#13;
<td><p>Sets the owner’s or everybody’s read permission for this file</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>setReadOnly()</code></p></td>&#13;
<td><p>Convenience for <code>setReadable(false)</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>setWritable(boolean writable)</code></p></td>&#13;
<td><p>A convenience method to set the owner’s write permission for this file</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>setWritable(boolean writable, boolean ownerOnly)</code></p></td>&#13;
<td><p>Set owner’s or everybody’s write permission for this file</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>For the methods that take two arguments, the first enables or disables the feature on the given file&#13;
that matches the method name, and the second controls whether the operation applies to the owner&#13;
only or to everyone. The second argument is ignored if the file lives on a filesystem that&#13;
doesn’t support multiuser permissions or if the operating system doesn’t support that.&#13;
All the methods described in this recipe return <code>true</code> if they succeed and <code>false</code> otherwise.</p>&#13;
&#13;
<p>For example, <code>boolean setReadable(boolean readable, boolean ownerOnly)</code> lets you specify who can read&#13;
the given file. The <code>readable</code> argument is true or false depending on whether you want it readable&#13;
or not. The <code>ownerOnly</code> argument tries to extend the readability choice to all users on a multiuser&#13;
operating system, and is ignored if not applicable.</p>&#13;
&#13;
<p><code>setLastModified()</code> allows you to play games with the modification&#13;
time of a file. This is normally not a good game to play, but it&#13;
is useful in some types of backup/restore programs. This method&#13;
takes an argument that is the number of milliseconds (not seconds)&#13;
since the beginning of Unix time (January 1, 1970). You can get the&#13;
original value for the file by calling <a data-primary="getLastModified() method" data-type="indexterm" id="idm45290651196104"/><code>getLastModified()</code>  (see&#13;
<a data-type="xref" href="#javacook-dirfile-SECT-1">Recipe 10.17</a>), or you can get the value for a given&#13;
date by calling the <code>ZonedDateTime</code>’s <code>toInstant().getEpochSecond()</code> method (see&#13;
<a data-type="xref" href="ch06.html#javacook-dates-convert">Recipe 6.3</a>) and multiplying by 1,000 to convert seconds to milliseconds.</p>&#13;
&#13;
<p>I encourage you to explore the operation of these methods using<a data-primary="JShell" data-secondary="file/directory methods in" data-type="indexterm" id="idm45290651191864"/> JShell (see <a data-type="xref" href="ch01.html#javacook-getstarted-JSHELL">Recipe 1.4</a>).&#13;
I’d suggest having a second window in which you can run <code>ls -l</code> or <code>dir</code> commands&#13;
to see how the file is affected. <a data-type="xref" href="#javacook-filesdir-setfileattrs-1">Example 10-11</a> shows some of these methods being explored in JShell.<a data-primary="" data-startref="fi_ren" data-type="indexterm" id="idm45290651187976"/><a data-primary="" data-startref="io_firen" data-type="indexterm" id="idm45290651187032"/></p>&#13;
<div data-type="example" id="javacook-filesdir-setfileattrs-1">&#13;
<h5><span class="label">Example 10-11. </span>Exploring Files</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">var</code> <code class="n">f</code> <code class="o">=</code> <code class="n">File</code><code class="o">.</code><code class="na">createTempFile</code><code class="o">(</code><code class="s">"foo"</code><code class="o">,</code> <code class="s">"bar"</code><code class="o">);</code>&#13;
<code class="n">f</code> <code class="o">==&gt;</code> <code class="o">/</code><code class="n">tmp</code><code class="o">/</code><code class="n">foo9391300789087780984bar</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">.</code><code class="na">createNewFile</code><code class="o">();</code>&#13;
<code class="n">$4</code> <code class="o">==&gt;</code> <code class="kc">false</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">.</code><code class="na">setReadOnly</code><code class="o">();</code>&#13;
<code class="n">$5</code> <code class="o">==&gt;</code> <code class="kc">true</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">.</code><code class="na">canRead</code><code class="o">();</code>&#13;
<code class="n">$6</code> <code class="o">==&gt;</code> <code class="kc">true</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">.</code><code class="na">canWrite</code><code class="o">();</code>&#13;
<code class="n">$7</code> <code class="o">==&gt;</code> <code class="kc">false</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">.</code><code class="na">setReadable</code><code class="o">(</code><code class="kc">true</code><code class="o">);</code>&#13;
<code class="n">$8</code> <code class="o">==&gt;</code> <code class="kc">true</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">.</code><code class="na">canWrite</code><code class="o">();</code>&#13;
<code class="n">$9</code> <code class="o">==&gt;</code> <code class="kc">false</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">.</code><code class="na">setReadable</code><code class="o">(</code><code class="kc">false</code><code class="o">,</code> <code class="kc">false</code><code class="o">);</code>&#13;
<code class="n">$10</code> <code class="o">==&gt;</code> <code class="kc">true</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="n">f</code><code class="o">.</code><code class="na">canWrite</code><code class="o">();</code>&#13;
<code class="n">$11</code> <code class="o">==&gt;</code> <code class="kc">false</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.20 Deleting a File" data-type="sect1"><div class="sect1" id="javacook-dirfile-SECT-4">&#13;
<h1>10.20 Deleting a File</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-4.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="files" data-secondary="deleting" data-type="indexterm" id="fi_del"/><a data-primary="input/output" data-secondary="files, deleting" data-type="indexterm" id="io_delfi"/>You need to delete one or more files from the disk.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-4.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>java.nio.file.Files</code> object’s <code>delete(Path)</code> or <code>deleteIfExists(Path)</code> method. These delete the files referred to by the <code>Path</code> argument (subject of course to permissions) and directories (subject to permissions and to the directory being empty).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-4.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>This is not complicated. Simply construct a <code>Path</code> object for the file you wish to delete, and call the static <a data-primary="Files.delete() method" data-type="indexterm" id="idm45290651029944"/><code>Files.delete()</code> method:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Delete</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// Construct a File object for the backup created by editing</code>&#13;
        <code class="c1">// this source file. The file probably already exists.</code>&#13;
        <code class="c1">// Some text editors create backups by putting ~ at end of filename.</code>&#13;
        <code class="n">File</code> <code class="n">bkup</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="s">"Delete.java~"</code><code class="o">);</code>&#13;
        <code class="c1">// Now, delete it:</code>&#13;
        <code class="n">bkup</code><code class="o">.</code><code class="na">delete</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Recall the caveat about permissions in the introduction to this chapter: if you don’t&#13;
have permission, you can get a return value of false or, possibly, a <code>SecurityException</code>.&#13;
Note also that there are some differences between platforms. Some versions of Windows&#13;
allow Java to remove a read-only file, but Unix does not allow you to remove a file unless&#13;
you have write permission on the directory it’s in. Nor does Unix allow you to remove a directory that isn’t&#13;
empty (there is even an exception, <code>DirectoryNotEmptyException</code>, for the latter case).&#13;
Here is a version of <code>Delete</code> with reporting of success or failure:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Delete2</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">static</code> <code class="kt">boolean</code> <code class="n">hard</code> <code class="o">=</code> <code class="kc">false</code><code class="o">;</code> <code class="c1">// True for delete, false for deleteIfExists</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="n">String</code> <code class="n">arg</code> <code class="o">:</code> <code class="n">argv</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="s">"-h"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">arg</code><code class="o">))</code> <code class="o">{</code>&#13;
                <code class="n">hard</code> <code class="o">=</code> <code class="kc">true</code><code class="o">;</code>&#13;
                <code class="k">continue</code><code class="o">;</code>&#13;
            <code class="o">}</code>&#13;
            <code class="n">delete</code><code class="o">(</code><code class="n">arg</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">delete</code><code class="o">(</code><code class="n">String</code> <code class="n">fileName</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="c1">// Construct a File object for the file to be deleted.</code>&#13;
        <code class="kd">final</code> <code class="n">Path</code> <code class="n">target</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">fileName</code><code class="o">);</code>&#13;
&#13;
        <code class="c1">// Now, delete it:</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">hard</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">try</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="s">"Using Files.delete(): "</code><code class="o">);</code>&#13;
                <code class="n">Files</code><code class="o">.</code><code class="na">delete</code><code class="o">(</code><code class="n">target</code><code class="o">);</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"** Deleted "</code> <code class="o">+</code> <code class="n">fileName</code> <code class="o">+</code> <code class="s">" **"</code><code class="o">);</code>&#13;
            <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Deleting "</code> <code class="o">+</code> <code class="n">fileName</code> <code class="o">+</code> <code class="s">" threw "</code> <code class="o">+</code> <code class="n">e</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
            <code class="k">try</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="s">"Using deleteIfExists(): "</code><code class="o">);</code>&#13;
                <code class="k">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">deleteIfExists</code><code class="o">(</code><code class="n">target</code><code class="o">))</code> <code class="o">{</code>&#13;
                    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"** Deleted "</code> <code class="o">+</code> <code class="n">fileName</code> <code class="o">+</code> <code class="s">" **"</code><code class="o">);</code>&#13;
                <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
                    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code>&#13;
                        <code class="s">"Deleting "</code> <code class="o">+</code> <code class="n">fileName</code> <code class="o">+</code> <code class="s">" returned false."</code><code class="o">);</code>&#13;
                <code class="o">}</code>&#13;
            <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Deleting "</code> <code class="o">+</code> <code class="n">fileName</code> <code class="o">+</code> <code class="s">" threw "</code> <code class="o">+</code> <code class="n">e</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>The <code>-h</code> option allows this program to switch between <a data-primary="delete() method" data-type="indexterm" id="idm45290651003704"/><a data-primary="deleteIfExists() method" data-type="indexterm" id="idm45290651003096"/><code>delete()</code> and <code>deleteIfExists()</code>;&#13;
you can see the difference by running it on things that exist, don’t exist, and are not&#13;
empty, using both methods. The output looks something like this on my Unix box:<a data-primary="" data-startref="fi_del" data-type="indexterm" id="idm45290650659496"/><a data-primary="" data-startref="io_delfi" data-type="indexterm" id="idm45290650658632"/></p>&#13;
<pre data-type="programlisting" id="I_11_tt377">$ <strong>ls -ld ?</strong>&#13;
-rw-r--r--  1 ian  512   0 Dec 21 16:35 a&#13;
drwxr-xr-x  2 ian  512  64 Dec 21 16:35 b&#13;
drwxr-xr-x  3 ian  512  96 Dec 21 16:22 c&#13;
$ <strong>java -cp target/classes dir_file.Delete2 a b c d </strong>&#13;
Using deleteIfExists(): ** Deleted a **&#13;
Using deleteIfExists(): ** Deleted b **&#13;
Using deleteIfExists(): Deleting c threw&#13;
  java.nio.file.DirectoryNotEmptyException: c&#13;
Using deleteIfExists(): Deleting d returned false.&#13;
# Here I put the files back the way they were, then run again with -h&#13;
$ <strong>java -cp target/classes dir_file.Delete2 -h a b c d</strong>&#13;
Using Files.delete(): ** Deleted a **&#13;
Using Files.delete(): ** Deleted b **&#13;
Using Files.delete(): Deleting c threw&#13;
  java.nio.file.DirectoryNotEmptyException: c&#13;
Using Files.delete(): Deleting d threw java.nio.file.NoSuchFileException: d&#13;
$ <strong>ls -l c</strong>&#13;
total 2&#13;
drwxr-xr-x  2 ian  ian  512 Oct  8 16:50 d&#13;
$ <strong>java dir_file.Delete2 c/d c</strong>&#13;
Using deleteIfExists(): ** Deleted c/d **&#13;
Using deleteIfExists(): ** Deleted c **&#13;
$ </pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.21 Creating a Transient/Temporary File" data-type="sect1"><div class="sect1" id="javacook-dirfile-SECT-5">&#13;
<h1>10.21 Creating a Transient/Temporary File</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-5.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="files" data-secondary="transient/temporary" data-type="indexterm" id="fi_tt"/><a data-primary="input/output" data-secondary="transient/temporary files" data-type="indexterm" id="io_tt"/>You need to create a file with a unique temporary filename and/or or arrange for a file to be deleted when your program is finished.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-5.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use<a data-primary="createTempFile() method" data-type="indexterm" id="idm45290650646264"/><a data-primary="createTempDirectory() method" data-type="indexterm" id="idm45290650645528"/> the <code>java.nio.file.Files</code> <code>createTempFile()</code> or <code>createTempDirectory()</code> method.&#13;
Use one of several methods to ensure your file is deleted on exit.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-5.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>Files</code> class has static methods for creating temporary files and directories.&#13;
Note that a temporary file in this context is not deleted automatically;&#13;
it is simply created in a directory that is set aside for temporary files on that&#13;
operating system (e.g., /tmp on Unix). Here are the methods for creating tempory files and directories:</p>&#13;
<dl>&#13;
<dt>Path	createTempFile(Path dir, String prefix, String suffix, FileAttribute&lt;?&gt;… attrs)</dt>&#13;
<dd>&#13;
<p>Creates a new empty file in the specified directory, using the given prefix and suffix strings to generate its name</p>&#13;
</dd>&#13;
<dt>Path	createTempFile(String prefix, String suffix, FileAttribute&lt;?&gt;… attrs)</dt>&#13;
<dd>&#13;
<p>Creates an empty file in the default temporary-file directory, using the given prefix and suffix to generate its name</p>&#13;
</dd>&#13;
<dt>Path	createTempDirectory(Path dir, String prefix, FileAttribute&lt;?&gt;… attrs)</dt>&#13;
<dd>&#13;
<p>Creates a new directory in the specified directory, using the given prefix to generate its name</p>&#13;
</dd>&#13;
<dt>Path	createTempDirectory(String prefix, FileAttribute&lt;?&gt;… attrs)</dt>&#13;
<dd>&#13;
<p>Creates a new directory in the default temporary-file directory, using the given prefix to generate its name</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The file attributes are discussed in the sidebar <a data-type="xref" href="#javacook-ioOptions">“Understanding I/O Options: StandardOpenOptions, FileAttribute, PosixFileAttribute, and More”</a>.</p>&#13;
&#13;
<p>There are various ways to arrange for a file to be deleted automatically.&#13;
One is to use the legacy <code>java.io.File</code> class, which has a explicit <a data-primary="deleteOnExit() method" data-type="indexterm" id="idm45290650631992"/><code>deleteOnExit()</code> method.&#13;
This arranges for any file (no matter how it was created) to be deleted if&#13;
it still exists when the program exits. Here we arrange for a backup copy of&#13;
a program to be deleted on exit, and we also create a temporary file and&#13;
arrange for it to be removed on exit. Both files are gone after the program runs:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">TempFiles</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// 1. Making an existing file temporary</code>&#13;
        <code class="c1">// Construct a File object for the backup created by editing</code>&#13;
        <code class="c1">// this source file. The file probably already exists.</code>&#13;
        <code class="c1">// My editor creates backups by putting ~ at the end of the name.</code>&#13;
        <code class="n">File</code> <code class="n">bkup</code> <code class="o">=</code> <code class="k">new</code> <code class="n">File</code><code class="o">(</code><code class="s">"Rename.java~"</code><code class="o">);</code>&#13;
        <code class="c1">// Arrange to have it deleted when the program ends.</code>&#13;
        <code class="n">bkup</code><code class="o">.</code><code class="na">deleteOnExit</code><code class="o">();</code>&#13;
&#13;
        <code class="c1">// 2. Create a new temporary file.</code>&#13;
&#13;
        <code class="c1">// Make a file object for foo.tmp, in the default temp directory</code>&#13;
        <code class="n">Path</code> <code class="n">tmp</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">createTempFile</code><code class="o">(</code><code class="s">"foo"</code><code class="o">,</code> <code class="s">"tmp"</code><code class="o">);</code>&#13;
        <code class="c1">// Report on the filename that it made up for us.</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Your temp file is "</code> <code class="o">+</code> <code class="n">tmp</code><code class="o">.</code><code class="na">normalize</code><code class="o">());</code>&#13;
        <code class="c1">// Arrange for it to be deleted at exit.</code>&#13;
        <code class="n">tmp</code><code class="o">.</code><code class="na">toFile</code><code class="o">().</code><code class="na">deleteOnExit</code><code class="o">();</code>&#13;
        <code class="c1">// Now do something with the temporary file, without having to</code>&#13;
        <code class="c1">// worry about deleting it later.</code>&#13;
        <code class="n">writeDataInTemp</code><code class="o">(</code><code class="n">tmp</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">writeDataInTemp</code><code class="o">(</code><code class="n">Path</code> <code class="n">tempFile</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="c1">// This version is dummy. Use your imagination.</code>&#13;
        <code class="n">Files</code><code class="o">.</code><code class="na">writeString</code><code class="o">(</code><code class="n">tempFile</code><code class="o">,</code> <code class="s">"This is a temp file"</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>When run on a Unix system, this program looked like this, proving that the file was&#13;
created but removed when the JVM exited:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">java</code> <code class="n">TempFiles</code><code class="o">.</code><code class="na">java</code>&#13;
<code class="n">Your</code> <code class="n">temp</code> <code class="n">file</code> <code class="n">is</code> <code class="o">/</code><code class="n">tmp</code><code class="o">/</code><code class="n">foo8423321910215054689tmp</code>&#13;
<code class="n">$</code> <code class="n">ls</code> <code class="o">-</code><code class="n">l</code> <code class="o">/</code><code class="n">tmp</code><code class="o">/</code><code class="n">foo8423321910215054689tmp</code>&#13;
<code class="nl">ls:</code> <code class="o">/</code><code class="n">tmp</code><code class="o">/</code><code class="nl">foo8423321910215054689tmp:</code> <code class="n">No</code> <code class="n">such</code> <code class="n">file</code> <code class="n">or</code> <code class="n">directory</code>&#13;
<code class="n">$</code></pre>&#13;
&#13;
<p>The <a data-primary="createTempFile() method" data-type="indexterm" id="idm45290650443480"/><a data-primary="createNewFile() method" data-type="indexterm" id="idm45290650573688"/><code>createTempFile()</code> method is like <code>createNewFile()</code> (see&#13;
<a data-type="xref" href="#javacook-dirfile-SECT-2">Recipe 10.18</a>) in that it does create the file. Also be aware that, should&#13;
the Java Virtual Machine terminate abnormally, the deletion probably will not occur.&#13;
There is no way to undo the setting of <a data-primary="deleteOnExit() method" data-type="indexterm" id="idm45290650571176"/><code>deleteOnExit()</code> short of renaming the file or something&#13;
drastic like powering off the computer before the program exits.</p>&#13;
&#13;
<p>Another way to arrange for any file to be deleted when you are finished with it is to&#13;
create it with the <code>DELETE_ON_CLOSE</code> option (see <a data-type="xref" href="#javacook-dir_file-OPEN-OPTIONS">Table 10-5</a>)&#13;
so it will be deleted when you close the file.</p>&#13;
&#13;
<p>A third, less likely method is to instead&#13;
use <a data-primary="JVM shutdown hook" data-type="indexterm" id="idm45290650567608"/>a <a href="https://darwinsys.com/java/shutdownhook.html">JVM shutdown hook</a>.&#13;
<code>DELETE_ON_CLOSE</code> is probably the best option, particularly in&#13;
a long-running application, like most server-side apps. In these situations,&#13;
the server could be running for weeks, months, or even years. In the&#13;
meantime all the temp files would accumulate and the JVM would accumulate&#13;
a large list of deferred work that it needs to perform upon shutdown.&#13;
You’d probably run out of disk space or server memory or some other resource.&#13;
For most long-running apps of this kind, it’s better to use <code>DELETE_ON_CLOSE</code>&#13;
or even the explicit <code>delete()</code> operation.&#13;
Another alternative is to use a scheduler service to periodically trigger removal&#13;
of old temporary files.<a data-primary="" data-startref="fi_tt" data-type="indexterm" id="idm45290650564056"/><a data-primary="" data-startref="io_tt" data-type="indexterm" id="idm45290650563080"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.22 Listing a Directory" data-type="sect1"><div class="sect1" id="javacook-dirfile-SECT-7">&#13;
<h1>10.22 Listing a Directory</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-7.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="directories" data-secondary="listing" data-type="indexterm" id="idm45290650559368"/><a data-primary="input/output" data-secondary="directories, listing" data-type="indexterm" id="idm45290650558392"/>You need to list the filesystem entries named in a directory.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-7.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>java.nio.file.Files</code> static method <code>Stream&lt;Path&gt; list(Path dir)</code>,&#13;
passing the <code>Path</code> representing the directory.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-7.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>java.nio.file.Files</code> class contains several methods for working with directories.&#13;
If you just want to list the contents of a directory, use its <a data-primary="list() method" data-type="indexterm" id="idm45290650551368"/><code>list(Path)</code> method.&#13;
For example, to list the filesystem entities named in the current directory, just write the following:</p>&#13;
&#13;
<pre data-type="programlisting">Files.list(Path.of(".")).forEach(System.out::println);</pre>&#13;
&#13;
<p>This can become a complete program with as little as the following code.&#13;
Note that on many systems the <code>Path</code> objects are returned in the order they&#13;
occur in the directory, which isn’t sorted. In this simple example&#13;
we use the<a data-primary="Stream.sorted() method" data-type="indexterm" id="idm45290650548392"/> <code>Stream.sorted()</code> method to order the entries alphabetically:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Ls</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code> <code class="n">args</code><code class="o">[])</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="n">Files</code><code class="o">.</code><code class="na">list</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"."</code><code class="o">))</code>&#13;
            <code class="o">.</code><code class="na">sorted</code><code class="o">()</code>&#13;
            <code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">dir</code> <code class="o">-&gt;</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">dir</code><code class="o">);</code>&#13;
            <code class="o">});</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Of course, there’s lots of room for elaboration. You could print the names in multiple columns across the page. Or even down the page because you know the number of items in the list before you print. You could omit filenames with leading periods, as does the Unix <em>ls</em> program. Or print the directory names first; I once used a directory lister called <em>lc</em> that did this, and I found it quite useful.</p>&#13;
&#13;
<p>If you want to process the directory recursively, you should <em>not</em> check each entry to see if&#13;
it’s a file or directory and recurse on directories.&#13;
Instead, you should use one of the <a data-primary="walkFileTree() method" data-type="indexterm" id="idm45290650312328"/><code>walk()</code> or <code>walkFileTree()</code> methods discussed in&#13;
<a data-type="xref" href="#javacook-dirfile-SECT-10">Recipe 10.26</a>; these handle recursion for you.&#13;
There is also a set of <code>Files.newDirectoryStream()</code> methods, with and without&#13;
filter callbacks and other arguments, that return a <code>DirectoryStream&lt;Path&gt;</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.23 Getting the Directory Roots" data-type="sect1"><div class="sect1" id="javacook-dirfile-SECT-8">&#13;
<h1>10.23 Getting the Directory Roots</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-8.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="directories" data-secondary="roots of" data-type="indexterm" id="idm45290650306408"/><a data-primary="input/output" data-secondary="directory roots" data-type="indexterm" id="idm45290650305432"/>You want to know about  the top-level directories, such as <em>C:\</em> and <em>D:\</em> on Windows.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-8.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the static method <code>FileSystems.getDefault().getRootDirectories()</code>, which returns an <code>Iterable</code>&#13;
of <code>Path</code> objects, one for each root directory.&#13;
You can print them or do other operations on them.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-dirfile-SECT-8.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Operating systems differ in how they organize filesystems out of multiple disk drives or partitions.&#13;
Microsoft Windows has a low-level device-oriented approach in which&#13;
each disk drive has a root directory named <em>A:\</em> for the first floppy (if you still have one!), <em>C:\</em> for the first hard drive, and other letters for CD-ROM and network drives.&#13;
This approach requires you to know the physical device that a file is on.&#13;
Unix, Linux, and macOS have a high-level approach with a single root directory <em>/;</em>&#13;
and different disks or partitions are mounted, or connected, into a single unified tree.&#13;
This approach sometimes requires you to figure out where a device file is mounted.&#13;
Perhaps neither is easier, though the Unix approach is a bit more consistent.&#13;
Either way, Java makes it easy for you to get a list of the roots.</p>&#13;
&#13;
<p>The static method <code>FileSystems.getDefault().getRootDirectories()</code> returns an <code>Iterable&lt;Path&gt;</code> containing the available filesystem roots for whatever platform you are running on. Here is a short program to list these:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">FileSystems</code><code class="o">.</code><code class="na">getDefault</code><code class="o">().</code><code class="na">getRootDirectories</code><code class="o">().</code><code class="na">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">::</code><code class="n">println</code><code class="o">);</code></pre>&#13;
<pre data-type="programlisting" id="I_11_tt385">&#13;
C:&gt; <strong>java dir_file.DirRoots</strong>&#13;
A:\&#13;
C:\&#13;
D:\&#13;
C:&gt;</pre>&#13;
&#13;
<p>As you can see, the program listed my floppy drive (even though the floppy drive was not only empty,&#13;
but left at home while I wrote this recipe on my notebook computer in my car in a parking lot), the hard disk drive,&#13;
and the CD-ROM drive.</p>&#13;
&#13;
<p>On Unix there is only one root directory:</p>&#13;
<pre data-type="programlisting" id="I_11_tt386">$ <strong>java dir_file.DirRoots</strong>&#13;
/&#13;
$</pre>&#13;
&#13;
<p>One thing that is left out of the list of roots is the so-called<a data-primary="UNC filename" data-type="indexterm" id="idm45290650283432"/> <em>UNC filename</em>. UNC filenames are used on some Microsoft platforms to refer to a network-available resource that hasn’t been mounted locally on a particular drive letter. If your system still uses these, be aware they will not show up in the&#13;
<code>listDirectoryRoots()</code> output.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.24 Using the FileWatcher Service to Get Notified About File Changes" data-type="sect1"><div class="sect1" id="javacook-dirfile-fileWatchService-1">&#13;
<h1>10.24 Using the FileWatcher Service to Get Notified About File Changes</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-dirfile-fileWatchService-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="FileWatcher service" data-type="indexterm" id="idm45290650235752"/><a data-primary="input/output" data-secondary="FileWatcher service" data-type="indexterm" id="idm45290650235048"/>You want to be notified when some other application updates one or more of the files in which you are interested.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-dirfile-fileWatchService-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the <code>java.nio.file.FileWatchService</code> to get notified of changes to files automatically, instead of&#13;
having to examine the files periodically.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-dirfile-fileWatchService-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>It is fairly common for a large application to want to be notified of changes to files,&#13;
without having to go and look at them periodically.&#13;
For example, a Java Enterprise web server wants to know when Servlets and other components get updated.&#13;
An IDE wants to know when files were modified by an external editor or a build script.&#13;
Many modern operating systems have had this capability for some time, and now it is available in Java.</p>&#13;
&#13;
<p>These are the basic steps to using the <code>FileWatchService</code>:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Create a <code>Path</code> object representing the directory you want to watch.</p>&#13;
</li>&#13;
<li>&#13;
<p>Get a <code>WatchService</code> by calling, for example, <code>FileSystems.getDefault().newWatchService()</code>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Create an array of <code>Kind</code> enumerations for the things you want to watch (in our example we watch for files being created or modified).</p>&#13;
</li>&#13;
<li>&#13;
<p>Register the <code>WatchService</code> and the <code>Kind</code> array onto the <code>Path</code> object.</p>&#13;
</li>&#13;
<li>&#13;
<p>From then on, you wait for the watcher to notify you. A typical implementation is to enter a&#13;
<code>while (true)</code> loop calling the <code>WatchService</code>’s <code>take()</code> method to get an event and interpret the events to figure out what just happened.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p><a data-type="xref" href="#javacook-dirfile-fileWatchService-eg">Example 10-12</a> is a program that does just that.&#13;
In addition, it starts another thread to actually do some filesystem operations so that you&#13;
can see the <code>WatchService</code> <span class="keep-together">operating.</span></p>&#13;
<div data-type="example" id="javacook-dirfile-fileWatchService-eg">&#13;
<h5><span class="label">Example 10-12. </span>main/src/main/java/nio/FileWatchServiceDemo.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">FileWatchServiceDemo</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">final</code> <code class="kd">static</code> <code class="n">String</code> <code class="n">TEMP_DIR_PATH</code> <code class="o">=</code> <code class="s">"/tmp"</code><code class="o">;</code>&#13;
    <code class="kd">static</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">FILE_SEMA_FOR</code> <code class="o">=</code> <code class="s">"MyFileSema.for"</code><code class="o">;</code>&#13;
    <code class="kd">final</code> <code class="kd">static</code> <code class="n">Path</code> <code class="n">SEMAPHORE_PATH</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">TEMP_DIR_PATH</code> <code class="o">,</code><code class="n">FILE_SEMA_FOR</code><code class="o">);</code>&#13;
    <code class="kd">static</code> <code class="kd">volatile</code> <code class="kt">boolean</code> <code class="n">done</code> <code class="o">=</code> <code class="kc">false</code><code class="o">;</code>&#13;
    <code class="kd">final</code> <code class="kd">static</code> <code class="n">ExecutorService</code> <code class="n">threadPool</code> <code class="o">=</code> <code class="n">Executors</code><code class="o">.</code><code class="na">newSingleThreadExecutor</code><code class="o">();</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">Throwable</code> <code class="o">{</code>&#13;
        <code class="n">String</code> <code class="n">tempDirPath</code> <code class="o">=</code> <code class="s">"/tmp"</code><code class="o">;</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Starting watcher for "</code> <code class="o">+</code> <code class="n">tempDirPath</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Semaphore file is "</code> <code class="o">+</code> <code class="n">SEMAPHORE_PATH</code><code class="o">);</code>&#13;
        <code class="n">Path</code> <code class="n">p</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">tempDirPath</code><code class="o">);</code>&#13;
        <code class="n">WatchService</code> <code class="n">watcher</code> <code class="o">=</code>&#13;
            <code class="n">FileSystems</code><code class="o">.</code><code class="na">getDefault</code><code class="o">().</code><code class="na">newWatchService</code><code class="o">();</code>&#13;
        <code class="n">Kind</code><code class="o">&lt;?&gt;[]</code> <code class="n">watchKinds</code> <code class="o">=</code> <code class="o">{</code> <code class="n">ENTRY_CREATE</code><code class="o">,</code> <code class="n">ENTRY_MODIFY</code> <code class="o">};</code>&#13;
        <code class="n">p</code><code class="o">.</code><code class="na">register</code><code class="o">(</code><code class="n">watcher</code><code class="o">,</code> <code class="n">watchKinds</code><code class="o">);</code>&#13;
        <code class="n">threadPool</code><code class="o">.</code><code class="na">submit</code><code class="o">(</code><code class="k">new</code> <code class="n">DemoService</code><code class="o">());</code>&#13;
        <code class="k">while</code> <code class="o">(!</code><code class="n">done</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">WatchKey</code> <code class="n">key</code> <code class="o">=</code> <code class="n">watcher</code><code class="o">.</code><code class="na">take</code><code class="o">();</code>&#13;
            <code class="k">for</code> <code class="o">(</code><code class="n">WatchEvent</code><code class="o">&lt;?&gt;</code> <code class="n">e</code> <code class="o">:</code> <code class="n">key</code><code class="o">.</code><code class="na">pollEvents</code><code class="o">())</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code>&#13;
                    <code class="s">"Saw event "</code> <code class="o">+</code> <code class="n">e</code><code class="o">.</code><code class="na">kind</code><code class="o">()</code> <code class="o">+</code> <code class="s">" on "</code> <code class="o">+</code>&#13;
                    <code class="n">e</code><code class="o">.</code><code class="na">context</code><code class="o">());</code>&#13;
                <code class="k">if</code> <code class="o">(</code><code class="n">e</code><code class="o">.</code><code class="na">context</code><code class="o">().</code><code class="na">toString</code><code class="o">().</code><code class="na">equals</code><code class="o">(</code><code class="n">FILE_SEMA_FOR</code><code class="o">))</code> <code class="o">{</code>&#13;
                    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Semaphore found, shutting down watcher"</code><code class="o">);</code>&#13;
                    <code class="n">done</code> <code class="o">=</code> <code class="kc">true</code><code class="o">;</code>&#13;
                <code class="o">}</code>&#13;
            <code class="o">}</code>&#13;
            <code class="k">if</code> <code class="o">(!</code><code class="n">key</code><code class="o">.</code><code class="na">reset</code><code class="o">())</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"WatchKey failed to reset!"</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/**</code>&#13;
<code class="cm">     * Nested class whose only job is to wait a while, create a file in</code>&#13;
<code class="cm">     * the monitored directory, and then go away.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">private</code> <code class="kd">final</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">DemoService</code> <code class="kd">implements</code> <code class="n">Runnable</code> <code class="o">{</code>&#13;
        <code class="kd">public</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">()</code> <code class="o">{</code>&#13;
            <code class="k">try</code> <code class="o">{</code>&#13;
                <code class="n">Thread</code><code class="o">.</code><code class="na">sleep</code><code class="o">(</code><code class="mi">1000</code><code class="o">);</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"DemoService: Creating file"</code><code class="o">);</code>&#13;
                <code class="n">Files</code><code class="o">.</code><code class="na">deleteIfExists</code><code class="o">(</code><code class="n">SEMAPHORE_PATH</code><code class="o">);</code> <code class="c1">// clean up from previous run</code>&#13;
                <code class="n">Files</code><code class="o">.</code><code class="na">createFile</code><code class="o">(</code><code class="n">SEMAPHORE_PATH</code><code class="o">);</code>&#13;
                <code class="n">Thread</code><code class="o">.</code><code class="na">sleep</code><code class="o">(</code><code class="mi">1000</code><code class="o">);</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"DemoService: Shutting down"</code><code class="o">);</code>&#13;
            <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Caught UNEXPECTED "</code> <code class="o">+</code> <code class="n">e</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.25 Program: Save User Data to Disk" data-type="sect1"><div class="sect1" id="javacook-io-SECT-22">&#13;
<h1>10.25 Program: Save User Data to Disk</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290650189000">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="input/output" data-secondary="Save User Data to Disk program" data-type="indexterm" id="io_sud"/><a data-primary="Save User Data to Disk program" data-type="indexterm" id="sud_ab"/>You need to save user data to disk in a Java application. This may be in response to File→Save in a GUI application, saving the file in a text editor, or saving configuration data in a non-GUI application. You have heard (correctly) that a well-behaved application should never lose data.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290649904200">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use this five-step plan, with appropriate variations:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Create a temporary file; arrange for it to be removed automatically with <code>deleteOnExit(true)</code>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Write the user data to this file. Data format translation errors, if any, will be thrown during this process, leaving the previous version of the user’s data file intact.</p>&#13;
</li>&#13;
<li>&#13;
<p>Delete the backup file if it exists.</p>&#13;
</li>&#13;
<li>&#13;
<p>Rename the user’s previous file to <em>*.bak</em>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Rename the temporary file to the saved file.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290649896824">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>As developers, we have to deal with the fact that saving a file to disk is full of risk.&#13;
There are many things that can go wrong in saving data, yet it is one of the most critical parts of most applications. If you lose data that a person has spent hours inputting, or even lose a setting that a user feels strongly about, she will despise your whole application. The disk might fill up while we’re writing it, or it might be full before we start. This is a user’s error, but we have to face it. So here’s a more detailed discussion of the little five-step dance we should go through:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Create a temporary file that we will write to. Set this file to <code>deleteOnExit(true)</code> so that if we fail in a later step we don’t clutter the disk. Because we are later going to rename this file to become the user’s real file, and we don’t want to run out of disk space during the rename, it is important that we create the file on the same disk drive partition<a data-primary="drive letter" data-type="indexterm" id="idm45290649892424"/><a data-primary="mount point" data-type="indexterm" id="idm45290649891720"/> (<em>drive letter</em> or <em>mount point</em>) as the user’s real file; otherwise the rename will silently morph into a copy-and-delete, which could fail due to lack of disk space.&#13;
See <a data-type="xref" href="#javacook-dirfile-SECT-5">Recipe 10.21</a> for methods of deleting a file on exit.</p>&#13;
</li>&#13;
<li>&#13;
<p>Write the user data to this new temporary file. If we are transforming data—say, getting it from a JDBC ResultSet or writing objects using a XML transformer—an exception could be thrown. If we’re not careful, these exceptions can cause the user’s data to be lost.</p>&#13;
</li>&#13;
<li>&#13;
<p>Delete the backup file if it exists. First time we do this it won’t exist; after that it probably will. Be prepared either way.</p>&#13;
</li>&#13;
<li>&#13;
<p>Rename the user’s previous file to <em>*.bak</em>_.</p>&#13;
</li>&#13;
<li>&#13;
<p>Rename the temporary file to the save file.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>This may seem like overkill, but it prevents career kill. I’ve done pretty much this in numerous apps with various save file formats. This plan is the only really safe way around all the problems that can occur. For example, the final step has to be a rename not a copy, regardless of size considerations, to avoid the problem of the disk filling up. So, to be correct, you have to ensure that the temp file gets created on the same disk partition (drive letter or mount&#13;
point) as the user’s file.</p>&#13;
&#13;
<p>This is the basic plan to use the <code>FileSaver</code>:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Instantiate it by calling the constructor.</p>&#13;
</li>&#13;
<li>&#13;
<p>Call the<a data-primary="getWriter() method" data-type="indexterm" id="idm45290649880952"/><a data-primary="getOutputStream() method" data-type="indexterm" id="idm45290649880216"/> <code>getWriter()</code> or <code>getOutputStream()</code> method.</p>&#13;
</li>&#13;
<li>&#13;
<p>Use the output file to write the data.</p>&#13;
</li>&#13;
<li>&#13;
<p>Call<a data-primary="finish() method" data-type="indexterm" id="idm45290649876728"/> <code>finish()</code> on the <code>FileSaver</code> object.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><em>main/src/main/java/com/darwinsys/io/FileSaver.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="c1">// package com.darwinsys.io;</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">FileSaver</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">enum</code> <code class="n">State</code> <code class="o">{</code>&#13;
        <code class="cm">/** The state before and after use */</code>&#13;
        <code class="n">AVAILABLE</code><code class="o">,</code>&#13;
        <code class="cm">/** The state while in use */</code>&#13;
        <code class="n">INUSE</code>&#13;
    <code class="o">}</code>&#13;
    <code class="kd">private</code> <code class="n">State</code> <code class="n">state</code><code class="o">;</code>&#13;
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Path</code> <code class="n">inputFile</code><code class="o">;</code>&#13;
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Path</code> <code class="n">tmpFile</code><code class="o">;</code>&#13;
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Path</code> <code class="n">backupFile</code><code class="o">;</code>&#13;
&#13;
    <code class="kd">private</code> <code class="n">OutputStream</code> <code class="n">mOutputStream</code><code class="o">;</code>&#13;
    <code class="kd">private</code> <code class="n">Writer</code> <code class="n">mWriter</code><code class="o">;</code>&#13;
&#13;
    <code class="kd">public</code> <code class="nf">FileSaver</code><code class="o">(</code><code class="n">Path</code> <code class="n">inputFile</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// Step 1: Create temp file in right place; must be on same disk</code>&#13;
        <code class="c1">// as the original file, to avoid disk-full troubles later.</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">inputFile</code> <code class="o">=</code> <code class="n">inputFile</code><code class="o">;</code>&#13;
        <code class="n">tmpFile</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">inputFile</code><code class="o">.</code><code class="na">normalize</code><code class="o">()</code> <code class="o">+</code> <code class="s">".tmp"</code><code class="o">);</code>&#13;
        <code class="n">Files</code><code class="o">.</code><code class="na">createFile</code><code class="o">(</code><code class="n">tmpFile</code><code class="o">);</code>&#13;
        <code class="n">tmpFile</code><code class="o">.</code><code class="na">toFile</code><code class="o">().</code><code class="na">deleteOnExit</code><code class="o">();</code>&#13;
        <code class="n">backupFile</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">inputFile</code><code class="o">.</code><code class="na">normalize</code><code class="o">()</code> <code class="o">+</code> <code class="s">".bak"</code><code class="o">);</code>&#13;
        <code class="n">state</code> <code class="o">=</code> <code class="n">State</code><code class="o">.</code><code class="na">AVAILABLE</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/**</code>&#13;
<code class="cm">     * Return a reference to the contained File object, to</code>&#13;
<code class="cm">     * promote reuse (File objects are immutable so this</code>&#13;
<code class="cm">     * is at least moderately safe). Typical use would be:</code>&#13;
<code class="cm">     * &lt;pre&gt;</code>&#13;
<code class="cm">     * if (fileSaver == null ||</code>&#13;
<code class="cm">     *   !(fileSaver.getFile().equals(file))) {</code>&#13;
<code class="cm">     *        fileSaver = new FileSaver(file);</code>&#13;
<code class="cm">     * }</code>&#13;
<code class="cm">     * &lt;/pre&gt;</code>&#13;
<code class="cm">     * @return the File object for the file to be saved</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="n">Path</code> <code class="nf">getFile</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">inputFile</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Return an output file that the client should use to</code>&#13;
<code class="cm">     * write the client's data to.</code>&#13;
<code class="cm">     * @return An OutputStream, which should be wrapped in a</code>&#13;
<code class="cm">     *     buffered OutputStream to ensure reasonable performance.</code>&#13;
<code class="cm">     * @throws IOException if the temporary file cannot be written</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="n">OutputStream</code> <code class="nf">getOutputStream</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">state</code> <code class="o">!=</code> <code class="n">State</code><code class="o">.</code><code class="na">AVAILABLE</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalStateException</code><code class="o">(</code><code class="s">"FileSaver not opened"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">mOutputStream</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">newOutputStream</code><code class="o">(</code><code class="n">tmpFile</code><code class="o">);</code>&#13;
        <code class="n">state</code> <code class="o">=</code> <code class="n">State</code><code class="o">.</code><code class="na">INUSE</code><code class="o">;</code>&#13;
        <code class="k">return</code> <code class="n">mOutputStream</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Return an output file that the client should use to</code>&#13;
<code class="cm">     * write the client's data to.</code>&#13;
<code class="cm">     * @return A BufferedWriter to write on the new file.</code>&#13;
<code class="cm">     * @throws IOException if the temporary file cannot be written</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="n">Writer</code> <code class="nf">getWriter</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">state</code> <code class="o">!=</code> <code class="n">State</code><code class="o">.</code><code class="na">AVAILABLE</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalStateException</code><code class="o">(</code><code class="s">"FileSaver not opened"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">mWriter</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">newBufferedWriter</code><code class="o">(</code><code class="n">tmpFile</code><code class="o">);</code>&#13;
        <code class="n">state</code> <code class="o">=</code> <code class="n">State</code><code class="o">.</code><code class="na">INUSE</code><code class="o">;</code>&#13;
        <code class="k">return</code> <code class="n">mWriter</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Close the output file and rename the temp file to the original name.</code>&#13;
<code class="cm">     * @throws IOException If anything goes wrong</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">finish</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">state</code> <code class="o">!=</code> <code class="n">State</code><code class="o">.</code><code class="na">INUSE</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalStateException</code><code class="o">(</code><code class="s">"FileSaver not in use"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="c1">// Ensure both are closed before we try to rename.</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">mOutputStream</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">mOutputStream</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
        <code class="o">}</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">mWriter</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">mWriter</code><code class="o">.</code><code class="na">close</code><code class="o">();</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="c1">// Delete the previous backup file if it exists.</code>&#13;
        <code class="n">Files</code><code class="o">.</code><code class="na">deleteIfExists</code><code class="o">(</code><code class="n">backupFile</code><code class="o">);</code>&#13;
&#13;
        <code class="c1">// Rename the user's previous file to itsName.bak,</code>&#13;
        <code class="c1">// UNLESS this is a new file.</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="n">inputFile</code><code class="o">)</code> <code class="o">&amp;&amp;</code>&#13;
            <code class="n">Files</code><code class="o">.</code><code class="na">move</code><code class="o">(</code><code class="n">inputFile</code><code class="o">,</code> <code class="n">backupFile</code><code class="o">)</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IOException</code><code class="o">(</code>&#13;
                <code class="s">"Could not rename file to backup file "</code> <code class="o">+</code> <code class="n">backupFile</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="c1">// Rename the temporary file to the save file.</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">move</code><code class="o">(</code><code class="n">tmpFile</code><code class="o">,</code> <code class="n">inputFile</code><code class="o">)</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IOException</code><code class="o">(</code><code class="s">"Could not rename temp file to save file"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">state</code> <code class="o">=</code> <code class="n">State</code><code class="o">.</code><code class="na">AVAILABLE</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Acknowledgments" data-type="sect2"><div class="sect2" id="idm45290649864824">&#13;
<h2>Acknowledgments</h2>&#13;
&#13;
<p>The code in this program is my own, based on my experience in various applications. I was prompted to package it up this way, and write it up, by a post by Brendon McLean to the mailing list for the now-defunct <a href="http://jcp.org/en/jsr/detail?id=296">Java Application Framework JSR-296</a>.<a data-primary="" data-startref="io_sud" data-type="indexterm" id="idm45290649862760"/><a data-primary="" data-startref="sud_ab" data-type="indexterm" id="idm45290649861784"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="10.26 Program: Find—Walking a File Tree" data-type="sect1"><div class="sect1" id="javacook-dirfile-SECT-10">&#13;
<h1>10.26 Program: Find—Walking a File Tree</h1>&#13;
&#13;
<p><a data-primary="Find: Walking a File Tree program" data-type="indexterm" id="fwftp_ab"/><a data-primary="input/output" data-secondary="Find: Walking a File Tree program" data-type="indexterm" id="io_fwftp"/>The program shown in <a data-type="xref" href="#javacook-dirfile-SECT-10-ex">Example 10-13</a> implements a subset of the&#13;
Windows <em>Find Files</em> dialog or the Unix <em>find</em>  command. It has most of the&#13;
structure needed to build a more complete version of either of these. It accepts the following&#13;
options from standard Unix <code>find</code> (with limits):</p>&#13;
<dl>&#13;
<dt><code>-n <em>name</em></code></dt>&#13;
<dd>&#13;
<p>Name to look for. Can include shell wildcards if quoted from the shell.</p>&#13;
</dd>&#13;
<dt><code>-s <em>size</em></code></dt>&#13;
<dd>&#13;
<p>Size of file to look for. Can prefix with a plus sign to indicate greater than or a minus sign to indicate less than.</p>&#13;
</dd>&#13;
<dt><code>-a</code>, <code>-o</code></dt>&#13;
<dd>&#13;
<p>And or or, but only one of these, between a <code>-n</code> and a <code>-s</code>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The <code>Files</code> class has four methods for walking a file tree. Two return a lazily populated <code>Stream&lt;Path&gt;</code>,&#13;
and the other two invoke a callback <code>FileVisitor</code> for each file or directory found.&#13;
My <code>find</code> implementation uses the first one; the four are summarized in <a data-type="xref" href="#javacook-dir_file-Files-Walkers">Table 10-11</a>.</p>&#13;
<table id="javacook-dir_file-Files-Walkers">&#13;
<caption><span class="label">Table 10-11. </span>Files tree walk methods</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Return</th>&#13;
<th>Signature</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>Stream&lt;Path&gt;</code></p></td>&#13;
<td><p>walk(Path start, FileVisitOption… options)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>Stream&lt;Path&gt;</code></p></td>&#13;
<td><p>walk(Path start, int maxDepth, FileVisitOption… options)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>Path</code></p></td>&#13;
<td><p>walkFileTree(Path start, FileVisitor&lt;? super Path&gt; visitor)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>Path</code></p></td>&#13;
<td><p>walkFileTree(Path start, Set&lt;FileVisitOption&gt; options, int maxDepth, FileVisitor&lt;? super Path&gt; visitor)</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>Using the <code>walk()</code> methods is as simple as this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">Files</code><code class="o">.</code><code class="na">walk</code><code class="o">(</code><code class="n">startingPath</code><code class="o">).</code><code class="na">forEach</code><code class="o">(</code><code class="n">path</code> <code class="o">-&gt;</code> <code class="o">{</code>&#13;
	<code class="c1">// Do something with Path path; might be file, directory or other...</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>That code is near the start of the <code>startWalkingAt()</code> method in <a data-type="xref" href="#javacook-dirfile-SECT-10-ex">Example 10-13</a>.</p>&#13;
<div data-type="example" id="javacook-dirfile-SECT-10-ex">&#13;
<h5><span class="label">Example 10-13. </span>main/src/main/java/dir_file/Find.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Find - find files by name, size, or other criteria. Non-GUI version.</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Find</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">enum</code> <code class="n">Conjunction</code> <code class="o">{</code> <code class="n">AND</code><code class="o">,</code> <code class="n">OR</code> <code class="o">};</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="n">Logger</code> <code class="n">logger</code> <code class="o">=</code> <code class="n">Logger</code><code class="o">.</code><code class="na">getLogger</code><code class="o">(</code><code class="n">Find</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getSimpleName</code><code class="o">());</code>&#13;
    <code class="kd">static</code> <code class="kt">boolean</code> <code class="n">started</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** Main program</code>&#13;
<code class="cm">     * @throws IOException If the Files.walkTree does so</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="n">Find</code> <code class="n">finder</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Find</code><code class="o">();</code>&#13;
&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">args</code><code class="o">.</code><code class="na">length</code> <code class="o">==</code> <code class="mi">0</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">finder</code><code class="o">.</code><code class="na">startWalkingAt</code><code class="o">(</code><code class="s">"."</code><code class="o">);</code>&#13;
        <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
            <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="n">args</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>&#13;
                <code class="k">if</code> <code class="o">(</code><code class="n">args</code><code class="o">[</code><code class="n">i</code><code class="o">].</code><code class="na">charAt</code><code class="o">(</code><code class="mi">0</code><code class="o">)</code> <code class="o">==</code> <code class="sc">'-'</code><code class="o">)</code> <code class="o">{</code>&#13;
                    <code class="k">switch</code><code class="o">(</code><code class="n">args</code><code class="o">[</code><code class="n">i</code><code class="o">].</code><code class="na">substring</code><code class="o">(</code><code class="mi">1</code><code class="o">))</code> <code class="o">{</code>&#13;
                    <code class="k">case</code> <code class="s">"name"</code><code class="o">:</code>&#13;
                        <code class="n">finder</code><code class="o">.</code><code class="na">filter</code><code class="o">.</code><code class="na">setNameFilter</code><code class="o">(</code><code class="n">args</code><code class="o">[++</code><code class="n">i</code><code class="o">]);</code>&#13;
                        <code class="k">continue</code><code class="o">;</code>&#13;
                    <code class="k">case</code> <code class="s">"size"</code><code class="o">:</code>&#13;
                        <code class="n">finder</code><code class="o">.</code><code class="na">filter</code><code class="o">.</code><code class="na">setSizeFilter</code><code class="o">(</code><code class="n">args</code><code class="o">[++</code><code class="n">i</code><code class="o">]);</code>&#13;
                        <code class="k">continue</code><code class="o">;</code>&#13;
<code class="c1">//                    Not implemented by back-end yet</code>&#13;
<code class="c1">//                    case "a":</code>&#13;
<code class="c1">//                        finder.filter.addConjunction(Conjunction.AND);</code>&#13;
<code class="c1">//                        continue;</code>&#13;
<code class="c1">//                    case "o":</code>&#13;
<code class="c1">//                        finder.filter.addConjunction(Conjunction.OR);</code>&#13;
<code class="c1">//                        continue;</code>&#13;
                    <code class="k">default</code><code class="o">:</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">IllegalArgumentException</code><code class="o">(</code>&#13;
                        <code class="s">"Unknown argument "</code> <code class="o">+</code> <code class="n">args</code><code class="o">[</code><code class="n">i</code><code class="o">]);</code>&#13;
                    <code class="o">}</code>&#13;
                <code class="o">}</code>&#13;
                <code class="n">finder</code><code class="o">.</code><code class="na">startWalkingAt</code><code class="o">(</code><code class="n">args</code><code class="o">[</code><code class="n">i</code><code class="o">]);</code>&#13;
            <code class="o">}</code>&#13;
            <code class="k">if</code> <code class="o">(!</code><code class="n">started</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="n">finder</code><code class="o">.</code><code class="na">startWalkingAt</code><code class="o">(</code><code class="s">"."</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">protected</code> <code class="n">FindFilter</code> <code class="n">filter</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FindFilter</code><code class="o">();</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">usage</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code>&#13;
            <code class="s">"Usage: Find [-n namefilter][-s sizefilter][dir...]"</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">exit</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** doName - handle one filesystem object by name */</code>&#13;
    <code class="kd">private</code> <code class="kt">void</code> <code class="nf">startWalkingAt</code><code class="o">(</code><code class="n">String</code> <code class="n">s</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="n">logger</code><code class="o">.</code><code class="na">info</code><code class="o">(</code><code class="s">"doName("</code> <code class="o">+</code> <code class="n">s</code> <code class="o">+</code> <code class="s">")"</code><code class="o">);</code>&#13;
        <code class="n">started</code> <code class="o">=</code> <code class="kc">true</code><code class="o">;</code>&#13;
        <code class="n">Path</code> <code class="n">f</code> <code class="o">=</code> <code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">s</code><code class="o">);</code>&#13;
        <code class="k">if</code> <code class="o">(!</code><code class="n">Files</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="n">f</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">s</code> <code class="o">+</code> <code class="s">" does not exist"</code><code class="o">);</code>&#13;
            <code class="k">return</code><code class="o">;</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">Files</code><code class="o">.</code><code class="na">walk</code><code class="o">(</code><code class="n">f</code><code class="o">).</code><code class="na">forEach</code><code class="o">(</code><code class="n">fp</code> <code class="o">-&gt;</code> <code class="o">{</code>&#13;
            <code class="k">try</code> <code class="o">{</code>&#13;
                <code class="k">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">isRegularFile</code><code class="o">(</code><code class="n">fp</code><code class="o">))</code>&#13;
                    <code class="n">doFile</code><code class="o">(</code><code class="n">fp</code><code class="o">);</code>&#13;
                <code class="k">else</code> <code class="nf">if</code> <code class="o">(</code><code class="n">Files</code><code class="o">.</code><code class="na">isDirectory</code><code class="o">(</code><code class="n">fp</code><code class="o">))</code> <code class="o">{</code>&#13;
                    <code class="n">doDir</code><code class="o">(</code><code class="n">fp</code><code class="o">);</code>&#13;
                <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
                    <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Unknown type: "</code> <code class="o">+</code> <code class="n">s</code><code class="o">);</code>&#13;
                <code class="o">}</code>&#13;
            <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">IOException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="k">throw</code> <code class="k">new</code> <code class="nf">RuntimeException</code><code class="o">(</code><code class="s">"IO Exception: "</code> <code class="o">+</code> <code class="n">e</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">});</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** doFile - process one regular file.</code>&#13;
<code class="cm">     * @throws IOException */</code>&#13;
    <code class="kd">private</code> <code class="kt">void</code> <code class="nf">doFile</code><code class="o">(</code><code class="n">Path</code> <code class="n">f</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">filter</code><code class="o">.</code><code class="na">accept</code><code class="o">(</code><code class="n">f</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"f "</code> <code class="o">+</code> <code class="n">f</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** doDir - process a directory */</code>&#13;
    <code class="kd">private</code> <code class="kt">void</code> <code class="nf">doDir</code><code class="o">(</code><code class="n">Path</code> <code class="n">d</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"d "</code> <code class="o">+</code> <code class="n">d</code><code class="o">.</code><code class="na">normalize</code><code class="o">());</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p><a data-type="xref" href="#javacook-dirfile-SECT-10-ex2">Example 10-14</a> shows a class called <code>FindFilter</code>,&#13;
the backend implementation of <code>Find</code>.<a data-primary="" data-startref="fwftp_ab" data-type="indexterm" id="idm45290649342376"/><a data-primary="" data-startref="io_fwftp" data-type="indexterm" id="idm45290649341432"/><a data-primary="" data-startref="io_ch" data-type="indexterm" id="idm45290649340488"/></p>&#13;
<div data-type="example" id="javacook-dirfile-SECT-10-ex2">&#13;
<h5><span class="label">Example 10-14. </span>main/src/main/java/dir_file/FindFilter.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/** Class to encapsulate the filtration for Find.</code>&#13;
<code class="cm"> * For now just set*Filter() methods. Really needs to be a real</code>&#13;
<code class="cm"> * data structure (maybe LinkedList&lt;FilterOp&gt; or a Tree) for complex</code>&#13;
<code class="cm"> * requests like:</code>&#13;
<code class="cm"> *    -n "*.html" -a \( -size &lt; 0 -o mtime &lt; 5 \).</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">FindFilter</code> <code class="o">{</code>&#13;
    <code class="kd">private</code> <code class="kd">enum</code> <code class="n">SizeMode</code> <code class="o">{</code><code class="n">GT</code><code class="o">,</code> <code class="n">EQ</code><code class="o">,</code> <code class="n">LT</code><code class="o">};</code>&#13;
    <code class="n">SizeMode</code> <code class="n">sizeMode</code><code class="o">;</code>&#13;
    <code class="n">Find</code><code class="o">.</code><code class="na">Conjunction</code> <code class="n">conj</code><code class="o">;</code>&#13;
    <code class="kt">long</code> <code class="n">size</code><code class="o">;</code>&#13;
    <code class="n">String</code> <code class="n">name</code><code class="o">;</code>&#13;
    <code class="n">Pattern</code> <code class="n">nameRE</code><code class="o">;</code>&#13;
    <code class="kt">boolean</code> <code class="n">debug</code> <code class="o">=</code> <code class="kc">false</code><code class="o">;</code>&#13;
&#13;
    <code class="kt">void</code> <code class="nf">setSizeFilter</code><code class="o">(</code><code class="n">String</code> <code class="n">sizeFilter</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"FindFilter.setSizeFilter()"</code><code class="o">);</code>&#13;
        <code class="n">sizeMode</code> <code class="o">=</code> <code class="n">SizeMode</code><code class="o">.</code><code class="na">EQ</code><code class="o">;</code>&#13;
        <code class="kt">char</code> <code class="n">c</code> <code class="o">=</code> <code class="n">sizeFilter</code><code class="o">.</code><code class="na">charAt</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">c</code> <code class="o">==</code> <code class="sc">'+'</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">sizeMode</code> <code class="o">=</code> <code class="n">SizeMode</code><code class="o">.</code><code class="na">GT</code><code class="o">;</code>&#13;
            <code class="n">sizeFilter</code> <code class="o">=</code> <code class="n">sizeFilter</code><code class="o">.</code><code class="na">substring</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>&#13;
        <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">c</code> <code class="o">==</code> <code class="sc">'-'</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="n">sizeMode</code> <code class="o">=</code> <code class="n">SizeMode</code><code class="o">.</code><code class="na">LT</code><code class="o">;</code>&#13;
                <code class="n">sizeFilter</code> <code class="o">=</code> <code class="n">sizeFilter</code><code class="o">.</code><code class="na">substring</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">size</code> <code class="o">=</code> <code class="n">Long</code><code class="o">.</code><code class="na">parseLong</code><code class="o">(</code><code class="n">sizeFilter</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Add a conjunction */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">addConjunction</code><code class="o">(</code><code class="n">Find</code><code class="o">.</code><code class="na">Conjunction</code> <code class="n">conj</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"FindFilter.addConjunction()"</code><code class="o">);</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">conj</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code>&#13;
                <code class="s">"Only one conjucntion allowed in this version"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">conj</code> <code class="o">=</code> <code class="n">conj</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Convert the given shell wildcard pattern into internal form (an RE) */</code>&#13;
    <code class="kt">void</code> <code class="nf">setNameFilter</code><code class="o">(</code><code class="n">String</code> <code class="n">nameToFilter</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">nameRE</code> <code class="o">=</code> <code class="n">makeNameFilter</code><code class="o">(</code><code class="n">nameToFilter</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="n">Pattern</code> <code class="nf">makeNameFilter</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">StringBuilder</code> <code class="n">sb</code> <code class="o">=</code> <code class="k">new</code> <code class="n">StringBuilder</code><code class="o">(</code><code class="sc">'^'</code><code class="o">);</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="kt">char</code> <code class="n">c</code> <code class="o">:</code> <code class="n">name</code><code class="o">.</code><code class="na">toCharArray</code><code class="o">())</code> <code class="o">{</code>&#13;
            <code class="k">switch</code><code class="o">(</code><code class="n">c</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="k">case</code> <code class="sc">'.'</code><code class="o">:</code>    <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">"\\."</code><code class="o">);</code> <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="sc">'*'</code><code class="o">:</code>    <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">".*"</code><code class="o">);</code> <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="sc">'?'</code><code class="o">:</code>    <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="sc">'.'</code><code class="o">);</code> <code class="k">break</code><code class="o">;</code>&#13;
                <code class="c1">// Some chars are special to RE and have to be escaped</code>&#13;
                <code class="k">case</code> <code class="sc">'['</code><code class="o">:</code>    <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">"\\["</code><code class="o">);</code> <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="sc">']'</code><code class="o">:</code>    <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">"\\]"</code><code class="o">);</code> <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="sc">'('</code><code class="o">:</code>    <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">"\\("</code><code class="o">);</code> <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">case</code> <code class="sc">')'</code><code class="o">:</code>    <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="s">"\\)"</code><code class="o">);</code> <code class="k">break</code><code class="o">;</code>&#13;
                <code class="k">default</code><code class="o">:</code>    <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="n">c</code><code class="o">);</code> <code class="k">break</code><code class="o">;</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="sc">'$'</code><code class="o">);</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">debug</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"RE=\""</code> <code class="o">+</code> <code class="n">sb</code> <code class="o">+</code> <code class="s">"\"."</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="c1">// Should catch PatternException and rethrow for better diagnostics</code>&#13;
        <code class="k">return</code> <code class="n">Pattern</code><code class="o">.</code><code class="na">compile</code><code class="o">(</code><code class="n">sb</code><code class="o">.</code><code class="na">toString</code><code class="o">());</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Do the filtering. For now, only filter on name, size or name+size */</code>&#13;
    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">accept</code><code class="o">(</code><code class="n">Path</code> <code class="n">p</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">debug</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"FindFilter.accept("</code> <code class="o">+</code> <code class="n">p</code> <code class="o">+</code> <code class="s">")"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">nameRE</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">return</code> <code class="n">nameRE</code><code class="o">.</code><code class="na">matcher</code><code class="o">(</code><code class="n">p</code><code class="o">.</code><code class="na">getFileName</code><code class="o">().</code><code class="na">toString</code><code class="o">()).</code><code class="na">matches</code><code class="o">();</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="c1">// size handling</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">sizeMode</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="kt">long</code> <code class="n">sz</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">size</code><code class="o">(</code><code class="n">p</code><code class="o">);</code>&#13;
            <code class="k">switch</code> <code class="o">(</code><code class="n">sizeMode</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">case</code> <code class="nl">EQ:</code>&#13;
                <code class="k">return</code> <code class="o">(</code><code class="n">sz</code> <code class="o">==</code> <code class="n">size</code><code class="o">);</code>&#13;
            <code class="k">case</code> <code class="nl">GT:</code>&#13;
                <code class="k">return</code> <code class="o">(</code><code class="n">sz</code> <code class="o">&gt;</code> <code class="n">size</code><code class="o">);</code>&#13;
            <code class="k">case</code> <code class="nl">LT:</code>&#13;
                <code class="k">return</code> <code class="o">(</code><code class="n">sz</code> <code class="o">&lt;</code> <code class="n">size</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="c1">// Catchall</code>&#13;
        <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getName</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">name</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45290657814168"><sup><a href="ch10.html#idm45290657814168-marker">1</a></sup> A poor choice of name: it was new in Java SE 1.4. But newer than <code>InputStream</code>/<code>OutputStream</code> (Java 1.0) and <code>Reader</code>s/<code>Writer</code>s (1.1).</p><p data-type="footnote" id="idm45290657786632"><sup><a href="ch10.html#idm45290657786632-marker">2</a></sup> Not strictly true; there is, but only in the <code>java.nio.FileChannel</code> class, which we’re not covering.</p><p data-type="footnote" id="idm45290656852712"><sup><a href="ch10.html#idm45290656852712-marker">3</a></sup> The central character in Yann Martel’s novel <em>Life of Pi</em> would have been born in 1956, according to information in <a href="http://en.wikipedia.org/wiki/Life_of_pi">Wikipedia</a>.</p><p data-type="footnote" id="idm45290655572552"><sup><a href="ch10.html#idm45290655572552-marker">4</a></sup> If this were code in a maintained project, I might factor out some of the common code among these two calculators, as well as the one in <a data-type="xref" href="ch05.html#javacook-numbers-SECT-19">Recipe 5.12</a>, and divide the code better using interfaces. However, this would detract from the simplicity of self-contained examples.</p><p data-type="footnote" id="idm45290653458856"><sup><a href="ch10.html#idm45290653458856-marker">5</a></sup> There is no support for adding files to an existing archive, so make sure you put all the files in at once or be prepared to re-create the archive from scratch.</p></div></div></section></body></html>