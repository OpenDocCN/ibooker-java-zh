<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 13. Quarkus REST Clients"><div class="chapter" id="idm45128498890280">
<h1><span class="label">Chapter 13. </span>Quarkus REST Clients</h1>


<p><a data-type="indexterm" data-primary="RESTful services" data-secondary="about" id="idm45128498888776"/><a data-type="indexterm" data-primary="RESTful services" id="rest_cha"/>In <a data-type="xref" href="ch03.xhtml#developing_restful_services_chapter">Chapter 3</a>, you learned about developing RESTful services, but in this chapter, you’ll learn about communication between RESTful web services.</p>

<p>Using any service-based architecture inevitably means that you need to communicate with external services.
These services might be internal services (you control the life cycle of the service and they are usually deployed in the same cluster) or external services (third-party services).</p>

<p>If these services are implemented as RESTful web services, then you need a client to interact with these services.
Quarkus offers two ways to do that: JAX-RS Web Client, which is the standard Java EE way of communicating with RESTful service; and MicroProfile REST Client, which is the new way of communicating with RESTful services.</p>

<p>This chapter will include recipes for the following:</p>

<ul>
<li>
<p>Communicate to other RESTful services using the JAX-RS client</p>
</li>
<li>
<p>Communicate to other RESTful services using the MicroProfile Rest Client</p>
</li>
<li>
<p>Secure the communication between RESTful services</p>
</li>
</ul>






<section data-type="sect1" data-pdf-bookmark="13.1 Using the JAX-RS Web Client"><div class="sect1" id="idm45128498880680">
<h1>13.1 Using the JAX-RS Web Client</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128498879496">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="JAX-RS Client" id="jax_ab"/><a data-type="indexterm" data-primary="RESTful services" data-secondary="using JAX-RS Client" id="rest_jax"/>You want to communicate with another RESTful web service.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128498875720">
<h2>Solution</h2>

<p>Use JAX-RS web client to communicate with other RESTful web services.</p>

<p>Let’s look at how to communicate with other RESTful services using the JAX-RS spec.</p>

<p><a data-type="indexterm" data-primary="World Clock API" id="idm45128498873384"/>The external service we are going to connect with, the <a href="https://oreil.ly/wl2IE">World Clock API</a>, returns the current date/time by time zone.
You’ll need to get the 
<span class="keep-together">current</span> date/time exposed by the <a href="https://oreil.ly/7M0tf">API</a>.</p>

<p>You need to add extensions for using a REST client and the JAX-B/Jackson for marshalling/unmarshalling JSON and Java objects:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="resteasy-jsonb, rest-client"</code></pre>

<p>Or, if you are creating from empty directory, run the following:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">mvn io.quarkus:quarkus-maven-plugin:1.4.1.Final:create \</code>
<code class="go">    -DprojectGroupId=org.acme.quickstart \</code>
<code class="go">    -DprojectArtifactId=clock-app \</code>
<code class="go">    -DclassName="org.acme.quickstart.WorldClockResource" \</code>
<code class="go">    -Dextensions="resteasy-jsonb, rest-client"</code>
<code class="go">    -Dpath="/now"</code></pre>

<p>You can start using the JAX-RS REST Client for communicating with an external Rest API.
Let’s see what the interaction with the world clock service looks like.</p>

<p>Open <code>org.acme.quickstart.WorldClockResource.java</code> and add the following code:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.GET</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Path</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.PathParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Produces</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.client.Client</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.client.ClientBuilder</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.Response</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.config.inject.ConfigProperty</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.rest.client.inject.RestClient</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/now"</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">WorldClockResource</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>  </code><code class="nd">@ConfigProperty</code><code class="o">(</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s">"clock.host"</code><code class="o">,</code><code>
</code><code>  </code><code class="n">defaultValue</code><code> </code><code class="o">=</code><code> </code><code class="s">"http://worldclockapi.com"</code><code class="o">)</code><code>
</code><code>    </code><code class="n">String</code><code> </code><code class="n">clockHost</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO1-1" href="#callout_quarkus_rest_clients_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code>  </code><code class="kd">private</code><code> </code><code class="n">Client</code><code> </code><code class="n">client</code><code> </code><code class="o">=</code><code> </code><code class="n">ClientBuilder</code><code class="o">.</code><code class="na">newClient</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO1-2" href="#callout_quarkus_rest_clients_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>  </code><code class="nd">@GET</code><code>
</code><code>  </code><code class="nd">@Path</code><code class="o">(</code><code class="s">"{timezone}"</code><code class="o">)</code><code>
</code><code>  </code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="n">WorldClock</code><code> </code><code class="nf">getCurrentTime</code><code class="o">(</code><code class="nd">@PathParam</code><code class="o">(</code><code class="s">"timezone"</code><code class="o">)</code><code> </code><code class="n">String</code><code> </code><code class="n">timezone</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">WorldClock</code><code> </code><code class="n">worldClock</code><code> </code><code class="o">=</code><code> </code><code class="n">client</code><code class="o">.</code><code class="na">target</code><code class="o">(</code><code class="n">clockHost</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO1-3" href="#callout_quarkus_rest_clients_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>      </code><code class="o">.</code><code class="na">path</code><code class="o">(</code><code class="s">"api/json/{timezone}/now"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO1-4" href="#callout_quarkus_rest_clients_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>      </code><code class="o">.</code><code class="na">resolveTemplate</code><code class="o">(</code><code class="s">"timezone"</code><code class="o">,</code><code> </code><code class="n">timezone</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO1-5" href="#callout_quarkus_rest_clients_CO1-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>      </code><code class="o">.</code><code class="na">request</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code>
</code><code>      </code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">WorldClock</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO1-6" href="#callout_quarkus_rest_clients_CO1-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code> </code><a class="co" id="co_quarkus_rest_clients_CO1-7" href="#callout_quarkus_rest_clients_CO1-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">worldClock</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO1-1" href="#co_quarkus_rest_clients_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Makes service host configurable</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO1-2" href="#co_quarkus_rest_clients_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Creates a new REST Client</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO1-3" href="#co_quarkus_rest_clients_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Sets the host</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO1-4" href="#co_quarkus_rest_clients_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Sets the path to the service</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO1-5" href="#co_quarkus_rest_clients_CO1-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Resolves the <code>timezone</code> placeholder to the one provided</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO1-6" href="#co_quarkus_rest_clients_CO1-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Executes a <code>GET</code> HTTP method</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO1-7" href="#co_quarkus_rest_clients_CO1-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Transforms the JSON output to the provided POJO</p></dd>
</dl>

<p>Try it by opening a new terminal window, starting the Quarkus application, and sending a request to the <code>GET</code> method:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile quarkus:dev</code>

<code class="go">curl localhost:8080/now/cet</code>
<code class="go">{"currentDateTime":"2019-11-13T13:29+01:00","dayOfTheWeek":"Wednesday"}%</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128498875256">
<h2>Discussion</h2>

<p>In similar way, you can make requests to other HTTP methods.
For example, to do a POST request, you call the <code>post</code> method:</p>

<pre data-type="programlisting" data-code-language="java"><code class="n">target</code><code class="o">(</code><code class="n">host</code><code class="o">)</code>
    <code class="o">.</code><code class="na">request</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code>
    <code class="o">.</code><code class="na">post</code><code class="o">(</code><code class="n">entity</code><code class="o">);</code></pre>

<p>You can also use the <code>javax.ws.rs.core.Response</code> to get all the response details instead of just the body:</p>

<pre data-type="programlisting" data-code-language="java">  <code class="nd">@GET</code>
  <code class="nd">@Path</code><code class="o">(</code><code class="s">"{timezone}/raw"</code><code class="o">)</code>
  <code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code>
  <code class="kd">public</code> <code class="n">Response</code> <code class="nf">getCurrentTimeResponse</code><code class="o">(</code><code class="nd">@PathParam</code><code class="o">(</code><code class="s">"timezone"</code><code class="o">)</code>
      <code class="n">String</code> <code class="n">timezone</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">javax</code><code class="o">.</code><code class="na">ws</code><code class="o">.</code><code class="na">rs</code><code class="o">.</code><code class="na">core</code><code class="o">.</code><code class="na">Response</code> <code class="n">responseWorldClock</code> <code class="o">=</code> <code class="n">client</code><code class="o">.</code><code class="na">target</code><code class="o">(</code><code class="n">clockHost</code><code class="o">)</code>
      <code class="o">.</code><code class="na">path</code><code class="o">(</code><code class="s">"api/json/{timezone}/now"</code><code class="o">)</code>
      <code class="o">.</code><code class="na">resolveTemplate</code><code class="o">(</code><code class="s">"timezone"</code><code class="o">,</code> <code class="n">timezone</code><code class="o">)</code>
      <code class="o">.</code><code class="na">request</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code>
      <code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">Response</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>

    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">responseWorldClock</code><code class="o">.</code><code class="na">getStatus</code><code class="o">());</code>
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">responseWorldClock</code><code class="o">.</code><code class="na">getStringHeaders</code><code class="o">());</code>
    <code class="c1">// ... more methods</code>

    <code class="k">return</code> <code class="n">responseWorldClock</code><code class="o">;</code>
  <code class="o">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128498825128">
<h2>See Also</h2>

<p><a data-type="indexterm" data-primary="" data-startref="jax_ab" id="idm45128498824120"/><a data-type="indexterm" data-primary="" data-startref="rest_jax" id="idm45128498368920"/>You can further explore the JAX-RS REST Client at the following pages on Oracle’s website:</p>

<ul>
<li>
<p><a href="https://oreil.ly/7neQm">Accessing REST Resources with the JAX-RS Client API</a></p>
</li>
<li>
<p><a href="https://oreil.ly/QA8lA">Using the Client API in the JAX-RS Example Applications</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="13.2 Using the MicroProfile REST Client"><div class="sect1" id="idm45128498364920">
<h1>13.2 Using the MicroProfile REST Client</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128498363800">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="MicroProfile REST Client" id="micro_ab"/><a data-type="indexterm" data-primary="RESTful services" data-secondary="using MicroProfile REST Client" id="rest_abo"/>You want to communicate with another RESTful web service without going into low-level details.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128498360360">
<h2>Solution</h2>

<p>Use MicroProfile REST Client to communicate with other RESTful web services.</p>

<p>So far, you’ve seen how to use the JAX-RS <code>Web Client</code> to communicate with other REST APIs, but it is not type-safe, and you need to deal with low-level parameters instead of focusing on message communication.</p>

<p>The MicroProfile REST Client provides a type-safe approach to invoke RESTful services over HTTP using as much of the JAX-RS 2.0 spec as possible.
The REST client is defined as a Java interface, making it type-safe and providing the network configuration using JAX-RS annotations.</p>

<p><a data-type="indexterm" data-primary="World Clock API" id="idm45128498356920"/>We will use the same World Clock API that was used in the previous section here, too.
Remember to get the <a href="https://oreil.ly/7M0tf">current date/time</a>.</p>

<p>Create the <code>org.acme.quickstart.WorldClockService</code> interface that is responsible for interacting with the external service:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.GET</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Path</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.PathParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Produces</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.rest.client.inject.RegisterRestClient</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/api"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO2-1" href="#callout_quarkus_rest_clients_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nd">@ApplicationScoped</code><code>
</code><code class="nd">@RegisterRestClient</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO2-2" href="#callout_quarkus_rest_clients_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">interface</code><code> </code><code class="nc">WorldClockService</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="nd">@GET</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO2-3" href="#callout_quarkus_rest_clients_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>    </code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/json/{timezone}/now"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO2-4" href="#callout_quarkus_rest_clients_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>    </code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO2-5" href="#callout_quarkus_rest_clients_CO2-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">WorldClock</code><code> </code><code class="nf">getNow</code><code class="o">(</code><code class="nd">@PathParam</code><code class="o">(</code><code class="s">"timezone"</code><code class="o">)</code><code> </code><code class="n">String</code><code> </code><code class="n">timezone</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO2-6" href="#callout_quarkus_rest_clients_CO2-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO2-1" href="#co_quarkus_rest_clients_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The global path</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO2-2" href="#co_quarkus_rest_clients_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Sets the interface as REST client</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO2-3" href="#co_quarkus_rest_clients_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The request uses the <code>GET</code> HTTP method</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO2-4" href="#co_quarkus_rest_clients_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The subpath with a path parameter</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO2-5" href="#co_quarkus_rest_clients_CO2-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The media type requested</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO2-6" href="#co_quarkus_rest_clients_CO2-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>The path parameter is resolved with the passed argument</p></dd>
</dl>

<p>Open <code>org.acme.quickstart.WorldClockResource.java</code> and add the following code:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@RestClient</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO3-1" href="#callout_quarkus_rest_clients_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">WorldClockService</code><code> </code><code class="n">worldClockService</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"{timezone}/mp"</code><code class="o">)</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">WorldClock</code><code> </code><code class="nf">getCurrentTimeMp</code><code class="o">(</code><code class="nd">@PathParam</code><code class="o">(</code><code class="s">"timezone"</code><code class="o">)</code><code> </code><code class="n">String</code><code> </code><code class="n">timezone</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>  </code><code class="k">return</code><code> </code><code class="n">worldClockService</code><code class="o">.</code><code class="na">getNow</code><code class="o">(</code><code class="n">timezone</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO3-2" href="#callout_quarkus_rest_clients_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO3-1" href="#co_quarkus_rest_clients_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Injects the REST client</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO3-2" href="#co_quarkus_rest_clients_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Calls the external service</p></dd>
</dl>

<p>You still need to set the host of the external service.
MicroProfile REST Client has a configuration property to set it.</p>

<p>Open <em>application.properties</em>:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">org.acme.quickstart.WorldClockService/mp-rest/url</code><code class="o">=</code><code class="s">http://worldclockapi.com</code></pre>

<p>The attribute name uses the following format: <code><em>fully_qualified_name_rest_client</em>/mp-rest/url</code>, and the value is the hostname (or the root of the URL):</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile quarkus:dev</code>

<code class="go">curl localhost:8080/now/cet/mp</code>
<code class="go">{"currentDateTime":"2019-11-13T16:46+01:00","dayOfTheWeek":"Wednesday"}%</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128498359768">
<h2>Discussion</h2>

<p>You can also convert a response with a status code equal to or greater than 400 into an exception by implementing the <code>org.eclipse.microprofile.rest.client.ex.ResponseExceptionMapper</code> interface.
If multiple mappers are registered, then you need to set a priority with <code>javax.annotation.Priority</code> annotation.</p>

<p>Create the following <code>ResponseExecptionMapper</code> class to have it registered, and have the application throw <code>IOExecptions</code> for status codes in the 400s:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.io.IOException</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MultivaluedMap</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.Response</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.rest.client.ext.ResponseExceptionMapper</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">CustomResponseExceptionMapper</code><code>
</code><code>                </code><code class="kd">implements</code><code> </code><code class="n">ResponseExceptionMapper</code><code class="o">&lt;</code><code class="n">IOException</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO4-1" href="#callout_quarkus_rest_clients_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">IOException</code><code> </code><code class="nf">toThrowable</code><code class="o">(</code><code class="n">Response</code><code> </code><code class="n">response</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO4-2" href="#callout_quarkus_rest_clients_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="k">new</code><code> </code><code class="nf">IOException</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">boolean</code><code> </code><code class="nf">handles</code><code class="o">(</code><code class="kt">int</code><code> </code><code class="n">status</code><code class="o">,</code><code>
</code><code>                            </code><code class="n">MultivaluedMap</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">headers</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO4-3" href="#callout_quarkus_rest_clients_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">status</code><code> </code><code class="o">&gt;</code><code class="o">=</code><code> </code><code class="mi">400</code><code> </code><code class="o">&amp;</code><code class="o">&amp;</code><code> </code><code class="n">status</code><code> </code><code class="o">&lt;</code><code> </code><code class="mi">500</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO4-1" href="#co_quarkus_rest_clients_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Implements the mapper interface</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO4-2" href="#co_quarkus_rest_clients_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Does the conversion to an exception</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO4-3" href="#co_quarkus_rest_clients_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Default is to transform any response with status code ≥ 400, but you can override the method to provide a smaller range</p></dd>
</dl>

<p><code>ResponseExceptionMapper</code> <a data-type="indexterm" data-primary="ResponseExceptionMapper" id="idm45128497963992"/><a data-type="indexterm" data-primary="ClientRequestFilter" id="idm45128497963368"/><a data-type="indexterm" data-primary="ClientResponseFilter" id="idm45128497962696"/><a data-type="indexterm" data-primary="MessageBodyReader" id="idm45128497962024"/><a data-type="indexterm" data-primary="MessageBodyWriter" id="idm45128497961352"/><a data-type="indexterm" data-primary="ParamConverter" id="idm45128497921768"/><a data-type="indexterm" data-primary="ReadInterceptor" id="idm45128497921160"/><a data-type="indexterm" data-primary="WriteInterceptor" id="idm45128497920552"/><a data-type="indexterm" data-primary="@InjectMock" id="idm45128497919944"/>is an extension point specifically from the MicroProfile REST Client specification, but you can also use the extension model provided by the JAX-RS specification:</p>
<dl>
<dt><code>ClientRequestFilter</code></dt>
<dd>
<p>The filter invoked when the request is made to the external service.</p>
</dd>
<dt><code>ClientResponseFilter</code></dt>
<dd>
<p>The filter invoked when the response is received from the external service.</p>
</dd>
<dt><code>MessageBodyReader</code></dt>
<dd>
<p>Reads the entity after invocation.</p>
</dd>
<dt><code>MessageBodyWriter</code></dt>
<dd>
<p>Writes a request body in the operations that support bodies.</p>
</dd>
<dt><code>ParamConverter</code></dt>
<dd>
<p>Converts a parameter in the resource to a format to be used in a request or response.</p>
</dd>
<dt><code>ReadInterceptor</code></dt>
<dd>
<p>The listener fired when the response is received from the external service.</p>
</dd>
<dt><code>WriteInterceptor</code></dt>
<dd>
<p>The listener fired when the request is sent on the external service.</p>
</dd>
</dl>

<p>You can also mock the <code>WorldClockService</code> interface by using the <code>@InjectMock</code> together with <code>@RestClient</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@InjectMock</code>
<code class="nd">@RestClient</code>
<code class="n">WorldClockService</code> <code class="n">worldClockService</code><code class="o">;</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128497904392">
<h2>See Also</h2>

<p><a data-type="indexterm" data-primary="" data-startref="micro_ab" id="idm45128497881080"/><a data-type="indexterm" data-primary="" data-startref="rest_abo" id="idm45128497880136"/>The MicroProfile Rest Client specification can be found at the following website:</p>

<ul>
<li>
<p><a href="https://oreil.ly/7D0Zv">Eclipse REST Client for MicroProfile</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="13.3 Implementing a CRUD Client"><div class="sect1" id="idm45128497901144">
<h1>13.3 Implementing a CRUD Client</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128497900168">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="CRUD" id="idm45128497898968"/><a data-type="indexterm" data-primary="RESTful services" data-secondary="implementing CRUD clients" id="idm45128497898264"/>You want to communicate with another RESTful web service with CRUD operations exposed.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128497896968">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="JAX-RS Client" id="idm45128497893256"/>Use MicroProfile REST Client and JAX-RS annotations to implement a CRUD client.</p>

<p>So far, you’ve seen how to use MicroProfile REST Client to get information from external services.
When the service is an internal service, more often than not you need to implement more operations like insert, delete, or update.</p>

<p>To implement these operations, you can use JAX-RS annotations on a MicroProfile REST Client.
Let’s see an example:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.List</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.BeanParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Consumes</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.CookieParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.DELETE</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.GET</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.HEAD</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.HeaderParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.POST</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.PUT</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Path</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.PathParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Produces</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.Response</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.rest.client.inject.RegisterRestClient</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/developer"</code><code class="o">)</code><code>
</code><code class="nd">@RegisterRestClient</code><code>
</code><code class="nd">@Consumes</code><code class="o">(</code><code class="s">"application/json"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO5-1" href="#callout_quarkus_rest_clients_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="s">"application/json"</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">interface</code><code> </code><code class="nc">DeveloperService</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>
</code><code>  </code><code class="nd">@HEAD</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO5-2" href="#callout_quarkus_rest_clients_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>  </code><code class="n">Response</code><code> </code><code class="nf">head</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>  </code><code class="nd">@GET</code><code>
</code><code>  </code><code class="n">List</code><code class="o">&lt;</code><code class="n">Developer</code><code class="o">&gt;</code><code> </code><code class="nf">getDevelopers</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>  </code><code class="nd">@POST</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO5-3" href="#callout_quarkus_rest_clients_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>  </code><code class="n">Response</code><code> </code><code class="nf">createDeveloper</code><code class="o">(</code><code>
</code><code>      </code><code class="nd">@HeaderParam</code><code class="o">(</code><code class="s">"Authorization"</code><code class="o">)</code><code> </code><code class="n">String</code><code> </code><code class="n">authorization</code><code class="o">,</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO5-4" href="#callout_quarkus_rest_clients_CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>      </code><code class="n">Developer</code><code> </code><code class="n">developer</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO5-5" href="#callout_quarkus_rest_clients_CO5-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>
</code><code>  </code><code class="nd">@DELETE</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO5-6" href="#callout_quarkus_rest_clients_CO5-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>  </code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/{userId}"</code><code class="o">)</code><code>
</code><code>  </code><code class="n">Response</code><code> </code><code class="nf">deleteUser</code><code class="o">(</code><code class="nd">@CookieParam</code><code class="o">(</code><code class="s">"AuthToken"</code><code class="o">)</code><code> </code><code class="n">String</code><code> </code><code class="n">authorization</code><code class="o">,</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO5-7" href="#callout_quarkus_rest_clients_CO5-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>      </code><code class="nd">@PathParam</code><code class="o">(</code><code class="s">"developerId"</code><code class="o">)</code><code> </code><code class="n">Long</code><code> </code><code class="n">developerId</code><code class="o">)</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO5-1" href="#co_quarkus_rest_clients_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Requests and responses are in JSON format</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO5-2" href="#co_quarkus_rest_clients_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Uses the <code>HEAD</code> HTTP method</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO5-3" href="#co_quarkus_rest_clients_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Uses the <code>POST</code> HTTP method</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO5-4" href="#co_quarkus_rest_clients_CO5-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Sets <code>Authorization</code> header</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO5-5" href="#co_quarkus_rest_clients_CO5-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Developer content is sent as the body</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO5-6" href="#co_quarkus_rest_clients_CO5-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Uses the <code>DELETE</code> HTTP method</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO5-7" href="#co_quarkus_rest_clients_CO5-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Sets <code>AuthToken</code> cookie</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128497855112">
<h2>Discussion</h2>

<p>Notice how the JAX-RS annotations are used to configure how the requests are sent to the other services.
You never need to do anything programmatically.</p>

<p>This approach is developer-friendly and helps to reduce the boilerplate code that you might end up using with the JAX-RS Web Client.</p>

<p>Of course, it also has some drawbacks.
For example, methods can contain a huge number of parameters because of the number of path parameters, headers to set, and cookies.
To fix this, pass a POJO with all of the required fields (instead of setting them in the method).</p>

<p>Let’s create a Java class for the <code>PUT</code> requirements (i.e., an authorization header and a path parameter):</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.HeaderParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.PathParam</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">PutDeveloper</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="nd">@HeaderParam</code><code class="o">(</code><code class="s">"Authorization"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO6-1" href="#callout_quarkus_rest_clients_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">authorization</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="nd">@PathParam</code><code class="o">(</code><code class="s">"developerId"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO6-2" href="#callout_quarkus_rest_clients_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">developerId</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getAuthorization</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">authorization</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setAuthorization</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">authorization</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">authorization</code><code> </code><code class="o">=</code><code> </code><code class="n">authorization</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getDeveloperId</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">developerId</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setDeveloperId</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">developerId</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">developerId</code><code> </code><code class="o">=</code><code> </code><code class="n">developerId</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO6-1" href="#co_quarkus_rest_clients_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets the <code>Authorization</code> header</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO6-2" href="#co_quarkus_rest_clients_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Sets the <code>path</code> parameter to resolve</p></dd>
</dl>

<p>The <code>interface</code> method using the previous class is the following:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@PUT</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/{developerId}"</code><code class="o">)</code><code>
</code><code class="n">Response</code><code> </code><code class="nf">updateUser</code><code class="o">(</code><code class="nd">@BeanParam</code><code> </code><code class="n">PutDeveloper</code><code> </code><code class="n">putDeveloper</code><code class="o">,</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO7-1" href="#callout_quarkus_rest_clients_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">Developer</code><code> </code><code class="n">developer</code><code class="o">)</code><code class="o">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO7-1" href="#co_quarkus_rest_clients_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><a data-type="indexterm" data-primary="paramater aggregator" id="idm45128497744680"/>The <code>BeanParam</code> is used to indicate that this class is a <em>parameter aggregator</em></p></dd>
</dl>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="13.4 Manipulating Headers"><div class="sect1" id="idm45128497728056">
<h1>13.4 Manipulating Headers</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128497761128">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="headers" id="head_ab"/><a data-type="indexterm" data-primary="RESTful services" data-secondary="manipulating headers" id="rest_head"/>You want to manipulate and propagate headers from the incoming request to the 
<span class="keep-together">outgoing</span> service (service-to-service authentication).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128497756664">
<h2>Solution</h2>

<p>Use the MicroProfile REST Client feature that manipulates headers.</p>

<p><a data-type="indexterm" data-primary="authentication and authorization" data-secondary="service-to-service" id="idm45128497488792"/><a data-type="indexterm" data-primary="service-to-service authentication" id="idm45128497487960"/>When you need to communicate to other RESTful web services, you might want to pass through some headers from the incoming request to the outgoing/downstream service.
One of these typical cases is the <code>Authorization</code> header to do service-to-service authentication.
Authentication and authorization in services architecture are usually solved by propagating a token, often a JWT token, through all services that compose the application.
You can see the idea in <a data-type="xref" href="#s2sauth">Figure 13-1</a>.</p>

<figure><div id="s2sauth" class="figure">
<img src="Images/qucb_1301.png" alt="qucb 1301" width="845" height="486"/>
<h6><span class="label">Figure 13-1. </span>Service-to-service authentication</h6>
</div></figure>

<p>The MicroProfile REST Client simplifies all these operations by allowing you to propagate and manipulate headers either at a static level by using annotations or at a 
<span class="keep-together">programmatic</span> level by implementing <code>ClientHeadersFactory</code> interface.</p>

<p>To set a header on a method or on all the methods defined in an interface, you can use the <code>org.eclipse.microprofile.rest.client.annotation.ClientHeaderParam</code> annotation at method level or class level to set a header with a static value:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Path</code><code class="o">(</code><code class="s">"/somePath"</code><code class="o">)</code><code>
</code><code class="nd">@ClientHeaderParam</code><code class="o">(</code><code class="n">name</code><code class="o">=</code><code class="s">"user-agent"</code><code class="o">,</code><code> </code><code class="n">value</code><code class="o">=</code><code class="s">"curl/7.54.0"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO8-1" href="#callout_quarkus_rest_clients_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">Response</code><code> </code><code class="nf">get</code><code class="o">(</code><code class="o">)</code><code class="o">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO8-1" href="#co_quarkus_rest_clients_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets <code>user-agent</code> to the request</p></dd>
</dl>

<p>The <code>value</code> can be a method invocation where the return value would be the header’s value:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ClientHeaderParam</code><code class="o">(</code><code class="n">name</code><code class="o">=</code><code class="s">"user-agent"</code><code class="o">,</code><code> </code><code class="n">value</code><code class="o">=</code><code class="s">"{determineHeaderValue}"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO9-1" href="#callout_quarkus_rest_clients_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">Response</code><code> </code><code class="nf">otherGet</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code class="k">default</code><code> </code><code class="n">String</code><code> </code><code class="nf">determineHeaderValue</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">headerName</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO9-2" href="#callout_quarkus_rest_clients_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="s">"Hi-"</code><code> </code><code class="o">+</code><code> </code><code class="n">headerName</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO9-1" href="#co_quarkus_rest_clients_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets the method to invoke</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO9-2" href="#co_quarkus_rest_clients_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The header name is the first argument of the method</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="RegisterClientHeaders annotation" id="idm45128497299688"/>These approaches offer a basic manipulation of headers but don’t help in propagating headers from the incoming request to the outgoing service.
It is also possible to add or propagate headers by implementing the <code>ClientHeadersFactory</code> interface and registering it with the <code>RegisterClientHeaders</code> annotation.</p>

<p>Suppose that your service receives the authentication token from your upstream service in a header named <code>x-auth</code>, and your downstream service requires that this value is set to the <code>Authorization</code> header.
Let’s implement this rename of headers in a MicroProfile REST Client:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.List</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MultivaluedHashMap</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MultivaluedMap</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.rest.client.ext.ClientHeadersFactory</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">CustomClientHeadersFactory</code><code> </code><code class="kd">implements</code><code> </code><code class="n">ClientHeadersFactory</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>  </code><code class="nd">@Override</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="n">MultivaluedMap</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">update</code><code class="o">(</code><code>
</code><code>      </code><code class="n">MultivaluedMap</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">incomingHeaders</code><code class="o">,</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO10-1" href="#callout_quarkus_rest_clients_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>      </code><code class="n">MultivaluedMap</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">clientOutgoingHeaders</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO10-2" href="#callout_quarkus_rest_clients_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="kd">final</code><code> </code><code class="n">MultivaluedMap</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">headers</code><code> </code><code class="o">=</code><code>
</code><code>      </code><code class="k">new</code><code> </code><code class="n">MultivaluedHashMap</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code class="o">(</code><code class="n">incomingHeaders</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">headers</code><code class="o">.</code><code class="na">putAll</code><code class="o">(</code><code class="n">clientOutgoingHeaders</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO10-3" href="#callout_quarkus_rest_clients_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="kd">final</code><code> </code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">auth</code><code> </code><code class="o">=</code><code> </code><code class="n">headers</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"x-auth"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO10-4" href="#callout_quarkus_rest_clients_CO10-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">headers</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"Authorization"</code><code class="o">,</code><code> </code><code class="n">auth</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">headers</code><code class="o">.</code><code class="na">remove</code><code class="o">(</code><code class="s">"x-auth"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">headers</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO10-1" href="#co_quarkus_rest_clients_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The headers from the inbound JAX-RS request</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO10-2" href="#co_quarkus_rest_clients_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The headers parameters specified on the client interface</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO10-3" href="#co_quarkus_rest_clients_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Adds all headers</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO10-4" href="#co_quarkus_rest_clients_CO10-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Renames the header value</p></dd>
</dl>

<p>Finally, you need to register this factory in the client by using the <code>R⁠e⁠g⁠i⁠s⁠t⁠e⁠r⁠C⁠l⁠i⁠e⁠n⁠t​H⁠e⁠a⁠d⁠e⁠r⁠s</code> annotation:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@RegisterClientHeaders</code><code class="o">(</code><code class="n">CustomClientHeadersFactory</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO11-1" href="#callout_quarkus_rest_clients_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">interface</code><code> </code><code class="nc">ConfigureHeaderServices</code><code> </code><code class="o">{</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO11-1" href="#co_quarkus_rest_clients_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Registers the headers factory for this client</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128497756104">
<h2>Discussion</h2>

<p>If you want to propagate the headers only as is, without any modification, you can 
<span class="keep-together">do it by</span> just annotating the REST client with <code>@RegisterClientHeaders</code> without 
<span class="keep-together">specifying</span> any factory.
Then the default headers factory is used.</p>

<p>This default factory will propagate specified headers from the inbound JAX-RS request to the outbound request.
To configure which headers are propagated, you need to set them as comma-separated values under the <code>org.eclipse.microprofile.rest.client.propagateHeaders</code> property:<a data-type="indexterm" data-primary="" data-startref="head_ab" id="idm45128497032696"/><a data-type="indexterm" data-primary="" data-startref="rest_head" id="idm45128497031720"/></p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">org.eclipse.microprofile.rest.client.propagateHeaders</code><code class="o">=</code><code class="s">Authorization,\</code>
<code class="s">                                                      MyCustomHeader</code></pre>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="13.5 Using REST Client for Multipart Messages"><div class="sect1" id="idm45128497010952">
<h1>13.5 Using REST Client for Multipart Messages</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128497008952">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="RESTful services" data-secondary="using REST Client for multipart messages" id="idm45128497007816"/>You want to send multipart content to interact with the REST APIs requiring it.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128497006488">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="RESTEasy" id="idm45128497004920"/>Use RESTEasy multipart support to deal with multipart messages.</p>

<p>Sometimes the service you need to connect with requires that you send multiple content bodies embedded into one message, usually using the <code>multipart/form-data</code> MIME-type.
The easiest way to work with multipart mime-types is using the RESTEasy multipart provider, which integrates with the MicroProfile REST client.</p>
<div data-type="important"><h6>Important</h6>
<p>This feature is specific of RESTEasy/Quarkus and is not under MicroProfile REST client spec.</p>
</div>

<p>Before you start developing, you need to add the <code>resteasy-multipart-provider</code> dependency in your build tool:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="nt">&lt;dependency&gt;</code>
    <code class="nt">&lt;groupId&gt;</code>org.jboss.resteasy<code class="nt">&lt;/groupId&gt;</code>
    <code class="nt">&lt;artifactId&gt;</code>resteasy-multipart-provider<code class="nt">&lt;/artifactId&gt;</code>
<code class="nt">&lt;/dependency&gt;</code></pre>

<p>Then you need to create the model object that defines the payload of the message.
Let’s define a multipart message with two parts, one as a binary content and another one as a string:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.io.InputStream</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.FormParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.jboss.resteasy.annotations.providers.multipart.PartType</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">MultipartDeveloperModel</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="nd">@FormParam</code><code class="o">(</code><code class="s">"avatar"</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO12-1" href="#callout_quarkus_rest_clients_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="nd">@PartType</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_OCTET_STREAM</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO12-2" href="#callout_quarkus_rest_clients_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">InputStream</code><code> </code><code class="n">file</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="nd">@FormParam</code><code class="o">(</code><code class="s">"name"</code><code class="o">)</code><code>
</code><code>    </code><code class="nd">@PartType</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="n">developerName</code><code class="o">;</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO12-1" href="#co_quarkus_rest_clients_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>JAX-RS annotation to define the form parameter contained inside the request</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO12-2" href="#co_quarkus_rest_clients_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>RESTEasy annotation to define the content type of the part</p></dd>
</dl>

<p>Finally, you need to declare a new method using the <code>MultipartDeveloperModel</code> object as a parameter annotated with <code>org.jboss.resteasy.annotations.providers.multipart.MultipartForm</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@POST</code><code>
</code><code class="nd">@Consumes</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">MULTIPART_FORM_DATA</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO13-1" href="#callout_quarkus_rest_clients_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="n">String</code><code> </code><code class="nf">sendMultipartData</code><code class="o">(</code><code class="nd">@MultipartForm</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO13-2" href="#callout_quarkus_rest_clients_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>                            </code><code class="n">MultipartDeveloperModel</code><code> </code><code class="n">data</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO13-3" href="#callout_quarkus_rest_clients_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO13-1" href="#co_quarkus_rest_clients_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets the output mime-type as multipart</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO13-2" href="#co_quarkus_rest_clients_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Defines the parameter as a <code>multipart/form-type</code> mime-type</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO13-3" href="#co_quarkus_rest_clients_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Multipart data</p></dd>
</dl>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="13.6 Using REST Client to Configure SSL"><div class="sect1" id="idm45128496812520">
<h1>13.6 Using REST Client to Configure SSL</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128496811624">
<h2>Problem</h2>

<p>Y<a data-type="indexterm" data-primary="RESTful services" data-secondary="using REST Client to configure SSL" id="rest_ssl"/><a data-type="indexterm" data-primary="SSL" data-secondary="using REST Client to configure" id="ssl_rest"/>ou want to configure REST client to use SSL.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128496777880">
<h2>Solution</h2>

<p>The MicroProfile REST Client provides a way to configure SSL for communication with other services.</p>

<p>By default, the MicroProfile REST Client uses the JVM trust store to verify the certificates when HTTPS connections are used.
But sometimes, especially in cases of internal services, the certificates cannot be validated using the JVM trust store and you need to provide your custom trust store.</p>

<p><a data-type="indexterm" data-primary="MicroProfile REST Client" id="idm45128496775256"/>The MicroProfile REST Client accepts setting custom trust stores by using the <code>trustStore</code> configuration property<a data-type="indexterm" data-primary="trustStore" id="idm45128496773912"/><a data-type="indexterm" data-primary="trustStorePassword" id="idm45128496773304"/><a data-type="indexterm" data-primary="trustStoreType" id="idm45128496772696"/><a data-type="indexterm" data-primary="keyStore" id="idm45128496772088"/><a data-type="indexterm" data-primary="keyStorePassword" id="idm45128496771480"/><a data-type="indexterm" data-primary="keyStoreType" id="idm45128496770872"/>:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">org.acme.quickstart.FruityViceService/mp-rest/trustStore</code><code class="o">=</code><code> </code><code class="s">\
    classpath:/custom-truststore.jks </code><a class="co" id="co_quarkus_rest_clients_CO14-1" href="#callout_quarkus_rest_clients_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="na">org.acme.quickstart.FruityViceService/mp-rest/trustStorePassword</code><code class="o">=</code><code class="s">acme </code><a class="co" id="co_quarkus_rest_clients_CO14-2" href="#callout_quarkus_rest_clients_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="na">org.acme.quickstart.FruityViceService/mp-rest/trustStoreType</code><code class="o">=</code><code class="s">JKS </code><a class="co" id="co_quarkus_rest_clients_CO14-3" href="#callout_quarkus_rest_clients_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO14-1" href="#co_quarkus_rest_clients_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>trustStore</code> sets the trust store location; this can be a class path resource (<code>classpath:</code>) or a file (<code>file:</code>)</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO14-2" href="#co_quarkus_rest_clients_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>trustStorePassword</code> sets the password for the trust store</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO14-3" href="#co_quarkus_rest_clients_CO14-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p><code>trustStoreType</code> sets the type of trust store</p></dd>
</dl>

<p>Keystores are also provided, which are really useful in two-way SSL 
<span class="keep-together">connections</span>.</p>

<p>MicroProfile REST Client accepts setting custom key stores by using the <code>keyStore</code> configuration property.</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">org.acme.quickstart.FruityViceService/mp-rest/keyStore</code><code class="o">=</code><code> </code><code class="s">\
    classpath:/custom-keystore.jks </code><a class="co" id="co_quarkus_rest_clients_CO15-1" href="#callout_quarkus_rest_clients_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="na">org.acme.quickstart.FruityViceService/mp-rest/keyStorePassword</code><code class="o">=</code><code class="s">acme </code><a class="co" id="co_quarkus_rest_clients_CO15-2" href="#callout_quarkus_rest_clients_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="na">org.acme.quickstart.FruityViceService/mp-rest/keyStoreType</code><code class="o">=</code><code class="s">JKS </code><a class="co" id="co_quarkus_rest_clients_CO15-3" href="#callout_quarkus_rest_clients_CO15-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO15-1" href="#co_quarkus_rest_clients_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>keyStore</code> sets the key store location; this can be a class path resource (<code>classpath:</code>) or a file (<code>file:</code>)</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO15-2" href="#co_quarkus_rest_clients_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>keyStorePassword</code> sets the password for the trust store</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO15-3" href="#co_quarkus_rest_clients_CO15-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p><code>keyStoreType</code> sets the type of key store</p></dd>
</dl>

<p>Finally, you can implement <code>javax.net.ssl.HostnameVerifier</code> to override the behavior when the URL’s hostname and the server’s identification hostname 
<span class="keep-together">mismatch</span>.
Then the implementation of this interface can determine whether this 
<span class="keep-together">connection</span> should be allowed.</p>

<p>The following is an example of hostname verifier:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.net.ssl.HostnameVerifier</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.net.ssl.SSLSession</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">FruityHostnameVerifier</code> <code class="kd">implements</code> <code class="n">HostnameVerifier</code> <code class="o">{</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">verify</code><code class="o">(</code><code class="n">String</code> <code class="n">hostname</code><code class="o">,</code> <code class="n">SSLSession</code> <code class="n">session</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="s">"fruityvice.com"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">hostname</code><code class="o">))</code> <code class="o">{</code>
            <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>
        <code class="o">}</code>

        <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
    <code class="o">}</code>

<code class="o">}</code></pre>

<p>You need to enable it in the configuration file:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">org.acme.quickstart.FruityViceService/mp-rest/hostnameVerifier</code><code class="o">=</code><code class="s">\</code>
<code class="s">org.acme.quickstart.FruityHostnameVerifier</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128496777288">
<h2>Discussion</h2>

<p>Most of the time, when you are running tests locally, you might not have installed all the trust stores or key stores required to connect to an external service.
In these cases, you might run tests against the HTTP version of the service.
This is not always possible, however, and in some third-party services, only the HTTPS protocol is enabled.</p>

<p>One possible solution to this problem is to configure the MicroProfile REST Client to trust any certificate.
To do this, you need to configure the client and provide a custom trust manager:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.net.Socket</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.net.URI</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.security.KeyManagementException</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.security.NoSuchAlgorithmException</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.security.cert.CertificateException</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.security.cert.X509Certificate</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.net.ssl.HttpsURLConnection</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.net.ssl.SSLContext</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.net.ssl.SSLEngine</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.net.ssl.TrustManager</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.net.ssl.X509ExtendedTrustManager</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.apache.http.conn.ssl.NoopHostnameVerifier</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.eclipse.microprofile.rest.client.RestClientBuilder</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@ApplicationScoped</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO16-1" href="#callout_quarkus_rest_clients_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">TrustAllFruityViceService</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="n">FruityVice</code><code> </code><code class="nf">getFruitByName</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">name</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">FruityViceService</code><code> </code><code class="n">fruityViceService</code><code> </code><code class="o">=</code><code> </code><code class="n">RestClientBuilder</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="o">)</code><code>
</code><code>      </code><code class="o">.</code><code class="na">baseUri</code><code class="o">(</code><code class="n">URI</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="s">"https://www.fruityvice.com/"</code><code class="o">)</code><code class="o">)</code><code>
</code><code>      </code><code class="o">.</code><code class="na">hostnameVerifier</code><code class="o">(</code><code class="n">NoopHostnameVerifier</code><code class="o">.</code><code class="na">INSTANCE</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO16-2" href="#callout_quarkus_rest_clients_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>      </code><code class="o">.</code><code class="na">sslContext</code><code class="o">(</code><code class="n">trustEverything</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO16-3" href="#callout_quarkus_rest_clients_CO16-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>      </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="n">FruityViceService</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">fruityViceService</code><code class="o">.</code><code class="na">getFruitByName</code><code class="o">(</code><code class="n">name</code><code class="o">)</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">private</code><code> </code><code class="kd">static</code><code> </code><code class="n">SSLContext</code><code> </code><code class="nf">trustEverything</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_quarkus_rest_clients_CO16-4" href="#callout_quarkus_rest_clients_CO16-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="k">try</code><code> </code><code class="o">{</code><code>
</code><code>      </code><code class="n">SSLContext</code><code> </code><code class="n">sc</code><code> </code><code class="o">=</code><code> </code><code class="n">SSLContext</code><code class="o">.</code><code class="na">getInstance</code><code class="o">(</code><code class="s">"SSL"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>      </code><code class="n">sc</code><code class="o">.</code><code class="na">init</code><code class="o">(</code><code class="kc">null</code><code class="o">,</code><code> </code><code class="n">trustAllCerts</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="k">new</code><code> </code><code class="n">java</code><code class="o">.</code><code class="na">security</code><code class="o">.</code><code class="na">SecureRandom</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>      </code><code class="n">HttpsURLConnection</code><code class="o">.</code><code class="na">setDefaultSSLSocketFactory</code><code class="o">(</code><code class="n">sc</code><code class="o">.</code><code class="na">getSocketFactory</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>      </code><code class="k">return</code><code> </code><code class="n">sc</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code> </code><code class="k">catch</code><code> </code><code class="o">(</code><code class="n">KeyManagementException</code><code> </code><code class="o">|</code><code> </code><code class="n">NoSuchAlgorithmException</code><code> </code><code class="n">e</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>      </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nf">IllegalStateException</code><code class="o">(</code><code class="n">e</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">private</code><code> </code><code class="kd">static</code><code> </code><code class="n">TrustManager</code><code class="o">[</code><code class="o">]</code><code> </code><code class="nf">trustAllCerts</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code>  </code><code class="k">new</code><code> </code><code class="n">TrustManager</code><code class="o">[</code><code class="o">]</code><code class="o">{</code><code>
</code><code>      </code><code class="k">new</code><code> </code><code class="nf">X509ExtendedTrustManager</code><code class="o">(</code><code class="o">)</code><code class="o">{</code><code>
</code><code>
</code><code>        </code><code class="nd">@Override</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="n">X509Certificate</code><code class="o">[</code><code class="o">]</code><code> </code><code class="nf">getAcceptedIssuers</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>          </code><code class="k">return</code><code> </code><code class="kc">null</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>
</code><code>        </code><code class="nd">@Override</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">checkServerTrusted</code><code class="o">(</code><code class="n">X509Certificate</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">chain</code><code class="o">,</code><code>
</code><code>                                       </code><code class="n">String</code><code> </code><code class="n">authType</code><code class="o">)</code><code>
</code><code>          </code><code class="kd">throws</code><code> </code><code class="n">CertificateException</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>
</code><code>        </code><code class="nd">@Override</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">checkClientTrusted</code><code class="o">(</code><code class="n">X509Certificate</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">chain</code><code class="o">,</code><code>
</code><code>                                       </code><code class="n">String</code><code> </code><code class="n">authType</code><code class="o">)</code><code>
</code><code>          </code><code class="kd">throws</code><code> </code><code class="n">CertificateException</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>
</code><code>        </code><code class="nd">@Override</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">checkServerTrusted</code><code class="o">(</code><code class="n">X509Certificate</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">chain</code><code class="o">,</code><code>
</code><code>                                      </code><code class="n">String</code><code> </code><code class="n">authType</code><code class="o">,</code><code>
</code><code>                                      </code><code class="n">SSLEngine</code><code> </code><code class="n">sslEngine</code><code class="o">)</code><code>
</code><code>          </code><code class="kd">throws</code><code> </code><code class="n">CertificateException</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>
</code><code>        </code><code class="nd">@Override</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">checkServerTrusted</code><code class="o">(</code><code class="n">X509Certificate</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">chain</code><code class="o">,</code><code>
</code><code>                                       </code><code class="n">String</code><code> </code><code class="n">authType</code><code class="o">,</code><code>
</code><code>                                       </code><code class="n">Socket</code><code> </code><code class="n">socket</code><code class="o">)</code><code>
</code><code>          </code><code class="kd">throws</code><code> </code><code class="n">CertificateException</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>
</code><code>        </code><code class="nd">@Override</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">checkClientTrusted</code><code class="o">(</code><code class="n">X509Certificate</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">chain</code><code class="o">,</code><code>
</code><code>                                       </code><code class="n">String</code><code> </code><code class="n">authType</code><code class="o">,</code><code>
</code><code>                                       </code><code class="n">SSLEngine</code><code> </code><code class="n">sslEngine</code><code class="o">)</code><code>
</code><code>          </code><code class="kd">throws</code><code> </code><code class="n">CertificateException</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>
</code><code>        </code><code class="nd">@Override</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">checkClientTrusted</code><code class="o">(</code><code class="n">X509Certificate</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">chain</code><code class="o">,</code><code>
</code><code>                                       </code><code class="n">String</code><code> </code><code class="n">authType</code><code class="o">,</code><code>
</code><code>                                       </code><code class="n">Socket</code><code> </code><code class="n">socket</code><code class="o">)</code><code>
</code><code>          </code><code class="kd">throws</code><code> </code><code class="n">CertificateException</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>      </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_quarkus_rest_clients_CO16-1" href="#co_quarkus_rest_clients_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Creates a CDI bean; you need to use <code>@Inject</code> instead of <code>@RestClient</code> to make use of it</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO16-2" href="#co_quarkus_rest_clients_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Disable host verification</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO16-3" href="#co_quarkus_rest_clients_CO16-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Trust all certificates without doing any verification</p></dd>
<dt><a class="co" id="callout_quarkus_rest_clients_CO16-4" href="#co_quarkus_rest_clients_CO16-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Customize <code>SSLContext</code> with an empty trust manager, effectively negating all SSL checks</p></dd>
</dl>

<p>Then if you inject this instance instead of the production one, every HTTPS request is valid independently of the certificate used by the external service<a data-type="indexterm" data-primary="" data-startref="rest_ch" id="idm45128493901336"/><a data-type="indexterm" data-primary="" data-startref="rest_ssl" id="idm45128493900472"/><a data-type="indexterm" data-primary="" data-startref="ssl_rest" id="idm45128496210584"/>.</p>
</div></section>





</div></section>







</div></section></div>



  </body></html>