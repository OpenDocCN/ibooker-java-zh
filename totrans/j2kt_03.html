<html><head></head><body><section data-pdf-bookmark="Chapter 3. Java to Kotlin Classes" data-type="chapter" epub:type="chapter"><div class="chapter" id="java-to-kotlin-classes">&#13;
<h1><span class="label">Chapter 3. </span>Java to Kotlin Classes</h1>&#13;
&#13;
<blockquote data-type="epigraph" epub:type="epigraph">&#13;
<p>The class is the basic unit of code organization in Java.&#13;
How do we convert our Java classes to Kotlin, and what differences will we see when we have?</p>&#13;
</blockquote>&#13;
&#13;
<p>In this book, we’ll work together on the code in Travelator, our fictional trip-planning web app.&#13;
Imagine that we have a feature to implement, but we want to take the opportunity to make our code a little better before we do.&#13;
You’re pairing with one of Nat or Duncan (choose your favorite, just don’t let Nat know).&#13;
The pair is the <em>we</em> in our refactoring discussions; not just your author, but also you as part of the team working on Travelator.&#13;
Welcome aboard!</p>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm46393419135896">&#13;
<h5>Source Code</h5>&#13;
<p>We<a data-primary="code examples, obtaining and using" data-type="indexterm" id="idm46393419134568"/> have published the Travelator source code in a public Git repository.&#13;
<a data-type="xref" href="preface01.html#using-code-examples">“Using Code Examples”</a> details how to access it.</p>&#13;
&#13;
<p>Because this book is about refactoring, the important details are the changes, both between single commits and over longer intervals.&#13;
We have tried to show everything you need to make sense of the code here in print; it helps to imagine that the last code sample shown is in the active editor pane as we talk about the changes we are about to make.&#13;
If we have failed to make it make sense, or you just feel the need for more detail, then you can check out the code and follow along in IntelliJ.</p>&#13;
</div></aside>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="A Simple Value Type" data-type="sect1"><div class="sect1" id="idm46393419131784">&#13;
<h1>A Simple Value Type</h1>&#13;
&#13;
<p>Let’s<a data-primary="Java Way to Kotlin Way" data-secondary="Java class conversion example" data-type="indexterm" id="JWKWemail02"/><a data-primary="EmailAddress conversion example" data-type="indexterm" id="emailconv02"/><a data-primary="data classes" data-secondary="simple value type conversion example" data-type="indexterm" id="DCconv02"/> jump into the deep end of the codebase and convert some of our existing Java to Kotlin, starting with <code>EmailAddress</code>.&#13;
This is a value type that holds the two parts of, you guessed it, an email address:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">EmailAddress</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">localPart</code><code class="o">;</code><code> </code><a class="co" href="#callout_introduction_CO1-1" id="co_introduction_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">domain</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="n">EmailAddress</code><code> </code><code class="nf">parse</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">value</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO1-2" id="co_introduction_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">var</code><code> </code><code class="n">atIndex</code><code> </code><code class="o">=</code><code> </code><code class="n">value</code><code class="o">.</code><code class="na">lastIndexOf</code><code class="o">(</code><code class="sc">'@'</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">atIndex</code><code> </code><code class="o">&lt;</code><code> </code><code class="mi">1</code><code> </code><code class="o">|</code><code class="o">|</code><code> </code><code class="n">atIndex</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="n">value</code><code class="o">.</code><code class="na">length</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code> </code><code class="mi">1</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nf">IllegalArgumentException</code><code class="o">(</code><code>&#13;
</code><code>                </code><code class="s">"EmailAddress must be two parts separated by @"</code><code>&#13;
</code><code>            </code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="k">new</code><code> </code><code class="nf">EmailAddress</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="n">value</code><code class="o">.</code><code class="na">substring</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code><code> </code><code class="n">atIndex</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">value</code><code class="o">.</code><code class="na">substring</code><code class="o">(</code><code class="n">atIndex</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="o">)</code><code>&#13;
</code><code>        </code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="nf">EmailAddress</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">localPart</code><code class="o">,</code><code> </code><code class="n">String</code><code> </code><code class="n">domain</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO1-3" id="co_introduction_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">localPart</code><code> </code><code class="o">=</code><code> </code><code class="n">localPart</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">domain</code><code> </code><code class="o">=</code><code> </code><code class="n">domain</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getLocalPart</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO1-4" id="co_introduction_CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">localPart</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getDomain</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO1-4" id="co_introduction_CO1-5"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">domain</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Override</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">boolean</code><code> </code><code class="nf">equals</code><code class="o">(</code><code class="n">Object</code><code> </code><code class="n">o</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO1-5" id="co_introduction_CO1-6"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="k">this</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="n">o</code><code class="o">)</code><code> </code><code class="k">return</code><code> </code><code class="kc">true</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">o</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="kc">null</code><code> </code><code class="o">|</code><code class="o">|</code><code> </code><code class="n">getClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="n">o</code><code class="o">.</code><code class="na">getClass</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code> </code><code class="k">return</code><code> </code><code class="kc">false</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">EmailAddress</code><code> </code><code class="n">that</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">EmailAddress</code><code class="o">)</code><code> </code><code class="n">o</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">localPart</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">that</code><code class="o">.</code><code class="na">localPart</code><code class="o">)</code><code> </code><code class="o">&amp;</code><code class="o">&amp;</code><code>&#13;
</code><code>            </code><code class="n">domain</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">that</code><code class="o">.</code><code class="na">domain</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Override</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="nf">hashCode</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO1-5" id="co_introduction_CO1-7"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">Objects</code><code class="o">.</code><code class="na">hash</code><code class="o">(</code><code class="n">localPart</code><code class="o">,</code><code> </code><code class="n">domain</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Override</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">toString</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO1-6" id="co_introduction_CO1-8"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">localPart</code><code> </code><code class="o">+</code><code> </code><code class="s">"@"</code><code> </code><code class="o">+</code><code> </code><code class="n">domain</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.1&amp;show=file">Example 3.1 [classes.0:src/main/java/travelator/EmailAddress.java]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.1&amp;show=diff">(diff)</a>&#13;
</div>&#13;
&#13;
<p>This class is very simple; it does nothing more than wrap two strings and provides no operations of its own.&#13;
Even so, it has a lot of code:</p>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_CO1-1" id="callout_introduction_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Values are immutable, so the class declares its fields as final.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO1-2" id="callout_introduction_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>There is a static factory method to <code>parse</code> an <code>EmailAddress</code> from a string; this calls the primary constructor.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO1-3" id="callout_introduction_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The fields are initialized in a constructor.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO1-4" id="callout_introduction_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>The accessor methods of its properties follow the JavaBean naming conventions.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO1-6" id="callout_introduction_CO1-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>The class implements the <code>equals</code> and <code>hashCode</code> methods to ensure that two &#13;
<span class="keep-together"><code>EmailAddress</code></span> values with equal fields compare as equal.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO1-8" id="callout_introduction_CO1-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p><code>toString</code> returns the canonical form.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Your authors come from the school of Java that assumes that everything we pass, store, or return is not null unless explicitly indicated otherwise.&#13;
You can’t see that convention, because it results in an absence of <code>@Nullable</code> annotations or null checks of parameters (<a data-type="xref" href="ch04.html#optional-to-nullable">Chapter 4</a> discusses nullability).&#13;
What you <em>can</em> see is the amount of<a data-primary="boilerplate code" data-type="indexterm" id="idm46393418644520"/> boilerplate code required to express a value composed of two other values.&#13;
Happily, our IDE generated the <code>equals</code> and <code>hashCode</code> methods for us, but we have to remember to delete and regenerate those methods if we change the fields of the class to avoid confusing bugs.</p>&#13;
&#13;
<p>So much for the Java; we’re here for the Kotlin.&#13;
How do we convert?&#13;
Helpfully, IntelliJ<a data-primary="IntelliJ IDE" data-secondary="Convert Java File to Kotlin File action" data-type="indexterm" id="idm46393418932616"/> has an action called “Convert Java File to Kotlin File”.&#13;
When we invoke it, IntelliJ offers to change other files if necessary to keep things consistent.&#13;
Because the conversion can potentially modify files throughout the project, it’s best to say yes.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>Make sure you have no uncommitted changes before converting Java source to Kotlin so that you can easily see the impact of the conversion on the rest of your codebase and revert the conversion if it does something you didn’t expect.</p>&#13;
</div>&#13;
&#13;
<p>In this case, IntelliJ doesn’t have to change any other files.&#13;
It has replaced our &#13;
<span class="keep-together"><em>EmailAddress.java</em></span> file with <em>EmailAddress.kt</em> in the same directory, though:</p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">EmailAddress</code><code class="p">(</code><code class="k">val</code> <code class="py">localPart</code><code class="p">:</code> <code class="n">String</code><code class="p">,</code> <code class="k">val</code> <code class="py">domain</code><code class="p">:</code> <code class="n">String</code><code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">equals</code><code class="p">(</code><code class="n">o</code><code class="p">:</code> <code class="n">Any</code><code class="p">?):</code> <code class="n">Boolean</code> <code class="p">{</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="k">this</code> <code class="p">===</code> <code class="n">o</code><code class="p">)</code> <code class="k">return</code> <code class="k">true</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="n">o</code> <code class="p">==</code> <code class="k">null</code> <code class="p">||</code> <code class="n">javaClass</code> <code class="p">!=</code> <code class="n">o</code><code class="p">.</code><code class="n">javaClass</code><code class="p">)</code> <code class="k">return</code> <code class="k">false</code>&#13;
        <code class="k">val</code> <code class="py">that</code> <code class="p">=</code> <code class="n">o</code> <code class="k">as</code> <code class="n">EmailAddress</code>&#13;
        <code class="k">return</code> <code class="n">localPart</code> <code class="p">==</code> <code class="n">that</code><code class="p">.</code><code class="n">localPart</code> <code class="p">&amp;&amp;</code> <code class="n">domain</code> <code class="p">==</code> <code class="n">that</code><code class="p">.</code><code class="n">domain</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">hashCode</code><code class="p">():</code> <code class="n">Int</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="n">Objects</code><code class="p">.</code><code class="n">hash</code><code class="p">(</code><code class="n">localPart</code><code class="p">,</code> <code class="n">domain</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">toString</code><code class="p">():</code> <code class="n">String</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="s">"$localPart@$domain"</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="n">companion</code> <code class="k">object</code> <code class="err">{</code>&#13;
        <code class="n">@JvmStatic</code>&#13;
        <code class="k">fun</code> <code class="nf">parse</code><code class="p">(</code><code class="n">value</code><code class="p">:</code> <code class="n">String</code><code class="p">):</code> <code class="n">EmailAddress</code> <code class="p">{</code>&#13;
            <code class="k">val</code> <code class="py">atIndex</code> <code class="p">=</code> <code class="n">value</code><code class="p">.</code><code class="n">lastIndexOf</code><code class="p">(</code><code class="sc">'@'</code><code class="p">)</code>&#13;
            <code class="n">require</code><code class="p">(!(</code><code class="n">atIndex</code> <code class="p">&lt;</code> <code class="m">1</code> <code class="p">||</code> <code class="n">atIndex</code> <code class="p">==</code> <code class="n">value</code><code class="p">.</code><code class="n">length</code> <code class="p">-</code> <code class="m">1</code><code class="p">))</code> <code class="p">{</code>&#13;
                <code class="s">"EmailAddress must be two parts separated by @"</code>&#13;
            <code class="p">}</code>&#13;
            <code class="k">return</code> <code class="n">EmailAddress</code><code class="p">(</code>&#13;
                <code class="n">value</code><code class="p">.</code><code class="n">substring</code><code class="p">(</code><code class="m">0</code><code class="p">,</code> <code class="n">atIndex</code><code class="p">),</code>&#13;
                <code class="n">value</code><code class="p">.</code><code class="n">substring</code><code class="p">(</code><code class="n">atIndex</code> <code class="p">+</code> <code class="m">1</code><code class="p">)</code>&#13;
            <code class="p">)</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.2&amp;show=file">Example 3.2 [classes.2:src/main/java/travelator/EmailAddress.kt]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.2&amp;show=diff">(diff)</a>&#13;
</div>&#13;
&#13;
<p>The Kotlin class is noticeably more succinct because it declares its properties in the primary constructor: the parameters after the class name.&#13;
Parameters marked <code>val</code> are considered properties and so stand in for all this Java:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">private</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">localPart</code><code class="o">;</code>&#13;
<code class="kd">private</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">domain</code><code class="o">;</code>&#13;
&#13;
<code class="kd">public</code> <code class="nf">EmailAddress</code><code class="o">(</code><code class="n">String</code> <code class="n">localPart</code><code class="o">,</code> <code class="n">String</code> <code class="n">domain</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="k">this</code><code class="o">.</code><code class="na">localPart</code> <code class="o">=</code> <code class="n">localPart</code><code class="o">;</code>&#13;
    <code class="k">this</code><code class="o">.</code><code class="na">domain</code> <code class="o">=</code> <code class="n">domain</code><code class="o">;</code>&#13;
<code class="o">}</code>&#13;
&#13;
<code class="kd">public</code> <code class="n">String</code> <code class="nf">getLocalPart</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">localPart</code><code class="o">;</code>&#13;
<code class="o">}</code>&#13;
&#13;
<code class="kd">public</code> <code class="n">String</code> <code class="nf">getDomain</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">domain</code><code class="o">;</code>&#13;
<code class="o">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.3&amp;show=file">Example 3.3 [classes.1:src/main/java/travelator/EmailAddress.java]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.3&amp;show=diff">(diff)</a>&#13;
</div>&#13;
&#13;
<p>The primary constructor syntax is convenient, but it does interfere with the scanability of the class.&#13;
Java classes<a data-primary="Java" data-secondary="standard coding conventions" data-type="indexterm" id="idm46393410762072"/> that follow the standard coding conventions always define their elements in the same order: class name, superclass, interfaces, and then, within the class body, fields, constructors, and methods.&#13;
This makes it easy to skim-read the class and quickly locate the features you’re interested in.</p>&#13;
&#13;
<p>It’s not quite so easy to find the parts of a Kotlin class.&#13;
A<a data-primary="Kotlin" data-secondary="class definition" data-type="indexterm" id="idm46393410760312"/> Kotlin class definition has a header part with the class name, primary constructor (which can contain parameters and/or property definitions), superclass (which may also be the call to the superclass’s constructor), and interfaces.&#13;
Then, within the class body, there are more properties and more constructors, methods, and companion objects.</p>&#13;
&#13;
<p>Coming from Java, Nat and Duncan definitely found it harder to read classes at first, and although we got used to it eventually, we still find it hard at times to format classes for maximum readability, especially if there is a lot going on in the header part.&#13;
One easy fix is to lay out the constructor parameter list line by line.&#13;
With the cursor inside the parameter list, we can do that with Alt-Enter and “Put parameters on separate lines”.&#13;
Sometimes a blank line after the header part helps, too:</p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">EmailAddress</code><code class="p">(</code>&#13;
    <code class="k">val</code> <code class="py">localPart</code><code class="p">:</code> <code class="n">String</code><code class="p">,</code>&#13;
    <code class="k">val</code> <code class="py">domain</code><code class="p">:</code> <code class="n">String</code>&#13;
<code class="p">)</code> <code class="p">{</code>&#13;
&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">equals</code><code class="p">(</code><code class="n">o</code><code class="p">:</code> <code class="n">Any</code><code class="p">?):</code> <code class="n">Boolean</code> <code class="p">{</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="k">this</code> <code class="p">===</code> <code class="n">o</code><code class="p">)</code> <code class="k">return</code> <code class="k">true</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="n">o</code> <code class="p">==</code> <code class="k">null</code> <code class="p">||</code> <code class="n">javaClass</code> <code class="p">!=</code> <code class="n">o</code><code class="p">.</code><code class="n">javaClass</code><code class="p">)</code> <code class="k">return</code> <code class="k">false</code>&#13;
        <code class="k">val</code> <code class="py">that</code> <code class="p">=</code> <code class="n">o</code> <code class="k">as</code> <code class="n">EmailAddress</code>&#13;
        <code class="k">return</code> <code class="n">localPart</code> <code class="p">==</code> <code class="n">that</code><code class="p">.</code><code class="n">localPart</code> <code class="p">&amp;&amp;</code> <code class="n">domain</code> <code class="p">==</code> <code class="n">that</code><code class="p">.</code><code class="n">domain</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">hashCode</code><code class="p">():</code> <code class="n">Int</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="n">Objects</code><code class="p">.</code><code class="n">hash</code><code class="p">(</code><code class="n">localPart</code><code class="p">,</code> <code class="n">domain</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">toString</code><code class="p">():</code> <code class="n">String</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="s">"$localPart@$domain"</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="n">companion</code> <code class="k">object</code> <code class="err">{</code>&#13;
        <code class="n">@JvmStatic</code>&#13;
        <code class="k">fun</code> <code class="nf">parse</code><code class="p">(</code><code class="n">value</code><code class="p">:</code> <code class="n">String</code><code class="p">):</code> <code class="n">EmailAddress</code> <code class="p">{</code>&#13;
            <code class="k">val</code> <code class="py">atIndex</code> <code class="p">=</code> <code class="n">value</code><code class="p">.</code><code class="n">lastIndexOf</code><code class="p">(</code><code class="sc">'@'</code><code class="p">)</code>&#13;
            <code class="n">require</code><code class="p">(!(</code><code class="n">atIndex</code> <code class="p">&lt;</code> <code class="m">1</code> <code class="p">||</code> <code class="n">atIndex</code> <code class="p">==</code> <code class="n">value</code><code class="p">.</code><code class="n">length</code> <code class="p">-</code> <code class="m">1</code><code class="p">))</code> <code class="p">{</code>&#13;
                <code class="s">"EmailAddress must be two parts separated by @"</code>&#13;
            <code class="p">}</code>&#13;
            <code class="k">return</code> <code class="n">EmailAddress</code><code class="p">(</code>&#13;
                <code class="n">value</code><code class="p">.</code><code class="n">substring</code><code class="p">(</code><code class="m">0</code><code class="p">,</code> <code class="n">atIndex</code><code class="p">),</code>&#13;
                <code class="n">value</code><code class="p">.</code><code class="n">substring</code><code class="p">(</code><code class="n">atIndex</code> <code class="p">+</code> <code class="m">1</code><code class="p">)</code>&#13;
            <code class="p">)</code>&#13;
        <code class="p">}</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.4&amp;show=file">Example 3.4 [classes.3:src/main/java/travelator/EmailAddress.kt]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.4&amp;show=diff">(diff)</a>&#13;
</div>&#13;
&#13;
<p class="pagebreak-before">One<a data-primary="parse() method" data-type="indexterm" id="idm46393410511208"/> place where Kotlin is noticeably less succinct than Java is where it uses companion objects to host static state and methods, in this case <code>parse()</code>.&#13;
In Kotlin, we often prefer top-level state and functions to these class-scoped members.&#13;
<a data-type="xref" href="ch08.html#static-methods-to-top-level-functions">Chapter 8</a> discusses the pros and cons.</p>&#13;
&#13;
<p>We currently have Java code that uses the static method, for example, the tests:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">EmailAddressTests</code> <code class="o">{</code>&#13;
&#13;
    <code class="nd">@Test</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">parsing</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">assertEquals</code><code class="o">(</code>&#13;
            <code class="k">new</code> <code class="nf">EmailAddress</code><code class="o">(</code><code class="s">"fred"</code><code class="o">,</code> <code class="s">"example.com"</code><code class="o">),</code>&#13;
            <code class="n">EmailAddress</code><code class="o">.</code><code class="na">parse</code><code class="o">(</code><code class="s">"fred@example.com"</code><code class="o">)</code>&#13;
        <code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="nd">@Test</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">parsingFailures</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">assertThrows</code><code class="o">(</code>&#13;
            <code class="n">IllegalArgumentException</code><code class="o">.</code><code class="na">class</code><code class="o">,</code>&#13;
            <code class="o">()</code> <code class="o">-&gt;</code> <code class="n">EmailAddress</code><code class="o">.</code><code class="na">parse</code><code class="o">(</code><code class="s">"@"</code><code class="o">)</code>&#13;
        <code class="o">);</code>&#13;
        <code class="o">...</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="o">...</code>&#13;
<code class="o">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.5&amp;show=file">Example 3.5 [classes.0:src/test/java/travelator/EmailAddressTests.java]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.5&amp;show=diff">(diff)</a>&#13;
</div>&#13;
&#13;
<p>The companion object, combined with the <code>@JVMStatic</code> annotation, means this didn’t have to change when we converted the class to Kotlin, so we’ll leave <code>parse</code> as it is for now.&#13;
We’ll discuss how to refactor to top-level functions in <a data-type="xref" href="ch08.html#static-methods-to-top-level-functions">Chapter 8</a>.</p>&#13;
&#13;
<p>If you’re new to Kotlin, you may wonder what happened to the <code>getLocalPart()</code> and <code>getDomain()</code> accessor methods.&#13;
Declaring<a data-primary="domain field" data-type="indexterm" id="idm46393410447704"/> the <code>domain</code> property causes the compiler to generate a private <code>domain</code> field and a <code>getDomain()</code> method so that Java code can still call it.&#13;
Here is a little throwaway code to support a marketing plan:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Marketing</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">boolean</code> <code class="nf">isHotmailAddress</code><code class="o">(</code><code class="n">EmailAddress</code> <code class="n">address</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">address</code><code class="o">.</code><code class="na">getDomain</code><code class="o">().</code><code class="na">equalsIgnoreCase</code><code class="o">(</code><code class="s">"hotmail.com"</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.6&amp;show=file">Example 3.6 [classes.3:src/main/java/travelator/Marketing.java]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.6&amp;show=diff">(diff)</a>&#13;
</div>&#13;
&#13;
<p class="pagebreak-before">You can see that Java is accessing the domain property through the <code>getDomain()</code> method.&#13;
Conversely, when the class was Java and had an explicit <code>getDomain()</code> method, Kotlin code could have called it as <code>address.domain</code>.&#13;
We’ll discuss properties in more detail in <a data-type="xref" href="ch11.html#methods-to-properties">Chapter 11</a>.</p>&#13;
&#13;
<p>So far, converting our class to Kotlin has saved us 14 lines of code, but we aren’t done yet.&#13;
Value types like this are so useful, but so tedious to get right and keep right, that Kotlin supports them at a language level.&#13;
If we mark the class with the <code>data</code> modifier, the compiler generates any undefined <code>equals</code>, <code>hashCode</code>, and <code>toString</code> methods for us.&#13;
That reduces the <code>EmailAddress</code> class to:</p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="n">data</code><code> </code><code class="k">class</code><code> </code><code class="nc">EmailAddress</code><code class="p">(</code><code>&#13;
</code><code>    </code><code class="k">val</code><code> </code><code class="py">localPart</code><code class="p">:</code><code> </code><code class="n">String</code><code class="p">,</code><code>&#13;
</code><code>    </code><code class="k">val</code><code> </code><code class="py">domain</code><code class="p">:</code><code> </code><code class="n">String</code><code>&#13;
</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">override</code><code> </code><code class="k">fun</code><code> </code><code class="nf">toString</code><code class="p">(</code><code class="p">)</code><code class="p">:</code><code> </code><code class="n">String</code><code> </code><code class="p">{</code><code> </code><a class="co" href="#callout_introduction_CO2-1" id="co_introduction_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="s">"$localPart@$domain"</code><code>&#13;
</code><code>    </code><code class="p">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">companion</code><code> </code><code class="k">object</code><code> </code><code class="err">{</code><code>&#13;
</code><code>        </code><code class="n">@JvmStatic</code><code>&#13;
</code><code>        </code><code class="k">fun</code><code> </code><code class="nf">parse</code><code class="p">(</code><code class="n">value</code><code class="p">:</code><code> </code><code class="n">String</code><code class="p">)</code><code class="p">:</code><code> </code><code class="n">EmailAddress</code><code> </code><code class="p">{</code><code>&#13;
</code><code>            </code><code class="k">val</code><code> </code><code class="py">atIndex</code><code> </code><code class="p">=</code><code> </code><code class="n">value</code><code class="p">.</code><code class="n">lastIndexOf</code><code class="p">(</code><code class="sc">'@'</code><code class="p">)</code><code>&#13;
</code><code>            </code><code class="n">require</code><code class="p">(</code><code class="p">!</code><code class="p">(</code><code class="n">atIndex</code><code> </code><code class="p">&lt;</code><code> </code><code class="m">1</code><code> </code><code class="p">|</code><code class="p">|</code><code> </code><code class="n">atIndex</code><code> </code><code class="p">=</code><code class="p">=</code><code> </code><code class="n">value</code><code class="p">.</code><code class="n">length</code><code> </code><code class="p">-</code><code> </code><code class="m">1</code><code class="p">)</code><code class="p">)</code><code> </code><code class="p">{</code><code>&#13;
</code><code>                </code><code class="s">"EmailAddress must be two parts separated by @"</code><code>&#13;
</code><code>            </code><code class="p">}</code><code>&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="n">EmailAddress</code><code class="p">(</code><code>&#13;
</code><code>                </code><code class="n">value</code><code class="p">.</code><code class="n">substring</code><code class="p">(</code><code class="m">0</code><code class="p">,</code><code> </code><code class="n">atIndex</code><code class="p">)</code><code class="p">,</code><code>&#13;
</code><code>                </code><code class="n">value</code><code class="p">.</code><code class="n">substring</code><code class="p">(</code><code class="n">atIndex</code><code> </code><code class="p">+</code><code> </code><code class="m">1</code><code class="p">)</code><code>&#13;
</code><code>            </code><code class="p">)</code><code>&#13;
</code><code>        </code><code class="p">}</code><code>&#13;
</code><code>    </code><code class="p">}</code><code>&#13;
</code><code class="p">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.7&amp;show=file">Example 3.7 [classes.4:src/main/java/travelator/EmailAddress.kt]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.7&amp;show=diff">(diff)</a>&#13;
</div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_CO2-1" id="callout_introduction_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We don’t want the generated <code>toString()</code> method, so we define the one we do want.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Frankly, that <code>parse</code> method still rankles; it’s taking up a disproportionate amount of space for the work it is doing.&#13;
We’ll finally relieve this tension in <a data-type="xref" href="ch09.html#multi-to-single-expression-functions">Chapter 9</a>.&#13;
For now, though, we’re done with converting our <code>EmailAddress</code> Java class to Kotlin.<a data-primary="" data-startref="JWKWemail02" data-type="indexterm" id="idm46393410073560"/><a data-primary="" data-startref="emailconv02" data-type="indexterm" id="idm46393410072552"/><a data-primary="" data-startref="DCconv02" data-type="indexterm" id="idm46393410071608"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="The Limitations of Data Classes" data-type="sect1"><div class="sect1" id="idm46393419130840">&#13;
<h1>The Limitations of Data Classes</h1>&#13;
&#13;
<p>A<a data-primary="data classes" data-secondary="limitations of" data-type="indexterm" id="DClimit02"/><a data-primary="Java Way to Kotlin Way" data-secondary="data class limitations" data-type="indexterm" id="JWKQclasslim02"/> drawback of data classes is that they offer no encapsulation.&#13;
We saw how the compiler generates <code>equals</code>, <code>hashCode</code>, and <code>toString</code> methods for data classes but didn’t mention that it also generates a<a data-primary="copy method" data-type="indexterm" id="idm46393410064440"/> <code>copy</code> method that creates a new copy of the value with different values for one or more of its properties.</p>&#13;
&#13;
<p>For example, the following code creates a copy of an <code>EmailAddress</code> with a <code>localPart</code> of “postmaster” and the same domain:</p>&#13;
&#13;
<pre data-type="programlisting">val postmasterEmail = customerEmail.copy(localPart = "postmaster")</pre>&#13;
&#13;
<p>For many types, this is very convenient.&#13;
However, when a class abstracts its internal representation or maintains invariants between its properties, that <code>copy</code> method allows client code direct access to the internal state of a value, which can break its invariants.</p>&#13;
&#13;
<p>Let’s look at an abstract data type in the Travelator application, the <code>Money</code> class:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">Money</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="kd">final</code><code> </code><code class="n">BigDecimal</code><code> </code><code class="n">amount</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="kd">final</code><code> </code><code class="n">Currency</code><code> </code><code class="n">currency</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="nf">Money</code><code class="o">(</code><code class="n">BigDecimal</code><code> </code><code class="n">amount</code><code class="o">,</code><code> </code><code class="n">Currency</code><code> </code><code class="n">currency</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO3-1" id="co_introduction_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">amount</code><code> </code><code class="o">=</code><code> </code><code class="n">amount</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">currency</code><code> </code><code class="o">=</code><code> </code><code class="n">currency</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="n">Money</code><code> </code><code class="nf">of</code><code class="o">(</code><code class="n">BigDecimal</code><code> </code><code class="n">amount</code><code class="o">,</code><code> </code><code class="n">Currency</code><code> </code><code class="n">currency</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO3-1" id="co_introduction_CO3-2"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="k">new</code><code> </code><code class="nf">Money</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="n">amount</code><code class="o">.</code><code class="na">setScale</code><code class="o">(</code><code class="n">currency</code><code class="o">.</code><code class="na">getDefaultFractionDigits</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">currency</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code> </code><code class="n">and</code><code> </code><code class="n">convenience</code><code> </code><code class="n">overloads</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">BigDecimal</code><code> </code><code class="nf">getAmount</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO3-2" id="co_introduction_CO3-3"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">amount</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">Currency</code><code> </code><code class="nf">getCurrency</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO3-3" id="co_introduction_CO3-4"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">currency</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Override</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">boolean</code><code> </code><code class="nf">equals</code><code class="o">(</code><code class="n">Object</code><code> </code><code class="n">o</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO3-3" id="co_introduction_CO3-5"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="k">this</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="n">o</code><code class="o">)</code><code> </code><code class="k">return</code><code> </code><code class="kc">true</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">o</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="kc">null</code><code> </code><code class="o">|</code><code class="o">|</code><code> </code><code class="n">getClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="n">o</code><code class="o">.</code><code class="na">getClass</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code> </code><code class="k">return</code><code> </code><code class="kc">false</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">Money</code><code> </code><code class="n">money</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">Money</code><code class="o">)</code><code> </code><code class="n">o</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">amount</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">money</code><code class="o">.</code><code class="na">amount</code><code class="o">)</code><code> </code><code class="o">&amp;</code><code class="o">&amp;</code><code>&#13;
</code><code>            </code><code class="n">currency</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">money</code><code class="o">.</code><code class="na">currency</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Override</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="nf">hashCode</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO3-3" id="co_introduction_CO3-6"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">Objects</code><code class="o">.</code><code class="na">hash</code><code class="o">(</code><code class="n">amount</code><code class="o">,</code><code> </code><code class="n">currency</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Override</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">toString</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO3-4" id="co_introduction_CO3-7"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="n">amount</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">+</code><code> </code><code class="s">" "</code><code> </code><code class="o">+</code><code> </code><code class="n">currency</code><code class="o">.</code><code class="na">getCurrencyCode</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">Money</code><code> </code><code class="nf">add</code><code class="o">(</code><code class="n">Money</code><code> </code><code class="n">that</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_introduction_CO3-5" id="co_introduction_CO3-8"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="o">!</code><code class="k">this</code><code class="o">.</code><code class="na">currency</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">that</code><code class="o">.</code><code class="na">currency</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>            </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nf">IllegalArgumentException</code><code class="o">(</code><code>&#13;
</code><code>                </code><code class="s">"cannot add Money values of different currencies"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="k">new</code><code> </code><code class="nf">Money</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">amount</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">that</code><code class="o">.</code><code class="na">amount</code><code class="o">)</code><code class="o">,</code><code> </code><code class="k">this</code><code class="o">.</code><code class="na">currency</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.8&amp;show=file">Example 3.8 [values.4:src/main/java/travelator/money/Money.java]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.8&amp;show=diff">(diff)</a>&#13;
</div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_introduction_CO3-1" id="callout_introduction_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The constructor is private.&#13;
Other classes obtain <code>Money</code> values by calling the static <code>Money.of</code> method, which guarantees that the scale of the amount is consistent with the number of minor units of the currency.&#13;
Most currencies have one hundred minor units (two digits), but some have fewer and some more. For example, the Japanese yen has no minor units, and the Jordanian dinar is made up of one thousand fils.</p>&#13;
&#13;
<p>The <code>of</code> method follows a coding convention of <a href="ch01.html#modern-java-style">Modern Java</a> that draws a distinction in the source between objects with identity, which are constructed by the new operator, and values, which are obtained from static methods.&#13;
This convention is followed by the Java time API (for example, <code>LocalDate.of(2020,8,17)</code>) and recent additions to the collections API (for example, <code>List.of(1,2,3)</code> creates an immutable list).</p>&#13;
&#13;
<p>The class provides some convenient overloads of the <code>of</code> method for String or int amounts.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO3-3" id="callout_introduction_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>A <code>Money</code> value exposes its amount and currency properties using JavaBean conventions, even though it is not actually a JavaBean.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO3-4" id="callout_introduction_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The <code>equals</code> and <code>hashCode</code> methods implement value semantics.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO3-7" id="callout_introduction_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>The <code>toString</code> method returns a representation of its properties that can be shown to the user, not just for debugging.</p></dd>&#13;
<dt><a class="co" href="#co_introduction_CO3-8" id="callout_introduction_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p><code>Money</code> provides operations for calculating with money values.&#13;
For example, you can add monetary values together.&#13;
The <code>add</code> method constructs new <code>Money</code> values by calling the constructor directly (rather than using <code>Money.of</code>), because the result of <code>BigDecimal.add</code> already has the correct scale, so we can avoid the overhead of setting the scale in <code>Money.of</code>.</p></dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The method <code>BigDecimal.setScale</code> is confusing.&#13;
Although named like a JavaBean setter, it does not actually mutate the BigDecimal object.&#13;
Like our <code>EmailAddress</code> and <code>Money</code> classes, <code>BigDecimal</code> is an immutable value type, so <code>setScale</code> returns a new <code>BigDecimal</code> value with the specified scale.</p>&#13;
&#13;
<p>Sun<a data-primary="JavaBeans" data-type="indexterm" id="idm46393409836072"/> added the <code>BigDecimal</code> class to the standard library in Java 1.1. This release also included the first version of the JavaBeans API. The hype around the Beans API popularized the JavaBeans coding conventions, and they were widely adopted, even for classes that, like <code>BigDecimal</code>, were not JavaBeans (see <a data-type="xref" href="ch01.html#bean-java-style">“Bean Style”</a>).&#13;
There were no Java conventions for value types.</p>&#13;
&#13;
<p>Today, we<a data-primary="transformations" data-secondary="methods returning a transformation of the receiver" data-type="indexterm" id="idm46393409849608"/> avoid the “set” prefix for methods that do not mutate their receiver and instead use names that emphasize when the method returns a transformation of the receiver.&#13;
A common convention is to use the prefix “with” for transformations that affect a single property, which would make the code in our <code>Money</code> class read as:</p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"> <code class="n">amount</code><code class="p">.</code><code class="n">withScale</code><code class="p">(</code><code class="n">currency</code><code class="p">.</code><code class="n">getDefaultFractionDigits</code><code class="p">())</code></pre>&#13;
&#13;
<p>In Kotlin we can write extension functions to fix such historical accidents.&#13;
If we were writing a lot of code that calculated with <code>BigDecimal</code>s, it might be worth doing so to improve the clarity of the code:</p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">fun</code> <code class="nf">BigDecimal</code><code class="p">.</code><code class="n">withScale</code><code class="p">(</code><code class="n">int</code> <code class="n">scale</code><code class="p">,</code> <code class="n">RoundingMode</code> <code class="n">mode</code><code class="p">)</code> <code class="p">=</code>&#13;
    <code class="n">setScale</code><code class="p">(</code><code class="n">scale</code><code class="p">,</code> <code class="n">mode</code><code class="p">)</code></pre>&#13;
</div>&#13;
&#13;
<p>Converting <code>Money</code> to Kotlin produces the following code:</p>&#13;
&#13;
<pre data-code-language="kotlin" data-type="programlisting"><code class="k">class</code> <code class="nc">Money</code>&#13;
<code class="k">private</code> <code class="n">constructor</code><code class="p">(</code>&#13;
    <code class="k">val</code> <code class="py">amount</code><code class="p">:</code> <code class="n">BigDecimal</code><code class="p">,</code>&#13;
    <code class="k">val</code> <code class="py">currency</code><code class="p">:</code> <code class="n">Currency</code>&#13;
<code class="p">)</code> <code class="p">{</code>&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">equals</code><code class="p">(</code><code class="n">o</code><code class="p">:</code> <code class="n">Any</code><code class="p">?):</code> <code class="n">Boolean</code> <code class="p">{</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="k">this</code> <code class="p">===</code> <code class="n">o</code><code class="p">)</code> <code class="k">return</code> <code class="k">true</code>&#13;
        <code class="k">if</code> <code class="p">(</code><code class="n">o</code> <code class="p">==</code> <code class="k">null</code> <code class="p">||</code> <code class="n">javaClass</code> <code class="p">!=</code> <code class="n">o</code><code class="p">.</code><code class="n">javaClass</code><code class="p">)</code> <code class="k">return</code> <code class="k">false</code>&#13;
        <code class="k">val</code> <code class="py">money</code> <code class="p">=</code> <code class="n">o</code> <code class="k">as</code> <code class="n">Money</code>&#13;
        <code class="k">return</code> <code class="n">amount</code> <code class="p">==</code> <code class="n">money</code><code class="p">.</code><code class="n">amount</code> <code class="p">&amp;&amp;</code> <code class="n">currency</code> <code class="p">==</code> <code class="n">money</code><code class="p">.</code><code class="n">currency</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">hashCode</code><code class="p">():</code> <code class="n">Int</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="n">Objects</code><code class="p">.</code><code class="n">hash</code><code class="p">(</code><code class="n">amount</code><code class="p">,</code> <code class="n">currency</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">override</code> <code class="k">fun</code> <code class="nf">toString</code><code class="p">():</code> <code class="n">String</code> <code class="p">{</code>&#13;
        <code class="k">return</code> <code class="n">amount</code><code class="p">.</code><code class="n">toString</code><code class="p">()</code> <code class="p">+</code> <code class="s">" "</code> <code class="p">+</code> <code class="n">currency</code><code class="p">.</code><code class="n">currencyCode</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="k">fun</code> <code class="nf">add</code><code class="p">(</code><code class="n">that</code><code class="p">:</code> <code class="n">Money</code><code class="p">):</code> <code class="n">Money</code> <code class="p">{</code>&#13;
        <code class="n">require</code><code class="p">(</code><code class="n">currency</code> <code class="p">==</code> <code class="n">that</code><code class="p">.</code><code class="n">currency</code><code class="p">)</code> <code class="p">{</code>&#13;
            <code class="s">"cannot add Money values of different currencies"</code>&#13;
        <code class="p">}</code>&#13;
        <code class="k">return</code> <code class="n">Money</code><code class="p">(</code><code class="n">amount</code><code class="p">.</code><code class="n">add</code><code class="p">(</code><code class="n">that</code><code class="p">.</code><code class="n">amount</code><code class="p">),</code> <code class="n">currency</code><code class="p">)</code>&#13;
    <code class="p">}</code>&#13;
&#13;
    <code class="n">companion</code> <code class="k">object</code> <code class="err">{</code>&#13;
        <code class="n">@JvmStatic</code>&#13;
        <code class="k">fun</code> <code class="nf">of</code><code class="p">(</code><code class="n">amount</code><code class="p">:</code> <code class="n">BigDecimal</code><code class="p">,</code> <code class="n">currency</code><code class="p">:</code> <code class="n">Currency</code><code class="p">):</code> <code class="n">Money</code> <code class="p">{</code>&#13;
            <code class="k">return</code> <code class="n">Money</code><code class="p">(</code>&#13;
                <code class="n">amount</code><code class="p">.</code><code class="n">setScale</code><code class="p">(</code><code class="n">currency</code><code class="p">.</code><code class="n">defaultFractionDigits</code><code class="p">),</code>&#13;
                <code class="n">currency</code>&#13;
            <code class="p">)</code>&#13;
        <code class="p">}</code>&#13;
&#13;
        <code class="p">...</code> <code class="n">and</code> <code class="n">convenience</code> <code class="n">overloads</code>&#13;
    <code class="p">}</code>&#13;
<code class="p">}</code></pre>&#13;
<div class="coderef">&#13;
    <a class="orm:hideurl" href="https://java-to-kotlin.dev/code.html?ref=3.9&amp;show=file">Example 3.9 [values.5:src/main/java/travelator/money/Money.kt]</a> <a class="orm:hideurl print-hide" href="https://java-to-kotlin.dev/code.html?ref=3.9&amp;show=diff">(diff)</a>&#13;
</div>&#13;
&#13;
<p>The Kotlin class still has a primary constructor, but that constructor is now marked private.&#13;
The syntax for this is a little clumsy: we’ve reformatted the code that the translator produced in an attempt to make it easier to scan.&#13;
Like <code>EmailAddress.parse</code>, the static <code>of</code> factory functions are now methods on a companion object annotated as <code>@JvmStatic</code>.&#13;
Overall, the code is not much more concise than the original Java.</p>&#13;
&#13;
<p>Can we shrink it even further by making it a data class?</p>&#13;
&#13;
<p>When<a data-primary="IntelliJ IDE" data-secondary="private data class warning" data-type="indexterm" id="idm46393409369800"/> we change <code>class</code> to <code>data class</code>, IntelliJ highlights the <code>private</code> keyword of the primary constructor with a warning:</p>&#13;
&#13;
<pre data-type="programlisting">Private data class constructor is exposed via the generated 'copy' method."</pre>&#13;
&#13;
<p>What’s that all about?</p>&#13;
&#13;
<p>There is a detail hiding in the implementation of <code>Money</code>.&#13;
The class maintains an invariant between its properties, guaranteeing that the scale of the amount field is equal to the default number of minor currency digits of the currency field.&#13;
The private constructor prevents code outside the <code>Money</code> class from creating values that violate the invariant.&#13;
The <code>Money.of(BigDecimal,Currency)</code> method ensures the invariant is true for new <code>Money</code> values.&#13;
The <code>add</code> method maintains the invariant because adding two &#13;
<span class="keep-together"><code>BigDecimal</code></span> values with the same scale produces a <code>BigDecimal</code> that also has the same scale, and it can therefore call the constructor directly.&#13;
The constructor, therefore, need only assign fields, safe in the knowledge that it is never called with parameters that violate the class invariant.</p>&#13;
&#13;
<p>However, the <code>copy</code> method of a data class is always public and so <em>would</em> allow client code to create <code>Money</code> values that violate the invariant.&#13;
Unlike <code>EmailAddress</code>, an abstract data type like the <code>Money</code> class cannot be implemented by a Kotlin data class.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>Don’t define a value type as a data class if it must maintain invariants between its properties.</p>&#13;
</div>&#13;
&#13;
<p>We can still make the class more concise and convenient with Kotlin features that we will encounter in later chapters.&#13;
So we’ll leave the <code>Money</code> class for now and come back to it in <a data-type="xref" href="ch12.html#functions-to-operators">Chapter 12</a> to give it a thorough makeover.<a data-primary="" data-startref="JWKQclasslim02" data-type="indexterm" id="idm46393409355928"/><a data-primary="" data-startref="DClimit02" data-type="indexterm" id="idm46393409354984"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Moving On" data-type="sect1"><div class="sect1" id="idm46393410069848">&#13;
<h1>Moving On</h1>&#13;
&#13;
<p>For most classes, it is quick and easy to convert Java to Kotlin.&#13;
The result is completely compatible with existing Java code.</p>&#13;
&#13;
<p>If<a data-primary="data classes" data-secondary="benefits of" data-type="indexterm" id="idm46393409352456"/> we want value semantics, <code>data</code> classes allow us to remove even more boilerplate for simple classes like <code>EmailAddress</code>.&#13;
Because data classes are so quick and easy to create, and require no maintenance, we use them to define new value types far more frequently in Kotlin than in Java:&#13;
to declare application-specific “micro-types” that wrap primitive values,&#13;
to hold intermediate results of a calculation pipeline,&#13;
or to pivot data into temporary structures that make it easier to write application logic.</p>&#13;
&#13;
<p>If our value types must maintain invariants or encapsulate their representation, data classes are not suitable.&#13;
In that case we have to implement value semantics ourselves.</p>&#13;
&#13;
<p>We left both <code>EmailAddress</code> and <code>Money</code> still looking rather Java-y…Java-ish?…Java-esque?…whatever.&#13;
In the following chapters, we will explore how to apply Kotlin idioms to make code more concise, more type safe, and easier to build code upon.&#13;
<a data-type="xref" data-xrefstyle="chap-num-title" href="ch09.html#multi-to-single-expression-functions">Chapter 9, <em>Multi- to Single-Expression Functions</em></a>, looks at how we can make calculation functions and methods, such as the <code>toString</code> method of both classes, or <code>equals</code> and <code>hashCode</code> of <code>Money</code>, more concise by refactoring them to single expression form.&#13;
In <a data-type="xref" data-xrefstyle="chap-num-title" href="ch12.html#functions-to-operators">Chapter 12, <em>Functions to Operators</em></a>, we make the <code>Money</code> type more convenient to use in Kotlin by defining operators instead of methods.</p>&#13;
&#13;
<p class="pagebreak-before">Not all our Java classes are value types.&#13;
The prevalent Java coding style favors mutable objects.&#13;
In <a data-type="xref" data-xrefstyle="chap-num-title" href="ch05.html#beans-to-values">Chapter 5, <em>Beans to Values</em></a>, we look at the advantages of using value types where Java would use mutable objects, and show how to refactor code from mutating objects to transforming values.</p>&#13;
&#13;
<p>Many classes in Java code exist to hold static utility methods.&#13;
In Kotlin, functions and data are first class features.&#13;
They do not need to be declared as members of classes.&#13;
<a data-type="xref" data-xrefstyle="chap-num-title" href="ch08.html#static-methods-to-top-level-functions">Chapter 8, <em>Static Methods to Top-Level Functions</em></a>, explores how to convert Java classes of utility methods into top-level declarations.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>