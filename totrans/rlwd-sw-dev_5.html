<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. The Business Rules Engine"><div class="chapter" id="chapter_05">
<h1><span class="label">Chapter 5. </span>The Business Rules Engine</h1>







<section data-type="sect1" data-pdf-bookmark="The Challenge"><div class="sect1" id="idm45816824526072">
<h1>The Challenge</h1>

<p>Your business is now doing really well.<a data-type="indexterm" data-primary="business rules engine (example)" id="ix_BRE"/> In fact, you’ve now scaled to an organization with thousands of employees. This mean you’ve hired many people for different business functions: marketing, sales, operations, admin, accounting, and so on. You realize that all the business functions have requirements for creating rules that trigger actions depending on some conditions; for example, “notify sales team if prospect’s job title is ‘CEO’.” You could be asking your tech team to implement each new requirement with bespoke software, but your developers are quite busy working on other products. In order to encourage collaboration between the business team and the tech team, you’ve decided that you will develop a Business Rules Engine that will enable developers and the business team to write code together. This will allow you to increase productivity and reduce the time it takes to implement new rules because your business team will be able to contribute directly.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The Goal"><div class="sect1" id="idm45816824522312">
<h1>The Goal</h1>

<p>In this chapter you’ll first learn about how to approach a new design problem using test-driven development. You will get an overview about a technique called mocking, which will help specify unit tests. You will then learn about a couple of modern features in Java: local variable type inference and switch expressions.<a data-type="indexterm" data-primary="Java" data-secondary="local variable type inference and switch expressions" id="idm45816824520680"/> Finally, you’ll learn how to develop a friendly API using the Builder pattern and the Interface Segregation Principle.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If at any point you want to look at the source code for this
chapter, you can look at the package <code>com.iteratrlearning.shu_book.chapter_05</code>
in the book’s code repository.</p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Business Rules Engine Requirements"><div class="sect1" id="idm45816824517528">
<h1>Business Rules Engine Requirements</h1>

<p>Before you start, let’s think about what is it you want to achieve.<a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="requirements" id="idm45816824515976"/> You’d like to enable nonprogrammers to add or change business logic in their own workflow. For example, a marketing executive may wish to apply a special discount when a prospect is making an inquiry about one of your products and fits certain criteria. An accounting executive may wish to create an alert if expenses are unusually high. These are examples of what you can achieve with a Business Rules Engine. It’s essentially software that executes one or more business rules that are often declared using a simple bespoke language.<a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="components" id="idm45816824514248"/> A Business Rules Engine can support multiple different <span class="keep-together">components</span>:</p>
<dl>
<dt>Facts</dt>
<dd>
<p>The available information to which rules have access<a data-type="indexterm" data-primary="facts (in business rules engine)" id="idm45816824510744"/></p>
</dd>
<dt>Actions</dt>
<dd>
<p>The operation you want to perform<a data-type="indexterm" data-primary="conditions" id="idm45816824508792"/><a data-type="indexterm" data-primary="actions" id="idm45816824508088"/></p>
</dd>
<dt>Conditions</dt>
<dd>
<p>These specify when an action should be triggered</p>
</dd>
<dt>Rules</dt>
<dd>
<p>These specify the business logic you want to execute, essentially grouping facts, conditions, and actions together<a data-type="indexterm" data-primary="rules" id="idm45816824504696"/></p>
</dd>
</dl>

<p>The main productivity benefit of a Business Rules Engine is that it enables rules to be maintained, executed, and tested within one place without having to integrate with a main application.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>There are many production-ready Java Business Rules Engine <a data-type="indexterm" data-primary="Drools" id="idm45816824502040"/><a data-type="indexterm" data-primary="Java" data-secondary="business rules engines, production-ready" id="idm45816824501336"/><a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="production-ready, in Java" id="idm45816824500296"/>such as <a href="https://www.drools.org">Drools</a>. Typically such an engine conforms to <a data-type="indexterm" data-primary="Decision Model and Notation (DMN) standard" id="idm45816824498552"/>standards such as the <em>Decision Model and Notation</em> (DMN) and comes with a centralized rule repository, an editor using a <em>Graphical User Interface</em> (GUI), and visualization tools to help maintenance of complex rules. In this chapter, you will develop a minimal viable product for a Business Rules Engine and iterate over it to improve both its functionality and accessibility.</p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Test Driven Development"><div class="sect1" id="idm45816824496424">
<h1>Test Driven Development</h1>

<p>Where do you start? <a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="test-driven development" id="ix_BRETDD"/>The requirements are not set in stone and are expected to evolve so you begin by simply listing the basic features you will need your users to <span class="keep-together">undertake</span>:</p>

<ul>
<li>
<p>Add an action</p>
</li>
<li>
<p>Run the action</p>
</li>
<li>
<p>Basic reporting</p>
</li>
</ul>

<p>This translates in the basic API shown in <a data-type="xref" href="#business_rule_engine_basic_skeleton">Example 5-1</a>. Each method throws an <code>UnsupportedOperationException</code> indicating it is yet to be implemented.</p>
<div id="business_rule_engine_basic_skeleton" data-type="example">
<h5><span class="label">Example 5-1. </span>Basic API for Business Rules Engine</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BusinessRuleEngine</code> <code class="o">{</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">addAction</code><code class="o">(</code><code class="kd">final</code> <code class="n">Action</code> <code class="n">action</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">count</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>

<code class="o">}</code></pre></div>

<p>An action is simply a piece of code that will be executed. We could use the <code>Runnable</code> interface, but introducing a separate interface <code>Action</code> is more representative of the domain at hand. <a data-type="indexterm" data-primary="functional interface" data-secondary="Action interface" id="idm45816824400040"/><a data-type="indexterm" data-primary="Action interface" id="idm45816824399192"/>The <code>Action</code> interface will allow the Business Rules Engine to be decoupled from concrete actions. Since the <code>Action</code> interface only declares a single abstract method, we can annotate it as a functional interface, as shown in <a data-type="xref" href="#action_interface">Example 5-2</a>.</p>
<div id="action_interface" data-type="example">
<h5><span class="label">Example 5-2. </span>The Action interface</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@FunctionalInterface</code>
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Action</code> <code class="o">{</code>
   <code class="kt">void</code> <code class="nf">execute</code><code class="o">();</code>
<code class="o">}</code></pre></div>

<p>Where do we go from here? <a data-type="indexterm" data-primary="test-driven development (TDD)" id="ix_TDD"/>It’s now time to actually write some code—where is the implementation? You will use an approach called <em>test-driven development</em> (TDD). The TDD philosophy is to start writing some tests that are going to let you guide the implementation of the code. In other words, you write tests first before the actual implementation. It’s a bit like doing the opposite of what you’ve been doing so far: you wrote the full code for a requirement and then tested it. You will now focus more on the tests.</p>








<section data-type="sect2" data-pdf-bookmark="Why Use TDD?"><div class="sect2" id="idm45816824386024">
<h2>Why Use TDD?</h2>

<p>Why should you take this approach?<a data-type="indexterm" data-primary="test-driven development (TDD)" data-secondary="benefits of" id="idm45816824384792"/> There are several benefits:</p>

<ul>
<li>
<p>Writing a test at a time will help you focus and refine the requirements by correctly implementing one thing at a time.</p>
</li>
<li>
<p>It’s a way to ensure a relevant organization for your code. For example, by writing a test first, you need to think hard about the public interfaces for your code.</p>
</li>
<li>
<p>You are building a comprehensive test suite as you iterate through the requirements, which increases confidence that you are matching the requirements and also reduces the scope of bugs.</p>
</li>
<li>
<p>You don’t write code that you don’t need (over-engineer) because you’re just writing code that passes the tests.</p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="The TDD Cycle"><div class="sect2" id="idm45816824375096">
<h2>The TDD Cycle</h2>

<p>The TDD approach roughly consists of the following steps in<a data-type="indexterm" data-primary="test-driven development (TDD)" data-secondary="cycle" id="idm45816824373368"/> a cycle, as depicted in <a data-type="xref" href="#test_cycle">Figure 5-1</a>:</p>
<ol>
<li>
<p>Write a test that fails</p>
</li>
<li>
<p>Run all tests</p>
</li>
<li>
<p>Make the implementation work</p>
</li>
<li>
<p>Run all tests</p>
</li>

</ol>

<figure><div id="test_cycle" class="figure">
<img src="Images/rwsd_0501.png" alt="TDD Cycle" width="810" height="470"/>
<h6><span class="label">Figure 5-1. </span>TDD cycle</h6>
</div></figure>

<p>In practice, as part of this process, you must continuously <em>refactor</em> your code or it will end up unmaintainable. At this moment you know you have a suite of tests that you can rely on when you introduce changes. <a data-type="xref" href="#test_cycle_refactor">Figure 5-2</a> illustrates this improved TDD process.</p>

<figure><div id="test_cycle_refactor" class="figure">
<img src="Images/rwsd_0502.png" alt="TDD Cycle with Refactoring" width="809" height="553"/>
<h6><span class="label">Figure 5-2. </span>TDD with refactoring</h6>
</div></figure>

<p>In the spirit of TDD, let’s start by writing our first tests to verify that <code>addActions</code> and <code>count</code> behave correctly, as <a data-type="indexterm" data-primary="test-driven development (TDD)" data-secondary="basic tests for business rules engine" id="idm45816824307400"/>shown in <a data-type="xref" href="#business_rule_engine_basic_tests">Example 5-3</a>.</p>
<div id="business_rule_engine_basic_tests" data-type="example">
<h5><span class="label">Example 5-3. </span>Basic tests for the Business Rules Engine</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Test</code>
<code class="kt">void</code> <code class="nf">shouldHaveNoRulesInitially</code><code class="o">()</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">BusinessRuleEngine</code> <code class="n">businessRuleEngine</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BusinessRuleEngine</code><code class="o">();</code>

    <code class="n">assertEquals</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">count</code><code class="o">());</code>
<code class="o">}</code>

<code class="nd">@Test</code>
<code class="kt">void</code> <code class="nf">shouldAddTwoActions</code><code class="o">()</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">BusinessRuleEngine</code> <code class="n">businessRuleEngine</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BusinessRuleEngine</code><code class="o">();</code>

    <code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(()</code> <code class="o">-&gt;</code> <code class="o">{});</code>
    <code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(()</code> <code class="o">-&gt;</code> <code class="o">{});</code>

    <code class="n">assertEquals</code><code class="o">(</code><code class="mi">2</code><code class="o">,</code> <code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">count</code><code class="o">());</code>
<code class="o">}</code></pre></div>

<p>When running the tests, you will see that they fail with an <code>UnsupportedOperationException</code>, as<a data-type="indexterm" data-primary="UnsupportedOperationException" id="idm45816824301864"/><a data-type="indexterm" data-primary="test-driven development (TDD)" data-secondary="failing tests for business rules engine" id="idm45816824245912"/> shown in <a data-type="xref" href="#failing_tests">Figure 5-3</a>.</p>

<figure><div id="failing_tests" class="figure">
<img src="Images/rwsd_0503.png" alt="Failing tests" width="1440" height="278"/>
<h6><span class="label">Figure 5-3. </span>Failing tests</h6>
</div></figure>

<p>All tests are failing, but that’s fine. It gives us a reproducible test suite that will guide the implementation of the code. Now can add some implementation code, as shown in <a data-type="xref" href="#business_rule_engine_basic_impl">Example 5-4</a>.</p>
<div id="business_rule_engine_basic_impl" data-type="example">
<h5><span class="label">Example 5-4. </span>Basic implementation for the Business Rules Engine</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BusinessRuleEngine</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Action</code><code class="o">&gt;</code> <code class="n">actions</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">BusinessRuleEngine</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">actions</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">addAction</code><code class="o">(</code><code class="kd">final</code> <code class="n">Action</code> <code class="n">action</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">actions</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">action</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">count</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">this</code><code class="o">.</code><code class="na">actions</code><code class="o">.</code><code class="na">size</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">(){</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>You can now rerun the tests and they are passing! However, there’s one crucial operation missing. How do we write a test for the method run? Unfortunately, <code>run()</code> does not return any result. We are going to need a new technique called <em>mocking</em> to verify that the method <code>run()</code> operates correctly.<a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="test-driven development" data-startref="ix_BRETDD" id="idm45816824127800"/><a data-type="indexterm" data-primary="test-driven development (TDD)" data-startref="ix_TDD" id="idm45816824126648"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Mocking"><div class="sect1" id="idm45816824495960">
<h1>Mocking</h1>

<p>Mocking is a technique that will allow you to verify <a data-type="indexterm" data-primary="mocking" id="ix_mck"/><a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="using mocking for tests" id="ix_BREmck"/>that when the method <code>run()</code> is executed, each action that was added to the Business Rules Engine is actually executed. At the moment it is difficult to do because both the methods <code>run()</code> in <code>BusinessRuleEngine</code> and <code>perform()</code> in <code>Action</code> are returning <code>void</code>. We have no way to write an assertion!  Mocking is covered in detail in <a data-type="xref" href="ch06.xhtml#chapter_06">Chapter 6</a>, but you will get a brief overview now so you are able to progress with writing a test. You’ll be using Mockito, which is a popular mocking library for Java. At its simplest you can do two things:</p>
<ol>
<li>
<p>Create a mock.</p>
</li>
<li>
<p>Verify that a method is called.</p>
</li>

</ol>

<p>So how do you get started? <a data-type="indexterm" data-primary="Mockito library" id="idm45816824115352"/> You will need to import the library first:</p>

<pre data-type="programlisting">import static org.mockito.Mockito.*;</pre>

<p>This import allows you to use the methods <code>mock()</code> and <code>verify()</code>.<a data-type="indexterm" data-primary="mock method" id="idm45816824112280"/><a data-type="indexterm" data-primary="verify method" id="idm45816824111544"/> The static method <code>mock()</code> allows you to create a mock object which you can then verify that certain behaviors happen. The method <code>verify()</code> allows you to set up assertions that a particular method is invoked. <a data-type="xref" href="#mocking_verifying_interaction">Example 5-5</a> shows an example.<a data-type="indexterm" data-primary="Action interface" data-secondary="mocking and verifying interaction with Action object" id="idm45816824108936"/></p>
<div id="mocking_verifying_interaction" data-type="example">
<h5><span class="label">Example 5-5. </span>Mocking and verifying interaction with an Action object</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Test</code>
<code class="kt">void</code> <code class="nf">shouldExecuteOneAction</code><code class="o">()</code> <code class="o">{</code>
        <code class="kd">final</code> <code class="n">BusinessRuleEngine</code> <code class="n">businessRuleEngine</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BusinessRuleEngine</code><code class="o">();</code>
        <code class="kd">final</code> <code class="n">Action</code> <code class="n">mockAction</code> <code class="o">=</code> <code class="n">mock</code><code class="o">(</code><code class="n">Action</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>

        <code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(</code><code class="n">mockAction</code><code class="o">);</code>
        <code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">run</code><code class="o">();</code>

        <code class="n">verify</code><code class="o">(</code><code class="n">mockAction</code><code class="o">).</code><code class="na">perform</code><code class="o">();</code>
<code class="o">}</code></pre></div>

<p>The <a data-type="indexterm" data-primary="unit tests" data-secondary="using mocking" id="idm45816824069160"/>unit test creates a mock object for <code>Action</code>. This is done by passing the class as argument to the mock method. Next, you have the <em>when</em> part of<a data-type="indexterm" data-primary="Given-When-Then formula" id="idm45816824022360"/> your test where you invoke behaviors. Here we are adding the action and executing the method <code>run()</code>. Finally, you have the <em>then</em> part of the unit tests, which sets up assertions. In this case, we verify that the method <code>perform()</code> on the <code>Action</code> object was invoked.</p>

<p>If you run this test it will fail as expected with a <code>UnsupportedOperationException</code>. What if the body of <code>run()</code> is empty? You will receive a new exception trace:</p>

<pre data-type="programlisting">Wanted but not invoked:
action.perform();
-&gt; at BusinessRuleEngineTest.shouldExecuteOneAction(BusinessRuleEngineTest.java:35)
Actually, there were zero interactions with this mock.</pre>

<p>This error is coming from Mockito and tells you that the method <code>perform()</code> was never invoked.<a data-type="indexterm" data-primary="run method, basic implementation" id="idm45816824016616"/> It’s now time to write the correct  implementation for the method <code>run()</code>, as shown in <a data-type="xref" href="#run_method_basic_impl">Example 5-6</a>.</p>
<div id="run_method_basic_impl" data-type="example">
<h5><span class="label">Example 5-6. </span>The run() method implementation</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">this</code><code class="o">.</code><code class="na">actions</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="nl">Action:</code><code class="o">:</code><code class="n">perform</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>Re-run the tests and you will now see the test passing.<a data-type="indexterm" data-primary="Mockito library" data-secondary="verification logic" id="idm45816823994312"/> Mockito was able to verify that when the Business Rules Engine is running, the method <code>perform()</code> on the <code>Action</code> object should be invoked. Mockito allows you to specify sophisticated verification logic such as how many times a method should be invoked, with certain arguments, etc. <a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="using mocking for tests" data-startref="ix_BREmck" id="idm45816824006888"/><a data-type="indexterm" data-primary="mocking" data-startref="ix_mck" id="idm45816824005672"/>You will learn more about this in <a data-type="xref" href="ch06.xhtml#chapter_06">Chapter 6</a>.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Adding Conditions"><div class="sect1" id="idm45816824125144">
<h1>Adding Conditions</h1>

<p>You have to admit that so far the Business Rules Engine is pretty limiting. You can only declare simple actions.<a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="adding conditions" id="ix_BREcnd"/><a data-type="indexterm" data-primary="conditions" data-secondary="adding to business rules engine" id="ix_cndBRE"/> However, in practice, the users of the Business Rules Engine will need to execute actions based on certain conditions. These conditions will be dependent on some facts. For example, notify the sales team <em>only if the prospect’s job title is CEO</em>.</p>








<section data-type="sect2" data-pdf-bookmark="Modeling State"><div class="sect2" id="idm45816823960920">
<h2>Modeling State</h2>

<p>You may start<a data-type="indexterm" data-primary="conditions" data-secondary="adding to business rules engine" data-tertiary="modeling state" id="idm45816823959192"/><a data-type="indexterm" data-primary="state, modeling in business rules engine" id="idm45816823957944"/><a data-type="indexterm" data-primary="actions" data-secondary="adding to business rules engine" id="idm45816823957240"/> by writing code that adds an action and refers to a local variable using an anonymous class as shown in <a data-type="xref" href="#anonm_add_action">Example 5-7</a>, or using a lambda expression as shown in <a data-type="xref" href="#lambda_add_action">Example 5-8</a>.</p>
<div id="anonm_add_action" data-type="example">
<h5><span class="label">Example 5-7. </span>Adding an action using an anonymous class</h5>

<pre data-type="programlisting" data-code-language="java"><code class="c1">// this object could be created from a form</code>
<code class="kd">final</code> <code class="n">Customer</code> <code class="n">customer</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Customer</code><code class="o">(</code><code class="s">"Mark"</code><code class="o">,</code> <code class="s">"CEO"</code><code class="o">);</code>

<code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(</code><code class="k">new</code> <code class="n">Action</code><code class="o">()</code> <code class="o">{</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">perform</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="s">"CEO"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">customer</code><code class="o">.</code><code class="na">getJobTitle</code><code class="o">()))</code> <code class="o">{</code>
            <code class="n">Mailer</code><code class="o">.</code><code class="na">sendEmail</code><code class="o">(</code><code class="s">"sales@company.com"</code><code class="o">,</code> <code class="s">"Relevant customer: "</code> <code class="o">+</code> <code class="n">customer</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">});</code></pre></div>
<div id="lambda_add_action" data-type="example">
<h5><span class="label">Example 5-8. </span>Adding an action using a lambda expression</h5>

<pre data-type="programlisting" data-code-language="java"><code class="c1">// this object could be created from a form</code>
<code class="kd">final</code> <code class="n">Customer</code> <code class="n">customer</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Customer</code><code class="o">(</code><code class="s">"Mark"</code><code class="o">,</code> <code class="s">"CEO"</code><code class="o">);</code>

<code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(()</code> <code class="o">-&gt;</code> <code class="o">{</code>
    <code class="k">if</code> <code class="o">(</code><code class="s">"CEO"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">customer</code><code class="o">.</code><code class="na">getJobTitle</code><code class="o">()))</code> <code class="o">{</code>
        <code class="n">Mailer</code><code class="o">.</code><code class="na">sendEmail</code><code class="o">(</code><code class="s">"sales@company.com"</code><code class="o">,</code> <code class="s">"Relevant customer: "</code> <code class="o">+</code> <code class="n">customer</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">});</code></pre></div>

<p>However, this<a data-type="indexterm" data-primary="lambda expressions" data-secondary="using to add action to business rules engine" id="idm45816823847672"/> approach is inconvenient for several reasons:</p>
<ol>
<li>
<p>How do you test the action? It’s not an independent piece of functionality; it has a hardcoded dependency on the customer object.</p>
</li>
<li>
<p>The customer object is not grouped with the action. It is a sort of external state that is shared around, leading to a confusing mix of responsibilities.</p>
</li>

</ol>

<p>So what do we need? We need to encapsulate the state that is available to actions within the Business Rules Engine.<a data-type="indexterm" data-primary="facts (in business rules engine)" data-secondary="testing an Action with" id="idm45816823794776"/><a data-type="indexterm" data-primary="actions" data-secondary="testing an Action with facts" id="idm45816823793832"/> Let’s model these requirements by introducing a new class called <code>Facts</code>, which will represent the state available as part of the Business Rules Engine, and an updated <code>Action</code> interface that can operate on facts.<a data-type="indexterm" data-primary="unit tests" data-secondary="testing an Action with facts" id="idm45816823791880"/><a data-type="indexterm" data-primary="mocking" data-secondary="using to test an Action with facts" id="idm45816823790936"/> An updated unit test is shown in <a data-type="xref" href="#test_action_facts">Example 5-9</a>. The unit test checks that when the Business Rules Engine runs, the specified action is actually invoked with the <code>Facts</code> object passed as an argument.</p>
<div id="test_action_facts" data-type="example">
<h5><span class="label">Example 5-9. </span>Testing an action with facts</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Test</code>
<code class="kd">public</code> <code class="kt">void</code> <code class="nf">shouldPerformAnActionWithFacts</code><code class="o">()</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">Action</code> <code class="n">mockAction</code> <code class="o">=</code> <code class="n">mock</code><code class="o">(</code><code class="n">Action</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>
    <code class="kd">final</code> <code class="n">Facts</code> <code class="n">mockFacts</code> <code class="o">=</code> <code class="n">mock</code><code class="o">(</code><code class="n">Facts</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>
    <code class="kd">final</code> <code class="n">BusinessRuleEngine</code> <code class="n">businessRuleEngine</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BusinessRuleEngine</code><code class="o">(</code><code class="n">mockedFacts</code><code class="o">);</code>

    <code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(</code><code class="n">mockAction</code><code class="o">);</code>
    <code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">run</code><code class="o">();</code>

    <code class="n">verify</code><code class="o">(</code><code class="n">mockAction</code><code class="o">).</code><code class="na">perform</code><code class="o">(</code><code class="n">mockFacts</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p class="pagebreak-before">To follow the TDD philosophy, this test will initially fail. You always need to run the tests to begin with to ensure that they fail, otherwise you may write a test that accidentally passes.<a data-type="indexterm" data-primary="test-driven development (TDD)" data-secondary="writing tests that initially fail" id="idm45816823709256"/> To make the test pass you will need to update the API and implementation code. First, you’ll introduce the <code>Facts</code> class, which allows you to store a fact represented as a key and a value.<a data-type="indexterm" data-primary="facts (in business rules engine)" data-secondary="Facts class" id="idm45816823707768"/> The benefit of introducing a separate <code>Facts</code> class for modeling state is that you can control the operations available to your users by providing a public API, and also unit test the behavior of the class. For the time being, the <code>Facts</code> class will only support <code>String</code> keys and <code>String</code> values. The code for the <code>Facts</code> class is shown in <a data-type="xref" href="#facts_class">Example 5-10</a>. We chose the names <code>getFact</code> and <code>addFact</code> because they better represent the domain at hand (working with facts) rather than <code>getValue</code> and <code>setValue</code>.</p>
<div id="facts_class" data-type="example">
<h5><span class="label">Example 5-10. </span>The Facts class</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Facts</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="n">String</code><code class="o">&gt;</code> <code class="n">facts</code> <code class="o">=</code> <code class="k">new</code> <code class="n">HashMap</code><code class="o">&lt;&gt;();</code>

    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getFact</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">name</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">this</code><code class="o">.</code><code class="na">facts</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">name</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">addFact</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">name</code><code class="o">,</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">value</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">facts</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="n">name</code><code class="o">,</code> <code class="n">value</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>You’ll now need to<a data-type="indexterm" data-primary="Action interface" data-secondary="refactoring so perform method can use Facts object as argument" id="idm45816823666760"/> refactor the <code>Action</code> interface so that the <code>perform()</code> method can use a <code>Facts</code> object passed as an argument. This way it’s clear the facts are available within the context of the single <code>Action</code> (<a data-type="xref" href="#action_with_facts">Example 5-11</a>).</p>
<div id="action_with_facts" data-type="example">
<h5><span class="label">Example 5-11. </span>The Action interface that takes facts</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@FunctionalInterface</code>
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Action</code> <code class="o">{</code>
    <code class="kt">void</code> <code class="nf">perform</code><code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>Finally, you can now update the <code>BusinessRuleEngine</code> class to utilize the facts and the updated <code>Action</code>’s <code>perform()</code> method as <a data-type="indexterm" data-primary="facts (in business rules engine)" data-secondary="BusinessRuleEngine with facts" id="idm45816823602056"/><a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="adding conditions" data-tertiary="BusinessRuleEngine with facts" id="idm45816823601288"/>shown in <a data-type="xref" href="#business_rule_engine_facts">Example 5-12</a>.</p>
<div id="business_rule_engine_facts" data-type="example">
<h5><span class="label">Example 5-12. </span>BusinessRuleEngine with facts</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BusinessRuleEngine</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Action</code><code class="o">&gt;</code> <code class="n">actions</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">BusinessRuleEngine</code><code class="o">(</code><code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">facts</code> <code class="o">=</code> <code class="n">facts</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">actions</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">addAction</code><code class="o">(</code><code class="kd">final</code> <code class="n">Action</code> <code class="n">action</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">actions</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">action</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">count</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">this</code><code class="o">.</code><code class="na">actions</code><code class="o">.</code><code class="na">size</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">actions</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">action</code> <code class="o">-&gt;</code> <code class="n">action</code><code class="o">.</code><code class="na">perform</code><code class="o">(</code><code class="n">facts</code><code class="o">));</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>Now that the <code>Facts</code> object is available to actions, you can specify arbitrary logic in your code that looks up the <code>Facts</code> object <a data-type="indexterm" data-primary="facts (in business rules engine)" data-secondary="action using facts" id="idm45816823585032"/><a data-type="indexterm" data-primary="actions" data-secondary="action using facts" id="idm45816823423192"/>as shown in <a data-type="xref" href="#example_action_with_facts">Example 5-13</a>.</p>
<div id="example_action_with_facts" data-type="example">
<h5><span class="label">Example 5-13. </span>An action utilizing the facts</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(</code><code class="n">facts</code> <code class="o">-&gt;</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">String</code> <code class="n">jobTitle</code> <code class="o">=</code> <code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"jobTitle"</code><code class="o">);</code>
    <code class="k">if</code> <code class="o">(</code><code class="s">"CEO"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">jobTitle</code><code class="o">))</code> <code class="o">{</code>
        <code class="kd">final</code> <code class="n">String</code> <code class="n">name</code> <code class="o">=</code> <code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"name"</code><code class="o">);</code>
        <code class="n">Mailer</code><code class="o">.</code><code class="na">sendEmail</code><code class="o">(</code><code class="s">"sales@company.com"</code><code class="o">,</code> <code class="s">"Relevant customer: "</code> <code class="o">+</code> <code class="n">name</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">});</code></pre></div>

<p>Let’s look at some more examples. This is also a good opportunity to introduce two recent features in Java, which we explore in order:</p>

<ul>
<li>
<p>Local variable type inference</p>
</li>
<li>
<p>Switch expressions</p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Local Variable Type Inference"><div class="sect2" id="idm45816823960296">
<h2>Local Variable Type Inference</h2>

<p>Java 10 introduced variable local type inference.<a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="adding conditions" data-tertiary="local variable type inference" id="idm45816823292536"/><a data-type="indexterm" data-primary="conditions" data-secondary="adding to business rules engine" data-tertiary="local variable type inference" id="idm45816823291352"/><a data-type="indexterm" data-primary="type inference" id="idm45816823290152"/><a data-type="indexterm" data-primary="local variable type inference" id="idm45816823289480"/><a data-type="indexterm" data-primary="data types" data-secondary="local variable type inference" id="idm45816823288792"/> Type inference is the idea that the compiler can figure out the static types for you so you don’t have to type them. You saw an example of type inference earlier in <a data-type="xref" href="#facts_class">Example 5-10</a> when <a data-type="indexterm" data-primary="maps" data-secondary="Map using local variable type inference" id="idm45816823286712"/>you wrote</p>

<pre data-type="programlisting">Map&lt;String, String&gt; facts = new HashMap&lt;&gt;();</pre>

<p>instead of</p>

<pre data-type="programlisting">Map&lt;String, String&gt; facts = new HashMap&lt;String, String&gt;();</pre>

<p>This is a feature <a data-type="indexterm" data-primary="&lt;&gt; (diamond) operator" id="idm45816823283192"/><a data-type="indexterm" data-primary="diamond operator (&lt;&gt;)" id="idm45816823282456"/>that was introduced in Java 7 called the <em>diamond operator</em>. Essentially, you can omit the type parameters of generics (in this case <code>String, String</code>) in an expression when its context determines them. In the preceding code, the lefthand side of the assignment indicates the keys and values of the <code>Map</code> should be <code>String</code>s.</p>

<p>Since Java 10, type inference has been extended to work on local variables. For example, the code in <a data-type="xref" href="#local_variable_declarations">Example 5-14</a> can <a data-type="indexterm" data-primary="variables" data-secondary="local variable declaration with explicit types" id="idm45816823380280"/><a data-type="indexterm" data-primary="var keyword" id="idm45816823379208"/>be rewritten using the <code>var</code> keyword and local variable type inference shown in <a data-type="xref" href="#local_variable_type_inference">Example 5-15</a>.</p>
<div id="local_variable_declarations" data-type="example">
<h5><span class="label">Example 5-14. </span>Local variable declaration with explicit types</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">Facts</code> <code class="n">env</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Facts</code><code class="o">();</code>
<code class="n">BusinessRuleEngine</code> <code class="n">businessRuleEngine</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BusinessRuleEngine</code><code class="o">(</code><code class="n">env</code><code class="o">);</code></pre></div>
<div id="local_variable_type_inference" data-type="example">
<h5><span class="label">Example 5-15. </span>Local variable type inference</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">var</code> <code class="n">env</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Facts</code><code class="o">();</code>
<code class="n">var</code> <code class="n">businessRuleEngine</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BusinessRuleEngine</code><code class="o">(</code><code class="n">env</code><code class="o">);</code></pre></div>

<p>By using<a data-type="indexterm" data-primary="variables" data-secondary="local variable type inference" id="idm45816823245576"/> the <code>var</code> keyword in the code shown in <a data-type="xref" href="#local_variable_type_inference">Example 5-15</a>, the variable <code>env</code> still has a static type <code>Facts</code> and the variable <code>businessRuleEngine</code> still has the static type <code>BusinessRuleEngine</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A variable declared<a data-type="indexterm" data-primary="final keyword" data-secondary="not used with variables declared using var" id="idm45816823212744"/> using the <code>var</code> keyword is not made <code>final</code>. For example, this code:</p>

<pre data-type="programlisting">final Facts env = new Facts();</pre>

<p>is not strictly equivalent to:</p>

<pre data-type="programlisting">var env = new Facts();</pre>

<p>You can still assign another value to the variable <code>env</code> after declaring it using <code>var</code>. You’d have to explicitly add the <code>final</code> keyword as follows in front of the variable <code>env</code> for it to be final:</p>

<pre data-type="programlisting">final var env = new Facts()</pre>

<p>In the rest of the chapters, we simply use the <code>var</code> keyword without <code>final</code> for brevity as it is in the spirit of code conciseness. When we explicitly declare the type of a variable, we use the <code>final</code> keyword.</p>
</div>

<p>Type inference helps reduce the amount of time taken to write Java code. However, should you use this feature all the time? It’s worth remembering that developers spend more time reading code than writing it.<a data-type="indexterm" data-primary="type inference" data-secondary="code readability and" id="idm45816823203240"/> In other words, you should think about optimizing for ease of reading over ease of writing. The extent to which <code>var</code> improves this will always be subjective. You should always be focusing on what helps your teammates read your code, so if they are happy reading code with <code>var</code> <span class="keep-together">then you</span> should use it, otherwise not.<a data-type="indexterm" data-primary="actions" data-secondary="action using facts and local variable type inference" id="idm45816823200312"/><a data-type="indexterm" data-primary="facts (in business rules engine)" data-secondary="action using facts and local variable type inference" id="idm45816823199240"/>
For example, here we can refactor the code in <a data-type="xref" href="#example_action_with_facts">Example 5-13</a> to use local variable type inference to tidy up the code as shown in <a data-type="xref" href="#example_action_with_facts_var">Example 5-16</a>.</p>
<div id="example_action_with_facts_var" data-type="example">
<h5><span class="label">Example 5-16. </span>An action utilizing the facts and local variable type inference</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(</code><code class="n">facts</code> <code class="o">-&gt;</code> <code class="o">{</code>
    <code class="n">var</code> <code class="n">jobTitle</code> <code class="o">=</code> <code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"jobTitle"</code><code class="o">);</code>
    <code class="k">if</code> <code class="o">(</code><code class="s">"CEO"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">jobTitle</code><code class="o">))</code> <code class="o">{</code>
        <code class="n">var</code> <code class="n">name</code> <code class="o">=</code> <code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"name"</code><code class="o">);</code>
        <code class="n">Mailer</code><code class="o">.</code><code class="na">sendEmail</code><code class="o">(</code><code class="s">"sales@company.com"</code><code class="o">,</code> <code class="s">"Relevant customer: "</code> <code class="o">+</code> <code class="n">name</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">});</code></pre></div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Switch Expressions"><div class="sect2" id="idm45816823293704">
<h2>Switch Expressions</h2>

<p>So far you’ve only set up actions with exactly one condition to handle.<a data-type="indexterm" data-primary="conditions" data-secondary="adding to business rules engine" data-tertiary="using switch expressions" id="idm45816823133288"/><a data-type="indexterm" data-primary="switch statement" data-secondary="using switch expressions to add conditions" id="idm45816823132136"/> This is pretty limiting. For example,
say you work with your sales team. They may record on their <em>Customer Relationship Management</em> (CRM) system different deals with different amounts that have different stages.
A deal stage may be represented as an enum <code>Stage</code> with values including <code>LEAD</code>, <code>INTERESTED</code>, <code>EVALUATING</code>, <code>CLOSED</code>, as shown in <a data-type="xref" href="#enum_stages">Example 5-17</a>.</p>
<div id="enum_stages" data-type="example">
<h5><span class="label">Example 5-17. </span>Enum representing different deal stages</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">Stage</code> <code class="o">{</code>
    <code class="n">LEAD</code><code class="o">,</code> <code class="n">INTERESTED</code><code class="o">,</code> <code class="n">EVALUATING</code><code class="o">,</code> <code class="n">CLOSED</code>
<code class="o">}</code></pre></div>

<p>Depending on the stage of the deal you can assign a rule that gives you the probability of winning the deal. Consequently, you can help the sales team with generating a forecast.
Say for a particular team, <code>LEAD</code> has 20% probability to convert, then a deal at stage <code>LEAD</code> with amount of 1000USD will have a forecasted amount of 200USD. Let’s create an action to model these rules and return a forecasted amount for a particular deal as shown in <a data-type="xref" href="#deal_stages_if">Example 5-18</a>.</p>
<div id="deal_stages_if" data-type="example">
<h5><span class="label">Example 5-18. </span>A rule to calculate a forecast amount for a specific deal</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(</code><code class="n">facts</code> <code class="o">-&gt;</code> <code class="o">{</code>
    <code class="n">var</code> <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="mf">0.0</code><code class="o">;</code>
    <code class="n">var</code> <code class="n">dealStage</code> <code class="o">=</code> <code class="n">Stage</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"stage"</code><code class="o">));</code>
    <code class="n">var</code> <code class="n">amount</code> <code class="o">=</code> <code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"amount"</code><code class="o">));</code>
    <code class="k">if</code><code class="o">(</code><code class="n">dealStage</code> <code class="o">==</code> <code class="n">Stage</code><code class="o">.</code><code class="na">LEAD</code><code class="o">){</code>
        <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code> <code class="o">*</code> <code class="mf">0.2</code><code class="o">;</code>
    <code class="o">}</code> <code class="k">else</code> <code class="k">if</code> <code class="o">(</code><code class="n">dealStage</code> <code class="o">==</code> <code class="n">Stage</code><code class="o">.</code><code class="na">EVALUATING</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code> <code class="o">*</code> <code class="mf">0.5</code><code class="o">;</code>
    <code class="o">}</code> <code class="k">else</code> <code class="k">if</code><code class="o">(</code><code class="n">dealStage</code> <code class="o">==</code> <code class="n">Stage</code><code class="o">.</code><code class="na">INTERESTED</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code> <code class="o">*</code> <code class="mf">0.8</code><code class="o">;</code>
    <code class="o">}</code> <code class="k">else</code> <code class="k">if</code><code class="o">(</code><code class="n">dealStage</code> <code class="o">==</code> <code class="n">Stage</code><code class="o">.</code><code class="na">CLOSED</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code><code class="o">;</code>
    <code class="o">}</code>
    <code class="n">facts</code><code class="o">.</code><code class="na">addFact</code><code class="o">(</code><code class="s">"forecastedAmount"</code><code class="o">,</code> <code class="n">String</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">forecastedAmount</code><code class="o">));</code>
<code class="o">});</code></pre></div>

<p>The code shown in <a data-type="xref" href="#deal_stages_if">Example 5-18</a> is essentially providing a value for each enum value available. A preferred language construct is the <code>switch</code> statement as it’s more succinct. This is shown in <a data-type="xref" href="#deal_stages_switch_statement">Example 5-19</a>.</p>
<div id="deal_stages_switch_statement" data-type="example">
<h5><span class="label">Example 5-19. </span>A rule to calculate a forecast amount for a specific deal using a switch statement</h5>

<pre data-type="programlisting" data-code-language="java"><code class="k">switch</code> <code class="o">(</code><code class="n">dealStage</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">case</code> <code class="nl">LEAD:</code>
        <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code> <code class="o">*</code> <code class="mf">0.2</code><code class="o">;</code>
        <code class="k">break</code><code class="o">;</code>
    <code class="k">case</code> <code class="nl">EVALUATING:</code>
        <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code> <code class="o">*</code> <code class="mf">0.5</code><code class="o">;</code>
        <code class="k">break</code><code class="o">;</code>
    <code class="k">case</code> <code class="nl">INTERESTED:</code>
        <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code> <code class="o">*</code> <code class="mf">0.8</code><code class="o">;</code>
        <code class="k">break</code><code class="o">;</code>
    <code class="k">case</code> <code class="nl">CLOSED:</code>
        <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code><code class="o">;</code>
        <code class="k">break</code><code class="o">;</code>
<code class="o">}</code></pre></div>

<p>Note <a data-type="indexterm" data-primary="switch statement" data-secondary="break statements in" id="idm45816822790520"/>all the <code>break</code> statements in<a data-type="indexterm" data-primary="break statements in switch statement" id="idm45816822768152"/> the code in <a data-type="xref" href="#deal_stages_switch_statement">Example 5-19</a>. The <code>break</code> statement ensures that the next block in the <code>switch</code> statement is not executed. If you forget the <code>break</code> by accident, then the code still compiles and you get what’s called a <em>fall-through</em> behavior.<a data-type="indexterm" data-primary="fall-through behavior" id="idm45816822899144"/> In other words, the next block is executed and this can lead to subtle bugs.
Since Java 12 (using the language feature preview mode) you can rewrite this to avoid the fall-through behavior and multiple breaks by using a different syntax for <code>switch</code>. <code>switch</code> can now be used as an<a data-type="indexterm" data-primary="switch statement" data-secondary="switch expressions with no fall-through behavior" id="idm45816822897192"/> expression, as illustrated in <a data-type="xref" href="#deal_stages_switch_statement_no_fall_through">Example 5-20</a>.</p>
<div id="deal_stages_switch_statement_no_fall_through" data-type="example">
<h5><span class="label">Example 5-20. </span>Switch expression with no fall-through behavior</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">var</code> <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code> <code class="o">*</code> <code class="k">switch</code> <code class="o">(</code><code class="n">dealStage</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">case</code> <code class="n">LEAD</code> <code class="o">-&gt;</code> <code class="mf">0.2</code><code class="o">;</code>
    <code class="k">case</code> <code class="n">EVALUATING</code> <code class="o">-&gt;</code> <code class="mf">0.5</code><code class="o">;</code>
    <code class="k">case</code> <code class="n">INTERESTED</code> <code class="o">-&gt;</code> <code class="mf">0.8</code><code class="o">;</code>
    <code class="k">case</code> <code class="n">CLOSED</code> <code class="o">-&gt;</code> <code class="mi">1</code><code class="o">;</code>
<code class="o">}</code></pre></div>

<p>Another benefit of this enhanced switch form, besides increased readability, is <em>exhaustiveness</em>. <a data-type="indexterm" data-primary="exhaustiveness in switch statement" id="idm45816822744040"/>This means that when you use <code>switch</code> with an enum, the Java compiler checks that for all enum values there’s a corresponding switch label. For example, if you forget to handle the <code>CLOSED</code> case, the Java compiler would produce the following error:</p>

<pre data-type="programlisting">error: the switch expression does not cover all possible input values.</pre>

<p>You can rewrite the <a data-type="indexterm" data-primary="switch statement" data-secondary="switch expression calculating forecast amount for a deal" id="idm45816822741304"/>overall action using a <code>switch</code> expression as shown in <a data-type="xref" href="#deal_stages_switch_refactored">Example 5-21</a>.</p>
<div id="deal_stages_switch_refactored" data-type="example">
<h5><span class="label">Example 5-21. </span>A rule to calculate a forecast amount for a specific deal</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">businessRuleEngine</code><code class="o">.</code><code class="na">addAction</code><code class="o">(</code><code class="n">facts</code> <code class="o">-&gt;</code> <code class="o">{</code>
    <code class="n">var</code> <code class="n">dealStage</code> <code class="o">=</code> <code class="n">Stage</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"stage"</code><code class="o">));</code>
    <code class="n">var</code> <code class="n">amount</code> <code class="o">=</code> <code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"amount"</code><code class="o">));</code>
    <code class="n">var</code> <code class="n">forecastedAmount</code> <code class="o">=</code> <code class="n">amount</code> <code class="o">*</code> <code class="k">switch</code> <code class="o">(</code><code class="n">dealStage</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">case</code> <code class="n">LEAD</code> <code class="o">-&gt;</code> <code class="mf">0.2</code><code class="o">;</code>
        <code class="k">case</code> <code class="n">EVALUATING</code> <code class="o">-&gt;</code> <code class="mf">0.5</code><code class="o">;</code>
        <code class="k">case</code> <code class="n">INTERESTED</code> <code class="o">-&gt;</code> <code class="mf">0.8</code><code class="o">;</code>
        <code class="k">case</code> <code class="n">CLOSED</code> <code class="o">-&gt;</code> <code class="mi">1</code><code class="o">;</code>
    <code class="o">}</code>
    <code class="n">facts</code><code class="o">.</code><code class="na">addFact</code><code class="o">(</code><code class="s">"forecastedAmount"</code><code class="o">,</code> <code class="n">String</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">forecastedAmount</code><code class="o">));</code>
<code class="o">});</code></pre></div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Interface Segregation Principle"><div class="sect2" id="idm45816823134104">
<h2>Interface Segregation Principle</h2>

<p>We would now like to develop an <em>inspector tool</em> that allows users of the Business Rules Engine<a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="adding conditions" data-tertiary="using interface segregation principle" id="idm45816822608008"/><a data-type="indexterm" data-primary="conditions" data-secondary="adding to business rules engine" data-tertiary="using interface segregation principle" id="idm45816822606968"/> to inspect the status of possible actions and conditions. For example, we would like to evaluate each action and associated condition in order to log them without actually performing the action. How do we go about this? The current <code>Action</code> interface is not sufficient because it doesn’t separate the code performed versus the condition that triggers that code. At the moment there’s no way to separate out the condition from the action code. To make up for this, we could introduce an enhanced <code>Action</code> interface that has a built-in functionality for evaluating the condition. For example, we could create an interface <code>ConditionalAction</code> that includes a new method <code>evaluate()</code> as shown in <a data-type="xref" href="#isp_violation_business_rule_engine">Example 5-22</a>.</p>
<div id="isp_violation_business_rule_engine" data-type="example">
<h5><span class="label">Example 5-22. </span>ConditionalAction interface</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">ConditionalAction</code> <code class="o">{</code>
    <code class="kt">boolean</code> <code class="nf">evaluate</code><code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">);</code>
    <code class="kt">void</code> <code class="nf">perform</code><code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>We can now implement a basic <code>Inspector</code> class that takes a list of <code>ConditionalAction</code> objects and evaluates them based on some facts, as shown in <a data-type="xref" href="#inspector_conditions">Example 5-23</a>. The <code>Inspector</code> returns a list of reports that captures the facts, the conditional action, and the result. The implementation for the <code>Report</code> class is shown in <a data-type="xref" href="#report_class">Example 5-24</a>.</p>
<div id="inspector_conditions" data-type="example">
<h5><span class="label">Example 5-23. </span>An Inspector of conditions</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Inspector</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">ConditionalAction</code><code class="o">&gt;</code> <code class="n">conditionalActionList</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">Inspector</code><code class="o">(</code><code class="kd">final</code> <code class="n">ConditionalAction</code><code class="o">...</code><code class="na">conditionalActions</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">conditionalActionList</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="n">conditionalActions</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Report</code><code class="o">&gt;</code> <code class="nf">inspect</code><code class="o">(</code><code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code><code class="o">)</code> <code class="o">{</code>
        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Report</code><code class="o">&gt;</code> <code class="n">reportList</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
        <code class="k">for</code> <code class="o">(</code><code class="n">ConditionalAction</code> <code class="n">conditionalAction</code> <code class="o">:</code> <code class="n">conditionalActionList</code><code class="o">)</code> <code class="o">{</code>
            <code class="kd">final</code> <code class="kt">boolean</code> <code class="n">conditionResult</code> <code class="o">=</code> <code class="n">conditionalAction</code><code class="o">.</code><code class="na">evaluate</code><code class="o">(</code><code class="n">facts</code><code class="o">);</code>
            <code class="n">reportList</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Report</code><code class="o">(</code><code class="n">facts</code><code class="o">,</code> <code class="n">conditionalAction</code><code class="o">,</code> <code class="n">conditionResult</code><code class="o">));</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">reportList</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>
<div id="report_class" data-type="example">
<h5><span class="label">Example 5-24. </span>The Report class</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Report</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">ConditionalAction</code> <code class="n">conditionalAction</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="kt">boolean</code> <code class="n">isPositive</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">Report</code><code class="o">(</code><code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code><code class="o">,</code>
                     <code class="kd">final</code> <code class="n">ConditionalAction</code> <code class="n">conditionalAction</code><code class="o">,</code>
                     <code class="kd">final</code> <code class="kt">boolean</code> <code class="n">isPositive</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">facts</code> <code class="o">=</code> <code class="n">facts</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">conditionalAction</code> <code class="o">=</code> <code class="n">conditionalAction</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">isPositive</code> <code class="o">=</code> <code class="n">isPositive</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">ConditionalAction</code> <code class="nf">getConditionalAction</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">conditionalAction</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">Facts</code> <code class="nf">getFacts</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">facts</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">isPositive</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">isPositive</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">toString</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="s">"Report{"</code> <code class="o">+</code>
                <code class="s">"conditionalAction="</code> <code class="o">+</code> <code class="n">conditionalAction</code> <code class="o">+</code>
                <code class="s">", facts="</code> <code class="o">+</code> <code class="n">facts</code> <code class="o">+</code>
                <code class="s">", result="</code> <code class="o">+</code> <code class="n">isPositive</code> <code class="o">+</code>
                <code class="sc">'}'</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>How would we go about testing the <code>Inspector</code>? You may start by writing a simple unit test as shown in <a data-type="xref" href="#inspector_test">Example 5-25</a>. This test highlights a fundamental <a data-type="indexterm" data-primary="interface segregation principle (ISP)" data-secondary="broken by ConditionalAction interface in business rules engine" id="idm45816822437896"/>issue with our current design. In fact, the <code>ConditionalAction</code> interface breaks the <em>Interface Segregation Principle</em> (ISP).</p>
<div id="inspector_test" data-type="example">
<h5><span class="label">Example 5-25. </span>Highlighting ISP violation</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">InspectorTest</code> <code class="o">{</code>

    <code class="nd">@Test</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">inspectOneConditionEvaluatesTrue</code><code class="o">()</code> <code class="o">{</code>

        <code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Facts</code><code class="o">();</code>
        <code class="n">facts</code><code class="o">.</code><code class="na">setFact</code><code class="o">(</code><code class="s">"jobTitle"</code><code class="o">,</code> <code class="s">"CEO"</code><code class="o">);</code>
        <code class="kd">final</code> <code class="n">ConditionalAction</code> <code class="n">conditionalAction</code> <code class="o">=</code> <code class="k">new</code> <code class="n">JobTitleCondition</code><code class="o">();</code>
        <code class="kd">final</code> <code class="n">Inspector</code> <code class="n">inspector</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Inspector</code><code class="o">(</code><code class="n">conditionalAction</code><code class="o">);</code>

        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Report</code><code class="o">&gt;</code> <code class="n">reportList</code> <code class="o">=</code> <code class="n">inspector</code><code class="o">.</code><code class="na">inspect</code><code class="o">(</code><code class="n">facts</code><code class="o">);</code>

        <code class="n">assertEquals</code><code class="o">(</code><code class="mi">1</code><code class="o">,</code> <code class="n">reportList</code><code class="o">.</code><code class="na">size</code><code class="o">());</code>
        <code class="n">assertEquals</code><code class="o">(</code><code class="kc">true</code><code class="o">,</code> <code class="n">reportList</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">).</code><code class="na">isPositive</code><code class="o">());</code>
    <code class="o">}</code>

    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">JobTitleCondition</code> <code class="kd">implements</code> <code class="n">ConditionalAction</code> <code class="o">{</code>

        <code class="nd">@Override</code>
        <code class="kd">public</code> <code class="kt">void</code> <code class="nf">perform</code><code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
        <code class="o">}</code>

        <code class="nd">@Override</code>
        <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">evaluate</code><code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">return</code> <code class="s">"CEO"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"jobTitle"</code><code class="o">));</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>What is the Interface Segregation Principle? You may notice that the implementation of the <code>perform</code> method is empty. In fact, it throws an <code>UnsupportedOperationException</code>. This is a situation where you are coupled to an interface (<code>ConditionalAction</code>) that provides more than what you need. In this case, we just want a way to model a condition—something that evaluates to either true or false. Nonetheless, we are forced to depend on the <code>perform()</code> method because it is part of the interface.</p>

<p>This general idea is the foundation of the Interface Segregation Principle. It makes the case that no class should be forced to depend on methods it does not use because <a data-type="indexterm" data-primary="coupling" data-secondary="unnecessary, in violation of interface segregation principle" id="idm45816822105816"/>this introduces unnecessary coupling. In <a data-type="xref" href="ch02.xhtml#chapter_02">Chapter 2</a>, you learned about another principle, the <em>Single Responsibility Principle</em> (SRP), which promotes high cohesion.<a data-type="indexterm" data-primary="single responsibility principle (SRP)" data-secondary="interface segregation principle versus" id="idm45816822103512"/><a data-type="indexterm" data-primary="interface segregation principle (ISP)" data-secondary="single responsibility principle versus" id="idm45816822102488"/> The SRP is a general design guideline that a class has responsibility over a single functionality and there should be only one reason for it to change. Although the ISP may sound like the same idea, it takes a different view. The ISP focuses on the user of an interface rather than its design. In other words, if an interface ends up very large, it may be that the user of that interface sees some behaviors it doesn’t care for, which causes unnecessary coupling.</p>

<p>To provide a solution that meets the Interface Segregation Principle, we are encouraged to separate out concepts in smaller interface that can evolve separately. This idea essentially promotes higher cohesion.<a data-type="indexterm" data-primary="cohesion" data-secondary="promoted by interface segregation principle" id="idm45816822100296"/> Separating out interfaces also provides an opportunity for introducing names that are closer to the domain at hand, such as <code>Condition</code> and <code>Action</code>, which we explore in the next section.<a data-type="indexterm" data-primary="conditions" data-secondary="adding to business rules engine" data-startref="ix_cndBRE" id="idm45816822098120"/><a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="adding conditions" data-startref="ix_BREcnd" id="idm45816822096808"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Designing a Fluent API"><div class="sect1" id="idm45816822734632">
<h1>Designing a Fluent API</h1>

<p>So far we’ve provided a way for our users to add actions with complex conditions.<a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="designing a Fluent API" id="ix_BREFlAPI"/><a data-type="indexterm" data-primary="APIs" data-secondary="designing a Fluent API" id="ix_APIFl"/><a data-type="indexterm" data-primary="Fluent APIs, designing" id="ix_FlAPI"/> These conditions were created using the enhanced switch statement. However, for business users the syntax isn’t as friendly as it could be to specify simple conditions. We’d like to allow them to add rules (a condition and an action) in a way that matches their domain and is simpler to specify. In this section, you will learn about the Builder pattern and how to develop your own Fluent API to address this problem.</p>








<section data-type="sect2" data-pdf-bookmark="What Is a Fluent API?"><div class="sect2" id="idm45816822089976">
<h2>What Is a Fluent API?</h2>

<p>A Fluent API is an API that is explicitly tailored for a specific domain so that you can solve a specific problem more intuitively.<a data-type="indexterm" data-primary="domains" data-secondary="Fluent APIs" id="idm45816822088536"/><a data-type="indexterm" data-primary="Fluent APIs, designing" data-secondary="about Fluent APIs" id="idm45816822087560"/> It also embraces the idea of chaining method calls to specify a more complex operation. There are several high-profile Fluent APIs you may be already familiar with:</p>

<ul>
<li>
<p>The <a href="https://oreil.ly/549wN">Java Streams API</a> allows you<a data-type="indexterm" data-primary="Java" data-secondary="Java Streams API" id="idm45816822084568"/><a data-type="indexterm" data-primary="Streams API" id="idm45816822083560"/> to specify data processing queries in a way that reads more like the problem you need to solve.</p>
</li>
<li>
<p><a href="https://oreil.ly/rMIMD">Spring Integration</a> offers a Java API to specify enterprise integration patterns using a vocabulary close to the domain of enterprise integration patterns.<a data-type="indexterm" data-primary="Spring integration" id="idm45816822081096"/></p>
</li>
<li>
<p><a href="https://www.jooq.org/">jOOQ</a> offers a library to interact with different databases using an intuitive API.<a data-type="indexterm" data-primary="jOOQ, library for interacting with databases using intuitive API" id="idm45816822079000"/></p>
</li>
</ul>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Modeling the Domain"><div class="sect2" id="idm45816822077816">
<h2>Modeling the Domain</h2>

<p>So what is it that we want to simply for our business users?<a data-type="indexterm" data-primary="Fluent APIs, designing" data-secondary="modeling the domain" id="idm45816822076120"/><a data-type="indexterm" data-primary="domains" data-secondary="modeling in business rules engine" id="idm45816822075144"/><a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="designing a Fluent API" data-tertiary="modeling the domain" id="idm45816822074184"/> We’d like to help them specify a simple combination of “when some condition holds,” “then do something” as a rule. There are three concepts in this domain:</p>
<dl>
<dt>Condition</dt>
<dd>
<p>A condition applied on certain facts that will evaluate to either true or false.<a data-type="indexterm" data-primary="conditions" id="idm45816822070952"/><a data-type="indexterm" data-primary="actions" id="idm45816822070248"/></p>
</dd>
<dt>Action</dt>
<dd>
<p>A specific set of operations or code to execute.</p>
</dd>
<dt>Rule</dt>
<dd>
<p>This is a condition and an action together. The action only runs if the condition is true.<a data-type="indexterm" data-primary="rules" id="idm45816822066872"/></p>
</dd>
</dl>

<p>Now that we’ve defined the concepts in the domain, we translate it into Java! Let’s first define the <code>Condition</code> interface and reuse our existing <code>Action</code> interface as shown in <a data-type="xref" href="#condition_interface">Example 5-26</a>. Note that we could have also used the <code>java.util.function.Predicate</code> interface available since Java 8, but the name <code>Condition</code> better represents our domain.<a data-type="indexterm" data-primary="conditions" data-secondary="defining Condition interface for business rules engine" id="idm45816822062792"/><a data-type="indexterm" data-primary="java.util.function.Predicate&lt;T&gt; interface" id="idm45816822061720"/></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Names are very important in programming because good names help you understand the problem that your code is solving. Names are in many cases more important than the “shape” of the interface (in terms of its parameters and return types), because the names convey contextual information to humans reading the code.</p>
</div>
<div id="condition_interface" data-type="example">
<h5><span class="label">Example 5-26. </span>The Condition interface</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@FunctionalInterface</code>
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Condition</code> <code class="o">{</code>
    <code class="kt">boolean</code> <code class="nf">evaluate</code><code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>Now the remaining question is how to model the concept of a rule? We can define a interface <code>Rule</code> with an operation <code>perform()</code>.<a data-type="indexterm" data-primary="rules" data-secondary="modeling concept of a rule" id="idm45816822049800"/> This will allow you to provide different implementations of a <code>Rule</code>. A suitable default implementation of this interface is a class <code>DefaultRule</code>, which will hold a <code>Condition</code> and <code>Action</code> object together with the appropriate logic<a data-type="indexterm" data-primary="rules" data-secondary="modeling concept of a rule" id="idm45816822047096"/> to perform a rule as shown in <a data-type="xref" href="#modeling_rule">Example 5-27</a>.</p>
<div id="modeling_rule" data-type="example">
<h5><span class="label">Example 5-27. </span>Modeling the concept of a rule</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@FunctionalInterface</code>
<code class="kd">interface</code> <code class="nc">Rule</code> <code class="o">{</code>
    <code class="kt">void</code> <code class="nf">perform</code><code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">);</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">DefaultRule</code> <code class="kd">implements</code> <code class="n">Rule</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Condition</code> <code class="n">condition</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Action</code> <code class="n">action</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">Rule</code><code class="o">(</code><code class="kd">final</code> <code class="n">Condition</code> <code class="n">condition</code><code class="o">,</code> <code class="kd">final</code> <code class="n">Action</code> <code class="n">action</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">condition</code> <code class="o">=</code> <code class="n">condition</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">action</code> <code class="o">=</code> <code class="n">action</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">perform</code><code class="o">(</code><code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code><code class="o">(</code><code class="n">condition</code><code class="o">.</code><code class="na">evaluate</code><code class="o">(</code><code class="n">facts</code><code class="o">)){</code>
            <code class="n">action</code><code class="o">.</code><code class="na">execute</code><code class="o">(</code><code class="n">facts</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>How do we create new rules using all these different elements? <a data-type="indexterm" data-primary="rules" data-secondary="building a rule in business rules engine" id="idm45816822032136"/>You can see an example in <a data-type="xref" href="#building_a_rule">Example 5-28</a>.</p>
<div id="building_a_rule" data-type="example">
<h5><span class="label">Example 5-28. </span>Building a rule</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">final</code> <code class="n">Condition</code> <code class="n">condition</code> <code class="o">=</code> <code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="s">"CEO"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"jobTitle"</code><code class="o">));</code>
<code class="kd">final</code> <code class="n">Action</code> <code class="n">action</code> <code class="o">=</code> <code class="o">(</code><code class="n">Facts</code> <code class="n">facts</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="o">{</code>
      <code class="n">var</code> <code class="n">name</code> <code class="o">=</code> <code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"name"</code><code class="o">);</code>
      <code class="n">Mailer</code><code class="o">.</code><code class="na">sendEmail</code><code class="o">(</code><code class="s">"sales@company.com"</code><code class="o">,</code> <code class="s">"Relevant customer!!!: "</code> <code class="o">+</code> <code class="n">name</code><code class="o">);</code>
<code class="o">};</code>

<code class="kd">final</code> <code class="n">Rule</code> <code class="n">rule</code> <code class="o">=</code> <code class="k">new</code> <code class="n">DefaultRule</code><code class="o">(</code><code class="n">condition</code><code class="o">,</code> <code class="n">action</code><code class="o">);</code></pre></div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Builder Pattern"><div class="sect2" id="idm45816822077224">
<h2>Builder Pattern</h2>

<p>However, even though the code uses names that are close to our domain (<code>Condition</code>, <code>Action</code>, <code>Rule</code>), this code is fairly manual. The user has to instantiate separate objects and assemble things together.<a data-type="indexterm" data-primary="Fluent APIs, designing" data-secondary="using builder pattern" id="ix_FlAPIBld"/><a data-type="indexterm" data-primary="rules" data-secondary="using builder pattern for a Rule" id="idm45816821757704"/><a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="designing a Fluent API" data-tertiary="using builder pattern for rules" id="ix_BREFlAPIBp"/><a data-type="indexterm" data-primary="builder pattern" id="ix_Bldpatt"/> Let’s introduce what’s called the <em>Builder pattern</em> to improve the process of creating a <code>Rule</code> object with the appropriate condition and action. The purpose of this pattern is to allow the creation of an object in a simpler manner. The Builder pattern essentially deconstructs the parameters of a constructor and instead provides methods to supply each of the parameters. The benefit of this approach is that it allows you to declare methods with names that are suitable to the domain at hand. For example, in our case we’d like to use the vocabulary <code>when</code> and <code>then</code>. The code in <a data-type="xref" href="#builder_pattern_declaration_v1">Example 5-29</a> shows how to set up the Builder pattern to build a <code>DefaultRule</code> object. We’ve introduced a method <code>when()</code>, which supplies the condition. The method <code>when()</code> returns <code>this</code> (i.e., the current instance), which will allow us to chain up further methods. We’ve also introduced a method <code>then()</code>, which will supply the action. The method <code>then()</code> also returns <code>this</code>, which allows us to further chain a method. Finally, the method <code>createRule()</code> is responsible for the creation of the <code>DefaultRule</code> object.</p>
<div id="builder_pattern_declaration_v1" data-type="example">
<h5><span class="label">Example 5-29. </span>Builder pattern for a Rule</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">RuleBuilder</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="n">Condition</code> <code class="n">condition</code><code class="o">;</code>
    <code class="kd">private</code> <code class="n">Action</code> <code class="n">action</code><code class="o">;</code>

    <code class="kd">public</code> <code class="n">RuleBuilder</code> <code class="nf">when</code><code class="o">(</code><code class="kd">final</code> <code class="n">Condition</code> <code class="n">condition</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">condition</code> <code class="o">=</code> <code class="n">condition</code><code class="o">;</code>
        <code class="k">return</code> <code class="k">this</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">RuleBuilder</code> <code class="nf">then</code><code class="o">(</code><code class="kd">final</code> <code class="n">Action</code> <code class="n">action</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">action</code> <code class="o">=</code> <code class="n">action</code><code class="o">;</code>
        <code class="k">return</code> <code class="k">this</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">Rule</code> <code class="nf">createRule</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">new</code> <code class="nf">DefaultRule</code><code class="o">(</code><code class="n">condition</code><code class="o">,</code> <code class="n">action</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>Using this new class, you can create <code>RuleBuilder</code> and configure a <code>Rule</code> using the methods <code>when()</code>, <code>then()</code>, and <code>createRule()</code> as shown in<a data-type="indexterm" data-primary="builder pattern" data-secondary="using the RuleBuilder" id="idm45816821642168"/><a data-type="indexterm" data-primary="rules" data-secondary="using the RuleBuilder" id="idm45816821641160"/> <a data-type="xref" href="#builder_pattern_usage_v1">Example 5-30</a>. This idea of chaining methods is a key aspect of designing a Fluent API.<a data-type="indexterm" data-primary="chaining methods in Fluent APIs" id="idm45816821639288"/></p>
<div id="builder_pattern_usage_v1" data-type="example">
<h5><span class="label">Example 5-30. </span>Using the RuleBuilder</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">Rule</code> <code class="n">rule</code> <code class="o">=</code> <code class="k">new</code> <code class="n">RuleBuilder</code><code class="o">()</code>
        <code class="o">.</code><code class="na">when</code><code class="o">(</code><code class="n">facts</code> <code class="o">-&gt;</code> <code class="s">"CEO"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"jobTitle"</code><code class="o">)))</code>
        <code class="o">.</code><code class="na">then</code><code class="o">(</code><code class="n">facts</code> <code class="o">-&gt;</code> <code class="o">{</code>
            <code class="n">var</code> <code class="n">name</code> <code class="o">=</code> <code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"name"</code><code class="o">);</code>
            <code class="n">Mailer</code><code class="o">.</code><code class="na">sendEmail</code><code class="o">(</code><code class="s">"sales@company.com"</code><code class="o">,</code> <code class="s">"Relevant customer: "</code> <code class="o">+</code> <code class="n">name</code><code class="o">);</code>
        <code class="o">})</code>
        <code class="o">.</code><code class="na">createRule</code><code class="o">();</code></pre></div>

<p>This code looks more like a query and it leverages the domain at hand: the notion of a rule, <code>when()</code>, and <code>then()</code> as built-in constructs. But it’s not entirely satisfactory because there are still two awkward constructs the user of your API will have to encounter:</p>

<ul>
<li>
<p>Instantiate an “empty” <code>RuleBuilder</code></p>
</li>
<li>
<p>Call the method <code>createRule()</code></p>
</li>
</ul>

<p>We can improve this by coming up with a slightly improved API. There are three possible <a data-type="indexterm" data-primary="builder pattern" data-secondary="improvements to RuleBuilder" id="idm45816821588456"/><a data-type="indexterm" data-primary="rules" data-secondary="improving the RuleBuilder" id="idm45816821587512"/>improvements:</p>

<ul>
<li>
<p>We’ll make the constructor private so that it can not be invoked explicitly by a user. This means that we will need to come up with a different entry point for our API.</p>
</li>
<li>
<p>We can make the method <code>when()</code>  static so it’s invoked directly and essentially short circuits the invocation to the old constructor. In addition, a static factor method improves discoverability of what’s the right method to use to set up <code>Rule</code> objects.</p>
</li>
<li>
<p>The method <code>then()</code> will become responsible for the final creation of our <span class="keep-together"><code>DefaultRule</code></span> object.</p>
</li>
</ul>

<p><a data-type="xref" href="#builder_pattern_declaration_v2">Example 5-31</a> shows the improved <code>RuleBuilder</code>.</p>
<div id="builder_pattern_declaration_v2" data-type="example">
<h5><span class="label">Example 5-31. </span>Improved RuleBuilder</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">RuleBuilder</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Condition</code> <code class="n">condition</code><code class="o">;</code>

    <code class="kd">private</code> <code class="nf">RuleBuilder</code><code class="o">(</code><code class="kd">final</code> <code class="n">Condition</code> <code class="n">condition</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">condition</code> <code class="o">=</code> <code class="n">condition</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kd">static</code> <code class="n">RuleBuilder</code> <code class="nf">when</code><code class="o">(</code><code class="kd">final</code> <code class="n">Condition</code> <code class="n">condition</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">new</code> <code class="nf">RuleBuilder</code><code class="o">(</code><code class="n">condition</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">Rule</code> <code class="nf">then</code><code class="o">(</code><code class="kd">final</code> <code class="n">Action</code> <code class="n">action</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">new</code> <code class="nf">DefaultRule</code><code class="o">(</code><code class="n">condition</code><code class="o">,</code> <code class="n">action</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>You can now simply create rules by starting with the <code>RuleBuilder.when()</code> method followed by the <code>then()</code> method as shown in <a data-type="xref" href="#improvedRulebuilder">Example 5-32</a>.</p>
<div id="improvedRulebuilder" data-type="example">
<h5><span class="label">Example 5-32. </span>Using the improved RuleBuilder</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">final</code> <code class="n">Rule</code> <code class="n">ruleSendEmailToSalesWhenCEO</code> <code class="o">=</code> <code class="n">RuleBuilder</code>
        <code class="o">.</code><code class="na">when</code><code class="o">(</code><code class="n">facts</code> <code class="o">-&gt;</code> <code class="s">"CEO"</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"jobTitle"</code><code class="o">)))</code>
        <code class="o">.</code><code class="na">then</code><code class="o">(</code><code class="n">facts</code> <code class="o">-&gt;</code> <code class="o">{</code>
            <code class="n">var</code> <code class="n">name</code> <code class="o">=</code> <code class="n">facts</code><code class="o">.</code><code class="na">getFact</code><code class="o">(</code><code class="s">"name"</code><code class="o">);</code>
            <code class="n">Mailer</code><code class="o">.</code><code class="na">sendEmail</code><code class="o">(</code><code class="s">"sales@company.com"</code><code class="o">,</code> <code class="s">"Relevant customer!!!: "</code> <code class="o">+</code> <code class="n">name</code><code class="o">);</code>
        <code class="o">});</code></pre></div>

<p>Now that we’ve refactored the <code>RuleBuilder</code>, we can <a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="designing a Fluent API" data-tertiary="updating to support rules" id="idm45816821345704"/><a data-type="indexterm" data-primary="rules" data-secondary="updating BusinessRuleEngine to support rules" id="idm45816821344520"/>refactor the Business Rules Engine to support rules instead of just actions, as shown in  <a data-type="xref" href="#builder_pattern_usage_v2">Example 5-33</a>.</p>
<div id="builder_pattern_usage_v2" data-type="example">
<h5><span class="label">Example 5-33. </span>Updated Business Rules Engine</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BusinessRuleEngine</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Rule</code><code class="o">&gt;</code> <code class="n">rules</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">BusinessRuleEngine</code><code class="o">(</code><code class="kd">final</code> <code class="n">Facts</code> <code class="n">facts</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">facts</code> <code class="o">=</code> <code class="n">facts</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">rules</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">addRule</code><code class="o">(</code><code class="kd">final</code> <code class="n">Rule</code> <code class="n">rule</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">rules</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">rule</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">run</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">rules</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">rule</code> <code class="o">-&gt;</code> <code class="n">rule</code><code class="o">.</code><code class="na">perform</code><code class="o">(</code><code class="n">facts</code><code class="o">));</code>
    <code class="o">}</code>

<code class="o">}</code></pre></div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Takeaways"><div class="sect1" id="idm45816821872328">
<h1>Takeaways</h1>

<ul>
<li>
<p>The test-driven development philosophy starts with writing some tests that are going to let you guide the implementation of the code.<a data-type="indexterm" data-primary="Fluent APIs, designing" data-secondary="using builder pattern" data-startref="ix_FlAPIBld" id="idm45816821232376"/><a data-type="indexterm" data-primary="builder pattern" data-startref="ix_Bldpatt" id="idm45816821231128"/><a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="designing a Fluent API" data-tertiary="using builder pattern for rules" data-startref="ix_BREFlAPIBp" id="idm45816821230184"/><a data-type="indexterm" data-primary="business rules engine (example)" data-secondary="designing a Fluent API" data-startref="ix_BREFlAPI" id="idm45816821228760"/><a data-type="indexterm" data-primary="APIs" data-secondary="designing a Fluent API" data-startref="ix_APIFl" id="idm45816821227576"/><a data-type="indexterm" data-primary="Fluent APIs, designing" data-startref="ix_FlAPI" id="idm45816821226360"/></p>
</li>
<li>
<p>Mocking allows you to write unit tests that assert that certain behaviors are <span class="keep-together">triggered</span>.</p>
</li>
<li>
<p>Java supports local variable type inferences and switch expressions.</p>
</li>
<li>
<p>The Builder pattern helps design a user-friendly API for instantiating complex objects.</p>
</li>
<li>
<p>The Interface Segregation Principle helps promote high cohesion by reducing dependence on unnecessary methods. This is achieved by breaking up large interfaces into smaller cohesive interfaces so that users only see what they need.</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Iterating on You"><div class="sect1" id="idm45816821220648">
<h1>Iterating on You</h1>

<p>If you want to extend and solidify the knowledge from this chapter you could try one of these activities:</p>

<ul>
<li>
<p>Enhance the <code>Rule</code> and <code>RuleBuilder</code> to support a name and description.</p>
</li>
<li>
<p>Enhance the <code>Facts</code> class so the facts can be loaded from a JSON file.</p>
</li>
<li>
<p>Enhance the Business Rules Engine to support rules having multiple conditions.</p>
</li>
<li>
<p>Enhance the Business Rules Engine to support rules with different priorities.</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Completing the Challenge"><div class="sect1" id="idm45816821213624">
<h1>Completing the Challenge</h1>

<p>Your business is booming and your company has adopted the Business Rules Engine as part of its workflow! You are now looking for your next idea and want to put your software development skills to something new that will help the world rather than just your company. <a data-type="indexterm" data-primary="business rules engine (example)" data-startref="ix_BRE" id="idm45816821212040"/>It’s time to jump to the next chapter—Twootr!</p>
</div></section>







</div></section></div>



  </body></html>