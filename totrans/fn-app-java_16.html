<html><head></head><body>
<div id="sbo-rt-content"><section data-pdf-bookmark="Chapter 14. Functional Design Patterns" data-type="chapter" epub:type="chapter"><div class="chapter" id="_02-design-patterns">
<h1><span class="label">Chapter 14. </span>Functional Design Patterns</h1>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45115216140656">
<h1>A Note for Early Release Readers</h1>
<p>With Early Release ebooks, you get books in their earliest form—the author’s raw and unedited content as they write—so you can take advantage of these technologies long before the official release of these titles.</p>
<p>This will be the 14th chapter of the final book. Please note that the GitHub repo will be made active later on.</p>
<p>If you have comments about how we might improve the content and/or examples in this book, or if you notice missing material within this chapter, please reach out to the editor at <em>rfernando@oreilly.com</em>.</p>
</div></aside>
<p>Functional programming’s answer to object-oriented design patterns is usually “just use functions instead.”
Technically, that’s correct; it’s <em>turtles all the way down</em>⁠<sup><a data-type="noteref" href="ch14.xhtml#idm45115216136896" id="idm45115216136896-marker">1</a></sup> with functional programming.
However, coming from an object-oriented mindset wanting to augment your code with functional principles, more practical advice is required to utilize known patterns in a functional fashion.</p>
<p>This chapter will examine some of the commonly used object-oriented design patterns described by the <em>gang of four</em>⁠<sup><a data-type="noteref" href="ch14.xhtml#idm45115216134368" id="idm45115216134368-marker">2</a></sup>, and how they can benefit from a functional approach.</p>
<section data-pdf-bookmark="What Are Design Patterns?" data-type="sect1"><div class="sect1" id="idm45115216133456">
<h1>What Are Design Patterns?</h1>
<p>You don’t have to reinvent the wheel every time you need to solve a problem.
Many of them have already been solved, or at least a general approach to a fitting solution exists in the form of a design pattern.
As a Java developer, you most likely used or came across one or more object-oriented design patterns already, even if you didn’t know it at the time.</p>
<p>In essence, object-oriented design patterns are tested, proven, formalized, and repeatable solutions to common problems.</p>
<p>The <em>gang of four</em> categorized the patterns they describe into three groups:</p>
<dl>
<dt>Behavioral patterns</dt>
<dd>
<p>How to deal with responsibilities of and communication between objects.</p>
</dd>
<dt>Creational patterns</dt>
<dd>
<p>How to abstract the object creation/instantiation process, to help create, compose, and represent objects.</p>
</dd>
<dt>Structural patterns</dt>
<dd>
<p>How to compose objects to form larger or enhanced objects.</p>
</dd>
</dl>
<p>Design patterns are general scaffolds to make knowledge shareable with concepts on applying them to specific problems.
That’s why not every language or approach fits every pattern.
Especially in functional programming, many problems don’t require a certain pattern besides “just functions.”</p>
</div></section>
<section data-pdf-bookmark="(Functional) Design Patterns" data-type="sect1"><div class="sect1" id="idm45115216125152">
<h1>(Functional) Design Patterns</h1>
<p>Let’s take a look at four commonly used object-oriented design patterns and how to approach them functionally:</p>
<ul>
<li>
<p>Factory pattern (creational)</p>
</li>
<li>
<p>Decorator pattern (structural)</p>
</li>
<li>
<p>Strategy pattern (behavioral)</p>
</li>
<li>
<p>Builder pattern (creational)</p>
</li>
</ul>
<section data-pdf-bookmark="Factory Pattern" data-type="sect2"><div class="sect2" id="_02-design-patterns_factory">
<h2>Factory Pattern</h2>
<p>The <em>factory pattern</em> belongs to the group of <em>creational patterns</em>.
Its purpose is to create an instance of an object without exposing the implementation details of <em>how to create</em> such objects by using a <em>factory</em> instead.</p>
<section data-pdf-bookmark="Object-Oriented Approach" data-type="sect3"><div class="sect3" id="idm45115216115552">
<h3>Object-Oriented Approach</h3>
<p>There are multiple ways of implementing the factory pattern.
For my example, all objects have a shared interface, and an <code>enum</code> is responsible for identifying the desired object type:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Shape</code> <code class="p">{</code>
  <code class="kt">int</code> <code class="nf">corners</code><code class="p">();</code>
  <code class="n">Color</code> <code class="nf">color</code><code class="p">();</code>
  <code class="n">ShapeType</code> <code class="nf">type</code><code class="p">();</code>
<code class="p">}</code>

<code class="kd">public</code> <code class="kd">enum</code> <code class="n">ShapeType</code> <code class="p">{</code>
  <code class="n">CIRCLE</code><code class="p">,</code>
  <code class="n">TRIANGLE</code><code class="p">,</code>
  <code class="n">SQUARE</code><code class="p">,</code>
  <code class="n">PENTAGON</code><code class="p">;</code>
<code class="p">}</code></pre>
<p>Shapes are represented by Records, which only need a <code>Color</code>, as they can deduct their other properties directly.
A simple <code>Circle</code> Record might look like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">record</code> <code class="nc">Circle</code><code class="p">(</code><code class="n">Color</code> <code class="n">color</code><code class="p">)</code> <code class="kd">implements</code> <code class="n">Shape</code> <code class="p">{</code>

  <code class="kd">public</code> <code class="kt">int</code> <code class="nf">corners</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="mi">0</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="kd">public</code> <code class="n">ShapeType</code> <code class="nf">type</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="n">ShapeType</code><code class="p">.</code><code class="na">CIRCLE</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p>A <code>Shape</code> factory needs to accept the <code>type</code> and <code>color</code> to create the corresponding <code>Shape</code> instance, as follows:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ShapeFactory</code> <code class="p">{</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">Shape</code> <code class="nf">newShape</code><code class="p">(</code><code class="n">ShapeType</code> <code class="n">type</code><code class="p">,</code>
                               <code class="n">Color</code> <code class="n">color</code><code class="p">)</code> <code class="p">{</code>
    <code class="n">Objects</code><code class="p">.</code><code class="na">requireNonNull</code><code class="p">(</code><code class="n">color</code><code class="p">);</code>

    <code class="k">return</code> <code class="k">switch</code> <code class="p">(</code><code class="n">type</code><code class="p">)</code> <code class="p">{</code>
      <code class="k">case</code> <code class="n">CIRCLE</code> <code class="o">-&gt;</code> <code class="k">new</code> <code class="n">Circle</code><code class="p">(</code><code class="n">color</code><code class="p">);</code>
      <code class="k">case</code> <code class="n">TRIANGLE</code> <code class="o">-&gt;</code> <code class="k">new</code> <code class="n">Triangle</code><code class="p">(</code><code class="n">color</code><code class="p">);</code>
      <code class="k">case</code> <code class="n">SQUARE</code> <code class="o">-&gt;</code> <code class="k">new</code> <code class="n">Square</code><code class="p">(</code><code class="n">color</code><code class="p">);</code>
      <code class="k">case</code> <code class="n">PENTAGON</code> <code class="o">-&gt;</code> <code class="k">new</code> <code class="n">Pentagon</code><code class="p">(</code><code class="n">color</code><code class="p">);</code>
      <code class="k">default</code> <code class="o">-&gt;</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">IllegalArgumentException</code><code class="p">(</code><code class="s">"Unknown type: "</code> <code class="o">+</code> <code class="n">type</code><code class="p">);</code>
    <code class="p">};</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p>Looking at all the code involved so far, there are four distinct parts to the pattern:</p>
<ul>
<li>
<p>The shared <code>interface Shape</code></p>
</li>
<li>
<p>The shape-identifying <code>enum ShapeType</code></p>
</li>
<li>
<p>The concrete implementations of shapes (not shown)</p>
</li>
<li>
<p>The <code>ShapeFactory</code> to create shapes based on their <code>type</code> and <code>color</code></p>
</li>
</ul>
<p>These parts depend on each other, which is expected.
Still, this interdependence of the factory and the <code>enum</code> makes the whole approach fragile to change.
If a new <code>ShapeType</code> is introduced, the factory has to account for it, or an <code>IllegalArgumentException</code> is thrown in the <code>default</code> case of the <code>switch</code>, even if a concrete implementation type exists.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The <code>default</code> case isn’t necessarily needed, as all cases are declared.
It’s used to illustrate the dependency between <code>ShapeType</code> and <code>ShapeFactory</code> and how to alleviate it.</p>
</div>
<p>To improve the factory, its fragility can be reduced by introducing compile-time validation with a more functional approach.</p>
</div></section>
<section data-pdf-bookmark="A More Functional Approach" data-type="sect3"><div class="sect3" id="idm45115216114896">
<h3>A More Functional Approach</h3>
<p>This example creates quite simplistic Records that only need a singular argument: <code>Color</code>.
These identical constructors give you the possibility to move the “factory” directly into the <code>enum</code>, so any new shape automatically requires a corresponding factory function.</p>
<p>Even though Java’s <code>enum</code> types are based on constant names, you can attach a corresponding value for each constant.
In this case, a factory function for creating the discrete object in the form of a <code>Function&lt;Color, Shape&gt;</code> value:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">ShapeType</code> <code class="p">{</code>
  <code class="n">CIRCLE</code><code class="p">,</code>
  <code class="n">TRIANGLE</code><code class="p">,</code>
  <code class="n">SQUARE</code><code class="p">,</code>
  <code class="n">PENTAGON</code><code class="p">;</code>

  <code class="kd">public</code> <code class="kd">final</code> <code class="n">Function</code><code class="o">&lt;</code><code class="n">Color</code><code class="p">,</code> <code class="n">Shape</code><code class="o">&gt;</code> <code class="n">factory</code><code class="p">;</code>

  <code class="n">ShapeType</code><code class="p">(</code><code class="n">Function</code><code class="o">&lt;</code><code class="n">Color</code><code class="p">,</code> <code class="n">Shape</code><code class="o">&gt;</code> <code class="n">factory</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">this</code><code class="p">.</code><code class="na">factory</code> <code class="o">=</code> <code class="n">factory</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p>The code no longer compiles, because the constant declaration now requires an additional <code>Function&lt;Color, Shape&gt;</code>.
Luckily, the Shapes’ constructors are usable as method references to create quite concise code for the factory methods:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">ShapeType</code> <code class="p">{</code>
  <code class="n">CIRCLE</code><code class="p">(</code><code class="n">Circle</code><code class="p">::</code><code class="k">new</code><code class="p">),</code>
  <code class="n">TRIANGLE</code><code class="p">(</code><code class="n">Triangle</code><code class="p">::</code><code class="k">new</code><code class="p">),</code>
  <code class="n">SQUARE</code><code class="p">(</code><code class="n">Square</code><code class="p">::</code><code class="k">new</code><code class="p">),</code>
  <code class="n">PENTAGON</code><code class="p">(</code><code class="n">Pentagon</code><code class="p">::</code><code class="k">new</code><code class="p">);</code>

  <code class="c1">// ...</code>
<code class="p">}</code></pre>
<p>The <code>enum</code> gained the discrete creation methods as an attached value to each of its constants.
This way, any future additions, like, for example, <code>HEXAGON</code>, force you to provide an appropriate factory method without the possibility to miss it, as the compiler will enforce it.</p>
<p>Now all that’s left is the ability to create new instances.
You could simply use the <code>factory</code> field and its SAM <code>accept(Color color)</code> directly, but I prefer an additional method to allow for sanity checks:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">ShapeType</code> <code class="p">{</code>

  <code class="c1">// ...</code>

  <code class="kd">public</code> <code class="n">Shape</code> <code class="nf">newInstance</code><code class="p">(</code><code class="n">Color</code> <code class="n">color</code><code class="p">)</code> <code class="p">{</code>
    <code class="n">Objects</code><code class="p">.</code><code class="na">requireNonNull</code><code class="p">(</code><code class="n">color</code><code class="p">);</code>
    <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="na">factory</code><code class="p">.</code><code class="na">apply</code><code class="p">(</code><code class="n">color</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p>Creating a new <code>Shape</code> instance is now quite easy:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">var</code> <code class="n">redCircle</code> <code class="o">=</code> <code class="n">ShapeType</code><code class="p">.</code><code class="na">CIRCLE</code><code class="p">.</code><code class="na">newInstance</code><code class="p">(</code><code class="n">Color</code><code class="p">.</code><code class="na">RED</code><code class="p">);</code></pre>
<p>The <code>public</code> field <code>factory</code> might seem redundant now that a dedicated method for instance creation is available.
That’s kind of true.
Still, it provides a functional way to interact with the factory further, like functional composition to log the creation of a shape:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">Function</code><code class="o">&lt;</code><code class="n">Shape</code><code class="p">,</code> <code class="n">Shape</code><code class="o">&gt;</code> <code class="n">cornerPrint</code> <code class="o">=</code>
  <code class="n">shape</code> <code class="o">-&gt;</code> <code class="p">{</code>
    <code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">"Shape created with "</code> <code class="o">+</code> <code class="n">shape</code><code class="p">.</code><code class="na">corners</code><code class="p">()</code> <code class="o">+</code> <code class="s">" corners."</code><code class="p">);</code>
  <code class="p">};</code>

<code class="n">ShapeType</code><code class="p">.</code><code class="na">CIRCLE</code><code class="p">.</code><code class="na">factory</code><code class="p">.</code><code class="na">andThen</code><code class="p">(</code><code class="n">cornerPrint</code><code class="p">)</code>
                        <code class="p">.</code><code class="na">apply</code><code class="p">(</code><code class="n">Color</code><code class="p">.</code><code class="na">RED</code><code class="p">);</code></pre>
<p>By fusing the factory with the <code>enum</code>, the decision-making process — what factory method to call — gets replaced by binding the factory methods directly with <code>ShapeType</code> counterparts.
The Java compiler now forces you to implement the factory on any addition to the <code>enum</code>.</p>
<p>This approach reduces the required boilerplate with added compile-time safety for future extensions.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Decorator Pattern" data-type="sect2"><div class="sect2" id="idm45115215755104">
<h2>Decorator Pattern</h2>
<p>The <em>decorator pattern</em> is a <em>structural pattern</em> that allows modifying object behavior at runtime.
Instead of sub-classing, an object is wrapped inside a “decorator” that contains the desired behavior.</p>
<section data-pdf-bookmark="Object-Oriented Approach" data-type="sect3"><div class="sect3" id="idm45115215408000">
<h3>Object-Oriented Approach</h3>
<p>The object-oriented implementation of this pattern requires that the decorators share an interface with the type they’re supposed to decorate.
To simplify writing a new decorator, an <code>abstract</code> class implementing the shared interface is used as a starting point for any decorator.</p>
<p>Imagine a coffee maker with a singular method to prepare coffee.
The shared interface and the concrete implementation are as follows:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">CoffeeMaker</code> <code class="p">{</code>
  <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getIngredients</code><code class="p">();</code>
  <code class="n">Coffee</code> <code class="nf">prepare</code><code class="p">();</code>
<code class="p">}</code>


<code class="kd">public</code> <code class="kd">class</code> <code class="nc">BlackCoffeeMaker</code> <code class="kd">implements</code> <code class="n">CoffeeMaker</code> <code class="p">{</code>

  <code class="nd">@Override</code>
  <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getIngredients</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="n">List</code><code class="p">.</code><code class="na">of</code><code class="p">(</code><code class="s">"Robusta Beans"</code><code class="p">,</code> <code class="s">"Water"</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="nd">@Override</code>
  <code class="kd">public</code> <code class="n">Coffee</code> <code class="nf">prepare</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="k">new</code> <code class="n">BlackCoffee</code><code class="p">();</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p>The goal is to decorate the coffee maker to add functionality like adding milk or sugar to your coffee.
Therefore, a decorator has to accept the coffee maker and decorate the <code>prepare</code> method.
A simple shared <code>abstract</code> decorator is shown in <a data-type="xref" href="#_02-design-patterns_decorator-pattern_decorator">???</a>.</p>
<pre data-code-language="java" data-type="programlisting" id="_02-design-patterns_decorator-pattern_decorator"><code class="kd">public</code> <code class="kd">abstract</code> <code class="kd">class</code> <code class="nc">Decorator</code> <code class="kd">implements</code> <code class="n">CoffeeMaker</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO1-1" id="co_functional_design_patterns_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a>

  <code class="kd">private</code> <code class="kd">final</code> <code class="n">CoffeeMaker</code> <code class="n">target</code><code class="p">;</code>

  <code class="kd">public</code> <code class="nf">Decorator</code><code class="p">(</code><code class="n">CoffeeMaker</code> <code class="n">target</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO1-2" id="co_functional_design_patterns_CO1-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a>
    <code class="k">this</code><code class="p">.</code><code class="na">target</code> <code class="o">=</code> <code class="n">target</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="nd">@Override</code>
  <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getIngredients</code><code class="p">(</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO1-3" id="co_functional_design_patterns_CO1-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a>
    <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="na">target</code><code class="p">.</code><code class="na">getIngredients</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="nd">@Override</code>
  <code class="kd">public</code> <code class="n">Coffee</code> <code class="nf">prepare</code><code class="p">(</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO1-3" id="co_functional_design_patterns_CO1-4"><img alt="3" height="12" src="assets/3.png" width="12"/></a>
    <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="na">target</code><code class="p">.</code><code class="na">prepare</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_functional_design_patterns_CO1-1" id="callout_functional_design_patterns_CO1-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The <code>Decorator</code> implements <code>CoffeeMaker</code> so it’s usable as a drop-in replacement.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO1-2" id="callout_functional_design_patterns_CO1-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>The constructor accepts the original <code>CoffeeMaker</code> instance that’s supposed to be decorated.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO1-3" id="callout_functional_design_patterns_CO1-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>The <code>getIngredients</code> and <code>prepare</code> methods simply call the decorated <code>CoffeeMaker</code>, so any actual decorator can use a <code>super</code> call to get the “original” result.</p></dd>
</dl>
<p>The <code>abstract Decorator</code> type aggregates the minimal required functionality to decorate a <code>CoffeeMaker</code> in a singular type.
With its help, adding steamed milk to your coffee is straightforward.
All you need now is a milk carton, as seen in <a data-type="xref" href="#_02-design-patterns_decorator-pattern_add-milk-decorator">Example 14-1</a>.</p>
<div data-type="example" id="_02-design-patterns_decorator-pattern_add-milk-decorator">
<h5><span class="label">Example 14-1. </span>Adding milk with a decorator</h5>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">AddMilkDecorator</code> <code class="kd">extends</code> <code class="n">Decorator</code> <code class="p">{</code>

  <code class="kd">private</code> <code class="kd">final</code> <code class="n">MilkCarton</code> <code class="n">milkCarton</code><code class="p">;</code>

  <code class="kd">public</code> <code class="nf">AddMilkDecorator</code><code class="p">(</code><code class="n">CoffeeMaker</code> <code class="n">target</code><code class="p">,</code>
                          <code class="n">MilkCarton</code> <code class="n">milkCarton</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO2-1" id="co_functional_design_patterns_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a>
    <code class="kd">super</code><code class="p">(</code><code class="n">target</code><code class="p">)</code><code class="p">;</code>

    <code class="k">this</code><code class="p">.</code><code class="na">milkCarton</code> <code class="o">=</code> <code class="n">milkCarton</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="nd">@Override</code>
  <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getIngredients</code><code class="p">(</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO2-2" id="co_functional_design_patterns_CO2-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a>
    <code class="kd">var</code> <code class="n">newIngredients</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="p">(</code><code class="kd">super</code><code class="p">.</code><code class="na">getIngredients</code><code class="p">(</code><code class="p">)</code><code class="p">)</code><code class="p">;</code>
    <code class="n">newIngredients</code><code class="p">.</code><code class="na">add</code><code class="p">(</code><code class="s">"</code><code class="s">Milk</code><code class="s">"</code><code class="p">)</code><code class="p">;</code>
    <code class="k">return</code> <code class="n">newIngredients</code><code class="p">;</code>
  <code class="p">}</code>


  <code class="nd">@Override</code>
  <code class="kd">public</code> <code class="n">Coffee</code> <code class="nf">prepare</code><code class="p">(</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO2-3" id="co_functional_design_patterns_CO2-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a>
    <code class="kd">var</code> <code class="n">coffee</code> <code class="o">=</code> <code class="kd">super</code><code class="p">.</code><code class="na">prepare</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
    <code class="n">coffee</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="na">milkCarton</code><code class="p">.</code><code class="na">pourInto</code><code class="p">(</code><code class="n">coffee</code><code class="p">)</code><code class="p">;</code>
    <code class="k">return</code> <code class="n">coffee</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" href="#co_functional_design_patterns_CO2-1" id="callout_functional_design_patterns_CO2-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The constructor needs to accept all the requirements, so a <code>MilkCarton</code> is needed in addition to the <code>CoffeeMaker</code>.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO2-2" id="callout_functional_design_patterns_CO2-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>The decorator hooks into the <code>getIngredients</code> call by first calling <code>super</code>, making the result mutable, and add the milk to the list of previously used ingredients.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO2-3" id="callout_functional_design_patterns_CO2-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>The <code>prepare</code> call also tasks <code>super</code> to do its intended purpose and “decorates” the resulting coffee with milk.</p></dd>
</dl>
<p>Creating a “café con leche<sup><a data-type="noteref" href="ch14.xhtml#idm45115214894800" id="idm45115214894800-marker">3</a></sup>" is quite easy now:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">CoffeeMaker</code> <code class="n">coffeeMaker</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BlackCoffeeMaker</code><code class="p">();</code>

<code class="n">CoffeeMaker</code> <code class="n">decoratedCoffeeMaker</code> <code class="o">=</code>
  <code class="k">new</code> <code class="n">AddMilkDecorator</code><code class="p">(</code><code class="n">coffeeMaker</code><code class="p">,</code>
                       <code class="k">new</code> <code class="n">MilkCarton</code><code class="p">());</code>

<code class="n">Coffee</code> <code class="n">cafeConLeche</code> <code class="o">=</code> <code class="n">decoratedCoffeeMaker</code><code class="p">.</code><code class="na">prepare</code><code class="p">();</code></pre>
<p>The decorator pattern is pretty straightforward to implement.
Still, that’s quite a lot of code to pour some milk into your coffee.
If you take sugar in your coffee, too, you need to create another decorator with redundant boilerplate code and need to wrap the decorated <code>CoffeeMaker</code> again:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">CoffeeMaker</code> <code class="n">coffeeMaker</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BlackCoffeeMaker</code><code class="p">();</code>

<code class="n">CoffeeMaker</code> <code class="n">firstDecoratedCoffeeMaker</code> <code class="o">=</code>
  <code class="k">new</code> <code class="n">AddMilkDecorator</code><code class="p">(</code><code class="n">coffeeMaker</code><code class="p">,</code>
                       <code class="k">new</code> <code class="n">MilkCarton</code><code class="p">());</code>

<code class="n">CoffeeMaker</code> <code class="n">lastDecoratedCoffeeMaker</code> <code class="o">=</code>
  <code class="k">new</code> <code class="n">AddSugarDecorator</code><code class="p">(</code><code class="n">firstDecoratedCoffeeMaker</code><code class="p">);</code>


<code class="n">Coffee</code> <code class="n">lastDecoratedCoffeeMaker</code> <code class="o">=</code> <code class="n">coffeeMaker</code><code class="p">.</code><code class="na">prepare</code><code class="p">();</code></pre>
<p>There has to be a simpler way to improve the creation of a decorator and the process of using multiple decorators.</p>
<p>So let’s take a look at how to use functional composition instead.</p>
</div></section>
<section data-pdf-bookmark="A More Functional Approach" data-type="sect3"><div class="sect3" id="idm45115215407376">
<h3>A More Functional Approach</h3>
<p>The first step to any refactoring effort toward a more functional approach is dissecting what’s actually happening.
The decorator pattern consists of two parts that are suitable for improvement:</p>
<ul>
<li>
<p>Decorating a <code>CoffeeMaker</code> with one or more decorators</p>
</li>
<li>
<p>Creating a <code>Decorator</code> itself</p>
</li>
</ul>
<p>The first part of “how to decorate” boils down to taking an existing <code>CoffeeMaker</code> and “somehow” adding the new behavior and returning a new <code>CoffeeMaker</code> to be used instead.
So, in essence, the process looks like a <code>Function&lt;CofeeMaker, CoffeeMaker&gt;</code>.</p>
<p>As before, the logic is bundled as a <code>static</code> higher-order method in a convenience type.
This method accepts a <code>CoffeeMaker</code> and a decorator and combines them with functional composition:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">Barista</code> <code class="p">{</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">CoffeeMaker</code> <code class="nf">decorate</code><code class="p">(</code><code class="n">CoffeeMaker</code> <code class="n">coffeeMaker</code><code class="p">,</code>
                                     <code class="n">Function</code><code class="o">&lt;</code><code class="n">CoffeeMaker</code><code class="p">,</code> <code class="n">CoffeeMaker</code><code class="o">&gt;</code> <code class="n">decorator</code><code class="p">)</code> <code class="p">{</code>

    <code class="k">return</code> <code class="n">decorator</code><code class="p">.</code><code class="na">apply</code><code class="p">(</code><code class="n">coffeeMaker</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="kd">private</code> <code class="nf">Barista</code><code class="p">()</code> <code class="p">{</code>
    <code class="c1">// Suppress default constructor.</code>
    <code class="c1">// Ensures non-instantiability and non-extendability.</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p>The <code>Barista</code> class has a parameterized <code>decorate</code> method that inverts the flow by accepting a <code>Function&lt;CofeeMaker, CoffeeMaker&gt;</code> to actually do the process of decoration.
Even though the decoration “feels” more functional now, accepting only a singular <code>Function</code> makes the process still tedious for more than one decorator:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">CoffeeMaker</code> <code class="n">decoratedCoffeeMaker</code> <code class="o">=</code>
  <code class="n">Barista</code><code class="p">.</code><code class="na">decorate</code><code class="p">(</code><code class="k">new</code> <code class="n">BlackCoffeeMaker</code><code class="p">(),</code>
                   <code class="n">coffeeMaker</code> <code class="o">-&gt;</code> <code class="k">new</code> <code class="n">AddMilkDecorator</code><code class="p">(</code><code class="n">coffeeMaker</code><code class="p">,</code>
                                                       <code class="k">new</code> <code class="n">MilkCarton</code><code class="p">()));</code>

<code class="n">CoffeeMaker</code> <code class="n">finalCoffeeMaker</code> <code class="o">=</code>
  <code class="n">Barista</code><code class="p">.</code><code class="na">decorate</code><code class="p">(</code><code class="n">decoratedCoffeeMaker</code><code class="p">,</code>
                   <code class="n">AddSugarDecorator</code><code class="p">::</code><code class="k">new</code><code class="p">);</code></pre>
<p>Thankfully, there’s a functional API to process multiple elements in sequence I discussed in <a data-type="xref" href="ch06.xhtml#_02-data-processing">Chapter 6</a>: Streams.</p>
<p>The decoration process is effectively a <em>reduction</em>, with the original <code>CoffeMaker</code> as its initial value, and the <code>Function&lt;CoffeeMaker, CoffeeMaker&gt;</code> accepting the previous value to create the new <code>CoffeeMaker</code>.
Therefore, the decoration process would look like in <a data-type="xref" href="#_02-design-patterns_decorator_functional-01">Example 14-2</a>.</p>
<div data-type="example" id="_02-design-patterns_decorator_functional-01">
<h5><span class="label">Example 14-2. </span>Multiple decorations by reduction</h5>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">Barista</code> <code class="p">{</code>

 <code class="kd">public</code> <code class="kd">static</code>
 <code class="n">CoffeeMaker</code> <code class="nf">decorate</code><code class="p">(</code><code class="n">CoffeeMaker</code> <code class="n">coffeeMaker</code><code class="p">,</code> <a class="co" href="#callout_functional_design_patterns_CO3-1" id="co_functional_design_patterns_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a>
                      <code class="n">Function</code><code class="o">&lt;</code><code class="n">CoffeeMaker</code><code class="p">,</code> <code class="n">CoffeeMaker</code><code class="o">&gt;</code><code class="p">.</code><code class="p">.</code><code class="p">.</code> <code class="n">decorators</code><code class="p">)</code> <code class="p">{</code>

    <code class="n">Function</code><code class="o">&lt;</code><code class="n">CoffeeMaker</code><code class="p">,</code> <code class="n">CoffeeMaker</code><code class="o">&gt;</code> <code class="n">reducedDecorations</code> <code class="o">=</code> <a class="co" href="#callout_functional_design_patterns_CO3-2" id="co_functional_design_patterns_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a>
      <code class="n">Arrays</code><code class="p">.</code><code class="na">stream</code><code class="p">(</code><code class="n">decorators</code><code class="p">)</code>
            <code class="p">.</code><code class="na">reduce</code><code class="p">(</code><code class="n">Function</code><code class="p">.</code><code class="na">identity</code><code class="p">(</code><code class="p">)</code><code class="p">,</code>
                    <code class="n">Function</code><code class="p">:</code><code class="p">:</code><code class="n">andThen</code><code class="p">)</code><code class="p">;</code>

    <code class="k">return</code> <code class="n">reducedDecorations</code><code class="p">.</code><code class="na">apply</code><code class="p">(</code><code class="n">coffeeMaker</code><code class="p">)</code><code class="p">;</code> <a class="co" href="#callout_functional_design_patterns_CO3-3" id="co_functional_design_patterns_CO3-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a>
  <code class="p">}</code>
<code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" href="#co_functional_design_patterns_CO3-1" id="callout_functional_design_patterns_CO3-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The <code>decorate</code> method still accepts the orginal <code>CoffeeMaker</code> to decorate.
However, an arbitrary number of decorations can be provided thanks to the vararg argument.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO3-2" id="callout_functional_design_patterns_CO3-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>The decorations are composed with a <code>Stream&lt;Function&lt;CoffeeMaker, CoffeeMaker&gt;</code> by creating a Stream from the array and reducing all the elements to a single <code>Function&lt;CoffeeMaker, CoffeeMaker&gt;</code> by composing each of them.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO3-3" id="callout_functional_design_patterns_CO3-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Finally, the singular reduced decoration is composed with <code>CoffeeMaker</code>.</p></dd>
</dl>
<p>Making a café con leche is now simpler thanks to combining multiple functional and functional-akin techniques:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">CoffeeMaker</code> <code class="n">decoratedCoffeeMaker</code> <code class="o">=</code>
  <code class="n">Barista</code><code class="p">.</code><code class="na">decorate</code><code class="p">(</code><code class="k">new</code> <code class="n">BlackCoffeeMaker</code><code class="p">(),</code>
                   <code class="n">coffeeMaker</code> <code class="o">-&gt;</code> <code class="k">new</code> <code class="n">AddMilkDecorator</code><code class="p">(</code><code class="n">coffeeMaker</code><code class="p">,</code>
                                                       <code class="k">new</code> <code class="n">MilkCarton</code><code class="p">()),</code>
                   <code class="n">AddSugarDecorator</code><code class="p">::</code><code class="k">new</code><code class="p">);</code></pre>
<p>The decoration process is an improvement over nesting the decorators one-by-one, by simplifying it into a single call.
Still, the creation of a decorator could be improved with functions, too.</p>
<p>Instead of creating the decorator in form of a <code>Function&lt;CoffeeMaker, CoffeeMaker&gt;</code> yourself by using either a lambda or method reference, you could use another convenience type to group them together.
This way, you don’t even have to expose the concrete types of the decorators, because only the <code>CoffeeMaker</code> type and additional ingredients like <code>MilkCarton</code> are involved.</p>
<p>The implementation of a <code>Decorations</code> convenience type with its <code>static</code> factory methods is quite straightforward, as shown in the following code:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">Decorations</code> <code class="p">{</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">Function</code><code class="o">&lt;</code><code class="n">CoffeeMaker</code><code class="p">,</code> <code class="n">CoffeeMaker</code><code class="o">&gt;</code> <code class="nf">addMilk</code><code class="p">(</code><code class="n">MilkCarton</code> <code class="n">milkCarton</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code> <code class="n">coffeeMaker</code> <code class="o">-&gt;</code> <code class="k">new</code> <code class="n">AddMilkDecorator</code><code class="p">(</code><code class="n">coffeeMaker</code><code class="p">,</code> <code class="n">milkCarton</code><code class="p">);</code>
  <code class="p">}</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">Function</code><code class="o">&lt;</code><code class="n">CoffeeMaker</code><code class="p">,</code> <code class="n">CoffeeMaker</code><code class="o">&gt;</code> <code class="nf">addSugar</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="n">AddSugarCoffeeMaker</code><code class="p">::</code><code class="k">new</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="c1">// ...</code>
<code class="p">}</code></pre>
<p>All possible ingredients are available through a single type, without any callee needing to know the actual implementation or other requirements besides the arguments of each method.
This way, you can use a more concise and fluent call to decorate your coffee:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">CoffeeMaker</code> <code class="n">maker</code> <code class="o">=</code> <code class="n">Barista</code><code class="p">.</code><code class="na">decorate</code><code class="p">(</code><code class="k">new</code> <code class="n">BlackCoffeeMaker</code><code class="p">(),</code>
                                     <code class="n">Decorations</code><code class="p">.</code><code class="na">addMilk</code><code class="p">(</code><code class="n">milkCarton</code><code class="p">),</code>
                                     <code class="n">Decorations</code><code class="p">.</code><code class="na">addSugar</code><code class="p">());</code>
<code class="kd">var</code> <code class="n">coffee</code> <code class="o">=</code> <code class="n">maker</code><code class="p">.</code><code class="na">prepare</code><code class="p">();</code></pre>
<p>The main advantage of a functional approach is the possible elimination of explicit nesting and exposing the concrete implementation types.
Instead of littering your packages with additional types and repetitive boilerplate, the already existing functional interfaces of the JDK can lend you a hand with more concise code to achieve the same result.
You still should group the related code together, so related functionality is in a single file that can be split up if it would create a better hierarchy, but it doesn’t have to.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Strategy Pattern" data-type="sect2"><div class="sect2" id="idm45115214705984">
<h2>Strategy Pattern</h2>
<p>The <em>strategy pattern</em> belongs to the group of <em>behavioral patterns</em>.
Due to the <em>open-closed</em>⁠<sup><a data-type="noteref" href="ch14.xhtml#idm45115214058832" id="idm45115214058832-marker">4</a></sup> principle that dominates most object-oriented designs, different systems are usually coupled by abstractions, like programming against interfaces instead of concrete implementations.</p>
<p>This <em>abstract coupling</em> provides a useful fiction of more theoretical components working together to be realized later on without your code knowing the actual implementation.
Strategies are using this de-coupled code style to create interchangeable small logic units based on an identical abstraction.
Which one is chosen is decided at runtime.</p>
<section data-pdf-bookmark="Object-Oriented Approach" data-type="sect3"><div class="sect3" id="idm45115214103232">
<h3>Object-Oriented Approach</h3>
<p>Imagine you work on an e-commerce platform that sells physical goods.
Somehow these goods must be shipped to the customer.
There are multiple ways to ship an item, like different shipping companies or the type of shipping.</p>
<p>Such various shipping options share a common abstraction that is then used in another part of your system, like a <code>ShippingService</code> type, to ship the parcel:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">ShippingStrategy</code> <code class="p">{</code>
  <code class="kt">void</code> <code class="nf">ship</code><code class="p">(</code><code class="n">Parcel</code> <code class="n">parcel</code><code class="p">);</code>
<code class="p">}</code>


<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">ShippingService</code> <code class="p">{</code>
  <code class="kt">void</code> <code class="nf">ship</code><code class="p">(</code><code class="n">Parcel</code> <code class="n">parcel</code><code class="p">,</code>
            <code class="n">ShippingStrategy</code> <code class="n">strategy</code><code class="p">);</code>
<code class="p">}</code></pre>
<p>Each of the options is then implemented as a <code>ShipppingStrategy</code>.
In this case, let’s just look at standard and expedited shipping:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">StandardShipping</code> <code class="kd">implements</code> <code class="n">ShippingStrategy</code> <code class="p">{</code>
  <code class="c1">// ...</code>
<code class="p">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">ExpeditedShipping</code> <code class="kd">implements</code> <code class="n">ShippingStrategy</code> <code class="p">{</code>

  <code class="kd">public</code> <code class="nf">ExpeditedShipping</code><code class="p">(</code><code class="kt">boolean</code> <code class="n">signatureRequired</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">//...</code>
  <code class="p">}</code>

  <code class="c1">// ...</code>
<code class="p">}</code></pre>
<p>Each strategy requires its own type and concrete implementation.
This general approach looks quite similar to the decorators I discussed in the previous section.
That’s why it can be simplified in almost the same functional way.</p>
</div></section>
<section data-pdf-bookmark="A More Functional Approach" data-type="sect3"><div class="sect3" id="idm45115213924432">
<h3>A More Functional Approach</h3>
<p>The overall concept behind the <em>strategy pattern</em> boils down to <em>behavioral parameterization</em>.
That means that the <code>ShippingService</code> provides a general scaffold to allow a parcel to be shipped.
How it’s actually shipped, though, needs to be filled with a <code>ShippingStrategy</code> that is passed to it from the outside.</p>
<p>Strategies are supposed to be small and context-bound decisions and are often representable by a functional interface.
In this case, you have multiple options for how to create and use strategies:</p>
<ul>
<li>
<p>Lambdas and method references</p>
</li>
<li>
<p>Partial-applied functions</p>
</li>
<li>
<p>Concrete implementations</p>
</li>
</ul>
<p>Simple strategies without any additional requirements are best grouped in a <code>class</code> and used via method references to signature-compatible methods:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">ShippingStrategies</code> <code class="p">{</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">ShippingStrategy</code> <code class="nf">standardShipping</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="n">parcel</code> <code class="o">-&gt;</code> <code class="p">...;</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="c1">// HOW TO USE</code>
<code class="n">shippingService</code><code class="p">.</code><code class="na">ship</code><code class="p">(</code><code class="n">parcel</code><code class="p">,</code>
                     <code class="n">ShippingStrategies</code><code class="p">::</code><code class="n">standardShipping</code><code class="p">);</code></pre>
<p>More complex strategies might require additional arguments.
That’s where a partially-applied function will accumulate the code in a singular type to give you a simpler creation method:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">final</code> <code class="kd">class</code> <code class="nc">ShippingStrategies</code> <code class="p">{</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">ShippingStrategy</code> <code class="nf">expedited</code><code class="p">(</code><code class="kt">boolean</code> <code class="n">requiresSignature</code><code class="p">)</code> <code class="p">{</code>

    <code class="k">return</code> <code class="n">parcel</code> <code class="o">-&gt;</code> <code class="p">{</code>
      <code class="k">if</code> <code class="p">(</code><code class="n">requiresSignature</code><code class="p">)</code> <code class="p">{</code>
        <code class="c1">// ...</code>
      <code class="p">}</code>
    <code class="p">};</code>
  <code class="p">}</code>
<code class="p">}</code>


<code class="c1">// HOW TO USE</code>
<code class="n">shippingService</code><code class="p">.</code><code class="na">ship</code><code class="p">(</code><code class="n">parcel</code><code class="p">,</code>
                     <code class="n">ShippingStrategies</code><code class="p">.</code><code class="na">expedited</code><code class="p">(</code><code class="kc">true</code><code class="p">));</code></pre>
<p>These two functional options to create and use strategies are already a more concise way to handle strategies.
They also eliminate the requirement of additional implementation types to represent a strategy.</p>
<p>However, if both functional options aren’t doable due to a more complex strategy or other requirements, you can always use a concrete implementation.
If you transition from object-oriented strategies, they will be concrete implementations, to begin with.
That’s why the strategy pattern is a prime candidate for introducing a functional approach by gradually converting existing strategies to functional code, or at least using it for new strategies.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Builder Pattern" data-type="sect2"><div class="sect2" id="idm45115213955120">
<h2>Builder Pattern</h2>
<p>The <em>builder pattern</em> is another <em>creational pattern</em> for creating more complex data structures by separating the construction from the representation itself.
It solves various object creation problems, like multi-step creation, validation, and improved optional argument handling.
Therefore, it’s a good companion for Records, which can only be created in a single swoop.
In <a data-type="xref" href="ch05.xhtml#_02-records">Chapter 5</a>, I’ve already discussed how to create a builder for a Record.
However, this section will look at builders from a functional perspective.</p>
<section data-pdf-bookmark="Object-Oriented Approach" data-type="sect3"><div class="sect3" id="idm45115213736800">
<h3>Object-Oriented Approach</h3>
<p>Let’s say you have a simple <code>record User</code> with three properties and a component validation:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">record</code> <code class="nc">User</code><code class="p">(</code><code class="n">String</code> <code class="n">email</code><code class="p">,</code> <code class="n">String</code> <code class="n">name</code><code class="p">,</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">permissions</code><code class="p">)</code> <code class="p">{</code>

  <code class="kd">public</code> <code class="n">User</code> <code class="p">{</code>
    <code class="k">if</code> <code class="p">(</code><code class="n">email</code> <code class="o">==</code> <code class="kc">null</code> <code class="o">||</code> <code class="n">email</code><code class="p">.</code><code class="na">isBlank</code><code class="p">())</code> <code class="p">{</code>
      <code class="k">throw</code> <code class="k">new</code> <code class="n">IllegalArgumentException</code><code class="p">(</code><code class="s">"'email' must be set."</code><code class="p">);</code>
    <code class="p">}</code>

    <code class="k">if</code> <code class="p">(</code><code class="n">permissions</code> <code class="o">==</code> <code class="kc">null</code><code class="p">)</code> <code class="p">{</code>
      <code class="n">permissions</code> <code class="o">=</code> <code class="n">Collections</code><code class="p">.</code><code class="na">emptyList</code><code class="p">();</code>
    <code class="p">}</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p>If you need to create a <code>User</code> in multiple steps, like adding the <code>permissions</code> later on, you’re out of luck without additional code.
So let’s add an inner builder as shown in <a data-type="xref" href="#_02-design-patterns_builder_oo">???</a>.</p>
<pre data-code-language="java" data-type="programlisting" id="_02-design-patterns_builder_oo"><code class="kd">public</code> <code class="kd">record</code> <code class="nc">User</code><code class="p">(</code><code class="n">String</code> <code class="n">email</code><code class="p">,</code> <code class="n">String</code> <code class="n">name</code><code class="p">,</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">permissions</code><code class="p">)</code> <code class="p">{</code>

  <code class="c1">// ... shorthand constructor omitted</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">Builder</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO4-1" id="co_functional_design_patterns_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a>

    <code class="kd">private</code> <code class="n">String</code> <code class="n">email</code><code class="p">;</code>
    <code class="kd">private</code> <code class="n">String</code> <code class="n">name</code><code class="p">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">permissions</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>

    <code class="kd">public</code> <code class="n">Builder</code> <code class="nf">email</code><code class="p">(</code><code class="n">String</code> <code class="n">email</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO4-2" id="co_functional_design_patterns_CO4-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a>
      <code class="k">this</code><code class="p">.</code><code class="na">email</code> <code class="o">=</code> <code class="n">email</code><code class="p">;</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="kd">public</code> <code class="n">Builder</code> <code class="nf">name</code><code class="p">(</code><code class="n">String</code> <code class="n">name</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO4-2" id="co_functional_design_patterns_CO4-3"><img alt="2" height="12" src="assets/2.png" width="12"/></a>
      <code class="k">this</code><code class="p">.</code><code class="na">name</code> <code class="o">=</code> <code class="n">name</code><code class="p">;</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="kd">public</code> <code class="n">Builder</code> <code class="nf">addPermission</code><code class="p">(</code><code class="n">String</code> <code class="n">permission</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO4-3" id="co_functional_design_patterns_CO4-4"><img alt="3" height="12" src="assets/3.png" width="12"/></a>
      <code class="k">this</code><code class="p">.</code><code class="na">permissions</code><code class="p">.</code><code class="na">add</code><code class="p">(</code><code class="n">permission</code><code class="p">)</code><code class="p">;</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="kd">public</code> <code class="n">User</code> <code class="nf">build</code><code class="p">(</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO4-4" id="co_functional_design_patterns_CO4-5"><img alt="4" height="12" src="assets/4.png" width="12"/></a>
      <code class="k">return</code> <code class="k">new</code> <code class="n">User</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="na">email</code><code class="p">,</code> <code class="k">this</code><code class="p">.</code><code class="na">name</code><code class="p">,</code> <code class="k">this</code><code class="p">.</code><code class="na">permissions</code><code class="p">)</code><code class="p">;</code>
    <code class="p">}</code>
  <code class="p">}</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="n">Builder</code> <code class="nf">builder</code><code class="p">(</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO4-5" id="co_functional_design_patterns_CO4-6"><img alt="5" height="12" src="assets/5.png" width="12"/></a>
    <code class="k">return</code> <code class="k">new</code> <code class="n">Builder</code><code class="p">(</code><code class="p">)</code><code class="p">;</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" href="#co_functional_design_patterns_CO4-1" id="callout_functional_design_patterns_CO4-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The builder is implemented as an inner <code>static</code> class mimicking all the components of its parent Record.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO4-2" id="callout_functional_design_patterns_CO4-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>Each component has its dedicated set-only method that returns the <code>Builder</code> instance for fluent call chains.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO4-4" id="callout_functional_design_patterns_CO4-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Additional methods for Collection-based fields allow you to add single elements.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO4-5" id="callout_functional_design_patterns_CO4-4"><img alt="4" height="12" src="assets/4.png" width="12"/></a></dt>
<dd><p>The <code>build</code> method simply calls the appropriate <code>User</code> constructor.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO4-6" id="callout_functional_design_patterns_CO4-5"><img alt="5" height="12" src="assets/5.png" width="12"/></a></dt>
<dd><p>A <code>static builder</code> method is added so you don’t need to create a <code>Builder</code> instance yourself.</p></dd>
</dl>
<p>That’s quite a lot of boilerplate and duplication to allow a more versatile and simpler creation flow like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">var</code> <code class="n">builder</code> <code class="o">=</code> <code class="n">User</code><code class="p">.</code><code class="na">builder</code><code class="p">()</code>
                  <code class="p">.</code><code class="na">email</code><code class="p">(</code><code class="s">"ben@example.com"</code><code class="p">)</code>
                  <code class="p">.</code><code class="na">name</code><code class="p">(</code><code class="s">"Ben Weidig"</code><code class="p">);</code>

<code class="c1">// DO SOMETHING ELSE, PASS BUILDER ALONG</code>

<code class="kd">var</code> <code class="n">user</code> <code class="o">=</code> <code class="n">builder</code><code class="p">.</code><code class="na">addPermission</code><code class="p">(</code><code class="s">"create"</code><code class="p">)</code>
                  <code class="p">.</code><code class="na">addPermission</code><code class="p">(</code><code class="s">"edit"</code><code class="p">)</code>
                  <code class="p">.</code><code class="na">build</code><code class="p">();</code></pre>
<p>Usually, a builder is even more complex by adding better support for optional and non-optional fields with <em>telescoping constructors</em> or additional validation code.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45115213201568">
<h1>Telescoping constructors</h1>
<p>Telescoping constructors are a way to supply default values via a constructor.
This design pattern was actually used in <a data-type="xref" href="ch05.xhtml#_02-records_default-values">“Component Default Values and Convenience Constructors”</a> to simplify Record creation.</p>
<p>In the case of the <code>User</code> builder, a constructor like <code>public Builder(String email)</code> would communicate that <code>email</code> is a required field.
Still, telescoping constructors are often seen as an anti-pattern unless they delegate the call directly to another constructor, as I used them in <a data-type="xref" href="ch05.xhtml#_02-records">Chapter 5</a>.</p>
</div></aside>
<p>To be honest, there aren’t many ways to optimize or change the builder pattern in its current design.
You might use a tool-assisted approach that generates the builder for you, but that will only reduce the amount of required code you need to write, not the necessity of the builder itself.</p>
<p>However, that doesn’t mean the builder could not be improved with a few functional touches.</p>
</div></section>
<section data-pdf-bookmark="A More Functional Approach" data-type="sect3"><div class="sect3" id="idm45115213736208">
<h3>A More Functional Approach</h3>
<p>Most of the time, a builder is strongly coupled with the type it’s building, as an inner <code>class</code> with fluent methods to provide arguments and a <code>build</code> method to create the actual object instance.
A functional approach can improve this creation flow in multiple ways.</p>
<p>First, it enables lazy computation of expensive values.
Instead of accepting a value directly, a <code>Supplier&lt;T&gt;</code> gives you a lazy wrapper that’s only resolved in the <code>build</code> call:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">record</code> <code class="nc">User</code><code class="p">(</code><code class="n">String</code> <code class="n">email</code><code class="p">,</code> <code class="n">String</code> <code class="n">name</code><code class="p">,</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">permissions</code><code class="p">)</code> <code class="p">{</code>

  <code class="c1">// ...</code>

  <code class="kd">private</code> <code class="n">Supplier</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">emailSupplier</code><code class="p">;</code>

  <code class="kd">public</code> <code class="n">Builder</code> <code class="nf">email</code><code class="p">(</code><code class="n">Supplier</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">emailSupplier</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">this</code><code class="p">.</code><code class="na">emailSupplier</code> <code class="o">=</code> <code class="n">emailSupplier</code><code class="p">;</code>
    <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="c1">// ...</code>

  <code class="n">User</code> <code class="nf">build</code><code class="p">()</code> <code class="p">{</code>
    <code class="kd">var</code> <code class="n">email</code> <code class="o">=</code> <code class="k">this</code><code class="p">.</code><code class="na">emailSupplier</code><code class="p">.</code><code class="na">get</code><code class="p">();</code>
    <code class="c1">// ...</code>
  <code class="p">}</code>
<code class="p">}</code></pre>
<p>You can support both lazy and non-lazy variants.
For example, you can change the original method to set <code>emailSupplier</code> instead of requiring both the <code>email</code> and <code>emailSupplier</code> fields:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">record</code> <code class="nc">User</code><code class="p">(</code><code class="n">String</code> <code class="n">email</code><code class="p">,</code> <code class="n">String</code> <code class="n">name</code><code class="p">,</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">permissions</code><code class="p">)</code> <code class="p">{</code>

  <code class="c1">// ...</code>

  <code class="kd">private</code> <code class="n">Supplier</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">emailSupplier</code><code class="p">;</code>

  <code class="kd">public</code> <code class="n">Builder</code> <code class="nf">email</code><code class="p">(</code><code class="n">String</code> <code class="n">email</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">this</code><code class="p">.</code><code class="na">emailSupplier</code> <code class="o">=</code> <code class="p">()</code> <code class="o">-&gt;</code> <code class="n">email</code><code class="p">;</code>
    <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
  <code class="p">}</code>

  <code class="c1">// ...</code>
<code class="p">}</code></pre>
<p>Second, the builder could mimic Groovy’s <code>with</code>⁠<sup><a data-type="noteref" href="ch14.xhtml#idm45115212972256" id="idm45115212972256-marker">5</a></sup> as follows:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">var</code> <code class="n">user</code> <code class="o">=</code> <code class="n">User</code><code class="p">.</code><code class="na">builder</code><code class="p">()</code>
               <code class="p">.</code><code class="na">with</code><code class="p">(</code><code class="n">builder</code> <code class="o">-&gt;</code> <code class="p">{</code>
                 <code class="n">builder</code><code class="p">.</code><code class="na">email</code> <code class="o">=</code> <code class="s">"ben@example.com"</code><code class="p">;</code>
                 <code class="n">builder</code><code class="p">.</code><code class="na">name</code> <code class="o">=</code> <code class="s">"Ben Weidig"</code><code class="p">;</code>
               <code class="p">})</code>
               <code class="p">.</code><code class="na">withPermissions</code><code class="p">(</code><code class="n">permissions</code> <code class="o">-&gt;</code> <code class="p">{</code>
                 <code class="n">permissions</code><code class="p">.</code><code class="na">add</code><code class="p">(</code><code class="s">"create"</code><code class="p">);</code>
                 <code class="n">permissions</code><code class="p">.</code><code class="na">add</code><code class="p">(</code><code class="s">"view"</code><code class="p">);</code>
               <code class="p">})</code>
               <code class="p">.</code><code class="na">build</code><code class="p">();</code></pre>
<p>To achieve this, <code>Consumer</code>-based higher-order methods must be added to the builder, as shown in <a data-type="xref" href="#_02-design-patterns_builder_fp_with">Example 14-3</a>.</p>
<div data-type="example" id="_02-design-patterns_builder_fp_with">
<h5><span class="label">Example 14-3. </span>Add <code>with</code>-methods to <code>User</code> builder</h5>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">record</code> <code class="nc">User</code><code class="p">(</code><code class="n">String</code> <code class="n">email</code><code class="p">,</code> <code class="n">String</code> <code class="n">name</code><code class="p">,</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">permissions</code><code class="p">)</code> <code class="p">{</code>

  <code class="c1">// ...</code>

  <code class="kd">public</code> <code class="kd">static</code> <code class="kd">class</code> <code class="nc">Builder</code> <code class="p">{</code>

    <code class="kd">public</code> <code class="n">String</code> <code class="n">email</code><code class="p">;</code> <a class="co" href="#callout_functional_design_patterns_CO5-1" id="co_functional_design_patterns_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a>
    <code class="kd">public</code> <code class="n">String</code> <code class="n">name</code><code class="p">;</code>

    <code class="kd">private</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">permissions</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="p">(</code><code class="p">)</code><code class="p">;</code> <a class="co" href="#callout_functional_design_patterns_CO5-2" id="co_functional_design_patterns_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a>

    <code class="kd">public</code> <code class="n">Builder</code> <code class="nf">with</code><code class="p">(</code><code class="n">Consumer</code><code class="o">&lt;</code><code class="n">Builder</code><code class="o">&gt;</code> <code class="n">builderFn</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO5-3" id="co_functional_design_patterns_CO5-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a>
      <code class="n">builderFn</code><code class="p">.</code><code class="na">accept</code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="p">;</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="kd">public</code> <code class="n">Builder</code> <code class="nf">withPermissions</code><code class="p">(</code><code class="n">Consumer</code><code class="o">&lt;</code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code class="o">&gt;</code> <code class="n">permissionsFn</code><code class="p">)</code> <code class="p">{</code> <a class="co" href="#callout_functional_design_patterns_CO5-3" id="co_functional_design_patterns_CO5-4"><img alt="3" height="12" src="assets/3.png" width="12"/></a>
      <code class="n">permissionsFn</code><code class="p">.</code><code class="na">accept</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="na">permissions</code><code class="p">)</code><code class="p">;</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">;</code>
    <code class="p">}</code>

    <code class="c1">// ...</code>
  <code class="p">}</code>

  <code class="c1">// ...</code>
<code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" href="#co_functional_design_patterns_CO5-1" id="callout_functional_design_patterns_CO5-1"><img alt="1" height="12" src="assets/1.png" width="12"/></a></dt>
<dd><p>The builder fields need to be <code>public</code> to be mutable in the <code>Consumer</code>.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO5-2" id="callout_functional_design_patterns_CO5-2"><img alt="2" height="12" src="assets/2.png" width="12"/></a></dt>
<dd><p>However, not all fields should be <code>public</code>.
For example, collection-based types are better served by their own <code>with</code> methods.</p></dd>
<dt><a class="co" href="#co_functional_design_patterns_CO5-3" id="callout_functional_design_patterns_CO5-3"><img alt="3" height="12" src="assets/3.png" width="12"/></a></dt>
<dd><p>Adding another <code>with</code> method for <code>permissions</code> prevents setting it to <code>null</code> by accident, and reduces the required code in the <code>Consumer</code> to the actual desired action.</p></dd>
</dl>
<p>Of course, the builder could’ve used <code>public</code> fields, to begin with.
But then, no fluent call would’ve been possible.
Adding <code>Consumer</code>-based <code>with</code> methods to it, the overall call chain is still fluent, plus you can use lambdas or even method references in the creation flow.</p>
<p>Even if a design pattern, like the builder pattern, doesn’t have a coequal functional variant, it could still be made more versatile with a few functional concepts sprinkled into the mix.</p>
</div></section>
</div></section>
</div></section>
<section data-pdf-bookmark="Final Thoughts on Functional Design Patterns" data-type="sect1"><div class="sect1" id="idm45115212549648">
<h1>Final Thoughts on Functional Design Patterns</h1>
<p>Calling it “functional design patterns” often feels like an oxymoron because they are almost the opposite of their object-oriented counter-part.
OO design patterns are by definition formalized and easy-to-repeat solutions for common (OO) problems.
This formalization usually comes with a lot of strict conceptual metaphors and boilerplate with little room for deviation.</p>
<p>The functional approach to the problems to be solved by OO design patterns uses the <em>first-class citizenship</em> of functions.
It replaces the previously explicitly formalized templates and required type structures with functional interfaces.
The resulting code is more straightforward and concise, and can also be structured in new ways, like <code>static</code> methods returning concrete implements, or partially-applied functions, instead of intricate custom type-hierarchies.</p>
<p>Still, is it a <em>good thing</em> to remove the boilerplate in the first place?
More straightforward and concise code is always an admirable goal to strive for.
However, the initial boilerplate also has another use than <em>just</em> being a requirement for an object-oriented approach: creating a more sophisticated domain to operate in.</p>
<p>Replacing all intermediate types with already available functional interfaces removes a certain amount of directly visible information to the reader of your code.
So a middle ground must be found between replacing a more expressive domain-based approach with all of its types and structures, and simplification with a more functional approach.</p>
<p>Thankfully, as with most of the techniques I discussed in this book, it’s not “either-or.”
Identifying functional possibilities in classical object-oriented patterns requires you to take a more high-level view of how a problem is solved.
For example, the <em>chain of responsibility</em> design pattern deals with giving more than one object a chance to process an element in a pre-defined chain of operations.
That sounds quite familiar to how Stream or Optional pipelines work, or how functional composition creates a chain of functionality.</p>
<p>Object-oriented design patterns help you to identify the general approach to a problem.
Still, moving to a more functional solution, either partially or completely, often gives you a simpler and more concise alternative.</p>
</div></section>
<section data-pdf-bookmark="Takeaways" data-type="sect1"><div class="sect1" id="idm45115212543856">
<h1>Takeaways</h1>
<ul>
<li>
<p>Object-oriented design patterns are a proven and formalized way of knowledge sharing.
They usually require multiple types to represent a domain-specific solution to a common problem.</p>
</li>
<li>
<p>A functional approach uses <em>first-class citizenship</em> to replace any additional types with already available functional interfaces.</p>
</li>
<li>
<p>Functional principles allow the removal of a lot of the boilerplate code usually required by many object-oriented design patterns.</p>
</li>
<li>
<p>Pattern implementations become more concise, but the explicit expressiveness of the used types might suffer.
Use domain-specific functional interfaces to regain expressiveness if necessary.</p>
</li>
<li>
<p>Even for design patterns without a functional equivalent, adding certain functional techniques can improve their versatility and conciseness.</p>
</li>
</ul>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45115216136896"><sup><a href="ch14.xhtml#idm45115216136896-marker">1</a></sup> The saying <em>turtles all the way down</em> describes the problem of <em>infinite regress</em>: an infinite series of entities governed by a recursive principle. Each entity depends on or is produced by its predecessor, which matches a lot of the functional design philosophy.</p><p data-type="footnote" id="idm45115216134368"><sup><a href="ch14.xhtml#idm45115216134368-marker">2</a></sup> Gamma, E., Helm, R., Johnson, R., &amp; Vlissides, J. (1994). Design patterns: Elements of reusable object-oriented software. Boston, MA: Addison Wesley.</p><p data-type="footnote" id="idm45115214894800"><sup><a href="ch14.xhtml#idm45115214894800-marker">3</a></sup> A “café con leche” is a coffee variant prevalent in Spain and Latin America. The name means literally “coffee with milk.” I didn’t use a “flat white” for my example because then I would have needed to steam the milk first.</p><p data-type="footnote" id="idm45115214058832"><sup><a href="ch14.xhtml#idm45115214058832-marker">4</a></sup> The <em>open-closed</em> principle is part of the <em>SOLID principles</em>. It states that entities, like classes, methods, functions, etc., should be <em>open</em> for extension, but <em>closed</em> for modification. See the Wikipedia pages for <a href="https://en.wikipedia.org/wiki/Open%E2%80%93closed_principle">Open-close principle</a> and <a href="https://en.wikipedia.org/wiki/SOLID">SOLID</a> for more details.</p><p data-type="footnote" id="idm45115212972256"><sup><a href="ch14.xhtml#idm45115212972256-marker">5</a></sup> Groovy has a <code>with</code> method that accepts a closure to simplify repeated use of the same variable. See the <a href="https://groovy-lang.org/style-guide.xhtml#_using_code_with_code_and_code_tap_code_for_repeated_operations_on_the_same_bean">offical Groovy style guide</a> for more information.</p></div></div></section></div></body></html>