<html><head></head><body><section data-pdf-bookmark="Chapter 11. Data Science and R" data-type="chapter" epub:type="chapter"><div class="chapter" id="javacook-ds">&#13;
<h1><span class="label">Chapter 11. </span>Data Science and R</h1>&#13;
&#13;
&#13;
<p id="javacook-ds-intro"><a data-primary="R" data-type="indexterm" id="r_ch"/><a data-primary="data science" data-type="indexterm" id="idm45290648830488"/><a data-primary="R" data-secondary="about" data-type="indexterm" id="idm45290648829816"/>Data science is a relatively new discipline that first came to the attention of many&#13;
with this<a data-primary="Loukides, Mike" data-secondary="What Is Data Science" data-type="indexterm" id="idm45290648828632"/><a data-primary="What Is Data Science (Loukides)" data-type="indexterm" id="idm45290648827688"/>&#13;
<a href="https://www.oreilly.com/ideas/what-is-data-science">article by O’Reilly’s Mike Loukides</a>.&#13;
While there are many definitions in the field, Loukides distills his detailed observation of and participation in the field into this definition:</p>&#13;
<blockquote>&#13;
<p>A data application acquires its value from the data itself, and&#13;
creates more data as a result. It’s not just an application with&#13;
data; it’s a data product. Data science enables the creation of&#13;
data products.</p></blockquote>&#13;
&#13;
<p>One of the main open source ecosystems for data science software is at Apache and includes<a data-primary="Hadoop" data-type="indexterm" id="idm45290648824280"/>&#13;
<a href="https://hadoop.apache.org">Hadoop</a>&#13;
(which includes the HDFS distributed filesystem, Hadoop <a data-primary="Map/Reduce algorithm" data-type="indexterm" id="idm45290648822744"/>Map/Reduce,<sup><a data-type="noteref" href="ch11.html#idm45290648185096" id="idm45290648185096-marker">1</a></sup>&#13;
Ozone object store, and Yarn scheduler), the&#13;
<a href="https://cassandra.apache.org">Cassandra distributed database</a>,&#13;
and the <a href="https://spark.apache.org">Spark compute engine</a>.&#13;
Read the “Modules and Related Tools” section of the Hadoop page for a current list.</p>&#13;
&#13;
<p>What’s interesting here is that a great deal of this infrastructure, which is taken for&#13;
granted by data scientists, is written in Java and Scala (a JVM language).&#13;
Much of the rest is written in Python, a language that complements Java.</p>&#13;
&#13;
<p>Data science problems may involve a lot of setup, so we’ll only give one example&#13;
from traditional DS, using the Spark framework.&#13;
Spark is written in Scala so it can be used directly by Java code.</p>&#13;
&#13;
<p>In the rest of the chapter I’ll focus on a language called R, which is widely used both in&#13;
statistics and in data science (well, also in many other sciences; many of the graphs&#13;
you see in refereed journal articles are prepared with R).&#13;
R is widely used and is useful to know.&#13;
Its primary implementation was not written in Java, but in a mixture of C, Fortran, and R itself.&#13;
But R can be used within Java, and Java can be used within R.&#13;
I’ll talk about several implementations of R and how to select one,&#13;
and then I’ll show techniques for using Java from R and R from Java,&#13;
as well as using R in a web <span class="keep-together">application.</span></p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="11.1 Machine Learning with Java" data-type="sect1"><div class="sect1" id="javacook-ds-ml">&#13;
<h1>11.1 Machine Learning with Java</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290648177240">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="machine learning (ML)" data-type="indexterm" id="idm45290648176040"/><a data-primary="Java" data-secondary="machine learning (ML) with" data-type="indexterm" id="idm45290648175336"/>You want to use Java for machine learning and data science,&#13;
but everyone tells you to use Python.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290648173880">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use one of the many powerful Java toolkits available for free download.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290648172328">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>It’s sometimes said that machine learning (ML) and deep learning&#13;
have to be done in C++ for efficiency or in Python for&#13;
the wide availability of software.&#13;
While these languages have their advantages and their advocates,&#13;
it is certainly possible to use Java for these purposes.&#13;
However, setting up these packages and presenting a short demo&#13;
tends to be longer than would fit in this book’s typical recipe format.</p>&#13;
&#13;
<p>With industry giant Amazon having released its Java-based&#13;
<a data-primary="Deep Java Learning (DJL)" data-type="indexterm" id="idm45290648169928"/><a data-primary="DJL (Deep Java Learning)" data-type="indexterm" id="idm45290648169256"/>Deep Java Learning (DJL) library as this book was going to press,&#13;
and many other good libraries available (with quite a few supporting&#13;
<a href="https://developer.nvidia.com/cuda-zone">CUDA</a> for faster GPU-based processing)&#13;
(see <a data-type="xref" href="#javacook-ds-java-ml">Table 11-1</a>), there is no reason to avoid using Java for ML.&#13;
With the exception of DJL,&#13;
I’ve tried to list packages that are still being maintained&#13;
and have a decent reputation among users.<a data-primary="ADAMS" data-type="indexterm" id="idm45290648166600"/><a data-primary="DeepLearning4Java" data-type="indexterm" id="idm45290648165928"/><a data-primary="ELKI" data-type="indexterm" id="idm45290648165256"/><a data-primary="Mallet (ML for text)" data-type="indexterm" id="idm45290648164584"/><a data-primary="Weka" data-type="indexterm" id="idm45290648163912"/></p>&#13;
<table id="javacook-ds-java-ml">&#13;
<caption><span class="label">Table 11-1. </span>Some Java machine learning packages</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Library name</th>&#13;
<th>Description</th>&#13;
<th>Info URL</th>&#13;
<th>Source URL</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>ADAMS</p></td>&#13;
<td><p>Workflow engine for building/maintaining data-driven, reactive workflows; integration with business processes</p></td>&#13;
<td><p><a href="https://adams.cms.waikato.ac.nz/"><em class="hyperlink">https://adams.cms.waikato.ac.nz/</em></a></p></td>&#13;
<td><p><a href="https://github.com/waikato-datamining/adams-base"><em class="hyperlink">https://github.com/waikato-datamining/adams-base</em></a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Deep Java Library</p></td>&#13;
<td><p>Amazon’s ML library</p></td>&#13;
<td><p><a href="https://djl.ai"><em class="hyperlink">https://djl.ai</em></a></p></td>&#13;
<td><p><a href="https://github.com/awslabs/djl"><em class="hyperlink">https://github.com/awslabs/djl</em></a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Deeplearning4j</p></td>&#13;
<td><p>DL4J, Eclipse’s distributed deep-learning library; integrates w/ Hadoop and Apache Spark</p></td>&#13;
<td><p><a href="https://deeplearning4j.org/"><em class="hyperlink">https://deeplearning4j.org/</em></a></p></td>&#13;
<td><p><a href="https://github.com/eclipse/deeplearning4j"><em class="hyperlink">https://github.com/eclipse/deeplearning4j</em></a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>ELKI</p></td>&#13;
<td><p>Data mining toolkit</p></td>&#13;
<td><p><a href="https://elki-project.github.io/"><em class="hyperlink">https://elki-project.github.io/</em></a></p></td>&#13;
<td><p><a href="https://github.com/elki-project/elki"><em class="hyperlink">https://github.com/elki-project/elki</em></a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Mallet</p></td>&#13;
<td><p>ML for text processing</p></td>&#13;
<td><p>mallet.cs.umass.edu</p></td>&#13;
<td><p><a href="https://github.com/mimno/Mallet.git"><em class="hyperlink">https://github.com/mimno/Mallet.git</em></a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Weka</p></td>&#13;
<td><p>ML algorithms for data mining; tools for data preparation, classification, regression, clustering, association rules mining, and visualization</p></td>&#13;
<td><p><a href="https://www.cs.waikato.ac.nz/ml/weka/index.html"><em class="hyperlink">https://www.cs.waikato.ac.nz/ml/weka/index.html</em></a></p></td>&#13;
<td><p><a href="https://svn.cms.waikato.ac.nz/svn/weka/trunk/weka"><em class="hyperlink">https://svn.cms.waikato.ac.nz/svn/weka/trunk/weka</em></a></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290648132360">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>The book<a data-primary="Data Mining: Practical Machine Learning and Techniques (Witten)" data-type="indexterm" id="idm45290648131128"/><a data-primary="Witten, Ian" data-secondary="Data Mining: Pratical Machine Learning and Techniques" data-type="indexterm" id="idm45290648130424"/>&#13;
<em>Data Mining: Practical Machine Learning and Techniques</em> by Ian Witten et al. (Morgan Kaufmann) was written by the team behind Weka.</p>&#13;
&#13;
<p>See also Eugen Parschiv’s <a href="https://www.baeldung.com/java-ai">list of Java AI software packages</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="11.2 Using Data In Apache Spark" data-type="sect1"><div class="sect1" id="javacook-ds-spark">&#13;
<h1>11.2 Using Data In Apache Spark</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290648125992">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Apache Spark" data-type="indexterm" id="asp_udi"/><a data-primary="data, using in Apache Spark" data-type="indexterm" id="dat_asp"/><a data-primary="Spark (Apache)" data-type="indexterm" id="spa_apa"/>You want to process data using Spark.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290648121480">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Create a <code>SparkSession</code>, use its <a data-primary="read() method" data-type="indexterm" id="idm45290648119736"/><code>read()</code> function to read a <code>DataSet</code>, apply operations, and&#13;
summarize results.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290648117848">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Spark is a massive subject! Entire books have been written on using it.<a data-primary="Databricks" data-type="indexterm" id="idm45290648116120"/>&#13;
Quoting <a href="https://databricks.com">Databricks</a>,&#13;
home of much of the original Spark team:<sup><a data-type="noteref" href="ch11.html#idm45290648114600" id="idm45290648114600-marker">2</a></sup></p>&#13;
<blockquote>&#13;
<p>Apache Spark™ has seen immense growth over the past several years, becoming&#13;
the de-facto data processing and AI engine in enterprises today due to its&#13;
speed, ease of use, and sophisticated analytics. Spark unifies data and AI&#13;
by simplifying data preparation at massive scale across various sources,&#13;
providing a consistent set of APIs for both data engineering and data&#13;
science workloads, as well as seamless integration with popular AI&#13;
frameworks and libraries such as TensorFlow, PyTorch, R and SciKit-Learn.</p></blockquote>&#13;
&#13;
<p>I cannot convey the whole subject matter in this book.  However, one&#13;
thing Spark is good for is dealing with lots of data.  In <a data-type="xref" href="#javacook-ds-EX-spark1">Example 11-1</a>, we&#13;
read an Apache-format logfile and find (and count) the lines with 200, 404, and 500 responses.</p>&#13;
<div data-type="example" id="javacook-ds-EX-spark1">&#13;
<h5><span class="label">Example 11-1. </span>spark/src/main/java/sparkdemo/LogReader.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code><code> </code><code class="nn">org.apache.spark.sql.SparkSession</code><code class="o">;</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">org.apache.spark.sql.Dataset</code><code class="o">;</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">org.apache.spark.api.java.function.FilterFunction</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code class="cm">/**&#13;
 * Read an Apache Logfile and summarize it.&#13;
 */</code><code>&#13;
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">LogReader</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">logFile</code><code> </code><code class="o">=</code><code> </code><code class="s">"/var/wildfly/standalone/log/access_log.log"</code><code class="o">;</code><code>    </code><a class="co" href="#callout_data_science_and_r_CO1-1" id="co_data_science_and_r_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">SparkSession</code><code> </code><code class="n">spark</code><code> </code><code class="o">=</code><code>&#13;
</code><code>            </code><code class="n">SparkSession</code><code class="o">.</code><code class="na">builder</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">appName</code><code class="o">(</code><code class="s">"Log Analyzer"</code><code class="o">)</code><code class="o">.</code><code class="na">getOrCreate</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>       </code><a class="co" href="#callout_data_science_and_r_CO1-2" id="co_data_science_and_r_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">Dataset</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">logData</code><code> </code><code class="o">=</code><code> </code><code class="n">spark</code><code class="o">.</code><code class="na">read</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">textFile</code><code class="o">(</code><code class="n">logFile</code><code class="o">)</code><code class="o">.</code><code class="na">cache</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>       </code><a class="co" href="#callout_data_science_and_r_CO1-3" id="co_data_science_and_r_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="kt">long</code><code> </code><code class="n">good</code><code> </code><code class="o">=</code><code> </code><code class="n">logData</code><code class="o">.</code><code class="na">filter</code><code class="o">(</code><code>                                             </code><a class="co" href="#callout_data_science_and_r_CO1-4" id="co_data_science_and_r_CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="k">new</code><code> </code><code class="n">FilterFunction</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code class="kd">public</code><code> </code><code class="kt">boolean</code><code> </code><code class="n">call</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">s</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                    </code><code class="k">return</code><code> </code><code class="n">s</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"200"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>                </code><code class="o">}</code><code>&#13;
</code><code>            </code><code class="o">}</code><code class="o">)</code><code class="o">.</code><code class="na">count</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="kt">long</code><code> </code><code class="n">bad</code><code> </code><code class="o">=</code><code> </code><code class="n">logData</code><code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">FilterFunction</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                </code><code class="kd">public</code><code> </code><code class="kt">boolean</code><code> </code><code class="nf">call</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">s</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                    </code><code class="k">return</code><code> </code><code class="n">s</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"404"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>                </code><code class="o">}</code><code>&#13;
</code><code>            </code><code class="o">}</code><code class="o">)</code><code class="o">.</code><code class="na">count</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="kt">long</code><code> </code><code class="n">ugly</code><code> </code><code class="o">=</code><code> </code><code class="n">logData</code><code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">FilterFunction</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                </code><code class="kd">public</code><code> </code><code class="kt">boolean</code><code> </code><code class="nf">call</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">s</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                    </code><code class="k">return</code><code> </code><code class="n">s</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"500"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>                </code><code class="o">}</code><code>&#13;
</code><code>            </code><code class="o">}</code><code class="o">)</code><code class="o">.</code><code class="na">count</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code>                                                      </code><a class="co" href="#callout_data_science_and_r_CO1-5" id="co_data_science_and_r_CO1-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>            </code><code class="s">"Successful transfers %d, 404 tries %d, 500 errors %d\n"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">good</code><code class="o">,</code><code> </code><code class="n">bad</code><code class="o">,</code><code> </code><code class="n">ugly</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">spark</code><code class="o">.</code><code class="na">stop</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_data_science_and_r_CO1-1" id="callout_data_science_and_r_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Set up the filename for the logfile. It probably should come from <code>args</code>.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO1-2" id="callout_data_science_and_r_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Start up the Spark <code>SparkSession</code> object—the runtime.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO1-3" id="callout_data_science_and_r_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Tell Spark to read the logfile and keep it in memory (cache).</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO1-4" id="callout_data_science_and_r_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Define the filters for 200, 404, and 500 errors. They should be able to use lambdas&#13;
to make the code shorter, but there’s an ambiguity between the Java and Scala&#13;
versions of <code>FilterFunction</code>.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO1-5" id="callout_data_science_and_r_CO1-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Print the results.</p></dd>&#13;
</dl>&#13;
&#13;
<p>To make this <em>compile</em>, you need to add the following to a Maven POM file:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="o">&lt;</code><code class="n">dependency</code><code class="o">&gt;</code>&#13;
    <code class="o">&lt;</code><code class="n">groupId</code><code class="o">&gt;</code><code class="n">org</code><code class="o">.</code><code class="na">apache</code><code class="o">.</code><code class="na">spark</code><code class="o">&lt;/</code><code class="n">groupId</code><code class="o">&gt;</code>&#13;
    <code class="o">&lt;</code><code class="n">artifactId</code><code class="o">&gt;</code><code class="n">spark</code><code class="o">-</code><code class="n">sql_2</code><code class="o">.</code><code class="mi">12</code><code class="o">&lt;/</code><code class="n">artifactId</code><code class="o">&gt;</code>&#13;
    <code class="o">&lt;</code><code class="n">version</code><code class="o">&gt;</code><code class="mf">2.4</code><code class="o">.</code><code class="mi">4</code><code class="o">&lt;/</code><code class="n">version</code><code class="o">&gt;</code>&#13;
    <code class="o">&lt;</code><code class="n">scope</code><code class="o">&gt;</code><code class="n">provided</code><code class="o">&lt;/</code><code class="n">scope</code><code class="o">&gt;</code>&#13;
<code class="o">&lt;/</code><code class="n">dependency</code><code class="o">&gt;</code></pre>&#13;
&#13;
<p>Then you should be able to do <code>mvn package</code> to get a JAR file packaged.</p>&#13;
&#13;
<p>The use of the <code>provided</code> scope is because we will also download the Apache Spark&#13;
runtime package from <a href="https://spark.apache.org/downloads.html">the Spark Download page</a> in order to <em>run</em> the application. Unpack the distribution and set the <code>SPARK_HOME</code> environment to the root of it:</p>&#13;
<pre>SPARK_HOME=~/spark-3.0.0-bin-hadoop3.2/</pre>&#13;
&#13;
<p>Then you can use the <code>run</code> script that I’ve provided in the source download (<em>javasrc/spark</em>).</p>&#13;
&#13;
<p>Spark is designed for larger-scale computing than what’s in this simple example, so its voluminous&#13;
output simply dwarfs the output from my simple sample program.&#13;
Nonetheless, for an approximately 42,000-line file, I did get this result, buried among the logging:</p>&#13;
<pre>Successful transfers 32555, 404 tries 6539, 500 errors 183</pre>&#13;
&#13;
<p>As mentioned, Spark is a massive subject but a necessary tool for most data scientists.&#13;
You can program Spark in Java (obviously), or in Scala. Scala is a JVM language that promotes functional&#13;
programming (see&#13;
<a href="https://www.dhgarrette.com/nlpclass/scala/basics.html">this Scala tutorial for Java devs</a>)&#13;
in Python and probably other languages.&#13;
You can learn more at <a href="https://spark.apache.org"><em class="hyperlink">https://spark.apache.org</em></a> or from the many books, videos, and tutorials online.<a data-primary="" data-startref="asp_udi" data-type="indexterm" id="idm45290647678408"/><a data-primary="" data-startref="spa_apa" data-type="indexterm" id="idm45290647677496"/><a data-primary="" data-startref="dat_asp" data-type="indexterm" id="idm45290647676552"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="11.3 Using R Interactively" data-type="sect1"><div class="sect1" id="javacook-ds-r-interact">&#13;
<h1>11.3 Using R Interactively</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290647674184">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="R" data-secondary="using interactively" data-type="indexterm" id="r_ui"/>You don’t know the first thing about R, and you want to.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290647671320">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>R has been around for ages, and its predecessor S for a decade before that.&#13;
There are many books and online resources devoted to this language.&#13;
The official home page is at <a href="https://www.r-project.org"><em class="hyperlink">https://www.r-project.org</em></a>.&#13;
There are many online tutorials; the <a href="https://cran.r-project.org/doc/contrib/Paradis-rdebuts_en.pdf">R Project hosts one</a>.&#13;
R itself is available in most systems’ package managers, and it can be downloaded from the official&#13;
<a href="https://cran.r-project.org/mirrors.html">download site</a>.&#13;
The name <em>CRAN</em> in these URLs stands for <a data-primary="CRAN (Comprehensive R Archive Network)" data-type="indexterm" id="idm45290647666552"/>Comprehensive R Archive Network,&#13;
named in a similar fashion to TeX’s CTAN and the Perl language’s CPAN.</p>&#13;
&#13;
<p>In this example we’ll write some data from a Java program&#13;
and then analyze and graph it using R interactively.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290647664888">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>This is merely a brief intro to using R interactively. Suffice to say that R is a valuable&#13;
interactive environment for exploring data. Here are some simple calculations&#13;
to show the flavor of the language: a chatty startup (so long I had to cut part of it),&#13;
simple arithmetic, automatic printing of results if not saved, half-decent errors when you make a mistake,&#13;
and arithmetic on vectors.&#13;
You may see some similarities to Java’s JShell (see <a data-type="xref" href="ch01.html#javacook-getstarted-JSHELL">Recipe 1.4</a>);&#13;
both are <a data-primary="read-evaluate-print loop (REPL)" data-type="indexterm" id="idm45290647661896"/><a data-primary="REPL (read-evaluate-print loop)" data-type="indexterm" id="idm45290647661176"/>REPL (Read-Evaluate-Print Loop) interfaces.&#13;
R adds the ability to save your interactive session (<em>workspace</em>)&#13;
when exiting the program, so all your data and function definitions are restored&#13;
next time you start R. A simple interactive session showing a bit of the syntax of R might look like this:</p>&#13;
&#13;
<pre data-type="programlisting">$ R&#13;
&#13;
R version 3.6.0 (2019-04-26) -- "Planting of a Tree"&#13;
Copyright (C) 2019 The R Foundation for Statistical Computing&#13;
Platform: x86_64-apple-darwin15.6.0 (64-bit)&#13;
&#13;
R is free software and comes with ABSOLUTELY NO WARRANTY.&#13;
You are welcome to redistribute it under certain conditions.&#13;
Type 'license()' or 'licence()' for distribution details.&#13;
&#13;
...&#13;
&#13;
&gt; 2 + 2&#13;
[1] 4&#13;
&gt; x = 2 + 2&#13;
&gt; x&#13;
[1] 4&#13;
&gt; r = 10 20 30 40 50&#13;
Error: unexpected numeric constant in "r = 10 20"&#13;
&gt; r = c(10,20,30,45,55,67)&#13;
&gt; r&#13;
[1] 10 20 30 45 55 67&#13;
&gt; r+3&#13;
[1] 13 23 33 48 58 70&#13;
&gt; r / 3&#13;
[1]  3.333333  6.666667 10.000000 15.000000 18.333333 22.333333&#13;
&gt;quit()&#13;
Save workspace image? [y/n/c]: n&#13;
$</pre>&#13;
&#13;
<p>R purists will usually use the<a data-primary="assignment arrow (R language)" data-type="indexterm" id="idm45290647642280"/> <em>assignment arrow</em> ← in lieu of the <em>=</em> sign&#13;
when assigning. If you like that, go for it.</p>&#13;
&#13;
<p>This short session barely scratches the surface: R offers hundreds of built-in functions,&#13;
sample datasets, over a thousand add-on packages, built-in help, and much more.&#13;
For interactive exploration of data, R is really the one to beat.</p>&#13;
&#13;
<p>Some people prefer a GUI frontend to R. <a href="https://rstudio.com">RStudio</a> is the most widely used GUI frontend.</p>&#13;
&#13;
<p>Now we want to write some data from Java and process it in R&#13;
(we’ll use Java and R together in later recipes in this chapter).&#13;
In <a data-type="xref" href="ch05.html#javacook-numbers-SECT-13">Recipe 5.9</a> we discussed the <code>java.util.Random</code> class&#13;
and its <a data-primary="nextDouble() method" data-type="indexterm" id="idm45290647637048"/><a data-primary="nextGaussian() method" data-type="indexterm" id="idm45290647636312"/><code>nextDouble()</code> and <code>nextGaussian()</code> methods.&#13;
The <code>nextDouble()</code> and related methods try to give a flat distribution between 0 and 1.0,&#13;
in which each value has an equal chance of being selected.&#13;
A Gaussian or normal distribution is a bell curve of values from negative infinity to positive infinity, with the majority of the values clustered around zero (0.0).&#13;
We’ll use R’s histogramming and graphics functions to examine visually how well they do so:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">Random</code> <code class="n">r</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Random</code><code class="o">();</code>&#13;
<code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">i</code> <code class="o">&lt;</code> <code class="mi">10_000</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>&#13;
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"A normal random double is "</code> <code class="o">+</code> <code class="n">r</code><code class="o">.</code><code class="na">nextDouble</code><code class="o">());</code>&#13;
    <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"A gaussian random double is "</code> <code class="o">+</code> <code class="n">r</code><code class="o">.</code><code class="na">nextGaussian</code><code class="o">());</code></pre>&#13;
&#13;
<p>To illustrate the different distributions, I generated 10,000 numbers each using&#13;
<a data-primary="nextRandom() method" data-type="indexterm" id="idm45290647599512"/><code>nextRandom()</code> and <code>nextGaussian()</code>. The code for this is in <em>Random4.java</em>&#13;
(not shown here) and is a combination of the preceding sample code with code to print just the&#13;
numbers into two files. I then plotted histograms using R;&#13;
the R script used to generate the graph is in&#13;
<em>javasrc</em> under <em>src/main/resources</em>, but its core is shown in&#13;
<a data-type="xref" href="#javacook-ds-histograms">Example 11-2</a>.&#13;
The results are shown in <a data-type="xref" href="#javacook-ds-FIG-1">Figure 11-1</a>.</p>&#13;
<div data-type="example" id="javacook-ds-histograms">&#13;
<h5><span class="label">Example 11-2. </span>R commands to generate histograms</h5>&#13;
&#13;
<pre data-code-language="r" data-type="programlisting"><code class="nf">png</code><code class="p">(</code><code class="s">"randomness.png"</code><code class="p">)</code>&#13;
<code class="n">us</code> <code class="o">&lt;-</code> <code class="nf">read.table</code><code class="p">(</code><code class="s">"normal.txt"</code><code class="p">)[[</code><code class="m">1</code><code class="p">]]</code>&#13;
<code class="n">ns</code> <code class="o">&lt;-</code> <code class="nf">read.table</code><code class="p">(</code><code class="s">"gaussian.txt"</code><code class="p">)[[</code><code class="m">1</code><code class="p">]]</code>&#13;
&#13;
<code class="nf">layout</code><code class="p">(</code><code class="nf">t</code><code class="p">(</code><code class="nf">c</code><code class="p">(</code><code class="m">1</code><code class="p">,</code><code class="m">2</code><code class="p">)),</code> <code class="n">respect</code><code class="o">=</code><code class="kc">TRUE</code><code class="p">)</code>&#13;
&#13;
<code class="nf">hist</code><code class="p">(</code><code class="n">us</code><code class="p">,</code> <code class="n">main</code> <code class="o">=</code> <code class="s">"Using nextRandom()"</code><code class="p">,</code> <code class="n">nclass</code> <code class="o">=</code> <code class="m">10</code><code class="p">,</code>&#13;
       <code class="n">xlab</code> <code class="o">=</code> <code class="kc">NULL</code><code class="p">,</code> <code class="n">col</code> <code class="o">=</code> <code class="s">"lightgray"</code><code class="p">,</code> <code class="n">las</code> <code class="o">=</code> <code class="m">1</code><code class="p">,</code> <code class="n">font.lab</code> <code class="o">=</code> <code class="m">3</code><code class="p">)</code>&#13;
&#13;
<code class="nf">hist</code><code class="p">(</code><code class="n">ns</code><code class="p">,</code> <code class="n">main</code> <code class="o">=</code> <code class="s">"Using nextGaussian()"</code><code class="p">,</code> <code class="n">nclass</code> <code class="o">=</code> <code class="m">16</code><code class="p">,</code>&#13;
       <code class="n">xlab</code> <code class="o">=</code> <code class="kc">NULL</code><code class="p">,</code> <code class="n">col</code> <code class="o">=</code> <code class="s">"lightgray"</code><code class="p">,</code> <code class="n">las</code> <code class="o">=</code> <code class="m">1</code><code class="p">,</code> <code class="n">font.lab</code> <code class="o">=</code> <code class="m">3</code><code class="p">)</code>&#13;
<code class="nf">dev.off</code><code class="p">()</code></pre></div>&#13;
&#13;
<p>The <a data-primary="png() method" data-type="indexterm" id="idm45290647595544"/><code>png()</code> call tells R which graphics device to use. Others include<a data-primary="X11() method" data-type="indexterm" id="idm45290647276072"/> <code>X11()</code> and <code>Postscript()</code>.&#13;
<code>read.table()</code> reads data from a text file into a table; the <code>[1]</code> gives us just the data column,&#13;
ignoring some metadata.&#13;
The<a data-primary="layout() method" data-type="indexterm" id="idm45290647273512"/> <code>layout()</code> call says we want two graphics objects displayed side by side.&#13;
Each <a data-primary="hist() method" data-type="indexterm" id="idm45290647272264"/><code>hist()</code> call draws one of the two histograms.&#13;
And <code>dev.off()</code> closes the output and flushes any writing buffers to the PNG file.&#13;
The result is shown in <a data-type="xref" href="#javacook-ds-FIG-1">Figure 11-1</a>.<a data-primary="" data-startref="r_ui" data-type="indexterm" id="idm45290647269752"/></p>&#13;
&#13;
<figure><div class="figure" id="javacook-ds-FIG-1">&#13;
<img alt="jcb4 1101" src="assets/jcb4_1101.png"/>&#13;
<h6><span class="label">Figure 11-1. </span>Flat (left) and Gaussian (right) distributions</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="11.4 Comparing/Choosing an R Implementation" data-type="sect1"><div class="sect1" id="javacook-ds-compare-rs">&#13;
<h1>11.4 Comparing/Choosing an R Implementation</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290647265720">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="R" data-secondary="implementations, comparing/choosing" data-type="indexterm" id="idm45290647264520"/>You’re not sure which implementation of R to use.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290647263128">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Look at original R, Renjin, and FastR.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290647261576">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The original for R was <a data-primary="S" data-type="indexterm" id="idm45290647259784"/>S, an environment for interactive programming developed by<a data-primary="Chambers, John" data-type="indexterm" id="idm45290647258920"/> John Chambers and others&#13;
at AT&amp;T Bell Labs starting in 1976.&#13;
I ran into S when supporting the University of Toronto Statistics Department,&#13;
and again when reviewing a commercial implementation of it, <a data-primary="SPlus" data-type="indexterm" id="idm45290647257896"/>SPlus, for a long-ago glossy magazine&#13;
called <em>Sun Expert</em>.&#13;
AT&amp;T was only making S source available to universities and to commercial licensees&#13;
who could not further distribute the source.&#13;
Two developers at the University of Auckland,<a data-primary="Ihaka, Ross" data-type="indexterm" id="idm45290647256520"/><a data-primary="Gentleman, Robert" data-type="indexterm" id="idm45290647255816"/> Ross Ihaka and Robert Gentleman, developed a clone of S,&#13;
starting in 1995.&#13;
They named it R after their own first initials and as a play on the name S.&#13;
(There is precedent for this: the <em>awk</em> language popular on Unix/Linux&#13;
was named for the initials of its designers Aho, Weinberger, and Kernighan).&#13;
R grew quickly because it was very largely compatible with S and was more readily available.&#13;
This implementation of original R is actively managed by the<a data-primary="R Foundation for Statistical Computing" data-type="indexterm" id="idm45290647254152"/>&#13;
<a href="https://r-project.org">R Foundation for Statistical Computing</a>,&#13;
which also manages the&#13;
<a href="https://cran.r-project.org">Comprehensive R Archive Network</a>.</p>&#13;
&#13;
<p><a href="http://renjin.org">Renjin</a>&#13;
<a data-primary="Renjin" data-type="indexterm" id="idm45290647251192"/>is a fairly complete implementation of R in Java.&#13;
This project provides built JAR files via their own Maven repository.</p>&#13;
&#13;
<p><a href="https://jaxenter.com/fastr-r-virtual-machine-java-140667.html">FastR</a> <a data-primary="FastR" data-type="indexterm" id="idm45290647249288"/>is another implementation&#13;
in Java, designed to run in the faster GraalVM&#13;
and supporting direct invocation of JVM code from almost any other programming language. The technical lead of the FastR descibes the implementation in <a href="https://medium.com/graalvm/faster-r-with-fastr-4b8db0e0dceb">this blog post</a>.</p>&#13;
&#13;
<p>Besides these implementations, R’s popularity has led to development of many access libraries&#13;
for invoking R from many popular programming languages.<a data-primary="Rserve" data-type="indexterm" id="idm45290647246952"/>&#13;
<a href="https://www.rforge.net/Rserve">Rserve</a> is a TCP/IP networked access mode for R, for which&#13;
Java wrappers exist.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="11.5 Using R from Within a Java App: Renjin" data-type="sect1"><div class="sect1" id="javacook-ds-r-within-java">&#13;
<h1>11.5 Using R from Within a Java App: Renjin</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290647243864">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Java" data-secondary="using R from within apps" data-type="indexterm" id="jav_rwa"/><a data-primary="R" data-secondary="using from withing Java apps" data-type="indexterm" id="r_uwja"/><a data-primary="Renjin" data-type="indexterm" id="renj_ab"/>You want to access R from within a Java application using Renjin.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290647238840">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Add Renjin to your Maven or Gradle build, and call it via the Script Engines&#13;
mechanism described in <a data-type="xref" href="ch18.html#javacook-otherlang-scripting">Recipe 18.3</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290647236328">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Renjin is a pure-Java, open source reimplementation of R and provides a&#13;
script engines interface.&#13;
Add the following dependency to your build tool:</p>&#13;
<pre>org.renjin:renjin-script-engine:3.5-beta76</pre>&#13;
&#13;
<p>Of course there is probably a later version of Renjin than the one shown above&#13;
by the time you read this; use the latest unless there’s a reason not to.</p>&#13;
&#13;
<p>Note that you will also need a <code>&lt;repository&gt;</code> entry since the maintainers&#13;
put their artifacts in the repo at <code>nexus.betadriven.com</code> instead of the usual&#13;
Maven Central. Here’s what I used (obtained from&#13;
<a href="https://www.renjin.org/downloads.html"><em class="hyperlink">https://www.renjin.org/downloads.html</em></a>):</p>&#13;
<pre>&lt;repositories&gt;&#13;
    &lt;repository&gt;&#13;
        &lt;id&gt;bedatadriven&lt;/id&gt;&#13;
        &lt;name&gt;bedatadriven public repo&lt;/name&gt;&#13;
        &lt;url&gt;https://nexus.bedatadriven.com/content/groups/public/&lt;/url&gt;&#13;
    &lt;/repository&gt;&#13;
&lt;/repositories&gt;</pre>&#13;
&#13;
<p>Once that’s done, you should be able to access Renjin via the Script Engines&#13;
framework, as in <a data-type="xref" href="#otherlang-renjinscriptingjava">Example 11-3</a>.</p>&#13;
<div data-type="example" id="otherlang-renjinscriptingjava">&#13;
<h5><span class="label">Example 11-3. </span>main/src/main/java/otherlang/RenjinScripting.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">    <code class="cm">/**</code>&#13;
<code class="cm">     * Demonstrate interacting with the "R" implementation called "Renjin"</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">ScriptException</code> <code class="o">{</code>&#13;
        <code class="n">ScriptEngineManager</code> <code class="n">manager</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ScriptEngineManager</code><code class="o">();</code>&#13;
        <code class="n">ScriptEngine</code> <code class="n">engine</code> <code class="o">=</code> <code class="n">manager</code><code class="o">.</code><code class="na">getEngineByName</code><code class="o">(</code><code class="s">"Renjin"</code><code class="o">);</code>&#13;
        <code class="n">engine</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"a"</code><code class="o">,</code> <code class="mi">42</code><code class="o">);</code>&#13;
        <code class="n">Object</code> <code class="n">ret</code> <code class="o">=</code> <code class="n">engine</code><code class="o">.</code><code class="na">eval</code><code class="o">(</code><code class="s">"b &lt;- 2; a*b"</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">ret</code><code class="o">);</code>&#13;
    <code class="o">}</code></pre></div>&#13;
&#13;
<p>Because R treats all numbers as floating point, like many interpreters, the value printed is <code>84.0</code>.</p>&#13;
&#13;
<p>One can also get Renjin to invoke a script file;&#13;
<a data-type="xref" href="#otherlang-renjinscriptinglonger">Example 11-4</a> invokes the same script used in&#13;
<a data-type="xref" href="#javacook-ds-r-interact">Recipe 11.3</a> to generate and plot a batch of&#13;
pseudorandom numbers.</p>&#13;
<div data-type="example" id="otherlang-renjinscriptinglonger">&#13;
<h5><span class="label">Example 11-4. </span>Renjin with a script file</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">R_SCRIPT_FILE</code> <code class="o">=</code> <code class="s">"/randomnesshistograms.r"</code><code class="o">;</code>&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">N</code> <code class="o">=</code> <code class="mi">10000</code><code class="o">;</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>&#13;
        <code class="c1">// java.util.Random methods are non-static, do need to construct</code>&#13;
        <code class="n">Random</code> <code class="n">r</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Random</code><code class="o">();</code>&#13;
        <code class="kt">double</code><code class="o">[]</code> <code class="n">us</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">double</code><code class="o">[</code><code class="n">N</code><code class="o">],</code> <code class="n">ns</code> <code class="o">=</code> <code class="k">new</code> <code class="kt">double</code><code class="o">[</code><code class="n">N</code><code class="o">];</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">=</code><code class="mi">0</code><code class="o">;</code> <code class="n">i</code><code class="o">&lt;</code><code class="n">N</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>&#13;
            <code class="n">us</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code> <code class="n">r</code><code class="o">.</code><code class="na">nextDouble</code><code class="o">();</code>&#13;
            <code class="n">ns</code><code class="o">[</code><code class="n">i</code><code class="o">]</code> <code class="o">=</code><code class="n">r</code><code class="o">.</code><code class="na">nextGaussian</code><code class="o">();</code>&#13;
        <code class="o">}</code>&#13;
        <code class="k">try</code> <code class="o">(</code><code class="n">InputStream</code> <code class="n">is</code> <code class="o">=</code>&#13;
            <code class="n">Random5</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getResourceAsStream</code><code class="o">(</code><code class="n">R_SCRIPT_FILE</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">is</code> <code class="o">==</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
                <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalStateException</code><code class="o">(</code><code class="s">"Can't open R file "</code><code class="o">);</code>&#13;
            <code class="o">}</code>&#13;
            <code class="n">ScriptEngineManager</code> <code class="n">manager</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ScriptEngineManager</code><code class="o">();</code>&#13;
            <code class="n">ScriptEngine</code> <code class="n">engine</code> <code class="o">=</code> <code class="n">manager</code><code class="o">.</code><code class="na">getEngineByName</code><code class="o">(</code><code class="s">"Renjin"</code><code class="o">);</code>&#13;
            <code class="n">engine</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"us"</code><code class="o">,</code> <code class="n">us</code><code class="o">);</code>&#13;
            <code class="n">engine</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"ns"</code><code class="o">,</code> <code class="n">ns</code><code class="o">);</code>&#13;
            <code class="n">engine</code><code class="o">.</code><code class="na">eval</code><code class="o">(</code><code class="n">FileIO</code><code class="o">.</code><code class="na">readerToString</code><code class="o">(</code><code class="k">new</code> <code class="n">InputStreamReader</code><code class="o">(</code><code class="n">is</code><code class="o">)));</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code></pre></div>&#13;
&#13;
<p>Renjin can also be used as a standalone R implementation if you&#13;
download an all-dependencies JAR file from&#13;
<a href="https://renjin.org/downloads.html"><em class="hyperlink">https://renjin.org/downloads.html</em></a>.<a data-primary="" data-startref="jav_rwa" data-type="indexterm" id="idm45290647158104"/><a data-primary="" data-startref="r_uwja" data-type="indexterm" id="idm45290647157256"/><a data-primary="" data-startref="renj_ab" data-type="indexterm" id="idm45290646925624"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="11.6 Using Java from Within an R Session" data-type="sect1"><div class="sect1" id="javacook-ds-java-within-r">&#13;
<h1>11.6 Using Java from Within an R Session</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290646923288">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Java" data-secondary="using from within R sessions" data-type="indexterm" id="idm45290646922088"/><a data-primary="R" data-secondary="using Java from within sessions" data-type="indexterm" id="idm45290646921048"/>You are partway through a computation in R and realize that there’s a Java library to do the next step.&#13;
Or for any other reason, you need to call Java code from within an R session.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290646919512">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Install rJava, call <code>.jinit()</code>, and use <code>J()</code> to load classes or invoke methods.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290646917064">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Here is the part of an interactive R session in which we install rJava, initialize it by calling <code>.jinit()</code>, and invoke <code>java.time.LocalDate.now()</code> to get the current date:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="o">&gt;</code><code> </code><code class="n">install</code><code class="o">.</code><code class="na">packages</code><code class="o">(</code><code class="err">'</code><code class="n">rJava</code><code class="err">'</code><code class="o">)</code><code>                            </code><a class="co" href="#callout_data_science_and_r_CO2-1" id="co_data_science_and_r_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="n">trying</code><code> </code><code class="n">URL</code><code> </code><code class="err">'</code><code class="nl">http:</code><code class="c1">//.../rJava_0.9-11.tgz'&#13;
</code><code class="n">Content</code><code> </code><code class="n">type</code><code> </code><code class="err">'</code><code class="n">application</code><code class="o">/</code><code class="n">x</code><code class="o">-</code><code class="n">gzip</code><code class="err">'</code><code> </code><code class="n">length</code><code> </code><code class="mi">745354</code><code> </code><code class="n">bytes</code><code> </code><code class="o">(</code><code class="mi">727</code><code> </code><code class="n">KB</code><code class="o">)</code><code>&#13;
</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code class="o">=</code><code>&#13;
</code><code class="n">downloaded</code><code> </code><code class="mi">727</code><code> </code><code class="n">KB</code><code>&#13;
</code><code>&#13;
</code><code>&#13;
</code><code class="n">The</code><code> </code><code class="n">downloaded</code><code> </code><code class="n">binary</code><code> </code><code class="n">packages</code><code> </code><code class="n">are</code><code> </code><code class="n">in</code><code>&#13;
</code><code>    </code><code class="o">/</code><code class="n">tmp</code><code class="c1">//Rtmp6XYZ9t/downloaded_packages&#13;
</code><code class="o">&gt;</code><code> </code><code class="n">library</code><code class="o">(</code><code class="err">'</code><code class="n">rJava</code><code class="err">'</code><code class="o">)</code><code>                                    </code><a class="co" href="#callout_data_science_and_r_CO2-2" id="co_data_science_and_r_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="o">&gt;</code><code> </code><code class="o">.</code><code class="na">jinit</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code class="o">&gt;</code><code> </code><code class="n">J</code><code class="o">(</code><code class="err">'</code><code class="n">java</code><code class="o">.</code><code class="na">time</code><code class="o">.</code><code class="na">LocalDate</code><code class="err">'</code><code class="o">,</code><code> </code><code class="err">'</code><code class="n">now</code><code class="err">'</code><code class="o">)</code><code>                    </code><a class="co" href="#callout_data_science_and_r_CO2-3" id="co_data_science_and_r_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code><code> </code><code class="s">"Java-Object{2019-11-22}"</code><code>&#13;
</code><code class="o">&gt;</code><code> </code><code class="n">d</code><code class="o">=</code><code class="n">J</code><code class="o">(</code><code class="err">'</code><code class="n">java</code><code class="o">.</code><code class="na">time</code><code class="o">.</code><code class="na">LocalDate</code><code class="err">'</code><code class="o">,</code><code> </code><code class="err">'</code><code class="n">now</code><code class="err">'</code><code class="o">)</code><code class="n">$toString</code><code class="o">(</code><code class="o">)</code><code>        </code><a class="co" href="#callout_data_science_and_r_CO2-4" id="co_data_science_and_r_CO2-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">&gt;</code><code> </code><code class="n">d</code><code>&#13;
</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code><code> </code><code class="s">"2019-11-22"</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_data_science_and_r_CO2-1" id="callout_data_science_and_r_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Install the <code>rJava</code> package; only needs to be done once.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO2-2" id="callout_data_science_and_r_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>load <code>rJava</code>, and initialize it with <code>.jinit()</code>; both needed in every R session.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO2-3" id="callout_data_science_and_r_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>The <code>J</code> function takes one argument of a full class name.&#13;
If only that argument is given, a class descriptor (like a <code>java.lang.Class</code> object) is returned.&#13;
If more than one argument is given, the second is a static method name,&#13;
and any subsequent arguments are passed to that method.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO2-4" id="callout_data_science_and_r_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Returned objects can have Java methods invoked with the standard R <em>\$</em> notation;&#13;
here the <a data-primary="toString() method" data-type="indexterm" id="idm45290646579736"/><code>toString()</code> method is invoked to return just a character string&#13;
instead of a <code>LocalDate</code> object.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The <code>.jcall</code> function gives you more control over calling method and return types:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="o">&gt;</code><code> </code><code class="n">d</code><code class="o">=</code><code class="n">J</code><code class="o">(</code><code class="err">'</code><code class="n">java</code><code class="o">.</code><code class="na">time</code><code class="o">.</code><code class="na">LocalDate</code><code class="err">'</code><code class="o">,</code><code> </code><code class="err">'</code><code class="n">now</code><code class="err">'</code><code class="o">)</code><code>                    </code><a class="co" href="#callout_data_science_and_r_CO3-1" id="co_data_science_and_r_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="o">&gt;</code><code> </code><code class="o">.</code><code class="na">jcall</code><code class="o">(</code><code class="n">d</code><code class="o">,</code><code> </code><code class="s">"I"</code><code class="o">,</code><code> </code><code class="err">'</code><code class="n">getYear</code><code class="err">'</code><code class="o">)</code><code>                            </code><a class="co" href="#callout_data_science_and_r_CO3-2" id="co_data_science_and_r_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code><code> </code><code class="mi">2019</code><code>&#13;
</code><code class="o">&gt;</code><code>&#13;
</code><code class="o">&gt;</code><code> </code><code class="o">.</code><code class="na">jcall</code><code class="o">(</code><code class="s">"java/lang/System"</code><code class="o">,</code><code class="s">"S"</code><code class="o">,</code><code class="s">"getProperty"</code><code class="o">,</code><code class="s">"user.dir"</code><code class="o">)</code><code> </code><a class="co" href="#callout_data_science_and_r_CO3-3" id="co_data_science_and_r_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code><code> </code><code class="s">"/home/ian"</code><code>&#13;
</code><code class="o">&gt;</code><code> </code><code class="n">c</code><code class="o">=</code><code class="n">J</code><code class="o">(</code><code class="err">'</code><code class="n">java</code><code class="o">/</code><code class="n">lang</code><code class="o">/</code><code class="n">System</code><code class="err">'</code><code class="o">)</code><code>                            </code><a class="co" href="#callout_data_science_and_r_CO3-4" id="co_data_science_and_r_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">&gt;</code><code> </code><code class="o">.</code><code class="na">jcall</code><code class="o">(</code><code class="n">c</code><code class="o">,</code><code> </code><code class="s">"S"</code><code class="o">,</code><code> </code><code class="err">'</code><code class="n">getProperty</code><code class="err">'</code><code class="o">,</code><code> </code><code class="err">'</code><code class="n">user</code><code class="o">.</code><code class="na">dir</code><code class="err">'</code><code class="o">)</code><code>&#13;
</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code><code> </code><code class="s">"/home/ian"</code><code>&#13;
</code><code class="o">&gt;</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_data_science_and_r_CO3-1" id="callout_data_science_and_r_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Invoke Java <a data-primary="LocalDate.now() method" data-type="indexterm" id="idm45290646533672"/><code>LocalDate.now()</code> method and save result in R variable <em>d</em>.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO3-2" id="callout_data_science_and_r_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Invoke Java<a data-primary="getYear() method" data-type="indexterm" id="idm45290646550488"/> <code>getYear()</code> method on the <code>LocalDate</code> object;&#13;
the “I” tells <code>jcall</code> to expect an integer result.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO3-3" id="callout_data_science_and_r_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Call<a data-primary="System.getProperty() method" data-type="indexterm" id="idm45290646545960"/> <code>System.getProperty("user.dir")</code> and print the result;&#13;
the “S” tells <code>.jcall</code> to expect a string return.</p></dd>&#13;
<dt><a class="co" href="#co_data_science_and_r_CO3-4" id="callout_data_science_and_r_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>If you will be using a class several times, save the <code>Class</code> object,&#13;
and pass it as the first argument of <code>.jcall()</code>.</p></dd>&#13;
</dl>&#13;
&#13;
<p>There are more capabilities here; consult <a href="https://cran.r-project.org/web/packages/rJava">the documentation</a> and&#13;
<a href="https://www.developer.com/java/ent/getting-started-with-r-using-java.html">a developer.com article</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="11.7 Using FastR, the GraalVM Implementation of R" data-type="sect1"><div class="sect1" id="javacook-ds-fastr">&#13;
<h1>11.7 Using FastR, the GraalVM Implementation of R</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290646494552">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="FastR" data-type="indexterm" id="fas_ab"/><a data-primary="GraalVM" data-secondary="FastR" data-type="indexterm" id="graal_fas"/><a data-primary="R" data-secondary="FastR" data-type="indexterm" id="r_fas"/>You use the R language but feel a need for speed.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290646490136">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use FastR, Oracle’s GraalVM reimplementation of the R language.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290646488744">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Assuming you have installed GraalVM as described in <a data-type="xref" href="ch01.html#jcb-getstarted-graal">Recipe 1.2</a>,&#13;
you can just type the following command:</p>&#13;
<pre>$ gu install R&#13;
Downloading: Component catalog from www.graalvm.org&#13;
Processing component archive: FastR&#13;
Downloading: Component R: FastR  from github.com&#13;
Installing new component: FastR (org.graalvm.R, version 19.2.0.1)&#13;
NOTES:&#13;
---------------&#13;
The user specific library directory was not created automatically.&#13;
You can either create the directory manually or edit file&#13;
/Library/Java/JavaVirtualMachines/graalvm-ce-19.2.0.1/Contents/&#13;
  Home/jre/languages/R/etc/Renviron&#13;
to change it to any desired location. Without user specific library&#13;
directory, users will need write permission for the GraalVM home&#13;
directory in order to install R packages.&#13;
...&#13;
[more install notes]</pre>&#13;
&#13;
<p>If you have set your <code>PATH</code> to have GraalVM before other directories, the command <em>R</em> will now give you&#13;
the GraalVM version of  R. To access the standard R, you will have to either set your <code>PATH</code>&#13;
or give a full path to the R installation. On all Unix and Unix-like systems, the command <em>which R</em>&#13;
will reveal all R commands on your <code>PATH</code>:</p>&#13;
<pre>$ which R&#13;
/Library/Java/JavaVirtualMachines/graalvm-ce-19.2.0.1/Contents/Home/bin/R&#13;
/usr/local/bin/R</pre>&#13;
&#13;
<p>Let’s just run it:</p>&#13;
&#13;
<pre data-type="programlisting">$ R&#13;
R version 3.5.1 (FastR)&#13;
Copyright (c) 2013-19, Oracle and/or its affiliates&#13;
Copyright (c) 1995-2018, The R Core Team&#13;
Copyright (c) 2018 The R Foundation for Statistical Computing&#13;
Copyright (c) 2012-4 Purdue University&#13;
Copyright (c) 1997-2002, Makoto Matsumoto and Takuji Nishimura&#13;
All rights reserved.&#13;
&#13;
FastR is free software and comes with ABSOLUTELY NO WARRANTY.&#13;
You are welcome to redistribute it under certain conditions.&#13;
Type 'license()' or 'licence()' for distribution details.&#13;
&#13;
R is a collaborative project with many contributors.&#13;
Type 'contributors()' for more information.&#13;
&#13;
Type 'q()' to quit R.&#13;
[Previously saved workspace restored]&#13;
&#13;
&gt; 2 + 2&#13;
[1] 4&#13;
&gt; ^D&#13;
Save workspace image? [y/n/c]: n&#13;
$</pre>&#13;
&#13;
<p>From that point on, you should be able to do practically anything that you would&#13;
do in standard R, since this R’s source code is largely derived from the R Foundation’s source.<a data-primary="" data-startref="fas_ab" data-type="indexterm" id="idm45290646480120"/><a data-primary="" data-startref="graal_fas" data-type="indexterm" id="idm45290646479272"/><a data-primary="" data-startref="r_fas" data-type="indexterm" id="idm45290646478424"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="11.8 Using R in a Web App" data-type="sect1"><div class="sect1" id="javacook-ds-r-web">&#13;
<h1>11.8 Using R in a Web App</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290646476152">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="R" data-secondary="using in web apps" data-type="indexterm" id="idm45290646475144"/><a data-primary="web apps" data-type="indexterm" id="idm45290646474296"/>You want to display R’s data and graphics in a web page on a web server.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290646473304">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>There are several approaches that would achieve this effect:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Prepare the data, generate graphics as we did in <a data-type="xref" href="#javacook-ds-r-interact">Recipe 11.3</a>,&#13;
and then incorporate both into a static web page.</p>&#13;
</li>&#13;
<li>&#13;
<p>Use one of&#13;
<a href="https://cran.r-project.org/web/views/WebTechnologies.html#web-and-server-frameworks">&#13;
several R add-on web frameworks</a>, such as&#13;
<a href="https://cran.r-project.org/web/packages/shiny/index.html">shiny</a>&#13;
or&#13;
<a href="https://cran.r-project.org/web/packages/Rook/index.html">Rook</a>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Invoke a JVM implementation of R from within a Servlet, JSF, Spring Bean,&#13;
or other web-tier component.</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290646466504">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The first approach is trivial, and doesn’t need discussion here.</p>&#13;
&#13;
<p>For the second, I’ll actually use <code>timevis</code>, which in turn uses <code>shiny</code>.&#13;
This isn’t built in to the R library, so we first have to install it,&#13;
using R’s <a data-primary="install.packages() method" data-type="indexterm" id="idm45290646463784"/><code>install.packages()</code>:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">$</code> <code class="n">R</code>&#13;
<code class="o">&gt;</code> <code class="n">install</code><code class="o">.</code><code class="na">packages</code><code class="o">(</code><code class="err">'</code><code class="n">timevis</code><code class="err">'</code><code class="o">)</code>&#13;
<code class="o">&gt;</code> <code class="n">quit</code><code class="o">()</code>&#13;
<code class="n">$</code></pre>&#13;
&#13;
<p>This may take a while as it downloads and builds multiple dependencies.</p>&#13;
&#13;
<p>For this demo I have a small dataset with some basic information on&#13;
medieval literature, which I load and display using <code>shiny</code>:</p>&#13;
&#13;
<pre data-code-language="r" data-type="programlisting"><code class="c1"># Draw the timeline for the epics.</code>&#13;
&#13;
<code class="n">epics</code> <code class="o">=</code> <code class="nf">read.table</code><code class="p">(</code><code class="s">"epics.txt"</code><code class="p">,</code> <code class="n">header</code><code class="o">=</code><code class="kc">TRUE</code><code class="p">,</code> <code class="n">fill</code><code class="o">=</code><code class="kc">TRUE</code><code class="p">)</code>&#13;
&#13;
<code class="c1"># epics</code>&#13;
&#13;
<code class="nf">library</code><code class="p">(</code><code class="s">"timevis"</code><code class="p">)</code>&#13;
&#13;
<code class="nf">timevis</code><code class="p">(</code><code class="n">epics</code><code class="p">)</code></pre>&#13;
&#13;
<p>When run, this creates a temporary file containing HTML and JavaScript to allow&#13;
interactive exploration of the data.&#13;
The library also opens this in a browser, shown in <a data-type="xref" href="#javacook-ds-FIG-timevis">Figure 11-2</a>.&#13;
One can explore the data by expanding or contracting the timeline and scrolling&#13;
sideways.</p>&#13;
&#13;
<figure><div class="figure" id="javacook-ds-FIG-timevis">&#13;
<img alt="jcb4 1102" src="assets/jcb4_1102.png"/>&#13;
<h6><span class="label">Figure 11-2. </span>TimeVis (shiny) in action</h6>&#13;
</div></figure>&#13;
&#13;
<p>Where there are two boxes (Cid, Sagas), the first is when the life or stories&#13;
took place, and the second is when they were written down.</p>&#13;
&#13;
<p>To expose this on the public web, copy the file&#13;
(whose full path is revealed in the browser titlebar)&#13;
and the <em>lib</em> folder in that same directory&#13;
into a directory served by the web server.&#13;
Or just use File→Save As→Complete Web Page within the browser.&#13;
Either way, you must do this while the R session is running, as&#13;
the temporary files are deleted when the session ends.&#13;
Or, if you are familiar with the <code>shiny</code> framework,&#13;
you can insert the <code>timevis</code> visualization into a <code>shiny</code> application.<a data-primary="" data-startref="r_ch" data-type="indexterm" id="idm45290646398872"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45290648185096"><sup><a href="ch11.html#idm45290648185096-marker">1</a></sup> <em>Map/Reduce</em> is a famous algorithm pioneered by Google to handle large data problems.     An unspecified number of generators process <em>map</em> data—such as words on a web page or the page’s URL—and a single (usually) reduce process reduces the maps to a manageable form, such as a list     of all the pages that contain the given words.     Early on, data science went overboard on trying to do everything with Map/Reduce;     now the pendulum has swung back to using compute engines like Spark.</p><p data-type="footnote" id="idm45290648114600"><sup><a href="ch11.html#idm45290648114600-marker">2</a></sup> DataBricks offers several free ebooks on Spark from their website; it also offers commercial Spark add-ons.</p></div></div></section></body></html>