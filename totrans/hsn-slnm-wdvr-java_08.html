<html><head></head><body><section data-pdf-bookmark="Chapter 6. Remote WebDriver" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch06">&#13;
<h1><span class="label">Chapter 6. </span>Remote WebDriver</h1>&#13;
&#13;
&#13;
<p>So far, the examples explained in this book use web browsers locally installed on the machine that executes the tests. This <a data-primary="remote browsers" data-secondary="about" data-type="indexterm" id="idm45849712967280"/><a data-primary="Selenium WebDriver API" data-secondary="about" data-type="indexterm" id="idm45849712966368"/><a data-primary="Selenium WebDriver API" data-secondary="with remote browsers" data-secondary-sortas="remote browsers" data-seealso="RemoteWebDriver class" data-type="indexterm" id="ch6_term1"/><a data-primary="remote browsers" data-secondary="architecture, Selenium WebDriver" data-type="indexterm" id="ch6_term2"/><a data-primary="Selenium WebDriver API" data-secondary="architecture of" data-type="indexterm" id="ch6_term3"/><a data-primary="drivers" data-secondary="architecture of" data-type="indexterm" id="ch6_term4"/>chapter covers another relevant feature of the Selenium WebDriver API, i.e., the ability to use remote browsers (i.e., installed in other hosts). First, we review the architecture that allows using remote browsers in Selenium WebDriver. Second, we study Selenium Grid, a networked infrastructure that provides remote browsers for Selenium WebDriver tests. Third, we analyze some of the most relevant cloud providers, i.e., companies that provide managed services for automated testing. Finally, we explore how to use Docker to support the browser infrastructure for Selenium.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Selenium WebDriver Architecture" data-type="sect1"><div class="sect1" id="idm45849712959792">&#13;
<h1>Selenium WebDriver Architecture</h1>&#13;
&#13;
<p>As introduced in <a data-type="xref" href="ch01.html#ch01">Chapter 1</a>, Selenium WebDriver is a library that allows controlling web browsers programmatically. The <a data-primary="automation of browsers" data-secondary="architecture for" data-type="indexterm" id="ch6_term5"/>automation is based on the native capabilities of each browser. Therefore, we need to place a binary file called a <em>driver</em> between the script (typically, a test) using the Selenium WebDriver API and the browser. The examples you have seen so far in this book use <a data-primary="browsers" data-secondary="local" data-type="indexterm" id="idm45849712955264"/><a data-primary="Selenium WebDriver API" data-secondary="with local browsers" data-secondary-sortas="local browsers" data-type="indexterm" id="idm45849712954288"/>local browsers, i.e., browsers installed in the same machine that executes the test that uses the Selenium WebDriver API. <a data-type="xref" href="#remotewebdriver-local">Figure 6-1</a> illustrates this approach. In this case, and when using the Java language binding of the Selenium WebDriver API, we need to <a data-primary="Selenium WebDriver API" data-secondary="drivers supported by" data-type="indexterm" id="idm45849712952144"/><a data-primary="ChromeDriver" data-type="indexterm" id="idm45849712951200"/><a data-primary="FirefoxDriver" data-type="indexterm" id="idm45849712950528"/>create an instance of <code>ChromeDriver</code> to control Chrome, <code>FirefoxDriver</code> for Firefox, etc.</p>&#13;
&#13;
<figure><div class="figure" id="remotewebdriver-local">&#13;
<img alt="hosw 0601" src="assets/hosw_0601.png"/>&#13;
<h6><span class="label">Figure 6-1. </span>Selenium WebDriver architecture using local browsers</h6>&#13;
</div></figure>&#13;
&#13;
<p>The communication <a data-primary="W3C specifications" data-secondary="for WebDriver protocol" data-secondary-sortas="WebDriver protocol" data-type="indexterm" id="idm45849712946576"/>protocol that supports this process is called W3C WebDriver. This standard protocol is based on JSON messages over HTTP. Thanks to this, the Selenium WebDriver architecture can be distributed to different interconnected computers (<em>hosts</em>). <a data-type="xref" href="#remotewebdriver-remote">Figure 6-2</a> shows a schematic representation of a remote architecture.</p>&#13;
&#13;
<figure><div class="figure" id="remotewebdriver-remote">&#13;
<img alt="hosw 0602" src="assets/hosw_0602.png"/>&#13;
<h6><span class="label">Figure 6-2. </span>Selenium WebDriver architecture using remote browsers</h6>&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before">In this case, the Selenium WebDriver API sends W3C WebDriver messages to a <a data-primary="Hub (Selenium Server)" data-type="indexterm" id="idm45849712941232"/><a data-primary="Selenium Grid" data-secondary="Hub (Selenium Server) of" data-type="indexterm" id="idm45849712940528"/><a data-primary="Selenium Server (Hub)" data-type="indexterm" id="idm45849712939616"/>server-side component usually called <em>Selenium Server</em>. This server acts as a proxy of the client requests to other hosts that provide web browsers where the automation happens. This remote architecture eases cross-browser testing (i.e., verifying web applications in multiple browser types, versions, or operating systems) and parallel test execution.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Creation of RemoteWebDriver Objects" data-type="sect1"><div class="sect1" id="remotewebdriver-creation">&#13;
<h1>Creation of RemoteWebDriver Objects</h1>&#13;
&#13;
<p>The Selenium <a data-startref="ch6_term1" data-type="indexterm" id="idm45849712936592"/><a data-startref="ch6_term2" data-type="indexterm" id="idm45849712935472"/><a data-startref="ch6_term3" data-type="indexterm" id="idm45849712934800"/><a data-startref="ch6_term4" data-type="indexterm" id="idm45849712934128"/><a data-startref="ch6_term5" data-type="indexterm" id="idm45849712933456"/><a data-primary="RemoteWebDriver class" data-secondary="as parent of WebDriver classes" data-secondary-sortas="parent of WebDriver classes" data-type="indexterm" id="idm45849712932784"/><a data-primary="drivers" data-secondary="WebDriver hierarchy of classes of" data-type="indexterm" id="idm45849712931632"/><a data-primary="objects" data-secondary="RemoteWebDriver and" data-type="indexterm" id="ch6_term8"/><a data-primary="remote browsers" data-secondary="creation of RemoteWebDriver objects for" data-type="indexterm" id="ch6_term9"/><a data-primary="RemoteWebDriver class" data-secondary="object creation in" data-type="indexterm" id="ch6_term10"/>WebDriver API provides the class <code>RemoteWebDriver</code> to control remote browsers. As shown in <a data-type="xref" href="ch02.html#webdriver-hierarchy">Figure 2-2</a>, this class is the parent of the rest of the <code>WebDriver</code> classes that drive local browsers (i.e., <code>ChromeDriver</code>, <code>FirefoxDriver</code>, etc.). This way, you can use <code>RemoteWebDriver</code> objects in the same way we have previously studied in this book.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="RemoteWebDriver Constructor" data-type="sect2"><div class="sect2" id="idm45849712936256">&#13;
<h2>RemoteWebDriver Constructor</h2>&#13;
&#13;
<p>There are different <a data-primary="browser-specific capabilities" data-secondary="Capabilities hierarchy and interface" data-type="indexterm" id="idm45849712922432"/><a data-primary="Capabilities hierarchy and interface" data-type="indexterm" id="idm45849712921104"/><a data-primary="ChromeOptions" data-type="indexterm" id="idm45849712920464"/><a data-primary="constructor of RemoteWebDriver" data-type="indexterm" id="ch6_term6"/><a data-primary="RemoteWebDriver class" data-secondary="constructor of" data-type="indexterm" id="ch6_term7"/>ways to instantiate a <code>RemoteWebDriver</code> object. The most common way is to invoke its constructor by passing two arguments: the URL of the Selenium Server and the required capabilities. As shown in <a data-type="xref" href="ch05.html#capabilities-hierarchy">Figure 5-1</a>, these capabilities are objects that inherit from the <code>Capabilities</code> interface (e.g., <code>ChromeOptions</code>, <code>Firefox​Op⁠tions</code>, etc.). <a data-type="xref" href="#remotewebdriver_creation_1">Example 6-1</a> shows a test setup. You can find the complete test in this book’s <a href="https://github.com/bonigarcia/selenium-webdriver-java">code repository</a>.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>There is a second <code>RemoteWebDriver</code> constructor, which <a data-primary="web driver.remote.server property" data-type="indexterm" id="idm45849712912064"/>accepts only one parameter for the desired capabilities. In this case, the Selenium Server URL is read from the Java system property <span class="keep-together"><code>webdriver.remote.server</code></span>. You can find an example of this feature in the examples repository.</p>&#13;
</div>&#13;
<div data-type="example" id="remotewebdriver_creation_1">&#13;
<h5><span class="label">Example 6-1. </span>Instantiation of a RemoteWebDriver object using the constructor</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">MalformedURLException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">URL</code><code> </code><code class="n">seleniumServerUrl</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">URL</code><code class="o">(</code><code class="s">"http://localhost:4444/"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO1-1" id="co_remote_webdriver_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">isOnline</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isTrue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO1-2" id="co_remote_webdriver_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO1-3" id="co_remote_webdriver_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">RemoteWebDriver</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">,</code><code> </code><code class="n">options</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO1-4" id="co_remote_webdriver_CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO1-1" id="callout_remote_webdriver_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create a Java <code>URL</code> object <a data-primary="Java" data-secondary="and creation of instances" data-secondary-sortas="creation of instances" data-type="indexterm" id="idm45849712843456"/>with the Selenium Server address.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO1-2" id="callout_remote_webdriver_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We assume this URL is online. For that, we <a data-primary="AssertJ assertions" data-type="indexterm" id="idm45849712839536"/><a data-primary="isOnline() method" data-type="indexterm" id="idm45849712838832"/>create an AssertJ assumption by invoking the static method <code>isOnline</code> available on WebDriverManager. As a result, the test is skipped when the Selenium Server is offline.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO1-3" id="callout_remote_webdriver_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We instantiate a <code>ChromeOptions</code> object to specify the required capabilities.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO1-4" id="callout_remote_webdriver_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We invoke the <code>RemoteWebDriver</code> constructor using the Selenium Server URL and the Chrome options as arguments.</p></dd>&#13;
</dl>&#13;
&#13;
<p>We use a <code>ChromeOptions</code> object without any particular setup to specify the required capabilities in the previous example. In other words, <a data-primary="Chrome" data-secondary="RemoteWebDriver tests with" data-type="indexterm" id="idm45849712792080"/>we request to use a remote Chrome browser using its default behavior. Nevertheless, we could use this object to configure specific capabilities (e.g., headless browser, page loading strategies, device emulation, etc.) as explained in <a data-type="xref" href="ch05.html#ch05">Chapter 5</a>. Moreover, since <a data-primary="CapabilityType class and attributes" data-type="indexterm" id="idm45849712790208"/><a data-primary="options.setCapability(key, value) method" data-type="indexterm" id="idm45849712789488"/>capabilities are internally handled using key-value pairs that encapsulate specific browser aspects, we can manage individual capabilities invoking the method <code>options.setCapability(key, value);</code>. The Selenium WebDriver API provides the class <code>CapabilityType</code> to specify the key of these capabilities. This class has a set of <a data-primary="setCapability() method" data-type="indexterm" id="idm45849712787824"/>public attributes that can be used as a <code>key</code> in the <code>setCapability()</code> method. <a data-type="xref" href="#capabilitytype-attributes">Table 6-1</a> shows some of these attributes.</p>&#13;
<table id="capabilitytype-attributes">&#13;
<caption><span class="label">Table 6-1. </span>CapabilityType attributes</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Attribute</th>&#13;
<th>Capability name</th>&#13;
<th>Description</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">BROWSER_NAME</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">browserName</code></pre></div></td>&#13;
<td><p>Browser name (e.g., <code>chrome</code>, <code>firefox</code>, or <code>msedge</code>)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">PLATFORM_NAME</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">platformName</code></pre></div></td>&#13;
<td><p>Platform name (e.g., <code>WINDOWS</code>, <code>LINUX</code>, <code>MAC</code>, <code>ANDROID</code>, <code>IOS</code>, among others)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">BROWSER_VERSION</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">browserVersion</code></pre></div></td>&#13;
<td><p>Browser version</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">SUPPORTS_JAVASCRIPT</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">javascriptEnabled</code></pre></div></td>&#13;
<td><p>Enable or disable JavaScript execution</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">PAGE_LOAD_STRATEGY</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">pageLoadStrategy</code></pre></div></td>&#13;
<td><p>Page loading strategy (<code>normal</code>, <code>eager</code>, or <code>none</code>)</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>An alternative way to <a data-primary="DesiredCapabilities methods" data-type="indexterm" id="idm45849712640480"/>specify the required capabilities in a <code>RemoteWebDriver</code> object is using an instance of <code>DesiredCapabilities</code>. <a data-type="xref" href="#desiredcapabilities-methods">Table 6-2</a> summarizes the methods provided by these objects.</p>&#13;
<table id="desiredcapabilities-methods">&#13;
<caption><span class="label">Table 6-2. </span>DesiredCapabilities methods</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Method</th>&#13;
<th>Return</th>&#13;
<th>Description</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">setBrowserName</code><code class="o">(</code><code class="n">String</code> <code class="n">browserName</code><code class="o">)</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code></pre></div></td>&#13;
<td><p>Specify the browser name</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">setVersion</code><code class="o">(</code><code class="n">String</code> <code class="n">version</code><code class="o">)</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code></pre></div></td>&#13;
<td><p>Specify the browser version</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">setPlatform</code><code class="o">(</code><code class="n">Platform</code> <code class="n">platform</code><code class="o">)</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code></pre></div></td>&#13;
<td><p>Specify the platform name</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">setJavascriptEnabled</code><code class="o">(</code><code class="kt">boolean</code>&#13;
    <code class="n">javascriptEnabled</code><code class="o">)</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code></pre></div></td>&#13;
<td><p>Enable or disable JavaScript execution</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">setAcceptInsecureCerts</code><code class="o">(</code><code class="kt">boolean</code>&#13;
    <code class="n">acceptInsecureCerts</code><code class="o">)</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code></pre></div></td>&#13;
<td><p>Enable or disable loading insecure pages</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">acceptInsecureCerts</code><code class="o">()</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">void</code></pre></div></td>&#13;
<td><p>Enable loading insecure pages</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">merge</code><code class="o">(</code><code class="n">Capabilities</code>&#13;
    <code class="n">extraCapabilities</code><code class="o">)</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">DesiredCapabilities</code></pre></div></td>&#13;
<td><p>Merge with another capabilities object</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p><code>DesiredCapabilities</code> is still <a data-primary="Selenium WebDriver 4 (version)" data-secondary="desired capabilities and" data-type="indexterm" id="idm45849712300640"/>supported by Selenium WebDriver 4 since there is a lot of existing code relying on this feature. <a data-primary="browser-specific capabilities" data-secondary="browser specification for" data-type="indexterm" id="idm45849712299552"/>Nevertheless, the recommended way to specify capabilities is using <a data-startref="ch6_term6" data-type="indexterm" id="idm45849712298576"/><a data-startref="ch6_term7" data-type="indexterm" id="idm45849712297936"/>browser-specific options (e.g., <code>ChromeOptions</code>, <code>FirefoxOptions</code>, etc.).</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="RemoteWebDriver Builder" data-type="sect2"><div class="sect2" id="idm45849712923440">&#13;
<h2>RemoteWebDriver Builder</h2>&#13;
&#13;
<p>A second way to <a data-primary="builder in RemoteWebDriver" data-type="indexterm" id="idm45849712254112"/><a data-primary="Edge" data-secondary="and RemoteWebDriver object creation" data-secondary-sortas="RemoteWebDriver object creation" data-type="indexterm" id="idm45849712253408"/><a data-primary="RemoteWebDriver.builder" data-type="indexterm" id="idm45849712252256"/><a data-primary="Hub (Selenium Server)" data-type="indexterm" id="ch6_term11"/><a data-primary="Selenium Grid" data-secondary="Hub (Selenium Server) of" data-type="indexterm" id="ch6_term12"/><a data-primary="Selenium Server (Hub)" data-type="indexterm" id="ch6_term13"/>create <code>RemoteWebDriver</code> objects is using the built-in builder available in the Selenium WebDriver API. <a data-type="xref" href="#remotewebdriver_creation_2">Example 6-2</a> demonstrates how, using Edge as the remote browser.</p>&#13;
<div data-type="example" id="remotewebdriver_creation_2">&#13;
<h5><span class="label">Example 6-2. </span>Instantiation of a RemoteWebDriver object using the builder</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code>&#13;
<code class="kt">void</code> <code class="nf">setup</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">MalformedURLException</code> <code class="o">{</code>&#13;
    <code class="n">URL</code> <code class="n">seleniumServerUrl</code> <code class="o">=</code> <code class="k">new</code> <code class="n">URL</code><code class="o">(</code><code class="s">"http://localhost:4444/"</code><code class="o">);</code>&#13;
    <code class="n">assumeThat</code><code class="o">(</code><code class="n">isOnline</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">)).</code><code class="na">isTrue</code><code class="o">();</code>&#13;
&#13;
    <code class="n">driver</code> <code class="o">=</code> <code class="n">RemoteWebDriver</code><code class="o">.</code><code class="na">builder</code><code class="o">().</code><code class="na">oneOf</code><code class="o">(</code><code class="k">new</code> <code class="n">EdgeOptions</code><code class="o">())</code>&#13;
            <code class="o">.</code><code class="na">address</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">).</code><code class="na">build</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="WebDriverManager Builder" data-type="sect2"><div class="sect2" id="idm45849712212144">&#13;
<h2>WebDriverManager Builder</h2>&#13;
&#13;
<p>Alternatively, we can also use <a data-primary="builder, WebDriverManager" data-type="indexterm" id="idm45849712192496"/><a data-primary="Firefox" data-secondary="RemoteWebDriver examples with" data-type="indexterm" id="idm45849712191888"/><a data-primary="remoteAddress() method" data-type="indexterm" id="idm45849712191008"/><a data-primary="WebDriverManager" data-secondary="builder utility in" data-type="indexterm" id="idm45849712190336"/><a data-primary="WebDriverManager" data-secondary="for creation of RemoteWebDriver objects" data-secondary-sortas="creation of RemoteWebDriver objects" data-type="indexterm" id="idm45849712189392"/>WebDriverManager to create an instance of <code>RemoteWebDriver</code>. To that aim, we need to invoke the method <code>remoteAddress()</code> of a given manager to pass the Selenium Server URL.  <a data-type="xref" href="#remotewebdriver_creation_3">Example 6-3</a> shows a test setup using this feature and Firefox as the remote browser.</p>&#13;
<div data-type="example" id="remotewebdriver_creation_3">&#13;
<h5><span class="label">Example 6-3. </span>Instantiation of a RemoteWebDriver object using WebDriverManager</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code>&#13;
<code class="kt">void</code> <code class="nf">setup</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">MalformedURLException</code> <code class="o">{</code>&#13;
    <code class="n">URL</code> <code class="n">seleniumServerUrl</code> <code class="o">=</code> <code class="k">new</code> <code class="n">URL</code><code class="o">(</code><code class="s">"http://localhost:4444/"</code><code class="o">);</code>&#13;
    <code class="n">assumeThat</code><code class="o">(</code><code class="n">isOnline</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">)).</code><code class="na">isTrue</code><code class="o">();</code>&#13;
&#13;
    <code class="n">driver</code> <code class="o">=</code> <code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">()</code>&#13;
            <code class="o">.</code><code class="na">remoteAddress</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">).</code><code class="na">create</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Selenium-Jupiter" data-type="sect2"><div class="sect2" id="idm45849712088272">&#13;
<h2>Selenium-Jupiter</h2>&#13;
&#13;
<p>As usual, Selenium-Jupiter <a data-primary="parameter resolution extension" data-type="indexterm" id="idm45849712141168"/><a data-primary="Selenium-Jupiter" data-secondary="with remote browsers" data-secondary-sortas="remote browsers" data-type="indexterm" id="idm45849712140528"/>uses the parameter resolution feature provided by Jupiter. This way, and concerning remote browsers, you need to declare a test (or constructor) parameter using the type <code>RemoteWebDriver</code>. Then, the following Selenium-Jupiter annotations allow configuring the remote browser:</p>&#13;
<dl>&#13;
<dt><code>@DriverUrl</code></dt>&#13;
<dd>&#13;
<p>Annotation used <a data-primary="@DriverURL annotation" data-primary-sortas="DriverURL annotation" data-type="indexterm" id="idm45849712123136"/>to identify the Selenium Server URL. Alternatively, the annotation <code>@EnabledIfDriverUrlOnline</code> allows specifying this URL, and at the same time, disables the test if that URL is not responding.</p>&#13;
</dd>&#13;
<dt><code>@DriverCapabilities</code></dt>&#13;
<dd>&#13;
<p>Annotation used <a data-primary="@DriverCapabilities annotation" data-primary-sortas="DriverCapabilities annotation" data-type="indexterm" id="idm45849712120096"/>to configure the desired capabilities.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#remotewebdriver_creation_4">Example 6-4</a> shows a Selenium-Jupiter <a data-primary="Chrome" data-secondary="RemoteWebDriver tests with" data-type="indexterm" id="idm45849712071456"/>test using a remote Chrome provided by a local Selenium Server. This test will be skipped when the URL <code>http://localhost:4444/</code> is offline.</p>&#13;
<div data-type="example" id="remotewebdriver_creation_4">&#13;
<h5><span class="label">Example 6-4. </span>Using a RemoteWebDriver object in Selenium-Jupiter test</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@EnabledIfDriverUrlOnline</code><code class="o">(</code><code class="s">"http://localhost:4444/"</code><code class="o">)</code>&#13;
<code class="nd">@ExtendWith</code><code class="o">(</code><code class="n">SeleniumJupiter</code><code class="o">.</code><code class="na">class</code><code class="o">)</code>&#13;
<code class="kd">class</code> <code class="nc">RemoteChromeSelJupTest</code> <code class="o">{</code>&#13;
&#13;
    <code class="nd">@DriverCapabilities</code>&#13;
    <code class="n">ChromeOptions</code> <code class="n">options</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ChromeOptions</code><code class="o">();</code>&#13;
&#13;
    <code class="nd">@Test</code>&#13;
    <code class="kt">void</code> <code class="nf">testRemote</code><code class="o">(</code><code class="n">RemoteWebDriver</code> <code class="n">driver</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">);</code>&#13;
        <code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">()).</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
<code class="o">}</code></pre></div>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The <code>RemoteWebDriver</code> instantiation modes described in this section are equivalent from a functional point of view. In other words, these objects work in the same way. The difference between them is <a data-startref="ch6_term8" data-type="indexterm" id="idm45849712037520"/><a data-startref="ch6_term9" data-type="indexterm" id="idm45849712036912"/><a data-startref="ch6_term10" data-type="indexterm" id="idm45849712036240"/>the provided <em>syntactic sugar</em> (i.e., the style and expressiveness).</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Selenium Grid" data-type="sect1"><div class="sect1" id="sel-grid-ch06">&#13;
<h1>Selenium Grid</h1>&#13;
&#13;
<p>As introduced in <a data-type="xref" href="ch01.html#ch01">Chapter 1</a>, Selenium Grid <a data-primary="Selenium Grid" data-secondary="about" data-type="indexterm" id="idm45849712031904"/><a data-primary="W3C specifications" data-secondary="Selenium Grid and" data-type="indexterm" id="idm45849712030928"/><a data-primary="remote browsers" data-secondary="Selenium Grid for" data-type="indexterm" id="ch6_term14"/>is a subproject of the Selenium suite that allows creating a networked infrastructure for remote browsers accessible with the W3C WebDriver protocol. Selenium Grid allows running parallel tests across different machines and different browsers. To that aim, Selenium Grid provides a Selenium Server that you can control using an instance of <code>RemoteWebDriver</code>. There are three ways to run Selenium Grid:</p>&#13;
<dl>&#13;
<dt>Standalone</dt>&#13;
<dd>&#13;
<p>A single host <a data-primary="Selenium Grid" data-secondary="standalone mode of" data-type="indexterm" id="ch6_term24"/><a data-primary="standalone mode, Selenium Grid" data-type="indexterm" id="ch6_term25"/>acts as Selenium Server and supplies the browsers in this mode. It provides a simple way to run Selenium WebDriver tests in remote browsers.</p>&#13;
</dd>&#13;
<dt>Hub-nodes</dt>&#13;
<dd>&#13;
<p>A potential <a data-primary="hub-nodes mode, Selenium Grid" data-type="indexterm" id="idm45849712022704"/><a data-primary="Selenium Grid" data-secondary="hub-nodes mode of" data-type="indexterm" id="idm45849712022000"/><a data-primary="scalability of Selenium Grid" data-type="indexterm" id="idm45849712021056"/>problem of the standalone mode is the scalability (since the Selenium Server and the browsers are executed in the same home). Thus, the hub-nodes architecture defines two types of components to solve this issue. First, one host acts as <em>hub</em> (or Selenium Server). Then, one or most hosts are registered as <em>nodes</em> in the hub, providing browsers to be controlled with Selenium WebDriver. This architecture was introduced in <a data-type="xref" href="ch01.html#ch01">Chapter 1</a> (see <a data-type="xref" href="ch01.html#selenium-grid-hub-node-arch">Figure 1-2</a>).</p>&#13;
</dd>&#13;
<dt>Fully distributed</dt>&#13;
<dd>&#13;
<p>The standalone <a data-primary="distributed mode, Selenium Grid" data-type="indexterm" id="idm45849711968320"/><a data-primary="fully distributed mode, Selenium Grid" data-type="indexterm" id="idm45849711967616"/><a data-primary="Selenium 4 (version)" data-primary-sortas="Selenium four (version)" data-type="indexterm" id="idm45849711966976"/><a data-primary="Selenium Grid" data-secondary="fully distributed mode of" data-type="indexterm" id="idm45849711966032"/>and the hub-nodes approaches are centralized architectures that can degrade performance when the number of incoming requests increases. As of Selenium 4, Selenium Grid provides a fully distributed mode that implements load balancing mechanisms to solve <a data-startref="ch6_term11" data-type="indexterm" id="idm45849711964992"/><a data-startref="ch6_term12" data-type="indexterm" id="idm45849711964320"/><a data-startref="ch6_term13" data-type="indexterm" id="idm45849711963648"/>this bottleneck.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The following subsections provide more details about these modes and explain how to set up each approach.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Standalone" data-type="sect2"><div class="sect2" id="idm45849711962048">&#13;
<h2>Standalone</h2>&#13;
&#13;
<p>The standalone is the simplest approach for a Selenium Grid infrastructure. We can execute this mode using the shell and Java code.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="From the shell" data-type="sect3"><div class="sect3" id="idm45849711960560">&#13;
<h3>From the shell</h3>&#13;
&#13;
<p>First, we can use the shell and the Selenium Grid binary distribution to launch it. Selenium Grid is <a data-primary="Java" data-secondary="Selenium Grid in" data-type="indexterm" id="idm45849711958784"/><a data-primary="Selenium Grid" data-secondary="fat-JAR files for" data-type="indexterm" id="idm45849711957808"/>developed in Java, and each release is distributed as a self-contained JAR file with all its dependencies (also known as <em>uber-JAR</em> or <em>fat-JAR</em>). You can download this fat-JAR from the <a href="https://www.selenium.dev/downloads">Selenium download page</a>.</p>&#13;
&#13;
<p>The Selenium Server automatically detects the drivers (e.g., chromedriver, geckodriver, etc.) available in the system in the standalone mode. To that aim, it looks for these drivers in the <code>PATH</code> environment variable. As usual, we can manage these driver managers manually. <a data-primary="automation of browsers" data-secondary="driver management and" data-type="indexterm" id="idm45849711954000"/><a data-primary="driver management" data-secondary="automation of" data-type="indexterm" id="idm45849711953024"/><a data-primary="WebDriverManager" data-secondary="for automation" data-secondary-sortas="automation" data-type="indexterm" id="idm45849711952080"/><a data-primary="WebDriverManager" data-secondary="as fat-JAR" data-secondary-sortas="fat-JAR" data-type="indexterm" id="idm45849711950864"/><a data-primary="chromedriver" data-type="indexterm" id="ch6_term15"/><a data-primary="CLI (command-line interface) tool" data-type="indexterm" id="ch6_term16"/><a data-primary="command-line interface (CLI) tool" data-type="indexterm" id="ch6_term17"/><a data-primary="drivers" data-secondary="WebDriverManager resolution of" data-type="indexterm" id="ch6_term18"/><a data-primary="Firefox" data-secondary="and geckodriver" data-secondary-sortas="geckodriver" data-type="indexterm" id="ch6_term19"/><a data-primary="geckodriver" data-type="indexterm" id="ch6_term20"/><a data-primary="shell, launching from" data-type="indexterm" id="ch6_term21"/><a data-primary="WebDriverManager" data-secondary="as CLI tool" data-secondary-sortas="CLI tool" data-type="indexterm" id="ch6_term22"/><a data-primary="WebDriverManager" data-secondary="driver resolution by" data-type="indexterm" id="ch6_term23"/>Nevertheless, it is recommended to use WebDriverManager to resolve the drivers automatically. Thus, and as explained in <a data-type="xref" href="app02.html#appendix02">Appendix B</a>, WebDriverManager can be used as a CLI tool. WebDriverManager CLI is distributed as a <span class="keep-together">fat-JAR</span>, available for download on <a href="https://github.com/bonigarcia/webdrivermanager/releases">GitHub</a>.</p>&#13;
&#13;
<p>To illustrate this, <a data-type="xref" href="#standalone_cli">Example 6-5</a> shows the shell commands required to resolve chromedriver and geckodriver in a Linux machine with WebDriverManager CLI. Then, we use the Selenium Grid fat-JAR to start a standalone grid. Notice that these commands are executed in the same folder. This way, the drivers downloaded with WebDriverManager are available for Selenium Grid.</p>&#13;
<div data-type="example" id="standalone_cli">&#13;
<h5><span class="label">Example 6-5. </span>Commands to resolve drivers with WebDriverManager CLI and to start Selenium Grid in standalone mode using the shell</h5>&#13;
&#13;
<pre data-type="programlisting">boni@linux:~/grid$ java -jar webdrivermanager-5.0.3-fat.jar resolveDriverFor chrome <a class="co" href="#callout_remote_webdriver_CO2-1" id="co_remote_webdriver_CO2-1"><img alt="1" src="assets/1.png"/></a>&#13;
[INFO] Using WebDriverManager to resolve chrome&#13;
[DEBUG] Detecting chrome version using online commands.properties&#13;
[DEBUG] Running command on the shell: [google-chrome, --version]&#13;
[DEBUG] Result: Version=94.0.4606.71&#13;
[DEBUG] Latest version of chromedriver according to&#13;
    https://chromedriver.storage.googleapis.com/LATEST_RELEASE_94 is 94.0.4606.61&#13;
[INFO] Using chromedriver 94.0.4606.61 (resolved driver for Chrome 94)&#13;
[INFO] Reading https://chromedriver.storage.googleapis.com/ to seek&#13;
    chromedriver&#13;
[DEBUG] Driver to be downloaded chromedriver 94.0.4606.61&#13;
[INFO] Downloading https://chromedriver.storage.googleapis.com/94.0.4606.61/&#13;
    chromedriver_linux64.zip&#13;
[INFO] Extracting driver from compressed file chromedriver_linux64.zip&#13;
[INFO] Driver location: /home/boni/grid/chromedriver&#13;
&#13;
boni@linux:~/grid$ java -jar webdrivermanager-5.0.3-fat.jar resolveDriverFor firefox <a class="co" href="#callout_remote_webdriver_CO2-2" id="co_remote_webdriver_CO2-2"><img alt="2" src="assets/2.png"/></a>&#13;
[INFO] Using WebDriverManager to resolve firefox&#13;
[DEBUG] Detecting firefox version using online commands.properties&#13;
[DEBUG] Running command on the shell: [firefox, -v]&#13;
[DEBUG] Result: Version=92.0.0.7916&#13;
[DEBUG] Getting driver version for firefox92 from online versions.properties&#13;
[INFO] Using geckodriver 0.30.0 (resolved driver for Firefox 92)&#13;
[INFO] Reading https://api.github.com/repos/mozilla/geckodriver/releases to&#13;
    seek geckodriver&#13;
[DEBUG] Driver to be downloaded geckodriver 0.30.0&#13;
[INFO] Downloading https://github.com/mozilla/geckodriver/releases/download/&#13;
    v0.30.0/geckodriver-v0.30.0-linux64.tar.gz&#13;
[INFO] Extracting driver from compressed file geckodriver-v0.30.0-linux64.tar.gz&#13;
[INFO] Driver location: /home/boni/grid/geckodriver&#13;
&#13;
boni@linux:~/grid$ java -jar selenium-server-4.0.0.jar standalone <a class="co" href="#callout_remote_webdriver_CO2-3" id="co_remote_webdriver_CO2-3"><img alt="3" src="assets/3.png"/></a>&#13;
INFO [LogManager$RootLogger.log] - Using the system default encoding&#13;
INFO [OpenTelemetryTracer.createTracer] - Using OpenTelemetry for tracing&#13;
INFO [NodeOptions.getSessionFactories] - Detected 8 available processors&#13;
INFO [NodeOptions.discoverDrivers] - Discovered 2 driver(s)&#13;
INFO [NodeOptions.report] - Adding Chrome for {"browserName": "chrome"} 8 times&#13;
INFO [NodeOptions.report] - Adding Firefox for {"browserName": "firefox"} 8 times&#13;
INFO [Node.&lt;init&gt;] - Binding additional locator mechanisms: name, id, relative&#13;
INFO [LocalDistributor.add] - Added node 41045bd8-ec7e-43c9-84bd-f63f7aca59ed&#13;
    at http://192.168.56.1:4444. Health check every 120s&#13;
INFO [GridModel.setAvailability] - Switching node 41045bd8-ec7e-43c9-84bd-&#13;
    f63f7aca59ed (uri: http://192.168.56.1:4444) from DOWN to UP&#13;
INFO [Standalone.execute] - Started Selenium Standalone 4.0.0 (revision&#13;
    3a21814679): http://192.168.56.1:4444</pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO2-1" id="callout_remote_webdriver_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use WebDriverManager <a data-primary="DEBUG log level" data-type="indexterm" id="idm45849711925648"/><a data-primary="INFO log level" data-type="indexterm" id="idm45849711924944"/>CLI to resolve chromedriver.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO2-2" id="callout_remote_webdriver_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We use WebDriverManager CLI to resolve geckodriver (the driver required for Firefox).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO2-3" id="callout_remote_webdriver_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We start Selenium Grid in standalone mode in the same folder (which contains chromedriver and geckodriver).</p></dd>&#13;
</dl>&#13;
&#13;
<p>After these commands, the <a data-primary="Hub (Selenium Server)" data-type="indexterm" id="idm45849711918608"/><a data-primary="Selenium Grid" data-secondary="Hub (Selenium Server) of" data-type="indexterm" id="idm45849711917904"/><a data-primary="Selenium Server (Hub)" data-type="indexterm" id="idm45849711916944"/>standalone Selenium Server listens to incoming HTTP requests in port 4444 of the localhost. Therefore, we can create an instance of <code>RemoteWebDriver</code> using that URL (e.g., <code>http://localhost:4444/</code> if the test executes in the same host) and the required capabilities (for Chrome or Firefox, in this case). For instance, as follows:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">WebDriver</code> <code class="n">driver</code> <code class="o">=</code> <code class="k">new</code> <code class="n">RemoteWebDriver</code><code class="o">(</code><code class="s">"http://localhost:4444/"</code><code class="o">,</code>&#13;
        <code class="k">new</code> <code class="nf">ChromeOptions</code><code class="o">());</code></pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>In Selenium Grid 3, the default Selenium Server URL is <code>http://localhost:4444/wd/hub</code>. In Selenium Grid 4, although this URL should also work, the path <code>/wd/hub</code> is no longer required.</p>&#13;
</div>&#13;
&#13;
<p>Another helpful <a data-startref="ch6_term15" data-type="indexterm" id="idm45849711905712"/><a data-startref="ch6_term16" data-type="indexterm" id="idm45849711904976"/><a data-startref="ch6_term17" data-type="indexterm" id="idm45849711904304"/><a data-startref="ch6_term18" data-type="indexterm" id="idm45849711903632"/><a data-startref="ch6_term19" data-type="indexterm" id="idm45849711902960"/><a data-startref="ch6_term20" data-type="indexterm" id="idm45849711902288"/><a data-startref="ch6_term21" data-type="indexterm" id="idm45849711901616"/><a data-startref="ch6_term22" data-type="indexterm" id="idm45849711900944"/><a data-startref="ch6_term23" data-type="indexterm" id="idm45849711900272"/><a data-primary="console, Selenium Grid" data-type="indexterm" id="idm45849711899600"/><a data-primary="Selenium Grid" data-secondary="web console of" data-type="indexterm" id="idm45849711871344"/>feature provided by Selenium Grid is its <em>web console</em>. This console is a web UI accessible in the Selenium Server URL that allows monitoring of the available browsers registered in the grid and the sessions in execution.</p>&#13;
&#13;
<p><a data-type="xref" href="#selenium-grid-ui">Figure 6-3</a> shows a screenshot of the console of the previous standalone grid. Notice that in this case, the standalone Selenium Server can serve up to eight concurrent sessions (the same number of the available processors in the machine running the grid) of Chrome and Firefox.</p>&#13;
&#13;
<figure><div class="figure" id="selenium-grid-ui">&#13;
<img alt="hosw 0603" src="assets/hosw_0603.png"/>&#13;
<h6><span class="label">Figure 6-3. </span>Selenium Grid console</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="From Java code" data-type="sect3"><div class="sect3" id="idm45849711959936">&#13;
<h3>From Java code</h3>&#13;
&#13;
<p>An alternative way to <a data-primary="Java" data-secondary="Selenium Grid in" data-type="indexterm" id="idm45849711865536"/><a data-primary="Maven" data-secondary="Selenium Grid and" data-type="indexterm" id="idm45849711864560"/>start Selenium Grid is using Java. In addition to the fat-JAR, Selenium Grid is released to Maven Central using <code>org.seleniumhq.selenium</code> as <code>groupId</code> and <code>selenium-grid</code> as <code>artifactId</code>. This way, we need to resolve its coordinates in our project setup (Maven or Gradle) to use it in our Java project (see <a data-type="xref" href="app02.html#appendix02">Appendix B</a> for the configuration details). <a data-type="xref" href="#standalone_grid_java">Example 6-6</a> demonstrates how to start Selenium Grid in standalone mode from a Java test case.</p>&#13;
<div data-type="example" id="standalone_grid_java">&#13;
<h5><span class="label">Example 6-6. </span>Test starting Selenium Grid in standalone mode</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">static</code><code> </code><code class="n">URL</code><code> </code><code class="n">seleniumServerUrl</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@BeforeAll</code><code>&#13;
</code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setupAll</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">MalformedURLException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="kt">int</code><code> </code><code class="n">port</code><code> </code><code class="o">=</code><code> </code><code class="n">PortProber</code><code class="o">.</code><code class="na">findFreePort</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO3-1" id="co_remote_webdriver_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">setup</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO3-2" id="co_remote_webdriver_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">Main</code><code class="o">.</code><code class="na">main</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="k">new</code><code> </code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="o">{</code><code> </code><code class="s">"standalone"</code><code class="o">,</code><code> </code><code class="s">"--port"</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">.</code><code class="na">valueOf</code><code class="o">(</code><code class="n">port</code><code class="o">)</code><code> </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO3-3" id="co_remote_webdriver_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">seleniumServerUrl</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">URL</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="n">String</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"http://localhost:%d/"</code><code class="o">,</code><code> </code><code class="n">port</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO3-4" id="co_remote_webdriver_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">RemoteWebDriver</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">,</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO3-5" id="co_remote_webdriver_CO3-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO3-1" id="callout_remote_webdriver_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We find a free port on the localhost. For that, we <a data-primary="PortProber class" data-type="indexterm" id="idm45849711720336"/>use the class <code>PortProber</code>, available on Selenium WebDriver API.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO3-2" id="callout_remote_webdriver_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We use WebDriverManager to <a data-primary="chromedriver" data-type="indexterm" id="idm45849711740880"/>resolve chromedriver since the standalone grid to be started will serve Chrome browsers.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO3-3" id="callout_remote_webdriver_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We start Selenium Grid in standalone mode, calling its <code>main</code> method.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO3-4" id="callout_remote_webdriver_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We create a Java <code>URL</code> using the port previously selected.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO3-5" id="callout_remote_webdriver_CO3-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We create an instance of <code>RemoteWebDriver</code>. As usual, we use this object in the test logic to invoke the Selenium WebDriver API and control the browser (see the examples repository for the <a data-startref="ch6_term24" data-type="indexterm" id="idm45849711679856"/><a data-startref="ch6_term25" data-type="indexterm" id="idm45849711679152"/>entire class).</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Hub-nodes" data-type="sect2"><div class="sect2" id="idm45849711678096">&#13;
<h2>Hub-nodes</h2>&#13;
&#13;
<p>The classic architecture <a data-primary="hub-nodes mode, Selenium Grid" data-type="indexterm" id="ch6_term26"/><a data-primary="Selenium Grid" data-secondary="hub-nodes mode of" data-type="indexterm" id="ch6_term27"/><a data-primary="nodes, Selenium Grid and" data-type="indexterm" id="ch6_term28"/>of Selenium Grid involves two types of hosts: the hub (i.e., the Selenium Server) and a group of nodes. Like in the standalone mode, we can use the <a data-primary="Selenium Grid" data-secondary="fat-JAR files for" data-type="indexterm" id="idm45849711672960"/><a data-primary="INFO log level" data-type="indexterm" id="idm45849711672016"/><a data-primary="shell, launching from" data-type="indexterm" id="idm45849711671344"/>Selenium Grid fat-JAR to start this mode in the shell. First, we start the hub in a host. Then, we register one or more nodes in the same or different host. <a data-type="xref" href="#hub_nodes_cli">Example 6-7</a> shows the execution of these commands in a Windows console.</p>&#13;
<div data-type="example" id="hub_nodes_cli">&#13;
<h5><span class="label">Example 6-7. </span>Command to start Selenium Grid in hub-nodes mode using the shell</h5>&#13;
&#13;
<pre data-type="programlisting">C:\grid&gt;java -jar selenium-server-4.0.0.jar hub <a class="co" href="#callout_remote_webdriver_CO4-1" id="co_remote_webdriver_CO4-1"><img alt="1" src="assets/1.png"/></a>&#13;
INFO [LogManager$RootLogger.log] - Using the system default encoding&#13;
INFO [OpenTelemetryTracer.createTracer] - Using OpenTelemetry for tracing&#13;
INFO [BoundZmqEventBus.&lt;init&gt;] - XPUB binding to [binding to tcp://*:4442,&#13;
    advertising as tcp://192.168.56.1:4442], XSUB binding to [binding to&#13;
    tcp://*:4443, advertising as tcp://192.168.56.1:4443]&#13;
INFO [UnboundZmqEventBus.&lt;init&gt;] - Connecting to tcp://192.168.56.1:4442 and&#13;
    tcp://192.168.56.1:4443&#13;
INFO [UnboundZmqEventBus.&lt;init&gt;] - Sockets created&#13;
INFO [UnboundZmqEventBus.&lt;init&gt;] - Event bus ready&#13;
INFO [Hub.execute] - Started Selenium Hub 4.0.0 (revision 3a21814679):&#13;
    http://192.168.56.1:4444&#13;
INFO [Node.&lt;init&gt;] - Binding additional locator mechanisms: relative, name, id&#13;
INFO [LocalDistributor.add] - Added node 98c35075-e5f0-4168-be97-c277e4f40d8d&#13;
    at http://192.168.56.1:5555. Health check every 120s&#13;
INFO [GridModel.setAvailability] - Switching node 98c35075-e5f0-4168-be97-&#13;
    c277e4f40d8d (uri: http://192.168.56.1:5555) from DOWN to UP&#13;
&#13;
&#13;
C:\grid&gt;java -jar selenium-server-4.0.0.jar node <a class="co" href="#callout_remote_webdriver_CO4-2" id="co_remote_webdriver_CO4-2"><img alt="2" src="assets/2.png"/></a>&#13;
INFO [LogManager$RootLogger.log] - Using the system default encoding&#13;
INFO [OpenTelemetryTracer.createTracer] - Using OpenTelemetry for tracing&#13;
INFO [UnboundZmqEventBus.&lt;init&gt;] - Connecting to tcp://*:4442 and tcp://*:4443&#13;
INFO [UnboundZmqEventBus.&lt;init&gt;] - Sockets created&#13;
INFO [UnboundZmqEventBus.&lt;init&gt;] - Event bus ready&#13;
INFO [NodeServer.createHandlers] - Reporting self as: http://192.168.56.1:5555&#13;
INFO [NodeOptions.getSessionFactories] - Detected 8 available processors&#13;
INFO [NodeOptions.discoverDrivers] - Discovered 2 driver(s)&#13;
INFO [NodeOptions.report] - Adding Chrome for {"browserName": "chrome"} 8 times&#13;
INFO [NodeOptions.report] - Adding Firefox for {"browserName": "firefox"} 8&#13;
    times&#13;
INFO [Node.&lt;init&gt;] - Binding additional locator mechanisms: relative, name, id&#13;
INFO [NodeServer$1.start] - Starting registration process for node id&#13;
    98c35075-e5f0-4168-be97-c277e4f40d8d&#13;
INFO [NodeServer.execute] - Started Selenium node 4.0.0 (revision&#13;
    3a21814679): http://192.168.56.1:5555&#13;
INFO [NodeServer$1.lambda$start$1] - Sending registration event...&#13;
INFO [NodeServer.lambda$createHandlers$2] - Node has been added</pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO4-1" id="callout_remote_webdriver_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We start the hub. By default, this server listens to W3C WebDriver HTTP requests in port 4444 and TCP ports 4442 and 4443 for registering nodes.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO4-2" id="callout_remote_webdriver_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>In a second console, we <a data-primary="registration, node" data-type="indexterm" id="idm45849711656608"/>register the node(s). In this example, this command is executed in the same host as the hub. Moreover, it supposes that the required drivers (e.g., chromedriver and geckodriver) are already resolved (as in <a data-type="xref" href="#standalone_cli">Example 6-5</a>). To start nodes from another host, we would need to invoke the following command:</p></dd>&#13;
</dl>&#13;
&#13;
<pre data-type="programlisting">java -jar selenium-server-4.0.0.jar node --hub http://&lt;hub&gt;:4444</pre>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>In the same way as the standalone mode, you can <a data-primary="Java" data-secondary="Selenium Grid in" data-type="indexterm" id="idm45849711653152"/>start a hub-nodes grid using Java code. For that, you need to change the parameters to invoke the Selenium Grid main class following the same syntax of the CLI commands for hub and nodes.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Fully Distributed" data-type="sect2"><div class="sect2" id="idm45849711651792">&#13;
<h2>Fully Distributed</h2>&#13;
&#13;
<p>As of version 4, we can <a data-primary="Selenium 4 (version)" data-primary-sortas="Selenium four (version)" data-type="indexterm" id="idm45849711650304"/><a data-primary="distributed mode, Selenium Grid" data-type="indexterm" id="ch6_term29"/><a data-primary="fully distributed mode, Selenium Grid" data-type="indexterm" id="ch6_term30"/><a data-primary="Selenium Grid" data-secondary="fully distributed mode of" data-type="indexterm" id="ch6_term31"/>execute a Selenium Grid infrastructure following a fully distributed architecture. The <a data-primary="scalability of Selenium Grid" data-type="indexterm" id="idm45849711646000"/>decisive aspect of this approach is scalability. Specialized nodes take care of different automation and infrastructure management aspects in this mode. These nodes are:</p>&#13;
<dl>&#13;
<dt>Router</dt>&#13;
<dd>&#13;
<p>Node acting <a data-primary="Router node, Selenium Grid" data-type="indexterm" id="idm45849711643328"/>as a single entry point to the Grid. This component listens to W3C WebDriver commands from Selenium scripts.</p>&#13;
</dd>&#13;
<dt>Session Queue</dt>&#13;
<dd>&#13;
<p>Node that <a data-primary="Session Queue node, Selenium Grid" data-type="indexterm" id="idm45849711641088"/>stores the new session requests. These incoming sessions wait to be read by the <em>Distributor</em>.</p>&#13;
</dd>&#13;
<dt>Distributor</dt>&#13;
<dd>&#13;
<p>Node aware <a data-primary="Distributor node" data-type="indexterm" id="ch6_term32"/>of all nodes and their capabilities. It asks for new session requests to the <em>Session Queue</em> in regular intervals.</p>&#13;
</dd>&#13;
<dt>Event Bus</dt>&#13;
<dd>&#13;
<p>Component that <a data-primary="Event Bus node, Selenium Grid" data-type="indexterm" id="idm45849711635328"/>provides a message-oriented communication channel among several members of the Grid architecture. This communication is represented with dotted lines in Figures <a data-type="xref" data-xrefstyle="select:labelnumber" href="#selenium-grid-distributed-arch-node-reg">6-4</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="#selenium-grid-distributed-arch-new-session">6-5</a>.</p>&#13;
</dd>&#13;
<dt>Session Map</dt>&#13;
<dd>&#13;
<p>It keeps the <a data-primary="Session Map node, Selenium Grid" data-type="indexterm" id="idm45849711630512"/>relation of the WebDriver sessions and the nodes where the sessions are being executed.</p>&#13;
</dd>&#13;
<dt>Node(s)</dt>&#13;
<dd>&#13;
<p>Hosts that <a data-primary="Node(s), Selenium Grid" data-type="indexterm" id="idm45849711628352"/>provide web browsers (and their corresponding drivers) for automation based on Selenium WebDriver.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>In a hub-nodes architecture, the hub aggregates the responsibilities of the Router, Session Queue, Distributor, Event Bus, and Session Map of the fully distributed <a data-startref="ch6_term26" data-type="indexterm" id="idm45849711626464"/><a data-startref="ch6_term27" data-type="indexterm" id="idm45849711625760"/>mode.</p>&#13;
</div>&#13;
&#13;
<p>The following subsections provide details about the most relevant processes in a fully distributed Selenium Grid: node registration, new session, and other WebDriver commands.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Node registration" data-type="sect3"><div class="sect3" id="idm45849711624256">&#13;
<h3>Node registration</h3>&#13;
&#13;
<p>The first process <a data-primary="registration, node" data-type="indexterm" id="idm45849711622928"/>required to operate a distributed Selenium Grid is registering one or more nodes. To that aim, nodes need to register their capabilities in the Distributor. <a data-type="xref" href="#selenium-grid-distributed-arch-node-reg">Figure 6-4</a> illustrates this process, composed of three steps:</p>&#13;
<ol>&#13;
<li>&#13;
<p>A node sends a message through the <a data-primary="Event Bus node, Selenium Grid" data-type="indexterm" id="idm45849711619952"/>Event Bus to announce its capabilities.</p>&#13;
</li>&#13;
<li>&#13;
<p>This message reaches the Distributor, which stores the relationship between nodes and capabilities.</p>&#13;
</li>&#13;
<li>&#13;
<p>The Distributor double-checks that the node exists by exchanging HTTP messages (solid line) with the source node.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<figure><div class="figure" id="selenium-grid-distributed-arch-node-reg">&#13;
<img alt="hosw 0604" src="assets/hosw_0604.png"/>&#13;
<h6><span class="label">Figure 6-4. </span>Node registration in a Selenium Grid distributed architecture</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="New session" data-type="sect3"><div class="sect3" id="idm45849711614624">&#13;
<h3>New session</h3>&#13;
&#13;
<p>At some <a data-startref="ch6_term28" data-type="indexterm" id="idm45849711613296"/>point, a script (typically a test case) will try to start a new session to drive a browser automatically. <a data-type="xref" href="#selenium-grid-distributed-arch-new-session">Figure 6-5</a> describes the communication required to carry out this process in a fully distributed Selenium Grid, namely:</p>&#13;
<ol>&#13;
<li>&#13;
<p>A script/test using the Selenium WebDriver API sends a <a data-primary="Router node, Selenium Grid" data-type="indexterm" id="ch6_term33"/>request to the Router to create a new session (i.e., to drive a browser programmatically).</p>&#13;
</li>&#13;
<li>&#13;
<p>The Router creates a <a data-primary="Session Queue node, Selenium Grid" data-type="indexterm" id="idm45849711607840"/>new entry in the Session Queue to store this new session request.</p>&#13;
</li>&#13;
<li>&#13;
<p>The Distributor asks the Session Queue for incoming new session requests in intervals.</p>&#13;
</li>&#13;
<li>&#13;
<p>Once the Distributor discovers a new session request, it checks if a node can support this session. If the session is possible (i.e., a node previously registered in the Distributor offers the required capabilities), the Distributor creates a new session with the node.</p>&#13;
</li>&#13;
<li>&#13;
<p>The Distributor <a data-primary="Session Map node, Selenium Grid" data-type="indexterm" id="idm45849711604400"/>sends an HTTP message to the Session Map to store the new session. The Session Map stores a unique session identifier (<em>session id</em>) that univocally associates the node executing the browser session.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<figure><div class="figure" id="selenium-grid-distributed-arch-new-session">&#13;
<img alt="hosw 0605" src="assets/hosw_0605.png"/>&#13;
<h6><span class="label">Figure 6-5. </span>New session in a Selenium Grid distributed architecture</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="WebDriver commands" data-type="sect3"><div class="sect3" id="idm45849711600336">&#13;
<h3>WebDriver commands</h3>&#13;
&#13;
<p>Once the <a data-startref="ch6_term32" data-type="indexterm" id="idm45849711599008"/>session is established, the Selenium WebDriver API script will continue sending W3C WebDriver commands to control the web browser in the remote node. <a data-type="xref" href="#selenium-grid-distributed-arch-webdriver-commands">Figure 6-6</a> shows how this communication occurs in a distributed Selenium Grid infrastructure following these steps:</p>&#13;
<ol>&#13;
<li>&#13;
<p>The script/test exchanges W3C WebDriver commands to drive the browser (e.g., open a web page, interact with web elements, etc.) in the current session.</p>&#13;
</li>&#13;
<li>&#13;
<p>Further requests to the same browser session use the same session id. The Router recognizes that a browser session is active by reading the Session Map.</p>&#13;
</li>&#13;
<li>&#13;
<p>The Router forwards the subsequent commands of the same session directly to the assigned node.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<figure><div class="figure" id="selenium-grid-distributed-arch-webdriver-commands">&#13;
<img alt="hosw 0606" src="assets/hosw_0606.png"/>&#13;
<h6><span class="label">Figure 6-6. </span>WebDriver commands in a Selenium Grid distributed architecture</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Setting up a distributed grid" data-type="sect3"><div class="sect3" id="idm45849711591424">&#13;
<h3>Setting up a distributed grid</h3>&#13;
&#13;
<p>Like in the <a data-startref="ch6_term33" data-type="indexterm" id="idm45849711590048"/><a data-primary="shell, launching from" data-type="indexterm" id="ch6_term34"/>standalone and hub-nodes modes, we can use the Selenium Grid distribution (as a fat-JAR or regular Java dependency) to start the fully distributed architecture. <a data-type="xref" href="#fully_distributed_cli">Example 6-8</a> shows the shell command required to do this using the command line.</p>&#13;
<div data-type="example" id="fully_distributed_cli">&#13;
<h5><span class="label">Example 6-8. </span>Command to start Selenium Grid in distributed mode using the shell</h5>&#13;
&#13;
<pre data-type="programlisting">C:\grid&gt;java -jar selenium-server-4.0.0.jar event-bus <a class="co" href="#callout_remote_webdriver_CO5-1" id="co_remote_webdriver_CO5-1"><img alt="1" src="assets/1.png"/></a>&#13;
INFO [BoundZmqEventBus.&lt;init&gt;] - XPUB binding to [binding to tcp://*:4442,&#13;
    advertising as tcp://192.168.56.1:4442], XSUB binding to [binding to&#13;
    tcp://*:4443, advertising as tcp://192.168.56.1:4443]&#13;
...&#13;
&#13;
&#13;
C:\grid&gt;java -jar selenium-server-4.0.0.jar sessions <a class="co" href="#callout_remote_webdriver_CO5-2" id="co_remote_webdriver_CO5-2"><img alt="2" src="assets/2.png"/></a>&#13;
...&#13;
INFO [SessionMapServer.execute] - Started Selenium SessionMap 4.0.0 (revision&#13;
    5fe1af712f): http://192.168.56.1:5556&#13;
&#13;
C:\grid&gt;java -jar selenium-server-4.0.0.jar sessionqueue <a class="co" href="#callout_remote_webdriver_CO5-3" id="co_remote_webdriver_CO5-3"><img alt="3" src="assets/3.png"/></a>&#13;
...&#13;
INFO [NewSessionQueueServer.execute] - Started Selenium SessionQueue 4.0.0&#13;
    (revision 5fe1af712f): http://192.168.56.1:5559&#13;
&#13;
C:\grid&gt;java -jar selenium-server-4.0.0.jar distributor --sessions&#13;
    http://&lt;session_map&gt;:5556 --sessionqueue http://&lt;session_queue&gt;:5559 --bind-bus&#13;
    false <a class="co" href="#callout_remote_webdriver_CO5-4" id="co_remote_webdriver_CO5-4"><img alt="4" src="assets/4.png"/></a>&#13;
...&#13;
INFO [DistributorServer.execute] - Started Selenium Distributor 4.0.0 (revision&#13;
    5fe1af712f): http://192.168.56.1:5553&#13;
&#13;
C:\grid&gt;java -jar selenium-server-4.0.0.jar router --sessions&#13;
    http://&lt;session_map&gt;:5556 --distributor http://&lt;distributor_address&gt;:5553&#13;
    --sessionqueue http://&gt;session_queue&gt;:5559 <a class="co" href="#callout_remote_webdriver_CO5-5" id="co_remote_webdriver_CO5-5"><img alt="5" src="assets/5.png"/></a>&#13;
...&#13;
INFO [RouterServer.execute] - Started Selenium Router 4.0.0 (revision&#13;
    5fe1af712f): http://192.168.56.1:4444&#13;
&#13;
C:\grid&gt;java -jar selenium-server-4.0.0.jar node --publish-events&#13;
    tcp://&lt;event_bus&gt;:4442 --subscribe-events tcp://&lt;event_bus&gt;:4443 <a class="co" href="#callout_remote_webdriver_CO5-6" id="co_remote_webdriver_CO5-6"><img alt="6" src="assets/6.png"/></a>&#13;
...&#13;
INFO [NodeOptions.discoverDrivers] - Discovered 2 driver(s)&#13;
...&#13;
INFO [NodeServer$1.lambda$start$1] - Sending registration event...&#13;
INFO [NodeServer.lambda$createHandlers$2] - Node has been added</pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO5-1" id="callout_remote_webdriver_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We start the <a data-primary="Event Bus node, Selenium Grid" data-type="indexterm" id="idm45849711570544"/>Event Bus. By default, the Event Bus listens to TCP ports 4442 and 4443.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO5-2" id="callout_remote_webdriver_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We start the <a data-primary="Session Map node, Selenium Grid" data-type="indexterm" id="idm45849711567216"/>Session Map. By default, this component listens to incoming HTTP messages in port 5556.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO5-3" id="callout_remote_webdriver_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We start the <a data-primary="Session Queue node, Selenium Grid" data-type="indexterm" id="idm45849711563792"/>Session Queue. By default, this queue listens to HTTP in port 5559.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO5-4" id="callout_remote_webdriver_CO5-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We start the <a data-primary="Distributor node" data-type="indexterm" id="idm45849711560384"/>Distributor. For that, we need to specify the Session Map and Session Queue addresses. In addition, and since we already started the Event Bus independently, we set the flag <code>--bind-bus</code> to <code>false</code>. By default, the Distributor uses port 5553 for the HTTP communication.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO5-5" id="callout_remote_webdriver_CO5-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We start the <a data-primary="Router node, Selenium Grid" data-type="indexterm" id="idm45849711556112"/>Router. We need to specify the URLs of the Session Map, Session Queue, and Distributor.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO5-6" id="callout_remote_webdriver_CO5-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We start the <a data-primary="Node(s), Selenium Grid" data-type="indexterm" id="idm45849711552688"/>Nodes. We need to specify the ports where the Event Bus listens to publish-subscribe messages. Moreover, in this example, several drivers (chomedriver and geckodriver) are available in the same folder in which this command is <a data-startref="ch6_term29" data-type="indexterm" id="idm45849711551824"/><a data-startref="ch6_term30" data-type="indexterm" id="idm45849711551152"/><a data-startref="ch6_term31" data-type="indexterm" id="idm45849711550480"/><a data-startref="ch6_term34" data-type="indexterm" id="idm45849711549808"/>executed.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Observability" data-type="sect2"><div class="sect2" id="idm45849711548752">&#13;
<h2>Observability</h2>&#13;
&#13;
<p>In software <a data-primary="observability" data-type="indexterm" id="ch6_term35"/><a data-primary="Selenium Grid" data-secondary="observability of" data-type="indexterm" id="ch6_term36"/>engineering, <em>observability</em> is a measure that determines the current state of a software system based on its external outputs or signals. This way, observability allows understanding the internal state of the system by leveraging its external indicators. Observability can be critical for maintaining complex software systems and determining the root cause of any issue. To that aim, the three pillars of observability are:</p>&#13;
<dl>&#13;
<dt>Metrics</dt>&#13;
<dd>&#13;
<p>Measures of <a data-primary="metrics and observability" data-type="indexterm" id="idm45849711542816"/>system performance over time, such as response time, transactions per second, or memory usage, to name a few</p>&#13;
</dd>&#13;
<dt>Logs</dt>&#13;
<dd>&#13;
<p>Lines of <a data-primary="logs and observability" data-type="indexterm" id="idm45849711540576"/>text (typically timestamped) that a system produces when running a piece of code</p>&#13;
</dd>&#13;
<dt>Traces</dt>&#13;
<dd>&#13;
<p>Representation <a data-primary="traces and observability" data-type="indexterm" id="idm45849711538432"/>of causally related distributed events (such as selected logs) that characterize the request flow of a given operation in a software system</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Selenium Grid 4 provides different features for measuring observability. First, Selenium Grid allows tracing using the <a href="https://opentelemetry.io">OpenTelemetry</a> API. Second, Selenium Grid provides a GraphQL endpoint to run queries against the grid.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Tracing with OpenTelemetry" data-type="sect3"><div class="sect3" id="idm45849711535904">&#13;
<h3>Tracing with OpenTelemetry</h3>&#13;
&#13;
<p><em>Tracing</em> is an essential <a data-primary="tracing with OpenTelemetry" data-type="indexterm" id="ch6_term37"/><a data-primary="OpenTelemetry, tracing with" data-type="indexterm" id="ch6_term38"/><a data-primary="Jaeger tracing platform" data-type="indexterm" id="ch6_term39"/>way of measuring observability based on the logs and metrics of a software system. Selenium Grid exposes tracing in two ways. First, we can check the log traces when executing a grid from the shell. By default, the <a data-primary="INFO log level" data-type="indexterm" id="idm45849711530704"/>logs at the <code>INFO</code> level are displayed. We can <a data-primary="log-level argument" data-type="indexterm" id="idm45849711529488"/>change the level using the argument <code>--log-level</code> in the shell command, for instance:</p>&#13;
&#13;
<pre data-code-language="shell" data-type="programlisting">java -jar selenium-server-4.0.0.jar standalone --log-level FINE</pre>&#13;
&#13;
<p>Furthermore, <a data-primary="distributed tracing" data-type="indexterm" id="idm45849711506928"/>Selenium Grid supports <em>distributed tracing</em> via OpenTelemetry APIs. This feature allows tracing the commands flowing through a Selenium Grid infrastructure. Distributed tracing requires two activities in this order:</p>&#13;
<dl>&#13;
<dt>1. Code instrumentation</dt>&#13;
<dd>&#13;
<p>Selenium Grid <a data-primary="code instrumentation, Selenium Grid" data-type="indexterm" id="idm45849711523696"/>allows exporting tracing information using the OpenTelemetry API.</p>&#13;
</dd>&#13;
<dt>2. Data collection</dt>&#13;
<dd>&#13;
<p>For example, we <a data-primary="data collection, Selenium Grid" data-type="indexterm" id="idm45849711521680"/>can use <a href="https://www.jaegertracing.io">Jaeger</a>, an open source distributed tracing platform that provides seamless integration with OpenTelemetry. It allows querying, visualizing, and collecting tracing data.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p class="pagebreak-before">The following commands show how to set up Selenium Grid to export data to Jaeger. First, we need a Jaeger backend up and running. For that, we can download the executable binaries for the <a href="https://www.jaegertracing.io/download">Jaeger download page</a>. Alternatively, we can start the server using Docker, as follows:</p>&#13;
&#13;
<pre data-code-language="shell" data-type="programlisting"><code>docker</code><code> </code><code>run</code><code> </code><code>--rm</code><code> </code><code>-it</code><code> </code><code>--name</code><code> </code><code>jaeger</code><code> </code><code class="se">\&#13;
</code><code>  </code><code>-p</code><code> </code><code class="m">16686</code><code>:16686</code><code> </code><code class="se">\ </code><a class="co" href="#callout_remote_webdriver_CO6-1" id="co_remote_webdriver_CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
  </code><code>-p</code><code> </code><code class="m">14250</code><code>:14250</code><code> </code><code class="se">\ </code><a class="co" href="#callout_remote_webdriver_CO6-2" id="co_remote_webdriver_CO6-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
  </code><code>jaegertracing/all-in-one:1.27</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO6-1" id="callout_remote_webdriver_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We will use the URL <code>http://localhost:16686</code> to access the Jaeger UI.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO6-2" id="callout_remote_webdriver_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We will use the URL <code>http://localhost:14250</code> to collect the data (exported by Selenium Grid).</p></dd>&#13;
</dl>&#13;
&#13;
<p>Then, we start Selenium Grid as follows:</p>&#13;
&#13;
<pre data-code-language="shell" data-type="programlisting"><code>java</code><code> </code><code>-Dotel.traces.exporter</code><code class="o">=</code><code>jaeger</code><code> </code><code class="se">\&#13;
</code><code>  </code><code>-Dotel.exporter.jaeger.endpoint</code><code class="o">=</code><code>http://localhost:14250</code><code> </code><code class="se">\ </code><a class="co" href="#callout_remote_webdriver_CO7-1" id="co_remote_webdriver_CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
  </code><code>-Dotel.resource.attributes</code><code class="o">=</code><code>service.name</code><code class="o">=</code><code>selenium-standalone</code><code> </code><code class="se">\ </code><a class="co" href="#callout_remote_webdriver_CO7-2" id="co_remote_webdriver_CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
  </code><code>-jar</code><code> </code><code>selenium-server-4.0.0.jar</code><code> </code><code class="se">\&#13;
</code><code>  </code><code>--ext</code><code> </code><code class="k">$(</code><code>cs</code><code> </code><code>fetch</code><code> </code><code>-p</code><code> </code><code class="se">\ </code><a class="co" href="#callout_remote_webdriver_CO7-3" id="co_remote_webdriver_CO7-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
     </code><code>io.opentelemetry:opentelemetry-exporter-jaeger:1.6.0</code><code> </code><code class="se">\&#13;
</code><code>     </code><code>io.grpc:grpc-netty:1.41.0</code><code class="k">)</code><code> </code><code class="se">\&#13;
</code><code>  </code><code>standalone</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO7-1" id="callout_remote_webdriver_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use a Jaeger endpoint to export the tracing data.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO7-2" id="callout_remote_webdriver_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We specify the service name <code>selenium-standalone</code>. We will look for this name in the Jaeger UI to visualize the gathered data (see <a data-type="xref" href="#jaeger">Figure 6-7</a>).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO7-3" id="callout_remote_webdriver_CO7-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We use <a href="https://get-coursier.io">Coursier</a> to download and generate the classpath of two required <a data-startref="ch6_term37" data-type="indexterm" id="idm45849711375984"/><a data-startref="ch6_term38" data-type="indexterm" id="idm45849711375280"/><a data-startref="ch6_term39" data-type="indexterm" id="idm45849711374608"/>dependencies (<code>opentelemetry-exporter-jaeger</code> and <code>grpc-netty</code>).</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="jaeger">&#13;
<img alt="hosw 0607" src="assets/hosw_0607.png"/>&#13;
<h6><span class="label">Figure 6-7. </span>Jaeger UI showing the data gathered from Selenium Grid</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="GraphQL queries" data-type="sect3"><div class="sect3" id="idm45849711535280">&#13;
<h3>GraphQL queries</h3>&#13;
&#13;
<p><a href="https://graphql.org">GraphQL</a> is an open source <a data-primary="GraphQL queries" data-type="indexterm" id="idm45849711369312"/>data query and manipulation language for APIs. GraphQL defines a syntax to ask for data, generally from an online service. Selenium Grid 4 provides a GraphQL endpoint (<code>http://localhost:4444/graphql</code>). A simple way to make GraphQL queries to this endpoint is using <a href="https://curl.se">curl</a> from the shell. For example, and supposing that we have a Selenium Grid running in the localhost, we can send the following command to the GraphQL endpoint to get the maximum and the current number of sessions in the grid:</p>&#13;
&#13;
<pre data-code-language="shell" data-type="programlisting">curl -X POST -H <code class="s2">"Content-Type: application/json"</code> --data <code class="se">\</code>&#13;
    <code class="s1">'{"query": "{ grid {maxSession, sessionCount } }"}'</code> -s <code class="se">\</code>&#13;
    http://localhost:4444/graphql</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Configuration" data-type="sect2"><div class="sect2" id="idm45849711363040">&#13;
<h2>Configuration</h2>&#13;
&#13;
<p>You can find more details <a data-primary="configuration" data-secondary="for Selenium Grid" data-secondary-sortas="Selenium Grid" data-type="indexterm" id="idm45849711361904"/>about Selenium Grid in its official <a href="https://www.selenium.dev/documentation/grid">documentation</a>. For advanced configuration, there are two ways to <a data-primary="Selenium Grid" data-secondary="custom setup of" data-type="indexterm" id="idm45849711360064"/>specify a custom setup for Selenium Grid:</p>&#13;
<dl>&#13;
<dt>Using CLI options <a data-primary="Selenium Grid" data-secondary="CLI options for" data-type="indexterm" id="idm45849711358320"/>for the different aspects of Selenium Grid</dt>&#13;
<dd>&#13;
<p>Some examples of these options are <code>--port</code> to change the default port through which the Selenium Server listens (4444 by default), or <code>--session-timeout</code>, which is the timeout in which nodes are terminated when there is no activity (three hundred seconds by default).</p>&#13;
</dd>&#13;
<dt>Using <a href="https://toml.io">TOML</a> files</dt>&#13;
<dd>&#13;
<p>TOML (Tom’s Obvious Minimal Language) is a configuration <a data-primary="Selenium Grid" data-secondary="TOML files for" data-type="indexterm" id="idm45849711353376"/><a data-primary="TOML (Tom’s Obvious Minimal Language)" data-type="indexterm" id="idm45849711352400"/>format designed to be human-readable. Like the CLI options, these files allow configuring the Selenium Grid parameters but <a data-startref="ch6_term14" data-type="indexterm" id="idm45849711328752"/><a data-startref="ch6_term35" data-type="indexterm" id="idm45849711328144"/><a data-startref="ch6_term36" data-type="indexterm" id="idm45849711327536"/>using TOML notation.</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Cloud Providers" data-type="sect1"><div class="sect1" id="idm45849712034304">&#13;
<h1>Cloud Providers</h1>&#13;
&#13;
<p>As introduced in <a data-type="xref" href="ch01.html#ch01">Chapter 1</a>, a <em>cloud provider</em> in the <a data-primary="browsers" data-secondary="cloud provider support for" data-type="indexterm" id="ch6_term40"/><a data-primary="cloud providers" data-type="indexterm" id="ch6_term41"/><a data-primary="remote browsers" data-secondary="cloud providers for" data-type="indexterm" id="ch6_term42"/>Selenium ecosystem is a company that provides managed services (usually commercial) for automated web and mobile testing. Common services offered by cloud providers include:</p>&#13;
<dl>&#13;
<dt>Browsers <em>as a service</em></dt>&#13;
<dd>&#13;
<p>To request on-demand web browsers hosted by the providers. These browsers are usually of different types, versions, and operating systems. This feature is typically used for cross-browser automated or live testing.</p>&#13;
</dd>&#13;
<dt>Analysis capabilities</dt>&#13;
<dd>&#13;
<p>To monitor and debug automated tests. To that aim, cloud providers typically <a data-primary="recording of sessions" data-type="indexterm" id="idm45849711316752"/><a data-primary="session recordings" data-type="indexterm" id="idm45849711316048"/>support session recordings or rich error-reporting features.</p>&#13;
</dd>&#13;
<dt>Mobile testing</dt>&#13;
<dd>&#13;
<p>To request <a data-primary="mobile testing from cloud providers" data-type="indexterm" id="idm45849711313968"/>emulated (and real) mobile devices on different platforms, such as Android and iOS.</p>&#13;
</dd>&#13;
<dt>Visual testing</dt>&#13;
<dd>&#13;
<p>Automatically <a data-primary="visual testing from cloud providers" data-type="indexterm" id="idm45849711311856"/>inspect the UI and ensure that end users have a correct visual experience.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>Examples of current <a data-primary="Sauce Labs" data-type="indexterm" id="ch6_term43"/>cloud providers for Selenium are <a href="https://saucelabs.com">Sauce Labs</a>, <a href="https://www.browserstack.com">BrowserStack</a>, <a href="https://www.lambdatest.com">LambdaTest</a>, <a href="https://crossbrowsertesting.com">CrossBrowserTesting</a>, <a href="https://aerokube.com/moon-cloud">Moon Cloud</a>, <a href="https://testingbot.com">TestingBot</a>, <a href="https://www.perfecto.io">Perfecto</a>, or <a href="https://testinium.com">Testinium</a>. All these companies offer specific services with different pricing plans. Their common aspect is that each cloud provider maintains a Selenium Server endpoint that we can use in <code>RemoteWebDriver</code> tests. <a data-type="xref" href="#saucelabs_setup">Example 6-9</a> illustrates how to use one of them (concretely, Sauce Labs) to create a <code>WebDriver</code> object. You can find equivalent tests for other cloud providers (BrowserStack, LambdaTest, CrossBrowserTesting, Perfecto, and Testinium) in the <a href="https://github.com/bonigarcia/selenium-webdriver-java">examples repository</a>. These tests allow using remote browsers managed by the cloud providers.</p>&#13;
<div class="pagebreak-before less_space" data-type="example" id="saucelabs_setup">&#13;
<h5><span class="label">Example 6-9. </span>Test setup for using Sauce Labs</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">MalformedURLException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">username</code><code> </code><code class="o">=</code><code> </code><code class="n">System</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">"sauceLabsUsername"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO8-1" id="co_remote_webdriver_CO8-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">accessKey</code><code> </code><code class="o">=</code><code> </code><code class="n">System</code><code class="o">.</code><code class="na">getProperty</code><code class="o">(</code><code class="s">"sauceLabsAccessKey"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">username</code><code class="o">)</code><code class="o">.</code><code class="na">isNotEmpty</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO8-2" id="co_remote_webdriver_CO8-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">accessKey</code><code class="o">)</code><code class="o">.</code><code class="na">isNotEmpty</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">MutableCapabilities</code><code> </code><code class="n">capabilities</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">MutableCapabilities</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">capabilities</code><code class="o">.</code><code class="na">setCapability</code><code class="o">(</code><code class="s">"username"</code><code class="o">,</code><code> </code><code class="n">username</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO8-3" id="co_remote_webdriver_CO8-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">capabilities</code><code class="o">.</code><code class="na">setCapability</code><code class="o">(</code><code class="s">"access_key"</code><code class="o">,</code><code> </code><code class="n">accessKey</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">capabilities</code><code class="o">.</code><code class="na">setCapability</code><code class="o">(</code><code class="s">"name"</code><code class="o">,</code><code> </code><code class="s">"My SauceLabs test"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO8-4" id="co_remote_webdriver_CO8-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">capabilities</code><code class="o">.</code><code class="na">setCapability</code><code class="o">(</code><code class="s">"browserVersion"</code><code class="o">,</code><code> </code><code class="s">"latest"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO8-5" id="co_remote_webdriver_CO8-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setCapability</code><code class="o">(</code><code class="s">"sauce:options"</code><code class="o">,</code><code> </code><code class="n">capabilities</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO8-6" id="co_remote_webdriver_CO8-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>    </code><code class="n">URL</code><code> </code><code class="n">remoteUrl</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">URL</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://ondemand.eu-central-1.saucelabs.com:443/wd/hub"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO8-7" id="co_remote_webdriver_CO8-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">RemoteWebDriver</code><code class="o">(</code><code class="n">remoteUrl</code><code class="o">,</code><code> </code><code class="n">options</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO8-8" id="co_remote_webdriver_CO8-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO8-1" id="callout_remote_webdriver_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>To use Sauce Labs, we need a valid account. In other words, we <a data-primary="credentials, authentication" data-type="indexterm" id="idm45849711117872"/><a data-primary="authentication, approaches to" data-type="indexterm" id="idm45849711117200"/>need credentials in the form of a username and access key. To avoid hardcoding these credentials in our test logic, I use Java system properties in this test. These properties can be informed in the execution command (e.g., <code>mvn test -DsauceLabsUsername​=myname -DsauceLabsAccessKey=mykey</code>). An alternative way to specify this data is using environment variables (e.g., <code>String username = Sys⁠tem.getenv​("SAU⁠CE​LABS_USERNAME");</code>).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO8-2" id="callout_remote_webdriver_CO8-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We skip this test (using assumptions) when the username or the key is <span class="keep-together">unavailable</span>.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO8-3" id="callout_remote_webdriver_CO8-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We need to include the username and the key as Selenium capabilities.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO8-4" id="callout_remote_webdriver_CO8-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We can specify a custom label to identify this test in the Sauce Labs dashboard (see <a data-type="xref" href="#saucelabs">Figure 6-8</a>).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO8-5" id="callout_remote_webdriver_CO8-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We use the latest version of a given browser (Chrome, as specified in the following line).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO8-6" id="callout_remote_webdriver_CO8-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We use a custom label called <code>sauce:options</code> to select the required capabilities in the Sauce Labs cloud.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO8-7" id="callout_remote_webdriver_CO8-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>We use the Sauce Labs public endpoint as a remote URL. Sauce Labs provides endpoints in different regions. In this example, I use the EU Central data center. Other possibilities are <a href="https://ondemand.us-west-1.saucelabs.com/wd/hub">US West</a>, <a href="https://ondemand.us-east-1.saucelabs.com/wd/hub">US East</a>, or <a href="https://ondemand.apac-southeast-1.saucelabs.com">Asia-Pacific Southeast</a>.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO8-8" id="callout_remote_webdriver_CO8-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>We use both the URL and the capabilities to create an <a data-startref="ch6_term40" data-type="indexterm" id="idm45849711050432"/><a data-startref="ch6_term41" data-type="indexterm" id="idm45849711049728"/><a data-startref="ch6_term42" data-type="indexterm" id="idm45849711049056"/><a data-startref="ch6_term43" data-type="indexterm" id="idm45849711048384"/>instance of <code>RemoteWebDriver</code>.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="saucelabs">&#13;
<img alt="hosw 0608" src="assets/hosw_0608.png"/>&#13;
<h6><span class="label">Figure 6-8. </span>Sauce Labs dashboard showing an automated test result</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Browsers in Docker Containers" data-type="sect1"><div class="sect1" id="browsers-in-docker">&#13;
<h1>Browsers in Docker Containers</h1>&#13;
&#13;
<p><a href="https://www.docker.com">Docker</a> is an open source <a data-primary="Docker containers" data-secondary="for browser infrastructure support" data-secondary-sortas="browser infrastructure support" data-type="indexterm" id="ch6_term49"/><a data-primary="remote browsers" data-secondary="Docker containers for" data-type="indexterm" id="ch6_term50"/>platform that allows creating, deploying, and running applications as lightweight, portable containers. The Docker platform is made up of two main components:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a href="https://docs.docker.com/engine">Docker Engine</a>, an application <a data-primary="Docker containers" data-secondary="Docker Engine in" data-type="indexterm" id="idm45849711038368"/>that allows creating and running containers in a host. Docker Engine is a client-server application composed of three elements:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A server implemented as a daemon process (<code>dockerd</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>A REST API used by application clients to instruct the daemon</p>&#13;
</li>&#13;
<li>&#13;
<p>A CLI tool (the <code>docker</code> command)</p>&#13;
</li>&#13;
</ul>&#13;
</li>&#13;
<li>&#13;
<p><a href="https://hub.docker.com">Docker Hub</a>, a cloud service <a data-primary="Docker containers" data-secondary="Docker Hub in" data-type="indexterm" id="idm45849711031808"/>for distributing containers.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In Selenium, Docker can be a relevant technology to support the browser infrastructure required for automated tests based on Selenium WebDriver. The following subsections explain the alternatives for executing browsers in Docker containers.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Docker Images for Selenium Grid" data-type="sect2"><div class="sect2" id="idm45849711029904">&#13;
<h2>Docker Images for Selenium Grid</h2>&#13;
&#13;
<p>An official subproject of the <a data-primary="Docker containers" data-secondary="and images for remote browsers" data-secondary-sortas="images for remote browsers" data-type="indexterm" id="ch6_term46"/><a data-primary="Docker containers" data-secondary="and docker-selenium" data-secondary-sortas="docker-selenium" data-type="indexterm" id="ch6_term47"/><a data-primary="Selenium Grid" data-secondary="Docker images in" data-type="indexterm" id="ch6_term48"/>Selenium suite is <a href="https://github.com/SeleniumHQ/docker-selenium">docker-selenium</a>. This project maintains Docker images for the different Selenium Grid components (i.e., standalone, hub, nodes, router, distributor, session queue, etc.) and web browsers (Chrome, Firefox, and Edge). These Docker images are open source and released on <a href="https://hub.docker.com/u/selenium">Docker Hub</a>. A simple way to use these images is to start them using the shell (with the <code>docker</code> command) and use an <a data-primary="dockerized browsers" data-type="indexterm" id="idm45849711021648"/>instance of <code>RemoteWebDriver</code> to drive <em>dockerized</em> browsers. The following subsections explain how.</p>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The commands and tests presented in this section suppose Docker is available in your system. In other words, you need to have installed a Docker Engine in your machine to execute these examples properly.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Standalone" data-type="sect3"><div class="sect3" id="idm45849711018784">&#13;
<h3>Standalone</h3>&#13;
&#13;
<p>We can find Selenium images <a data-primary="standalone mode, Selenium Grid" data-type="indexterm" id="idm45849711017280"/><a data-primary="Selenium Grid" data-secondary="standalone mode of" data-type="indexterm" id="idm45849711016560"/>for standalone browsers (Chrome, Firefox, and Edge) in Docker Hub. The following <a data-primary="Chrome" data-secondary="launching in Docker" data-type="indexterm" id="idm45849711015488"/><a data-primary="shell, launching from" data-type="indexterm" id="ch6_term44"/><a data-primary="Docker containers" data-secondary="launching" data-type="indexterm" id="ch6_term45"/>command shows how to start Chrome in Docker using the shell.</p>&#13;
&#13;
<pre data-type="programlisting">docker run -d -p 4444:4444 --shm-size="2g" selenium/standalone-chrome:latest</pre>&#13;
&#13;
<p>This command starts the Docker image <code>selenium/standalone-chrome:latest</code>, i.e., the latest version of Chrome available in Docker Hub. Alternatively, we can use a fixed Chrome version (e.g., <code>selenium/standalone-chrome:94.0</code>). The Docker container is started in detached mode (using the <code>-d</code> flag) using a shared memory of 2 GB (<code>--shm-size="2g"</code>). This figure is a value known to work well, although you can change it depending on your resources or specific needs. Finally, the internal container port <code>4444</code> is mapped to the same port of the host where the command is executed (<code>-p 4444:4444</code>). We can then use the following Java command to instantiate a <code>WebDriver</code> object that uses this dockerized Chrome:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">WebDriver</code> <code class="n">driver</code> <code class="o">=</code> <code class="k">new</code> <code class="n">RemoteWebDriver</code><code class="o">(</code><code class="s">"http://localhost:4444/"</code><code class="o">,</code>&#13;
        <code class="k">new</code> <code class="nf">ChromeOptions</code><code class="o">());</code></pre>&#13;
&#13;
<p class="pagebreak-before">Moreover, when using Selenium Grid, we can use Docker containers for registering nodes. The following command shows how to start a Selenium Grid in standalone mode using a node with Firefox in Docker:</p>&#13;
&#13;
<pre data-type="programlisting">java -jar selenium-server-4.0.0.jar node -D selenium/standalone-firefox:latest&#13;
        '{"browserName": “firefox"}'</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Hub-nodes" data-type="sect3"><div class="sect3" id="idm45849710998784">&#13;
<h3>Hub-nodes</h3>&#13;
&#13;
<p>We can easily <a data-primary="hub-nodes mode, Selenium Grid" data-type="indexterm" id="idm45849710997520"/><a data-primary="Selenium Grid" data-secondary="hub-nodes mode of" data-type="indexterm" id="idm45849710996816"/>start Selenium Grid in the hub-nodes mode using the official Selenium Docker images. The following commands show how to do it in the shell.</p>&#13;
&#13;
<pre data-type="programlisting">docker network create grid <a class="co" href="#callout_remote_webdriver_CO9-1" id="co_remote_webdriver_CO9-1"><img alt="1" src="assets/1.png"/></a>&#13;
&#13;
docker run -d -p 4442-4444:4442-4444 --net grid \&#13;
    --name selenium-hub selenium/hub:4.0.0 <a class="co" href="#callout_remote_webdriver_CO9-2" id="co_remote_webdriver_CO9-2"><img alt="2" src="assets/2.png"/></a>&#13;
&#13;
docker run -d --net grid -e SE_EVENT_BUS_HOST=selenium-hub --shm-size="2g" \&#13;
    -e SE_EVENT_BUS_PUBLISH_PORT=4442  -e SE_EVENT_BUS_SUBSCRIBE_PORT=4443 \&#13;
    selenium/node-chrome:4.0.0 <a class="co" href="#callout_remote_webdriver_CO9-3" id="co_remote_webdriver_CO9-3"><img alt="3" src="assets/3.png"/></a>&#13;
&#13;
docker network rm grid <a class="co" href="#callout_remote_webdriver_CO9-4" id="co_remote_webdriver_CO9-4"><img alt="4" src="assets/4.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO9-1" id="callout_remote_webdriver_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>First, we create a Docker network called <code>grid</code>. This network allows communication between hub and node(s) using their hostnames (e.g., <code>selenium-hub</code>).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO9-2" id="callout_remote_webdriver_CO9-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We start the <a data-primary="Hub (Selenium Server)" data-type="indexterm" id="idm45849710953920"/><a data-primary="Selenium Grid" data-secondary="Hub (Selenium Server) of" data-type="indexterm" id="idm45849710953184"/><a data-primary="Selenium Server (Hub)" data-type="indexterm" id="idm45849710952224"/>Selenium Hub. We need to map ports 4444 (for the Selenium Server URL) and 4442-4443 (for registering nodes).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO9-3" id="callout_remote_webdriver_CO9-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We register nodes. In this command, we use Chrome (<code>selenium/node-chrome</code>). Other browsers can be registered in the hub using other Docker images (e.g., <code>selenium/node-firefox</code> or <code>selenium/node-edge</code>).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO9-4" id="callout_remote_webdriver_CO9-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>If not required anymore, we can remove the <code>grid</code> network at <a data-startref="ch6_term44" data-type="indexterm" id="idm45849710944640"/><a data-startref="ch6_term45" data-type="indexterm" id="idm45849710943904"/>the end.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Further features" data-type="sect3"><div class="sect3" id="idm45849710942848">&#13;
<h3>Further features</h3>&#13;
&#13;
<p>The project <code>docker-selenium</code> provides a wide variety of features. I recommend you take a look at its <a href="https://github.com/SeleniumHQ/docker-selenium">README</a> for more details. Here is a summary of these features:</p>&#13;
<dl>&#13;
<dt>Docker Compose scripts</dt>&#13;
<dd>&#13;
<p>These scripts <a data-primary="compose scripts, docker-selenium" data-type="indexterm" id="idm45849710938528"/>allow starting Selenium Grid hub-nodes and the fully distributed mode effortlessly.</p>&#13;
</dd>&#13;
<dt>Video recording</dt>&#13;
<dd>&#13;
<p>We can <a data-primary="video recording, docker-selenium" data-type="indexterm" id="idm45849710936416"/>record the desktop session of the browsers in the nodes using another Docker container.</p>&#13;
</dd>&#13;
<dt>Dynamic grid</dt>&#13;
<dd>&#13;
<p>This allows <a data-primary="dynamic grid, docker-selenium" data-type="indexterm" id="idm45849710934256"/>us to start Docker containers on demand.</p>&#13;
</dd>&#13;
<dt>Deploying to Kubernetes</dt>&#13;
<dd>&#13;
<p><a href="https://kubernetes.io">Kubernetes</a> is an open source container-orchestration <a data-primary="Kubernetes, docker-selenium and" data-type="indexterm" id="idm45849710931408"/>system that automates the deployment and management of containerized applications. We can use Kubernetes to deploy the Selenium Docker containers.</p>&#13;
</dd>&#13;
<dt>Advanced container configuration</dt>&#13;
<dd>&#13;
<p>This can be <a data-primary="configuration" data-secondary="for Selenium Grid" data-secondary-sortas="Selenium Grid" data-type="indexterm" id="idm45849710929152"/>used, for instance, to specify Selenium or Java custom configuration.</p>&#13;
</dd>&#13;
<dt>Access to the remote session</dt>&#13;
<dd>&#13;
<p>This can be <a data-primary="remote session access, docker-selenium" data-type="indexterm" id="idm45849710926448"/><a data-primary="Virtual Network Computing (VNC)" data-type="indexterm" id="idm45849710925648"/>achieved using Virtual Network Computing (VNC) (a graphical desktop sharing system) and <a href="https://novnc.com">noVNC</a> (an open source web-based <a data-startref="ch6_term46" data-type="indexterm" id="idm45849710924064"/><a data-startref="ch6_term47" data-type="indexterm" id="idm45849710923360"/><a data-startref="ch6_term48" data-type="indexterm" id="idm45849710922688"/>VNC client).</p>&#13;
</dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Selenoid" data-type="sect2"><div class="sect2" id="idm45849710921632">&#13;
<h2>Selenoid</h2>&#13;
&#13;
<p><a href="https://aerokube.com/selenoid">Selenoid</a> is an open source Golang implementation of a <a data-primary="Hub (Selenium Server)" data-type="indexterm" id="idm45849710919552"/><a data-primary="Docker containers" data-secondary="Selenoid with" data-type="indexterm" id="ch6_term51"/><a data-primary="Selenoid" data-type="indexterm" id="ch6_term52"/>Selenium Hub. Selenoid can be seen as a lightweight Selenium Server that provides a browser infrastructure based on Docker. The Selenoid team also maintains the Docker images used by Selenoid. These images include multiple web browsers and Android devices, such as Chrome, Firefox, Edge, Opera, Safari (WebKit engine), or Chrome Mobile.</p>&#13;
&#13;
<p>There are different ways to use Selenoid and its Docker images. A straightforward way is to <a data-primary="configuration" data-secondary="Selenoid manager for" data-type="indexterm" id="idm45849710916064"/>use the configuration manager (a binary called <code>cm</code>) provided by the project. The following snippet shows how to start Selenoid and its UI (a web-based dashboard to monitor Selenoid):</p>&#13;
&#13;
<pre data-type="programlisting">./cm selenoid start <a class="co" href="#callout_remote_webdriver_CO10-1" id="co_remote_webdriver_CO10-1"><img alt="1" src="assets/1.png"/></a>&#13;
./cm selenoid-ui start <a class="co" href="#callout_remote_webdriver_CO10-2" id="co_remote_webdriver_CO10-2"><img alt="2" src="assets/2.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO10-1" id="callout_remote_webdriver_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We start Selenoid. The configuration manager downloads the Docker image for Selenoid and the two latest versions of several browsers (Chrome, Firefox, and Opera). Once it is started, Selenoid listens to Selenium WebDriver requests in the URL <code>http://localhost:4444/wd/hub</code>.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO10-2" id="callout_remote_webdriver_CO10-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Optionally, we can <a data-primary="UI, Selenoid" data-type="indexterm" id="idm45849710904016"/><a data-primary="Selenoid UI" data-type="indexterm" id="idm45849710903280"/>start the Selenoid UI. This UI is a web application accessible in the URL <code>http://localhost:8080/</code>. <a data-type="xref" href="#selenoid-ui">Figure 6-9</a> shows a screenshot of this UI during the execution of a Selenium WebDriver test. <a data-type="xref" href="#selenoid_test_setup">Example 6-10</a> shows the setup of a test that uses a Chrome browser served by Selenoid.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="selenoid-ui">&#13;
<img alt="hosw 0609" src="assets/hosw_0609.png"/>&#13;
<h6><span class="label">Figure 6-9. </span>Selenoid UI during a test execution using VNC</h6>&#13;
</div></figure>&#13;
<div data-type="example" id="selenoid_test_setup">&#13;
<h5><span class="label">Example 6-10. </span>Instantiation of a RemoteWebDriver object using the constructor</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">MalformedURLException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">URL</code><code> </code><code class="n">seleniumServerUrl</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">URL</code><code class="o">(</code><code class="s">"http://localhost:4444/wd/hub"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">isOnline</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isTrue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">selenoidOptions</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">selenoidOptions</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"enableVNC"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO11-1" id="co_remote_webdriver_CO11-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setCapability</code><code class="o">(</code><code class="s">"selenoid:options"</code><code class="o">,</code><code> </code><code class="n">selenoidOptions</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO11-2" id="co_remote_webdriver_CO11-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">RemoteWebDriver</code><code class="o">(</code><code class="n">seleniumServerUrl</code><code class="o">,</code><code> </code><code class="n">options</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO11-1" id="callout_remote_webdriver_CO11-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The <a data-primary="enableVNC capability" data-type="indexterm" id="idm45849710802032"/><a data-primary="Virtual Network Computing (VNC)" data-type="indexterm" id="idm45849710801296"/><a data-primary="dockerized browsers" data-type="indexterm" id="idm45849710800608"/>capability <code>enableVNC</code> is Selenoid-specific and allows us to start the dockerized browser with VNC support (this way, we can visualize the browser session in the Selenoid UI, as illustrated in <a data-type="xref" href="#selenoid-ui">Figure 6-9</a>).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO11-2" id="callout_remote_webdriver_CO11-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Since this capability is vendor-specific, the W3C WebDriver-compatible way to set this capability is using a custom namespace (<code>selenoid:options</code> in this case).</p></dd>&#13;
</dl>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Further features" data-type="sect3"><div class="sect3" id="idm45849710795408">&#13;
<h3>Further features</h3>&#13;
&#13;
<p>Selenoid provides different features and configuration capabilities. You can check its <a href="https://aerokube.com/selenoid/latest">documentation</a> for more details. These features include video recording, custom configuration, log management, or access to browser developer tools, to <a data-startref="ch6_term51" data-type="indexterm" id="idm45849710749712"/><a data-startref="ch6_term52" data-type="indexterm" id="idm45849710749008"/>name a few.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="WebDriverManager" data-type="sect2"><div class="sect2" id="idm45849710747952">&#13;
<h2>WebDriverManager</h2>&#13;
&#13;
<p>As of version 5, WebDriverManager <a data-primary="browserInDocker() method" data-type="indexterm" id="idm45849710746448"/><a data-primary="create() method" data-type="indexterm" id="idm45849710745424"/><a data-primary="Docker containers" data-secondary="and images for remote browsers" data-secondary-sortas="images for remote browsers" data-type="indexterm" id="idm45849710744752"/><a data-primary="Docker containers" data-secondary="WebDriverManager with" data-type="indexterm" id="ch6_term53"/><a data-primary="WebDriverManager" data-secondary="with Docker for remote browsers" data-secondary-sortas="Docker for remote browsers" data-type="indexterm" id="ch6_term54"/>allows the effortless use of web browsers in Docker containers. To that aim, each manager (e.g., <code>chromedriver()</code>, <code>firefoxdriver()</code>, etc.) provides the method <code>browserInDocker()</code>. WebDriverManager internally pulls the Docker images and runs the container, creating a <code>RemoteWebDriver</code> instance when invoking the method <code>create()</code>. WebDriverManager uses the Docker images maintained by the Selenoid team. This way, you can <a data-primary="Chrome" data-secondary="RemoteWebDriver tests with" data-type="indexterm" id="idm45849710738176"/>use Chrome (desktop and mobile), Firefox, Edge, Opera, and Safari as Docker containers out of the box through WebDriverManager. <a data-type="xref" href="#wdm_chrome">Example 6-11</a> illustrates a basic test using this feature.</p>&#13;
<div data-type="example" id="wdm_chrome">&#13;
<h5><span class="label">Example 6-11. </span>Complete test using WebDriverManager and Chrome in Docker</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">DockerChromeJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriverManager</code><code> </code><code class="n">wdm</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">browserInDocker</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO12-1" id="co_remote_webdriver_CO12-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setupTest</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">isDockerAvailable</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isTrue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO12-2" id="co_remote_webdriver_CO12-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">wdm</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO12-3" id="co_remote_webdriver_CO12-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">wdm</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO12-4" id="co_remote_webdriver_CO12-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testDockerChrome</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO12-1" id="callout_remote_webdriver_CO12-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We get an instance of the <a data-primary="chromedriver" data-type="indexterm" id="idm45849710600064"/><a data-primary="Chrome" data-secondary="WebDriver instantiation with" data-type="indexterm" id="idm45849710622928"/>manager for Chrome (<code>chromedriver()</code>). Then, using the WebDriverManager fluent API, we specify that the future <code>WebDriver</code> objects created with this instance (called <code>wmd</code>) will use Docker to execute the corresponding browser (Chrome, in this case).</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO12-2" id="callout_remote_webdriver_CO12-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We assume a <a data-primary="Docker containers" data-secondary="Docker Engine in" data-type="indexterm" id="idm45849710618112"/>Docker engine is available in the machine running this test. For that, we <a data-primary="AssertJ assertions" data-type="indexterm" id="idm45849710616976"/><a data-primary="isDockerAvailable() method" data-type="indexterm" id="idm45849710616304"/>create an AssertJ assumption by invoking the static method <code>isDocker​A⁠vailable</code> on WebDriverManager. This way, when Docker is not available, the test is skipped.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO12-3" id="callout_remote_webdriver_CO12-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>In the test setup, we <a data-primary="RemoteWebDriver class" data-secondary="object creation in" data-type="indexterm" id="idm45849710563472"/><a data-primary="remote browsers" data-secondary="creation of RemoteWebDriver objects for" data-type="indexterm" id="idm45849710562464"/>create the <code>WebDriver</code> instance. Internally, WebDriverManager will connect to Docker Hub to discover the latest version of Chrome available as a Docker image. This image is pulled to the local machine, the Docker container is executed, and the corresponding <code>RemoteWebDriver</code> instance is returned to the test logic.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO12-4" id="callout_remote_webdriver_CO12-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>WebDriverManager allows <a data-primary="quit() method" data-type="indexterm" id="idm45849710557648"/><a data-primary="driver.quit() method" data-type="indexterm" id="idm45849710556944"/>quitting the previously created <code>WebDriver</code> instances through the method <code>quit()</code>. This method has the same effect of directly quitting the instance (<code>driver.quit()</code> in this case), and the used Docker containers are gracefully terminated.</p></dd>&#13;
</dl>&#13;
&#13;
<p>WebDriverManager <a data-primary="fluent APIs" data-type="indexterm" id="idm45849710554448"/><a data-primary="dockerized browsers" data-type="indexterm" id="ch6_term55"/>provides a fluent API to configure different aspects of the dockerized web browsers. The following snippet shows several possibilities. As usual, you can find the complete tests using these features in the <a href="https://github.com/bonigarcia/selenium-webdriver-java">examples repository for this book</a>.</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">WebDriverManager</code><code> </code><code class="n">wdm</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">browserInDocker</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO13-1" id="co_remote_webdriver_CO13-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">WebDriverManager</code><code> </code><code class="n">wdm</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">browserInDocker</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>        </code><code class="o">.</code><code class="na">browserVersion</code><code class="o">(</code><code class="s">"beta"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO13-2" id="co_remote_webdriver_CO13-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">WebDriverManager</code><code> </code><code class="n">wdm</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">browserInDocker</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>        </code><code class="o">.</code><code class="na">enableVnc</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO13-3" id="co_remote_webdriver_CO13-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="n">WebDriverManager</code><code> </code><code class="n">wdm</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">browserInDocker</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>        </code><code class="o">.</code><code class="na">enableRecording</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_remote_webdriver_CO13-4" id="co_remote_webdriver_CO13-4"><img alt="4" src="assets/4.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO13-1" id="callout_remote_webdriver_CO13-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We select a <a data-primary="Firefox" data-secondary="RemoteWebDriver examples with" data-type="indexterm" id="idm45849710474608"/><a data-primary="browsers" data-secondary="WebDriverManager and versions of" data-type="indexterm" id="idm45849710473584"/><a data-primary="versions of browsers and drivers, compatibility of" data-type="indexterm" id="idm45849710472624"/>given manager to use the corresponding dockerized browser (Firefox in this case). In addition to Chrome and Firefox, the other alternatives are Edge, Opera, Safari, and Chrome Mobile.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO13-2" id="callout_remote_webdriver_CO13-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>By default, WebDriverManager uses the latest version available in Docker Hub for the dockerized browser. Nevertheless, we can force the use of a given version (e.g., <code>94.0</code>). Moreover, different wildcards are valid for specifying the following versions, namely:</p>&#13;
<dl>&#13;
<dt><code>latest</code></dt>&#13;
<dd>&#13;
<p>To use the latest version (default option).</p>&#13;
</dd>&#13;
<dt><code>latest-N</code></dt>&#13;
<dd>&#13;
<p>To use a previous version to the stable release. For example, if we specify <code>latest-1</code> (i.e., latest version minus one), the former version to the stable release is used.</p>&#13;
</dd>&#13;
<dt><code>beta</code></dt>&#13;
<dd>&#13;
<p>To use the beta <a data-primary="beta versions, browser" data-type="indexterm" id="idm45849710420864"/><a data-primary="Firefox" data-secondary="version selection with" data-type="indexterm" id="idm45849710420128"/><a data-primary="Chrome" data-secondary="version selection with" data-type="indexterm" id="idm45849710419184"/>version. This version is only available for Chrome and Firefox, using a fork of the Aerokube Docker images for these browsers maintained by <a href="https://hub.docker.com/r/twilio/selenoid">Twilio</a>.</p>&#13;
</dd>&#13;
<dt><code>dev</code></dt>&#13;
<dd>&#13;
<p>To use the <a data-primary="development (dev) version of browser" data-type="indexterm" id="idm45849710415696"/>development version (again, for Chrome and Firefox).</p>&#13;
</dd>&#13;
</dl></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO13-3" id="callout_remote_webdriver_CO13-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Connect to the remote desktop session <a data-primary="VNC/noVNC with remote sessions" data-type="indexterm" id="idm45849710412272"/><a data-primary="Virtual Network Computing (VNC)" data-type="indexterm" id="idm45849710411504"/><a data-primary="wdm.getDockerNoVncUrl() method" data-type="indexterm" id="idm45849710410816"/>using VNC or noVNC. By default, WebDriverManager prints the noVNC URL in the log traces. In addition, this URL is accessible by invoking the method <code>wdm.getDockerNoVncUrl()</code>. <a data-type="xref" href="#wdm-novnc">Figure 6-10</a> shows a web browser that allows watching and interacting with a remote session with noVNC.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO13-4" id="callout_remote_webdriver_CO13-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>To enable the <a data-primary="recording of sessions" data-type="indexterm" id="idm45849710406032"/><a data-primary="session recordings" data-type="indexterm" id="idm45849710405296"/>session recording. At the end of the test, you can find the recording (in MP4 format) in the project root folder.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="wdm-novnc">&#13;
<img alt="hosw 0610" src="assets/hosw_0610.png"/>&#13;
<h6><span class="label">Figure 6-10. </span>Remote desktop using noVNC of a dockerized browser started with  <span class="keep-together">WebDriverManager</span></h6>&#13;
</div></figure>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Further features" data-type="sect3"><div class="sect3" id="idm45849710401776">&#13;
<h3>Further features</h3>&#13;
&#13;
<p>As explained in its <a href="https://bonigarcia.dev/webdrivermanager">documentation</a>, you can configure WebDriverManager in multiple ways. For instance, you can specify fine-grained aspects of dockerized browsers, such as the time zone, network, shared memory, volumes, environment variables, screen resolution, or recording output, among others. In addition, <a data-primary="Hub (Selenium Server)" data-type="indexterm" id="idm45849710399280"/><a data-primary="Selenium Server (Hub)" data-type="indexterm" id="idm45849710398544"/><a data-primary="Selenium Grid" data-secondary="Hub (Selenium Server) of" data-type="indexterm" id="idm45849710397872"/><a data-primary="WebDriverManager" data-secondary="as server" data-secondary-sortas="server" data-type="indexterm" id="idm45849710396960"/>WebDriverManager can be used as a Selenium Server. This server uses the container images pulled from Docker Hub to support the browser <a data-startref="ch6_term53" data-type="indexterm" id="idm45849710395616"/><a data-startref="ch6_term54" data-type="indexterm" id="idm45849710394944"/><a data-startref="ch6_term55" data-type="indexterm" id="idm45849710394272"/>infrastructure.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Selenium-Jupiter" data-type="sect2"><div class="sect2" id="idm45849710393344">&#13;
<h2>Selenium-Jupiter</h2>&#13;
&#13;
<p>Selenium-Jupiter internally uses <a data-primary="Chrome" data-secondary="RemoteWebDriver tests with" data-type="indexterm" id="ch6_term56"/><a data-primary="Docker containers" data-secondary="Selenium-Jupiter with" data-type="indexterm" id="ch6_term57"/><a data-primary="Selenium-Jupiter" data-secondary="with Docker containers" data-secondary-sortas="Docker containers" data-type="indexterm" id="ch6_term58"/><a data-primary="Selenium-Jupiter" data-secondary="with remote browsers" data-secondary-sortas="remote browsers" data-type="indexterm" id="ch6_term59"/><a data-primary="Selenium-Jupiter" data-secondary="WebDriverManager and" data-type="indexterm" id="ch6_term60"/><a data-primary="WebDriverManager" data-secondary="Selenium-Jupiter and" data-type="indexterm" id="ch6_term61"/>WebDriverManager to manage and handle web browsers in Docker containers. For dockerized browsers, <a data-primary="@DockerBrowser annotation" data-primary-sortas="DockerBrowser annotation" data-type="indexterm" id="idm45849710383536"/>Selenium-Jupiter provides the annotation <code>@DockerBrowser</code>. You can use this annotation with <code>WebDriver</code> or <span class="keep-together"><code>RemoteWebDriver</code></span> parameters in test methods. <a data-type="xref" href="#seljup_chrome">Example 6-12</a> demonstrates this feature. In this example, we use Chrome in Docker.</p>&#13;
<div data-type="example" id="seljup_chrome">&#13;
<h5><span class="label">Example 6-12. </span>Complete test using Selenium-Jupiter and Chrome in Docker</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@EnabledIfDockerAvailable</code><code> </code><a class="co" href="#callout_remote_webdriver_CO14-1" id="co_remote_webdriver_CO14-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code class="nd">@ExtendWith</code><code class="o">(</code><code class="n">SeleniumJupiter</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code>&#13;
</code><code class="kd">class</code><code> </code><code class="nc">DockerChromeSelJupTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testDockerChrome</code><code class="o">(</code><code class="nd">@DockerBrowser</code><code class="o">(</code><code class="n">type</code><code> </code><code class="o">=</code><code> </code><code class="n">CHROME</code><code class="o">)</code><code> </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO14-1" id="callout_remote_webdriver_CO14-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We decorate the test <a data-primary="@EnabledIfDockerAvailable" data-primary-sortas="EnabledIfDockerAvailable" data-type="indexterm" id="idm45849710324512"/>class with the Selenium-Jupiter annotation <code>@EnabledIf​Dock⁠erAvailable</code>. This annotation disables the test when Docker is not installed in the machine running the test.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The annotation <code>@DockerBrowser</code> allows setting different aspects and features. The following snippet illustrates some of them.</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@DockerBrowser</code><code class="o">(</code><code class="n">type</code><code> </code><code class="o">=</code><code> </code><code class="n">FIREFOX</code><code class="o">)</code><code> </code><a class="co" href="#callout_remote_webdriver_CO15-1" id="co_remote_webdriver_CO15-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="nd">@DockerBrowser</code><code class="o">(</code><code class="n">type</code><code> </code><code class="o">=</code><code> </code><code class="n">CHROME</code><code class="o">,</code><code> </code><code class="n">version</code><code> </code><code class="o">=</code><code> </code><code class="s">"beta"</code><code class="o">)</code><code> </code><a class="co" href="#callout_remote_webdriver_CO15-2" id="co_remote_webdriver_CO15-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="nd">@DockerBrowser</code><code class="o">(</code><code class="n">type</code><code> </code><code class="o">=</code><code> </code><code class="n">CHROME</code><code class="o">,</code><code> </code><code class="n">vnc</code><code> </code><code class="o">=</code><code> </code><code class="kc">true</code><code class="o">)</code><code> </code><a class="co" href="#callout_remote_webdriver_CO15-3" id="co_remote_webdriver_CO15-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="nd">@DockerBrowser</code><code class="o">(</code><code class="n">type</code><code> </code><code class="o">=</code><code> </code><code class="n">CHROME</code><code class="o">,</code><code> </code><code class="n">recording</code><code> </code><code class="o">=</code><code> </code><code class="kc">true</code><code class="o">)</code><code> </code><a class="co" href="#callout_remote_webdriver_CO15-4" id="co_remote_webdriver_CO15-4"><img alt="4" src="assets/4.png"/></a></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_remote_webdriver_CO15-1" id="callout_remote_webdriver_CO15-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We can change the browser using the <code>type</code> attribute. The accepted values are <code>CHROME</code>, <code>FIREFOX</code>, <code>OPERA</code>, <code>EDGE</code>, <code>SAFARI</code>, and <code>CHROME_MOBILE</code>.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO15-2" id="callout_remote_webdriver_CO15-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We can change the <a data-primary="browsers" data-secondary="WebDriverManager and versions of" data-type="indexterm" id="idm45849710229680"/><a data-primary="versions of browsers and drivers, compatibility of" data-type="indexterm" id="idm45849710228320"/>browser version using the attribute <code>version</code>. Like WebDriverManager, Selenium-Jupiter allows specifying a fixed version value (e.g., <code>94.0</code>) and using the <a data-primary="beta versions, browser" data-type="indexterm" id="idm45849710190960"/><a data-primary="development (dev) version of browser" data-type="indexterm" id="idm45849710190224"/><a data-primary="Chrome" data-secondary="version selection with" data-type="indexterm" id="idm45849710189536"/><a data-primary="Firefox" data-secondary="version selection with" data-type="indexterm" id="idm45849710188592"/>wildcards <code>latest</code> and <code>latest-N</code>, as well as <code>beta</code> and <code>dev</code> for Chrome and Firefox.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO15-3" id="callout_remote_webdriver_CO15-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We enable <a data-primary="VNC/noVNC with remote sessions" data-type="indexterm" id="idm45849710183552"/><a data-primary="Virtual Network Computing (VNC)" data-type="indexterm" id="idm45849710182800"/>access to the remote desktop session through VNC and noVNC using the attribute <code>vnc</code>.</p></dd>&#13;
<dt><a class="co" href="#co_remote_webdriver_CO15-4" id="callout_remote_webdriver_CO15-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We enable the <a data-primary="recording of sessions" data-type="indexterm" id="idm45849710179088"/><a data-primary="session recordings" data-type="indexterm" id="idm45849710178352"/>session recording with the <code>recording</code> attribute.</p></dd>&#13;
</dl>&#13;
&#13;
<p>You can find more details, examples, and configuration <a data-startref="ch6_term49" data-type="indexterm" id="idm45849710176560"/><a data-startref="ch6_term50" data-type="indexterm" id="idm45849710175856"/><a data-startref="ch6_term56" data-type="indexterm" id="idm45849710175152"/><a data-startref="ch6_term57" data-type="indexterm" id="idm45849710174480"/><a data-startref="ch6_term58" data-type="indexterm" id="idm45849710173808"/><a data-startref="ch6_term59" data-type="indexterm" id="idm45849710173136"/><a data-startref="ch6_term60" data-type="indexterm" id="idm45849710172464"/><a data-startref="ch6_term61" data-type="indexterm" id="idm45849710171792"/>capabilities of Selenium-Jupiter in its <a href="https://bonigarcia.dev/selenium-jupiter">documentation</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary and Outlook" data-type="sect1"><div class="sect1" id="idm45849710170368">&#13;
<h1>Summary and Outlook</h1>&#13;
&#13;
<p>Selenium WebDriver allows <a data-primary="Selenium WebDriver API" data-secondary="with remote browsers" data-secondary-sortas="remote browsers" data-type="indexterm" id="idm45849710169040"/>controlling remote web browsers. This feature is feasible because the underlying communication protocol (W3C WebDriver) is based on JSON messages over HTTP. This way, the components of the Selenium WebDriver architecture (Selenium Server, nodes, or client script) can be distributed (i.e., executed in different hosts). To use this <a data-primary="Java" data-secondary="and creation of instances" data-secondary-sortas="creation of instances" data-type="indexterm" id="idm45849710167664"/>feature in Java, we need to create an instance of <code>RemoteWebDriver</code>, typically passing two arguments: the Selenium Server URL and the required capabilities. We can start a Selenium Server infrastructure using Selenium Grid (in standalone, hub-nodes, or fully distributed mode). Alternatively, we can use the managed services provided by a cloud provider (such as Sauce Labs, BrowserStack,&#13;
LambdaTest, or CrossBrowserTesting, among others). Finally, we can use Docker to support a containerized infrastructure of web browsers.</p>&#13;
&#13;
<p>This chapter concludes the second part of the book, in which you have discovered the main features of the Selenium WebDriver API. The next part of the book covers different aspects of developing end-to-end tests using the Selenium WebDriver API, starting with the Page Object Model (POM), a widely used design pattern for enhancing test maintenance and reducing code duplication in Selenium WebDriver.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>