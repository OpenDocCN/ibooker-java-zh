# 第一章 介绍 Java 环境

欢迎来到 2023 年的 Java 世界。

你可能是从另一个传统来到 Java 世界，或者这可能是你第一次接触计算机编程。无论你是以何种方式来到这里，欢迎——我们很高兴你来了。

Java 是一个功能强大的通用编程环境。它是世界上使用最广泛的编程环境之一，在商业和企业计算方面取得了非常成功的成就超过 25 年。

在本章中，我们将通过描述 Java *语言*（程序员编写应用程序的语言）、Java *执行环境*（称为“Java 虚拟机”，实际运行这些应用程序的环境）和 Java *生态系统*（为开发团队提供编程环境价值的大部分内容）来揭开序幕。

这三个概念（语言、执行环境和生态系统）通常被简称为“Java”，具体用法取决于上下文。实际上，它们是如此紧密相关的想法，以至于这并不像一开始看起来那么令人困惑。

我们将简要介绍 Java 语言和虚拟机的历史，然后讨论 Java 程序的生命周期，最后解答一些关于 Java 和其他环境的常见问题。

# 语言、JVM 和生态系统

Java 编程环境自上世纪 90 年代末就存在了。它由 Java 语言和支持的运行时环境 Java 虚拟机（JVM）组成。第三个要素——超出 Java 标准库的 Java 生态系统——由第三方提供，例如开源项目和 Java 技术供应商。

在 Java 最初开发的时候，这种分离被认为是一种新颖的方式，但是在接下来的几年里，软件开发的趋势使它变得更加普遍。值得注意的是，微软的.NET 环境在 Java 之后几年宣布采用了非常类似的平台架构。

微软的.NET 平台和 Java 之间的一个重要区别是，Java 始终被构想为一个相对开放的多供应商生态系统，尽管由一个拥有该技术的管理者领导。在 Java 的历史中，这些供应商在 Java 技术的各个方面既合作又竞争。

Java 成功的主要原因之一是这个生态系统是一个标准化环境。这意味着组成环境的技术有规范。这些标准使开发者和用户确信，即使这些技术来自不同的技术供应商，它们也将与其他组件兼容。

Java 目前的管理者是 Oracle Corporation（收购了 Java 的发起者 Sun Microsystems）。其他公司，如 Red Hat、IBM、Amazon、Microsoft、AliBaba、SAP、Azul Systems 和 Bellsoft，也参与生产标准化 Java 技术的实现。

###### 提示

从 Java 7 开始，Java 的参考实现是开源的 OpenJDK（Java 开发工具包），许多公司在此基础上进行合作并发布他们的产品。

Java 最初由几个不同但相关的环境和规范组成，如 Java Mobile Edition（Java ME），^(1) Java Standard Edition（Java SE）和 Java Enterprise Edition（Java EE）。^(2) 在本书中，我们将只涵盖 Java SE 17，并附带某些历史注解，相关内容涉及某些功能何时引入到该平台中。一般而言，如果没有进一步的澄清，人们提到“Java”，通常指的是 Java SE。

我们稍后将详细讨论标准化问题，因此让我们继续讨论 Java 语言和 JVM 作为分开但相关的概念。

## Java 语言是什么？

Java 程序以 Java 语言的源代码形式编写。这是一种人类可读的编程语言，严格基于类并面向对象。语法设计有意模仿 C 和 C++，明确旨在让那些从这些语言转来的程序员感到熟悉，这两种语言在 Java 创建时期非常主导。

###### 注意

尽管源代码类似于 C++，但在实践中，Java 包括与 Smalltalk 等动态语言更多相似的特性和受控运行时。

Java 被认为相对易于阅读和编写（尽管有时有些啰嗦）。它具有严格的语法和简单的程序结构，旨在易于学习和教学。它建立在 C++等语言的行业经验之上，并尝试删除复杂的特性，同时保留了先前编程语言中有效的部分。

Java 语言由 Java 语言规范（JLS）管理，定义了符合实现的行为。

总体而言，Java 旨在为公司开发关键业务应用提供稳定、坚实的基础。作为一种编程语言，它设计相对保守，变化缓慢。这些特性是有意为之，旨在保护组织在 Java 技术上的投资。

自 1996 年创立以来，语言经历了逐步修订（但没有完全重写）。这意味着 Java 一些最初的设计选择，虽然在 90 年代末是权宜之计，但至今仍在影响着语言的发展—详见第二章和第三章了解更多细节。

另一方面，在过去的 10 多年中，Java 在语法上有所现代化，以解决啰嗦性和提供更为熟悉的功能，以吸引来自其他流行语言的程序员。

例如，在 2014 年，Java 8 增加了近十年来语言中看到的最激进的变化。 像 Lambda 表达式和引入 Streams API 等功能非常受欢迎，并永久改变了 Java 开发人员编写代码的方式。

正如我们将在本章后面讨论的那样，Java 项目已经过渡到了一个新的发布模型。 在这个新模型中，Java 版本每 6 个月发布一次，但只有特定版本（8、11 和 17）被认为是 LTS 合格的。 所有其他版本仅支持 6 个月，未被开发团队广泛采纳。

## 什么是 JVM？

JVM 是一个提供 Java 程序运行环境所必需的程序。 如果没有适合我们希望在其上执行的硬件和操作系统平台的 JVM，则 Java 程序无法运行。

幸运的是，JVM 已被移植到许多硬件环境中——从机顶盒或蓝光播放器到大型主机，几乎都可以为其提供 JVM。 JVM 有其自己的规范，即 Java 虚拟机规范，每个实现都必须符合该规范的规则。 当新的硬件类型进入主流市场时，可能会有公司或个人对该硬件感兴趣，从而启动一个项目来将 OpenJDK 移植到新的芯片上。 最近的一个例子是新的 Apple M1 芯片——Red Hat 将 JVM 移植到 AArch64 架构，然后微软对构建所需的 Apple 硅进行了移植更改。

Java 程序可以通过多种方式启动，但最简单（也是最早的）方法是从命令行启动：

```java
java <*`arguments`*> <*`program` `name`*>

```

JVM 作为操作系统进程启动，提供 Java 运行环境，然后在全新启动（空）虚拟机的背景下执行我们的程序。

需要理解的是，当 JVM 接收 Java 程序进行执行时，程序不是以 Java 语言源代码的形式提供的。 相反，Java 语言源代码必须编译成称为 Java 字节码的形式。 Java 字节码以 class 文件的形式提供给 JVM（其扩展名始终为*.class*）。 Java 平台一直强调向后兼容性，编写 Java 1.0 的代码仍然可以在今天的 JVM 上运行，无需修改或重新编译。

JVM 为程序提供了*执行环境*。 它启动了一个字节码形式程序的解释器，逐条执行字节码指令。 然而，生产质量的 JVM 还提供了一个特殊的编译器，在 Java 程序运行时运行。 这个编译器（称为“JIT”或即时编译器）通过用等效的编译（和高度优化的）机器代码替换重要部分来加速程序的执行。

你还应该知道，JVM 和用户程序都能够生成额外的执行线程，因此用户程序可以同时运行许多不同的函数。

JVM 的原始设计基于对较早编程环境（特别是 C 和 C++）多年的经验，因此我们可以将其视为具有几个不同目标——全部旨在为程序员简化生活：

+   构成应用代码运行的标准执行环境

+   促进安全可靠的代码执行（与 C/C++ 相比）

+   将低级内存管理从开发者手中拿走

+   提供跨平台执行环境

这些目标经常在平台讨论中一起提到。

当我们讨论 JVM 及其字节码解释器时，已经提到了这些目标的第一个——它作为应用代码的容器。

当我们讨论 Java 环境如何处理内存管理时，我们将在第六章中讨论第二个和第三个目标。

第四个目标，有时被称为“一次编写，到处运行”（WORA），是 Java 类文件可以从一个执行平台移动到另一个，只要有 JVM 可用，它们就会运行不变。

这意味着可以在运行 macOS 上的 M1 芯片的机器上开发 Java 程序（并转换为类文件），然后将类文件移动到 Linux 或 Microsoft Windows 上的 Intel 硬件（或其他平台），Java 程序将无需进一步工作即可运行。

###### 注意

Java 环境已经广泛移植，包括到与主流平台如 Linux、macOS 和 Windows 非常不同的平台。在本书中，我们使用术语“大多数实现”来表示大多数开发者可能会遇到的平台；macOS、Windows、Linux、BSD Unix 等都被视为“主流平台”并且在“大多数实现”中计数。

除了这四个主要目标之外，JVM 设计的另一个方面经常未被认可或讨论——它使用运行时信息进行自管理。

20 世纪 70 年代和 80 年代的软件研究揭示了程序的运行时行为有许多有趣和有用的模式，这些模式在编译时无法推断出。JVM 是第一个真正主流的编程环境，使用了这些研究结果。

它收集运行时信息以做出更好的代码执行决策。这意味着 JVM 能够监控并优化在其上运行的程序，这是其他平台无法实现的。

一个关键例子是运行时事实，即 Java 程序的各个部分在程序生命周期内被调用的可能性并不相等——某些部分远远比其他部分频繁调用。Java 平台利用这一事实的技术称为即时（JIT）编译。

在 HotSpot JVM（这是 Sun 在 Java 1.3 中首次发布的 JVM，并且至今仍在使用中），JVM 首先识别程序中调用最频繁的部分——“热方法”。然后，JVM 将这些热方法直接编译成机器代码，绕过 JVM 解释器。

JVM 利用可用的运行时信息提供比纯解释执行更高的性能。事实上，在许多情况下，JVM 现在使用的优化技术产生的性能甚至超过了编译的 C 和 C++代码。

描述 JVM 必须如何正常运行的标准称为 JVM 规范。

## 什么是 Java 生态系统？

与其他编程语言相比，Java 语言易于学习且包含相对较少的抽象。JVM 为 Java（或其他语言）提供了坚实、可移植、高性能的执行基础。总之，这两个相关技术为企业在选择其开发努力的基础时提供了可信赖的基础。

然而，Java 的好处并不仅限于此。自 Java 诞生以来，第三方库和组件的极其庞大生态系统已经形成。这意味着开发团队可以从几乎每种可想象的技术中获益，包括专有和开源的连接器和驱动程序。

在现代技术生态系统中，现在几乎找不到*不*提供 Java 连接器的技术组件。从传统关系数据库到 NoSQL，再到各种企业监控系统，消息系统，到物联网（IoT）——一切都与 Java 集成。

正是这一事实成为企业和大公司采用 Java 技术的主要驱动因素之一。开发团队能够通过利用现有的库和组件释放其潜力。这促进了开发者的选择，并鼓励基于 Java 技术核心的开放式、最佳的架构。

###### 注意

谷歌的 Android 环境有时被认为是“基于 Java 的”。然而，事实情况要复杂得多。Android 代码是用 Java（或 Kotlin 语言）编写的，但最初使用了 Java 类库的不同实现以及一个交叉编译器，将其转换为非 Java 虚拟机的不同文件格式。

丰富的生态系统与一流的虚拟机结合，并具有程序二进制的开放标准，使得 Java 平台成为一个非常吸引人的执行目标。实际上，有许多非 Java 语言针对 JVM 并与 Java 进行互操作（使它们可以依附于平台的成功）。这些语言包括 Kotlin、JRuby、Scala、Clojure 等。虽然它们与 Java 相比都很小，但它们在 Java 世界内有着明确的市场定位，并为 Java 提供了创新和健康竞争的源泉。

## Java 程序的生命周期

要更好地理解 Java 代码是如何编译和执行的，以及 Java 与其他类型的编程环境之间的区别，请考虑 图 1-1 中的流水线。

![JN7 0101](img/jns8_0101.png)

###### 图 1-1\. Java 代码是如何编译和加载的

这从 Java 源代码开始，通过 `javac` 程序生成包含已编译为 Java 字节码的源代码的类文件。类文件是平台处理的最小功能单元，也是将新代码导入运行程序的唯一方式。

新的类文件通过类加载机制（详见 第十章 了解更多有关类加载工作原理的细节）上载。这使得新代码（表示为类型）可供解释器执行，并且执行从 `main()` 方法开始。

Java 程序的性能分析和优化是一个重要话题，有兴趣的读者应参考专业文本，如 [*优化 Java*](http://shop.oreilly.com/product/0636920121718.do)（O’Reilly）。

## 常见问题

在本节中，我们将讨论关于 Java 和 Java 环境中编写的程序生命周期的一些最常见问题。

### 什么是虚拟机？

当开发人员首次接触虚拟机的概念时，他们有时会将其视为“计算机中的计算机”或“在软件中模拟的计算机”。然后很容易将字节码想象为“内部计算机的 CPU 的机器码”或“虚拟处理器的机器码”。然而，这种简单的直觉可能会误导。

### 什么是字节码？

实际上，JVM 字节码与真正运行在硬件处理器上的机器码并不十分相似。相反，计算机科学家会将字节码称为一种 *中间表示* 类型，介于源代码和机器码之间。

### javac 是编译器吗？

编译器通常会生成机器码，但 `javac` 生成的是字节码，与机器码并不十分相似。然而，类文件有点像对象文件（如 Windows 的 *.dll* 文件或 Unix 的 *.so* 文件），它们肯定不是人类可读的。

从理论计算机科学的角度来看，`javac`最类似于编译器的*前半部分*——它创建了中间表示，随后可以用于生成（发射）机器代码。

然而，由于类文件的创建是一个单独的构建时间步骤，类似于 C/C++中的编译，许多开发人员认为运行`javac`是编译。在本书中，我们将使用术语“源代码编译器”或“`javac`编译器”来表示`javac`生成类文件的过程。

我们将保留“编译”作为一个独立的术语，指的是 JIT 编译——因为正是 JIT 编译实际上生成了机器代码。

### 为什么称为“字节码”？

指令代码（操作码）只是一个字节（有些操作还有随后的参数跟在字节流中），因此只有 256 个可能的指令。实际上，有些是未使用的——大约有 200 个在使用中，但某些最近版本的`javac`并没有发出它们。

### 字节码是否经过优化？

在平台早期阶段，`javac`生成了经过大量优化的字节码。这被证明是一个错误。

随着 JIT 编译的出现，重要的方法将被编译成非常快速的机器代码。因此，让 JIT 编译器的工作更容易非常重要——因为与优化字节码相比，JIT 编译可以带来更大的性能提升，而优化字节码仍然必须被解释。

### 字节码真的是机器无关的吗？诸如字节序之类的因素呢？

无论字节码是在何种类型的机器上创建的，其格式始终相同。这包括机器的字节顺序（有时称为“字节序”）。对于对细节感兴趣的读者，字节码始终是大端序的。

### Java 是一种解释性语言吗？

JVM 基本上是一个解释器（通过 JIT 编译来大幅提升性能）。然而，大多数解释性语言直接从源代码形式解释程序（通常通过从输入源文件构造抽象语法树来实现）。另一方面，JVM 解释器需要类文件——当然，这需要使用`javac`进行单独的源代码编译步骤。

实际上，许多传统上是解释性的语言（如 PHP、Ruby 和 Python）的现代版本现在也具有 JIT 编译器，因此“解释性”和“编译性”语言之间的界限越来越模糊。再次验证了 Java 在其他编程环境中采用的设计决策的有效性。

### 其他语言可以在 JVM 上运行吗？

是的。JVM 可以运行任何有效的类文件，这意味着非 Java 语言可以通过多种方式在 JVM 上运行。首先，它们可以有一个类似于`javac`的源代码编译器，生成类文件，这些类文件可以像 Java 代码一样在 JVM 上运行（这是 Kotlin 和 Scala 等语言采用的方法）。

或者，一种非 Java 语言可以在 Java 中实现解释器和运行时，然后直接解释其语言的源形式。这种第二种选择是像 JRuby 这样的语言采取的方法（但在某些情况下 JRuby 具有非常复杂的运行时，能够进行*二次 JIT 编译*）。

# 将 Java 与其他语言进行比较

在本节中，我们将简要介绍 Java 平台与您可能熟悉的其他编程环境之间的一些区别。

## Java 与 JavaScript 比较

+   Java 是静态类型的；JavaScript 是动态类型的。

+   Java 使用基于类的对象；JavaScript 是基于原型的（JS 关键字 `class` 是语法糖）。

+   Java 提供了良好的对象封装；JavaScript 则没有。

+   Java 有命名空间；JavaScript 没有。

+   Java 是多线程的；JavaScript 不是。

## Java 与 Python 比较

+   Java 是静态类型的；Python 是动态类型的（具有可选的、*逐渐*类型）。

+   Java 是一种带有函数式编程（FP）特性的面向对象语言；Python 是一种混合面向对象/过程化语言，具有一些 FP 支持。

+   Java 和 Python 都有字节码格式—Java 使用 JVM 类文件；Python 使用 Python 字节码。

+   Java 的字节码具有广泛的静态检查；Python 的字节码则没有。

+   Java 是多线程的；Python 一次只允许一个线程执行 Python 字节码（全局解释器锁）。

## Java 与 C 比较

+   Java 是面向对象的；C 是过程化的。

+   Java 作为类文件是可移植的；C 需要重新编译。

+   Java 作为运行时的一部分提供了广泛的仪器设备。

+   Java 没有指针，也没有指针算术的等价物。

+   Java 通过垃圾收集实现了自动内存管理。

+   Java 当前无法在低级别上布局内存（没有结构体）。

+   Java 没有预处理器。

## Java 与 C++ 比较

+   Java 的对象模型与 C++ 相比较简化。

+   Java 的方法分派默认是虚拟的。

+   Java 总是传值调用（但 Java 值的唯一可能性之一是对象引用）。

+   Java 不支持完全多继承。

+   Java 的泛型比 C++ 模板弱大（但也更安全）。

+   Java 没有操作符重载。

# 对 Java 的一些批评进行回答

Java 在公众眼中有着悠久的历史，因此多年来吸引了很多批评。这些负面报道的一部分可以归因于一些技术上的缺陷，再加上在 Java 的最初版本中过度热衷的营销。

尽管一些批评已经进入技术传说，但实际上已经不再很准确。在本节中，我们将看一下一些常见的抱怨以及它们对于现代版本的平台来说是否属实。

## 过于冗长

Java 核心语言有时被批评为过于冗长。甚至简单的 Java 语句如 `Object o = new Object();` 似乎是重复的——类型 `Object` 在赋值语句的左右两侧都出现。批评者指出这基本上是多余的，其他语言不需要这种类型信息的重复，并且许多语言支持可以移除它的特性（例如类型推断）。

这一论点的反驳是，Java 从一开始就被设计成易于阅读（代码读取次数多于编写次数），许多程序员，特别是新手，在阅读代码时发现额外的类型信息非常有帮助。

Java 广泛应用于企业环境中，这些环境通常有单独的开发和运维团队。当你响应故障调用时，或者需要维护和修补已经由长时间离开的开发人员编写的代码时，额外的冗长通常是一种福音。

在最近的 Java 版本中，语言设计者试图通过找到语法可以变得更简洁的地方，并更好地利用类型信息来响应其中一些观点。例如：

```java
// Files helper methods
byte[] contents =
  Files.readAllBytes(Paths.get("/home/ben/myFile.bin"));

// Diamond syntax for repeated type information
List<String> l = new ArrayList<>();

// Local variables can be type inferred
var threadPool = Executors.newScheduledThreadPool(2);

// Lambda expressions simplify Runnables
threadPool.submit(() -> { System.out.println("On Threadpool"); });
```

然而，Java 的总体哲学是非常缓慢和谨慎地修改语言，因此这些变化的步伐可能无法完全满足批评者的要求。

## 缓慢的变化

原始的 Java 语言现在已经超过 20 年历史，这段时间内没有进行完整的修订。许多其他语言（例如微软的 C#）在同一时期内发布了不兼容的版本，一些开发人员批评 Java 没有做同样的事情。

此外，近年来，Java 语言因为缓慢采纳现在其他语言普遍采用的语言特性而受到批评。

Sun（现在是 Oracle）采取的语言设计保守方法是为了避免在非常庞大的用户群体中强加错误特性的成本和外部性。许多 Java 开发团队对该技术进行了重大投资，语言设计者严肃地对待不干扰现有用户和安装基础的责任。

每个新的语言特性都需要非常谨慎地考虑——不仅是独立存在的，还要考虑它将如何与语言的所有现有特性相互作用。新特性有时会在其直接范围之外产生影响——而 Java 被广泛应用于非常庞大的代码库中，这里有更多潜在的地方可能出现意外的相互作用。

一旦推出后发现有错误的特性几乎不可能移除。Java 有一些误功能（如序列化机制），几乎无法安全地移除而不影响已安装基础。语言设计者认为，在演化语言时需要极度谨慎。

尽管如此，近期版本中引入的新语言特性显著地解决了最常见的功能缺失问题，它们应该涵盖开发人员一直在寻求的许多编程习惯。

## 性能问题

尽管 Java 平台有时被批评运行速度慢，但在所有批评中，这可能是最不合理的一个。这是对该平台的一个真正的误解。

Java 1.3 发布引入了 HotSpot 虚拟机及其 JIT 编译器。自那时以来，虚拟机及其性能已经持续创新和改进超过 15 年。如今，Java 平台运行速度极快，在流行框架的性能基准测试中经常获胜，甚至超越了本地编译的 C 和 C++。

在这一领域的批评似乎主要是由一个传统观念引起的，即 Java 在过去某个时刻运行缓慢。Java 应用于的一些较大、较复杂的架构也可能加深了这种印象。

事实是，任何一个大型架构都需要基准测试、分析和性能调优，以达到最佳状态——Java 也不例外。

平台的核心部分——语言和 JVM——过去和现在仍然是开发者可用的最快速的通用环境之一。

## 不安全

一些人历史上批评过 Java 在安全漏洞方面的记录。

许多这些漏洞涉及 Java 系统的桌面和 GUI 组件，并不会影响使用 Java 编写的网站或其他服务器端代码。

事实是，Java 从一开始就以安全性为设计核心；这使得它比许多其他现有的系统和平台具有明显优势。Java 安全架构是由安全专家设计的，并自平台成立以来得到了许多其他安全专家的研究和检验。普遍的共识是，该架构本身坚固可靠，设计上没有任何安全漏洞（至少目前没有被发现的）。

安全模型设计的核心是，字节码在表达能力上受到严格限制——例如，无法直接访问内存。这一设计消除了像 C 和 C++语言中存在的大量安全问题。此外，每当加载一个不受信任的类时，虚拟机会进行称为*字节码验证*的过程，进一步消除了另一大类问题（详见第十章了解更多关于字节码验证的内容）。

然而，尽管如此，没有任何系统可以保证 100%的安全性，Java 也不例外。

虽然设计在理论上仍然健壮，但安全架构的实现又是另一回事，Java 的特定实现中存在着漫长的安全漏洞历史。很可能会在 Java VM 的实现中继续发现（并修补）安全漏洞。

所有编程平台都可能存在安全问题，许多其他语言也有着相当数量的安全漏洞历史，只不过这些漏洞的公开程度要低得多。就实际的服务器端编码而言，Java 或许是目前可用的最安全的通用平台，特别是在保持最新补丁的情况下。

## 过于企业化

Java 是一个被企业开发者广泛使用的平台。因此，人们认为它过于企业化并不奇怪 —— Java 经常被认为缺乏更加面向社区的“自由发挥”风格的语言。

事实上，Java 一直都是一个非常广泛使用的语言，用于社区和免费或开源软件开发。它是 GitHub 和其他项目托管站点上托管的项目中最受欢迎的语言之一。不仅如此，Java 社区经常被认为是生态系统的真正优势之一 —— 具有用户组、会议、期刊等一切活跃和健康用户社区的最显著迹象。

最广泛使用的语言实现是基于 OpenJDK —— OpenJDK 本身是一个具有充满活力和增长的社区的开源项目。

# Java 和 JVM 的简史

Java 1.0 (1996)

这是 Java 的第一个公开版本。它仅包含 212 个类，组织在八个包中。

Java 1.1 (1997)

这个版本的 Java 将 Java 平台的规模增加了一倍以上。这个版本引入了“内部类”和第一个版本的反射 API。

Java 1.2 (1998)

这是 Java 的一个非常重要的版本发布；它将 Java 平台的规模扩大了三倍。这个版本标志着 Java 集合 API 的首次亮相（包括集合、映射和列表）。1.2 版本中的许多新特性导致 Sun 将平台重新命名为“Java 2 平台”。然而，“Java 2”这个术语仅仅是一个商标，而不是实际的版本号。

Java 1.3 (2000)

这主要是一个维护版本，重点是修复错误、提高稳定性和性能。这个版本还引入了 HotSpot Java 虚拟机，至今仍在使用（尽管自那时以来已经经过了大幅修改和改进）。

Java 1.4 (2002)

这是另一个相当重要的版本发布，增加了一些重要的新功能，如更高性能的低级 I/O API；用于文本处理的正则表达式；XML 和 XSLT 库；SSL 支持；日志记录 API；以及加密支持。

Java 5 (2004)

这个大版本的 Java 引入了一些对核心语言本身的改变，包括泛型类型、枚举类型、注解、可变参数方法、自动装箱以及新的`for`循环。这些改变被认为足够重要以至于改变了主版本号的编号方式，开始以主要版本发布。此版本包含了 166 个包中的 3562 个类和接口。显著的增加包括用于并发编程的实用程序、远程管理框架以及用于 Java 虚拟机自身的远程管理和仪器化类。

Java 6 (2006)

这个版本主要是维护和性能优化版本。它引入了编译器 API，扩展了注解的使用和范围，并提供了绑定以允许脚本语言与 Java 互操作。还有大量内部错误修复和对 JVM 和 Swing GUI 技术的改进。

Java 7 (2011)

在 Oracle 掌管下的第一个 Java 发布版包括对语言和平台的一些重大升级，同时也是基于开源参考实现的第一个发布版。引入了`try`-with-resources 和 NIO.2 API，使开发者能够编写更安全、更少出错的处理资源和 I/O 的代码。方法句柄 API 提供了反射的简单和安全替代方案；此外，它还为`invokedynamic`（自 Java 1.0 版以来的第一个新字节码）开启了大门。

Java 8 (2014) (LTS)

这是一个重大的发布版本，可能是自 Java 5 以来（或可能是有史以来）对语言进行的最重要的改变。引入了 lambda 表达式，显著提高了开发者的生产力，集合框架也更新以利用 lambda 表达式，为实现这一点所需的机制标志着 Java 在面向对象方面的根本性变化。其他主要更新包括新的日期和时间 API 以及并发库的重大更新。

Java 9 (2017)

这个版本显著延迟，引入了新的平台模块化特性，允许 Java 应用程序打包成部署单元并模块化平台运行时。其他变更包括新的默认垃圾收集算法、用于处理进程的新 API 以及框架访问内部方式的一些变更。此外，这个版本还改变了发布周期本身，使得新版本每 6 个月发布一次，但只有 LTS 版本获得了广泛应用。因此，我们从此点开始只记录 LTS 版本的发布。

Java 11 (September 2018) (LTS)

这个版本是首个被视为长期支持（LTS）版本的模块化 Java。它添加了一些对开发者直接可见的新功能，主要包括对类型推断（`var`）、JDK 飞行记录器（JFR）和新的 HTTP/2 API 的改进支持。还有一些额外的内部变更和显著的性能改进，但这个 LTS 版本主要旨在 Java 9 之后的稳定化。

Java 17（2021 年 9 月）（LTS）

当前版本 LTS 发布。包括对 Java 面向对象模型的重要改变（封闭类、记录和巢状类），以及开关表达式、文本块和语言模式匹配的初版。JVM 还进行了额外的性能改进，并提供了更好的容器中运行支持。内部升级继续进行，并添加了两个新的垃圾收集器。

目前，仅有 LTS 版本 11 和 17 是当前生产版本。由于模块引入的重大变化，Java 8 被追溯地宣布为 LTS 版本，为团队和应用程序迁移到受支持的模块化 Java 提供了额外的时间。现在它被认为是一个“经典”版本，并强烈建议团队迁移到其中一种现代的 LTS 版本。

# 摘要

在本介绍性章节中，我们将 Java 放置在编程语言的整体格局和历史中进行了比较。我们将语言与其他流行的替代方案进行了比较，首次查看了 Java 程序编译和执行的基本解剖，并试图消除关于 Java 的一些流行误解。

下一章将从*自下而上*的角度，重点介绍 Java 语言的语法，专注于词法语法的各个基本单元并逐步构建。如果您已经熟悉类似 Java 的语言的语法（如 JavaScript、C 或 C++），您可以选择略读或跳过本章，并在遇到不熟悉的语法时参考。

^(1) Java ME 是面向功能手机和第一代智能手机的一个较旧的标准。如今，Android 和 iOS 主导手机市场，Java ME 已不再更新。

^(2) Java EE 现已移交至 Eclipse Foundation，继续作为 Jakarta EE 项目存在。
