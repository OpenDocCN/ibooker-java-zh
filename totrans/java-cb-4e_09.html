<html><head></head><body><section data-pdf-bookmark="Chapter 9. Functional Programming Techniques: Functional Interfaces, Streams, and Parallel Collections" data-type="chapter" epub:type="chapter"><div class="chapter" id="javacook-fp">&#13;
<h1><span class="label">Chapter 9. </span>Functional Programming Techniques: Functional Interfaces, Streams, <span class="keep-together">and Parallel Collections</span></h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="9.0 Introduction" data-type="sect1"><div class="sect1" id="javacook-fp-intro">&#13;
<h1>9.0 Introduction</h1>&#13;
&#13;
<p><a data-primary="functional programming" data-type="indexterm" id="fp_ch"/><a data-primary="functional programming" data-secondary="about" data-type="indexterm" id="fp_ab"/>Java is an Object-Oriented (OO) language. You know what that is.&#13;
Functional Programming (FP) has been attracting attention lately.&#13;
There may not be quite as many definitions of FP as there are FP languages, but it’s close.&#13;
Wikipedia’s definition of functional programming is as follows (from <a href="https://en.wikipedia.org/wiki/Functional_programming"><em class="hyperlink">https://en.wikipedia.org/wiki/Functional_programming</em></a>, viewed December 2013):</p>&#13;
<blockquote>&#13;
<p>a programming paradigm, a style&#13;
of building the structure and elements of computer programs, that&#13;
treats computation as the evaluation of mathematical functions and&#13;
avoids state and mutable data. Functional programming emphasizes&#13;
functions that produce results that depend only on their inputs and&#13;
not on the program state—i.e. pure mathematical functions. It is&#13;
a declarative programming paradigm, which means programming is done&#13;
with expressions. In functional code, the output value of a function&#13;
depends only on the arguments that are input to the function, so&#13;
calling a function f twice with the same value for an argument x&#13;
will produce the same result f(x) both times. Eliminating side&#13;
effects, i.e. changes in state that don’t depend on the function&#13;
inputs, can make it much easier to understand and predict the&#13;
behavior of a program, which is one of the key motivations for the&#13;
development of functional programming.</p>&#13;
</blockquote>&#13;
&#13;
<p>How can we benefit from the FP paradigm?&#13;
One way would be to switch to using an FP language; some of the leading ones are&#13;
Haskell,<sup><a data-type="noteref" href="ch09.html#idm45290660939720" id="idm45290660939720-marker">1</a></sup>&#13;
Idris, Ocaml, Erlang, Julia, and the LISP family.&#13;
But most of those would require walking away from the Java ecosystem.&#13;
You could consider using<a data-primary="Scala" data-type="indexterm" id="idm45290660937656"/><a data-primary="Clojure" data-type="indexterm" id="idm45290660937016"/> <a href="http://www.scala-lang.org">Scala</a> or <a href="http://clojure.org">Clojure</a>,&#13;
JVM-based languages that provide functional programming support in the context of an OO language.&#13;
And there is <a href="https://kotlinlang.org">Kotlin</a>, the latest Java-like language for the JVM.</p>&#13;
&#13;
<p>But this is the <em>Java Cookbook</em>, so you can imagine we’re going to try to&#13;
get as many benefits of functional programming as we can while remaining in the Java language.&#13;
Some features of FP include the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Pure functions having no side effects and whose results depend only on their inputs and not on mutable state elsewhere in the program</p>&#13;
</li>&#13;
<li>&#13;
<p>First-class functions (e.g., functions as data)</p>&#13;
</li>&#13;
<li>&#13;
<p>Immutable data</p>&#13;
</li>&#13;
<li>&#13;
<p>Extensive use of recursion and lazy evaluation</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><a data-primary="pure functions" data-type="indexterm" id="idm45290660928536"/><em>Pure functions</em> are completely self-contained; their operation depends only&#13;
on the input parameters and internal logic, not on any variable state in other parts of the program—indeed, there are no global variables, only global <em>constants</em>. Although this can be hard to accept for those schooled in imperative languages like Java, it does make it much easier to test and ensure program correctness! It means that, no matter what else is going on in the program (even with multiple threads), a method call like <code>computeValue(27)</code> will always, unconditionally, return the same value every time (with exceptions, of course, for things like the current time, random seeds, etc., which are global state).</p>&#13;
&#13;
<p>We’ll use the terms <em>function</em> and <em>method</em> interchangeably in this chapter, although it’s not&#13;
strictly correct. FP people use the term <em>function</em> in the mathematical function sense,&#13;
whereas in Java <em>methods</em> just means some code you can call (a Java method call is also referred to as a <em>message</em> being <em>sent</em> to an object, in the OO view of things).</p>&#13;
&#13;
<p><em>Functions as data</em> means that you can create <em>an object that is a function</em>, pass it into another function, write a function that returns another function, and so on—with no special syntax, because, well, functions <em>are</em> data.</p>&#13;
&#13;
<p>One of Java’s approaches to FP is the definition of functional interfaces.&#13;
A<a data-primary="functional interface" data-type="indexterm" id="idm45290660920456"/> <em>functional interface</em> in Java is one that has only one abstract method, such as the widely used&#13;
<code>Runnable</code>, whose only method is <a data-primary="run() method" data-type="indexterm" id="idm45290660918408"/><code>run()</code>, or the common Swing action handler&#13;
<code>ActionListener</code>, whose only method is <a data-primary="actionPerformed() method" data-type="indexterm" id="idm45290660916872"/><code>actionPerformed(ActionEvent)</code>.&#13;
Actually, also new in Java 8, interfaces can have methods annotated with the&#13;
new-in-this-context <code>default</code> keyword.&#13;
A <code>default</code> method in an interface becomes available for use in any class that <code>implements</code>&#13;
the interface. Such methods cannot depend&#13;
on instance state in a particular class because they would have no way of referring to it at compile time.</p>&#13;
&#13;
<p>So a functional interface is more precisely defined as one that has a single nondefault method.&#13;
You can do functional-style programming in Java if you use functional interfaces&#13;
and if you restrict code in your methods to not depending on any nonfinal&#13;
instance or class fields; using default methods is one way of achieving this.&#13;
The first few recipes in this chapter discuss functional interfaces.</p>&#13;
&#13;
<p>Another Java approach to functional-ness is lambda expressions. A lambda is an expression of a functional&#13;
interface, and it can be used as data (i.e., assigned, returned, etc.). Just to give a&#13;
couple of short examples for now:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">ActionListener</code> <code class="n">x</code> <code class="o">=</code> <code class="n">e</code> <code class="o">-&gt;</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"You activated "</code> <code class="o">+</code> <code class="n">e</code><code class="o">.</code><code class="na">getSource</code><code class="o">());</code></pre>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">RunnableLambda</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">threadPool</code><code class="o">.</code><code class="na">submit</code><code class="o">(()</code> <code class="o">-&gt;</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Hello from a thread"</code><code class="o">));</code></pre>&#13;
&#13;
<p>Immutable data is easy in theory: just have a class with only read accessors (“get” methods).&#13;
The standard <code>String</code> class, for example, is immutable: methods like <a data-primary="substring() method" data-type="indexterm" id="idm45290660878792"/><a data-primary="toUpperCase() method" data-type="indexterm" id="idm45290660878184"/><code>substring()</code> or <code>toUpperCase()</code>&#13;
don’t change the original string, but make up new string objects with the requested change.&#13;
Yet strings are universally used, and useful.&#13;
Enums are also implicitly immutable.&#13;
There is a proposal to add a new kind of class-like object called a <code>record</code> in Java 14 or 15.&#13;
<code>record</code>s are implicitly immutable; the compiler generates “get” methods for the fields&#13;
(along with a constructor and the three common <code>Object</code> methods), but not “set” methods.</p>&#13;
&#13;
<p>Also new in Java 8 is the notion of <code>Stream</code> classes. A <code>Stream</code> is like a pipeline that you can feed into, fan out, collect down—like a cross between the Unix notion of pipelines and Google’s distributed programming concept of MapReduce, as exemplified in<a data-primary="Hadoop" data-type="indexterm" id="idm45290660846344"/> <a href="http://hadoop.apache.org">Hadoop</a>, but running in a single VM, a single program. <code>Stream</code>s can be sequential or parallel; the latter are designed to take advantage of the massive parallelism that is happening in hardware design (particularly servers, where 12- and 16-core processors are popular). We discuss <code>Stream</code>s in several recipes in this chapter.</p>&#13;
&#13;
<p>If you’re familiar with Unix pipes and filters, this equivalence will make sense to you; if not,&#13;
you can skip it for now.&#13;
The Unix command is this:</p>&#13;
<pre>cat lines.txt | sort | uniq | wc -l</pre>&#13;
&#13;
<p>The Java <code>Stream</code>s equivalent is this:</p>&#13;
<pre>jshell&gt; long numberLines =&#13;
    new BufferedReader(&#13;
    new FileReader("lines.txt")).lines().sorted().distinct().count();&#13;
numberLines ==&gt; 5</pre>&#13;
&#13;
<p>These commands are written out in more idiomatic Java in <a data-type="xref" href="#javacook-fp-unixpipes">Example 9-1</a>.&#13;
Both approaches give the same answer. For small inputs, the Unix pipeline is faster; but for larger volumes, the Java one should be faster, especially when parallelized.</p>&#13;
<div data-type="example" id="javacook-fp-unixpipes">&#13;
<h5><span class="label">Example 9-1. </span>main/src/main/java/functional/UnixPipesFiltersReplacement.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="kt">long</code> <code class="n">numberLines</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">lines</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">((</code><code class="s">"lines.txt"</code><code class="o">)))</code>&#13;
            <code class="o">.</code><code class="na">sorted</code><code class="o">()</code>&#13;
            <code class="o">.</code><code class="na">distinct</code><code class="o">()</code>&#13;
            <code class="o">.</code><code class="na">count</code><code class="o">();</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">printf</code><code class="o">(</code><code class="s">"lines.txt contains "</code> <code class="o">+</code> <code class="n">numberLines</code> <code class="o">+</code> <code class="s">" unique lines."</code><code class="o">);</code></pre></div>&#13;
&#13;
<p>Tied in with <code>Stream</code>s is the notion of a <code>Spliterator</code>, a derivative (logically, not by inheritance) of the familiar <code>Iterator</code> but designed for use in parallel processing. Most users will not be expected to develop their own <code>Spliterator</code> and will likely not even call its methods directly very often, so we do not discuss them in detail.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290660691960">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>For general information on functional programming, see the book <a data-primary="Functional Thinking (Ford)" data-type="indexterm" id="idm45290660690632"/><a data-primary="Ford, Neal" data-secondary="Functional Thinking" data-type="indexterm" id="idm45290660689960"/><em><a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920029687.do">Functional Thinking</a></em> by Neal Ford (O’Reilly).</p>&#13;
&#13;
<p>There is an entire book dedicated to lambda expressions and related tools,<a data-primary="Java 8 Lambdas (Warburton)" data-primary-sortas="Java 08 Lambdas (Warburton)" data-type="indexterm" id="idm45290660687576"/><a data-primary="Warburton, Richard" data-secondary="Java 8 Lambdas" data-type="indexterm" id="idm45290660686616"/> Richard Warburton’s&#13;
<em><a class="orm:hideurl" href="http://shop.oreilly.com/product/0636920030713.do">Java 8 Lambdas</a></em> (O’Reilly).<a data-primary="" data-startref="fp_ab" data-type="indexterm" id="idm45290660684392"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="9.1 Using Lambdas/Closures Instead of Inner Classes" data-type="sect1"><div class="sect1" id="javacook-lambda-interfaces">&#13;
<h1>9.1 Using Lambdas/Closures Instead of Inner Classes</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-lambda-interfaces-1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="closures" data-type="indexterm" id="clo_ab"/><a data-primary="functional programming" data-secondary="closures" data-type="indexterm" id="fp_cl"/><a data-primary="functional programming" data-secondary="lambdas" data-type="indexterm" id="fp_la"/><a data-primary="lambda expressions" data-type="indexterm" id="le_ab"/>You want to avoid all the typing that even the anonymous style of inner class requires.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-lambda-interfaces-2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use Java’s lambda expressions.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-lambda-interfaces-3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The symbol lambda (λ) is the 11th letter of the Greek alphabet and thus as old as Western society. The <a href="http://en.wikipedia.org/wiki/Lambda_calculus">Lambda calculus</a> is about as old as our notions of computing. In this context, Lambda expressions are small units of calculation that can be referred to. They are functions as data. In that sense, they are a lot like anonymous inner classes, though it’s probably better to think of them as<a data-primary="anonymous methods" data-type="indexterm" id="idm45290660670392"/> <em>anonymous methods</em>. They are essentially used to replace inner classes for a <a data-primary="functional interface" data-type="indexterm" id="idm45290660669144"/><em>functional interface</em>—that is, an interface with one abstract method (function) in it. A very common example is the AWT <code>ActionListener</code> interface, widely used in GUI code, whose only method is this one:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">void</code> <code class="nf">actionPerformed</code><code class="o">(</code><code class="n">ActionEvent</code><code class="o">);</code></pre>&#13;
&#13;
<p>Using lambdas is now the preferred method of writing for GUI action listeners.  Here’s a single example:</p>&#13;
&#13;
<pre data-type="programlisting">quitButton.addActionListener(e -&gt; shutDownApplication(0));</pre>&#13;
&#13;
<p>Because not everybody writes Swing GUI applications these days, let’s start with an example that doesn’t&#13;
require GUI programming. Suppose we have a collection of camera model descriptor objects that has already been loaded from a database into memory, and we want to write a general-purpose API for searching them, for use by other parts of our application.</p>&#13;
&#13;
<p>The first thought might be along the following lines:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">CameraInfo</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Camera</code><code class="o">&gt;</code> <code class="nf">findByMake</code><code class="o">();</code>&#13;
    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Camera</code><code class="o">&gt;</code> <code class="nf">findByModel</code><code class="o">();</code>&#13;
    <code class="o">...</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Perhaps you can already see the problem. You will also need to write <code>findByPrice()</code>, <code>findByMakeAndModel()</code>, <code>findByYearIntroduced()</code>, and so on as your application grows in complexity.</p>&#13;
&#13;
<p>You could consider implementing a query by example method, where you pass in a <code>Camera</code> object and all its nonnull fields are used in the comparison. But then how would you implement finding cameras with interchangeable lenses <em>under $500</em>?<sup><a data-type="noteref" href="ch09.html#idm45290660596184" id="idm45290660596184-marker">2</a></sup></p>&#13;
&#13;
<p>So a better approach is probably to use a callback function&#13;
to do the comparison. Then you can provide an anonymous inner class&#13;
to do any kind of searching you need. You’d want to be able to&#13;
write callback methods like this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">choose</code><code class="o">(</code><code class="n">Camera</code> <code class="n">c</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="k">return</code> <code class="n">c</code><code class="o">.</code><code class="na">isIlc</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">c</code><code class="o">.</code><code class="na">getPrice</code><code class="o">()</code> <code class="o">&lt;</code> <code class="mi">500</code><code class="o">;</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Accordingly, we’ll build that into an interface:<sup><a data-type="noteref" href="ch09.html#idm45290660542184" id="idm45290660542184-marker">3</a></sup></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/** An Acceptor accepts some elements from a Collection */</code>&#13;
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">CameraAcceptor</code> <code class="o">{</code>&#13;
    <code class="kt">boolean</code> <code class="nf">choose</code><code class="o">(</code><code class="n">Camera</code> <code class="n">c</code><code class="o">);</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Now the search application provides a method:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Camera</code><code class="o">&gt;</code> <code class="nf">search</code><code class="o">(</code><code class="n">CameraAcceptor</code> <code class="n">acc</code><code class="o">);</code></pre>&#13;
&#13;
<p>which we can call with code like this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">results</code> <code class="o">=</code> <code class="n">searchApp</code><code class="o">.</code><code class="na">search</code><code class="o">(</code><code class="k">new</code> <code class="n">CameraAcceptor</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">choose</code><code class="o">(</code><code class="n">Camera</code> <code class="n">c</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">c</code><code class="o">.</code><code class="na">isIlc</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">c</code><code class="o">.</code><code class="na">getPrice</code><code class="o">()</code> <code class="o">&lt;</code> <code class="mi">500</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Or, if you were not comfortable with anonymous inner classes, you might have to type this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code> <code class="nc">MyIlcPriceAcceptor</code> <code class="kd">implements</code> <code class="n">CameraAcceptor</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">choose</code><code class="o">(</code><code class="n">Camera</code> <code class="n">c</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">c</code><code class="o">.</code><code class="na">isIlc</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">c</code><code class="o">.</code><code class="na">getPrice</code><code class="o">()</code> <code class="o">&lt;</code> <code class="mi">500</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code>&#13;
<code class="n">CameraAcceptor</code> <code class="n">myIlcPriceAcceptor</code> <code class="o">=</code> <code class="n">nwq</code> <code class="n">MyIlcPriceAcceptor</code><code class="o">();</code>&#13;
<code class="n">results</code> <code class="o">=</code> <code class="n">searchApp</code><code class="o">.</code><code class="na">search</code><code class="o">(</code><code class="n">myIlcPriceAcceptor</code><code class="o">);</code></pre>&#13;
&#13;
<p>That’s really a great deal of typing just to get one method packaged up for sending into the search engine. Java’s support for lambda expressions or closures was argued about for many years (literally) before the experts agreed on how to do it. And the result is staggeringly simple. One way to think of Java lambda expressions is that each one is just a method that implements a functional interface. With lambda expressions, you can rewrite the preceding code as just:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">results</code> <code class="o">=</code> <code class="n">searchApp</code><code class="o">.</code><code class="na">search</code><code class="o">(</code><code class="n">c</code> <code class="o">-&gt;</code> <code class="n">c</code><code class="o">.</code><code class="na">isIlc</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">c</code><code class="o">.</code><code class="na">getPrice</code><code class="o">()</code> <code class="o">&lt;</code> <code class="mi">500</code><code class="o">);</code></pre>&#13;
&#13;
<p>The <a data-primary="arrow notation" data-type="indexterm" id="idm45290660337128"/>arrow notation -&gt; indicates the code to execute.&#13;
If it’s a simple expression as here, you can just write it as shown.&#13;
If there is conditional logic or other statements, you have to use&#13;
a block, as is usual in Java.</p>&#13;
&#13;
<p>Here I just rewrite the search example to show it as a block:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">results</code> <code class="o">=</code> <code class="n">searchApp</code><code class="o">.</code><code class="na">search</code><code class="o">(</code><code class="n">c</code> <code class="o">-&gt;</code> <code class="o">{</code>&#13;
    <code class="k">if</code> <code class="o">(</code><code class="n">c</code><code class="o">.</code><code class="na">isIlc</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">c</code><code class="o">.</code><code class="na">getPrice</code><code class="o">()</code> <code class="o">&lt;</code> <code class="mi">500</code><code class="o">)</code>&#13;
        <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>&#13;
    <code class="k">else</code>&#13;
        <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>&#13;
<code class="o">});</code></pre>&#13;
&#13;
<p>The first <code>c</code> inside the parenthesis corresponds to <code>Camera c</code> in the explicitly implemented <a data-primary="choose() method" data-type="indexterm" id="idm45290660232008"/><code>choose()</code> method: you can omit the type because the compiler knows it! If there is more than one argument to the method, you must parenthesize them. Suppose we had a compare method that takes two cameras and returns a quantitative value (oh, and good luck trying to get two photographers to agree on <em>that</em> <span class="keep-together">algorithm!):</span></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code> <code class="n">goodness</code> <code class="o">=</code> <code class="n">searchApp</code><code class="o">.</code><code class="na">compare</code><code class="o">((</code><code class="n">c1</code><code class="o">,</code> <code class="n">c2</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="o">{</code>&#13;
    <code class="c1">// write some amazing code here</code>&#13;
<code class="o">});</code></pre>&#13;
&#13;
<p>This notion of <em>lambdas</em> seems pretty potent, and it is!&#13;
You will see much more of this in Java as Java 8 moves into the mainstream&#13;
of computing.</p>&#13;
&#13;
<p>Up to here, we still have to write an interface for each&#13;
type of method that we want to be able to lambda-ize.&#13;
The next recipe shows some predefined interfaces&#13;
that you can use to further simplify (or at least shorten) your code.</p>&#13;
&#13;
<p>And, of course, there are many existing interfaces that are functional, such as the <code>ActionListener</code> interface from GUI applications. Interestingly, the IntelliJ IDE&#13;
(see <a data-type="xref" href="ch01.html#javacook-getstarted-SECT-3">Recipe 1.3</a>) automatically recognizes inner class definitions&#13;
that are replaceable by lambdas and,&#13;
when using <a data-primary="code folding" data-type="indexterm" id="idm45290660208984"/><em>code folding</em> (the IDE feature of representing an entire method definition with&#13;
a single line), replaces the inner class with the corresponding lambda! Figures <a data-type="xref" data-xrefstyle="select: labelnumber" href="#javacook-lambda-intellij-f1">9-1</a> and <a data-type="xref" data-xrefstyle="select: labelnumber" href="#javacook-lambda-intellij-f2">9-2</a>&#13;
show a before-and-after picture of this code folding.<a data-primary="" data-startref="clo_ab" data-type="indexterm" id="idm45290660205304"/><a data-primary="" data-startref="fp_cl" data-type="indexterm" id="idm45290660204360"/><a data-primary="" data-startref="fp_la" data-type="indexterm" id="idm45290660203416"/><a data-primary="" data-startref="le_ab" data-type="indexterm" id="idm45290660172056"/></p>&#13;
&#13;
<figure><div class="figure" id="javacook-lambda-intellij-f1">&#13;
<img alt="jcb4 0901" src="assets/jcb4_0901.png"/>&#13;
<h6><span class="label">Figure 9-1. </span>IntelliJ code unfolded</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="javacook-lambda-intellij-f2">&#13;
<img alt="jcb4 0902" src="assets/jcb4_0902.png"/>&#13;
<h6><span class="label">Figure 9-2. </span>IntelliJ code folded</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="9.2 Using Lambda Predefined Interfaces Instead of Your Own" data-type="sect1"><div class="sect1" id="javacook-lambda-interfacesb">&#13;
<h1>9.2 Using Lambda Predefined Interfaces Instead <span class="keep-together">of Your Own</span></h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-lambda-interfacesb-1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="functional programming" data-secondary="custom interfaces" data-type="indexterm" id="fp_ci"/>You want to use existing interfaces, instead of defining your own,&#13;
for use with <span class="keep-together">Lambdas.</span></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-lambda-interfacesb-2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the Java 8 lambda functional interfaces from <code>java.util.function</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-lambda-interfacesb-3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>In <a data-type="xref" href="#javacook-lambda-interfaces">Recipe 9.1</a>, we used the interface method <a data-primary="acceptCamera() method" data-type="indexterm" id="idm45290660143464"/><code>acceptCamera()</code>&#13;
defined in the interface <code>CameraAcceptor</code>. Acceptor-type methods are&#13;
quite common, so the package <code>java.util.function</code> includes the&#13;
<code>Predicate&lt;T&gt;</code> interface, which we can use instead of <code>CameraAcceptor</code>.&#13;
This interface has only one method—<code>boolean test(T t)</code>:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">Predicate</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="o">{</code>&#13;
    <code class="kt">boolean</code> <code class="nf">test</code><code class="o">(</code><code class="n">T</code> <code class="n">t</code><code class="o">);</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>This package includes about 50 of the most commonly needed functional interfaces,&#13;
such as <code>IntUnaryOperator</code>, which takes one <code>int</code> argument and returns an <code>int</code> value;&#13;
<code>LongPredicate</code>, which takes one <code>long</code> and returns <code>boolean</code>; and so on.</p>&#13;
&#13;
<p>To use the <code>Predicate</code> interface, as with any generic type, we provide an actual type&#13;
for the parameter <code>Camera</code>, giving us (in this case)&#13;
the parameterized type <code>Predicate&lt;Camera&gt;</code>, which is the following&#13;
(although we don’t have to write this out):</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">Predicate</code><code class="o">&lt;</code><code class="n">Camera</code><code class="o">&gt;</code> <code class="o">{</code>&#13;
    <code class="kt">boolean</code> <code class="nf">test</code><code class="o">(</code><code class="n">Camera</code> <code class="n">c</code><code class="o">);</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>So now our search application will be changed to offer us the following search method:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Camera</code><code class="o">&gt;</code> <code class="nf">search</code><code class="o">(</code><code class="n">Predicate</code> <code class="n">p</code><code class="o">);</code></pre>&#13;
&#13;
<p>Conveniently, this has the same signature as our own <code>CameraAcceptor</code> from the point of view of the anonymous methods that lambdas implement, so the rest of our code doesn’t have to change! This is still a valid call to the <a data-primary="search() method" data-type="indexterm" id="idm45290660077320"/><code>search()</code> method:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">results</code> <code class="o">=</code> <code class="n">searchApp</code><code class="o">.</code><code class="na">search</code><code class="o">(</code><code class="n">c</code> <code class="o">-&gt;</code> <code class="n">c</code><code class="o">.</code><code class="na">isIlc</code><code class="o">()</code> <code class="o">&amp;&amp;</code> <code class="n">c</code><code class="o">.</code><code class="na">getPrice</code><code class="o">()</code> <code class="o">&lt;</code> <code class="mi">500</code><code class="o">);</code></pre>&#13;
&#13;
<p>Here is the implementation of the <code>search</code> method:</p>&#13;
&#13;
<p><em>main/src/main/java/functional/CameraSearchPredicate.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Camera</code><code class="o">&gt;</code> <code class="nf">search</code><code class="o">(</code><code class="n">Predicate</code><code class="o">&lt;</code><code class="n">Camera</code><code class="o">&gt;</code> <code class="n">tester</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">List</code><code class="o">&lt;</code><code class="n">Camera</code><code class="o">&gt;</code> <code class="n">results</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>&#13;
        <code class="n">privateListOfCameras</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">c</code> <code class="o">-&gt;</code> <code class="o">{</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">tester</code><code class="o">.</code><code class="na">test</code><code class="o">(</code><code class="n">c</code><code class="o">))</code>&#13;
                <code class="n">results</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">c</code><code class="o">);</code>&#13;
        <code class="o">});</code>&#13;
        <code class="k">return</code> <code class="n">results</code><code class="o">;</code>&#13;
    <code class="o">}</code></pre>&#13;
&#13;
<p>Suppose we only need the list to do one operation on each element, and then&#13;
we’ll discard it. Upon reflection, we don’t actually need to&#13;
get the list back; we merely need to get our hooks on each element that&#13;
matches our <code>Predicate</code> in turn.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Roll Your Own Functional Interface" data-type="sect2"><div class="sect2" id="javacook-lambda-interfacesb-4">&#13;
<h2>Roll Your Own Functional Interface</h2>&#13;
&#13;
<p>While the JDK provides a good set of functional interfaces, there may be cases&#13;
where you’d want to create your own. This is a simple example of a functional interface:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">MyFunctionalInterface</code> <code class="o">{</code>&#13;
    <code class="kt">int</code> <code class="nf">compute</code><code class="o">(</code><code class="kt">int</code> <code class="n">x</code><code class="o">);</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>The <code>@FunctionalInterface</code> annotation tells the compiler to ensure that a given interface is and remains functional.&#13;
Its use is analogous to <code>@Override</code> (both annotations are in <code>java.lang</code>). It is always optional.</p>&#13;
&#13;
<p><code>MyFunctionalInterface</code> could be used to process an array of integers, like this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ProcessIntsUsingFunctional</code> <code class="o">{</code>&#13;
    <code class="kd">static</code> <code class="kt">int</code><code class="o">[]</code> <code class="n">integers</code> <code class="o">=</code> <code class="o">{</code><code class="mi">1</code><code class="o">,</code> <code class="mi">2</code><code class="o">,</code> <code class="mi">3</code><code class="o">};</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="kt">int</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code> <code class="o">:</code> <code class="n">integers</code><code class="o">)</code>&#13;
            <code class="n">total</code> <code class="o">+=</code> <code class="n">process</code><code class="o">(</code><code class="n">i</code><code class="o">,</code> <code class="n">x</code> <code class="o">-&gt;</code>  <code class="n">x</code> <code class="o">*</code> <code class="n">x</code> <code class="o">+</code> <code class="mi">1</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The total is "</code> <code class="o">+</code> <code class="n">total</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="kt">int</code> <code class="nf">process</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">,</code> <code class="n">MyFunctionalInterface</code> <code class="n">o</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">o</code><code class="o">.</code><code class="na">compute</code><code class="o">(</code><code class="n">i</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>If <code>compute</code> were a nonfunctional interface—having multiple abstract methods—you would not&#13;
be able to use it in this fashion.</p>&#13;
&#13;
<p>Sometimes, of course, you really do need an interface to have more than one method. In that case, the illusion (or the effect) of functionality can sometimes be preserved by denoting all but one of the methods with the default keyword—the nondefault method will still be usable in lambdas.&#13;
A default method has a method body:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">ThisIsStillFunctional</code> <code class="o">{</code>&#13;
    <code class="k">default</code> <code class="kt">int</code> <code class="nf">compute</code><code class="o">(</code><code class="kt">int</code> <code class="n">ix</code><code class="o">)</code> <code class="o">{</code> <code class="k">return</code> <code class="n">ix</code> <code class="o">*</code> <code class="n">ix</code> <code class="o">+</code> <code class="mi">1</code> <code class="o">};</code>&#13;
    <code class="kt">int</code> <code class="nf">anotherMethod</code><code class="o">(</code><code class="kt">int</code> <code class="n">y</code><code class="o">);</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Only default methods may contain executable statements, and there may only be one nondefault method per functional interface.</p>&#13;
&#13;
<p>By the way, the <code>MyFunctionalInterface</code> given earlier can be totally replaced by <code>java.util.function.IntUnaryOperator</code>, changing the method name <a data-primary="apply() method" data-type="indexterm" id="idm45290659728120"/><code>apply()</code> to<a data-primary="applyAsInt() method" data-type="indexterm" id="idm45290659727096"/> <code class="keep-together">applyAsInt()</code>. There is a version of the <code>ProcessInts</code> program under the name <code>ProcessIntsIntUnaryOperator</code> in the <a data-primary="javasrc repository" data-type="indexterm" id="idm45290659724712"/><em>javasrc</em> repository.</p>&#13;
&#13;
<p>Default methods in interfaces can be used to produce <em>mixins</em>, as described in <a data-type="xref" href="#fp-mixins-sect1">Recipe 9.7</a>.<a data-primary="" data-startref="fp_ci" data-type="indexterm" id="idm45290659721960"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="9.3 Simplifying Processing with Streams" data-type="sect1"><div class="sect1" id="javacook-fp-streams1-1">&#13;
<h1>9.3 Simplifying Processing with Streams</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-fp-streams1-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="functional programming" data-secondary="streams and" data-type="indexterm" id="fp_stre"/><a data-primary="streams" data-secondary="functional programming and" data-type="indexterm" id="stre_fp"/>You want to process some data through a pipeline-like mechanism.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-fp-streams1-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use a <code>Stream</code> class and its operations.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-fp-streams1-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><em>Streams</em> are a new mechanism introduced with Java 8 to allow a collection to send its values&#13;
out one at a time through a pipeline-like mechanism where they can be processed in various ways,&#13;
with varying degrees of parallelism.  There are three types of methods involved with <code>Stream</code>s:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Stream-producing methods (see <a data-type="xref" href="ch07.html#javacook-structure-collections">Recipe 7.3</a>).</p>&#13;
</li>&#13;
<li>&#13;
<p>Stream-passing methods, which operate on a Stream and return a reference to it, in order to allow for<a data-primary="fluent programming" data-type="indexterm" id="idm45290659706632"/> <em>fluent programming</em> (chained methods calls); examples include <code>distinct()</code>, <code>filter()</code>, <code>limit()</code>, <code>map()</code>, <code>peek()</code>, <code>sorted()</code>, and <code>unsorted()</code>.</p>&#13;
</li>&#13;
<li>&#13;
<p>Stream-terminating methods, which conclude a streaming operation; examples include&#13;
<code>collect()</code>, <code>count()</code>, <code>findFirst()</code>, <code>max()</code>, <code>min()</code>, <code>reduce()</code>, and <code>sum()</code>.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In <a data-type="xref" href="#javacook-fp-streams-ex">Example 9-2</a>, we have a list of <code>Hero</code> objects&#13;
representing superheroes through the ages.&#13;
We use the <code>Stream</code> mechanism to filter just the adult heroes and then sum their ages.&#13;
We use it again to sort the heroes’ names alphabetically.</p>&#13;
&#13;
<p>In both operations we start with a stream generator (<code>Arrays.stream()</code>);&#13;
we run it through several steps, one of which involves a mapping operation&#13;
(don’t confuse with <code>java.util.Map</code>!) that causes a different value to be&#13;
sent along the pipeline. The stream is wrapped up by a terminal operation. The map and filter operations almost invariably are controlled by a lambda expression&#13;
(inner classes would be too tedious to use in this style of programming!).</p>&#13;
<div data-type="example" id="javacook-fp-streams-ex">&#13;
<h5><span class="label">Example 9-2. </span>main/src/main/java/functional/SimpleStreamDemo.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">    <code class="kd">static</code> <code class="n">Hero</code><code class="o">[]</code> <code class="n">heroes</code> <code class="o">=</code> <code class="o">{</code>&#13;
        <code class="k">new</code> <code class="nf">Hero</code><code class="o">(</code><code class="s">"Grelber"</code><code class="o">,</code> <code class="mi">21</code><code class="o">),</code>&#13;
        <code class="k">new</code> <code class="nf">Hero</code><code class="o">(</code><code class="s">"Roderick"</code><code class="o">,</code> <code class="mi">12</code><code class="o">),</code>&#13;
        <code class="k">new</code> <code class="nf">Hero</code><code class="o">(</code><code class="s">"Francisco"</code><code class="o">,</code> <code class="mi">35</code><code class="o">),</code>&#13;
        <code class="k">new</code> <code class="nf">Hero</code><code class="o">(</code><code class="s">"Superman"</code><code class="o">,</code> <code class="mi">65</code><code class="o">),</code>&#13;
        <code class="k">new</code> <code class="nf">Hero</code><code class="o">(</code><code class="s">"Jumbletron"</code><code class="o">,</code> <code class="mi">22</code><code class="o">),</code>&#13;
        <code class="k">new</code> <code class="nf">Hero</code><code class="o">(</code><code class="s">"Mavericks"</code><code class="o">,</code> <code class="mi">1</code><code class="o">),</code>&#13;
        <code class="k">new</code> <code class="nf">Hero</code><code class="o">(</code><code class="s">"Palladin"</code><code class="o">,</code> <code class="mi">50</code><code class="o">),</code>&#13;
        <code class="k">new</code> <code class="nf">Hero</code><code class="o">(</code><code class="s">"Athena"</code><code class="o">,</code> <code class="mi">50</code><code class="o">)</code> <code class="o">};</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
&#13;
        <code class="kt">long</code> <code class="n">adultYearsExperience</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">stream</code><code class="o">(</code><code class="n">heroes</code><code class="o">)</code>&#13;
                <code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="n">b</code> <code class="o">-&gt;</code> <code class="n">b</code><code class="o">.</code><code class="na">age</code> <code class="o">&gt;=</code> <code class="mi">18</code><code class="o">)</code>&#13;
                <code class="o">.</code><code class="na">mapToInt</code><code class="o">(</code><code class="n">b</code> <code class="o">-&gt;</code> <code class="n">b</code><code class="o">.</code><code class="na">age</code><code class="o">).</code><code class="na">sum</code><code class="o">();</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"We're in good hands! The adult superheros have "</code> <code class="o">+</code>&#13;
                <code class="n">adultYearsExperience</code> <code class="o">+</code> <code class="s">" years of experience"</code><code class="o">);</code>&#13;
&#13;
        <code class="n">List</code><code class="o">&lt;</code><code class="n">Object</code><code class="o">&gt;</code> <code class="n">sorted</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">stream</code><code class="o">(</code><code class="n">heroes</code><code class="o">)</code>&#13;
                <code class="o">.</code><code class="na">sorted</code><code class="o">((</code><code class="n">h1</code><code class="o">,</code> <code class="n">h2</code><code class="o">)</code> <code class="o">-&gt;</code> <code class="n">h1</code><code class="o">.</code><code class="na">name</code><code class="o">.</code><code class="na">compareTo</code><code class="o">(</code><code class="n">h2</code><code class="o">.</code><code class="na">name</code><code class="o">))</code>&#13;
                <code class="o">.</code><code class="na">map</code><code class="o">(</code><code class="n">h</code> <code class="o">-&gt;</code> <code class="n">h</code><code class="o">.</code><code class="na">name</code><code class="o">)</code>&#13;
                <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toList</code><code class="o">());</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Heroes by name: "</code> <code class="o">+</code> <code class="n">sorted</code><code class="o">);</code>&#13;
    <code class="o">}</code></pre></div>&#13;
&#13;
<p>And let’s run it to be sure it works:</p>&#13;
&#13;
<pre data-type="programlisting">We're in good hands! The adult superheroes have 243 years of experience&#13;
Heroes by name: [Athena, Francisco, Grelber, Jumbletron, Mavericks, Palladin,&#13;
                 Roderick, Superman]</pre>&#13;
&#13;
<p>See the javadoc for the <code>java.util.stream.Stream</code> interface for a complete list of the operations.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="9.4 Simplifying Streams with Collectors" data-type="sect1"><div class="sect1" id="javacook-functional-collectors">&#13;
<h1>9.4 Simplifying Streams with Collectors</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290659467400">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="collectors, simplifying streams with" data-type="indexterm" id="coll_ss"/>You construct Streams but they are complicated or inefficient.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290659464872">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>Collector</code>s.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290659462872">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a data-type="xref" href="#javacook-fp-streams-ex">Example 9-2</a> ended the first half with a call to <code>collect()</code>.&#13;
The argument to <a data-primary="collect() method" data-type="indexterm" id="idm45290659459480"/><code>collect()</code> is of type <code>Collector</code>,&#13;
which this recipe considers in more detail. <code>Collector</code>s are a form of what classical FP languages call <a href="https://en.wikipedia.org/wiki/Fold_(higher-order_function)"><em>folds</em></a>.&#13;
Folds are also called reduce, accumulate, aggregate, compress, or inject operations.&#13;
A <a data-primary="folds" data-type="indexterm" id="idm45290659456504"/><em>fold</em> in functional programming is a terminal operation, analogous to collapsing&#13;
a whole string of tickets into a flat pile (see <a data-type="xref" href="#javacook-fp-FIG-folds">Figure 9-3</a>).&#13;
The string of tickets represents the <code>Stream</code>, the folding operation is represented&#13;
by a function, and the final result is, well, the final result, all folded up.&#13;
It will often include a combining operation, analogous to counting the tickets as they are folded.</p>&#13;
&#13;
<figure><div class="figure" id="javacook-fp-FIG-folds">&#13;
<img alt="folds" src="assets/folds.png"/>&#13;
<h6><span class="label">Figure 9-3. </span>Stream of tickets before folding, during folding, and after folding: a terminal operation</h6>&#13;
</div></figure>&#13;
&#13;
<p>Note that in the first panel of <a data-type="xref" href="#javacook-fp-FIG-folds">Figure 9-3</a> we don’t know how long&#13;
the <code>Stream</code> is, but we expect that it will terminate eventually.</p>&#13;
&#13;
<p><em>Collector</em> as used in Java refers to a terminal function that analyses/summarizes the content of a <code>Stream</code>.&#13;
Technically, <code>Collector</code> is an interface whose implementation&#13;
is specified by three (or four) functions that work together to accumulate entries into a Collection&#13;
or Map or other mutable result container, and optionally a final transform on the result. The&#13;
functions are as follows:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Creating a new result container (the <code>supplier()</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Adding a new data element into the result container (the <code>accumulator()</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Combining two result <em>containers</em> into one (the <code>combiner()</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>Performing a final transform on the container (the <code>finisher()</code>, which is optional)</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>While you can easily compose your own <code>Collector</code> implementation, it is often expedient to use&#13;
one of the many useful ones predefined in the <code>Collectors</code> class. Here are a couple of simple examples:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kt">int</code> <code class="n">howMany</code> <code class="o">=</code> <code class="n">cameraList</code><code class="o">.</code><code class="na">stream</code><code class="o">().</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">counting</code><code class="o">());</code>&#13;
<code class="kt">double</code> <code class="n">howMuch</code> <code class="o">=</code> <code class="n">cameraList</code><code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="n">desiredFilter</code><code class="o">).</code>&#13;
	<code class="n">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">summingDouble</code><code class="o">(</code><code class="nl">Camera:</code><code class="o">:</code><code class="n">getPrice</code><code class="o">);</code></pre>&#13;
&#13;
<p>In <a data-type="xref" href="#javacook-functional-EX-wordfreq">Example 9-3</a> I implement the classic<a data-primary="word frequency count algorithm" data-type="indexterm" id="idm45290659330424"/> <em>word frequency count</em> algorithm:&#13;
take a text file, break it into individual words, count the occurrence of each word, and list&#13;
the <em>n</em> most-used words, sorted by frequency in descending order.</p>&#13;
&#13;
<p>In Unix terms this could be implemented (assuming <em>n</em> = 20) as:</p>&#13;
&#13;
<pre data-code-language="shell" data-type="programlisting">prep <code class="nv">$file</code> <code class="p">|</code> sort <code class="p">|</code> uniq -c <code class="p">|</code> sort -nr <code class="p">|</code> head -20</pre>&#13;
&#13;
<p>where <code>prep</code> is a script that uses the Unix tool <code>tr</code> to break lines into words and&#13;
turn the words into lowercase.</p>&#13;
<div data-type="example" id="javacook-functional-EX-wordfreq">&#13;
<h5><span class="label">Example 9-3. </span>main/src/main/java/functional/WordFreq.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kn">package</code> <code class="n">functional</code><code class="o">;</code>&#13;
&#13;
<code class="kn">import</code> <code class="nn">java.io.*</code><code class="o">;</code>&#13;
<code class="kn">import</code> <code class="nn">java.nio.file.*</code><code class="o">;</code>&#13;
<code class="kn">import</code> <code class="nn">java.util.*</code><code class="o">;</code>&#13;
<code class="kn">import</code> <code class="nn">java.util.stream.*</code><code class="o">;</code>&#13;
&#13;
<code class="cm">/**</code>&#13;
<code class="cm"> * Implement word frequency count, in two statements</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">WordFreq</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="c1">// 1) Collect words with a mutable reduction into Map&lt;String,Long&gt;.</code>&#13;
        <code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Long</code><code class="o">&gt;</code> <code class="n">map</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">lines</code><code class="o">(</code><code class="n">Path</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">]))</code>&#13;
            <code class="o">.</code><code class="na">flatMap</code><code class="o">(</code><code class="n">s</code> <code class="o">-&gt;</code> <code class="n">Stream</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">s</code><code class="o">.</code><code class="na">split</code><code class="o">(</code><code class="s">" +"</code><code class="o">)))</code>&#13;
            <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">groupingBy</code><code class="o">(</code>&#13;
                <code class="nl">String:</code><code class="o">:</code><code class="n">toLowerCase</code><code class="o">,</code> <code class="n">Collectors</code><code class="o">.</code><code class="na">counting</code><code class="o">()));</code>&#13;
&#13;
        <code class="c1">// 2) Print results sorted numerically descending, limit 20</code>&#13;
        <code class="n">map</code><code class="o">.</code><code class="na">entrySet</code><code class="o">().</code><code class="na">stream</code><code class="o">()</code>&#13;
            <code class="o">.</code><code class="na">sorted</code><code class="o">(</code><code class="n">Map</code><code class="o">.</code><code class="na">Entry</code><code class="o">.&lt;</code><code class="n">String</code><code class="o">,</code><code class="n">Long</code><code class="o">&gt;</code><code class="n">comparingByValue</code><code class="o">()</code> <code class="o">.</code><code class="na">reversed</code><code class="o">())</code>&#13;
            <code class="o">.</code><code class="na">limit</code><code class="o">(</code><code class="mi">20</code><code class="o">)</code>&#13;
            <code class="o">.</code><code class="na">map</code><code class="o">(</code><code class="n">entry</code> <code class="o">-&gt;</code> <code class="n">String</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"%4d %s"</code><code class="o">,</code> <code class="n">entry</code><code class="o">.</code><code class="na">getValue</code><code class="o">(),</code> <code class="n">entry</code><code class="o">.</code><code class="na">getKey</code><code class="o">()))</code>&#13;
            <code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">::</code><code class="n">println</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>There are two steps. First, create a map of the words and their frequencies.&#13;
Second, sort these in reverse order, stop at number 20, and format them&#13;
neatly and print.</p>&#13;
&#13;
<p>The first part uses <a data-primary="Files.lines() method" data-type="indexterm" id="idm45290659373800"/><code>Files.lines()</code> from <a data-type="xref" href="ch10.html#javacook-io">Chapter 10</a> to get a <code>Stream</code> of <code>Strings</code>,&#13;
which is broken into individual words using the <code>Stream</code> method <a data-primary="flatMap() method" data-type="indexterm" id="idm45290659083272"/><code>flatMap()</code> combined&#13;
with the <code>String</code> method <a data-primary="split() method" data-type="indexterm" id="idm45290659081704"/><code>split()</code> to break on one or more spaces.&#13;
The result of that is collected into a map using a <code>Collector</code>.&#13;
I had initially used a homemade collector:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="nl">HashMap:</code><code class="o">:</code><code class="k">new</code><code class="o">,</code> <code class="o">(</code><code class="n">m</code><code class="o">,</code><code class="n">s</code><code class="o">)-&gt;</code><code class="n">m</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="n">s</code><code class="o">,</code> <code class="n">m</code><code class="o">.</code><code class="na">getOrDefault</code><code class="o">(</code><code class="n">s</code><code class="o">,</code><code class="mi">0</code><code class="o">)+</code><code class="mi">1</code><code class="o">),</code> <code class="nl">HashMap:</code><code class="o">:</code><code class="n">putAll</code><code class="o">);</code></pre>&#13;
&#13;
<p>This form of <code>collect()</code> takes three arguments:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A <code>Supplier&lt;R&gt;</code> or factory method to create an empty container; here I’m just using the <code>HashMap</code> constructor.</p>&#13;
</li>&#13;
<li>&#13;
<p>An accumulator of type <code>BiConsumer&lt;R,? super T&gt;</code> to add each element into the map, adding one&#13;
each time the same word is found.</p>&#13;
</li>&#13;
<li>&#13;
<p>A Combiner of type <code>BiConsumer&lt;R,R&gt; combiner)</code> to combine all the collections used.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>In the case of parallel streams (see <a data-type="xref" href="#javacook-functional-parallel_collections">Recipe 9.5</a>), the <code>Supplier</code> may be called multiple times to create multiple containers, and each part of the Stream’s content will be handled by one Accumulator into one of the containers. The <code>Combiner</code> will merge all the containers into one at the end of processing.</p>&#13;
&#13;
<p>However, Sander Mak pointed out that it’s easier to use the existing <code>Collectors</code> <span class="keep-together">class’s predefined</span> Collector <code>groupingBy</code>, combining the <a data-primary="toLowerCase() method" data-type="indexterm" id="idm45290659033112"/><code>toLowerCase()</code> call and the <a data-primary="collect() method" data-type="indexterm" id="idm45290659031992"/><code>collect()</code> call with this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">groupingBy</code><code class="o">(</code><code class="nl">String:</code><code class="o">:</code><code class="n">toLowerCase</code><code class="o">,</code> <code class="n">Collectors</code><code class="o">.</code><code class="na">counting</code><code class="o">()));</code></pre>&#13;
&#13;
<p>To further simplify the code, you could combine the two statements into one, by doing the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Removing the return value and assignment <code>Map&lt;String,Long&gt; =</code></p>&#13;
</li>&#13;
<li>&#13;
<p>Removing the semicolon from the end of the <code>collect</code> call</p>&#13;
</li>&#13;
<li>&#13;
<p>Removing the <code>.map()</code> from the <code>entrySet()</code> call</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Then you can say you’ve implemented something useful in a single Java statement!<a data-primary="" data-startref="fp_stre" data-type="indexterm" id="idm45290659021704"/><a data-primary="" data-startref="stre_fp" data-type="indexterm" id="idm45290659020840"/><a data-primary="" data-startref="coll_ss" data-type="indexterm" id="idm45290659019896"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="9.5 Improving Throughput with Parallel Streams and Collections" data-type="sect1"><div class="sect1" id="javacook-functional-parallel_collections">&#13;
<h1>9.5 Improving Throughput with Parallel Streams and Collections</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-functional-parallel_collections.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="functional programming" data-secondary="parallel streams" data-type="indexterm" id="fp_ps"/><a data-primary="parallel streams" data-type="indexterm" id="ps_ab"/>You want to combine <code>Stream</code>s with parallelism and still be able to use the non-thread-safe&#13;
Collections API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-functional-parallel_collections.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use a parallel stream.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-functional-parallel_collections.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The standard Collections classes, such as most <code>List</code>, <code>Set</code>, and <code>Map</code> implementations,&#13;
are not thread-safe for update; if you add or remove objects from one in one thread while another&#13;
thread is accessing the objects stored in the collection, failure will result.&#13;
Multiple threads reading from the same collection with no modification is OK.&#13;
We discuss multithreading in <a data-type="xref" href="ch16.html#javacook-threads">Chapter 16</a>.</p>&#13;
&#13;
<p>The Collections Framework does provide <a data-primary="synchronized wrappers" data-type="indexterm" id="idm45290658975176"/><em>synchronized wrappers</em>, which provide automatic&#13;
synchronization but at the cost of adding thread contention, which reduces parallelism.&#13;
To enable efficient operations,  <em>parallel streams</em> let you use the non-thread-safe&#13;
collections safely, as long as you do not modify the collection while you are operating on it.</p>&#13;
&#13;
<p>To use a parallel stream, you just ask the collection for it, using <a data-primary="parallelStream() method" data-type="indexterm" id="idm45290658972952"/><code>parallelStream()</code>&#13;
instead of the <a data-primary="stream() method" data-type="indexterm" id="idm45290658971864"/><code>stream()</code> method we used in <a data-type="xref" href="#javacook-fp-streams1-1">Recipe 9.3</a>.</p>&#13;
&#13;
<p>For example, suppose that our camera business takes off, and we need to find cameras by type and price range <em>quickly</em> (and with less code than we used before):</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Search Results using For Loop"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">for</code><code> </code><code class="o">(</code><code class="n">Object</code><code> </code><code class="n">camera</code><code> </code><code class="o">:</code><code> </code><code class="n">privateListOfCameras</code><code class="o">.</code><code class="na">parallelStream</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code> </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-1" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>                </code><code class="n">filter</code><code class="o">(</code><code class="n">c</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">c</code><code class="o">.</code><code class="na">isIlc</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">&amp;</code><code class="o">&amp;</code><code> </code><code class="n">c</code><code class="o">.</code><code class="na">getPrice</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">&lt;</code><code> </code><code class="mi">500</code><code class="o">)</code><code class="o">.</code><code>       </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-2" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>                </code><code class="n">toArray</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code>                                        </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-3" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>            </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">camera</code><code class="o">)</code><code class="o">;</code><code>                             </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-4" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"Search Results from shorter, more functional approach"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">privateListOfCameras</code><code class="o">.</code><code class="na">parallelStream</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code>                      </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-5" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>                </code><code class="n">filter</code><code class="o">(</code><code class="n">c</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">c</code><code class="o">.</code><code class="na">isIlc</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">&amp;</code><code class="o">&amp;</code><code> </code><code class="n">c</code><code class="o">.</code><code class="na">getPrice</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">&lt;</code><code> </code><code class="mi">500</code><code class="o">)</code><code class="o">.</code><code>&#13;
</code><code>                </code><code class="n">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">:</code><code class="o">:</code><code class="n">println</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-1" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create a parallel stream from the <code>List</code> of <code>Camera</code> objects. The end result of the&#13;
stream will be iterated over by the foreach loop.</p></dd>&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-2" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Filter the cameras on price, using the same <code>Predicate</code> lambda that we used in <a data-type="xref" href="#javacook-lambda-interfaces">Recipe 9.1</a>.</p></dd>&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-3" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Terminate the <code>Stream</code> by converting it to an array.</p></dd>&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-4" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>The body of the foreach loop: print one <code>Camera</code> from the <code>Stream</code>.</p></dd>&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-5" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO1-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>A more concise way of writing the search.</p></dd>&#13;
</dl>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>This is reliable as long as no thread is modifying the data at the same time as the searching&#13;
is going on. See the thread interlocking mechanisms in <a data-type="xref" href="ch16.html#javacook-threads">Chapter 16</a> to see how to ensure this.<a data-primary="" data-startref="fp_ps" data-type="indexterm" id="idm45290658718472"/><a data-primary="" data-startref="ps_ab" data-type="indexterm" id="idm45290658717624"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="9.6 Using Existing Code as Functional with Method References" data-type="sect1"><div class="sect1" id="javacook-fp-refs">&#13;
<h1>9.6 Using Existing Code as Functional with Method References</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-fp-refs.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="functional programming" data-secondary="method references" data-type="indexterm" id="fp_mr"/><a data-primary="method references" data-type="indexterm" id="mr_ab"/>You have existing code that matches a functional interface and want to use it&#13;
without renaming methods to match the interface name.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-fp-refs.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use function references such as <code>MyClass::myFunc</code> or <code>someObj::someFunc</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-fp-refs.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The word <em>reference</em> is almost as overloaded in Java as the word <em>Session</em>.&#13;
Consider the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Ordinary objects are usually accessed with references.</p>&#13;
</li>&#13;
<li>&#13;
<p>Reference types such as <code>WeakReference</code> have defined semantics for garbage collection.</p>&#13;
</li>&#13;
<li>&#13;
<p>And now, for something completely different, Java 8 lets you reference an individual method.</p>&#13;
</li>&#13;
<li>&#13;
<p>You can even reference what Oracle documentation calls “an Instance Method of an Arbitrary Object of a Particular Type.”</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The new syntax consists of an object or class name, two colons, and the name of a method&#13;
that can be invoked in the context of the object or class name (as per the usual rules of Java,&#13;
a class name can refer to static methods and an instance can refer to an instance method).&#13;
To refer to a constructor as the method, you can use <code>new</code>—for example, <code>MyClass::new</code>.&#13;
The reference creates a lambda that can be invoked, stored in a variable of a functional&#13;
interface type, and so on.</p>&#13;
&#13;
<p>In <a data-type="xref" href="#javacook-fp-refs-ex1">Example 9-4</a>, we create a <code>Runnable</code> reference that holds, not the usual <code>run</code> method, but a method with the same type and arguments but with the name <code>walk</code>. Note the use of <code>this</code> as the object part of the method reference. We then pass this <code>Runnable</code> into a <code>Thread</code> constructor and start the thread, with the result that <code>walk</code> is invoked where <code>run</code> would normally be.</p>&#13;
<div data-type="example" id="javacook-fp-refs-ex1">&#13;
<h5><span class="label">Example 9-4. </span>main/src/main/java/functional/ReferencesDemo.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/** "Walk, don't run" */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">ReferencesDemo</code> <code class="o">{</code>&#13;
&#13;
    <code class="c1">// Assume this is an existing method we don't want to rename</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">walk</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"ReferencesDemo.walk(): Stand-in run method called"</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="c1">// This is our main processing method; it runs "walk" in a Thread</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">doIt</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">Runnable</code> <code class="n">r</code> <code class="o">=</code> <code class="k">this</code><code class="o">::</code><code class="n">walk</code><code class="o">;</code>&#13;
        <code class="k">new</code> <code class="nf">Thread</code><code class="o">(</code><code class="n">r</code><code class="o">).</code><code class="na">start</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="c1">// The usual simple main method to start things off</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">new</code> <code class="nf">ReferencesDemo</code><code class="o">().</code><code class="na">doIt</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>The output is as follows:</p>&#13;
&#13;
<pre data-type="programlisting">ReferencesDemo.walk(): Stand-in run method called</pre>&#13;
&#13;
<p><a data-type="xref" href="#javacook-fp-refs-ex2">Example 9-5</a> creates an <code>AutoCloseable</code> for use in a&#13;
try-with-resource.&#13;
The normal <code>AutoCloseable</code> method is <a data-primary="close() method" data-type="indexterm" id="idm45290658627896"/><a data-primary="cloz() method" data-type="indexterm" id="idm45290658627160"/><code>close()</code>, but ours is named <code>cloz()</code>.&#13;
The <code>AutoCloseable</code> reference variable <code>autoCloseable</code> is created inside the <code>try</code> statement,&#13;
so its close-like method will be called when the body completes.&#13;
In this example, we are in a static <code>main</code> method wherein we have a reference <code>rnd2</code>&#13;
to an instance of the class, so we use this in referring to the <code>AutoCloseable</code>-compatible <span class="keep-together">method</span>.</p>&#13;
<div data-type="example" id="javacook-fp-refs-ex2">&#13;
<h5><span class="label">Example 9-5. </span>main/src/main/java/functional/ReferencesDemo2.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ReferencesDemo2</code> <code class="o">{</code>&#13;
    <code class="kt">void</code> <code class="nf">cloz</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Stand-in close() method called"</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>&#13;
        <code class="n">ReferencesDemo2</code> <code class="n">rd2</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ReferencesDemo2</code><code class="o">();</code>&#13;
&#13;
        <code class="c1">// Use a method reference to assign the AutoCloseable interface</code>&#13;
        <code class="c1">// variable "ac" to the matching method signature "c" (obviously</code>&#13;
        <code class="c1">// short for close, but just to show the method name isn't what matters).</code>&#13;
        <code class="k">try</code> <code class="o">(</code><code class="n">AutoCloseable</code> <code class="n">autoCloseable</code> <code class="o">=</code> <code class="nl">rd2:</code><code class="o">:</code><code class="n">cloz</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Some action happening here."</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>The output is as follows:</p>&#13;
&#13;
<pre data-type="programlisting">Some action happening here.&#13;
Stand-in close() method called</pre>&#13;
&#13;
<p>It is, of course, possible to use this with your own functional interfaces, defined as in&#13;
<a data-type="xref" href="#javacook-lambda-interfacesb-4">“Roll Your Own Functional Interface”</a>.&#13;
You’re also probably at least vaguely aware that any normal Java object reference can be passed to <code>System.out.println()</code> and you’ll get some description of the referenced object. <a data-type="xref" href="#javacook-fp-refs-ex3">Example 9-6</a> explores these two themes. We define a functional interface imaginatively known as <code>FunInterface</code> with a method with a bunch of arguments (merely to avoid it being mistaken for any existing functional interface). The method name is <code>process</code>, but as you now know the name is not important; our implementation method goes by the name <code>work</code>. The <code>work</code> method is static, so we could not state that the class <code>implements FunInterface</code> (even if the method names were the same; a static method may not hide an inherited instance method), but we can nonetheless create a lambda reference to the <code>work</code> method. We then print this out to show that it has a valid structure as a Java object.</p>&#13;
<div data-type="example" id="javacook-fp-refs-ex3">&#13;
<h5><span class="label">Example 9-6. </span>main/src/main/java/functional/ReferencesDemo3.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ReferencesDemo3</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">interface</code> <code class="nc">FunInterface</code> <code class="o">{</code>&#13;
        <code class="kt">void</code> <code class="nf">process</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">,</code> <code class="n">String</code> <code class="n">j</code><code class="o">,</code> <code class="kt">char</code> <code class="n">c</code><code class="o">,</code> <code class="kt">double</code> <code class="n">d</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">work</code><code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">,</code> <code class="n">String</code> <code class="n">j</code><code class="o">,</code> <code class="kt">char</code> <code class="n">c</code><code class="o">,</code> <code class="kt">double</code> <code class="n">d</code><code class="o">){</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Moo"</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">FunInterface</code> <code class="n">sample</code> <code class="o">=</code> <code class="nl">ReferencesDemo3:</code><code class="o">:</code><code class="n">work</code><code class="o">;</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"My process method is "</code> <code class="o">+</code> <code class="n">sample</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>This generates the following output:</p>&#13;
&#13;
<pre data-type="programlisting">My process method is functional.ReferencesDemo3$$Lambda$1/713338599@4a574795</pre>&#13;
&#13;
<p>The <code>Lambda$1</code> in the name is structurally similar to the “$1” used in anonymous inner classes.</p>&#13;
&#13;
<p>The fourth way, “an Instance Method of an Arbitrary Object of a Particular Type,” may be the most esoteric thing in all of Java 8. It allows you to declare a reference to an instance method but without specifying which instance. Because there is no particular instance in mind, you again use the class name. This means you can use it with any instance of the given class! In <a data-type="xref" href="#javacook-fp-refs-ex4">Example 9-7</a>, we have an array of <code>String</code>s to sort.&#13;
Because the names in this array can begin with a lowercase letter, we want to sort them using the <code>String</code> method&#13;
<a data-primary="compareToIgnoreCase() method" data-type="indexterm" id="idm45290658395384"/><code>compareToIgnoreCase()</code>, which nicely ignores case differences for us.</p>&#13;
&#13;
<p>Because I want to show the sorting several different ways, I set up two array referencess, the original, unsorted one, and a working one that is re-created, sorted, and printed using a simple dump routine, which isn’t shown (it’s just a <code>for</code> loop printing the strings from the passed array).</p>&#13;
<div data-type="example" id="javacook-fp-refs-ex4">&#13;
<h5><span class="label">Example 9-7. </span>main/src/main/java/functional/ReferencesDemo4.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kn">import</code><code> </code><code class="nn">java.util.Arrays</code><code class="o">;</code><code>&#13;
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Comparator</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">ReferencesDemo4</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">unsortedNames</code><code> </code><code class="o">=</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="s">"Gosling"</code><code class="o">,</code><code> </code><code class="s">"de Raadt"</code><code class="o">,</code><code> </code><code class="s">"Torvalds"</code><code class="o">,</code><code> </code><code class="s">"Ritchie"</code><code class="o">,</code><code> </code><code class="s">"Hopper"</code><code>&#13;
</code><code>    </code><code class="o">}</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">names</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1">// Sort using&#13;
</code><code>        </code><code class="c1">// "an Instance Method of an Arbitrary Object of a Particular Type"&#13;
</code><code>        </code><code class="n">names</code><code> </code><code class="o">=</code><code> </code><code class="n">unsortedNames</code><code class="o">.</code><code class="na">clone</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">names</code><code class="o">,</code><code> </code><code class="nl">String:</code><code class="o">:</code><code class="n">compareToIgnoreCase</code><code class="o">)</code><code class="o">;</code><code>                    </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-1" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">dump</code><code class="o">(</code><code class="n">names</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1">// Equivalent Lambda:&#13;
</code><code>        </code><code class="n">names</code><code> </code><code class="o">=</code><code> </code><code class="n">unsortedNames</code><code class="o">.</code><code class="na">clone</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">names</code><code class="o">,</code><code> </code><code class="o">(</code><code class="n">str1</code><code class="o">,</code><code> </code><code class="n">str2</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">str1</code><code class="o">.</code><code class="na">compareToIgnoreCase</code><code class="o">(</code><code class="n">str2</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-2" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">dump</code><code class="o">(</code><code class="n">names</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1">// Equivalent old way:&#13;
</code><code>        </code><code class="n">names</code><code> </code><code class="o">=</code><code> </code><code class="n">unsortedNames</code><code class="o">.</code><code class="na">clone</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">names</code><code class="o">,</code><code> </code><code class="k">new</code><code> </code><code class="n">Comparator</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>                       </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-3" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>            </code><code class="nd">@Override</code><code>&#13;
</code><code>            </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="nf">compare</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">str1</code><code class="o">,</code><code> </code><code class="n">String</code><code> </code><code class="n">str2</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                </code><code class="k">return</code><code> </code><code class="n">str1</code><code class="o">.</code><code class="na">compareToIgnoreCase</code><code class="o">(</code><code class="n">str2</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="o">}</code><code>&#13;
</code><code>        </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">dump</code><code class="o">(</code><code class="n">names</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1">// Simpest way, using existing comparator&#13;
</code><code>        </code><code class="n">names</code><code> </code><code class="o">=</code><code> </code><code class="n">unsortedNames</code><code class="o">.</code><code class="na">clone</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">Arrays</code><code class="o">.</code><code class="na">sort</code><code class="o">(</code><code class="n">names</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">.</code><code class="na">CASE_INSENSITIVE_ORDER</code><code class="o">)</code><code class="o">;</code><code>                  </code><a class="co" href="#callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-4" id="co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="n">dump</code><code class="o">(</code><code class="n">names</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-1" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Using “an Instance Method of an Arbitrary Object of a Particular Type,” declares a reference to the <code>compareToIgnoreCase</code> method of any <code>String</code> used in the <span class="keep-together">invocation.</span></p></dd>&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-2" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Shows the equivalent lambda expression.</p></dd>&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-3" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Shows “Your grandparents’ Java” way of doing things.</p></dd>&#13;
<dt><a class="co" href="#co_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-4" id="callout_functional_programming_techniques__functional_interfaces__streams___span_class__keep_together__and_parallel_collections__span__CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Using the exported <code>Comparator</code> directly, just to show that there is&#13;
always more than one way to do things.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Just to be safe, I ran the demo, and got the expected output:<a data-primary="" data-startref="fp_mr" data-type="indexterm" id="idm45290658218200"/><a data-primary="" data-startref="mr_ab" data-type="indexterm" id="idm45290658217336"/></p>&#13;
&#13;
<pre data-type="programlisting">Amdahl, de Raadt, Gosling, Hopper, Ritchie, Turing&#13;
Amdahl, de Raadt, Gosling, Hopper, Ritchie, Turing&#13;
Amdahl, de Raadt, Gosling, Hopper, Ritchie, Turing&#13;
Amdahl, de Raadt, Gosling, Hopper, Ritchie, Turing</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="9.7 Java Mixins: Mixing in Methods" data-type="sect1"><div class="sect1" id="fp-mixins-sect1">&#13;
<h1>9.7 Java Mixins: Mixing in Methods</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="fp-mixins-sect1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="functional programming" data-secondary="mixins" data-type="indexterm" id="fp_mix"/><a data-primary="mixins" data-type="indexterm" id="mix_ab"/>You’ve heard about mixins and want to apply them in Java.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="fp-mixins-sect1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use static imports. Or, declare one or more functional interfaces with a default method containing the code to execute, and simply implement it.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="fp-mixins-sect1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Developers from other languages sometimes deride Java for its inability to handle mixins, the ability to mix in bits of code from other classes.</p>&#13;
&#13;
<p>One way to implement mixins is with the <a data-primary="static import feature" data-type="indexterm" id="idm45290658087688"/><em>static import</em> feature, which has been in the language for a decade. This is often done in unit testing (see <a data-type="xref" href="ch01.html#javacook-getstarted-junit">Recipe 1.10</a>). A limitation of this approach is that, as the name implies, the methods must be static methods, not instance methods.</p>&#13;
&#13;
<p>A newer mechanism depends on an interesting bit of fallout from the Java 8 language changes&#13;
in support of lambdas: you can now mix in code from unrelated places into one class.&#13;
Has Java finally abandoned its staunch opposition to multiple inheritance?&#13;
It may seem that way when you first hear it, but relax:&#13;
you can only pull methods from multiple interfaces, not from multiple classes.&#13;
If you didn’t know that you could have methods defined (rather than merely declared) in interfaces,&#13;
see <a data-type="xref" href="ch08.html#javacook-oo-SIDEBAR-1">“Subclass, Abstract Class, or Interface?”</a>. Consider the following example:</p>&#13;
&#13;
<p><em>main/src/main/java/lang/MixinsDemo.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">interface</code> <code class="nc">Bar</code> <code class="o">{</code>&#13;
    <code class="k">default</code> <code class="n">String</code> <code class="nf">filter</code><code class="o">(</code><code class="n">String</code> <code class="n">s</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="s">"Filtered "</code> <code class="o">+</code> <code class="n">s</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code>&#13;
&#13;
<code class="kd">interface</code> <code class="nc">Foo</code> <code class="o">{</code>&#13;
    <code class="k">default</code> <code class="n">String</code> <code class="nf">convolve</code><code class="o">(</code><code class="n">String</code> <code class="n">s</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="s">"Convolved "</code> <code class="o">+</code> <code class="n">s</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code>&#13;
&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">MixinsDemo</code> <code class="kd">implements</code> <code class="n">Foo</code><code class="o">,</code> <code class="n">Bar</code><code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">String</code> <code class="n">input</code> <code class="o">=</code> <code class="n">args</code><code class="o">.</code><code class="na">length</code> <code class="o">&gt;</code> <code class="mi">0</code> <code class="o">?</code> <code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code> <code class="o">:</code> <code class="s">"Hello"</code><code class="o">;</code>&#13;
        <code class="n">String</code> <code class="n">output</code> <code class="o">=</code> <code class="k">new</code> <code class="n">MixinsDemo</code><code class="o">().</code><code class="na">process</code><code class="o">(</code><code class="n">input</code><code class="o">);</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">output</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">private</code> <code class="n">String</code> <code class="nf">process</code><code class="o">(</code><code class="n">String</code> <code class="n">s</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="nf">filter</code><code class="o">(</code><code class="n">convolve</code><code class="o">(</code><code class="n">s</code><code class="o">));</code> <code class="c1">// methods mixed in!</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>If we run this, we see the expected results:</p>&#13;
&#13;
<pre data-type="programlisting">C:\javasrc&gt;javac -d build lang/MixinsDemo.java&#13;
C:\javasrc&gt;java -cp build lang.MixinsDemo&#13;
Filtered Convolved Hello&#13;
&#13;
C:\javasrc&gt;</pre>&#13;
&#13;
<p>Presto—Java now supports mixins!</p>&#13;
&#13;
<p>Does this mean you should go crazy trying to build interfaces with code in them? No. Remember this mechanism was designed to do the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Provide the notion of functional interfaces for use in lambda calculations.</p>&#13;
</li>&#13;
<li>&#13;
<p>Give the ability to retrofit interfaces with new methods, without having to change <em>old</em> implementations. As with many changes made in Java over the years, backward compatibility was a huge driver.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Used sparingly, functional interfaces can provide the ability to mix in code to build up applications in another way than direct inheritance, aggregation, or AOP. Overused, it can make your code heavy, drive pre–Java 8 developers crazy, and lead to chaos.<a data-primary="" data-startref="fp_mix" data-type="indexterm" id="idm45290657865656"/><a data-primary="" data-startref="mix_ab" data-type="indexterm" id="idm45290657864680"/><a data-primary="" data-startref="fp_ch" data-type="indexterm" id="idm45290657863736"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45290660939720"><sup><a href="ch09.html#idm45290660939720-marker">1</a></sup> Haskell was used to write a fairly complete Twitter clone in a few hundred lines; see <a href="https://github.com/Gabriel439/simple-twitter"><em class="hyperlink">https://github.com/Gabriel439/simple-twitter</em></a>.</p><p data-type="footnote" id="idm45290660596184"><sup><a href="ch09.html#idm45290660596184-marker">2</a></sup> If you ever have to do this kind of thing where the data is stored in a relational database using the Java Persistence API (JPA), you should check out the <a href="https://spring.io/projects/spring-data">Spring Data</a> or<a data-primary="Spring Framework" data-type="indexterm" id="idm45290660594520"/><a data-primary="Apache DeltaSpike" data-type="indexterm" id="idm45290660593784"/> <a href="http://deltaspike.apache.org">Apache DeltaSpike</a> frameworks. These allow you to define an <code>interface</code> with method names like <code>findCameraByInterchangeableTrueAndPriceLessThan(double price)</code> and have the framework implement these methods for you.</p><p data-type="footnote" id="idm45290660542184"><sup><a href="ch09.html#idm45290660542184-marker">3</a></sup> If you’re just not that into cameras, the description “Interchangeable Lens Camera (ILC)” includes two categories of what you might find in a camera store: traditional DSLR (Digital Single Lens Reflex) cameras, and the newer category of “Compact System Cameras” like the Nikon 1 and Z series, Sony ILCE (formerly known as NEX), and the Canon EOS-M, all of which are smaller and lighter than the older DSLRs.</p></div></div></section></body></html>