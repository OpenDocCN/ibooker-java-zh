<html><head></head><body><section data-pdf-bookmark="Chapter 14. Processing JSON Data" data-type="chapter" epub:type="chapter"><div class="chapter" id="javacook-json">&#13;
<h1><span class="label">Chapter 14. </span>Processing JSON Data</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.0 Introduction" data-type="sect1"><div class="sect1" id="javacook-json-intro">&#13;
<h1>14.0 Introduction</h1>&#13;
&#13;
<p><a data-primary="JSON" data-type="indexterm" id="json_ch"/><a data-primary="Java" data-secondary="JSON in" data-type="indexterm" id="java_json"/><a data-primary="JSON" data-secondary="in Java" data-type="indexterm" id="json_jav"/>JSON, or JavaScript Object Notation, is all of the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A simple, lightweight data interchange format.</p>&#13;
</li>&#13;
<li>&#13;
<p>A simpler, lighter alternative to XML.</p>&#13;
</li>&#13;
<li>&#13;
<p>Easy to generate with <a data-primary="println() method" data-type="indexterm" id="idm45290637086024"/><code>println()</code> or with one of several APIs.</p>&#13;
</li>&#13;
<li>&#13;
<p>Recognized directly by the JavaScript parser in all web browsers.</p>&#13;
</li>&#13;
<li>&#13;
<p>Supported with add-on frameworks for all common languages (Java, C/C++, Perl, Ruby, Python, Lua, Erlang, Haskell, to name a few); a ridiculously long list of supported languages (including two dozen parsers for Java alone) is right on the <a href="http://json.org">home page</a>.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>A simple JSON message might look like this:</p>&#13;
&#13;
<p><em>json/src/main/resources/json/softwareinfo.json/</em></p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code>&#13;
  <code class="nt">"name"</code><code class="p">:</code> <code class="s2">"robinparse"</code><code class="p">,</code>&#13;
  <code class="nt">"version"</code><code class="p">:</code> <code class="s2">"1.2.3"</code><code class="p">,</code>&#13;
  <code class="nt">"description"</code><code class="p">:</code> <code class="s2">"Another Parser for JSON"</code><code class="p">,</code>&#13;
  <code class="nt">"className"</code><code class="p">:</code> <code class="s2">"RobinParse"</code><code class="p">,</code>&#13;
  <code class="nt">"contributors"</code><code class="p">:</code> <code class="p">[</code>&#13;
        <code class="s2">"Robin Smythe"</code><code class="p">,</code>&#13;
        <code class="s2">"Jon Jenz"</code><code class="p">,</code>&#13;
        <code class="s2">"Jan Ardann"</code>&#13;
    <code class="p">]</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>As you can see, the syntax is simple, nestable, and amenable to human inspection.</p>&#13;
&#13;
<p><a href="http://json.org">The JSON home page</a> provides a concise summary of JSON syntax.&#13;
There are two kinds of structure: JSON objects (maps) and JSON arrays (lists).&#13;
JSON objects are sets of name and value pairs, which can be represented&#13;
either as a <code>java.util.Map</code> <em>or</em> as the properties of&#13;
a Java object. For example, the fields of a <code>LocalDate</code> (see <a data-type="xref" href="ch06.html#javacook-dates-SECT-1">Recipe 6.1</a>) object&#13;
for April 1, 2019, might be represented like this:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code>&#13;
	<code class="nt">"year"</code><code class="p">:</code> <code class="mi">2019</code><code class="p">,</code>&#13;
	<code class="nt">"month"</code><code class="p">:</code> <code class="mi">4</code><code class="p">,</code>&#13;
	<code class="nt">"day"</code> <code class="p">:</code> <code class="mi">1</code>&#13;
<code class="p">}</code></pre>&#13;
&#13;
<p>JSON arrays are ordered lists, represented in Java either as arrays or as <code>java.util.List</code>s.&#13;
A list of two dates might look like this:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code>&#13;
	<code class="err">[{</code>&#13;
		<code class="nt">"year"</code><code class="p">:</code> <code class="mi">2019</code><code class="p">,</code>&#13;
		<code class="nt">"month"</code><code class="p">:</code> <code class="mi">4</code><code class="p">,</code>&#13;
		<code class="nt">"day"</code> <code class="p">:</code> <code class="mi">1</code>&#13;
	<code class="p">}</code><code class="err">,</code><code class="p">{</code>&#13;
		<code class="nt">"year"</code><code class="p">:</code> <code class="mi">2019</code><code class="p">,</code>&#13;
		<code class="nt">"month"</code><code class="p">:</code> <code class="mi">5</code><code class="p">,</code>&#13;
		<code class="nt">"day"</code> <code class="p">:</code> <code class="mi">15</code>&#13;
	<code class="p">}</code><code class="err">]</code>&#13;
<code class="err">}</code></pre>&#13;
&#13;
<p>JSON is free-format, so the preceding could also be written, with some loss of human readability&#13;
but no loss of information or functionality, as this:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code><code class="err">[{</code><code class="nt">"year"</code><code class="p">:</code><code class="mi">2019</code><code class="p">,</code><code class="nt">"month"</code><code class="p">:</code><code class="mi">4</code><code class="p">,</code><code class="nt">"day"</code><code class="p">:</code><code class="mi">1</code><code class="p">}</code><code class="err">,</code><code class="p">{</code><code class="nt">"year"</code><code class="p">:</code><code class="mi">2019</code><code class="p">,</code><code class="nt">"month"</code><code class="p">:</code><code class="mi">5</code><code class="p">,</code><code class="nt">"day"</code><code class="p">:</code><code class="mi">15</code><code class="p">}</code><code class="err">]}</code></pre>&#13;
&#13;
<p>Hundreds of parsers have, I’m sure, been written for JSON. A few that come to mind in the Java world&#13;
include the following:</p>&#13;
<dl>&#13;
<dt><code>stringtree.org</code></dt>&#13;
<dd>&#13;
<p>Very small and lightweight</p>&#13;
</dd>&#13;
<dt><code>json.org parser</code></dt>&#13;
<dd>&#13;
<p>Widely used because it’s free and has a good domain name</p>&#13;
</dd>&#13;
<dt><code>jackson.org parser</code></dt>&#13;
<dd>&#13;
<p>Widely used because it’s very powerful and used with Spring Framework and&#13;
with JBoss RESTEasy and Wildfly</p>&#13;
</dd>&#13;
<dt><code>javax.json</code></dt>&#13;
<dd>&#13;
<p>Oracle’s official but currently EE-only standard</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>This chapter shows several ways of processing JSON data using some of the various APIs just listed.&#13;
The official <code>javax.json</code> API is only included in the Java EE, not the Java SE,&#13;
so it is unlikely to see very much use on the client side.&#13;
This API uses some names in common with the <code>org.json</code> API, but not enough to be considered <span class="keep-together">compatible.</span></p>&#13;
&#13;
<p>Because this is a book for client-side Java developers, nothing will be made of the ability&#13;
to process JSON directly in server-generated, browser-based JavaScript, though this&#13;
can be very useful in building enterprise applications.<a data-primary="" data-startref="jav_json" data-type="indexterm" id="idm45290636841176"/><a data-primary="" data-startref="json_jav" data-type="indexterm" id="idm45290636840200"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.1 Generating JSON Directly" data-type="sect1"><div class="sect1" id="javacook-json-gendirectly-1">&#13;
<h1>14.1 Generating JSON Directly</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-json-gendirectly-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="JSON" data-secondary="generating" data-type="indexterm" id="idm45290636836376"/>You want to generate JSON without bothering to use an API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-json-gendirectly-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Get the data you want, and use <a data-primary="println() method" data-type="indexterm" id="idm45290636833432"/><code>println()</code> or <code>String.format()</code> as appropriate.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-json-gendirectly-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>If you are careful, you can generate JSON data yourself. For the utterly trivial cases,&#13;
you can just use <code>PrintWriter.println()</code> or <code>String.format()</code>.&#13;
For significant volumes, however, it’s usually better to use one of the APIs.</p>&#13;
&#13;
<p>This code prints the year, month, and date from a <code>LocalTime</code> object (see <a data-type="xref" href="ch06.html#javacook-dates-SECT-1">Recipe 6.1</a>).&#13;
Some of the JSON formatting is delegated to the <code>toJson()</code> method:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Convert an object to JSON, not using any JSON API.</code>&#13;
<code class="cm"> * BAD IDEA - should use an API!</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">LocalDateToJsonManually</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">OPEN</code> <code class="o">=</code> <code class="s">"{"</code><code class="o">;</code>&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">CLOSE</code> <code class="o">=</code> <code class="s">"}"</code><code class="o">;</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">LocalDate</code> <code class="n">dNow</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">();</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">toJson</code><code class="o">(</code><code class="n">dNow</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="n">String</code> <code class="nf">toJson</code><code class="o">(</code><code class="n">LocalDate</code> <code class="n">dNow</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">StringBuilder</code> <code class="n">sb</code> <code class="o">=</code> <code class="k">new</code> <code class="n">StringBuilder</code><code class="o">();</code>&#13;
        <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="n">OPEN</code><code class="o">).</code><code class="na">append</code><code class="o">(</code><code class="s">"\n"</code><code class="o">);</code>&#13;
        <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="n">jsonize</code><code class="o">(</code><code class="s">"year"</code><code class="o">,</code> <code class="n">dNow</code><code class="o">.</code><code class="na">getYear</code><code class="o">()));</code>&#13;
        <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="n">jsonize</code><code class="o">(</code><code class="s">"month"</code><code class="o">,</code> <code class="n">dNow</code><code class="o">.</code><code class="na">getMonth</code><code class="o">()));</code>&#13;
        <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="n">jsonize</code><code class="o">(</code><code class="s">"day"</code><code class="o">,</code> <code class="n">dNow</code><code class="o">.</code><code class="na">getDayOfMonth</code><code class="o">()));</code>&#13;
        <code class="n">sb</code><code class="o">.</code><code class="na">append</code><code class="o">(</code><code class="n">CLOSE</code><code class="o">).</code><code class="na">append</code><code class="o">(</code><code class="s">"\n"</code><code class="o">);</code>&#13;
        <code class="k">return</code> <code class="n">sb</code><code class="o">.</code><code class="na">toString</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="n">String</code> <code class="nf">jsonize</code><code class="o">(</code><code class="n">String</code> <code class="n">key</code><code class="o">,</code> <code class="n">Object</code> <code class="n">value</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">String</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"\"%s\": \"%s\",\n"</code><code class="o">,</code> <code class="n">key</code><code class="o">,</code> <code class="n">value</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Of course, this is an extremely trivial example. For anything more involved,&#13;
or for the common case of having to parse JSON objects, using one of the&#13;
frameworks will be easier on your nerves.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.2 Parsing and Writing JSON with Jackson" data-type="sect1"><div class="sect1" id="javacook-json-jackson-1">&#13;
<h1>14.2 Parsing and Writing JSON with Jackson</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-json-jackson-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Jackson" data-type="indexterm" id="idm45290636647864"/><a data-primary="JSON" data-secondary="Jackson" data-type="indexterm" id="idm45290636647160"/>You want to read and/or write JSON using a full-function JSON API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-json-jackson-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use Jackson, the full-blown JSON API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-json-jackson-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Jackson provides many ways of working. For simple cases, you can have&#13;
POJO (Plain Old Java Objects) converted to/from JSON more or less automatically,&#13;
as is illustrated in <a data-type="xref" href="#javacook-json-jackson-readwrite">Example 14-1</a>.</p>&#13;
<div data-type="example" id="javacook-json-jackson-readwrite">&#13;
<h5><span class="label">Example 14-1. </span>json/src/main/java/json/ReadWriteJackson.java (reading and writing POJOs with Jackson)</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">ReadWriteJackson</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">IOException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">ObjectMapper</code><code> </code><code class="n">mapper</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ObjectMapper</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>                </code><a class="co" href="#callout_processing_json_data_CO1-1" id="co_processing_json_data_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">jsonInput</code><code> </code><code class="o">=</code><code>                                       </code><a class="co" href="#callout_processing_json_data_CO1-2" id="co_processing_json_data_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>                </code><code class="s">"{\"id\":0,\"firstName\":\"Robin\",\"lastName\":\"Wilson\"}"</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">Person</code><code> </code><code class="n">q</code><code> </code><code class="o">=</code><code> </code><code class="n">mapper</code><code class="o">.</code><code class="na">readValue</code><code class="o">(</code><code class="n">jsonInput</code><code class="o">,</code><code> </code><code class="n">Person</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Read and parsed Person from JSON: "</code><code> </code><code class="o">+</code><code> </code><code class="n">q</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">Person</code><code> </code><code class="n">p</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Person</code><code class="o">(</code><code class="s">"Roger"</code><code class="o">,</code><code> </code><code class="s">"Rabbit"</code><code class="o">)</code><code class="o">;</code><code>                </code><a class="co" href="#callout_processing_json_data_CO1-3" id="co_processing_json_data_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="s">"Person object "</code><code> </code><code class="o">+</code><code> </code><code class="n">p</code><code> </code><code class="o">+</code><code class="s">" as JSON = "</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">mapper</code><code class="o">.</code><code class="na">writeValue</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">,</code><code> </code><code class="n">p</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_processing_json_data_CO1-1" id="callout_processing_json_data_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create a Jackson <code>ObjectMapper</code> that can map POJOs to/from JSON.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO1-2" id="callout_processing_json_data_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Map the string <code>jsonInput</code> into a <code>Person</code> object with one call to <code>readValue()</code>.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO1-3" id="callout_processing_json_data_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Convert the <code>Person</code> object <code>p</code> into JSON with one call to <code>writeValue()</code>.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Running this example produces the following output:</p>&#13;
&#13;
<pre data-type="programlisting">Read and parsed Person from JSON: Robin Wilson&#13;
Person object Roger Rabbit as JSON = {"id":0,"firstName":"Roger",&#13;
	"lastName":"Rabbit","name":"Roger Rabbit"}</pre>&#13;
&#13;
<p>As another example, this code reads the example file that opened this chapter (which happens to have been a description of a JSON parser). Notice the declaration <code>List&lt;String&gt;</code> for the&#13;
array of contributors:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">SoftwareParseJackson</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="kd">final</code><code> </code><code class="kd">static</code><code> </code><code class="n">String</code><code> </code><code class="n">FILE_NAME</code><code> </code><code class="o">=</code><code> </code><code class="s">"/json/softwareinfo.json"</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">Exception</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">ObjectMapper</code><code> </code><code class="n">mapper</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ObjectMapper</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_processing_json_data_CO2-1" id="co_processing_json_data_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">InputStream</code><code> </code><code class="n">jsonInput</code><code> </code><code class="o">=</code><code>&#13;
</code><code>            </code><code class="n">SoftwareParseJackson</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getResourceAsStream</code><code class="o">(</code><code class="n">FILE_NAME</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">jsonInput</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>            </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nf">NullPointerException</code><code class="o">(</code><code class="s">"can't find "</code><code> </code><code class="o">+</code><code> </code><code class="n">FILE_NAME</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>        </code><code class="n">SoftwareInfo</code><code> </code><code class="n">sware</code><code> </code><code class="o">=</code><code> </code><code class="n">mapper</code><code class="o">.</code><code class="na">readValue</code><code class="o">(</code><code class="n">jsonInput</code><code class="o">,</code><code> </code><code class="n">SoftwareInfo</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">sware</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_processing_json_data_CO2-1" id="callout_processing_json_data_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The <code>ObjectMapper</code> does the actual parsing of the JSON input.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Running this example produces the following output:</p>&#13;
&#13;
<pre data-type="programlisting">Software: robinparse (1.2.3) by [Robin Smythe, Jon Jenz, Jan Ardann]</pre>&#13;
&#13;
<p>Of course there are cases where the mapping gets more involved; for this purpose, Jackson&#13;
provides a set of annotations to control the mapping. But the default mapping is pretty good!</p>&#13;
&#13;
<p>There is also a streaming API for Jackson; refer to the website for details.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.3 Parsing and Writing JSON with org.json" data-type="sect1"><div class="sect1" id="javacook-json-org.json-1">&#13;
<h1>14.3 Parsing and Writing JSON with org.json</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-json-org.json-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="JSON" data-secondary="org.json" data-type="indexterm" id="json_org"/><a data-primary="org.json" data-type="indexterm" id="org_ab"/>You want to read/write JSON using a midsized, widely used JSON API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-json-org.json-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Consider using the org.json API , also known as JSON-Java; it’s widely used and is also used in Android.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-json-org.json-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <em>org.json</em> package is not as advanced as Jackson, nor as high level; it makes&#13;
you think and work in terms of the underlying JSON abstractions instead of at the Java code level.&#13;
For example, here is the <em>org.json</em> version of reading the software description from the opening&#13;
of this chapter:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">SoftwareParseOrgJson</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="kd">final</code><code> </code><code class="kd">static</code><code> </code><code class="n">String</code><code> </code><code class="n">FILE_NAME</code><code> </code><code class="o">=</code><code> </code><code class="s">"/json/softwareinfo.json"</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">Exception</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">InputStream</code><code> </code><code class="n">jsonInput</code><code> </code><code class="o">=</code><code>&#13;
</code><code>            </code><code class="n">SoftwareParseOrgJson</code><code class="o">.</code><code class="na">class</code><code class="o">.</code><code class="na">getResourceAsStream</code><code class="o">(</code><code class="n">FILE_NAME</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">jsonInput</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>            </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nf">NullPointerException</code><code class="o">(</code><code class="s">"can't find"</code><code> </code><code class="o">+</code><code> </code><code class="n">FILE_NAME</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>        </code><code class="n">JSONObject</code><code> </code><code class="n">obj</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">JSONObject</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">JSONTokener</code><code class="o">(</code><code class="n">jsonInput</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>      </code><a class="co" href="#callout_processing_json_data_CO3-1" id="co_processing_json_data_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Software Name: "</code><code> </code><code class="o">+</code><code> </code><code class="n">obj</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"name"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>    </code><a class="co" href="#callout_processing_json_data_CO3-2" id="co_processing_json_data_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Version: "</code><code> </code><code class="o">+</code><code> </code><code class="n">obj</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"version"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Description: "</code><code> </code><code class="o">+</code><code> </code><code class="n">obj</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"description"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Class: "</code><code> </code><code class="o">+</code><code> </code><code class="n">obj</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"className"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">JSONArray</code><code> </code><code class="n">contribs</code><code> </code><code class="o">=</code><code> </code><code class="n">obj</code><code class="o">.</code><code class="na">getJSONArray</code><code class="o">(</code><code class="s">"contributors"</code><code class="o">)</code><code class="o">;</code><code>            </code><a class="co" href="#callout_processing_json_data_CO3-3" id="co_processing_json_data_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="k">for</code><code> </code><code class="o">(</code><code class="kt">int</code><code> </code><code class="n">i</code><code> </code><code class="o">=</code><code> </code><code class="mi">0</code><code class="o">;</code><code> </code><code class="n">i</code><code> </code><code class="o">&lt;</code><code> </code><code class="n">contribs</code><code class="o">.</code><code class="na">length</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><code class="n">i</code><code class="o">+</code><code class="o">+</code><code class="o">)</code><code> </code><code class="o">{</code><code>                     </code><a class="co" href="#callout_processing_json_data_CO3-4" id="co_processing_json_data_CO3-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>            </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Contributor Name: "</code><code> </code><code class="o">+</code><code> </code><code class="n">contribs</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">i</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_processing_json_data_CO3-1" id="callout_processing_json_data_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create the <code>JSONObject</code> from the input.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO3-2" id="callout_processing_json_data_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Retrieve individual <code>String</code> fields.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO3-3" id="callout_processing_json_data_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Retrieve the <code>JSONArray</code> of contributor names.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO3-4" id="callout_processing_json_data_CO3-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p><code>org.json.JSONArray</code> doesn’t implement <code>Iterable</code>, so you can’t use a <code>forEach</code> loop.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Running it produces the expected output:</p>&#13;
&#13;
<pre data-type="programlisting">Software Name: robinparse&#13;
Version: 1.2.3&#13;
Description: Another Parser for JSON&#13;
Class: RobinParse&#13;
Contributor Name: Robin Smythe&#13;
Contributor Name: Jon Jenz&#13;
Contributor Name: Jan Ardann</pre>&#13;
&#13;
<p><code>JSONObject</code> and <code>JSONArray</code> use their <a data-primary="toString() method" data-type="indexterm" id="idm45290636277672"/><code>toString()</code> method to produce (correctly formatted) JSON strings, like this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">WriteOrgJson</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">JSONObject</code><code> </code><code class="n">jsonObject</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">JSONObject</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">jsonObject</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"Name"</code><code class="o">,</code><code> </code><code class="s">"robinParse"</code><code class="o">)</code><code class="o">.</code><code>        </code><a class="co" href="#callout_processing_json_data_CO4-1" id="co_processing_json_data_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>            </code><code class="n">put</code><code class="o">(</code><code class="s">"Version"</code><code class="o">,</code><code> </code><code class="s">"1.2.3"</code><code class="o">)</code><code class="o">.</code><code>&#13;
</code><code>            </code><code class="n">put</code><code class="o">(</code><code class="s">"Class"</code><code class="o">,</code><code> </code><code class="s">"RobinParse"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">printable</code><code> </code><code class="o">=</code><code> </code><code class="n">jsonObject</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>    </code><a class="co" href="#callout_processing_json_data_CO4-2" id="co_processing_json_data_CO4-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">printable</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_processing_json_data_CO4-1" id="callout_processing_json_data_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Nice that it offers a fluent API to allow chaining of method calls.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO4-2" id="callout_processing_json_data_CO4-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p><code>toString()</code> converts to textual JSON representation.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Running this produces the following:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code><code class="nt">"Name"</code><code class="p">:</code><code class="s2">"robinParse"</code><code class="p">,</code><code class="nt">"Class"</code><code class="p">:</code><code class="s2">"RobinParse"</code><code class="p">,</code><code class="nt">"Version"</code><code class="p">:</code><code class="s2">"1.2.3"</code><code class="p">}</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290636385768">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>The org.json library code including its javadoc documentation is online at <a href="https://github.com/stleary/JSON-java"><em class="hyperlink">https://github.com/stleary/JSON-java</em></a>.<a data-primary="" data-startref="json_org" data-type="indexterm" id="idm45290635796536"/><a data-primary="" data-startref="org_ab" data-type="indexterm" id="idm45290635795592"/> (under the name JSON-java to differentiate it from the other packages).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.4 Parsing and Writing JSON with JSON-B" data-type="sect1"><div class="sect1" id="javacook-json-jsonb">&#13;
<h1>14.4 Parsing and Writing JSON with JSON-B</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290635792776">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="JSON" data-secondary="JSON-B" data-type="indexterm" id="idm45290635785768"/><a data-primary="JSON-B" data-type="indexterm" id="idm45290635784904"/>You want to read/write JSON using a midsized, standards-conforming JSON API.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290635783848">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Consider using JSON-B, the new Java standard (JSR-367).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290635782296">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The JSON-B (JSON Binding) API is designed to make it simple to read/write Java POJOs.&#13;
This is neatly illustrated by the code in <a data-type="xref" href="#javacook-json-jsonb-code1">Example 14-2</a>.</p>&#13;
<div data-type="example" id="javacook-json-jsonb-code1">&#13;
<h5><span class="label">Example 14-2. </span>json/src/main/java/json/ReadWriteJsonB.java (reading/writing JSON with JSON-B)</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">ReadWriteJsonB</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">IOException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">Jsonb</code><code> </code><code class="n">jsonb</code><code> </code><code class="o">=</code><code> </code><code class="n">JsonbBuilder</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>            </code><a class="co" href="#callout_processing_json_data_CO5-1" id="co_processing_json_data_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1">// Read&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">jsonInput</code><code> </code><code class="o">=</code><code>                              </code><a class="co" href="#callout_processing_json_data_CO5-2" id="co_processing_json_data_CO5-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>                </code><code class="s">"{\"id\":0,\"firstName\":\"Robin\",\"lastName\":\"Williams\"}"</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">Person</code><code> </code><code class="n">rw</code><code> </code><code class="o">=</code><code> </code><code class="n">jsonb</code><code class="o">.</code><code class="na">fromJson</code><code class="o">(</code><code class="n">jsonInput</code><code class="o">,</code><code> </code><code class="n">Person</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">rw</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">result</code><code> </code><code class="o">=</code><code> </code><code class="n">jsonb</code><code class="o">.</code><code class="na">toJson</code><code class="o">(</code><code class="n">rw</code><code class="o">)</code><code class="o">;</code><code>                </code><a class="co" href="#callout_processing_json_data_CO5-3" id="co_processing_json_data_CO5-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">result</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_processing_json_data_CO5-1" id="callout_processing_json_data_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create a <code>Jsonb</code> object, your gateway to JSON-B services.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO5-2" id="callout_processing_json_data_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Obtain a JSON string, and convert it to a Java object using <code>jsonb.fromJson()</code>.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO5-3" id="callout_processing_json_data_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Convert a <code>Person</code> object back to a JSON string using the inverse <code>jsonb.toJson()</code>.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Note that the methods are sensibly named and that no annotations are needed on the Java&#13;
entity class to make this work.&#13;
However, there is an API that allows us to customize it.&#13;
For example, the <code>fullName</code> property is really just a convenience for concatenating&#13;
the first name and last name with a space between.&#13;
As such, it’s completely redundant and does not need to be transmitted over a JSON network stream.&#13;
However, running the program produces this output:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code><code class="nt">"firstName"</code><code class="p">:</code><code class="s2">"Robin"</code><code class="p">,</code><code class="nt">"fullName"</code><code class="p">:</code><code class="s2">"Robin Williams"</code><code class="p">,</code><code class="nt">"id"</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code><code class="nt">"lastName"</code><code class="p">:</code><code class="s2">"Williams"</code><code class="p">}</code></pre>&#13;
&#13;
<p>We need only add the <code>@JsonbTransient</code> annotation to the <code>getFullName()</code> accessor&#13;
in the <code>Person</code> class to eliminate the redundancy; running the program now&#13;
produces this smaller output:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code><code class="nt">"firstName"</code><code class="p">:</code><code class="s2">"Robin"</code><code class="p">,</code><code class="nt">"id"</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code><code class="nt">"lastName"</code><code class="p">:</code><code class="s2">"Williams"</code><code class="p">}</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290635781960">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>As with most other JSON APIs, there is full support for customization,&#13;
ranging from the simple annotation shown here up to writing complete&#13;
custom serializer/deserializer helpers.&#13;
See <a href="https://javaee.github.io/jsonb-spec">the JSON-B spec page</a>,&#13;
the <a href="http://json-b.net">JSON-B home page</a>,&#13;
and <a href="https://www.baeldung.com/java-json-binding-api">this longer tutorial online</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="14.5 Finding JSON Elements with JSON Pointer" data-type="sect1"><div class="sect1" id="javacook-json-pointer">&#13;
<h1>14.5 Finding JSON Elements with JSON Pointer</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290635577672">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="JSON" data-secondary="JSON-Pointer" data-type="indexterm" id="json_jsonp"/><a data-primary="JSON-Pointer" data-type="indexterm" id="jsonp_ab"/>You have a JSON document and want to extract only selected values from it.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290635545432">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>javax.json</code>’s implementation of <em>JSON Pointer</em>, the standard API for extracting selected elements from JSON.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290635542984">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><a href="https://tools.ietf.org/html/rfc6901">The Internet Standard RFC 6901</a> spells out in detail&#13;
the syntax for JSON Pointer, a language-independent syntax for matching elements in JSON documents.&#13;
Obviously inspired by the XML syntax XPath, JSON Pointer is a bit simpler than XPath&#13;
because of JSON’s inherent simpllicity. Basically a JSON Pointer is a string that identifies&#13;
an element (either simple or array) within a JSON document.&#13;
The <code>javax.json</code> package provides an object model API somewhat similar to&#13;
the XML DOM API for Java, letting you create immutable objects to represent&#13;
objects (via <code>JsonObjectBuilder</code> and <code>JsonArrayBuilder</code>) or to read them&#13;
from JSON string format via a <code>Reader</code> or <code>InputStream</code>.</p>&#13;
&#13;
<p>JSON Pointers begin with a “/” (inherited from XPath), followed by the name of the element or&#13;
subelement we want to look for.&#13;
Suppose we extend our <code>Person</code> example from <a data-type="xref" href="#javacook-json-jsonb-code1">Example 14-2</a> to add an array of roles the comedian played, looking like this:</p>&#13;
&#13;
<pre data-code-language="json" data-type="programlisting"><code class="p">{</code><code class="nt">"firstName"</code><code class="p">:</code><code class="s2">"Robin"</code><code class="p">,</code><code class="nt">"lastName"</code><code class="p">:</code><code class="s2">"Williams"</code><code class="p">,</code>&#13;
	<code class="nt">"age"</code><code class="p">:</code> <code class="mi">63</code><code class="p">,</code><code class="nt">"id"</code><code class="p">:</code><code class="mi">0</code><code class="p">,</code>&#13;
	<code class="nt">"roles"</code><code class="p">:[</code><code class="s2">"Mork"</code><code class="p">,</code> <code class="s2">"Mrs. Doubtfire"</code><code class="p">,</code> <code class="s2">"Patch Adams"</code><code class="p">]}</code></pre>&#13;
&#13;
<p>Then the following JSON Pointers should generate the given matches:</p>&#13;
&#13;
<pre data-type="programlisting">/firstName =&gt; Robin&#13;
/age =&gt; 63&#13;
/roles =&gt; ["Mork","Mrs. Doubtfire","Patch Adams"]&#13;
/roles/1 =&gt; "Mrs. Doubtfire"</pre>&#13;
&#13;
<p>The program in <a data-type="xref" href="#javacook-json-jsonpointer-1">Example 14-3</a> demonstrates this.</p>&#13;
<div data-type="example" id="javacook-json-jsonpointer-1">&#13;
<h5><span class="label">Example 14-3. </span>json/src/main/java/json/JsonPointerDemo.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">JsonPointerDemo</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">jsonPerson</code><code> </code><code class="o">=</code><code>&#13;
</code><code>            </code><code class="s">"{\"firstName\":\"Robin\",\"lastName\":\"Williams\","</code><code> </code><code class="o">+</code><code>&#13;
</code><code>                </code><code class="s">"\"age\": 63,"</code><code> </code><code class="o">+</code><code>&#13;
</code><code>                </code><code class="s">"\"id\":0,"</code><code> </code><code class="o">+</code><code>&#13;
</code><code>                </code><code class="s">"\"roles\":[\"Mork\", \"Mrs. Doubtfire\", \"Patch Adams\"]}"</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Input: "</code><code> </code><code class="o">+</code><code> </code><code class="n">jsonPerson</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">JsonReader</code><code> </code><code class="n">rdr</code><code> </code><code class="o">=</code><code>&#13;
</code><code>                </code><code class="n">Json</code><code class="o">.</code><code class="na">createReader</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">StringReader</code><code class="o">(</code><code class="n">jsonPerson</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>       </code><a class="co" href="#callout_processing_json_data_CO6-1" id="co_processing_json_data_CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">JsonStructure</code><code> </code><code class="n">jsonStr</code><code> </code><code class="o">=</code><code> </code><code class="n">rdr</code><code class="o">.</code><code class="na">read</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">rdr</code><code class="o">.</code><code class="na">close</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">JsonPointer</code><code> </code><code class="n">jsonPointer</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">JsonString</code><code> </code><code class="n">jsonString</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">jsonPointer</code><code> </code><code class="o">=</code><code> </code><code class="n">Json</code><code class="o">.</code><code class="na">createPointer</code><code class="o">(</code><code class="s">"/firstName"</code><code class="o">)</code><code class="o">;</code><code>                </code><a class="co" href="#callout_processing_json_data_CO6-2" id="co_processing_json_data_CO6-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">jsonString</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">JsonString</code><code class="o">)</code><code class="n">jsonPointer</code><code class="o">.</code><code class="na">getValue</code><code class="o">(</code><code class="n">jsonStr</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">firstName</code><code> </code><code class="o">=</code><code> </code><code class="n">jsonString</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"/firstName =&gt; "</code><code> </code><code class="o">+</code><code> </code><code class="n">firstName</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">JsonNumber</code><code> </code><code class="n">num</code><code> </code><code class="o">=</code><code>                                               </code><a class="co" href="#callout_processing_json_data_CO6-3" id="co_processing_json_data_CO6-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>                </code><code class="o">(</code><code class="n">JsonNumber</code><code class="o">)</code><code> </code><code class="n">Json</code><code class="o">.</code><code class="na">createPointer</code><code class="o">(</code><code class="s">"/age"</code><code class="o">)</code><code class="o">.</code><code class="na">getValue</code><code class="o">(</code><code class="n">jsonStr</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"/age =&gt; "</code><code> </code><code class="o">+</code><code> </code><code class="n">num</code><code> </code><code class="o">+</code><code> </code><code class="s">"; a "</code><code> </code><code class="o">+</code><code> </code><code class="n">num</code><code class="o">.</code><code class="na">getClass</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getName</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">jsonPointer</code><code> </code><code class="o">=</code><code> </code><code class="n">Json</code><code class="o">.</code><code class="na">createPointer</code><code class="o">(</code><code class="s">"/roles"</code><code class="o">)</code><code class="o">;</code><code>                    </code><a class="co" href="#callout_processing_json_data_CO6-4" id="co_processing_json_data_CO6-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="n">JsonArray</code><code> </code><code class="n">roles</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">JsonArray</code><code class="o">)</code><code> </code><code class="n">jsonPointer</code><code class="o">.</code><code class="na">getValue</code><code class="o">(</code><code class="n">jsonStr</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"/roles =&gt; "</code><code> </code><code class="o">+</code><code> </code><code class="n">roles</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"JsonArray roles.get(1) =&gt; "</code><code> </code><code class="o">+</code><code> </code><code class="n">roles</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">1</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">jsonPointer</code><code> </code><code class="o">=</code><code> </code><code class="n">Json</code><code class="o">.</code><code class="na">createPointer</code><code class="o">(</code><code class="s">"/roles/1"</code><code class="o">)</code><code class="o">;</code><code>                  </code><a class="co" href="#callout_processing_json_data_CO6-5" id="co_processing_json_data_CO6-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>        </code><code class="n">jsonString</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">JsonString</code><code class="o">)</code><code class="n">jsonPointer</code><code class="o">.</code><code class="na">getValue</code><code class="o">(</code><code class="n">jsonStr</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"/roles/1 =&gt; "</code><code> </code><code class="o">+</code><code> </code><code class="n">jsonString</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_processing_json_data_CO6-1" id="callout_processing_json_data_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Create the <code>JsonStructure</code>, the gateway into this API, from a <code>JsonReader</code>, using a <code>StringReader</code>.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO6-2" id="callout_processing_json_data_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Create a JSON Pointer for the <code>firstName</code> element, and get the <code>JsonString</code> from the element’s value.&#13;
Since <code>getValue()</code> will throw an exception if the element is not found, use&#13;
<code>jsonPointer.containsValue(jsonStr)</code> to check first, if not sure if the element will be found.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO6-3" id="callout_processing_json_data_CO6-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Same for <code>age</code>, but using more fluent syntax.&#13;
If you print the class name for the match in <code>/age</code>, it will report an&#13;
implementation-specific implementation class, such as&#13;
<code>org.glassfish.json.JsonNumberImpl$JsonIntNumber</code>.&#13;
Change the age in the XML from 63 to 63.5 and it will print a class with <code>BigDecimal</code> in its name.&#13;
Either way, <code>toString()</code> on this object will return just the numeric value.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO6-4" id="callout_processing_json_data_CO6-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>In the JSON file, <code>roles</code> is an array. Thus, getting it using a JSON Pointer&#13;
should return a <code>JsonArray</code> object, so we cast it to a reference of that type.&#13;
This behaves somewhat like an immutable <code>List</code> implementation, so we call <code>get()</code>.&#13;
JSON array indices start at zero, as in Java.</p></dd>&#13;
<dt><a class="co" href="#co_processing_json_data_CO6-5" id="callout_processing_json_data_CO6-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Retrieve the same array element directly, using a pattern with “/1” to mean&#13;
the numbered element in the array.</p></dd>&#13;
</dl>&#13;
&#13;
<p>It is possible (but fortunately not common) for a JSON element name to contain special&#13;
characters such as a slash. Most characters are not special to&#13;
JSON Pointer, but to match a name containing a slash (<em>/</em>),&#13;
the slash must be entered as <em>~1</em>, and since that makes the<a data-primary="tilde characters" data-type="indexterm" id="idm45290635087032"/>&#13;
tilde (<em>~</em>) special, tilde characters must be entered as <em>~0</em>.&#13;
Thus if the Person JSON file had an element like <code>"ft/pt/~"</code>,&#13;
you would look for it with <code>Json.createPointer("/ft~1pt~1~0");</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290635542360">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>The JSON Pointer API has additional methods that let you modify values and add/remove elements.&#13;
The offical home page for <code>javax.json</code>, which includes JSON Pointer, is at&#13;
<a href="https://jakarta.ee/specifications/jsonp/1.1"><em>jakarta.ee</em></a>.&#13;
The javadoc for <code>javax.json</code> is linked to from that page.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Summary" data-type="sect2"><div class="sect2" id="idm45290635081832">&#13;
<h2>Summary</h2>&#13;
&#13;
<p>Many APIs exist for Java. Jackson is the biggest and most powerful;&#13;
org.json, javax.json, and JSON-B are in the middle and StringTree (which I&#13;
didn’t give an example of because it doesn’t have a Maven Artifact&#13;
available) is the smallest.  For a list of these and other JSON&#13;
APIs, consult <a href="https://www.json.org/json-en.html"><em class="hyperlink">https://www.json.org/json-en.html</em></a> and scroll past&#13;
the syntax summary.<a data-primary="" data-startref="json_jsonp" data-type="indexterm" id="idm45290635079400"/><a data-primary="" data-startref="jsonp_ab" data-type="indexterm" id="idm45290635078552"/><a data-primary="" data-startref="json_ch" data-type="indexterm" id="idm45290635077704"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>