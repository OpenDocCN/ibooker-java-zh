<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 2. The Path to Cloud Native Java"><div class="chapter" id="changing_technologies">
<h1><span class="label">Chapter 2. </span>The Path to Cloud Native Java</h1>


<p>“Πάντα ῥεῖ” (Panta rei) is a famous aphorism from philosopher Heraclitus that describes the mutable condition of our existence where everything flows, where our call is to react and adapt. This perfectly describes the right approach to the evolution we are experiencing in the IT world in general, and specifically with programming languages and frameworks, where heterogeneous, distributed, multicloud workloads are more common and essential for business purposes.</p>

<p>Java and Jakarta EE (formely known as Java EE), are evolving as well in that direction, balancing the benefits that come from the consolidated experience of enterprise solutions, together with the need for a fast-changing cloud-aware scenario where our applications can run in many clouds seamlessly. In this chapter, we will outline the components needed for a transition to cloud native Java, walking you through an ecommerce store Java implementation called Coolstore.</p>






<section data-type="sect1" data-pdf-bookmark="Cloud Native Workshop"><div class="sect1" id="idm45261458516784">
<h1>Cloud Native Workshop</h1>

<p>Microservices are an accepted and well-recognized practice nowadays. For JavaEE developers, this means a lift-and-shift change of the paradigm, where a single application server does not contain all our business logic. Instead, it gets split into different microservices running in their application servers, like Tomcat or Undertow, with a minimal footprint and optimizations to keep this coexistence functional and performant also in the cloud native world.</p>

<p>The monolithic approach today can be refactored into a heterogeneous and even programming language agnostic model, where each module is managed by a specific component running in a different application. Beyond the best practices such as API-driven models, the challenge here is how to maintain this diversity. However, Java today provides a set of tools and frameworks that help us focus on our preferred tools and collaborate easily. In this chapter, you will learn how to develop and deploy a microservices-based application split across different Java frameworks.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Architecture"><div class="sect1" id="idm45261458513728">
<h1>Architecture</h1>

<p>Our ecommerce application Coolstore <a data-type="indexterm" data-primary="Coolstore" id="idm45261458512160"/>is a typical web app containing three 
<span class="keep-together">components</span>:</p>
<dl>
<dt>Presentation layer</dt>
<dd>
<p>a frontend to <a data-type="indexterm" data-primary="web apps" data-secondary="Presentation layer" id="idm45261458508864"/><a data-type="indexterm" data-primary="Presentation layer" id="idm45261458507856"/>show available items to acquire</p>
</dd>
<dt>Model layer</dt>
<dd>
<p>a backend providing <a data-type="indexterm" data-primary="web apps" data-secondary="Model layer" id="idm45261458505776"/><a data-type="indexterm" data-primary="Model layer" id="idm45261458504768"/>the business logic to catalog and index all items to sell</p>
</dd>
<dt>Data layer</dt>
<dd>
<p>a database <a data-type="indexterm" data-primary="web apps" data-secondary="Data layer" id="idm45261458502688"/><a data-type="indexterm" data-primary="Data layer" id="idm45261458501680"/>storing all records about transactions and items</p>
</dd>
</dl>

<p>The outcome of these components is an online store with a catalog of product items and an inventory of stock that we can organize with the architecture shown in <a data-type="xref" href="#fig2-1">Figure 2-1</a>.</p>

<figure><div id="fig2-1" class="figure">
<img src="Images/moej_0201.png" alt="Coolstore Architecture" width="337" height="479"/>
<h6><span class="label">Figure 2-1. </span>Coolstore architecture</h6>
</div></figure>

<p>We map the three previously mentioned components into several microservices, each one responsible for its layer:</p>

<ul>
<li>
<p><em>Catalog Service</em> uses a REST API to expose <a data-type="indexterm" data-primary="microservices" data-secondary="Catalog Service" id="idm45261458495472"/><a data-type="indexterm" data-primary="Catalog Service" id="idm45261458494496"/>the content of a catalog stored in a relational database.</p>
</li>
<li>
<p><em>Inventory Service</em> uses a REST API to expose the <a data-type="indexterm" data-primary="microservices" data-secondary="Inventory service" id="idm45261458492528"/><a data-type="indexterm" data-primary="Inventory service" id="idm45261458491552"/>inventory of items stored in a relational database.</p>
</li>
<li>
<p><em>Gateway Service</em> calls <a data-type="indexterm" data-primary="microservices" data-secondary="Gateway service" id="idm45261458489632"/><a data-type="indexterm" data-primary="Gateway service" id="idm45261458488624"/>the <em>Catalog Service</em> and <em>Inventory Service</em> in an efficient way.</p>
</li>
<li>
<p><em>WebUI Service</em> calls <em>Gateway Service</em> to <a data-type="indexterm" data-primary="microservices" data-secondary="WebUI service" id="idm45261456042064"/><a data-type="indexterm" data-primary="WebUI service" id="idm45261456041056"/>retrieve all the information.</p>
</li>
</ul>

<p>The Presentation and the Model <a data-type="indexterm" data-primary="Presentation layer" data-secondary="microservices and" id="idm45261456039520"/><a data-type="indexterm" data-primary="Model layer" data-secondary="microservices and" id="idm45261456038544"/><a data-type="indexterm" data-primary="microservices" data-secondary="Presentation layer" id="idm45261456037600"/><a data-type="indexterm" data-primary="microservices" data-secondary="Model layer" id="idm45261456036656"/>layers are represented by such microservices, with the latter having an interface to the Data layer delegated to some DBMS. Our estore implementation is called <a data-type="indexterm" data-primary="Coolstore" id="idm45261456035408"/>Coolstore and looks like the picture in <a data-type="xref" href="#fig2-2">Figure 2-2</a>.</p>

<figure><div id="fig2-2" class="figure">
<img src="Images/moej_0202.png" alt="Coolstore Dashboard" width="600" height="548"/>
<h6><span class="label">Figure 2-2. </span>Coolstore dashboard</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Create an Inventory Microservice with Quarkus"><div class="sect1" id="idm45261456031712">
<h1>Create an Inventory Microservice with Quarkus</h1>

<p><a href="https://quarkus.io" target="_blank">Quarkus</a> is a full stack, Kubernetes-native Java framework made <a data-type="indexterm" data-primary="Quarkus" data-secondary="microservices, Inventory microservice" id="idm45261456029152"/><a data-type="indexterm" data-primary="microservices" data-secondary="Quarkus" id="idm45261456028160"/><a data-type="indexterm" data-primary="Inventory service" data-secondary="Quarkus" id="idm45261456027216"/><a data-type="indexterm" data-primary="JVMs (Java Virtual Machines)" data-secondary="Quarkus" id="idm45261456026272"/><a data-type="indexterm" data-primary="Quarkus" data-secondary="JVMs (Java Virtual Machines)" id="idm45261456025312"/>for Java virtual machines (JVMs) and native compilation, optimizing Java specifically for containers and enabling it to become an effective platform for serverless, cloud, and Kubernetes environments.</p>

<p>It is designed to work with <a data-type="indexterm" data-primary="Quarkus" data-secondary="Java and" id="idm45261456023392"/>popular Java standards, frameworks, and libraries like <a data-type="indexterm" data-primary="Quarkus" data-secondary="EclipseMicroProfile and" id="idm45261456022224"/><a data-type="indexterm" data-primary="Quarkus" data-secondary="Spring and" id="idm45261456021280"/><a data-type="indexterm" data-primary="Quarkus" data-secondary="Apache Kafka and" id="idm45261456020336"/><a data-type="indexterm" data-primary="Quarkus" data-secondary="RESTEasy (JAX-RS) and" id="idm45261456019392"/><a data-type="indexterm" data-primary="Quarkus" data-secondary="Hibernate ORM (JPA) and" id="idm45261456018448"/><a data-type="indexterm" data-primary="EclipseMicroProfile" id="idm45261456017504"/><a data-type="indexterm" data-primary="Spring" id="idm45261456016832"/><a data-type="indexterm" data-primary="Apache Kafka" id="idm45261456016160"/><a data-type="indexterm" data-primary="RESTEasy (JAX-RS)" id="idm45261456015488"/><a data-type="indexterm" data-primary="Hibernate ORM (JPA)" id="idm45261456014816"/>Eclipse MicroProfile and Spring, as well as Apache Kafka, RESTEasy (JAX-RS), Hibernate ORM (JPA), Infinispan, Camel, and many more.
It also provides the <a data-type="indexterm" data-primary="GraalVM, Quarkus and" id="idm45261456013840"/><a data-type="indexterm" data-primary="Quarkus" data-secondary="GraalVM and" id="idm45261456013168"/>correct information to GraalVM (a universal virtual machine for running apps written in several languages, including Java and JavaScript) for a native compilation of your application.</p>

<p>Quarkus is a good choice for implementing microservices architectures, and it provides a set of tools that help developers debug and test at ease. For our ecommerce store, we will start using Quarkus for the Inventory microservice (as shown in <a data-type="xref" href="#fig2-3">Figure 2-3</a>).</p>

<figure><div id="fig2-3" class="figure">
<img src="Images/moej_0203.png" alt="Inventory Quarkus microservice" width="340" height="509"/>
<h6><span class="label">Figure 2-3. </span>Inventory Quarkus microservice</h6>
</div></figure>

<p>You can find all the source code for this example in the <a href="https://oreil.ly/zqbWB">book’s GitHub repository</a>.</p>








<section data-type="sect2" data-pdf-bookmark="Create Quarkus Maven Project"><div class="sect2" id="idm45261456007248">
<h2>Create Quarkus Maven Project</h2>

<p>With Quarkus, you can scaffold a <a data-type="indexterm" data-primary="Quarkus" data-secondary="Maven project" id="qumaven"/><a data-type="indexterm" data-primary="Maven" id="mav"/>new project either with Maven or Gradle.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Both Maven and Gradle are popular ways to set up a Java project and manage all <a data-type="indexterm" data-primary="Maven" data-secondary="dependencies and" id="idm45261456002160"/><a data-type="indexterm" data-primary="Gradle" id="idm45261458955632"/><a data-type="indexterm" data-primary="dependencies" data-secondary="Maven and" id="idm45261458954960"/><a data-type="indexterm" data-primary="dependencies" data-secondary="Gradle and" id="idm45261458954016"/>dependencies. They differ in their dependency management strategy and they have different configuration formats (XML versus Kotlin DSL), but they are mostly equivalent in terms of capabilities. In this book, we will use Maven as it has wider support through IDEs and tools.</p>
</div>

<p>We set up a new Maven <a data-type="indexterm" data-primary="Quarkus" data-secondary="Maven project" data-tertiary="setup" id="idm45261458952144"/><a data-type="indexterm" data-primary="Maven" data-secondary="project setup" id="idm45261458950864"/>project using <code>quarkus-maven-plugin</code> with this command:</p>

<pre data-type="programlisting" data-code-language="bash">mvn io.quarkus:quarkus-maven-plugin:2.1.4.Final:create <code class="se">\</code>
  -DprojectGroupId<code class="o">=</code>com.redhat.cloudnative <code class="se">\</code>
  -DprojectArtifactId<code class="o">=</code>inventory-quarkus <code class="se">\</code>
  -DprojectVersion<code class="o">=</code>1.0.0-SNAPSHOT <code class="se">\</code>
  -DclassName<code class="o">=</code><code class="s2">"com.redhat.cloudnative.InventoryResource"</code> <code class="se">\</code>
  -Dextensions<code class="o">=</code><code class="s2">"quarkus-resteasy,quarkus-resteasy-jsonb,↳</code>
<code class="s2">  quarkus-hibernate-orm-panache,quarkus-jdbc-h2"</code></pre>
<div data-type="tip"><h6>Tip</h6>
<p>You can also bootstrap a Quarkus app with <a data-type="indexterm" data-primary="Quarkus" data-secondary="apps, bootstrapping" id="idm45261458677104"/>the online configurator available at <a href="https://code.quarkus.io"><em class="hyperlink">https://code.quarkus.io</em></a>.</p>
</div>

<p>This will create a skeleton project with an <code>InventoryResource</code> class that we will use for implementing our ecommerce Inventory microservice.</p>

<p>Let’s have a look at the generated <em>pom.xml</em> file:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code><code>
</code><code class="nt">&lt;project</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;modelVersion</code><code class="nt">&gt;</code><code>4.0.0</code><code class="nt">&lt;/modelVersion&gt;</code><code>
    </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>com.redhat.cloudnative</code><code class="nt">&lt;/groupId&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO1-1" href="#callout_the_path_to_cloud_native_java_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>inventory-quarkus</code><code class="nt">&lt;/artifactId&gt;</code><code>
    </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>1.0.0-SNAPSHOT</code><code class="nt">&lt;/version&gt;</code><code>
    </code><code class="nt">&lt;properties</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;quarkus-plugin.version</code><code class="nt">&gt;</code><code>2.1.4.Final</code><code class="nt">&lt;/quarkus-plugin.version&gt;</code><code>
        </code><code class="nt">&lt;quarkus.platform.artifact-id</code><code class="nt">&gt;</code><code>quarkus-bom</code><code class="nt">&lt;/quarkus.platform.artifact-id&gt;</code><code>
        </code><code class="nt">&lt;quarkus.platform.group-id</code><code class="nt">&gt;</code><code>io.quarkus</code><code class="nt">&lt;/quarkus.platform.group-id&gt;</code><code>
        </code><code class="nt">&lt;quarkus.platform.version</code><code class="nt">&gt;</code><code>2.1.4.Final</code><code class="nt">&lt;/quarkus.platform.version&gt;</code><code>
        </code><code class="nt">&lt;compiler-plugin.version</code><code class="nt">&gt;</code><code>3.8.1</code><code class="nt">&lt;/compiler-plugin.version&gt;</code><code>
        </code><code class="nt">&lt;surefire-plugin.version</code><code class="nt">&gt;</code><code>3.0.0-M5</code><code class="nt">&lt;/surefire-plugin.version&gt;</code><code>
        </code><code class="nt">&lt;project.build.sourceEncoding</code><code class="nt">&gt;</code><code>UTF-8</code><code class="nt">&lt;/project.build.sourceEncoding&gt;</code><code>
        </code><code class="nt">&lt;maven.compiler.source</code><code class="nt">&gt;</code><code>11</code><code class="nt">&lt;/maven.compiler.source&gt;</code><code>
        </code><code class="nt">&lt;maven.compiler.target</code><code class="nt">&gt;</code><code>11</code><code class="nt">&lt;/maven.compiler.target&gt;</code><code>
        </code><code class="nt">&lt;maven.compiler.parameters</code><code class="nt">&gt;</code><code>true</code><code class="nt">&lt;/maven.compiler.parameters&gt;</code><code>
    </code><code class="nt">&lt;/properties&gt;</code><code>
    </code><code class="nt">&lt;dependencyManagement</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;dependencies</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
                </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.quarkus</code><code class="nt">&lt;/groupId&gt;</code><code>
                </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>quarkus-bom</code><code class="nt">&lt;/artifactId&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO1-2" href="#callout_the_path_to_cloud_native_java_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
                </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>${quarkus.platform.version}</code><code class="nt">&lt;/version&gt;</code><code>
                </code><code class="nt">&lt;type</code><code class="nt">&gt;</code><code>pom</code><code class="nt">&lt;/type&gt;</code><code>
                </code><code class="nt">&lt;scope</code><code class="nt">&gt;</code><code>import</code><code class="nt">&lt;/scope&gt;</code><code>
            </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;/dependencies&gt;</code><code>
    </code><code class="nt">&lt;/dependencyManagement&gt;</code><code>
    </code><code class="nt">&lt;dependencies</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO1-3" href="#callout_the_path_to_cloud_native_java_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
          </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.quarkus</code><code class="nt">&lt;/groupId&gt;</code><code>
          </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>quarkus-resteasy</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
          </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.quarkus</code><code class="nt">&lt;/groupId&gt;</code><code>
          </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>quarkus-junit5</code><code class="nt">&lt;/artifactId&gt;</code><code>
          </code><code class="nt">&lt;scope</code><code class="nt">&gt;</code><code>test</code><code class="nt">&lt;/scope&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
          </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.rest-assured</code><code class="nt">&lt;/groupId&gt;</code><code>
          </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>rest-assured</code><code class="nt">&lt;/artifactId&gt;</code><code>
          </code><code class="nt">&lt;scope</code><code class="nt">&gt;</code><code>test</code><code class="nt">&lt;/scope&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
          </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.quarkus</code><code class="nt">&lt;/groupId&gt;</code><code>
          </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>quarkus-resteasy-jsonb</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
          </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.quarkus</code><code class="nt">&lt;/groupId&gt;</code><code>
          </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>quarkus-hibernate-orm-panache</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
          </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.quarkus</code><code class="nt">&lt;/groupId&gt;</code><code>
          </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>quarkus-jdbc-h2</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
    </code><code class="nt">&lt;/dependencies&gt;</code><code>
...
            </code><code class="nt">&lt;build</code><code class="nt">&gt;</code><code>
                </code><code class="nt">&lt;plugins</code><code class="nt">&gt;</code><code>
                    </code><code class="nt">&lt;plugin</code><code class="nt">&gt;</code><code>
                        </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.quarkus</code><code class="nt">&lt;/groupId&gt;</code><code>
                        </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>quarkus-maven-plugin</code><code class="nt">&lt;/artifactId&gt;</code><code>  </code><a class="co" id="co_the_path_to_cloud_native_java_CO1-4" href="#callout_the_path_to_cloud_native_java_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
                        </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>${quarkus-plugin.version}</code><code class="nt">&lt;/version&gt;</code><code>
                        </code><code class="nt">&lt;executions</code><code class="nt">&gt;</code><code>
                            </code><code class="nt">&lt;execution</code><code class="nt">&gt;</code><code>
                                </code><code class="nt">&lt;goals</code><code class="nt">&gt;</code><code>
                                    </code><code class="nt">&lt;goal</code><code class="nt">&gt;</code><code>native-image</code><code class="nt">&lt;/goal&gt;</code><code>
                                </code><code class="nt">&lt;/goals&gt;</code><code>
                                </code><code class="nt">&lt;configuration</code><code class="nt">&gt;</code><code>
                                    </code><code class="nt">&lt;enableHttpUrlHandler</code><code class="nt">&gt;</code><code>true↳
                                    </code><code class="nt">&lt;/enableHttpUrlHandler&gt;</code><code>
                                </code><code class="nt">&lt;/configuration&gt;</code><code>
                            </code><code class="nt">&lt;/execution&gt;</code><code>
                        </code><code class="nt">&lt;/executions&gt;</code><code>
                    </code><code class="nt">&lt;/plugin&gt;</code><code>
...
    </code><code class="nt">&lt;/profiles&gt;</code><code>
</code><code class="nt">&lt;/project&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO1-1" href="#co_the_path_to_cloud_native_java_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Here we set up <code>groupId</code>, <code>artifactId</code>, and <code>version</code>. For a full list of available options, please see <a data-type="xref" href="#quarkus_maven_project_options">Table 2-1</a>.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO1-2" href="#co_the_path_to_cloud_native_java_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Here you find the import of the Quarkus BOM, allowing you to omit the version on the different <a data-type="indexterm" data-primary="dependencies" data-secondary="Quarkus" id="idm45261450006768"/><a data-type="indexterm" data-primary="Quarkus" data-secondary="dependencies" id="idm45261450005792"/>Quarkus dependencies.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO1-3" href="#co_the_path_to_cloud_native_java_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Here you find all the dependencies for the project, which we expressed as extensions to add. We’ve included:</p>

<ul>
<li>
<p>JSON REST Services: This allows you to <a href="https://oreil.ly/hsHvV">develop REST services</a> to consume and produce JSON payloads.</p>
</li>
<li>
<p>Hibernate ORM Panache: The de facto JPA implementation offers you the full breadth of an Object Relational Mapper. <a href="https://oreil.ly/zqJDh">Hibernate ORM with Panache</a> focuses on simplifying the Hibernate-based Persistence layer, making your entities easier to write and maintain.</p>
</li>
<li>
<p>Datasources (H2): <a href="https://oreil.ly/Q5nGV">Datasources</a> are the main way of obtaining connections to a database; in this example, we will use H2, an in-memory database ready to use for Java apps.</p>
</li>
</ul></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO1-4" href="#co_the_path_to_cloud_native_java_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The <code>quarkus-maven-plugin</code>, which is  <a data-type="indexterm" data-primary="quarkus-maven-plugin" id="idm45261450335104"/>responsible for the packaging of the application and also for providing the development mode.</p></dd>
</dl>
<table id="quarkus_maven_project_options">
<caption><span class="label">Table 2-1. </span>Quarkus Maven Project Options</caption>
<thead>
<tr>
<th>Attribute</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><span class="keep-together"><code>projectGroupId</code></span></p></td>
<td><p><code>com.redhat.cloudnative</code></p></td>
<td><p>The group id of the created project.</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>projectArtifactId</code></span></p></td>
<td><p><em>mandatory</em></p></td>
<td><p>The artifact id of the created project. Not passing it triggers the interactive mode.</p></td>
</tr>
<tr>
<td><p><code>projectVersion</code></p></td>
<td><p><code>1.0-SNAPSHOT</code></p></td>
<td><p>The version of the created project.</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>platformGroupId</code></span></p></td>
<td><p><code>io.quarkus</code></p></td>
<td><p>The group id of the target platform. Given that all the existing platforms are coming from io.quarkus, this one won’t be used explicitly. But it’s still an option.</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>platformArtifactId</code></span></p></td>
<td><p><code>quarkus-universe-bom</code></p></td>
<td><p>The artifact id of the target platform BOM. It should be quarkus-bom in order to use the locally built Quarkus.</p></td>
</tr>
<tr>
<td><p><code>platformVersion</code></p></td>
<td><p>If it’s not specified, the latest one will be resolved.</p></td>
<td><p>The version of the platform you want the project to use. It can also accept a version range, in which case the latest from the specified range will be used.</p></td>
</tr>
<tr>
<td><p><code>className</code></p></td>
<td><p><em>Not created if omitted</em></p></td>
<td><p>The fully qualified name of the generated resource.</p></td>
</tr>
<tr>
<td><p><code>path</code></p></td>
<td><p><code>/hello</code></p></td>
<td><p>The resource path, only relevant if className is set.</p></td>
</tr>
<tr>
<td><p><code>extensions</code></p></td>
<td><p><code>[]</code></p></td>
<td><p>The list of extensions <a data-type="indexterm" data-primary="Quarkus" data-secondary="Maven project" data-startref="qumaven" id="idm45261450024928"/><a data-type="indexterm" data-primary="Maven" data-startref="mav" id="idm45261450290240"/>to add to the project (comma-separated).</p></td>
</tr>
</tbody>
</table>
<div data-type="tip"><h6>Tip</h6>
<p>To check all the extensions available, use this command from project dir: <code>./mvnw quarkus:list-extensions</code>.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Create a Domain Model"><div class="sect2" id="idm45261456006624">
<h2>Create a Domain Model</h2>

<p>It’s time to write some <a data-type="indexterm" data-primary="domain models" data-secondary="Inventory service" id="idm45261450285888"/><a data-type="indexterm" data-primary="microservices" data-secondary="Inventory service" data-tertiary="domain model" id="idm45261450284912"/><a data-type="indexterm" data-primary="Inventory service" data-secondary="domain model" id="idm45261450283696"/>code now and create a <em>domain model</em> and a RESTful endpoint to create the Inventory service. Domain model is a popular pattern in software engineering, and it also fits very well in the cloud native world. The level of abstraction given by the pattern makes it still valid as an object-oriented way of modeling microservices business logic.</p>

<p>You can find the domain model definition in the <code>Inventory</code> class in this <a href="https://oreil.ly/JE6CD">book’s GitHub repository</a>.</p>

<p>Our domain model implementation consists of an <code>Entity</code> mapped to the Persistence layer, representing an inventory of items:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">com</code><code class="o">.</code><code class="na">redhat</code><code class="o">.</code><code class="na">cloudnative</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.persistence.Entity</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.persistence.Table</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.hibernate.orm.panache.PanacheEntity</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.persistence.Column</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Entity</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO2-1" href="#callout_the_path_to_cloud_native_java_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nd">@Table</code><code class="o">(</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s">"INVENTORY"</code><code class="o">)</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO2-2" href="#callout_the_path_to_cloud_native_java_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">Inventory</code><code> </code><code class="kd">extends</code><code> </code><code class="n">PanacheEntity</code><code class="o">{</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO2-3" href="#callout_the_path_to_cloud_native_java_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@Column</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="n">quantity</code><code class="o">;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO2-4" href="#callout_the_path_to_cloud_native_java_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">toString</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="s">"Inventory [Id='"</code><code> </code><code class="o">+</code><code> </code><code class="n">id</code><code> </code><code class="o">+</code><code> </code><code class="sc">'\''</code><code> </code><code class="o">+</code><code> </code><code class="s">", quantity="</code><code> </code><code class="o">+</code><code> </code><code class="n">quantity</code><code> </code><code class="o">+</code><code> </code><code class="sc">']'</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO2-1" href="#co_the_path_to_cloud_native_java_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>@Entity</code> marks the class as a JPA entity.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO2-2" href="#co_the_path_to_cloud_native_java_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>@Table</code> customizes the table creation process by defining a table name and database constraint in this case it is <code>INVENTORY</code>.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO2-3" href="#co_the_path_to_cloud_native_java_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Quarkus will generate <code>getter/setter</code> for you when using public attributes and when you extend <code>PanacheEntity</code>. Additionally, you have an  <code>id</code> attribute automatically added.</p></dd>
</dl>

<p>Once we define the model, we can update <a data-type="indexterm" data-primary="Quarkus" data-secondary="Maven project" data-tertiary="application. properties file" id="idm45261449926448"/><a data-type="indexterm" data-primary="Maven" data-secondary="application.properties file" id="idm45261449878368"/>our Properties expressed in the <em>application.properties</em> file in order to provide the instructions on how to populate data for our microservice:</p>

<pre data-type="programlisting" data-code-language="text"><code>quarkus.datasource.jdbc.url=jdbc:h2:mem:inventory;↳
DB_CLOSE_ON_EXIT=FALSE;DB_CLOSE_DELAY=-1 </code><a class="co" id="co_the_path_to_cloud_native_java_CO3-1" href="#callout_the_path_to_cloud_native_java_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
quarkus.datasource.db-kind=h2
quarkus.hibernate-orm.database.generation=drop-and-create
quarkus.hibernate-orm.log.sql=true
quarkus.hibernate-orm.sql-load-script=import.sql </code><a class="co" id="co_the_path_to_cloud_native_java_CO3-2" href="#callout_the_path_to_cloud_native_java_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
%prod.quarkus.package.uber-jar=true </code><a class="co" id="co_the_path_to_cloud_native_java_CO3-3" href="#callout_the_path_to_cloud_native_java_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO3-1" href="#co_the_path_to_cloud_native_java_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>JDBC path for the in-memory DB; this can be changed for other types of DB like any RDBMS.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO3-2" href="#co_the_path_to_cloud_native_java_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>A SQL script that we’ll use to populate the Coolstore with some data:<br/>
<code>INSERT INTO INVENTORY(id, quantity) VALUES (100000, 0);</code><br/>
<code>INSERT INTO INVENTORY(id, quantity) VALUES (329299, 35);</code><br/>
<code>INSERT INTO INVENTORY(id, quantity) VALUES (329199, 12);</code><br/>
<code>INSERT INTO INVENTORY(id, quantity) VALUES (165613, 45);</code><br/>
<code>INSERT INTO INVENTORY(id, quantity) VALUES (165614, 87);</code><br/>
<code>INSERT INTO INVENTORY(id, quantity) VALUES (165954, 43);</code><br/>
<code>INSERT INTO INVENTORY(id, quantity) VALUES (444434, 32);</code><br/>
<code>INSERT INTO INVENTORY(id, quantity) VALUES (444435, 53);</code><br/></p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO3-3" href="#co_the_path_to_cloud_native_java_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>An <code>uber-jar</code> contains <a data-type="indexterm" data-primary="dependencies" data-secondary="uber-jar" id="idm45261449832928"/><a data-type="indexterm" data-primary="uber-jar" data-secondary="dependencies and" id="idm45261449832080"/>all the dependencies required packaged in the jar to enable running the application with <code>java -jar</code>. By default, in Quarkus, the generation of the <code>uber-jar</code> is disabled. With the <code>%prod</code> prefix, this option is only activated when building the jar intended for deployments.</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Create a RESTful Service"><div class="sect2" id="idm45261449829840">
<h2>Create a RESTful Service</h2>

<p>Quarkus uses the JAX-RS standard <a data-type="indexterm" data-primary="Quarkus" data-secondary="Maven project" data-tertiary="RESTful services" id="qmavrest"/><a data-type="indexterm" data-primary="Maven" data-secondary="RESTful services" id="mavREST"/>for building REST services. When scaffolding a new project as we saw before, a <em>hello</em> example service is created in the <em>className</em> path we defined.
Now we want to expose REST service to retrieve the number of available items in the store from the inventory, using the following:</p>

<ul>
<li>
<p>Path: <em>/api/inventory/{itemId}</em>;</p>
</li>
<li>
<p>HTTP Method: <code>GET</code></p>
</li>
</ul>

<p>This returns the quantity for a given item id present in the inventory database.</p>

<p>Let’s change the <code>InventoryResource</code> class definition as follows:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">com</code><code class="o">.</code><code class="na">redhat</code><code class="o">.</code><code class="na">cloudnative</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.GET</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Path</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.PathParam</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Produces</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/api/inventory"</code><code class="o">)</code><code>
</code><code class="nd">@ApplicationScoped</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">InventoryResource</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>
</code><code>    </code><code class="nd">@GET</code><code>
</code><code>    </code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/{itemId}"</code><code class="o">)</code><code>
</code><code>    </code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">Inventory</code><code> </code><code class="nf">getAvailability</code><code class="o">(</code><code class="nd">@PathParam</code><code class="o">(</code><code class="s">"itemId"</code><code class="o">)</code><code> </code><code class="kt">long</code><code> </code><code class="n">itemId</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">Inventory</code><code> </code><code class="n">inventory</code><code> </code><code class="o">=</code><code> </code><code class="n">Inventory</code><code class="o">.</code><code class="na">findById</code><code class="o">(</code><code class="n">itemId</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO4-1" href="#callout_the_path_to_cloud_native_java_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">inventory</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO4-1" href="#co_the_path_to_cloud_native_java_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>By extending <code>PanacheEntity</code>, we’re using the active record persistence pattern instead of a Data Access Obect (DAO). This means that all persistence methods are blended with our own <code>Entity</code>.</p></dd>
</dl>

<p>We just implemented a parametric REST endpoint for our microservice, serving the JSON representation of the items contained in our Coolstore. In this way we provided a layer to query via HTTP <code>GET</code> requests our <code>Inventory</code> Data Model we implemented in the previous step.</p>
<div data-type="tip"><h6>Tip</h6>
<p>With Quarkus, there is no need to create an <code>Application</code> class. It’s supported, but not required. In addition, only one instance of the resource is created and not one per request. You can configure this using <a data-type="indexterm" data-primary="Quarkus" data-secondary="Maven project" data-tertiary="RESTful services" data-startref="qmavrest" id="idm45261449694464"/><a data-type="indexterm" data-primary="Maven" data-secondary="RESTful services" data-startref="mavREST" id="idm45261449692944"/>the different Scoped annotations (<code>ApplicationScoped</code>, <code>RequestScoped</code>, etc).</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Run the App in Dev Mode"><div class="sect2" id="idm45261449690512">
<h2>Run the App in Dev Mode</h2>

<p>Development mode in Quarkus is one <a data-type="indexterm" data-primary="Quarkus" data-secondary="development mode" id="qkdevmod"/><a data-type="indexterm" data-primary="Maven" data-secondary="development mode" id="mavdevmod"/>of the coolest features we have today for cloud native Java development. It enables hot deployment with background compilation, which means that when you modify your Java files or your resource files and then refresh your browser, the changes automatically take effect. This also works for resource files such as the configuration property file. In addition, refreshing the browser triggers a scan of the workspace, and if any changes are detected, the Java files are recompiled and the application is redeployed; your request is then serviced by the redeployed application. If there are any issues with compilation or deployment, an error page will let you know.</p>

<p>You can start the app in dev mode with a built-in Maven goal named <code>quarkus:dev</code>. It enables <a data-type="indexterm" data-primary="Maven" data-secondary="quarkus:dev goal" id="idm45261449804480"/>hot deployment with background compilation, which means that when you modify your Java files or your resource files and refresh your browser, these changes will automatically take effect. This also works for resource files like the configuration property file:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw compile quarkus:dev</pre>

<p class="pagebreak-before">After you start the app in dev mode, you should see an output like this:</p>

<pre data-type="programlisting">...
Hibernate:

    drop table if exists INVENTORY CASCADE
Hibernate:

    create table INVENTORY (
       id bigint not null,
        quantity integer,
        primary key (id)
    )

Hibernate:
    INSERT INTO INVENTORY(id, quantity) VALUES (100000, 0)
Hibernate:
    INSERT INTO INVENTORY(id, quantity) VALUES (329299, 35)
Hibernate:
    INSERT INTO INVENTORY(id, quantity) VALUES (329199, 12)
Hibernate:
    INSERT INTO INVENTORY(id, quantity) VALUES (165613, 45)
Hibernate:
    INSERT INTO INVENTORY(id, quantity) VALUES (165614, 87)
Hibernate:
    INSERT INTO INVENTORY(id, quantity) VALUES (165954, 43)
Hibernate:
    INSERT INTO INVENTORY(id, quantity) VALUES (444434, 32)
Hibernate:
    INSERT INTO INVENTORY(id, quantity) VALUES (444435, 53)
__  ____  __  _____   ___  __ ____  ______
 --/ __ \/ / / / _ | / _ \/ //_/ / / / __/
 -/ /_/ / /_/ / __ |/ , _/ ,&lt; / /_/ /\ \
--\___\_\____/_/ |_/_/|_/_/|_|\____/___/
2020-12-02 13:11:16,565 INFO  [io.quarkus] (Quarkus Main Thread)↳
inventory-quarkus 1.0.0-SNAPSHOT on JVM (powered by Quarkus 1.7.2.Final)↳
started in 1.487s. Listening on: http://0.0.0.0:8080
2020-12-02 13:11:16,575 INFO  [io.quarkus] (Quarkus Main Thread)↳
Profile dev activated. Live Coding activated.
2020-12-02 13:11:16,575 INFO  [io.quarkus] (Quarkus Main Thread)↳
Installed features: [agroal, cdi, hibernate-orm, jdbc-h2, mutiny, narayana-jta,↳
resteasy, resteasy-jsonb, smallrye-context-propagation]</pre>

<p>From the output, you can see that <code>Hibernate</code> created a database with the name of our domain model and populated it with some initial data defined in our Properties file.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When we scaffolded the project at the beginning of this chapter, we included a series of dependencies like Panache and used it to map our data model as <code>Entity</code> into a database.</p>
</div>

<p>We can also see that our app is up and running, listening to port 8080. If you open your browser now at <a href="http://localhost:8080"><em class="hyperlink">http://localhost:8080</em></a>, you will see <a data-type="indexterm" data-primary="Quarkus" data-secondary="welcome page" id="idm45261449658112"/>a Quarkus welcome page (as in <a data-type="xref" href="#fig2-4">Figure 2-4</a>).</p>

<figure><div id="fig2-4" class="figure">
<img src="Images/moej_0204.png" alt="Quarkus Welcome Page" width="600" height="366"/>
<h6><span class="label">Figure 2-4. </span>Quarkus welcome page</h6>
</div></figure>
<div data-type="tip"><h6>Tip</h6>
<p>You can stop the app running in Dev mode by using Ctrl-C from the same terminal where you launched it. When you run Quarkus 2 in Dev mode, it enables by default the Continuous Testing feature, where tests run immediately after code changes have been saved.</p>
</div>

<p>You can now try querying one <a data-type="indexterm" data-primary="microservices" data-secondary="querying" id="idm45261449796640"/>of the items we inserted from the <em>import.sql</em> file to test if our microservice is running properly.</p>

<p>Just navigate to <a href="http://localhost:8080/api/inventory/329299"><em class="hyperlink">http://localhost:8080/api/inventory/329299</em></a>.</p>

<p>You should have the following output:</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code>
   <code class="nt">"id"</code><code class="p">:</code><code class="s2">"329299"</code><code class="p">,</code>
   <code class="nt">"quantity"</code><code class="p">:</code><code class="mi">35</code>
<code class="p">}</code></pre>

<p>The REST API returned a JSON object representing the inventory count for this product. Congratulations on your first cloud native microservice with Quarkus!</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>We are now going to develop the other microservices that will consume this one, so leave this open in order to have <a data-type="indexterm" data-primary="Quarkus" data-secondary="development mode" data-startref="qkdevmod" id="idm45261449601872"/><a data-type="indexterm" data-primary="Maven" data-secondary="development mode" data-startref="mavdevmod" id="idm45261449600656"/>the Coolstore up and running at the end of this chapter.</p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Create a Catalog Microservice with Spring Boot"><div class="sect1" id="idm45261456031184">
<h1>Create a Catalog Microservice with Spring Boot</h1>

<p><a href="https://spring.io/projects/spring-boot">Spring Boot</a> is an opinionated framework that makes it easy to create stand-alone <a href="https://spring.io">Spring-based</a> applications <a data-type="indexterm" data-primary="microservices" data-secondary="Catalog Service" data-tertiary="Spring Boot" id="microCat"/>with embedded web containers such as Tomcat (or JBoss Web Server), Jetty, and Undertow that you can run directly on the JVM using <code>java -jar</code>. Spring Boot also allows production of a war file that can be deployed on stand-alone web containers.</p>

<p>The opinionated approach means many choices about Spring platform and third-party libraries are already made by Spring Boot so that you can get started with minimum effort and configuration.</p>

<p>Spring Boot is very popular for cloud native Java development because, quoting the official website, it makes it easy to create stand-alone, <a href="https://oreil.ly/KYWe5">production-grade Spring-based applications</a> that you can “just run.” We will include Spring Boot in our architecture for a Catalog microservice (as shown in <a data-type="xref" href="#fig2-5">Figure 2-5</a>).</p>

<figure><div id="fig2-5" class="figure">
<img src="Images/moej_0205.png" alt="Catalog Spring Boot microservice" width="339" height="509"/>
<h6><span class="label">Figure 2-5. </span>Catalog Spring Boot microservice</h6>
</div></figure>

<p>You can find all the source code for creating the Spring Boot microservice in the <a href="https://oreil.ly/M8ya6">book’s GitHub repository</a>.</p>








<section data-type="sect2" data-pdf-bookmark="Create a Maven Project"><div class="sect2" id="idm45261449588128">
<h2>Create a Maven Project</h2>

<p>Also in this case you can bootstrap <a data-type="indexterm" data-primary="Catalog Service" data-secondary="Spring Boot" data-tertiary="Maven" id="Catserv"/><a data-type="indexterm" data-primary="Spring Boot" data-secondary="Catalog Service" data-tertiary="Maven" id="SprCat"/><a data-type="indexterm" data-primary="Maven" data-secondary="Catalog Service, Spring Boot" id="MavCatSboot"/>your Spring Boot project either with Maven or Gradle.
The easiest way to do this is with <a href="https://start.spring.io">Spring Initializr</a>, an online configurator that helps generate the project structure with all the dependencies needed.</p>

<p>In this case, we will use a Red Hat-supported Spring Boot version from <a href="https://oreil.ly/mAJRs">Red Hat Maven repositories</a>, using the Project Metadata defined in <a data-type="xref" href="#spring_boot_maven_project_options">Table 2-2</a>.</p>
<table id="spring_boot_maven_project_options">
<caption><span class="label">Table 2-2. </span>Spring Boot Maven Project Options</caption>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><span class="keep-together"><code>modelVersion</code></span></p></td>
<td><p><code>4.0.0</code></p></td>
<td><p>POM model version (always 4.0.0).</p></td>
</tr>
<tr>
<td><p><code>groupId</code></p></td>
<td><p><span class="keep-together"><code>com.redhat.cloudnative</code></span></p></td>
<td><p>Group or organization that the project belongs to. Often expressed as an inverted domain name.</p></td>
</tr>
<tr>
<td><p><code>artifactId</code></p></td>
<td><p><code>catalog</code></p></td>
<td><p>Name to be given to the project’s library artifact (for example, the name of its JAR or WAR file).</p></td>
</tr>
<tr>
<td><p><code>version</code></p></td>
<td><p><code>1.0-SNAPSHOT</code></p></td>
<td><p>Version of the project that is being built.</p></td>
</tr>
<tr>
<td><p><code>name</code></p></td>
<td><p><code>CoolStore Catalog Service</code></p></td>
<td><p>Name of the app.</p></td>
</tr>
<tr>
<td><p><code>description</code></p></td>
<td><p><code>CoolStore Catalog Service with Spring Boot</code></p></td>
<td><p>A description for the app.</p></td>
</tr>
</tbody>
</table>

<p>Let’s have a look at our <em>pom.xml</em> file:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code><code>
</code><code class="nt">&lt;project</code><code>
  </code><code class="na">xmlns=</code><code class="s">"http://maven.apache.org/POM/4.0.0"</code><code>
  </code><code class="na">xmlns:xsi=</code><code class="s">"http://www.w3.org/2001/XMLSchema-instance"</code><code class="err">↳</code><code>
  </code><code class="na">xsi:schemaLocation=</code><code class="s">"http://maven.apache.org/POM/4.0.0↳
  http://maven.apache.org/xsd/maven-4.0.0.xsd"</code><code class="nt">&gt;</code><code>
  </code><code class="nt">&lt;modelVersion</code><code class="nt">&gt;</code><code>4.0.0</code><code class="nt">&lt;/modelVersion&gt;</code><code>
  </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>com.redhat.cloudnative</code><code class="nt">&lt;/groupId&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO5-1" href="#callout_the_path_to_cloud_native_java_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
  </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>catalog</code><code class="nt">&lt;/artifactId&gt;</code><code>
  </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>1.0-SNAPSHOT</code><code class="nt">&lt;/version&gt;</code><code>
  </code><code class="nt">&lt;name</code><code class="nt">&gt;</code><code>CoolStore Catalog Service</code><code class="nt">&lt;/name&gt;</code><code>
  </code><code class="nt">&lt;description</code><code class="nt">&gt;</code><code>CoolStore Catalog Service with Spring Boot</code><code class="nt">&lt;/description&gt;</code><code>
  </code><code class="nt">&lt;properties</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;spring-boot.version</code><code class="nt">&gt;</code><code>2.1.6.SP3-redhat-00001</code><code class="nt">&lt;/spring-boot.version&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO5-2" href="#callout_the_path_to_cloud_native_java_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="nt">&lt;spring-boot.maven.plugin.version</code><code class="nt">&gt;</code><code>2.1.4.RELEASE-redhat-00001↳
    </code><code class="nt">&lt;/spring-boot.maven.plugin.version&gt;</code><code>
    </code><code class="nt">&lt;spring.k8s.bom.version</code><code class="nt">&gt;</code><code>1.0.3.RELEASE</code><code class="nt">&lt;/spring.k8s.bom.version&gt;</code><code>
    </code><code class="nt">&lt;fabric8.maven.plugin.version</code><code class="nt">&gt;</code><code>4.3.0</code><code class="nt">&lt;/fabric8.maven.plugin.version&gt;</code><code>
  </code><code class="nt">&lt;/properties&gt;</code><code>
  </code><code class="nt">&lt;repositories</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;repository</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;id</code><code class="nt">&gt;</code><code>redhat-ga</code><code class="nt">&lt;/id&gt;</code><code>
      </code><code class="nt">&lt;url</code><code class="nt">&gt;</code><code>https://maven.repository.redhat.com/ga/</code><code class="nt">&lt;/url&gt;</code><code>
    </code><code class="nt">&lt;/repository&gt;</code><code>
  </code><code class="nt">&lt;/repositories&gt;</code><code>
  </code><code class="nt">&lt;pluginRepositories</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;pluginRepository</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;id</code><code class="nt">&gt;</code><code>redhat-ga-plugins</code><code class="nt">&lt;/id&gt;</code><code>
      </code><code class="nt">&lt;url</code><code class="nt">&gt;</code><code>https://maven.repository.redhat.com/ga/</code><code class="nt">&lt;/url&gt;</code><code>
    </code><code class="nt">&lt;/pluginRepository&gt;</code><code>
  </code><code class="nt">&lt;/pluginRepositories&gt;</code><code>
  </code><code class="nt">&lt;dependencyManagement</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;dependencies</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>me.snowdrop</code><code class="nt">&lt;/groupId&gt;</code><code>
        </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>spring-boot-bom</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>${spring-boot.version}</code><code class="nt">&lt;/version&gt;</code><code>
        </code><code class="nt">&lt;type</code><code class="nt">&gt;</code><code>pom</code><code class="nt">&lt;/type&gt;</code><code>
        </code><code class="nt">&lt;scope</code><code class="nt">&gt;</code><code>import</code><code class="nt">&lt;/scope&gt;</code><code>
      </code><code class="nt">&lt;/dependency&gt;</code><code>
      </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>org.springframework.cloud</code><code class="nt">&lt;/groupId&gt;</code><code>
        </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>spring-cloud-kubernetes-dependencies</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>${spring.k8s.bom.version}</code><code class="nt">&lt;/version&gt;</code><code>
        </code><code class="nt">&lt;type</code><code class="nt">&gt;</code><code>pom</code><code class="nt">&lt;/type&gt;</code><code>
        </code><code class="nt">&lt;scope</code><code class="nt">&gt;</code><code>import</code><code class="nt">&lt;/scope&gt;</code><code>
      </code><code class="nt">&lt;/dependency&gt;</code><code>
    </code><code class="nt">&lt;/dependencies&gt;</code><code>
  </code><code class="nt">&lt;/dependencyManagement&gt;</code><code>
  </code><code class="nt">&lt;dependencies</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO5-3" href="#callout_the_path_to_cloud_native_java_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>org.springframework.boot</code><code class="nt">&lt;/groupId&gt;</code><code>
      </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>spring-boot-starter-web</code><code class="nt">&lt;/artifactId&gt;</code><code>
    </code><code class="nt">&lt;/dependency&gt;</code><code>
    </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>org.springframework.boot</code><code class="nt">&lt;/groupId&gt;</code><code>
      </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>spring-boot-starter-data-jpa</code><code class="nt">&lt;/artifactId&gt;</code><code>
    </code><code class="nt">&lt;/dependency&gt;</code><code>
    </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>org.springframework.boot</code><code class="nt">&lt;/groupId&gt;</code><code>
      </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>spring-boot-starter-actuator</code><code class="nt">&lt;/artifactId&gt;</code><code>
    </code><code class="nt">&lt;/dependency&gt;</code><code>
    </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>org.springframework.cloud</code><code class="nt">&lt;/groupId&gt;</code><code>
      </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>spring-cloud-starter-kubernetes-config</code><code class="nt">&lt;/artifactId&gt;</code><code>
    </code><code class="nt">&lt;/dependency&gt;</code><code>
    </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>com.h2database</code><code class="nt">&lt;/groupId&gt;</code><code>
      </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>h2</code><code class="nt">&lt;/artifactId&gt;</code><code>
    </code><code class="nt">&lt;/dependency&gt;</code><code>
  </code><code class="nt">&lt;/dependencies&gt;</code><code>
...
</code><code class="nt">&lt;/project&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO5-1" href="#co_the_path_to_cloud_native_java_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Project metadata we generated by Initializr or manually</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO5-2" href="#co_the_path_to_cloud_native_java_CO5-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Spring Boot version used</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO5-3" href="#co_the_path_to_cloud_native_java_CO5-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Dependencies we need:</p>

<ul>
<li>
<p>JPA: Spring Data with JPA</p>
</li>
<li>
<p><a href="https://oreil.ly/n4oSG">Spring Cloud</a>: support and tooling from Spring for cloud native Java apps</p>
</li>
<li>
<p>H2: an in-memory database that we will use for this purpose</p>
</li>
</ul></dd>
</dl>

<p>This is a minimal Spring Boot project with support for RESTful services and Spring Data with JPA for connecting to a database. Any new project contains no code other than the main class, in this case, the <code>CatalogApplication</code> class, which is there to bootstrap the Spring Boot application.</p>

<p>You can find it in this <a href="https://oreil.ly/FK15g">book’s GitHub repository</a>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">com</code><code class="o">.</code><code class="na">redhat</code><code class="o">.</code><code class="na">cloudnative</code><code class="o">.</code><code class="na">catalog</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.boot.SpringApplication</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@SpringBootApplication</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO6-1" href="#callout_the_path_to_cloud_native_java_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">CatalogApplication</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">SpringApplication</code><code class="o">.</code><code class="na">run</code><code class="o">(</code><code class="n">CatalogApplication</code><code class="o">.</code><code class="na">class</code><code class="o">,</code><code> </code><code class="n">args</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO6-1" href="#co_the_path_to_cloud_native_java_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>A convenience annotation that adds autoconfiguration and component scan, and also enables defining extra configurations. It is <a data-type="indexterm" data-primary="Catalog Service" data-secondary="Spring Boot" data-tertiary="Maven" data-startref="Catserv" id="idm45261449349936"/><a data-type="indexterm" data-primary="Spring Boot" data-secondary="Catalog Service" data-tertiary="Maven" data-startref="SprCat" id="idm45261449348416"/><a data-type="indexterm" data-primary="Maven" data-secondary="Catalog Service, Spring Boot" data-startref="MavCatSboot" id="idm45261449346928"/>equivalent to using 
<span class="keep-together"><code>@Configuration</code></span>, <code>@EnableAutoConfiguration</code>, and <code>@ComponentScan</code> with their default attributes.</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Create a Domain Model"><div class="sect2" id="idm45261449587504">
<h2>Create a Domain Model</h2>

<p>Next, we need to provide some data <a data-type="indexterm" data-primary="Spring Boot" data-secondary="Catalog Service" data-tertiary="domain model" id="SpngCatDom"/><a data-type="indexterm" data-primary="domain models" data-secondary="Spring Boot" id="domSBcatserv"/><a data-type="indexterm" data-primary="Catalog Service" data-secondary="Spring Boot" data-tertiary="domain model" id="catservSBdom"/>to consume for our microservice representing the catalog of our Coolstore ecommerce website. Also here, we define a domain model for the high-level interaction with the Persistence layer, and an interface that enables the communication between a REST endpoint to expose the service and the data model (as shown in <a data-type="xref" href="#fig2-6">Figure 2-6</a>).</p>

<figure><div id="fig2-6" class="figure">
<img src="Images/moej_0206.png" alt="Data Model flow" width="600" height="140"/>
<h6><span class="label">Figure 2-6. </span>Data model flow</h6>
</div></figure>

<p>The database is configured using the Spring application configuration file, which is located in the properties file <code>application.properties</code>. Let’s have a look at this file to see the database connection details.</p>

<p>You can find it in this <a href="https://oreil.ly/cRnE6">book’s GitHub repository</a>:</p>

<pre data-type="programlisting" data-code-language="text"><code>spring.application.name=catalog
server.port=8080
spring.datasource.url=jdbc:h2:mem:catalog;DB_CLOSE_ON_EXIT=FALSE </code><a class="co" id="co_the_path_to_cloud_native_java_CO7-1" href="#callout_the_path_to_cloud_native_java_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
spring.datasource.username=sa
spring.datasource.password=
spring.datasource.driver-class-name=org.h2.Driver </code><a class="co" id="co_the_path_to_cloud_native_java_CO7-2" href="#callout_the_path_to_cloud_native_java_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO7-1" href="#co_the_path_to_cloud_native_java_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>JDBC URL for H2 DB</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO7-2" href="#co_the_path_to_cloud_native_java_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Use of H2 in-memory database</p></dd>
</dl>

<p>Let’s create our domain model, which is similar to the one we created for the Inventory microservice before.</p>

<p>You can find it in this <a href="https://oreil.ly/s971w">book’s GitHub repository</a>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">com</code><code class="o">.</code><code class="na">redhat</code><code class="o">.</code><code class="na">cloudnative</code><code class="o">.</code><code class="na">catalog</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.io.Serializable</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.persistence.Entity</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.persistence.Id</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.persistence.Table</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Entity</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO8-1" href="#callout_the_path_to_cloud_native_java_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nd">@Table</code><code class="o">(</code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s">"PRODUCT"</code><code class="o">)</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO8-2" href="#callout_the_path_to_cloud_native_java_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">Product</code><code> </code><code class="kd">implements</code><code> </code><code class="n">Serializable</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>  </code><code class="kd">private</code><code> </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="kt">long</code><code> </code><code class="n">serialVersionUID</code><code> </code><code class="o">=</code><code> </code><code class="mi">1L</code><code class="o">;</code><code>
</code><code>
</code><code>  </code><code class="nd">@Id</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO8-3" href="#callout_the_path_to_cloud_native_java_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>  </code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">itemId</code><code class="o">;</code><code>
</code><code>
</code><code>  </code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">name</code><code class="o">;</code><code>
</code><code>
</code><code>  </code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">description</code><code class="o">;</code><code>
</code><code>
</code><code>  </code><code class="kd">private</code><code> </code><code class="kt">double</code><code> </code><code class="n">price</code><code class="o">;</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="nf">Product</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getItemId</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">itemId</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setItemId</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">itemId</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">this</code><code class="o">.</code><code class="na">itemId</code><code> </code><code class="o">=</code><code> </code><code class="n">itemId</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getName</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">name</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setName</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">name</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">this</code><code class="o">.</code><code class="na">name</code><code> </code><code class="o">=</code><code> </code><code class="n">name</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getDescription</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">description</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setDescription</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">description</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">this</code><code class="o">.</code><code class="na">description</code><code> </code><code class="o">=</code><code> </code><code class="n">description</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kt">double</code><code> </code><code class="nf">getPrice</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">price</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setPrice</code><code class="o">(</code><code class="kt">double</code><code> </code><code class="n">price</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">this</code><code class="o">.</code><code class="na">price</code><code> </code><code class="o">=</code><code> </code><code class="n">price</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="nd">@Override</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">toString</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="s">"Product [itemId="</code><code> </code><code class="o">+</code><code> </code><code class="n">itemId</code><code> </code><code class="o">+</code><code> </code><code class="s">", name="</code><code> </code><code class="o">+</code><code> </code><code class="n">name</code><code>
</code><code>      </code><code class="o">+</code><code> </code><code class="s">", price="</code><code> </code><code class="o">+</code><code> </code><code class="n">price</code><code> </code><code class="o">+</code><code> </code><code class="s">"]"</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO8-1" href="#co_the_path_to_cloud_native_java_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>@Entity</code> marks the class as a JPA entity.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO8-2" href="#co_the_path_to_cloud_native_java_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>@Table</code> customizes the table creation process by defining a table name and database constraint, in this case a table named <em>CATALOG</em>.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO8-3" href="#co_the_path_to_cloud_native_java_CO8-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p><code>@Id</code> marks the primary key for <a data-type="indexterm" data-primary="Spring Boot" data-secondary="Catalog Service" data-tertiary="domain model" data-startref="SpngCatDom" id="idm45261448440256"/><a data-type="indexterm" data-primary="domain models" data-secondary="Spring Boot" data-startref="domSBcatserv" id="idm45261448438736"/><a data-type="indexterm" data-primary="Catalog Service" data-secondary="Spring Boot" data-tertiary="domain model" data-startref="catservSBdom" id="idm45261448437520"/>the table.</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Create a Data Repository"><div class="sect2" id="idm45261449343344">
<h2>Create a Data Repository</h2>

<p>Spring Data repository abstraction <a data-type="indexterm" data-primary="Spring Boot" data-secondary="Catalog Service" data-tertiary="data repository" id="idm45261448434352"/><a data-type="indexterm" data-primary="data repository, Spring Boot" id="idm45261448433104"/><a data-type="indexterm" data-primary="Catalog Service" data-secondary="Spring Boot" data-tertiary="data repository" id="idm45261448432368"/>simplifies dealing with data models in Spring applications by
reducing the amount of boilerplate code required to implement data access layers for various
persistence stores. <a href="https://oreil.ly/wUh7w">Repository and its subinterfaces</a>
are the central concept in Spring Data, which is a marker interface to provide
data manipulation functionality for the entity class that is being managed. When the application starts,
Spring finds all interfaces marked as repositories and for each interface found, the infrastructure
configures the required persistent technologies and provides an implementation for the repository interface.</p>

<p>We will now create a new Java interface named ProductRepository in the <code>com.redhat.cloudnative.catalog</code> package
and extend the <a href="https://oreil.ly/gPUjj">CrudRepository interface</a> in order to indicate to Spring that you want to expose a complete set of methods to manipulate the entity.</p>

<p>You can find it in this <a href="https://oreil.ly/CIGc5">book’s GitHub repository</a>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">com</code><code class="o">.</code><code class="na">redhat</code><code class="o">.</code><code class="na">cloudnative</code><code class="o">.</code><code class="na">catalog</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.data.repository.CrudRepository</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">interface</code><code> </code><code class="nc">ProductRepository</code><code> </code><code class="kd">extends</code><code> </code><code class="n">CrudRepository</code><code class="o">&lt;</code><code class="n">Product</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO9-1" href="#callout_the_path_to_cloud_native_java_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO9-1" href="#co_the_path_to_cloud_native_java_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><a href="https://oreil.ly/eRvCG">CrudRepository</a>: interface used to indicate to Spring that we want to expose a complete set of methods to manipulate the entity</p></dd>
</dl>

<p>Now that we have a domain model and a repository to retrieve the domain model, let’s create a RESTful service that returns the list of products.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Create a RESTful Service"><div class="sect2" id="idm45261448813600">
<h2>Create a RESTful Service</h2>

<p>Spring Boot uses Spring Web MVC as the default RESTful stack in Spring applications. We will now create a <a data-type="indexterm" data-primary="Spring Boot" data-secondary="Catalog Service" data-tertiary="RESTful service" id="SpngCatREST"/><a data-type="indexterm" data-primary="RESTful services, Spring Boot" id="RESTSBcatserv"/><a data-type="indexterm" data-primary="Catalog Service" data-secondary="Spring Boot" data-tertiary="RESTful service" id="catservSBREST"/>new Java class named <code>CatalogController</code> in the <code>com.redhat.cloudnative.catalog</code> package for that, exposing a REST endpoint. We’ll use the following:</p>

<ul>
<li>
<p>Path: <em>/api/catalog/</em></p>
</li>
<li>
<p>HTTP Method: <code>GET</code></p>
</li>
</ul>

<p>This returns a catalog for all items available in the store, matching items from Inventory service with data from Catalog service.</p>

<p>You can find it in this <a href="https://oreil.ly/SjQ4h">book’s GitHub repository</a>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">com</code><code class="o">.</code><code class="na">redhat</code><code class="o">.</code><code class="na">cloudnative</code><code class="o">.</code><code class="na">catalog</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.List</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Spliterator</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.stream.Collectors</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.stream.StreamSupport</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.beans.factory.annotation.Autowired</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.http.MediaType</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.web.bind.annotation.GetMapping</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.web.bind.annotation.RequestMapping</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.web.bind.annotation.ResponseBody</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.springframework.web.bind.annotation.RestController</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@RestController</code><code>
</code><code class="nd">@RequestMapping</code><code class="o">(</code><code class="n">value</code><code> </code><code class="o">=</code><code> </code><code class="s">"/api/catalog"</code><code class="o">)</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO10-1" href="#callout_the_path_to_cloud_native_java_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">CatalogController</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="nd">@Autowired</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO10-2" href="#callout_the_path_to_cloud_native_java_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">ProductRepository</code><code> </code><code class="n">repository</code><code class="o">;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO10-3" href="#callout_the_path_to_cloud_native_java_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@ResponseBody</code><code>
</code><code>    </code><code class="nd">@GetMapping</code><code class="o">(</code><code class="n">produces</code><code> </code><code class="o">=</code><code> </code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON_VALUE</code><code class="o">)</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">List</code><code class="o">&lt;</code><code class="n">Product</code><code class="o">&gt;</code><code> </code><code class="nf">getAll</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">Spliterator</code><code class="o">&lt;</code><code class="n">Product</code><code class="o">&gt;</code><code> </code><code class="n">products</code><code> </code><code class="o">=</code><code> </code><code class="n">repository</code><code class="o">.</code><code class="na">findAll</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">spliterator</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">return</code><code>
</code><code>          </code><code class="n">StreamSupport</code><code class="o">.</code><code class="na">stream</code><code class="o">(</code><code class="n">products</code><code class="o">,</code><code> </code><code class="kc">false</code><code class="o">)</code><code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toList</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO10-1" href="#co_the_path_to_cloud_native_java_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>@RequestMapping</code> indicates the above REST service defines an endpoint that is accessible via HTTP <code>GET</code> at <em>/api/catalog</em>.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO10-2" href="#co_the_path_to_cloud_native_java_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Spring Boot automatically provides an implementation for <code>ProductRepository</code> at runtime and injects it into the controller using the <a href="https://oreil.ly/nuvh0"><code>@Autowired</code> annotation</a>.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO10-3" href="#co_the_path_to_cloud_native_java_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The <code>repository</code> attribute on the controller class is used to retrieve the list of products from the databases.</p></dd>
</dl>

<p>Everything is now ready to start our second microservice, which will listen to port 9000 to avoid conflicts with the other one:</p>

<pre data-type="programlisting" data-code-language="bash">mvn spring-boot:run</pre>

<p>You should see an output like this:</p>

<pre data-type="programlisting">[INFO] --- spring-boot-maven-plugin:2.1.4.RELEASE-redhat-00001:run (default-cli)
↳ @ catalog ---
[INFO] Attaching agents: []
2020-12-02 17:12:18.528  INFO 61053 --- [           main]↳
trationDelegate$BeanPostProcessorChecker : Bean 'org.springframework.cloud.auto
configure.ConfigurationPropertiesRebinderAutoConfiguration' of type [org.
springframework.cloud.autoconfigure.ConfigurationPropertiesRebinder
AutoConfiguration$$EnhancerBySpringCGLIB$$e898759c] is not eligible for getting
processed by all BeanPostProcessors (for example: not eligible for auto-proxying)</pre>

<pre data-type="programlisting" class="pagebreak-before">  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.1.6.RELEASE)
StandardService   : Starting service [Tomcat]
2020-12-02 17:12:20.064  INFO 61053 --- [           main]↳
org.apache.catalina.core.StandardEngine  : Starting Servlet Engine:
  Apache Tomcat/9.0.7.redhat-16
2020-12-02 17:12:20.220  INFO 61053 --- [           main]↳
o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded
  WebApplicationContext
2020-12-02 17:12:20.220  INFO 61053 --- [           main]↳
...</pre>

<p>Your app is now listening on port <em>9000</em> to the endpoint we configured; you can verify it by navigating to <a href="http://localhost:9000/api/catalog"><em class="hyperlink">http://localhost:9000/api/catalog</em></a>.</p>

<p>You should see this output from the REST API returning a JSON object representing the product list:</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">[</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"100000"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Red Fedora"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"Official Red Hat Fedora"</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">34.99</code>
   <code class="p">},</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"329299"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Quarkus T-shirt"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"This updated unisex essential fits like a well-loved</code>
<code class="s2">      favorite,↳ featuring a crew neck, short sleeves and designed with superior</code>
<code class="s2">      combed and↳ ring- spun cotton."</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">10.0</code>
   <code class="p">},</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"329199"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Pronounced Kubernetes"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"Kubernetes is changing how enterprises work in the cloud.↳</code>
<code class="s2">      But one of the biggest questions people have is: How do you pronounce it?"</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">9.0</code>
   <code class="p">},</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"165613"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Knit socks"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"Your brand will get noticed on these full color knit</code>
<code class="s2">      socks.↳ Imported."</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">4.15</code>
   <code class="p">},</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"165614"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Quarkus H2Go water bottle"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"Sporty 16. 9 oz double wall stainless steel thermal bottle↳</code>
<code class="s2">      with copper vacuum insulation, and threaded insulated lid. Imprinted.</code>
<code class="s2">      Imported."</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">14.45</code>
   <code class="p">},</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"165954"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Patagonia Refugio pack 28L"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"Made from 630-denier 100% nylon (50% recycled / 50%</code>
<code class="s2">      high-tenacity)↳ plain weave; lined with 200-denier 100% recycled polyester.</code>
<code class="s2">      ..."</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">6.0</code>
   <code class="p">},</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"444434"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Red Hat Impact T-shirt"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"This 4. 3 ounce, 60% combed ringspun cotton/40% polyester↳</code>
<code class="s2">      jersey t- shirt features a slightly heathered appearance. The fabric↳</code>
<code class="s2">      laundered for reduced shrinkage. Next Level brand apparel. Printed."</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">9.0</code>
   <code class="p">},</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"444435"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Quarkus twill cap"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"100% cotton chino twill cap with an unstructured,</code>
<code class="s2">      low-profile,↳ six-panel design. The crown measures 3 1/8 and this</code>
<code class="s2">      features a Permacurv↳ visor and a buckle closure with a grommet."</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">13.0</code>
   <code class="p">},</code>
   <code class="p">{</code>
      <code class="nt">"itemId"</code><code class="p">:</code><code class="s2">"444437"</code><code class="p">,</code>
      <code class="nt">"name"</code><code class="p">:</code><code class="s2">"Nanobloc Universal Webcam Cover"</code><code class="p">,</code>
      <code class="nt">"description"</code><code class="p">:</code><code class="s2">"NanoBloc Webcam Cover fits phone, laptop, desktop, PC,↳</code>
<code class="s2">      MacBook Pro, iMac, ..."</code><code class="p">,</code>
      <code class="nt">"price"</code><code class="p">:</code><code class="mf">2.75</code>
   <code class="p">}</code>
<code class="p">]</code></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The output has been formatted in <em>pretty</em> mode in the book’s code listing. You’ll notice the combination of our items from the Quarkus Inventory microservice with the description and the price from the Spring Boot Catalog microservice. If you recall the info from the previous test with item 329299, it’s a Quarkus T-shirt.</p>
</div>

<p>Congratulations on creating your second <a data-type="indexterm" data-primary="Spring Boot" data-secondary="Catalog Service" data-tertiary="RESTful service" data-startref="SpngCatREST" id="idm45261448935344"/><a data-type="indexterm" data-primary="RESTful services, Spring Boot" data-startref="RESTSBcatserv" id="idm45261448332544"/><a data-type="indexterm" data-primary="Catalog Service" data-secondary="Spring Boot" data-tertiary="RESTful service" data-startref="catservSBREST" id="idm45261448331584"/>microservice; now it’s time to connect a frontend to our backends. In order to do it, we <a data-type="indexterm" data-primary="microservices" data-secondary="Catalog Service" data-tertiary="Spring Boot" data-startref="microCat" id="idm45261448329856"/>will use a software API gateway with reactive Java in the next section.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Create a Gateway Service with Vert.x"><div class="sect1" id="idm45261449598720">
<h1>Create a Gateway Service with Vert.x</h1>

<p><a href="https://vertx.io">Eclipse Vert.x</a> is an event-driven <a data-type="indexterm" data-primary="microservices" data-secondary="Gateway service" data-tertiary="Vert.x" id="microGateVert"/><a data-type="indexterm" data-primary="Gateway service" data-secondary="Vert.x" id="GateVert"/><a data-type="indexterm" data-primary="Vert.x" data-secondary="Gateway service" id="VertGate"/>toolkit for building reactive applications on the Java Virtual Machine (JVM). Vert.x does not impose a specific framework or packaging model; it can be used within your existing applications and frameworks in order to add reactive functionality by just adding the Vert.x jar files to the application 
<span class="keep-together">classpath</span>.</p>

<p>Eclipse Vert.x enables building reactive systems as defined by <a href="https://oreil.ly/jCg8t">The Reactive Manifesto</a> and builds services that are:</p>

<ul>
<li>
<p>Responsive: to handle requests in a reasonable time</p>
</li>
<li>
<p>Resilient: to stay responsive in the face of failures</p>
</li>
<li>
<p>Elastic: to stay responsive under various loads and be able to scale up and down</p>
</li>
<li>
<p>Message-driven: components interact using asynchronous message passing</p>
</li>
</ul>

<p>It is designed to be event-driven and nonblocking. In fact, events are delivered into an event loop that must never be blocked. Unlike traditional applications, Vert.x uses a very small number of threads responsible for dispatching the events to event handlers. If the event loop is blocked, the events won’t be delivered anymore and therefore the code needs to be mindful of this execution model (as shown in <a data-type="xref" href="#fig2-7">Figure 2-7</a>).</p>

<figure><div id="fig2-7" class="figure">
<img src="Images/moej_0207.png" alt="Vert.x Event Loop" width="600" height="284"/>
<h6><span class="label">Figure 2-7. </span>Vert.x event loop</h6>
</div></figure>

<p>In our architecture, this microservice will act as an asynchronous software API gateway, developed as a reactive Java microservice that efficiently routes and dispatches the traffic to the Inventory and Catalog component of our cloud native ecommerce website, as displayed in <a data-type="xref" href="#fig2-8">Figure 2-8</a>.</p>

<figure><div id="fig2-8" class="figure">
<img src="Images/moej_0208.png" alt="API Gateway Vert.x microservice" width="337" height="507"/>
<h6><span class="label">Figure 2-8. </span>API gateway Vert.x microservice</h6>
</div></figure>

<p>You can find the source code of this microservice in this <a href="https://oreil.ly/6pe8n">book’s GitHub repository</a>.</p>








<section data-type="sect2" data-pdf-bookmark="Create a Vert.x Maven Project"><div class="sect2" id="idm45261448307424">
<h2>Create a Vert.x Maven Project</h2>

<p>Vert.x supports both <a data-type="indexterm" data-primary="Vert.x" data-secondary="Maven project" id="VertMav"/><a data-type="indexterm" data-primary="Maven" data-secondary="Vert.x project" id="MavVert"/>Maven and Gradle, and the easiest way to bootstrap a new Vert.x Maven project is through <a href="https://oreil.ly/fuaVI">a template project structure offered by the Vert.x community</a>. In our case, we are using Red Hat Maven repositories and added the settings shown in <a data-type="xref" href="#vertx_maven_project_options">Table 2-3</a>.</p>
<table id="vertx_maven_project_options">
<caption><span class="label">Table 2-3. </span>Vert.x Maven Project Options</caption>
<thead>
<tr>
<th>Key</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>modelVersion</code></p></td>
<td><p><code>4.0.0</code></p></td>
<td><p>POM model version (always 4.0.0).</p></td>
</tr>
<tr>
<td><p><code>groupId</code></p></td>
<td><p><code>com.redhat.cloudnative</code></p></td>
<td><p>Group or organization that the project belongs to. Often expressed as an inverted domain name.</p></td>
</tr>
<tr>
<td><p><code>artifactId</code></p></td>
<td><p><code>gateway</code></p></td>
<td><p>Name to be given to the project’s library artifact (a JAR in this case).</p></td>
</tr>
<tr>
<td><p><code>version</code></p></td>
<td><p><code>1.0-SNAPSHOT</code></p></td>
<td><p>Version of the project that is being built.</p></td>
</tr>
<tr>
<td><p><code>name</code></p></td>
<td><p><code>CoolStore Gateway Service</code></p></td>
<td><p>Name of the app.</p></td>
</tr>
</tbody>
</table>

<p>Let’s have a look at how <a data-type="indexterm" data-primary="pom.xml file" id="idm45261448207360"/>the <em>pom.xml</em> will look:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code><code>
</code><code class="nt">&lt;project</code><code> </code><code class="na">xmlns=</code><code class="s">"http://maven.apache.org/POM/4.0.0"</code><code class="err">↳</code><code>
</code><code class="na">xmlns:xsi=</code><code class="s">"http://www.w3.org/2001/XMLSchema-instance"</code><code class="err">↳</code><code>
</code><code class="na">xsi:schemaLocation=</code><code class="s">"http://maven.apache.org/POM/4.0.0
  http://maven.apache.org/xsd/maven-4.0.0.xsd"</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;modelVersion</code><code class="nt">&gt;</code><code>4.0.0</code><code class="nt">&lt;/modelVersion&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO11-1" href="#callout_the_path_to_cloud_native_java_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
    </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>com.redhat.cloudnative</code><code class="nt">&lt;/groupId&gt;</code><code>
    </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>gateway</code><code class="nt">&lt;/artifactId&gt;</code><code>
    </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>1.0-SNAPSHOT</code><code class="nt">&lt;/version&gt;</code><code>
    </code><code class="nt">&lt;packaging</code><code class="nt">&gt;</code><code>jar</code><code class="nt">&lt;/packaging&gt;</code><code>
    </code><code class="nt">&lt;name</code><code class="nt">&gt;</code><code>CoolStore Gateway Service</code><code class="nt">&lt;/name&gt;</code><code>
    </code><code class="nt">&lt;description</code><code class="nt">&gt;</code><code>CoolStore Gateway Service with Eclipse Vert.x</code><code class="nt">&lt;/description&gt;</code><code>

    </code><code class="nt">&lt;properties</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;vertx.version</code><code class="nt">&gt;</code><code>3.6.3.redhat-00009</code><code class="nt">&lt;/vertx.version&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO11-2" href="#callout_the_path_to_cloud_native_java_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;vertx-maven-plugin.version</code><code class="nt">&gt;</code><code>1.0.15</code><code class="nt">&lt;/vertx-maven-plugin.version&gt;</code><code>
        </code><code class="nt">&lt;vertx.verticle</code><code class="nt">&gt;</code><code>com.redhat.cloudnative.gateway.GatewayVerticle↳
        </code><code class="nt">&lt;/vertx.verticle&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO11-3" href="#callout_the_path_to_cloud_native_java_CO11-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;fabric8.maven.plugin.version</code><code class="nt">&gt;</code><code>4.3.0</code><code class="nt">&lt;/fabric8.maven.plugin.version&gt;</code><code>
        </code><code class="nt">&lt;slf4j.version</code><code class="nt">&gt;</code><code>1.7.21</code><code class="nt">&lt;/slf4j.version&gt;</code><code>
    </code><code class="nt">&lt;/properties&gt;</code><code>
...
    </code><code class="nt">&lt;dependencyManagement</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;dependencies</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
                </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.vertx</code><code class="nt">&lt;/groupId&gt;</code><code>
                </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>vertx-dependencies</code><code class="nt">&lt;/artifactId&gt;</code><code>
                </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>${vertx.version}</code><code class="nt">&lt;/version&gt;</code><code>
                </code><code class="nt">&lt;type</code><code class="nt">&gt;</code><code>pom</code><code class="nt">&lt;/type&gt;</code><code>
                </code><code class="nt">&lt;scope</code><code class="nt">&gt;</code><code>import</code><code class="nt">&lt;/scope&gt;</code><code>
            </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;/dependencies&gt;</code><code>
    </code><code class="nt">&lt;/dependencyManagement&gt;</code><code>

    </code><code class="nt">&lt;dependencies</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO11-4" href="#callout_the_path_to_cloud_native_java_CO11-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.vertx</code><code class="nt">&lt;/groupId&gt;</code><code>
            </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>vertx-core</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.vertx</code><code class="nt">&lt;/groupId&gt;</code><code>
            </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>vertx-config</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.vertx</code><code class="nt">&lt;/groupId&gt;</code><code>
            </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>vertx-web</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.vertx</code><code class="nt">&lt;/groupId&gt;</code><code>
            </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>vertx-web-client</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.vertx</code><code class="nt">&lt;/groupId&gt;</code><code>
            </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>vertx-rx-java2</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>io.vertx</code><code class="nt">&lt;/groupId&gt;</code><code>
            </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>vertx-health-check</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>org.slf4j</code><code class="nt">&lt;/groupId&gt;</code><code>
            </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>slf4j-api</code><code class="nt">&lt;/artifactId&gt;</code><code>
            </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>${slf4j.version}</code><code class="nt">&lt;/version&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
        </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>org.slf4j</code><code class="nt">&lt;/groupId&gt;</code><code>
            </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>slf4j-jdk14</code><code class="nt">&lt;/artifactId&gt;</code><code>
            </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>${slf4j.version}</code><code class="nt">&lt;/version&gt;</code><code>
        </code><code class="nt">&lt;/dependency&gt;</code><code>
    </code><code class="nt">&lt;/dependencies&gt;</code><code>
...
</code><code class="nt">&lt;/project&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO11-1" href="#co_the_path_to_cloud_native_java_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Project metadata</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO11-2" href="#co_the_path_to_cloud_native_java_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Vert.x version used</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO11-3" href="#co_the_path_to_cloud_native_java_CO11-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p><code>GatewayVerticle</code>: the name of the main verticle; it’s <a data-type="indexterm" data-primary="Vert.x" data-secondary="Maven project" data-startref="VertMav" id="idm45261447859952"/><a data-type="indexterm" data-primary="Maven" data-secondary="Vert.x project" data-startref="MavVert" id="idm45261447858704"/>the entry point for our app</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO11-4" href="#co_the_path_to_cloud_native_java_CO11-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>A list of dependecies:</p>

<ul>
<li>
<p>Vert.x libraries:  <em>vertx-core</em>, <em>vertx-config</em>, <em>vertx-web</em>, <em>vertx-web-client</em></p>
</li>
<li>
<p><a href="https://oreil.ly/ynXXu">Rx support for Vert.x</a>: vertx-rx-java2</p>
</li>
</ul></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Create an API Gateway"><div class="sect2" id="idm45261447850448">
<h2>Create an API Gateway</h2>

<p>Next, we want to create an API gateway <a data-type="indexterm" data-primary="Vert.x" data-secondary="API gateway" id="VertAPI"/>as the entry point for the web frontend of our website, to access all backend services from a single place. This pattern is predictably called <a href="https://oreil.ly/6oZaE">API gateway</a> and is a common practice in microservices architecture.</p>

<p>The unit of deployment in Vert.x is <a data-type="indexterm" data-primary="Vert.x" data-secondary="verticles" id="idm45261447846112"/>called a <em>verticle</em>. A verticle processes incoming events over an event loop, where events can be anything such as receiving network buffers, timing events, or messages sent by other verticles.</p>

<p>We define our main verticle as GatewayVerticle as <a data-type="indexterm" data-primary="Vert.x" data-secondary="GatewayVerticle" id="idm45261447843984"/>we declared it previously in the <em>pom.xml</em>, and expose the REST endpoint that will be routed to the Catalog 
<span class="keep-together"><code>/api/catalog</code></span>:</p>

<ul>
<li>
<p>Path: <em>/api/catalog/</em></p>
</li>
<li>
<p>HTTP Method: <code>GET</code></p>
</li>
</ul>

<p>This routes the traffic to Catalog and returns a JSON object containing all items available in the store, matching items from Inventory service with data from Catalog service.</p>

<p>You can find it in this <a href="https://oreil.ly/vkevU">book’s GitHub repository</a>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">com</code><code class="o">.</code><code class="na">redhat</code><code class="o">.</code><code class="na">cloudnative</code><code class="o">.</code><code class="na">gateway</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.core.http.HttpMethod</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.core.json.JsonArray</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.core.json.JsonObject</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.ext.web.client.WebClientOptions</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.config.ConfigRetriever</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.core.AbstractVerticle</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.ext.web.Router</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.ext.web.RoutingContext</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.ext.web.client.WebClient</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.ext.web.client.predicate.ResponsePredicate</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.ext.web.codec.BodyCodec</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.ext.web.handler.CorsHandler</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.vertx.reactivex.ext.web.handler.StaticHandler</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.slf4j.Logger</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.slf4j.LoggerFactory</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.reactivex.Observable</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.reactivex.Single</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.ArrayList</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.List</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GatewayVerticle</code><code> </code><code class="kd">extends</code><code> </code><code class="n">AbstractVerticle</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO12-1" href="#callout_the_path_to_cloud_native_java_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="n">Logger</code><code> </code><code class="n">LOG</code><code> </code><code class="o">=</code><code> </code><code class="n">LoggerFactory</code><code class="o">.</code><code class="na">getLogger</code><code class="o">(</code><code>
</code><code>        </code><code class="n">GatewayVerticle</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">WebClient</code><code> </code><code class="n">catalog</code><code class="o">;</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">WebClient</code><code> </code><code class="n">inventory</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">start</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO12-2" href="#callout_the_path_to_cloud_native_java_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">Router</code><code> </code><code class="n">router</code><code> </code><code class="o">=</code><code> </code><code class="n">Router</code><code class="o">.</code><code class="na">router</code><code class="o">(</code><code class="n">vertx</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO12-3" href="#callout_the_path_to_cloud_native_java_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">router</code><code class="o">.</code><code class="na">route</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">handler</code><code class="o">(</code><code class="n">CorsHandler</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="s">"*"</code><code class="o">)</code><code class="err">↳</code><code>
</code><code>        </code><code class="o">.</code><code class="na">allowedMethod</code><code class="o">(</code><code class="n">HttpMethod</code><code class="o">.</code><code class="na">GET</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">router</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"/*"</code><code class="o">)</code><code class="o">.</code><code class="na">handler</code><code class="o">(</code><code class="n">StaticHandler</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="s">"assets"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">router</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"/health"</code><code class="o">)</code><code class="o">.</code><code class="na">handler</code><code class="o">(</code><code class="k">this</code><code class="o">:</code><code class="o">:</code><code class="n">health</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">router</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"/api/products"</code><code class="o">)</code><code class="o">.</code><code class="na">handler</code><code class="o">(</code><code class="k">this</code><code class="o">:</code><code class="o">:</code><code class="n">products</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO12-4" href="#callout_the_path_to_cloud_native_java_CO12-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>
</code><code>        </code><code class="n">ConfigRetriever</code><code> </code><code class="n">retriever</code><code> </code><code class="o">=</code><code> </code><code class="n">ConfigRetriever</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="n">vertx</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">retriever</code><code class="o">.</code><code class="na">getConfig</code><code class="o">(</code><code class="n">ar</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">ar</code><code class="o">.</code><code class="na">failed</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>                </code><code class="c1">// Failed to retrieve the configuration
</code><code>            </code><code class="o">}</code><code> </code><code class="k">else</code><code> </code><code class="o">{</code><code>
</code><code>                </code><code class="n">JsonObject</code><code> </code><code class="n">config</code><code> </code><code class="o">=</code><code> </code><code class="n">ar</code><code class="o">.</code><code class="na">result</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>                </code><code class="n">String</code><code> </code><code class="n">catalogApiHost</code><code> </code><code class="o">=</code><code class="err">↳</code><code>
</code><code>                </code><code class="n">config</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"COMPONENT_CATALOG_HOST"</code><code class="o">,</code><code> </code><code class="s">"localhost"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>                </code><code class="n">Integer</code><code> </code><code class="n">catalogApiPort</code><code> </code><code class="o">=</code><code class="err">↳</code><code>
</code><code>                </code><code class="n">config</code><code class="o">.</code><code class="na">getInteger</code><code class="o">(</code><code class="s">"COMPONENT_CATALOG_PORT"</code><code class="o">,</code><code> </code><code class="mi">9000</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>                </code><code class="n">catalog</code><code> </code><code class="o">=</code><code> </code><code class="n">WebClient</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="n">vertx</code><code class="o">,</code><code>
</code><code>                    </code><code class="k">new</code><code> </code><code class="nf">WebClientOptions</code><code class="o">(</code><code class="o">)</code><code>
</code><code>                        </code><code class="o">.</code><code class="na">setDefaultHost</code><code class="o">(</code><code class="n">catalogApiHost</code><code class="o">)</code><code>
</code><code>                        </code><code class="o">.</code><code class="na">setDefaultPort</code><code class="o">(</code><code class="n">catalogApiPort</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO12-5" href="#callout_the_path_to_cloud_native_java_CO12-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>
</code><code>                </code><code class="n">LOG</code><code class="o">.</code><code class="na">info</code><code class="o">(</code><code class="s">"Catalog Service Endpoint: "</code><code> </code><code class="o">+</code><code> </code><code class="n">catalogApiHost</code><code class="err">↳</code><code>
</code><code>                </code><code class="o">+</code><code> </code><code class="s">":"</code><code> </code><code class="o">+</code><code> </code><code class="n">catalogApiPort</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>                </code><code class="n">String</code><code> </code><code class="n">inventoryApiHost</code><code> </code><code class="o">=</code><code class="err">↳</code><code>
</code><code>                </code><code class="n">config</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"COMPONENT_INVENTORY_HOST"</code><code class="o">,</code><code> </code><code class="s">"localhost"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>                </code><code class="n">Integer</code><code> </code><code class="n">inventoryApiPort</code><code> </code><code class="o">=</code><code class="err">↳</code><code>
</code><code>                </code><code class="n">config</code><code class="o">.</code><code class="na">getInteger</code><code class="o">(</code><code class="s">"COMPONENT_INVENTORY_PORT"</code><code class="o">,</code><code> </code><code class="mi">8080</code><code class="o">;</code><code>
</code><code>
</code><code>                </code><code class="n">inventory</code><code> </code><code class="o">=</code><code> </code><code class="n">WebClient</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="n">vertx</code><code class="o">,</code><code>
</code><code>                    </code><code class="k">new</code><code> </code><code class="nf">WebClientOptions</code><code class="o">(</code><code class="o">)</code><code>
</code><code>                        </code><code class="o">.</code><code class="na">setDefaultHost</code><code class="o">(</code><code class="n">inventoryApiHost</code><code class="o">)</code><code>
</code><code>                        </code><code class="o">.</code><code class="na">setDefaultPort</code><code class="o">(</code><code class="n">inventoryApiPort</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO12-6" href="#callout_the_path_to_cloud_native_java_CO12-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>
</code><code>                </code><code class="n">LOG</code><code class="o">.</code><code class="na">info</code><code class="o">(</code><code class="s">"Inventory Service Endpoint: "</code><code class="err">↳</code><code>
</code><code>                </code><code class="o">+</code><code> </code><code class="n">inventoryApiHost</code><code> </code><code class="o">+</code><code> </code><code class="s">":"</code><code> </code><code class="o">+</code><code> </code><code class="n">inventoryApiPort</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>                </code><code class="n">vertx</code><code class="o">.</code><code class="na">createHttpServer</code><code class="o">(</code><code class="o">)</code><code>
</code><code>                    </code><code class="o">.</code><code class="na">requestHandler</code><code class="o">(</code><code class="n">router</code><code class="o">)</code><code>
</code><code>                    </code><code class="o">.</code><code class="na">listen</code><code class="o">(</code><code class="n">Integer</code><code class="o">.</code><code class="na">getInteger</code><code class="o">(</code><code class="s">"http.port"</code><code class="o">,</code><code> </code><code class="mi">8090</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_the_path_to_cloud_native_java_CO12-7" href="#callout_the_path_to_cloud_native_java_CO12-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>
</code><code>                </code><code class="n">LOG</code><code class="o">.</code><code class="na">info</code><code class="o">(</code><code class="s">"Server is running on port "</code><code class="err">↳</code><code>
</code><code>                </code><code class="o">+</code><code> </code><code class="n">Integer</code><code class="o">.</code><code class="na">getInteger</code><code class="o">(</code><code class="s">"http.port"</code><code class="o">,</code><code> </code><code class="mi">8090</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>            </code><code class="o">}</code><code>
</code><code>        </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="kt">void</code><code> </code><code class="nf">products</code><code class="o">(</code><code class="n">RoutingContext</code><code> </code><code class="n">rc</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">Single</code><code class="o">&lt;</code><code class="n">JsonObject</code><code class="o">&gt;</code><code> </code><code class="nf">getAvailabilityFromInventory</code><code class="o">(</code><code class="n">JsonObject</code><code> </code><code class="n">product</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="kt">void</code><code> </code><code class="nf">health</code><code class="o">(</code><code class="n">RoutingContext</code><code> </code><code class="n">rc</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO12-1" href="#co_the_path_to_cloud_native_java_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>A <code>Verticle</code> is created by extending from <code>AbstractVerticle</code> class.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO12-2" href="#co_the_path_to_cloud_native_java_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The <code>start()</code> method creates an HTTP server.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO12-3" href="#co_the_path_to_cloud_native_java_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>A <code>Router</code> is retrieved for mapping the REST endpoints.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO12-4" href="#co_the_path_to_cloud_native_java_CO12-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>A REST endpoint is created for mapping <code>/api/catalog</code> Catalog endpoint through a <code>product()</code> function that will retrieve the content.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO12-5" href="#co_the_path_to_cloud_native_java_CO12-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>An HTTP Server is created that listens on port 8090.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO12-6" href="#co_the_path_to_cloud_native_java_CO12-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Give <code>Inventory</code> microservice a hostname and port to connect to.</p></dd>
<dt><a class="co" id="callout_the_path_to_cloud_native_java_CO12-7" href="#co_the_path_to_cloud_native_java_CO12-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>The microservice supports ENV vars to change its hostname and port from Properties; this is important for the portability of our architecture across clouds.</p></dd>
</dl>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>We use port 8090 to avoid conflict while running it in local development. The port number can also be changed with a property file as described in <a href="https://oreil.ly/OgGIP">the Vert.x Config doc</a>. When developing with microservices, the use of environment variables to map hosts and ports is highly encouraged; we use them to map Inventory and Catalog endpoints dynamically.</p>
</div>

<p>We are now ready to start our API gateway:</p>

<pre data-type="programlisting" data-code-language="bash">mvn compile vertx:run</pre>

<p>The output should be similar to this:</p>

<pre data-type="programlisting">[INFO] Scanning for projects...
[INFO]
[INFO] -------------------&lt; com.redhat.cloudnative:gateway &gt;-------------------
[INFO] Building CoolStore Gateway Service 1.0-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- vertx-maven-plugin:1.0.15:initialize (vmp) @ gateway ---
[INFO]
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ gateway ---
[WARNING] Using platform encoding (UTF-8 actually) to copy filtered resources,↳
i.e. build is platform dependent!
[INFO] Copying 3 resources
[INFO]
[INFO] --- maven-compiler-plugin:3.6.1:compile (default-compile) @ gateway ---
[INFO] Changes detected - recompiling the module!
[WARNING] File encoding has not been set, using platform encoding UTF-8,↳
i.e. build is platform dependent!
[INFO] Compiling 1 source file to↳
/home/bluesman/git/cloud-native-java2/↳
labs/gateway-vertx/target/classes
...
 com.redhat.cloudnative.gateway.GatewayVerticle↳
lambda$start$0
[INFO] INFO: Catalog Service Endpoint: localhost:9000
[INFO] dic 02, 2020 6:56:56 PM com.redhat.cloudnative.gateway.GatewayVerticle↳
lambda$start$0
[INFO] INFO: Inventory Service Endpoint: localhost:8080
[INFO] dic 02, 2020 6:56:56 PM com.redhat.cloudnative.gateway.GatewayVerticle↳
lambda$start$0
[INFO] INFO: Server is running on port 8090
[INFO] dic 02, 2020 6:56:56 PM</pre>

<p>Let’s verify it is up and running and correctly routing traffic by navigating to <a href="http://localhost:8090/api/products"><em class="hyperlink">http://localhost:8090/api/products</em></a>.</p>

<p>You should get the JSON object from Catalog’s endpoint, in the pretty format:</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">[</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"165613"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Knit socks"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"Your brand will get noticed on these full color knit socks.↳</code>
<code class="s2">  Imported."</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">4.15</code><code class="p">,</code>
  <code class="nt">"availability"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"quantity"</code> <code class="p">:</code> <code class="mi">45</code>
  <code class="p">}</code>
<code class="p">},</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"165614"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Quarkus H2Go water bottle"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"Sporty 16. 9 oz double wall stainless steel thermal bottle↳</code>
<code class="s2">  with copper vacuum insulation, and threaded insulated lid. Imprinted.</code>
<code class="s2">    Imported."</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">14.45</code><code class="p">,</code>
  <code class="nt">"availability"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"quantity"</code> <code class="p">:</code> <code class="mi">87</code>
  <code class="p">}</code>
<code class="p">},</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"329199"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Pronounced Kubernetes"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"Kubernetes is changing how enterprises work in the cloud.↳</code>
<code class="s2">  But one of the biggest questions people have is: How do you pronounce it?"</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">9.0</code><code class="p">,</code>
  <code class="nt">"availability"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"quantity"</code> <code class="p">:</code> <code class="mi">12</code>
  <code class="p">}</code>
<code class="p">},</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"100000"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Red Fedora"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"Official Red Hat Fedora"</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">34.99</code><code class="p">,</code>
  <code class="nt">"availability"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"quantity"</code> <code class="p">:</code> <code class="mi">0</code>
  <code class="p">}</code>
<code class="p">},</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"329299"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Quarkus T-shirt"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"This updated unisex essential fits like a well-loved favorite,</code>
<code class="s2">  ↳ featuring a crew neck, short sleeves and designed with superior combed</code>
<code class="s2">  and ring-↳ spun cotton."</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">10.0</code><code class="p">,</code>
  <code class="nt">"availability"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"quantity"</code> <code class="p">:</code> <code class="mi">35</code>
  <code class="p">}</code>
<code class="p">},</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"165954"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Patagonia Refugio pack 28L"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"Made from 630-denier 100% nylon (50% recycled/50% ↳</code>
<code class="s2">  high-tenacity) plain weave; lined with 200-denier 100% recycled polyester..."</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">6.0</code><code class="p">,</code>
  <code class="nt">"availability"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"quantity"</code> <code class="p">:</code> <code class="mi">43</code>
  <code class="p">}</code>
<code class="p">},</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"444434"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Red Hat Impact T-shirt"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"This 4. 3 ounce, 60% combed ringspun cotton/40% polyester↳</code>
<code class="s2">  jersey t- shirt features a slightly heathered appearance. The fabric laundered↳</code>
<code class="s2">  for reduced shrinkage. Next Level brand apparel. Printed."</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">9.0</code><code class="p">,</code>
  <code class="nt">"availability"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"quantity"</code> <code class="p">:</code> <code class="mi">32</code>
  <code class="p">}</code>
<code class="p">},</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"444437"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Nanobloc Universal Webcam Cover"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"NanoBloc Webcam Cover fits phone, laptop, desktop, PC,↳</code>
<code class="s2">  MacBook Pro, iMac, ..."</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">2.75</code>
<code class="p">},</code> <code class="p">{</code>
  <code class="nt">"itemId"</code> <code class="p">:</code> <code class="s2">"444435"</code><code class="p">,</code>
  <code class="nt">"name"</code> <code class="p">:</code> <code class="s2">"Quarkus twill cap"</code><code class="p">,</code>
  <code class="nt">"description"</code> <code class="p">:</code> <code class="s2">"100% cotton chino twill cap with an unstructured,</code>
<code class="s2">  low-profile,↳ six-panel design. The crown measures 3 1/8 and this features a</code>
<code class="s2">  Permacurv↳ visor and a buckle closure with a grommet."</code><code class="p">,</code>
  <code class="nt">"price"</code> <code class="p">:</code> <code class="mf">13.0</code><code class="p">,</code>
  <code class="nt">"availability"</code> <code class="p">:</code> <code class="p">{</code>
    <code class="nt">"quantity"</code> <code class="p">:</code> <code class="mi">53</code>
  <code class="p">}</code>
<code class="p">}</code> <code class="p">]</code></pre>

<p>Our backend is now complete. We are <a data-type="indexterm" data-primary="microservices" data-secondary="Gateway service" data-tertiary="Vert.x" data-startref="microGateVert" id="idm45261447068288"/><a data-type="indexterm" data-primary="Gateway service" data-secondary="Vert.x" data-startref="GateVert" id="idm45261447066896"/><a data-type="indexterm" data-primary="Vert.x" data-secondary="Gateway service" data-startref="VertGate" id="idm45261447065680"/><a data-type="indexterm" data-primary="Vert.x" data-secondary="API gateway" data-startref="VertAPI" id="idm45261447064464"/>ready to provide some data to show from a nice frontend.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Create a Frontend with Node.js and AngularJS"><div class="sect1" id="idm45261448327776">
<h1>Create a Frontend with Node.js and AngularJS</h1>

<p><a href="https://nodejs.org">Node.js</a> is a <a data-type="indexterm" data-primary="microservices" data-secondary="frontend" id="microfront"/><a data-type="indexterm" data-primary="frontend web framework" id="frontframe"/><a data-type="indexterm" data-primary="web framework, frontends" id="framefront"/><a data-type="indexterm" data-primary="Node.js frontends" id="Nodfront"/><a data-type="indexterm" data-primary="AngularJS, frontends" id="Angfront"/>popular open source framework for asynchronous event-driven JavaScript development. Even if this is a book about modern Java development, in microservices architecture it is common to have a heterogeneous environment with multiple programming languages and frameworks involved. The challenge here is how to let them communicate efficiently. One solution is having a common interface like API gateway exchanging messages via REST calls or queue systems.</p>

<p>AngularJS is a JavaScript-based frontend web framework whose goal is to simplify both the development and the testing of such applications by providing a framework for client-side model–view–controller (MVC) and model–view–viewmodel (MVVM) architectures, as illustrated in <a data-type="xref" href="#fig2-9">Figure 2-9</a>. When used with Node.js, it provides a fast way to easily bootstrap a frontend.</p>

<figure><div id="fig2-9" class="figure">
<img src="Images/moej_0209.png" alt="Node.js + AngularJS Dashboard" width="337" height="509"/>
<h6><span class="label">Figure 2-9. </span>Node.js + AngularJS Dashboard</h6>
</div></figure>

<p>You can find the source code of this microservice in this <a href="https://oreil.ly/fv5aa">book’s GitHub repository</a>.</p>








<section data-type="sect2" data-pdf-bookmark="Run the Frontend"><div class="sect2" id="idm45261446863200">
<h2>Run the Frontend</h2>

<p>All the HTML and JavaScript code has <a data-type="indexterm" data-primary="microservices" data-secondary="frontend" data-tertiary="running" id="idm45261446861584"/><a data-type="indexterm" data-primary="frontend web framework" data-secondary="running" id="idm45261446860336"/><a data-type="indexterm" data-primary="web framework, frontends" data-secondary="running" id="idm45261446859392"/><a data-type="indexterm" data-primary="Node.js frontends" data-secondary="running" id="idm45261446858384"/><a data-type="indexterm" data-primary="AngularJS, frontends" data-secondary="running" id="idm45261446857440"/>been prepared, and we are ready to link this frontend to our backends showing our Coolstore app up and running.</p>










<section data-type="sect3" data-pdf-bookmark="Get NPM"><div class="sect3" id="idm45261446856112">
<h3>Get NPM</h3>

<p><a href="https://oreil.ly/aN4J3">NPM</a> is a package <a data-type="indexterm" data-primary="microservices" data-secondary="frontend" data-tertiary="NPM" id="idm45261446854256"/><a data-type="indexterm" data-primary="frontend web framework" data-secondary="NPM" id="idm45261446852976"/><a data-type="indexterm" data-primary="web framework, frontends" data-secondary="NPM" id="idm45261446852032"/><a data-type="indexterm" data-primary="Node.js frontends" data-secondary="NPM" id="idm45261446851072"/><a data-type="indexterm" data-primary="AngularJS, frontends" data-secondary="NPM" id="idm45261446850128"/><a data-type="indexterm" data-primary="npm packages" id="idm45261446849184"/>manager for JavaScript, similar to Maven, that will help us download all dependencies and start our frontend.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Install dependencies"><div class="sect3" id="idm45261446848000">
<h3>Install dependencies</h3>

<p>We can resolve all dependencies <a data-type="indexterm" data-primary="dependencies" data-secondary="installing" id="idm45261446846240"/><a data-type="indexterm" data-primary="microservices" data-secondary="frontend" data-tertiary="dependencies" id="idm45261446845264"/><a data-type="indexterm" data-primary="frontend web framework" data-secondary="dependencies" id="idm45261446844048"/><a data-type="indexterm" data-primary="web framework, frontends" data-secondary="dependencies" id="idm45261446843104"/><a data-type="indexterm" data-primary="Node.js frontends" data-secondary="dependencies" id="idm45261446842144"/><a data-type="indexterm" data-primary="AngularJS, frontends" data-secondary="dependencies" id="idm45261446841200"/>within the <code>web-nodejs</code> directory and by launching the <code>npm</code> command:</p>

<pre data-type="programlisting">npm install</pre>

<p>You should get an output like this:</p>

<pre data-type="programlisting">...
added 1465 packages from 723 contributors and audited 1471 packages in 26.368s

52 packages are looking for funding
  run `npm fund` for details

found 228 vulnerabilities (222 low, 6 high)
  run `npm audit fix` to fix them, or `npm audit` for details</pre>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Start the app"><div class="sect3" id="idm45261446837168">
<h3>Start the app</h3>

<p>We are now ready to verify if our frontend can correctly consume the backend services through the API gateway, mapping images with the data received. Since we are in local development, we will use the environment variable to change the Node.js default port to avoid conflicts. We will also use an environment variable to map the API gateway REST endpoint, as shown in <a data-type="xref" href="#frontend_environment_variables">Table 2-4</a>.</p>
<table id="frontend_environment_variables">
<caption><span class="label">Table 2-4. </span>Frontend environment variables</caption>
<thead>
<tr>
<th>ENV</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>PORT</code></p></td>
<td><p>3000</p></td>
<td><p>Global env for Node.js to map the port to use for starting the process; we use 3000 in this case.</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>COOLSTORE_GW_ENDPOINT</code></span></p></td>
<td><p><span class="keep-together"><code>http://localhost:8090</code></span></p></td>
<td><p>Enviroment variable defined in the frontend to map the API gateway service hostname.</p></td>
</tr>
</tbody>
</table>

<p>Start the app with this command:</p>

<pre data-type="programlisting" data-code-language="bash"><code class="nv">COOLSTORE_GW_ENDPOINT</code><code class="o">=</code>http://localhost:8090 <code class="nv">PORT</code><code class="o">=</code><code class="m">3000</code> npm start</pre>

<p>Navigate to the address where we exposed our Node.js app at <a href="http://localhost:3000"><em class="hyperlink">http://localhost:3000</em></a>.</p>

<p>Congratulations! Your cloud native Coolstore ecommerce <a data-type="indexterm" data-primary="microservices" data-secondary="frontend" data-startref="microfront" id="idm45261446794928"/><a data-type="indexterm" data-primary="frontend web framework" data-startref="frontframe" id="idm45261446793680"/><a data-type="indexterm" data-primary="web framework, frontends" data-startref="framefront" id="idm45261446792736"/><a data-type="indexterm" data-primary="Node.js frontends" data-startref="Nodfront" id="idm45261446791776"/><a data-type="indexterm" data-primary="AngularJS, frontends" data-startref="Angfront" id="idm45261446790832"/>website is up and running now; you can verify it in <a data-type="xref" href="#fig2-10">Figure 2-10</a>.</p>

<figure><div id="fig2-10" class="figure">
<img src="Images/moej_0210.png" alt="Coolstore Demo complete" width="600" height="421"/>
<h6><span class="label">Figure 2-10. </span>Coolstore demo complete</h6>
</div></figure>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm45261446786864">
<h1>Summary</h1>

<p>In this chapter, we walked through a complete microservices-based architecture implementation, using different Java frameworks for different components. We gave an overview on how to split the typical monolithic approach into a more diverse and heterogeneous environment, lightweight and ready to run in multiple contexts such as local development or production systems. This is an example of what we call cloud native development.</p>
</div></section>







</div></section></div></body></html>