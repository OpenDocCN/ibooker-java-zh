<html><head></head><body><section data-pdf-bookmark="Chapter 15. Packages and Packaging" data-type="chapter" epub:type="chapter"><div class="chapter" id="javacook-packages">&#13;
<h1><span class="label">Chapter 15. </span>Packages and Packaging</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.0 Introduction" data-type="sect1"><div class="sect1" id="javacook-packages-intro">&#13;
<h1>15.0 Introduction</h1>&#13;
&#13;
<p><a data-primary="packages" data-type="indexterm" id="pac_ch"/><a data-primary="Java" data-secondary="packages in" data-type="indexterm" id="idm45290635072488"/><a data-primary="packages" data-secondary="in Java" data-type="indexterm" id="idm45290635071640"/>One of the better aspects of the Java language is that it has defined&#13;
a very clear packaging mechanism for categorizing and managing its large&#13;
API. Contrast this with most other languages, where&#13;
symbols may be found in the C library itself or in any of dozens&#13;
of other libraries, with no clearly defined naming&#13;
conventions.<sup><a data-type="noteref" href="ch15.html#idm45290635070328" id="idm45290635070328-marker">1</a></sup> APIs&#13;
consist of one or more package, packages consist of classes, and classes&#13;
consist of methods and fields. Anybody can create a package, with&#13;
one important restriction: you or I cannot create a package whose&#13;
name begins with the four letters <code>java</code>. Packages named <code>java</code>.&#13;
or <span class="keep-together"><code>javax</code>.</span> are reserved for use by Oracle’s Java developers,&#13;
under the management of the <a data-primary="Java Community Process (JCP)" data-type="indexterm" id="idm45290635065592"/><a data-primary="JCP (Java Community Process)" data-type="indexterm" id="idm45290635064984"/>Java Community Process (JCP).&#13;
When Java was new, there were about a dozen packages in a structure&#13;
that is very much still with us, though it has quadrupled in size;&#13;
some of these packages are shown in&#13;
<a data-type="xref" href="#javacook-packages-TABLE-1">Table 15-1</a>.</p>&#13;
<table id="javacook-packages-TABLE-1">&#13;
<caption><span class="label">Table 15-1. </span>Java packages basic structure</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Name</th>&#13;
<th>Function</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>java.awt</code></p></td>&#13;
<td><p>Graphical user interface</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.io</code></p></td>&#13;
<td><p>Reading and writing</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.lang</code></p></td>&#13;
<td><p>Intrinsic classes (<code>String</code>, etc.)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.lang.annotation</code></p></td>&#13;
<td><p>Library support for annotation processing</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.math</code></p></td>&#13;
<td><p>Math library</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.net</code></p></td>&#13;
<td><p>Networking (sockets)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.nio</code></p></td>&#13;
<td><p>“New” I/O (not new anymore): channel-based I/O</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.sql</code></p></td>&#13;
<td><p>Java database connectivity</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.text</code></p></td>&#13;
<td><p>Handling and formatting/parsing dates, numbers, messages</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.time</code></p></td>&#13;
<td><p>Java 8: modern date/time API (JSR-311)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.util</code></p></td>&#13;
<td><p>Utilities (collections, date)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>java.util.regex</code></p></td>&#13;
<td><p>Regular expressions</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>javax.naming</code></p></td>&#13;
<td><p>JNDI</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>javax.print</code></p></td>&#13;
<td><p>Support for printing</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>javax.script</code></p></td>&#13;
<td><p>Java 6: scripting engines support</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>javax.swing</code></p></td>&#13;
<td><p>Modern graphical user interface</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>Many packages have been added over the years, but the initial structure has stood the test of time fairly well. In this chapter, I’ll show you how to create and document your own packages, and then I’ll discuss a number of issues related to deploying your package in various ways on various platforms.</p>&#13;
&#13;
<p>This chapter also covers the more traditional meaning of packaging, as in, creating a package&#13;
of your program for others to use.&#13;
This covers the Java Platform Modules System (JPMS) introduced in Java 9.&#13;
We also cover <code>jlink</code>, a tool for creating a mini-Java distribution containing your&#13;
application and only the parts of the JDK that you actually use.&#13;
We do not yet cover the <code>jpackage</code> tool for packaging applications, because it’s not yet&#13;
in the JDK; it may arrive with Java 14 or 15.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.1 Creating a Package" data-type="sect1"><div class="sect1" id="javacook-packages-SECT-1">&#13;
<h1>15.1 Creating a Package</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="packages" data-secondary="creating" data-type="indexterm" id="idm45290635030424"/>You want to be able to import classes and/or organize your classes, so you want to create your own package.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Put a <code>package</code> statement at the front of each file, and recompile with <code>-d</code> or a build tool or IDE.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <code>package</code> statement must be the very first noncomment statement&#13;
in your Java source file—preceding even <code>import</code> statements—and it&#13;
must give the full name of the package. Package names are expected&#13;
to start with your domain name backward; for example, my internet&#13;
domain is <em>darwinsys.com</em>, so most of my packages begin with&#13;
<code>com.darwinsys</code> and a project name. The utility classes used in&#13;
this book and meant for reuse are in one of the <code>com.darwinsys</code> packages listed in&#13;
<a data-type="xref" href="ch01.html#javacook-getstarted-samplecode">Recipe 1.6</a>, and each source file begins with a&#13;
statement, such as this:</p>&#13;
&#13;
<pre data-type="programlisting">package com.darwinsys.util;</pre>&#13;
&#13;
<p>The demonstration classes in the <a data-primary="javasrc repository" data-type="indexterm" id="idm45290635020504"/><em>JavaSrc</em> repository do not follow this pattern;&#13;
they are in packages with names related to the chapter they are in or the <code>java.*</code>&#13;
package they relate to; for example,&#13;
<code>lang</code> for basic Java stuff, <code>structure</code> for examples from the data structuring&#13;
chapter (<a data-type="xref" href="ch07.html#javacook-structure">Chapter 7</a>), <code>threads</code> for the threading chapter (<a data-type="xref" href="ch16.html#javacook-threads">Chapter 16</a>),&#13;
and so on. It is hoped that you will put them in a “real” package if you reuse them&#13;
in your application!</p>&#13;
&#13;
<p>Once you have package statements in place, be aware that the Java runtime, and even the&#13;
compiler, will expect the compiled <em>.class</em> files to be found in their rightful place&#13;
(i.e., in the subdirectory corresponding to the full name somewhere in your <code>CLASSPATH</code>&#13;
settings). For example, the class file for <code>com.darwinsys.util.FileIO</code> must <em>not</em> be in the&#13;
file <em>FileIO.class</em> in my <code>CLASSPATH</code> but must be in <em>com/darwinsys/util/FileIO.class</em>&#13;
relative to one of the directories or archives in my <code>CLASSPATH</code>. Accordingly, if you are&#13;
compiling with the command-line compiler, it is customary (almost mandatory) to use the&#13;
<code>-d</code> command-line argument when compiling. This argument must be followed by the name of&#13;
an existing directory (often . is used to signify the current directory) to specify where&#13;
to build the directory tree. For example, to compile all the <em>.java</em> files in the current&#13;
directory, and create the directory path under it (e.g., create <em>./com/darwinsys/util</em> in&#13;
the example), use this:</p>&#13;
<pre data-type="programlisting" id="I_23_tt594"><strong>javac -d . *.java</strong></pre>&#13;
&#13;
<p>This creates the path (e.g., <em>com/darwinsys/util/</em>) relative to the current directory and&#13;
puts the class files into that subdirectory. This makes life easy for subsequent&#13;
compilations and also for creating archives, which is covered in&#13;
<a data-type="xref" href="#javacook-packages-SECT-4">Recipe 15.5</a>.</p>&#13;
&#13;
<p>Of course, if you use a build tool such as Maven&#13;
(see <a data-type="xref" href="ch01.html#javacook-getstarted-maven">Recipe 1.7</a>), this will be done&#13;
correctly by default (Maven), so you won’t have to remember to keep doing it!</p>&#13;
&#13;
<p>Note that in all modern Java environments, classes that do not&#13;
belong to a package <a data-primary="anonymous package" data-type="indexterm" id="idm45290635006648"/>(the <em>anonymous package</em>) cannot be listed in&#13;
an <code>import</code> statement, although they can be referred to by other&#13;
classes in that package. They also cannot become part of a JPMS module.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.2 Documenting Classes with Javadoc" data-type="sect1"><div class="sect1" id="javacook-packages-javadoc">&#13;
<h1>15.2 Documenting Classes with Javadoc</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-packages-javadoc.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="packages" data-secondary="documenting" data-type="indexterm" id="idm45290635002392"/><a data-primary="documentation, javadoc" data-type="indexterm" id="idm45290635001544"/><a data-primary="javadoc" data-type="indexterm" id="idm45290635000936"/>You have heard about this thing called <a data-primary="code reuse" data-type="indexterm" id="idm45290635000200"/><em>code reuse</em> and would like to promote it by allowing other developers to use your classes.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-packages-javadoc.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use javadoc. Write the comments when you write the code.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-packages-javadoc.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Javadoc is one of the great inventions of the early Java years. Like so many good things, it was not wholly invented by the Java folks; earlier projects such as <a data-primary="Literate Programming" data-type="indexterm" id="idm45290634995336"/>Knuth’s Literate Programming had combined source code and documentation in a single source file. But the Java folks did a good job on it and came along at the right time. Javadoc is to Java classes what <em>man pages</em> are to Unix, or what Windows Help is to Windows applications: it is a standard format that everybody expects to find and knows how to use. Learn it. Use it. Write it. Live long and prosper (well, perhaps that’s not guaranteed). But all that HTML documentation that you learned from writing Java code, the complete reference for the JDK—did you think they hired dozens of tech writers to produce it? Nay, that’s not the Java way. Java’s developers wrote the documentation comments as they went along, and when the release was made, they ran javadoc on all the zillions of public classes and generated the documentation bundle at the same time as the JDK. You can, should, and really must do the same when you are preparing classes for other developers to use.</p>&#13;
&#13;
<p>All you have to do to use javadoc is to put special <em>javadoc comments</em> into your Java source files. These are similar to multiline Java comments, but they begin with a slash and <em>two</em>&#13;
stars and end with the normal star-slash. Javadoc comments must appear immediately before the definition of&#13;
the class, method, or field that they document; if placed elsewhere, they are ignored.</p>&#13;
&#13;
<p>A series of keywords, prefixed by the at sign, can appear inside doc comments in certain contexts.&#13;
Some are contained in braces. The keywords as of Java 8 are listed in <a data-type="xref" href="#javacook-packages-TABLE-2">Table 15-2</a>.</p>&#13;
<table class="less_space pagebreak-before" id="javacook-packages-TABLE-2">&#13;
<caption><span class="label">Table 15-2. </span>Javadoc keywords</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Keyword</th>&#13;
<th>Use</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p><code>@author</code></p></td>&#13;
<td><p>Author name(s)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>{@code <em>text</em>}</code></p></td>&#13;
<td><p>Displays text in code font without HTML interpretation</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@deprecated</code></p></td>&#13;
<td><p>Causes deprecation warning</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>{@docroot}</code></p></td>&#13;
<td><p>Refers to the root of the generated documentation tree</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@exception</code></p></td>&#13;
<td><p>Alias for <code>@throws</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>{@inheritDoc}</code></p></td>&#13;
<td><p>Inherits documentation from nearest superclass/superinterface</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@link</code></p></td>&#13;
<td><p>Generates inline link to another class or member</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@linkplain</code></p></td>&#13;
<td><p>As <code>@link</code> but displays in plain text</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>{@literal <em>text</em>}</code></p></td>&#13;
<td><p>Displays text without interpretation</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@param <em>name description</em></code></p></td>&#13;
<td><p>Argument name and meaning (methods only)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@return</code></p></td>&#13;
<td><p>Return value</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@see</code></p></td>&#13;
<td><p>Generate cross-reference link to another class or member</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@serial</code></p></td>&#13;
<td><p>Describes serializable field</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@serialData</code></p></td>&#13;
<td><p>Describes order and types of data in serialized form</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@serialField</code></p></td>&#13;
<td><p>Describes serializable field</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@since</code></p></td>&#13;
<td><p>JDK version in which introduced (primarily for Sun use)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@throws</code></p></td>&#13;
<td><p>Exception class and conditions under which thrown</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>{@value [<em>ref</em>]}</code></p></td>&#13;
<td><p>Displays values of this or another constant field</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p><code>@version</code></p></td>&#13;
<td><p>Version identifier</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p><a data-type="xref" href="#javacook-packages-EX-1">Example 15-1</a> is a somewhat contrived example that shows some common javadoc keywords in use. The output of running this through javadoc is shown in a browser in <a data-type="xref" href="#javacook-packages-FIG-1">Figure 15-1</a>.</p>&#13;
<div data-type="example" id="javacook-packages-EX-1">&#13;
<h5><span class="label">Example 15-1. </span>main/src/main/java/javadoc/JavadocDemo.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">JavadocDemo</code> <code class="kd">extends</code> <code class="n">JPanel</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">long</code> <code class="n">serialVersionUID</code> <code class="o">=</code> <code class="mi">1L</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/**</code>&#13;
<code class="cm">     * Construct the GUI</code>&#13;
<code class="cm">     * @throws java.lang.IllegalArgumentException if constructed on a Sunday.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="nf">JavadocDemo</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="c1">// We create and add a pushbutton here,</code>&#13;
        <code class="c1">// but it doesn't do anything yet.</code>&#13;
        <code class="n">Button</code> <code class="n">b</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Button</code><code class="o">(</code><code class="s">"Hello"</code><code class="o">);</code>&#13;
        <code class="n">add</code><code class="o">(</code><code class="n">b</code><code class="o">);</code>                        <code class="c1">// connect Button into component</code>&#13;
        <code class="c1">// Totally capricious example of what you should not do</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">Calendar</code><code class="o">.</code><code class="na">getInstance</code><code class="o">().</code><code class="na">get</code><code class="o">(</code><code class="n">Calendar</code><code class="o">.</code><code class="na">DAY_OF_WEEK</code><code class="o">)</code> <code class="o">==</code> <code class="n">Calendar</code><code class="o">.</code><code class="na">SUNDAY</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">"Never On A Sunday"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** paint() is an AWT Component method, called when the</code>&#13;
<code class="cm">     * component needs to be painted. This one just draws colored</code>&#13;
<code class="cm">     * boxes in the window.</code>&#13;
<code class="cm">     *</code>&#13;
<code class="cm">     * @param g A java.awt.Graphics that we use for all our</code>&#13;
<code class="cm">     * drawing methods.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">paint</code><code class="o">(</code><code class="n">Graphics</code> <code class="n">g</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="kt">int</code> <code class="n">w</code> <code class="o">=</code> <code class="n">getSize</code><code class="o">().</code><code class="na">width</code><code class="o">,</code> <code class="n">h</code> <code class="o">=</code> <code class="n">getSize</code><code class="o">().</code><code class="na">height</code><code class="o">;</code>&#13;
        <code class="n">g</code><code class="o">.</code><code class="na">setColor</code><code class="o">(</code><code class="n">Color</code><code class="o">.</code><code class="na">YELLOW</code><code class="o">);</code>&#13;
        <code class="n">g</code><code class="o">.</code><code class="na">fillRect</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">w</code><code class="o">/</code><code class="mi">2</code><code class="o">,</code> <code class="n">h</code><code class="o">);</code>&#13;
        <code class="n">g</code><code class="o">.</code><code class="na">setColor</code><code class="o">(</code><code class="n">Color</code><code class="o">.</code><code class="na">GREEN</code><code class="o">);</code>&#13;
        <code class="n">g</code><code class="o">.</code><code class="na">fillRect</code><code class="o">(</code><code class="n">w</code><code class="o">/</code><code class="mi">2</code><code class="o">,</code> <code class="mi">0</code><code class="o">,</code> <code class="n">w</code><code class="o">,</code> <code class="n">h</code><code class="o">);</code>&#13;
        <code class="n">g</code><code class="o">.</code><code class="na">setColor</code><code class="o">(</code><code class="n">Color</code><code class="o">.</code><code class="na">BLACK</code><code class="o">);</code>&#13;
        <code class="n">g</code><code class="o">.</code><code class="na">drawString</code><code class="o">(</code><code class="s">"Welcome to Java"</code><code class="o">,</code> <code class="mi">50</code><code class="o">,</code> <code class="mi">50</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>The javadoc tool works fine for one class but really comes into its own when dealing with a package or collection of packages. You can provide a package summary file for each package, which will be incorporated into the generated files. Javadoc generates thoroughly interlinked and crosslinked documentation, just like that which accompanies the standard JDK. There are several command-line options; I normally use <code class="keep-together">-author</code> and <code>-version</code> to get it to include these items, and often <code>-link</code> to tell it where to find the standard JDK to link to.</p>&#13;
&#13;
<p>Run <code>javadoc -help</code> for a complete list of options, or see the full documentation online at&#13;
<a href="https://docs.oracle.com/en/java/javase/13/docs/specs/man/javadoc.html">Oracle’s website</a>. <a data-type="xref" href="#javacook-packages-FIG-1">Figure 15-1</a> shows one view of the documentation that the class shown in <a data-type="xref" href="#javacook-packages-EX-1">Example 15-1</a> generates when run as the following:</p>&#13;
<pre data-type="programlisting" id="I_23_tt595">$ <strong>javadoc -author -version JavadocDemo.java</strong></pre>&#13;
&#13;
<p>If you run this with Java 9+, it will also include a fully functional search box,&#13;
shown in the upper right of <a data-type="xref" href="#javacook-packages-FIG-1">Figure 15-1</a>.&#13;
This is implemented in JavaScript, so it should work in any modern browser.</p>&#13;
&#13;
<p>Be aware that quite a few files are generated, and one of the generated files&#13;
will have the same name as each class, with the&#13;
extension <em>.html</em>. If you happened to have an HTML file documenting the class,&#13;
and you generate javadoc in the source directory, the <em>.html</em> file is silently overwritten&#13;
with the javadoc output.&#13;
If you wish to avoid cluttering up your source directories with the generated files,&#13;
the <code>-d __directorypath</code> option to javadoc allows you to place the&#13;
generated files into the specified directory.</p>&#13;
&#13;
<figure><div class="figure" id="javacook-packages-FIG-1">&#13;
<img alt="jcb4 1501" src="assets/jcb4_1501.png"/>&#13;
<h6><span class="label">Figure 15-1. </span>Javadoc opened in a browser</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="javacook-packages-javadoc.4">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>Javadoc has numerous other command-line arguments. If documentation is for your own use only and will not be distributed, you can use the <code>-link</code> option to tell it where your standard JDK documentation is installed so that links can be generated to standard Java classes (like <code>String</code>, <code>Object</code>, and so on). If documentation is to be distributed, you can omit <code>-link</code> or use <code>-link</code> with a URL to the appropriate Java API page on Oracle’s website. See the online tools documentation for all the command-line options.</p>&#13;
&#13;
<p>The output that javadoc generates is fine for most purposes. It is possible to write your own <code>Doclet</code> class to make the javadoc program into a class documentation verifier, a Java-to-other-format (such as Java-to-RTF) documentation generator, or whatever you like. Those are actual examples; see the javadoc tools documentation that comes with the JDK for documents and examples, or go to&#13;
<a href="https://docs.oracle.com/en/java/javase/13/docs/specs/man/javadoc.html">Oracle’s website</a>.&#13;
Visit <a href="http://www.doclet.com">Doclet</a> for a somewhat dated but useful collection of Doclets and other javadoc-based tools.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Javadoc Versus JavaHelp" data-type="sect2"><div class="sect2" id="javacook-javahelp">&#13;
<h2>Javadoc Versus JavaHelp</h2>&#13;
&#13;
<p>Javadoc is for programmers using your classes; for a GUI application, end users will probably appreciate standard online help. This is the role of the <a data-primary="Java Help API" data-type="indexterm" id="idm45290634751416"/>JavaHelp API, which is not covered in this book but is fully explained in <a data-primary="Creating Effective JavaHelp (Lewis)" data-type="indexterm" id="idm45290634750584"/><a data-primary="Lewis, Kevin" data-secondary="Creating Effective JavaHelp" data-type="indexterm" id="idm45290634749944"/><em><a class="orm:hideurl" href="http://shop.oreilly.com/product/9781565927193.do">Creating Effective JavaHelp</a></em> by Kevin Lewis (O’Reilly), which every GUI application developer should read.&#13;
JavaHelp is another useful specification that was somewhat left to coast during the Sun sellout to Oracle;&#13;
it is now hosted on <em>java.net</em> at <a href="https://javaee.github.io/javahelp">javahelp</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.3 Beyond Javadoc: Annotations/Metadata" data-type="sect1"><div class="sect1" id="javacook-packages-SECT-3">&#13;
<h1>15.3 Beyond Javadoc: Annotations/Metadata</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-3.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="annotations" data-secondary="about" data-type="indexterm" id="idm45290634743368"/><a data-primary="metadata" data-type="indexterm" id="idm45290634742392"/>You want to generate not just documentation from your source code, but also other code&#13;
artifacts. You want to mark code for additional&#13;
compiler verification.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-3.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the Java Annotations, or Metadata, facility.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-3.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The continuing success of the open source tool <a href="http://xdoclet.sourceforge.net">XDoclet</a>—originally used to&#13;
generate the tedious auxiliary classes and deployment descriptor&#13;
files for the widely criticized EJB2 framework—led to a demand for&#13;
a similar mechanism in standard Java. Java <em>Annotations</em> were the&#13;
result. The <em>annotation</em> mechanism uses an interface-like syntax,&#13;
in which both declaration and use of annotations use the name&#13;
preceded by an at character (<code>@</code>). This was chosen, according to&#13;
the designers, to be reminiscent of “Javadoc tags, a preexisting&#13;
ad hoc annotation facility in the Java programming language.” Javadoc&#13;
is ad hoc only in the sense that its <code>@</code> tags were never fully&#13;
integrated into the language; most were ignored by the compiler,&#13;
but <code>@deprecated</code> was always understood by the compiler (see&#13;
<a data-type="xref" href="ch01.html#javacook-getstarted-SECT-9">Recipe 1.9</a>).</p>&#13;
&#13;
<p>Annotations can be read at runtime by use of the Reflection API;&#13;
this is discussed in <a data-type="xref" href="ch17.html#javacook-reflection-annotations">Recipe 17.10</a>, where I also&#13;
show you how to define your own annotations.&#13;
Annotations can also be read post–compile time by tools such as&#13;
code generators (and others to be invented, perhaps by you, gentle&#13;
reader!).</p>&#13;
&#13;
<p>Annotations are also read by <em>javac</em> at compile time to provide extra&#13;
information to the compiler.</p>&#13;
&#13;
<p>For example, a common coding error is overloading a method when you&#13;
mean to override it, by mistakenly using the wrong argument type.&#13;
Consider overriding the equals method in <code>Object</code>. If you mistakenly&#13;
write</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">equals</code><code class="o">(</code><code class="n">MyClass</code> <code class="n">obj</code><code class="o">)</code> <code class="o">{</code>&#13;
    <code class="o">...</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>then you have created a new overload that will likely never be called, and the default&#13;
version in <code>Object</code> will be called. To prevent this, an annotation included in <code>java.lang</code>&#13;
is the <code>Override</code> annotation. This has no parameters but simply is placed before the&#13;
method call, like this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * AnnotationOverrideDemo - Simple demonstation of Metadata being used to</code>&#13;
<code class="cm"> * verify that a method does in fact override (not overload) a method</code>&#13;
<code class="cm"> * from the parent class. This class provides the method.</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">abstract</code> <code class="kd">class</code> <code class="nc">Top</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">abstract</code> <code class="kt">void</code> <code class="nf">myMethod</code><code class="o">(</code><code class="n">Object</code> <code class="n">o</code><code class="o">);</code>&#13;
<code class="o">}</code>&#13;
&#13;
<code class="cm">/** Simple demonstation of Metadata being used to verify</code>&#13;
<code class="cm"> * that a method does in fact override (not overload) a method</code>&#13;
<code class="cm"> * from the parent class. This class is supposed to do the overriding,</code>&#13;
<code class="cm"> * but deliberately introduces an error to show how the modern compiler</code>&#13;
<code class="cm"> * behaves</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">class</code> <code class="nc">Bottom</code> <code class="o">{</code>&#13;
&#13;
    <code class="nd">@Override</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">myMethod</code><code class="o">(</code><code class="n">String</code> <code class="n">s</code><code class="o">)</code> <code class="o">{</code>    <code class="c1">// EXPECT COMPILE ERROR</code>&#13;
        <code class="c1">// Do something here...</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Attempting to compile this results in a compiler error that the method in question does not override a method, even though the annotation says it does; this is a fatal compile-time error:</p>&#13;
<pre data-type="programlisting" id="I_23_tt600">C:&gt; <strong>javac AnnotationOverrideDemo.java</strong>&#13;
AnnotationOverrideDemo.java:16: method does not override a method&#13;
            from its superclass&#13;
        @Override public void myMethod(String s) {     // EXPECT COMPILE ERROR&#13;
         ^&#13;
1 error&#13;
C:&gt; </pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.4 Preparing a Class as a JavaBean" data-type="sect1"><div class="sect1" id="javacook-packages-SECT-8">&#13;
<h1>15.4 Preparing a Class as a JavaBean</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-8.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="classes" data-secondary="preparing as JavaBeans" data-type="indexterm" id="cla_jb"/><a data-primary="JAR files" data-secondary="pickling JavaBeans into" data-type="indexterm" id="jar_jb"/><a data-primary="JavaBeans, pickling into JAR" data-type="indexterm" id="jb_jar"/><a data-primary="packages" data-secondary="JavaBeans as" data-type="indexterm" id="pac_jb"/>You have a class that you would like to use as a JavaBean.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-8.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Make sure the class meets the JavaBeans requirements. Optionally, create a JAR file containing the class, a manifest, and any ancillary entries.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-8.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Several kinds of Java components are called either Beans or JavaBeans:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Visual components for use in GUI builders, as discussed in this recipe.</p>&#13;
</li>&#13;
<li>&#13;
<p>Plain Old Java Objects (POJOs), or components meant for reuse.</p>&#13;
</li>&#13;
<li>&#13;
<p>Java Enterprise has <a data-primary="Enterprise JavaBeans (EJBs)" data-type="indexterm" id="idm45290634545896"/><a data-primary="EJBs (Enterprise JavaBeans)" data-type="indexterm" id="idm45290634545192"/>Enterprise JavaBeans (EJBs), <a data-primary="JSP JavaBeans" data-type="indexterm" id="idm45290634544376"/>JSP JavaBeans, <a data-primary="JSF (JavaServer Faces)" data-type="indexterm" id="idm45290634543576"/><a data-primary="JavaServer Faces (JSF)" data-type="indexterm" id="idm45290634542872"/>JSF Managed Beans, and <a data-primary="CDI Beans" data-type="indexterm" id="idm45290634542072"/>CDI Beans,&#13;
containing features for building enterprise-scale&#13;
applications. Creating and using Java EE components is more involved than regular JavaBeans and would&#13;
take us very far afield, so they are not covered in this book. When you need to learn&#13;
about enterprise functionality, turn to<a data-primary="Java EE 7 Essentials: Enterprise Developer Handbook (Gupta)" data-type="indexterm" id="idm45290634540936"/><a data-primary="Gupta, Arun" data-secondary="Java EE 7 Essentials: Enterprise Developer Handbook" data-type="indexterm" id="idm45290634540296"/> <em><a class="orm:hideurl" href="http://oreil.ly/javaee7">Java EE 7 Essentials</a></em> by Arun Gupta.</p>&#13;
</li>&#13;
<li>&#13;
<p>The <a data-primary="Spring Framework" data-type="indexterm" id="idm45290634537400"/><a href="http://springframework.org">Spring Framework</a> also uses the term “Beans” (or “Spring Beans”)&#13;
for the objects it manages.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>What all these types of beans have in common are certain naming paradigms. All public&#13;
properties should be accessible by get/set accessor methods. For a given property <code>Prop</code>&#13;
of type <code>Type</code>, the following two methods should exist (note the capitalization):</p>&#13;
&#13;
<pre data-type="programlisting">public Type getProp( );&#13;
public void setProp(Type)</pre>&#13;
&#13;
<p>For example, the various AWT and Swing components that have textual labels all have the&#13;
following pair of methods:</p>&#13;
&#13;
<pre data-type="programlisting">public String getText( );&#13;
public void setText(String newText);</pre>&#13;
&#13;
<p>One commonly permitted variance to this pattern is that, for <code>boolean</code> or <code>Boolean</code> arguments,&#13;
the getter method is usually called <a data-primary="isProp() method" data-type="indexterm" id="idm45290634530680"/><a data-primary="getProp() method" data-type="indexterm" id="idm45290634529976"/><code>isProp()</code> rather than <code>getProp()</code>.</p>&#13;
&#13;
<p>You should use this set/get design pattern (set/get methods) for methods that control a&#13;
bean. Indeed, this technique is useful even in nonbean classes for regularity. The bean&#13;
containers for the APIs listed at the start of this section generally use Java&#13;
introspection (see <a data-type="xref" href="ch17.html#javacook-reflection">Chapter 17</a>) to find the set/get method pairs, and some use&#13;
these to construct properties editors for your bean. Bean-aware IDEs, for example, provide&#13;
editors for all standard types (colors, fonts, labels, etc.). You can supplement this with&#13;
a <code>BeanInfo</code> class to provide or override information.</p>&#13;
&#13;
<p>The bare minimum a class requires to be usable as a JavaBean is the following:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>The class must have a no-argument constructor.</p>&#13;
</li>&#13;
<li>&#13;
<p>The class should use the set/get paradigm.</p>&#13;
</li>&#13;
<li>&#13;
<p>The class must implement <code>java.io.Serializable</code>, although many containers don’t enforce this.</p>&#13;
</li>&#13;
<li>&#13;
<p>Depending on the intended use, the class file might need to be packaged into a JAR file&#13;
(see <a data-type="xref" href="#javacook-packages-SECT-4">Recipe 15.5</a>).</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Note that a JavaBean with no <em>required</em> inheritance or <code>implement</code>s is also called a POJO. Most new Java frameworks accept POJO components, instead of&#13;
(as in days of yore) requiring inheritance (e.g., Struts 1 <code>org.struts.Action</code> class) or implementation of&#13;
interfaces (e.g., EJB2 <code>javax.ejb.SessionBean</code> interface).</p>&#13;
&#13;
<p>Here is a sample JavaBean that might have been a useful addition to one’s Java GUI toolbox, the <code>LabelText</code> widget. It combines a label and a one-line text field into a single unit, making it easier to compose GUI applications. A demo program in the online source directory sets up three <code>LabelText</code> widgets, as shown in <a data-type="xref" href="#javacook-packages-FIG-6">Figure 15-2</a>.</p>&#13;
&#13;
<figure><div class="figure" id="javacook-packages-FIG-6">&#13;
<img alt="jcb4 1502" src="assets/jcb4_1502.png"/>&#13;
<h6><span class="label">Figure 15-2. </span>LabelText bean</h6>&#13;
</div></figure>&#13;
&#13;
<p>The code for <code>LabelText</code> is shown in <a data-type="xref" href="#javacook-packages-EX-4">Example 15-2</a>. Notice that it is serializable and uses the set/get paradigm for most of its public methods. Most of the public set/get methods simply delegate to the corresponding methods in the label or the text field. There isn’t really a lot to this bean, but it’s a good example of aggregation, in addition to being a good example of a bean.</p>&#13;
<div data-type="example" id="javacook-packages-EX-4">&#13;
<h5><span class="label">Example 15-2. </span>darwinsys-api/src/main/java/com/darwinsys/swingui/LabelText.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="c1">// package com.darwinsys.swingui;</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">LabelText</code> <code class="kd">extends</code> <code class="n">JPanel</code> <code class="kd">implements</code> <code class="n">java</code><code class="o">.</code><code class="na">io</code><code class="o">.</code><code class="na">Serializable</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">long</code> <code class="n">serialVersionUID</code> <code class="o">=</code> <code class="o">-</code><code class="mi">8343040707105763298L</code><code class="o">;</code>&#13;
    <code class="cm">/** The label component */</code>&#13;
    <code class="kd">protected</code> <code class="n">JLabel</code> <code class="n">theLabel</code><code class="o">;</code>&#13;
    <code class="cm">/** The text field component */</code>&#13;
    <code class="kd">protected</code> <code class="n">JTextField</code> <code class="n">theTextField</code><code class="o">;</code>&#13;
    <code class="cm">/** The font to use */</code>&#13;
    <code class="kd">protected</code> <code class="n">Font</code> <code class="n">myFont</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** Construct the object with no initial values.</code>&#13;
<code class="cm">     * To be usable as a JavaBean there must be a no-argument constructor.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="nf">LabelText</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="s">"(LabelText)"</code><code class="o">,</code>  <code class="mi">12</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct the object with the label and a default textfield size */</code>&#13;
    <code class="kd">public</code> <code class="nf">LabelText</code><code class="o">(</code><code class="n">String</code> <code class="n">label</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="n">label</code><code class="o">,</code> <code class="mi">12</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct the object with given label and textfield size */</code>&#13;
    <code class="kd">public</code> <code class="nf">LabelText</code><code class="o">(</code><code class="n">String</code> <code class="n">label</code><code class="o">,</code> <code class="kt">int</code> <code class="n">numChars</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">(</code><code class="n">label</code><code class="o">,</code> <code class="n">numChars</code><code class="o">,</code> <code class="kc">null</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Construct the object with given label, textfield size,</code>&#13;
<code class="cm">     * and "Extra" component</code>&#13;
<code class="cm">     * @param label The text to display</code>&#13;
<code class="cm">     * @param numChars The size of the text area</code>&#13;
<code class="cm">     * @param extra A third component such as a cancel button</code>&#13;
<code class="cm">     * may be null, in which case only the label and textfield exist.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="nf">LabelText</code><code class="o">(</code><code class="n">String</code> <code class="n">label</code><code class="o">,</code> <code class="kt">int</code> <code class="n">numChars</code><code class="o">,</code> <code class="n">JComponent</code> <code class="n">extra</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="kd">super</code><code class="o">();</code>&#13;
        <code class="n">setLayout</code><code class="o">(</code><code class="k">new</code> <code class="n">BoxLayout</code><code class="o">(</code><code class="k">this</code><code class="o">,</code> <code class="n">BoxLayout</code><code class="o">.</code><code class="na">X_AXIS</code><code class="o">));</code>&#13;
        <code class="n">theLabel</code> <code class="o">=</code> <code class="k">new</code> <code class="n">JLabel</code><code class="o">(</code><code class="n">label</code><code class="o">);</code>&#13;
        <code class="n">add</code><code class="o">(</code><code class="n">theLabel</code><code class="o">);</code>&#13;
        <code class="n">theTextField</code> <code class="o">=</code> <code class="k">new</code> <code class="n">JTextField</code><code class="o">(</code><code class="n">numChars</code><code class="o">);</code>&#13;
        <code class="n">add</code><code class="o">(</code><code class="n">theTextField</code><code class="o">);</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">extra</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">add</code><code class="o">(</code><code class="n">extra</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Get the label's horizontal alignment */</code>&#13;
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getLabelAlignment</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">theLabel</code><code class="o">.</code><code class="na">getHorizontalAlignment</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Set the label's horizontal alignment */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setLabelAlignment</code><code class="o">(</code><code class="kt">int</code> <code class="n">align</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">theLabel</code><code class="o">.</code><code class="na">setHorizontalAlignment</code><code class="o">(</code><code class="n">align</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Get the text displayed in the text field */</code>&#13;
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getText</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">theTextField</code><code class="o">.</code><code class="na">getText</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Set the text displayed in the text field */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setText</code><code class="o">(</code><code class="n">String</code> <code class="n">text</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">theTextField</code><code class="o">.</code><code class="na">setText</code><code class="o">(</code><code class="n">text</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Get the text displayed in the label */</code>&#13;
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getLabel</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">theLabel</code><code class="o">.</code><code class="na">getText</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Set the text displayed in the label */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setLabel</code><code class="o">(</code><code class="n">String</code> <code class="n">text</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">theLabel</code><code class="o">.</code><code class="na">setText</code><code class="o">(</code><code class="n">text</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Set the font used in both subcomponents. */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setFont</code><code class="o">(</code><code class="n">Font</code> <code class="n">f</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="c1">// This class' constructors call to super() can trigger</code>&#13;
        <code class="c1">// calls to setFont() (from Swing.LookAndFeel.installColorsAndFont),</code>&#13;
        <code class="c1">// before we create our components, so work around this.</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">theLabel</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code>&#13;
            <code class="n">theLabel</code><code class="o">.</code><code class="na">setFont</code><code class="o">(</code><code class="n">f</code><code class="o">);</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">theTextField</code> <code class="o">!=</code> <code class="kc">null</code><code class="o">)</code>&#13;
            <code class="n">theTextField</code><code class="o">.</code><code class="na">setFont</code><code class="o">(</code><code class="n">f</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Adds the ActionListener to receive action events from the textfield */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">addActionListener</code><code class="o">(</code><code class="n">ActionListener</code> <code class="n">l</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">theTextField</code><code class="o">.</code><code class="na">addActionListener</code><code class="o">(</code><code class="n">l</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Remove an ActionListener from the textfield. */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">removeActionListener</code><code class="o">(</code><code class="n">ActionListener</code> <code class="n">l</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">theTextField</code><code class="o">.</code><code class="na">removeActionListener</code><code class="o">(</code><code class="n">l</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>Once it’s compiled, it’s ready to be packaged into a JAR.&#13;
Most build tools such as Maven will do this work for you.<a data-primary="" data-startref="cla_jb" data-type="indexterm" id="idm45290634489352"/><a data-primary="" data-startref="jar_jb" data-type="indexterm" id="idm45290634488504"/><a data-primary="" data-startref="jb_jar" data-type="indexterm" id="idm45290634487624"/><a data-primary="" data-startref="pac_jb" data-type="indexterm" id="idm45290634486680"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.5 Archiving with JAR" data-type="sect1"><div class="sect1" id="javacook-packages-SECT-4">&#13;
<h1>15.5 Archiving with JAR</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-4.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="JAR files" data-secondary="archive files" data-type="indexterm" id="jar_arc"/><a data-primary="packages" data-secondary="JAR files" data-type="indexterm" id="pac_jar"/>You want to create a Java archive (JAR) file from your package (or any other collection of files).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-4.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <em>jar</em>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-4.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <em>jar</em> archiver is Java’s standard tool for building archives. Archives serve the same purpose as the program libraries that some other programming languages use. Java normally loads its standard classes from archives, a fact you can verify by running a simple “Hello, World” program with the <code>-verbose</code> option:</p>&#13;
<pre data-type="programlisting" id="I_23_tt601"><strong>java -verbose HelloWorld</strong></pre>&#13;
&#13;
<p>Creating an archive is a simple process. The <em>jar</em> tool takes several command-line arguments: the most common are <code>c</code> for create, <code>t</code> for table of contents, and <code>x</code> for extract. The archive name is specified with <code>-f</code> and a filename. The options are followed by the files and directories to be archived, like this:</p>&#13;
<pre data-type="programlisting" id="I_23_tt602"><strong>jar cvf /tmp/MyClasses.jar .</strong></pre>&#13;
&#13;
<p>The dot at the end is important; it means the current directory. This command creates an archive of all files in the current directory and its subdirectories into the file <em>/tmp/MyClasses.jar</em>.</p>&#13;
&#13;
<p>Most applications of JAR files depend on an extra file that is always present in a true&#13;
JAR file, called a <a data-primary="manifest" data-type="indexterm" id="idm45290634175368"/><em>manifest</em>. This file always lists the contents of the JAR and their&#13;
attributes; you can add extra information into it. The attributes are in the form <code>name</code>:&#13;
<code>value</code>, as used in email headers, properties files (see <a data-type="xref" href="ch07.html#javacook-structure-SECT-7">Recipe 7.10</a>),&#13;
and elsewhere. Some attributes are required by the application, whereas others are optional.&#13;
For example, <a data-type="xref" href="#javacook-packages-SECT-7">Recipe 15.6</a> discusses running a main program directly from a&#13;
JAR; this requires a <code>Main-Program</code> header. You can even invent your own attributes, such as the following:</p>&#13;
&#13;
<pre data-type="programlisting">MySillyAttribute: true&#13;
MySillynessLevel: high (5'11")</pre>&#13;
&#13;
<p>You store this in a file called, say, <em>manifest.stub</em>,<sup><a data-type="noteref" href="ch15.html#idm45290634169336" id="idm45290634169336-marker">2</a></sup> and pass it to <em>jar</em> with the <code>-m</code> switch. <em>jar</em> includes your attributes in the manifest file it creates:</p>&#13;
<pre data-type="programlisting" id="I_23_tt604"><strong>jar -cv -m manifest.stub -f /tmp/com.darwinsys.util.jar .</strong></pre>&#13;
&#13;
<p>The <em>jar</em> program and related tools add additional information to the manifest, including a listing of all the other files included in the archive.</p>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p>If you use a tool like Maven (see <a data-type="xref" href="ch01.html#javacook-getstarted-maven">Recipe 1.7</a>), it automatically&#13;
creates a JAR file from your source project just by saying <code>mvn</code> <span class="keep-together"><code>package</code>.</span><a data-primary="" data-startref="jar_arc" data-type="indexterm" id="idm45290634161176"/><a data-primary="" data-startref="pac_jar" data-type="indexterm" id="idm45290634160200"/></p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.6 Running a Program from a JAR" data-type="sect1"><div class="sect1" id="javacook-packages-SECT-7">&#13;
<h1>15.6 Running a Program from a JAR</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-7.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="JAR files" data-secondary="running programs from" data-type="indexterm" id="jar_runn"/>You want to distribute a single large file containing all the classes of your application and run the main program from within the JAR.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-7.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Create a JAR file with a <code>Main-Class</code>: line in the manifest; run the program with the <code>java -jar</code> option.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-7.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The <em>java</em> command has a <code>-jar</code> option that tells it to run the main program found within a JAR file. In this case, it will also find classes it needs to load from within the same JAR file. How does it know which class to run? You must tell it. Create a one-line entry like this, noting that the attribute fields are case-sensitive and that the colon must be followed by a space:</p>&#13;
&#13;
<pre data-type="programlisting">Main-Class: com.somedomainhere.HelloWorld</pre>&#13;
&#13;
<p>Place that in a file called, say, <em>manifest.stub</em>, and assuming&#13;
that you want to run the program <code>HelloWorld</code> from the given package.&#13;
You can then use the following commands to package your app and run it from the JAR file:</p>&#13;
<pre data-type="programlisting" id="I_23_tt609">C:&gt; <strong>javac HelloWorld.java</strong>&#13;
C:&gt; <strong>jar cvmf manifest.stub hello.jar HelloWorld.class</strong>&#13;
C:&gt; <strong>java -jar hello.jar</strong>&#13;
Hello, World of Java&#13;
C:&gt;</pre>&#13;
&#13;
<p>You can now copy the JAR file anywhere and run it the same way.&#13;
You do not need to add it to your <code>CLASSPATH</code> or list the name of the main class.</p>&#13;
&#13;
<p>On GUI platforms that support it, you can also launch this application by double-clicking the JAR file.&#13;
This works on macOS, Microsoft Windows, and many X Windows desktops.</p>&#13;
&#13;
<p>In real life you would probably automate this with Maven, where your POM file would contain,&#13;
among other things, the following:</p>&#13;
<pre>&lt;project ...&gt;&#13;
    ...&#13;
    &lt;packaging&gt;jar&lt;/packaging&gt;&#13;
    ...&#13;
    &lt;build&gt;&#13;
        &lt;plugins&gt;&#13;
            &lt;plugin&gt;&#13;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;&#13;
                &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;&#13;
                &lt;version&gt;2.4&lt;/version&gt;&#13;
                &lt;configuration&gt;&#13;
                    &lt;archive&gt;&#13;
                        &lt;manifest&gt;&#13;
                            &lt;addclasspath&gt;true&lt;/addclasspath&gt;&#13;
                            &lt;mainClass&gt;${main.class}&lt;/mainClass&gt;&#13;
                        &lt;/manifest&gt;&#13;
                    &lt;/archive&gt;&#13;
                &lt;/configuration&gt;&#13;
            &lt;/plugin&gt;&#13;
        &lt;/plugins&gt;&#13;
    &lt;/build&gt;&#13;
&lt;/project&gt;</pre>&#13;
&#13;
<p>With this in place, <code>mvn package</code> will build a runnable JAR file.&#13;
However, if your class has external dependencies, the preceding steps will not package them,&#13;
and you will get a missing class exception when you run it.&#13;
For this, you need to use the Maven assembly plug-in:</p>&#13;
<pre>&lt;plugin&gt;&#13;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;&#13;
    &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;&#13;
    &lt;version&gt;2.6&lt;/version&gt;&#13;
    &lt;configuration&gt;&#13;
        &lt;descriptorRefs&gt;&#13;
            &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;&#13;
        &lt;/descriptorRefs&gt;&#13;
        &lt;archive&gt;&#13;
            &lt;manifest&gt;&#13;
                &lt;addDefaultImplementationEntries&gt;true&#13;
                &lt;/addDefaultImplementationEntries&gt;&#13;
                &lt;mainClass&gt;${main.class}&lt;/mainClass&gt;&#13;
                &lt;!-- &lt;manifestFile&gt;manifest.stub&lt;/manifestFile&gt; --&gt;&#13;
            &lt;/manifest&gt;&#13;
            &lt;manifestEntries&gt;&#13;
                &lt;Vendor-URL&gt;http://YOURDOMAIN.com/SOME_PATH/&lt;/Vendor-URL&gt;&#13;
            &lt;/manifestEntries&gt;&#13;
        &lt;/archive&gt;&#13;
    &lt;/configuration&gt;&#13;
&lt;/plugin&gt;</pre>&#13;
&#13;
<p>Now, the invocation <code>mvn package assembly:single</code> will produce a runnable JAR with all dependencies.&#13;
Note that your <em>target</em> folder will contain both <em>foo-0.0.1-SNAPSHOT.jar</em>&#13;
and <em>foo-0.0.1-SNAPSHOT-jar-with-dependencies.jar</em>; the latter is the one you need.</p>&#13;
&#13;
<p>The <em>jpackage</em> tool (mentioned in this chapter’s introduction) will do much the same job as <em>assembly:single</em>, and is expected to ship with Java 14.<a data-primary="" data-startref="jar_runn" data-type="indexterm" id="idm45290634134648"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.7 Packaging Web Tier Components into a WAR File" data-type="sect1"><div class="sect1" id="javacook-packages-SECT-10">&#13;
<h1>15.7 Packaging Web Tier Components into a WAR File</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-10.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="packages" data-secondary="WAR files as" data-type="indexterm" id="idm45290634130680"/><a data-primary="WAR files, servlets packaged as" data-type="indexterm" id="idm45290634129704"/><a data-primary="servlets" data-type="indexterm" id="idm45290634129016"/>You have some web-tier resources and want to package them into a single file for deploying to the server.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-10.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <em>jar</em> to make a web archive (WAR) file. Or, as mentioned earlier, use Maven with <code>packaging=<em>war</em></code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-10.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>Servlets are server-side components for use in web servers. They can be packaged for easy installation into a web server. A <a data-primary="web application" data-type="indexterm" id="idm45290634122616"/><em>web application</em> in the Servlet API specification is a collection of HTML and/or JSP pages, servlets, and other resources. A typical directory structure might include the following:</p>&#13;
&#13;
<pre data-type="programlisting">Project Root Directory&#13;
├── README.asciidoc&#13;
├── index.html - typical web pages&#13;
|── signup.jsp - ditto&#13;
├── WEB-INF Server directory&#13;
    ├── classes - Directory for individual .class files&#13;
    ├── lib    - Directory for Jar files needed by app&#13;
    └── web.xml - web app Descriptor ("Configuration file")</pre>&#13;
&#13;
<p>Once you have prepared the files in this way, you just package them up with a build tool.&#13;
Using Maven, with <code>&lt;packaging&gt;war&lt;/packaging&gt;</code>, your tree might look like this:</p>&#13;
&#13;
<pre data-type="programlisting">Project Root Directory&#13;
├── README.asciidoc&#13;
├── pom.xml&#13;
└── src&#13;
    └── main&#13;
        ├── java&#13;
        │   └── foo&#13;
        │       └── WebTierClass.java&#13;
        └── webapp&#13;
            ├── WEB-INF&#13;
            │   ├── classes&#13;
            │   ├── lib&#13;
            │   └── web.xml&#13;
            ├── index.html&#13;
            └── signup.jsp</pre>&#13;
&#13;
<p>Then <code>mvn package</code> will compile things, put them in place, and create the WAR file for you,&#13;
leaving it under <em>target</em>.&#13;
Gradle users would use a similar directory structure.</p>&#13;
&#13;
<p>You could also invoke <em>jar</em> manually, though this has little to recommend it.&#13;
You then deploy the resulting WAR file into your web server.&#13;
For details on the deployment step, consult the documentation on the particular server you’re using.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="javacook-packages-SECT-14.4">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>For more information on signing and permissions, see <a data-primary="Java Security (Oaks)" data-type="indexterm" id="idm45290634113896"/><a data-primary="Oaks, Scott" data-secondary="Java Security" data-type="indexterm" id="idm45290634113192"/><em><a class="orm:hideurl" href="http://shop.oreilly.com/product/9780596001575.do">Java Security</a></em> by Scott Oaks. For more&#13;
information on the JDK tools mentioned here, see the documentation that accompanies the&#13;
JDK you are using.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.8 Creating a Smaller Distribution with jlink" data-type="sect1"><div class="sect1" id="javacook-packages-SECT-jlink">&#13;
<h1>15.8 Creating a Smaller Distribution with jlink</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290634109272">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="jlink" data-type="indexterm" id="idm45290634108072"/><a data-primary="packages" data-secondary="distributing" data-type="indexterm" id="idm45290634107368"/>You are distributing your application to end users, and you want to&#13;
minimize the size of your download.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290634105928">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Modularize your application (see <a data-type="xref" href="#javacook-packages-creating-JPMS-modules">Recipe 15.9</a>),&#13;
use <code>jdeps</code> to get a complete list of the modules it uses,&#13;
then use <code>jlink</code> to create the mini-Java,&#13;
and distribute that to your users.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290634102616">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p><code>jlink</code> is a command-line tool introduced in Java 9 that can make&#13;
up a mini-Java distribution containing only your application and&#13;
the JDK classes it uses. That is, it omits any of the thousands of&#13;
JDK classes that your app will never use.</p>&#13;
&#13;
<p>First, you need to compile and package your <code>module-info</code> and your application code.&#13;
You can use Maven or Gradle, or just use the JDK tools directly:</p>&#13;
<pre>$ javac -d . src/*.java&#13;
$ jar cvf demo.jar module-info.class  demo</pre>&#13;
&#13;
<p>If you wish to see the list of modules that will be included, you can&#13;
optionally run the <code>jdeps</code> tool to get this list:</p>&#13;
<pre>$ jdeps --module-path . demo.jar&#13;
demo&#13;
 [file:///Users/ian/workspace/javasrc/jlink/./]&#13;
   requires mandated java.base (@11.0.2)&#13;
demo -&gt; java.base&#13;
   demo          -&gt; java.io        java.base&#13;
   demo          -&gt; java.lang      java.base</pre>&#13;
&#13;
<p>Once the classes have been compiled, you can run the <code>jlink</code> tool to build a&#13;
mini-java distribution with your demo app imbedded:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jlink</code> <code class="o">--</code><code class="n">module</code><code class="o">-</code><code class="n">path</code> <code class="o">.</code> <code class="o">--</code><code class="n">no</code><code class="o">-</code><code class="n">header</code><code class="o">-</code><code class="n">files</code> <code class="err">\</code>&#13;
    <code class="o">--</code><code class="n">no</code><code class="o">-</code><code class="n">man</code><code class="o">-</code><code class="n">pages</code> <code class="o">--</code><code class="n">compress</code><code class="o">=</code><code class="mi">2</code> <code class="o">--</code><code class="n">strip</code><code class="o">-</code><code class="n">debug</code> <code class="err">\</code>&#13;
    <code class="o">--</code><code class="n">launcher</code> <code class="n">rundemo</code><code class="o">=</code><code class="n">demo</code><code class="o">/</code><code class="n">demo</code><code class="o">.</code><code class="na">Hello</code> <code class="err">\</code>&#13;
    <code class="o">--</code><code class="n">add</code><code class="o">-</code><code class="n">modules</code> <code class="n">demo</code> <code class="o">--</code><code class="n">output</code> <code class="n">mini</code><code class="o">-</code><code class="n">java</code></pre>&#13;
&#13;
<p>The <code>--launcher <em>name</em>=<em>module/main</em></code> argument asks <code>jlink</code> to create&#13;
a script file named <em>name</em> to run the application.</p>&#13;
&#13;
<p>If you got no errors, you should be able to run it either with the <em>java</em> command&#13;
or with the generated shell script:</p>&#13;
<pre>$ mini-java/bin/java demo.Hello&#13;
Hello, world.&#13;
$ mini-java/bin/rundemo&#13;
Hello, world.&#13;
$</pre>&#13;
&#13;
<p>You might want to copy the entire mini-Java folder to a machine&#13;
that doesn’t have a regular Java installation and run it there in order&#13;
to be sure you don’t have any missing dependencies.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>The concept of a mini-distribution is appealing, but you must consider&#13;
these issues:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>There is no upgrade mechanism for such mini-Javas.&#13;
These are quite suitable for microservice deployments&#13;
where you rebuild often.&#13;
For applications shipped to customers, though, you’d have&#13;
to regenerate them and get your customers to download and reinstall (on short notice whenever there’s a security update).</p>&#13;
</li>&#13;
<li>&#13;
<p>Disk space is generally no longer expensive relative to the cost of your&#13;
time in maintaining such a distribution.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>Thus, you have to decide if this is worthwhile for your application.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="15.9 Using JPMS to Create a Module" data-type="sect1"><div class="sect1" id="javacook-packages-creating-JPMS-modules">&#13;
<h1>15.9 Using JPMS to Create a Module</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290634042344">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="Java Platform Module System (JPMS)" data-type="indexterm" id="javajpms_ab"/><a data-primary="JPMS (Java Platform Module System)" data-type="indexterm" id="jpmsjpms_b"/>You want your packaged archive to work smoothly with the Java Modules System (JPMS).</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290634038856">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Create a <em>module-info.java</em> file in the root of the source directory.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="idm45290634036856">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>The file <em>module-info.java</em> was introduced in Java 9 to provide the compiler and tools&#13;
with information about your library’s needs and what it provides.&#13;
Note that this is not even a valid Java class filename because it contains a minus sign.&#13;
The module also has a group of pseudokeywords, which only have their special meaning&#13;
inside a module file. The simplest <em>module-info</em> is the following:</p>&#13;
&#13;
<pre data-type="programlisting">module foo {&#13;
    // Empty&#13;
}</pre>&#13;
&#13;
<p>But just as a Java class with no members won’t get you very far in the real world, neither will&#13;
this empty module file. We need to provide some additional information.&#13;
For this example, I will modularize my <code>darwinsys-api</code>, a collection of 40 or so&#13;
randomly accumulated classes that I reuse sometimes.&#13;
Remember that <a data-primary="Jigsaw" data-type="indexterm" id="idm45290634031704"/>Jigsaw (the module system’s early name) was initially proposed as a way&#13;
of modularizing the overgrown JDK itself. Most applications will need the module&#13;
<code>java.base</code> (which is always included). If they need AWT, Swing, or certain other&#13;
desktop-application-related classes, they also need <code>java.desktop</code>.&#13;
Thus I add the following line into the module definition:</p>&#13;
<pre>require java.desktop</pre>&#13;
&#13;
<p>This code also has some JUnit-annotated classes and makes use of JavaMail API,&#13;
so we need those as well.&#13;
JUnit, however, is only needed at test time.&#13;
While Maven offers <code>scope</code>s for compile, test, and runtime, the&#13;
modules system does not.&#13;
Thus we could omit JUnit from the POM file and add it to Eclipse.&#13;
But then <code>maven test</code> will not work.</p>&#13;
&#13;
<p>And unfortunately, as of this writing, there does not appear to be&#13;
modularized version of JavaMail either.&#13;
Fortunately, there is a feature known as <em>automatic modules</em>, by which if you place a JAR file on the&#13;
module path that doesn’t declare a module, its JAR filename will be used as the basis of&#13;
an automatically generated module. So we’ll also add the following:</p>&#13;
<pre>requires mail;</pre>&#13;
&#13;
<p>Unfortunately, when we compile, Maven’s Java Compiler module spits out this scary-looking warning:</p>&#13;
<pre>[WARNING] *********************************************************************&#13;
[WARNING] * Required filename-based automodules detected. Please don't publish&#13;
            this project to a public artifact repository! *&#13;
[WARNING] *********************************************************************</pre>&#13;
&#13;
<p>Given that there are so many public Java API libraries out there, and that most of them depend on&#13;
other libraries in turn, I wonder: how is that state supposed to end?&#13;
Nonetheless, I have heeded that warning, and so people will continue to use the auto-module&#13;
version of <code>com.darwinsys.api</code> until I stumble across modularized JavaMail and JUnit4 APIs.</p>&#13;
&#13;
<p>The <em>module-info</em> also lists any packages that your module desires to make available,&#13;
that is, its public API. So we need a series of export commands:</p>&#13;
<pre>exports com.darwinsys.calendar;&#13;
exports com.darwinsys.csv;&#13;
exports com.darwinsys.database;&#13;
...</pre>&#13;
&#13;
<p>By default, packages that are exported can not be examined using the Reflection API.&#13;
To allow a module to introspect (use the Reflection API) on another,&#13;
say, a domain model used with JPA, use <code>opens</code>.</p>&#13;
&#13;
<p>One of the points of Java interfaces is to allow multiple implementations of a service.&#13;
This is supported in JPMS by the service feature.&#13;
Where an API is defined as one or more interfaces in one module,&#13;
and multiple implementations are provided, each in its own module,&#13;
the implementation module(s) can define an implementation using <code>provides ... with</code>, as in the following:</p>&#13;
<pre>requires com.foo.interfacemodule;&#13;
provides com.foo.interfacemodule.Interface with com.foo.implmodule.ImplClass;</pre>&#13;
&#13;
<p>The completed <em>module-info</em> for the <code>darwinsys-api</code> module is shown in&#13;
<a data-type="xref" href="#javacook-packages-modules-1">Example 15-3</a>.</p>&#13;
<div data-type="example" id="javacook-packages-modules-1">&#13;
<h5><span class="label">Example 15-3. </span>DarwinSys-API module-info</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">module</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">api</code> <code class="o">{</code>&#13;
&#13;
    <code class="n">requires</code> <code class="n">java</code><code class="o">.</code><code class="na">desktop</code><code class="o">;</code>&#13;
    <code class="n">requires</code> <code class="n">java</code><code class="o">.</code><code class="na">persistence</code><code class="o">;</code>&#13;
    <code class="n">requires</code> <code class="n">java</code><code class="o">.</code><code class="na">prefs</code><code class="o">;</code>&#13;
    <code class="n">requires</code> <code class="n">java</code><code class="o">.</code><code class="na">sql</code><code class="o">;</code>&#13;
    <code class="n">requires</code> <code class="n">java</code><code class="o">.</code><code class="na">sql</code><code class="o">.</code><code class="na">rowset</code><code class="o">;</code>&#13;
    <code class="n">requires</code> <code class="n">javax</code><code class="o">.</code><code class="na">servlet</code><code class="o">.</code><code class="na">api</code><code class="o">;</code>&#13;
    <code class="n">requires</code> <code class="n">mail</code><code class="o">;</code>&#13;
    <code class="n">requires</code> <code class="n">junit</code><code class="o">;</code>&#13;
&#13;
    <code class="n">exports</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">calendar</code><code class="o">;</code>&#13;
    <code class="n">exports</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">csv</code><code class="o">;</code>&#13;
    <code class="n">exports</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">database</code><code class="o">;</code>&#13;
    <code class="n">exports</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">diff</code><code class="o">;</code>&#13;
    <code class="n">exports</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">formatting</code><code class="o">;</code>&#13;
    <code class="n">exports</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">locks</code><code class="o">;</code>&#13;
    <code class="n">provides</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">locks</code><code class="o">.</code><code class="na">LockManager</code>&#13;
        <code class="n">with</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">locks</code><code class="o">.</code><code class="na">LockManagerImpl</code><code class="o">;</code>&#13;
    <code class="n">exports</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">model</code><code class="o">;</code>&#13;
    <code class="n">opens</code> <code class="n">com</code><code class="o">.</code><code class="na">darwinsys</code><code class="o">.</code><code class="na">model</code><code class="o">;</code>&#13;
    <code class="c1">// another dozen and a half packages...</code>&#13;
&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>A module wanting to use the lock interface feature would need a <code>requires com.darwinsys</code>&#13;
and might do something like this in code:</p>&#13;
&#13;
<pre data-type="programlisting">import java.util.ServiceLoader;&#13;
import java.util.Optional;&#13;
&#13;
Optional&lt;LockManager&gt; opt = ServiceLoader.load(LockManager.class).findFirst();&#13;
if (!opt.isPresent()) {&#13;
    throw new RuntimeException("Could not find implementation of LockManager");&#13;
}&#13;
LockManager mgr = opt.get();</pre>&#13;
&#13;
<p>The <code>Optional</code> interface is described in <a data-type="xref" href="ch08.html#javacook-oo-SECT-Optionals">Recipe 8.6</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290634035912">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>JPMS is relatively new, and library providers are still learning to use it properly.&#13;
An early posting was <a href="https://openjdk.java.net/projects/jigsaw/quick-start"><em class="hyperlink">https://openjdk.java.net/projects/jigsaw/quick-start</em></a>.&#13;
A plan for migrating to modules can be found at&#13;
<a href="http://tutorials.jenkov.com/java/modules.html#migrating-to-java-9"><em class="hyperlink">http://tutorials.jenkov.com/java/modules.html#migrating-to-java-9</em></a>.&#13;
A discussion about preparing a multi-module Maven application is at&#13;
<a href="https://www.baeldung.com/maven-multi-module-project-java-jpms"><em class="hyperlink">https://www.baeldung.com/maven-multi-module-project-java-jpms</em></a>.&#13;
The book<a data-primary="Java 9 Modularity: Patterns and Practices for Developing Maintainable Applications (Mak and Bakker)" data-primary-sortas="Java 09 Modularity: Patterns and Practices for Developing Maintainable Applications (Mak and Bakker)" data-type="indexterm" id="idm45290633735880"/><a data-primary="Mak, Sander" data-secondary="Java 9 Modularity: Patterns and Practices for Developing Maintainable Applications" data-type="indexterm" id="idm45290633734584"/><a data-primary="Bakker, Paul" data-secondary="Java 9 Modularity: Patterns and Practices for Developing Maintainable Applications" data-type="indexterm" id="idm45290633733784"/>&#13;
<a href="http://shop.oreilly.com/product/0636920049494.do"><em>Java 9 Modularity: Patterns and Practices for Developing Maintainable Applications</em></a> by Sander Mak and Paul Bakker is probably the most comprehensive treatment of JPMS.<a data-primary="" data-startref="javajpms_ab" data-type="indexterm" id="idm45290633731800"/><a data-primary="" data-startref="pac_ch" data-type="indexterm" id="idm45290633730888"/><a data-primary="" data-startref="jpmsjpms_b" data-type="indexterm" id="idm45290633729944"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45290635070328"><sup><a href="ch15.html#idm45290635070328-marker">1</a></sup> This is not strictly true. On Unix in C, at least, there is a distinction between normal include files and those in the <em>sys</em> subdirectory, and many structures have names beginning with one or two letters and an underscore in the password structure, like <code>pw_name</code>, <code>pw_passwd</code>, and <code>pw_home</code>. But this is nowhere near as consistent as Java’s <code>java.*</code> naming conventions.</p><p data-type="footnote" id="idm45290634169336"><sup><a href="ch15.html#idm45290634169336-marker">2</a></sup> Some people like to use names like <em>MyPackage.mf</em> so that it’s clear which package it is for; the extension <em>.mf</em> is arbitrary, but it’s a good convention for identifying manifest files.</p></div></div></section></body></html>