<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 2. The Bank Statements Analyzer"><div class="chapter" id="chapter_02">
<h1><span class="label">Chapter 2. </span>The Bank Statements Analyzer</h1>







<section data-type="sect1" data-pdf-bookmark="The Challenge"><div class="sect1" id="idm45816839356120">
<h1>The Challenge</h1>

<p>The FinTech industry is really hot right now. Mark Erbergzuck realizes that he spends a lot of money on different purchases and would benefit from automatically summarizing his expenses.<a data-type="indexterm" data-primary="bank statements analyzer (example)" id="ix_BSA"/> He receives monthly statements from his bank, but he finds them a bit overwhelming. He has tasked you with developing a piece of software that will automate the processing of his bank statements so he can get better insights into his finances. Challenge accepted!</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The Goal"><div class="sect1" id="idm45816839449976">
<h1>The Goal</h1>

<p>In this chapter, you will learn the foundations about good software development before learning more advanced techniques in the next few chapters.</p>

<p>You will start off by implementing the problem statement in one single class. You will then explore why this approach poses several challenges in terms of coping for changing requirements and maintenance of the project.</p>

<p>But do not worry! You will learn software design principles and techniques to adopt to ensure that the code you write meets these criteria. You will first learn<a data-type="indexterm" data-primary="single responsibility principle (SRP)" id="idm45816839446808"/> about the <em>Single Responsibility Principle</em> (SRP), which helps develop software that is more maintainable, easier to comprehend, and reduces the scope for introducing new bugs. Along the way, you will pick up new concepts such as <em>cohesion</em> and <em>coupling</em>, which are useful characteristics to guide you about the quality of the code and software that you develop.<a data-type="indexterm" data-primary="cohesion" id="idm45816839444424"/><a data-type="indexterm" data-primary="coupling" id="idm45816839443720"/></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This chapter uses libraries and features from Java 8 and above, including the new date and time library.</p>

<p>If at any point you want to look at the source code for this
chapter, you can look at the package <code>com.iteratrlearning.shu_book.chapter_02</code>
in the book’s code repository.</p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Bank Statements Analyzer Requirements"><div class="sect1" id="idm45816839440824">
<h1>Bank Statements Analyzer Requirements</h1>

<p>You had a delicious hipster latte (no added sugar) with Mark Erbergzuck to gather requirements.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="requirements" id="idm45816839439320"/> Because Mark is pretty tech-savvy, he tells you that the bank statements analyzer just needs to read a text file containing a list of bank transactions. He downloads the file from his online banking portal.<a data-type="indexterm" data-primary="comma-separated values (CSV) format" id="idm45816839437928"/> This text is structured using a comma-separated values (CSV) format. Here is a sample of bank transactions:</p>

<pre data-type="programlisting">30-01-2017,-100,Deliveroo
30-01-2017,-50,Tesco
01-02-2017,6000,Salary
02-02-2017,2000,Royalties
02-02-2017,-4000,Rent
03-02-2017,3000,Tesco
05-02-2017,-30,Cinema</pre>

<p>He would like to get an answer for the following queries:</p>

<ul>
<li>
<p>What is the total profit and loss from a list of bank statements? Is it positive or negative?</p>
</li>
<li>
<p>How many bank transactions are there in a particular month?</p>
</li>
<li>
<p>What are his top-10 expenses?</p>
</li>
<li>
<p>Which category does he spend most of his money on?</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="KISS Principle"><div class="sect1" id="idm45816839431432">
<h1>KISS Principle</h1>

<p>Let’s start simple. How about the first query: “What is the total profit and loss from a list of bank statements?” You need to process a CSV file and calculate the sum of all the amounts. Since there is nothing else required, you may decide that there is no need to create a very complex application.<a data-type="indexterm" data-primary="KISS principle" id="idm45816839429384"/></p>

<p>You can “Keep It Short and Simple” (KISS) and have the application code in one single class as shown in <a data-type="xref" href="#bank_analyzer_simple">Example 2-1</a>. Note that you do not have to worry about possible exceptions yet (e.g., what if the file does not exist or what if parsing a loaded file fails?). That is a topic that you will learn about in <a data-type="xref" href="ch03.xhtml#chapter_03">Chapter 3</a>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>CSV is not fully standardized. It’s often referred to as values separated by commas.<a data-type="indexterm" data-primary="delimiter-separated formats" id="idm45816839425320"/> However, some people refer to it as a delimiter-separated format that uses different delimiters, such as semicolons or tabs. <a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="calculating sum of all statements" id="idm45816839424328"/>These requirements can add more complexity to the implementation of a parser. In this chapter, we will assume that values are separated by a comma (<code>,</code>).</p>
</div>
<div id="bank_analyzer_simple" data-type="example">
<h5><span class="label">Example 2-1. </span>Calculating the sum of all statements</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankTransactionAnalyzerSimple</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">RESOURCES</code> <code class="o">=</code> <code class="s">"src/main/resources/"</code><code class="o">;</code>

    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code><code class="o">...</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>

        <code class="kd">final</code> <code class="n">Path</code> <code class="n">path</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">RESOURCES</code> <code class="o">+</code> <code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code>
        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllLines</code><code class="o">(</code><code class="n">path</code><code class="o">);</code>
        <code class="kt">double</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="n">d</code><code class="o">;</code>
        <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="nl">line:</code> <code class="n">lines</code><code class="o">)</code> <code class="o">{</code>
            <code class="kd">final</code> <code class="n">String</code><code class="o">[]</code> <code class="n">columns</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="na">split</code><code class="o">(</code><code class="s">","</code><code class="o">);</code>
            <code class="kd">final</code> <code class="kt">double</code> <code class="n">amount</code> <code class="o">=</code> <code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="n">columns</code><code class="o">[</code><code class="mi">1</code><code class="o">]);</code>
            <code class="n">total</code> <code class="o">+=</code> <code class="n">amount</code><code class="o">;</code>
        <code class="o">}</code>

        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The total for all transactions is "</code> <code class="o">+</code> <code class="n">total</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>What is happening here? You are loading the CSV file passed as a command-line argument to the application.<a data-type="indexterm" data-primary="Path class" id="idm45816839416456"/> The <code>Path</code> class represents a path in the filesystem. You then use <code>Files.readAllLines()</code> to return a list of lines.<a data-type="indexterm" data-primary="Files.readAllLines method" id="idm45816839414904"/> Once you have all the lines from the file, you can parse them one at a time by:</p>

<ul>
<li>
<p>Splitting the columns by commas</p>
</li>
<li>
<p>Extracting the amount</p>
</li>
<li>
<p>Parsing the amount to a <code>double</code></p>
</li>
</ul>

<p>Once you have the amount for a given statement as a <code>double</code> you can then add it to the current total. At the end of the processing, you will have the total amount.</p>

<p>The code in <a data-type="xref" href="#bank_analyzer_simple">Example 2-1</a> will work fine, but it misses a few corner cases that are always good to think about when writing production-ready code:</p>

<ul>
<li>
<p>What if the file is empty?</p>
</li>
<li>
<p>What if parsing the amount fails because the data was corrupted?</p>
</li>
<li>
<p>What if a statement line has missing data?</p>
</li>
</ul>

<p>We will come back to the topic of dealing with exceptions in <a data-type="xref" href="ch03.xhtml#chapter_03">Chapter 3</a>, but it is a good habit to keep these types of questions in mind.</p>

<p>How about solving the second query: “How many bank transactions are there in a particular month?” What can you do? Copy and paste is a simple technique, right? You could just copy and paste the same code and replace the logic so it selects the given month, as shown in <a data-type="xref" href="#bank_analyzer_month">Example 2-2</a>.</p>
<div id="bank_analyzer_month" data-type="example">
<h5><span class="label">Example 2-2. </span>Calculating the sum of January statements</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">final</code> <code class="n">Path</code> <code class="n">path</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">RESOURCES</code> <code class="o">+</code> <code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code>
<code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllLines</code><code class="o">(</code><code class="n">path</code><code class="o">);</code>
<code class="kt">double</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="n">d</code><code class="o">;</code>
<code class="kd">final</code> <code class="n">DateTimeFormatter</code> <code class="n">DATE_PATTERN</code> <code class="o">=</code> <code class="n">DateTimeFormatter</code><code class="o">.</code><code class="na">ofPattern</code><code class="o">(</code><code class="s">"dd-MM-yyyy"</code><code class="o">);</code>
<code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="nl">line:</code> <code class="n">lines</code><code class="o">)</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">String</code><code class="o">[]</code> <code class="n">columns</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="na">split</code><code class="o">(</code><code class="s">","</code><code class="o">);</code>
    <code class="kd">final</code> <code class="n">LocalDate</code> <code class="n">date</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">parse</code><code class="o">(</code><code class="n">columns</code><code class="o">[</code><code class="mi">0</code><code class="o">],</code> <code class="n">DATE_PATTERN</code><code class="o">);</code>
    <code class="k">if</code><code class="o">(</code><code class="n">date</code><code class="o">.</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">Month</code><code class="o">.</code><code class="na">JANUARY</code><code class="o">)</code> <code class="o">{</code>
        <code class="kd">final</code> <code class="kt">double</code> <code class="n">amount</code> <code class="o">=</code> <code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="n">columns</code><code class="o">[</code><code class="mi">1</code><code class="o">]);</code>
        <code class="n">total</code> <code class="o">+=</code> <code class="n">amount</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The total for all transactions in January is "</code> <code class="o">+</code> <code class="n">total</code><code class="o">);</code></pre></div>








<section data-type="sect2" data-pdf-bookmark="final Variables"><div class="sect2" id="idm45816839130216">
<h2>final Variables</h2>

<p>As a short detour, we’ll explain the use of the <code>final</code> keyword in the code examples.<a data-type="indexterm" data-primary="final variables" id="idm45816839128472"/> Throughout this book we’ve used the <code>final</code> keyword fairly extensively. Marking a local variable or a field <code>final</code>
means that it cannot be re-assigned. Whether you use <code>final</code> or not in your project is a collective matter for your team
and project since its use has both benefits and drawbacks. We’ve found that marking as many variables <code>final</code> as
possible clearly demarcates what state is mutated during the lifetime of an object and what state isn’t re-assigned.</p>

<p>On the other hand, the use of the <code>final</code> keyword doesn’t guarantee immutability of the object in question.<a data-type="indexterm" data-primary="immutability" data-secondary="final keyword and" id="idm45816839042664"/> You can
have a <code>final</code> field that refers to an object with mutable state. We will be discussing immutability in more detail in <a data-type="xref" href="ch04.xhtml#chapter_04">Chapter 4</a>. Furthermore, its use also adds a lot of boilerplate
to the codebase. Some teams pick the compromise position of having <code>final</code> fields on method parameters, in order to ensure
that they are clearly not re-assigned and not local variables.</p>

<p>One area where there is little point in using the <code>final</code> keyword, although the Java language allows it, is for method
parameters on abstract methods; for example, in interfaces. This is because the lack of body means that there is no
real implication or meaning to the <code>final</code> keyword in this situation. Arguably the use of <code>final</code> has <span class="keep-together">diminished</span> since
the introduction of the <code>var</code> keyword in Java 10, and we discuss this concept later in <a data-type="xref" href="ch05.xhtml#local_variable_type_inference">Example 5-15</a>.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Code Maintainability and Anti-Patterns"><div class="sect1" id="idm45816839430808">
<h1>Code Maintainability and Anti-Patterns</h1>

<p>Do you think the copy-and-paste approach demonstrated in <a data-type="xref" href="#bank_analyzer_month">Example 2-2</a> is a good idea? Time to take a step back and reflect on what is happening.
When you write code, you should strive<a data-type="indexterm" data-primary="code" data-secondary="maintainability" id="idm45816839033064"/> for providing good <em>code maintainability</em>. What does this mean?
It is best described by a wish list of properties about the code you write:</p>

<ul>
<li>
<p>It should be simple to locate code responsible for a particular feature.</p>
</li>
<li>
<p>It should be simple to understand what the code does.</p>
</li>
<li>
<p>It should be simple to add or remove a new feature.</p>
</li>
<li>
<p>It should provide good <em>encapsulation</em>. <a data-type="indexterm" data-primary="encapsulation" id="idm45816839027304"/>In other words, implementation details should be hidden from a user of your code so it is easier to understand and make changes.</p>
</li>
</ul>

<p>A good way to think about the impact of the code you write is to consider what happens if a work colleague of yours has to look at your code in six months and you have moved to a different company.</p>

<p>Ultimately your goal is to manage the complexity of the application you are building. However, if you keep on copy pasting the same code as new requirements come in, you will end up with the following issues, which are called <em>anti-patterns</em> because <a data-type="indexterm" data-primary="anti-patterns" id="idm45816839024376"/>they are common ineffective solutions:</p>

<ul>
<li>
<p>Hard to understand code because you have one giant <em>“God Class”</em></p>
</li>
<li>
<p>Code that is brittle and easily broken by changes because of <em>code duplication</em></p>
</li>
</ul>

<p>Let’s explain these two anti-patterns in more detail.<a data-type="indexterm" data-primary="God class" id="idm45816839020248"/></p>








<section data-type="sect2" data-pdf-bookmark="God Class"><div class="sect2" id="idm45816839019416">
<h2>God Class</h2>

<p>By putting all of your code in one file, you end up with one giant class making it harder to understand its purpose because that class is responsible for everything!
If you need to update the logic of existing code (e.g., change how the parsing works) how will you easily locate that code and make changes? This problem is referred to as<a data-type="indexterm" data-primary="anti-patterns" data-secondary="God class" id="idm45816839017768"/> the anti-pattern “God Class.” Essentially you have one class that does everything. You should avoid this. In the next section, you will learn about the <em>Single Responsibility Principle</em>, which is a software development guideline to help write code that is easier to understand and maintain.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Code Duplication"><div class="sect2" id="idm45816839015720">
<h2>Code Duplication</h2>

<p>For each query, you are duplicating the logic for reading and parsing the input. <a data-type="indexterm" data-primary="code" data-secondary="duplication" id="idm45816839014184"/><a data-type="indexterm" data-primary="anti-patterns" data-secondary="code duplication" id="idm45816839013208"/>What if the input required is no longer CSV but a JSON file? What if multiple formats need to be supported? Adding such a feature will be a painful change because your code has hardcoded one specific solution and duplicated that behavior in multiple places. Consequently, all the places will all have to change and you will potentially introduce new bugs.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You will often hear about the “Don’t Repeat Yourself” (DRY) principle. It is the idea that when you successfully reduce repetition, a modification of the logic does not require multiple modifications of your code anymore.</p>
</div>

<p>A related problem is what if the data format changes? The code only supports a specific data format pattern. If it needs to be enhanced (e.g., new columns) or a different data format needs to be supported (e.g., different attribute names) you will again have to make many changes across your code.</p>

<p>The conclusion is that it is good to keep things simple when possible, but do not abuse the KISS principle. Instead, you need to reflect on the design of your whole application and have an understanding of how to break down the problem into separate sub-problems that are easier to manage individually. The result is that you will have code that is easier to understand, maintain, and adapt to new requirements.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Single Responsibility Principle"><div class="sect1" id="idm45816839008712">
<h1>Single Responsibility Principle</h1>

<p>The <em>Single Responsibility Principle</em> (SRP) is a general<a data-type="indexterm" data-primary="single responsibility principle (SRP)" id="ix_SRP"/> software development guideline to follow that contributes to writing code that is easier to manage and maintain.</p>

<p>You can <a data-type="indexterm" data-primary="classes" data-secondary="single responsibility principle" id="idm45816839004696"/>think about SRP in two complementary ways:</p>

<ul>
<li>
<p>A class has responsibility over a single functionality</p>
</li>
<li>
<p>There is only one single reason for a class to change<sup><a data-type="noteref" id="idm45816839001464-marker" href="ch02.xhtml#idm45816839001464">1</a></sup></p>
</li>
</ul>

<p>The SRP is usually applied to classes and methods. SRP is concerned with one particular behavior, concept, or category.
It leads to code that is more robust because there is one specific reason why it should change rather than multiple concerns.
The reason why multiple concerns is problematic is, as you saw earlier, it complicates code <span class="keep-together">maintainability</span> by potentially introducing bugs in several places. It can also make the code harder to understand and change.</p>

<p>So how do you apply SRP in the code shown in <a data-type="xref" href="#bank_analyzer_month">Example 2-2</a>? It is clear <a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="applying single responsibility pattern to code" id="idm45816838997720"/>that the main class has multiple responsibilities that can be broken down individually:</p>
<ol>
<li>
<p>Reading input</p>
</li>
<li>
<p>Parsing the input in a given format</p>
</li>
<li>
<p>Processing the result</p>
</li>
<li>
<p>Reporting a summary of the result</p>
</li>

</ol>

<p>We will focus on the parsing part in this chapter. You will learn how to extend the Bank Statements Analyzer in the next chapter so that it is completely modularized.</p>

<p>The first natural step is to extract the CSV parsing logic into a separate class so you can reuse it for different processing queries.
Let’s call it <code>BankStatementCSVParser</code> so it is immediately <a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="applying single responsibility pattern to code" data-tertiary="extracting parsing logic into a class" id="idm45816838990936"/><a data-type="indexterm" data-primary="comma-separated values (CSV) format" data-secondary="extracting parsing logic into BankStatementCSVParser class" id="idm45816838989544"/>clear what it does (<a data-type="xref" href="#bank_csv_parser_extract">Example 2-3</a>).</p>
<div id="bank_csv_parser_extract" data-type="example">
<h5><span class="label">Example 2-3. </span>Extracting the parsing logic in a separate class</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankStatementCSVParser</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">DateTimeFormatter</code> <code class="n">DATE_PATTERN</code>
        <code class="o">=</code> <code class="n">DateTimeFormatter</code><code class="o">.</code><code class="na">ofPattern</code><code class="o">(</code><code class="s">"dd-MM-yyyy"</code><code class="o">);</code>

    <code class="kd">private</code> <code class="n">BankTransaction</code> <code class="nf">parseFromCSV</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">line</code><code class="o">)</code> <code class="o">{</code>
        <code class="kd">final</code> <code class="n">String</code><code class="o">[]</code> <code class="n">columns</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="na">split</code><code class="o">(</code><code class="s">","</code><code class="o">);</code>

        <code class="kd">final</code> <code class="n">LocalDate</code> <code class="n">date</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">parse</code><code class="o">(</code><code class="n">columns</code><code class="o">[</code><code class="mi">0</code><code class="o">],</code> <code class="n">DATE_PATTERN</code><code class="o">);</code>
        <code class="kd">final</code> <code class="kt">double</code> <code class="n">amount</code> <code class="o">=</code> <code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="n">columns</code><code class="o">[</code><code class="mi">1</code><code class="o">]);</code>
        <code class="kd">final</code> <code class="n">String</code> <code class="n">description</code> <code class="o">=</code> <code class="n">columns</code><code class="o">[</code><code class="mi">2</code><code class="o">];</code>

        <code class="k">return</code> <code class="k">new</code> <code class="nf">BankTransaction</code><code class="o">(</code><code class="n">date</code><code class="o">,</code> <code class="n">amount</code><code class="o">,</code> <code class="n">description</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">parseLinesFromCSV</code><code class="o">(</code><code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code><code class="o">)</code> <code class="o">{</code>
        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
        <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="nl">line:</code> <code class="n">lines</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">bankTransactions</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">parseFromCSV</code><code class="o">(</code><code class="n">line</code><code class="o">));</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">bankTransactions</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>You can see that the class <code>BankStatementCSVParser</code> declares two methods, <code>parseFromCSV()</code> and <code>parseLinesFromCSV()</code>, that generate <code>BankTransaction</code> objects, which is a domain class that models a bank statement (see <a data-type="xref" href="#bank_transaction_class">Example 2-4</a> for its declaration).<a data-type="indexterm" data-primary="domains" id="idm45816838540424"/></p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>What does <em>domain</em> mean? It means the use of words and terminology that match the business problem (i.e., the domain at hand).</p>
</div>

<p>The <code>BankTransaction</code> class is useful so that different parts of our application share the same common understanding of what a bank statement is. You will notice that the class provides implementation for the methods <code>equals</code> and <code>hashcode</code>.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="applying single responsibility pattern to code" data-tertiary="domain class for bank transactions" id="idm45816838536008"/> The purpose of these methods and how to implement them correctly is covered in <a data-type="xref" href="ch06.xhtml#chapter_06">Chapter 6</a>.</p>
<div id="bank_transaction_class" data-type="example">
<h5><span class="label">Example 2-4. </span>A domain class for a bank transaction</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankTransaction</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">LocalDate</code> <code class="n">date</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">amount</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">description</code><code class="o">;</code>


    <code class="kd">public</code> <code class="nf">BankTransaction</code><code class="o">(</code><code class="kd">final</code> <code class="n">LocalDate</code> <code class="n">date</code><code class="o">,</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">amount</code><code class="o">,</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">description</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">date</code> <code class="o">=</code> <code class="n">date</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">amount</code> <code class="o">=</code> <code class="n">amount</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">description</code> <code class="o">=</code> <code class="n">description</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">LocalDate</code> <code class="nf">getDate</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">date</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getAmount</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">amount</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getDescription</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">description</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">toString</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="s">"BankTransaction{"</code> <code class="o">+</code>
                <code class="s">"date="</code> <code class="o">+</code> <code class="n">date</code> <code class="o">+</code>
                <code class="s">", amount="</code> <code class="o">+</code> <code class="n">amount</code> <code class="o">+</code>
                <code class="s">", description='"</code> <code class="o">+</code> <code class="n">description</code> <code class="o">+</code> <code class="sc">'\''</code> <code class="o">+</code>
                <code class="sc">'}'</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">equals</code><code class="o">(</code><code class="n">Object</code> <code class="n">o</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="k">this</code> <code class="o">==</code> <code class="n">o</code><code class="o">)</code> <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">o</code> <code class="o">==</code> <code class="kc">null</code> <code class="o">||</code> <code class="n">getClass</code><code class="o">()</code> <code class="o">!=</code> <code class="n">o</code><code class="o">.</code><code class="na">getClass</code><code class="o">())</code> <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
        <code class="n">BankTransaction</code> <code class="n">that</code> <code class="o">=</code> <code class="o">(</code><code class="n">BankTransaction</code><code class="o">)</code> <code class="n">o</code><code class="o">;</code>
        <code class="k">return</code> <code class="n">Double</code><code class="o">.</code><code class="na">compare</code><code class="o">(</code><code class="n">that</code><code class="o">.</code><code class="na">amount</code><code class="o">,</code> <code class="n">amount</code><code class="o">)</code> <code class="o">==</code> <code class="mi">0</code> <code class="o">&amp;&amp;</code>
                <code class="n">date</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">that</code><code class="o">.</code><code class="na">date</code><code class="o">)</code> <code class="o">&amp;&amp;</code>
                <code class="n">description</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">that</code><code class="o">.</code><code class="na">description</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">hashCode</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">Objects</code><code class="o">.</code><code class="na">hash</code><code class="o">(</code><code class="n">date</code><code class="o">,</code> <code class="n">amount</code><code class="o">,</code> <code class="n">description</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>Now you can refactor the application <a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="applying single responsibility pattern to code" data-tertiary="using the CSV parser" id="idm45816838525544"/>so that it uses your <code>BankStatementCSVParser</code>, in particular its <code>parseLinesFromCSV()</code> method, as shown in <a data-type="xref" href="#bank_statement_in_action">Example 2-5</a>.</p>
<div id="bank_statement_in_action" data-type="example">
<h5><span class="label">Example 2-5. </span>Using the bank statement CSV parser</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">final</code> <code class="n">BankStatementCSVParser</code> <code class="n">bankStatementParser</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BankTransactionCSVParser</code><code class="o">();</code>

<code class="kd">final</code> <code class="n">String</code> <code class="n">fileName</code> <code class="o">=</code> <code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">];</code>
<code class="kd">final</code> <code class="n">Path</code> <code class="n">path</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">RESOURCES</code> <code class="o">+</code> <code class="n">fileName</code><code class="o">);</code>
<code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllLines</code><code class="o">(</code><code class="n">path</code><code class="o">);</code>

<code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code>
    <code class="o">=</code> <code class="n">bankStatementParser</code><code class="o">.</code><code class="na">parseLinesFromCSV</code><code class="o">(</code><code class="n">lines</code><code class="o">);</code>

<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The total for all transactions is "</code> <code class="o">+</code> <code class="n">calculateTotalAmount</code><code class="o">(</code><code class="n">bankTransactions</code><code class="o">));</code>
<code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Transactions in January "</code> <code class="o">+</code> <code class="n">selectInMonth</code><code class="o">(</code><code class="n">BankTransactions</code><code class="o">,</code> <code class="n">Month</code><code class="o">.</code><code class="na">JANUARY</code><code class="o">));</code></pre></div>

<p>The different queries you have to implement no longer need to know about internal parsing details, as you can now use <code>BankTransaction</code> objects directly to extract the information required. The code in <a data-type="xref" href="#bank_statement_processing">Example 2-6</a> shows how to declare the methods <code>calculateTotalAmount()</code> and <code>selectInMonth()</code>, which are responsible for processing the list of transactions and returning an appropriate result. In <a data-type="xref" href="ch03.xhtml#chapter_03">Chapter 3</a> you will get an overview of lambda expressions and the Streams API, which will help tidy the code further.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="applying single responsibility pattern to code" data-tertiary="processing lists of bank transactions" id="idm45816838384632"/></p>
<div id="bank_statement_processing" data-type="example">
<h5><span class="label">Example 2-6. </span>Processing lists of bank transactions</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">double</code> <code class="nf">calculateTotalAmount</code><code class="o">(</code><code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="n">d</code><code class="o">;</code>
    <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">total</code> <code class="o">+=</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">();</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="n">total</code><code class="o">;</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">static</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">selectInMonth</code><code class="o">(</code><code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code><code class="o">,</code> <code class="kd">final</code> <code class="n">Month</code> <code class="n">month</code><code class="o">)</code> <code class="o">{</code>

    <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactionsInMonth</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
    <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">.</code><code class="na">getDate</code><code class="o">().</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">month</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">bankTransactionsInMonth</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="n">bankTransactionsInMonth</code><code class="o">;</code>
<code class="o">}</code></pre></div>

<p>The key benefit with this refactoring is that your main application is no longer responsible for the implementation of the parsing logic. It is now delegating <span class="keep-together">that responsibility</span> to a separate class and methods that can be maintained and updated independently. As new requirements come in for different queries, you can reuse the functionality encapsulated by the <code>BankStatementCSVParser</code> class.</p>

<p>In addition, if you need to change the way the parsing algorithm works (e.g., a more efficient implementation that caches results), you now have just a single place that needs to change. Moreover, you introduced a class called <code>BankTransaction</code> that other parts of your code can rely on without depending on a specific data format pattern.</p>

<p>It is a good habit to follow the <em>principle of least surprise</em> when you implement methods.<a data-type="indexterm" data-primary="principle of least surprise" id="idm45816838178520"/> It will help ensure that it is obvious what is happening when looking at the code. This means:</p>

<ul>
<li>
<p>Use self-documenting method names so it is immediately obvious what they do (e.g., <code>calculateTotalAmount()</code>)</p>
</li>
<li>
<p>Do not change the state of parameters as other parts of code may depend on it</p>
</li>
</ul>

<p>The principle of least surprise can be a subjective concept, though. When in doubt, speak to your colleagues and team members to ensure everyone is aligned.<a data-type="indexterm" data-primary="single responsibility principle (SRP)" data-startref="ix_SRP" id="idm45816838174456"/></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Cohesion"><div class="sect1" id="idm45816839007768">
<h1>Cohesion</h1>

<p>So far you <a data-type="indexterm" data-primary="cohesion" id="ix_cohe"/>have learned about three principles: <em>KISS</em>, <em>DRY</em>, and <em>SRP</em>. But you have not learned about characteristics to reason about the quality of your code.
In software engineering you will often hear about <em>cohesion</em> as an important characteristic of different parts of the code you write.
It sounds fancy, but it is a really useful concept to give you an indication about the maintainability of your code.</p>

<p>Cohesion is concerned with <em>how related</em> things are. To be more precise, cohesion measures how strongly related responsibilities of a class or method are. In other words, how much do things belong together? It is a way to help you reason about the complexity of your software. What you want to achieve is <em>high cohesion</em>, which means that the code is easier for others to locate, understand, and use. In the code that you refactored earlier, the class <code>BankTransactionCSVParser</code> is highly cohesive. In fact, it groups together two methods that are related to parsing CSV data.</p>

<p>Generally, the concept of cohesion is applied to classes (class-level cohesion), but it can also be applied to methods (method-level cohesion).</p>

<p>If you take the entry point to your program, the class <code>BankStatementAnalyzer</code>, you will notice that its responsibility is to wire up the different parts of your application such as the parser and the calculations and report back on the screen. However, the logic responsible for doing calculations is currently declared as static methods within the <code>BankStatementAnalyzer</code>. This is an example of poor cohesion because the concerns of calculations declared in this class are not directly related to parsing or <span class="keep-together">reporting</span>.</p>

<p>Instead, you can extract the calculation operations into a separate class called <code>BankStatementProcessor</code>. You can also see that the list of transactions method argument is shared for all these operations, so you can include it as a field to the class. As a result, your method signatures become simpler to reason about and the class <code>BankStatementProcessor</code> is more cohesive. The code in <a data-type="xref" href="#bank_statement_processor_class">Example 2-7</a> shows the end result. The additional advantage is that the methods of <code>BankStatementProcessor</code> can be reused by other parts of your application without depending on the whole <code>BankStatement​Analyzer</code>.</p>
<div id="bank_statement_processor_class" data-type="example">
<h5><span class="label">Example 2-7. </span>Grouping the calculation operations in the class BankStatementProcessor</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankStatementProcessor</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">BankStatementProcessor</code><code class="o">(</code><code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">bankTransactions</code> <code class="o">=</code> <code class="n">bankTransactions</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">calculateTotalAmount</code><code class="o">()</code> <code class="o">{</code>
        <code class="kt">double</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
        <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">total</code> <code class="o">+=</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">();</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">total</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">calculateTotalInMonth</code><code class="o">(</code><code class="kd">final</code> <code class="n">Month</code> <code class="n">month</code><code class="o">)</code> <code class="o">{</code>
        <code class="kt">double</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
        <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">if</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">.</code><code class="na">getDate</code><code class="o">().</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">month</code><code class="o">)</code> <code class="o">{</code>
                <code class="n">total</code> <code class="o">+=</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">();</code>
            <code class="o">}</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">total</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">calculateTotalForCategory</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">category</code><code class="o">)</code> <code class="o">{</code>
        <code class="kt">double</code> <code class="n">total</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
        <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">if</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">.</code><code class="na">getDescription</code><code class="o">().</code><code class="na">equals</code><code class="o">(</code><code class="n">category</code><code class="o">))</code> <code class="o">{</code>
                <code class="n">total</code> <code class="o">+=</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">();</code>
            <code class="o">}</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">total</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>You can now make use the methods of this class with the <code>BankStatementAnalyzer</code> as shown in <a data-type="xref" href="#refactored_bank_statement_analyzer">Example 2-8</a>.</p>
<div id="refactored_bank_statement_analyzer" data-type="example">
<h5><span class="label">Example 2-8. </span>Processing lists of bank transactions using the BankStatementProcessor class</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankStatementAnalyzer</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">RESOURCES</code> <code class="o">=</code> <code class="s">"src/main/resources/"</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">BankStatementCSVParser</code> <code class="n">bankStatementParser</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BankStatementCSVParser</code><code class="o">();</code>

    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code><code class="o">...</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>

        <code class="kd">final</code> <code class="n">String</code> <code class="n">fileName</code> <code class="o">=</code> <code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">];</code>
        <code class="kd">final</code> <code class="n">Path</code> <code class="n">path</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">RESOURCES</code> <code class="o">+</code> <code class="n">fileName</code><code class="o">);</code>
        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllLines</code><code class="o">(</code><code class="n">path</code><code class="o">);</code>

        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code> <code class="o">=</code> <code class="n">bankStatementParser</code><code class="o">.</code><code class="na">parseLinesFrom</code><code class="o">(</code><code class="n">lines</code><code class="o">);</code>
        <code class="kd">final</code> <code class="n">BankStatementProcessor</code> <code class="n">bankStatementProcessor</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BankStatementProcessor</code><code class="o">(</code><code class="n">bankTransactions</code><code class="o">);</code>

        <code class="n">collectSummary</code><code class="o">(</code><code class="n">bankStatementProcessor</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">private</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">collectSummary</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankStatementProcessor</code> <code class="n">bankStatementProcessor</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The total for all transactions is "</code>
                <code class="o">+</code> <code class="n">bankStatementProcessor</code><code class="o">.</code><code class="na">calculateTotalAmount</code><code class="o">());</code>

        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The total for transactions in January is "</code>
                <code class="o">+</code> <code class="n">bankStatementProcessor</code><code class="o">.</code><code class="na">calculateTotalInMonth</code><code class="o">(</code><code class="n">Month</code><code class="o">.</code><code class="na">JANUARY</code><code class="o">));</code>

        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The total for transactions in February is "</code>
                <code class="o">+</code> <code class="n">bankStatementProcessor</code><code class="o">.</code><code class="na">calculateTotalInMonth</code><code class="o">(</code><code class="n">Month</code><code class="o">.</code><code class="na">FEBRUARY</code><code class="o">));</code>

        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"The total salary received is "</code>
                <code class="o">+</code> <code class="n">bankStatementProcessor</code><code class="o">.</code><code class="na">calculateTotalForCategory</code><code class="o">(</code><code class="s">"Salary"</code><code class="o">));</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>In the next subsections, you will focus on learning guidelines to help you write code that is easier to reason and maintain.</p>








<section data-type="sect2" data-pdf-bookmark="Class-Level Cohesion"><div class="sect2" id="idm45816837942872">
<h2>Class-Level Cohesion</h2>

<p>In practice, you will<a data-type="indexterm" data-primary="class-level cohesion" id="ix_clcoh"/> come across at least six<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="class-level cohesion in" id="ix_BSAclco"/><a data-type="indexterm" data-primary="cohesion" data-secondary="class-level" id="ix_cohecl"/> common ways to group methods:</p>

<ul>
<li>
<p>Functional</p>
</li>
<li>
<p>Informational</p>
</li>
<li>
<p>Utility</p>
</li>
<li>
<p>Logical</p>
</li>
<li>
<p>Sequential</p>
</li>
<li>
<p>Temporal</p>
</li>
</ul>

<p>Keep in mind that if the methods you are grouping are weakly related, you have low cohesion. We discuss them in order and <a data-type="xref" href="#summary_cohesion">Table 2-1</a> provides a summary.</p>










<section data-type="sect3" data-pdf-bookmark="Functional"><div class="sect3" id="idm45816837678568">
<h3>Functional</h3>

<p>The approach you took when writing the <code>BankStatementCSVParser</code> was to group the methods functionally.<a data-type="indexterm" data-primary="functional cohesion" id="idm45816837676552"/><a data-type="indexterm" data-primary="class-level cohesion" data-secondary="functional" id="idm45816837675848"/> The methods <code>parseFrom()</code> and <code>parseLinesFrom()</code> are solving a defined task: parse the lines in the CSV format.
In fact, the method <code>parseLinesFrom()</code> uses the method <code>parseFrom()</code>. This is generally a good way to achieve high cohesion because the methods are working together, so it makes sense to group them so they are easier to locate and understand.
The danger with functional cohesion is that it may be tempting to have a profusion of overly simplistic classes grouping only a single method. Going down the road of overly simplistic classes adds unnecessary verbosity and complexity because there are many more classes to think about.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Informational"><div class="sect3" id="idm45816837672440">
<h3>Informational</h3>

<p>Another reason to group methods is because they work on the same data or domain object.<a data-type="indexterm" data-primary="informational cohesion" id="idm45816837670872"/><a data-type="indexterm" data-primary="class-level cohesion" data-secondary="informational" id="idm45816837670168"/> Say you needed a way to create, read, update, and delete <code>BankTransaction</code> objects (CRUD operations); you may wish to have a class dedicated for these operations. The code in <a data-type="xref" href="#bank_statement_informational">Example 2-9</a> shows a class that exhibits informational cohesion with four different methods. Each method throws a <code>UnsupportedOperationException</code> to indicate the body is currently unimplemented for the purpose of the example.</p>
<div id="bank_statement_informational" data-type="example">
<h5><span class="label">Example 2-9. </span>An example of informational cohesion</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankTransactionDAO</code> <code class="o">{</code>

    <code class="kd">public</code> <code class="n">BankTransaction</code> <code class="nf">create</code><code class="o">(</code><code class="kd">final</code> <code class="n">LocalDate</code> <code class="n">date</code><code class="o">,</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">amount</code><code class="o">,</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">description</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// ...</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">BankTransaction</code> <code class="nf">read</code><code class="o">(</code><code class="kd">final</code> <code class="kt">long</code> <code class="n">id</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// ...</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">BankTransaction</code> <code class="nf">update</code><code class="o">(</code><code class="kd">final</code> <code class="kt">long</code> <code class="n">id</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// ...</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">delete</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="n">BankTransaction</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// ...</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>This is a typical pattern that you see often when interfacing with a database that maintains a table for a specific domain object.<a data-type="indexterm" data-primary="data access object (DAO) pattern" id="idm45816837662824"/> This pattern is usually called <em>Data Access Object</em> (DAO) and requires some kind of ID to identify the objects. DAOs essentially abstract and encapsulate access to a data source, such as a persistent database or an in-memory database.</p>
</div>

<p>The downside of this approach is that this kind of cohesion can group multiple concerns together, which introduces additional dependencies for a class that only uses and requires some of the operations.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Utility"><div class="sect3" id="idm45816837622280">
<h3>Utility</h3>

<p>You may be tempted to group different unrelated methods inside a class.<a data-type="indexterm" data-primary="utility cohesion" id="idm45816837620984"/><a data-type="indexterm" data-primary="class-level cohesion" data-secondary="utility" id="idm45816837620280"/> This happens when it is not obvious where the methods belong so you end up with a utility class that is a bit like a jack of all trades.</p>

<p>This is generally to be avoided because you end up with low cohesion. The methods are not related, so the class as a whole is harder to reason about. In addition, utility classes exhibit a poor discoverability characteristic. You want your code to be easy to find and easy to understand how it is supposed to be used. Utility classes go against this principle because they contain different methods that are unrelated without a clear categorization.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Logical"><div class="sect3" id="idm45816837617944">
<h3>Logical</h3>

<p>Say you<a data-type="indexterm" data-primary="logical cohesion" id="idm45816837616376"/><a data-type="indexterm" data-primary="class-level cohesion" data-secondary="logical" id="idm45816837615640"/> needed to provide implementations for parsing from CSV, JSON, and XML. You may be tempted to group the methods responsible for parsing the different format inside one class, as shown in <a data-type="xref" href="#bank_statement_logical">Example 2-10</a>.</p>
<div id="bank_statement_logical" data-type="example">
<h5><span class="label">Example 2-10. </span>An example of logical cohesion</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankTransactionParser</code> <code class="o">{</code>

    <code class="kd">public</code> <code class="n">BankTransaction</code> <code class="nf">parseFromCSV</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">line</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// ...</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">BankTransaction</code> <code class="nf">parseFromJSON</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">line</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// ...</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">BankTransaction</code> <code class="nf">parseFromXML</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">line</code><code class="o">)</code> <code class="o">{</code>
        <code class="c1">// ...</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">UnsupportedOperationException</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>In fact, the methods are logically categorized to do “parsing.” However, they are different by nature and each of the methods would be unrelated. Grouping them would also break the SRP, which you learned about earlier, because the class is responsible for multiple concerns. Consequently, this approach is not recommended.</p>

<p>You will learn in <a data-type="xref" href="#coupling">“Coupling”</a> that there exist techniques to solve the problem of providing different implementations for parsing while also keeping high <span class="keep-together">cohesion</span>.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Sequential"><div class="sect3" id="idm45816837568520">
<h3>Sequential</h3>

<p>Say you need to read a file, parse it, process it, and save the information. You may group all of the methods in one single class.<a data-type="indexterm" data-primary="sequential cohesion" id="idm45816837567016"/><a data-type="indexterm" data-primary="class-level cohesion" data-secondary="sequential" id="idm45816837566312"/> After all the output of reading the file becomes the input to the parsing, the output of parsing becomes the input to the processing step, and so on.</p>

<p>This is called sequential cohesion because you are grouping the methods so that they follow a sequence of input to output. It makes it easy to understand how the operations work together. Unfortunately, in practice this means that the class grouping the methods has multiple reasons to change and is therefore breaking the SRP. In addition, there may be many different ways of processing, summarizing, and saving, so this technique quickly leads to complex classes.</p>

<p>A better approach is to break down each responsibility inside individual, cohesive classes.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Temporal"><div class="sect3" id="idm45816837423800">
<h3>Temporal</h3>

<p>A temporally cohesive class is one that performs several operations that are only related in time.<a data-type="indexterm" data-primary="temporal cohesion" id="idm45816837422360"/><a data-type="indexterm" data-primary="class-level cohesion" data-secondary="temporal" id="idm45816837421656"/>
A typical example is a class that declares some sort of initialization and clean-up operations (e.g., connecting and closing a database connection) that is called before or after other processing operations.
The initialization and the other operations are unrelated, but they have to be called in a specific order in time.<a data-type="indexterm" data-primary="cohesion" data-secondary="class-level" data-tertiary="pros and cons for different levels" id="idm45816837420248"/></p>
<table id="summary_cohesion">
<caption><span class="label">Table 2-1. </span>Summary of pros and cons for different levels of cohesion</caption>
<thead>
<tr>
<th>Level of cohesion</th>
<th>Pro</th>
<th>Con</th>
</tr>
</thead>
<tbody>
<tr>
<td><p>Functional (high cohesion)</p></td>
<td><p>Easy to understand</p></td>
<td><p>Can lead to overly simplistic classes<a data-type="indexterm" data-primary="functional cohesion" data-secondary="pros and cons" id="idm45816837413112"/></p></td>
</tr>
<tr>
<td><p>Informational (medium cohesion)</p></td>
<td><p>Easy to maintain</p></td>
<td><p>Can lead to unnecessary dependencies<a data-type="indexterm" data-primary="informational cohesion" data-secondary="pros and cons" id="idm45816837410056"/></p></td>
</tr>
<tr>
<td><p>Sequential (medium cohesion)</p></td>
<td><p>Easy to locate related operations</p></td>
<td><p>Encourages violation of SRP<a data-type="indexterm" data-primary="sequential cohesion" data-secondary="pros and cons" id="idm45816837406888"/></p></td>
</tr>
<tr>
<td><p>Logical (medium cohesion)</p></td>
<td><p>Provides some form of high-level categorization</p></td>
<td><p>Encourages violation of SRP<a data-type="indexterm" data-primary="logical cohesion" data-secondary="pros and cons" id="idm45816837403704"/></p></td>
</tr>
<tr>
<td><p>Utility (low cohesion)</p></td>
<td><p>Simple to put in place</p></td>
<td><p>Harder to reason about the responsibility of the class<a data-type="indexterm" data-primary="utility cohesion" data-secondary="pros and cons" id="idm45816837400552"/></p></td>
</tr>
<tr>
<td><p>Temporal (low cohesion)</p></td>
<td><p>N/A</p></td>
<td><p>Harder to understand and use individual operations<a data-type="indexterm" data-primary="cohesion" data-secondary="class-level" data-startref="ix_cohecl" id="idm45816837397400"/></p></td>
</tr>
</tbody>
</table>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Method-Level Cohesion"><div class="sect2" id="idm45816837942280">
<h2>Method-Level Cohesion</h2>

<p>The same principle of cohesion can be applied to methods.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="class-level cohesion in" data-startref="ix_BSAclco" id="idm45816837394504"/><a data-type="indexterm" data-primary="class-level cohesion" data-startref="ix_clcoh" id="idm45816837393240"/><a data-type="indexterm" data-primary="method-level cohesion" id="idm45816837392296"/><a data-type="indexterm" data-primary="cohesion" data-secondary="method-level" id="idm45816837391624"/> The more different functionalities a method performs, the harder it becomes to understand what that method actually does. In other words, your method has low cohesion if it is handling multiple unrelated concerns. Methods that display low cohesion are also harder to test because they have multiple responsibilities within one method, which makes it difficult to test the responsibilities individually!
Typically, if you find yourself with a method that contains a series of if/else blocks that make modifications to many different fields of a class or parameters to the method, then it is a sign you should break down the method in more cohesive parts.<a data-type="indexterm" data-primary="cohesion" data-startref="ix_cohe" id="idm45816837389880"/></p>
</div></section>





</div></section>













<section data-type="sect1" class="pagebreak-before less_space" data-pdf-bookmark="Coupling"><div class="sect1" id="coupling">
<h1>Coupling</h1>

<p>Another important characteristic about<a data-type="indexterm" data-primary="coupling" id="idm45816837386328"/> the code you write is <em>coupling</em>.
Where <em>cohesion</em> is about how related things are in a class, package, or method, <em>coupling</em> is about how dependent you are on other classes.<a data-type="indexterm" data-primary="dependencies" data-secondary="coupling and" id="idm45816837384216"/><a data-type="indexterm" data-primary="cohesion" data-secondary="coupling versus" id="idm45816837349912"/><a data-type="indexterm" data-primary="classes" data-secondary="coupling" id="idm45816837348968"/>
Another way to think about coupling is how much knowledge (i.e., specific implementation) you rely on about certain classes.
This is important because the more classes you rely on, the less flexible you become when introducing changes.
In fact, the class affected by a change may affect all the classes depending on it.</p>

<p>To understand what coupling is, think about a clock. There is no need to know how a clock works to read the time, so you are not dependent on the clock internals.
This means you could change the clock internals without affecting how to read the time.<a data-type="indexterm" data-primary="interfaces" data-secondary="decoupling from implementation" id="idm45816837347032"/> Those two concerns (interface and implementation) are decoupled from one another.</p>

<p>Coupling is concerned with <em>how dependent</em> things are. For example, so far the class <code>BankStatementAnalyzer</code> relies on the class <code>BankStatementCSVParser</code>. What if you need to change the parser so it supports statements encoded as JSON entries? What about XML entries?
This would be an annoying refactoring! But do not worry, you can decouple different components by using an interface, which is the tool of choice for providing flexibility for changing requirements.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="decoupling interface from implementation" id="idm45816837343896"/></p>

<p>First, you need to introduce an interface that will tell you how you can use a parser for bank statements but without hardcoding a specific implementation, as shown in <a data-type="xref" href="#bank_statement_parser_interface">Example 2-11</a>.</p>
<div id="bank_statement_parser_interface" data-type="example">
<h5><span class="label">Example 2-11. </span>Introducing an interface for parsing bank statements</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">BankStatementParser</code> <code class="o">{</code>
    <code class="n">BankTransaction</code> <code class="nf">parseFrom</code><code class="o">(</code><code class="n">String</code> <code class="n">line</code><code class="o">);</code>
    <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">parseLinesFrom</code><code class="o">(</code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>Your <code>BankStatementCSVParser</code> will now become an implementation of that interface:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankStatementCSVParser</code> <code class="kd">implements</code> <code class="n">BankStatementParser</code> <code class="o">{</code>
    <code class="c1">// ...</code>
<code class="o">}</code></pre>

<p>So far so good, but how do you decouple the <code>BankStatementAnalyzer</code> from the specific implementation of a <code>BankStatementCSVParser</code>?
You need to use the interface! By introducing a new method called <code>analyze()</code>, which takes <code>BankTransactionParser</code> as an argument, you are no longer coupled to a<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="decoupling from the parser" id="idm45816837312104"/> specific implementation (see <a data-type="xref" href="#bank_statement_analyzer_decoupling">Example 2-12</a>).</p>
<div id="bank_statement_analyzer_decoupling" data-type="example">
<h5><span class="label">Example 2-12. </span>Decoupling the Bank Statements Analyzer from the parser</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankStatementAnalyzer</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">RESOURCES</code> <code class="o">=</code> <code class="s">"src/main/resources/"</code><code class="o">;</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">analyze</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">fileName</code><code class="o">,</code> <code class="kd">final</code> <code class="n">BankStatementParser</code> <code class="n">bankStatementParser</code><code class="o">)</code>
    <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>

        <code class="kd">final</code> <code class="n">Path</code> <code class="n">path</code> <code class="o">=</code> <code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">RESOURCES</code> <code class="o">+</code> <code class="n">fileName</code><code class="o">);</code>
        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">lines</code> <code class="o">=</code> <code class="n">Files</code><code class="o">.</code><code class="na">readAllLines</code><code class="o">(</code><code class="n">path</code><code class="o">);</code>

        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code> <code class="o">=</code> <code class="n">bankStatementParser</code><code class="o">.</code><code class="na">parseLinesFrom</code><code class="o">(</code><code class="n">lines</code><code class="o">);</code>

        <code class="kd">final</code> <code class="n">BankStatementProcessor</code> <code class="n">bankStatementProcessor</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BankStatementProcessor</code><code class="o">(</code><code class="n">bankTransactions</code><code class="o">);</code>

        <code class="n">collectSummary</code><code class="o">(</code><code class="n">bankStatementProcessor</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="c1">// ...</code>
<code class="o">}</code></pre></div>

<p>This is great because the <code>BankStatementAnalyzer</code> class no longer requires knowledge of different specific implementations, which helps with coping for changing requirements. <a data-type="xref" href="#eg_coupling_img">Figure 2-1</a> illustrates the difference of dependencies when you decouple two classes.<a data-type="indexterm" data-primary="dependencies" data-secondary="decoupling classes" id="idm45816837151080"/><a data-type="indexterm" data-primary="classes" data-secondary="decoupling" id="idm45816837150232"/></p>

<figure><div id="eg_coupling_img" class="figure">
<img src="Images/rwsd_0201.png" alt="Decoupling two classes" width="1231" height="466"/>
<h6><span class="label">Figure 2-1. </span>Decoupling two classes</h6>
</div></figure>

<p>You can now bring all the different parts together and create your main application, as shown in <a data-type="xref" href="#main_application">Example 2-13</a>.</p>
<div id="main_application" data-type="example" class="pagebreak-before">
<h5><span class="label">Example 2-13. </span>The main application to run</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">MainApplication</code> <code class="o">{</code>

    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code><code class="o">...</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>

        <code class="kd">final</code> <code class="n">BankStatementAnalyzer</code> <code class="n">bankStatementAnalyzer</code>
                <code class="o">=</code> <code class="k">new</code> <code class="n">BankStatementAnalyzer</code><code class="o">();</code>

        <code class="kd">final</code> <code class="n">BankStatementParser</code> <code class="n">bankStatementParser</code>
                <code class="o">=</code> <code class="k">new</code> <code class="n">BankStatementCSVParser</code><code class="o">();</code>

        <code class="n">bankStatementAnalyzer</code><code class="o">.</code><code class="na">analyze</code><code class="o">(</code><code class="n">args</code><code class="o">[</code><code class="mi">0</code><code class="o">],</code> <code class="n">bankStatementParser</code><code class="o">);</code>

    <code class="o">}</code>
<code class="o">}</code></pre></div>

<p>Generally, when writing code you will aim for <em>low coupling</em>. This means that different components in your code are not relying on internal/implementation details.<a data-type="indexterm" data-primary="low coupling" id="idm45816837031224"/>
The opposite of low coupling is called <em>high coupling</em>, which is what you definitely want to avoid!<a data-type="indexterm" data-primary="high coupling" id="idm45816837029976"/></p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Testing"><div class="sect1" id="idm45816837388216">
<h1>Testing</h1>

<p>You have written some software and it looks like things are working if you execute your application a couple of times.<a data-type="indexterm" data-primary="testing" id="ix_tst"/> However, how confident are you that your code will always work? What guarantee can you give your client that you have met the requirements? In this section, you will learn about  testing and how to write your first automated test using the most popular and widely adopted Java testing framework: JUnit.<a data-type="indexterm" data-primary="JUnit" id="idm45816837116792"/></p>








<section data-type="sect2" data-pdf-bookmark="Automated Testing"><div class="sect2" id="idm45816837115992">
<h2>Automated Testing</h2>

<p>Automated testing sounds like yet another thing that could take more time away from the fun part, which is writing code! Why should you care?<a data-type="indexterm" data-primary="testing" data-secondary="automated" id="idm45816837114296"/><a data-type="indexterm" data-primary="automated testing" id="idm45816837113320"/></p>

<p>Unfortunately in software development, things never work the first time. It should be pretty obvious that testing has benefits. Can you imagine integrating a new auto-pilot software for planes without testing if the software actually works?</p>

<p>Testing does not have to be a manual operation, though. In automated testing you have a suite of tests that runs automatically without human intervention. This means the tests can be executed quickly when you are introducing changes in the code and you want to increase confidence that the behavior of your software is correct and has not suddenly become unexpected. On an average day, a professional developer will often run hundreds or thousands of automated tests.</p>

<p>In this section, we will first briefly review the benefits of automated testing so you have a clear understanding of why testing is a core part of good software development.</p>










<section data-type="sect3" data-pdf-bookmark="Confidence"><div class="sect3" id="idm45816837110376">
<h3>Confidence</h3>

<p>First, performing tests on the software to validate whether the behavior matches the specification gives you confidence that you have met the requirements of your client.<a data-type="indexterm" data-primary="testing" data-secondary="giving confidence of meeting requirements" id="idm45816837108856"/> You can present the test specifications and results to your client as a guarantee. In a sense, the tests become the specification from your client.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Robustness to changes"><div class="sect3" id="idm45816837107368">
<h3>Robustness to changes</h3>

<p>Second, if you introduce changes to your code, how do you know that you have not accidentally broken something?<a data-type="indexterm" data-primary="testing" data-secondary="robustness to changes" id="idm45816837105944"/><a data-type="indexterm" data-primary="robustness to changes" id="idm45816837104968"/><a data-type="indexterm" data-primary="changes, robustness to" id="idm45816837104296"/> If the code is small you may think problems will be obvious. However, what if you are working on a codebase with millions of lines of code? How confident would you feel about making changes to a colleague’s code? Having a suite of automated tests is very useful to check that you have not introduced new bugs.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Program comprehension"><div class="sect3" id="idm45816837102904">
<h3>Program comprehension</h3>

<p>Third, automated tests can be useful to help you understand how the different components inside the source code project works.<a data-type="indexterm" data-primary="testing" data-secondary="program comprehension" id="idm45816837101464"/><a data-type="indexterm" data-primary="program comprehension through testing" id="idm45816837100488"/> In fact, tests make explicit the dependencies of different components and how they interact together. This can be extremely useful for quickly getting an overview of your software. Say you are assigned to a new project. Where would you start to get an overview of different components? The tests are a great place to start.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Using JUnit"><div class="sect2" id="idm45816837099128">
<h2>Using JUnit</h2>

<p>Hopefully you are now convinced of the value of writing automated tests. In this section, you will learn how to create your first automated test using a popular Java framework called <em>JUnit</em>.<a data-type="indexterm" data-primary="testing" data-secondary="using JUnit" id="idm45816837097000"/><a data-type="indexterm" data-primary="JUnit" data-secondary="creating automated test with" id="idm45816837095992"/> Nothing comes for free. You will see that writing a test takes time. In addition, you will have to think about the longer-term maintenance of the test you write since it is regular code, after all. However, the benefits listed in the previous section far outweigh the downsides of having to write tests.<a data-type="indexterm" data-primary="unit tests" id="idm45816837094632"/> Specifically, you will write <em>unit tests</em>, which verify a small isolated unit of behavior for correctness, such as a method or a small class. Throughout the book you will learn about guidelines for writing good tests. Here you will first get an initial overview for writing a simple test for the <code>BankTransactionCSVParser</code>.</p>










<section data-type="sect3" data-pdf-bookmark="Defining a test method"><div class="sect3" id="idm45816837092760">
<h3>Defining a test method</h3>

<p>The first question is where do you write your test? <a data-type="indexterm" data-primary="testing" data-secondary="using JUnit" data-tertiary="defining a test method" id="idm45816837090968"/><a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="testing CSV parser" id="idm45816837089720"/>The standard convention from the Maven and Gradle build tools is to include your code in <em>src/main/java</em> and the test classes inside <em>src/test/java</em>.<a data-type="indexterm" data-primary="src/test/java directory" id="idm45816837087768"/><a data-type="indexterm" data-primary="src/main/java directory" id="idm45816837087032"/> You will also need to add a dependency to the JUnit library to your project. You will learn more about how to structure a project using Maven and Gradle in <a data-type="xref" href="ch03.xhtml#chapter_03">Chapter 3</a>.</p>

<p><a data-type="xref" href="#bank_statement_parser_empty_test">Example 2-14</a> shows a simple test for <code>BankTransactionCSVParser</code>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Our <code>BankStatementCSVParserTest</code> test class has the <code>Test</code> suffix. <a data-type="indexterm" data-primary="classes" data-secondary="test classes with Test suffix" id="idm45816837081848"/>It is not strictly necessary, but often used as a useful aide memoire.</p>
</div>
<div id="bank_statement_parser_empty_test" data-type="example">
<h5><span class="label">Example 2-14. </span>A failing unit test for the CSV parser</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kn">import</code> <code class="nn">org.junit.Assert</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">org.junit.Test</code><code class="o">;</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankStatementCSVParserTest</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">BankStatementParser</code> <code class="n">statementParser</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BankStatementCSVParser</code><code class="o">();</code>

    <code class="nd">@Test</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">shouldParseOneCorrectLine</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>
        <code class="n">Assert</code><code class="o">.</code><code class="na">fail</code><code class="o">(</code><code class="s">"Not yet implemented"</code><code class="o">);</code>
    <code class="o">}</code>

<code class="o">}</code></pre></div>

<p>There are a lot of new parts here. Let’s break it down:</p>

<ul>
<li>
<p>The unit test class is an ordinary class called <code>BankStatementCSVParserTest</code>. It is a common convention to use the <code>Test</code> suffix at the end of test class names.</p>
</li>
<li>
<p>The class declares one method: <code>shouldParseOneCorrectLine()</code>. It is recommended to always come up with a descriptive name so it is immediately obvious what the unit test does without looking at the implementation of the test method.</p>
</li>
<li>
<p>This method is annotated with the JUnit annotation <code>@Test</code>. This means that the method represents<a data-type="indexterm" data-primary="@Test annotation" id="idm45816836958024"/> a unit test that should be executed. You can declare private helper methods with a test class, but they won’t be executed by the test runner.</p>
</li>
<li>
<p>The implementation of this method calls <code>Assert.fail("Not yet implemented")</code>, which will cause the unit test to fail with the diagnostic message <code>"Not yet implemented"</code>. You will learn shortly how to actually implement a unit test using a set of assertion operations available in JUnit.<a data-type="indexterm" data-primary="assertion statements" data-secondary="Assert.fail method" id="idm45816836955160"/></p>
</li>
</ul>

<p>You can execute your test directly from your favorite build tool (e.g., Maven or Gradle) or by using your IDE.<a data-type="indexterm" data-primary="Maven" data-secondary="using to run tests" id="idm45816836953416"/><a data-type="indexterm" data-primary="Gradle" data-secondary="using to run tests" id="idm45816836952440"/><a data-type="indexterm" data-primary="IntelliJ IDE, using to run tests" id="idm45816836951496"/> For example, after running the test in the IntelliJ IDE, you get the output in <a data-type="xref" href="#eg_unit_test_run_img">Figure 2-2</a>. You can see the test is failing with the diagnostic “Not yet implemented”. Let’s now see how to actually implement a useful test to increase the confidence that the <code>BankStatementCSVParser</code> works correctly.</p>

<figure><div id="eg_unit_test_run_img" class="figure">
<img src="Images/rwsd_0202.png" alt="Running a unit test" width="1303" height="191"/>
<h6><span class="label">Figure 2-2. </span>Screenshot from the IntelliJ IDE of running a failing unit test</h6>
</div></figure>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Assert statements"><div class="sect3" id="idm45816836947128">
<h3>Assert statements</h3>

<p>You have just learned about <code>Assert.fail()</code>. This is a <a data-type="indexterm" data-primary="assertion statements" id="idm45816836944984"/>static method provided by JUnit called an <em>assert statement</em>. JUnit provides many assert statements to test for certain conditions. They let you provide an expected result and compare it with the result of some operation.</p>

<p>One of these static method is called <code>Assert.assertEquals()</code>.<a data-type="indexterm" data-primary="assertion statements" data-secondary="assertEquals method" id="idm45816836942728"/><a data-type="indexterm" data-primary="assertion statements" data-secondary="using for testing" id="idm45816836941720"/> You can use it as shown in <a data-type="xref" href="#bank_statement_parser_test_assertions">Example 2-15</a> to test that the implementation of <code>parseFrom()</code> works correctly for a particular input.</p>
<div id="bank_statement_parser_test_assertions" data-type="example">
<h5><span class="label">Example 2-15. </span>Using assertion statements</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Test</code>
<code class="kd">public</code> <code class="kt">void</code> <code class="nf">shouldParseOneCorrectLine</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">String</code> <code class="n">line</code> <code class="o">=</code> <code class="s">"30-01-2017,-50,Tesco"</code><code class="o">;</code>

    <code class="kd">final</code> <code class="n">BankTransaction</code> <code class="n">result</code> <code class="o">=</code> <code class="n">statementParser</code><code class="o">.</code><code class="na">parseFrom</code><code class="o">(</code><code class="n">line</code><code class="o">);</code>

    <code class="kd">final</code> <code class="n">BankTransaction</code> <code class="n">expected</code>
        <code class="o">=</code> <code class="k">new</code> <code class="n">BankTransaction</code><code class="o">(</code><code class="n">LocalDate</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="mi">2017</code><code class="o">,</code> <code class="n">Month</code><code class="o">.</code><code class="na">JANUARY</code><code class="o">,</code> <code class="mi">30</code><code class="o">),</code> <code class="o">-</code><code class="mi">50</code><code class="o">,</code> <code class="s">"Tesco"</code><code class="o">);</code>
    <code class="kd">final</code> <code class="kt">double</code> <code class="n">tolerance</code> <code class="o">=</code> <code class="mf">0.0d</code><code class="o">;</code>

    <code class="n">Assert</code><code class="o">.</code><code class="na">assertEquals</code><code class="o">(</code><code class="n">expected</code><code class="o">.</code><code class="na">getDate</code><code class="o">(),</code> <code class="n">result</code><code class="o">.</code><code class="na">getDate</code><code class="o">());</code>
    <code class="n">Assert</code><code class="o">.</code><code class="na">assertEquals</code><code class="o">(</code><code class="n">expected</code><code class="o">.</code><code class="na">getAmount</code><code class="o">(),</code> <code class="n">result</code><code class="o">.</code><code class="na">getAmount</code><code class="o">(),</code> <code class="n">tolerance</code><code class="o">);</code>
    <code class="n">Assert</code><code class="o">.</code><code class="na">assertEquals</code><code class="o">(</code><code class="n">expected</code><code class="o">.</code><code class="na">getDescription</code><code class="o">(),</code> <code class="n">result</code><code class="o">.</code><code class="na">getDescription</code><code class="o">());</code>
<code class="o">}</code></pre></div>

<p class="pagebreak-before">So what is going on here? There are three parts:</p>
<ol>
<li>
<p>You set up the context for your test. In this case a line to parse.</p>
</li>
<li>
<p>You carry out an action. In this case, you parse the input line.</p>
</li>
<li>
<p>You specify assertions of the expected output. Here, you check that the date, amount, and description were parsed correctly.</p>
</li>

</ol>

<p>This three-stage pattern for setting up a unit test is often referred to as the <em>Given-When-Then</em> formula.<a data-type="indexterm" data-primary="Given-When-Then formula" id="idm45816836843992"/> It is a good idea to follow the pattern and split up the different parts because it helps to clearly understand what the test is actually doing.</p>

<p>When you run the test again, with a bit luck you will see a nice green bar indicating that <a data-type="indexterm" data-primary="unit tests" data-secondary="running a passing test" id="idm45816836842472"/>the test succeeded, as shown in <a data-type="xref" href="#eg_unit_test_success_img">Figure 2-3</a>.</p>

<figure><div id="eg_unit_test_success_img" class="figure">
<img src="Images/rwsd_0203.png" alt="Test passed" width="1440" height="203"/>
<h6><span class="label">Figure 2-3. </span>Running a passing unit test</h6>
</div></figure>

<p>There are other assertion statements available,<a data-type="indexterm" data-primary="assertion statements" data-secondary="summary of" id="idm45816836838184"/> which are summarized in <a data-type="xref" href="#table_assertion">Table 2-2</a>.</p>
<table id="table_assertion">
<caption><span class="label">Table 2-2. </span>Assertion statements</caption>
<thead>
<tr>
<th>Assertion statement</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>Assert.fail(message)</code></p></td>
<td><p>Let the method fail. This is useful as a placeholder before you implement the test code.</p></td>
</tr>
<tr>
<td><p><code>Assert.assertEquals​(expected, actual)</code></p></td>
<td><p>Test that two values are the same.</p></td>
</tr>
<tr>
<td><p><code>Assert.assertEquals​(expected, actual, delta)</code></p></td>
<td><p>Assert that two floats or doubles are equal to within a delta.</p></td>
</tr>
<tr>
<td><p><code>Assert.assertNotNull(object)</code></p></td>
<td><p>Assert that an object is not null.</p></td>
</tr>
</tbody>
</table>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Code Coverage"><div class="sect2" id="idm45816836825592">
<h2>Code Coverage</h2>

<p>You’ve written your first test and it’s great! <a data-type="indexterm" data-primary="code coverage" id="idm45816836824232"/><a data-type="indexterm" data-primary="testing" data-secondary="code coverage" id="idm45816836823528"/>But how can you tell if that is sufficient? <em>Code coverage</em> refers to how much of the source code of your software (i.e., how many lines or blocks) is tested by a set of tests. It is generally a good idea to aim for high coverage because it reduces the chance of unexpected bugs. There isn’t a specific percentage that is considered sufficient, but we recommend aiming for 70%–90%. In practice, it is hard and less practical to actually reach 100% of code coverage because you may, for example, start testing getter and setter methods, which provides less value.</p>

<p>However, code coverage is not necessarily a good metric of how well you are testing your software. In fact, code coverage only tells you what you definitely have not tested. Code coverage does not say anything about the quality of your tests. You may cover parts of your code with a simplistic test case, but not necessarily for edge cases, which usually lead to problematic issues.</p>

<p>Popular code coverage tools in Java include <em>JaCoCo</em>, <em>Emma</em>, and <em>Cobertura</em>. In practice,<a data-type="indexterm" data-primary="JaCoCo" id="idm45816836818712"/><a data-type="indexterm" data-primary="Emma code coverage tool" id="idm45816836817976"/><a data-type="indexterm" data-primary="Cobertura code coverage tool" id="idm45816836817304"/><a data-type="indexterm" data-primary="code coverage" data-secondary="tools in Java for" id="idm45816836816616"/> you will see people talking about line coverage, which tells you how many statements the code covered. This technique gives a false sense of having good coverage because conditionals (if, while, for) will count as one statement. However, conditionals have multiple possible paths. You should therefore favor <em>branch coverage</em>, which checks the true and false branch for each conditional.<a data-type="indexterm" data-primary="testing" data-startref="ix_tst" id="idm45816836814840"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Takeaways"><div class="sect1" id="idm45816836813736">
<h1>Takeaways</h1>

<ul>
<li>
<p>God Classes and code duplication lead to code that is hard to reason about and maintain.</p>
</li>
<li>
<p>The Single Responsibility Principle helps you write code that is easier to manage and maintain.</p>
</li>
<li>
<p>Cohesion is concerned with how how strongly related the responsibilities of a class or method are.</p>
</li>
<li>
<p>Coupling is concerned with how dependent a class is on other parts of your code.</p>
</li>
<li>
<p>High cohesion and low coupling are characteristics of maintainable code.</p>
</li>
<li>
<p>A suite of automated tests increases confidence that your software is correct, makes it more robust for changes, and helps program comprehension.</p>
</li>
<li>
<p>JUnit is a Java testing framework that lets you specify unit tests that verify the behavior of your methods and classes.</p>
</li>
<li>
<p>Given-When-Then is a pattern for setting up a test into three parts to help understand the tests you implement.</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Iterating on You"><div class="sect1" id="idm45816836804376">
<h1>Iterating on You</h1>

<p>If you want to extend and solidify the knowledge from this section, you could try one of these activities:</p>

<ul>
<li>
<p>Write a couple more unit test cases to test the implementation of the CSV parser.</p>
</li>
<li>
<p>Support different aggregate operations, such as finding the maximum or minimum transactions in specific date ranges.</p>
</li>
<li>
<p>Return a histogram of the expenses by grouping them based on months and descriptions.</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Completing the Challenge"><div class="sect1" id="idm45816836799496">
<h1>Completing the Challenge</h1>

<p>Mark Erbergzuck is very happy with your first iteration of your Bank Statements Analyzer.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="enhancing functionalities of" id="idm45816836798088"/> He takes your idea and renames it <strong>THE Bank Statements Analyzer</strong>. He is so happy with your application that he is asking you for a few enhancements. It turns out he would like to extend the reading, parsing, processing, and summarizing functionalities. For example, he is a fan of JSON. In addition, he found your tests a bit limited and found a couple of bugs.</p>

<p>This is something that you will address in the next chapter, where you will learn about exception handling, the Open/Closed Principle, and how to build your Java project using a build tool.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-startref="ix_BSA" id="idm45816836795656"/></p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45816839001464"><sup><a href="ch02.xhtml#idm45816839001464-marker">1</a></sup> This definition is attributed to Robert Martin.</p></div></div></section></div>



  </body></html>