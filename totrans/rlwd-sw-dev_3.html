<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 3. Extending the Bank Statements Analyzer"><div class="chapter" id="chapter_03">
<h1><span class="label">Chapter 3. </span>Extending the Bank Statements Analyzer</h1>







<section data-type="sect1" data-pdf-bookmark="The Challenge"><div class="sect1" id="idm45816836792952">
<h1>The Challenge</h1>

<p>Mark Erbergzuck was very happy with the work you did in the previous chapter. You built a basic<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" id="ix_BSAext"/> Bank Statements Analyzer as a minimum viable product. Because of this success Mark Erbergzuck thinks that your product can be taken further and asks you to build a new version that support multiple features.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="The Goal"><div class="sect1" id="idm45816836789592">
<h1>The Goal</h1>

<p>In the previous chapter, you learned how to create an application to analyze bank statements in a CSV format. Along this journey you learned about core design principles that help you write maintainable code, the Single Responsibility Principle, and anti-patterns you should avoid, such as God Class and code duplication. While you were incrementally refactoring your code you also learned about coupling (how dependent you are on other classes) and cohesion (how related things are in a class).</p>

<p>Nonetheless, the application is currently pretty limited. How about providing functionality for searching for different kinds of transactions, supporting multiple formats, processors, and exporting the results into a nice report with different formats such as text and HTML?<a data-type="indexterm" data-primary="search" data-secondary="in bank statements analyzer" id="ix_srch"/></p>

<p>In this chapter, you will go deeper in your software development quest. First, you will learn about the Open/Closed principle, which is essential for adding flexibility to your codebase and improving code maintenance.<a data-type="indexterm" data-primary="open/closed principle (OCP)" id="idm45816836784952"/> You will also learn general guidelines for when it makes sense to introduce interfaces, as well as other gotchas to avoid high coupling. You will also learn about the use of exceptions in Java—when it makes sense to include them as part of the APIs you define and when it doesn’t. Finally, you will learn how to systematically build a Java project using an established build tool like Maven and Gradle.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If at any point you want to look at the source code for this
chapter, you can look at the package <code>com.iteratrlearning.shu_book.chapter_03</code>
in the book’s code repository.<a data-type="indexterm" data-primary="source code for this book" id="idm45816836782136"/></p>
</div>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Extended Bank Statements Analyzer Requirements"><div class="sect1" id="idm45816836781144">
<h1>Extended Bank Statements Analyzer Requirements</h1>

<p>You had a friendly chat with Mark Erbergzuck to collect new requirements for the second iteration of the Bank Statements Analyzer.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="requirements" id="idm45816836779848"/> He would like to extend the functionality of the kind of operations you can perform. At the moment the application is limited, as it can only query for the revenue in a particular month or category. Mark has requested two new functionalities:</p>
<ol>
<li>
<p>He’d like to also be able to search for specific transactions. For example, you should be able to return all the bank transactions in a given date range or for a specific category.</p>
</li>
<li>
<p>Mark would like to be able to generate a report of summary statistics for his search into different formats such as text and HTML.</p>
</li>

</ol>

<p>You will work through these requirements in order.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Open/Closed Principle"><div class="sect1" id="idm45816836774888">
<h1>Open/Closed Principle</h1>

<p>Let’s start simple.<a data-type="indexterm" data-primary="open/closed principle (OCP)" id="ix_OCP"/> You will implement a method<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="finding transactions over certain amount" id="idm45816836771832"/> that can find all the transactions over a certain amount. The first question is where should you declare this method? You could create a separate <code>BankTransactionFinder</code> class that will contain a simple <code>findTransactions()</code> method. However, you also  declared a class <code>BankTransactionProcessor</code> in the previous chapter. So what should you do? In this case, there aren’t a lot of benefits in declaring a new class every time you need to add one single method. This actually adds complexity to your whole project, as it introduces a pollution of names that makes it harder to understand the relationships between these different behaviors.<a data-type="indexterm" data-primary="discoverability" id="idm45816836768600"/> Declaring the method inside <code>BankTransactionProcessor</code> helps with discoverability as you immediately know that this is the class that groups all methods that do some form of processing. Now that you’ve decided where to declare it, you can implement it as shown in <a data-type="xref" href="#transactions_greater">Example 3-1</a>.</p>
<div id="transactions_greater" data-type="example">
<h5><span class="label">Example 3-1. </span>Find bank transactions over a certain amount</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">findTransactionsGreaterThanEqual</code><code class="o">(</code><code class="kd">final</code> <code class="kt">int</code> <code class="n">amount</code><code class="o">)</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">result</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
    <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">()</code> <code class="o">&gt;=</code> <code class="n">amount</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">result</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="n">result</code><code class="o">;</code>
<code class="o">}</code></pre></div>

<p>This code is reasonable. However, what if you want to also search in a certain month? You need to duplicate this<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="finding transactions in certain month" id="idm45816836742952"/> method as shown in <a data-type="xref" href="#transactions_in_month">Example 3-2</a>.</p>
<div id="transactions_in_month" data-type="example">
<h5><span class="label">Example 3-2. </span>Find bank transactions in a certain month</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">findTransactionsInMonth</code><code class="o">(</code><code class="kd">final</code> <code class="n">Month</code> <code class="n">month</code><code class="o">)</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">result</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
    <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">.</code><code class="na">getDate</code><code class="o">().</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">month</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">result</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="n">result</code><code class="o">;</code>
<code class="o">}</code></pre></div>

<p>In the previous chapter, you already came across code duplication.<a data-type="indexterm" data-primary="code" data-secondary="duplication" id="idm45816833180056"/> It is a code smell which leads to code that is brittle, especially if requirements change frequently. For example, if the iteration logic needs to change, you will need to repeat the modifications in several places.</p>

<p>This approach also doesn’t work well for more complicated requirements. What if we wish to search transactions in a specific month and also over a certain amount? You could implement this new requirement as shown in <a data-type="xref" href="#transactions_in_month_and_greater">Example 3-3</a>.</p>
<div id="transactions_in_month_and_greater" data-type="example">
<h5><span class="label">Example 3-3. </span>Find bank transactions in a certain month and over a certain amount</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">findTransactionsInMonthAndGreater</code><code class="o">(</code><code class="kd">final</code> <code class="n">Month</code> <code class="n">month</code><code class="o">,</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">amount</code><code class="o">)</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">result</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
    <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">.</code><code class="na">getDate</code><code class="o">().</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">month</code> <code class="o">&amp;&amp;</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">()</code> <code class="o">&gt;=</code> <code class="n">amount</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">result</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="n">result</code><code class="o">;</code>
<code class="o">}</code></pre></div>

<p>Clearly this approach exhibits several downsides:</p>

<ul>
<li>
<p>Your code will become increasingly complicated as you have to combine multiple properties of a bank transaction.</p>
</li>
<li>
<p>The selection logic is coupled to the iteration logic, making it harder to separate them out.</p>
</li>
<li>
<p>You keep on duplicating code.</p>
</li>
</ul>

<p>This is where the Open/Closed principle comes in. It promotes the idea of being able to change the behavior of a method or class without having to modify the code.<a data-type="indexterm" data-primary="methods" data-secondary="changing behavior without modifying code" id="idm45816832966264"/><a data-type="indexterm" data-primary="classes" data-secondary="changing behavior without modifying code" id="idm45816832965192"/> In our example, it would mean the ability to extend the behavior of a <code>findTransactions()</code> method without having to duplicate the code or change it to introduce a new parameter. How is this possible? As discussed earlier, the concepts of iterating and the business logic are coupled together. In the previous chapter, you learned about interfaces as a useful tool to decouple concepts from one another.<a data-type="indexterm" data-primary="interfaces" data-secondary="BankTransactionFilter (example)" id="idm45816832963368"/> In this case, you will introduce a <code>BankTransactionFilter</code> interface that will be responsible for the selection logic, as shown in <a data-type="xref" href="#transactionfilter_interface">Example 3-4</a>. It contains a single method <code>test()</code> that returns a boolean and takes the complete <code>BankTransaction</code> object as an argument. This way the method <code>test()</code> has access to all the properties of a <code>BankTransaction</code> to specify any appropriate selection criteria.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>An interface that only contains a single abstract method is called a <em>functional interface</em> since Java 8.<a data-type="indexterm" data-primary="functional interface" id="idm45816832957960"/> You can annotate it using the <code>@FunctionalInterface</code> annotation to make the intent of the interface clearer.<a data-type="indexterm" data-primary="@FunctionalInterface annotation" id="idm45816832956712"/></p>
</div>
<div id="transactionfilter_interface" data-type="example">
<h5><span class="label">Example 3-4. </span>The BankTransactionFilter interface</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@FunctionalInterface</code>
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">BankTransactionFilter</code> <code class="o">{</code>
    <code class="kt">boolean</code> <code class="nf">test</code><code class="o">(</code><code class="n">BankTransaction</code> <code class="n">bankTransaction</code><code class="o">);</code>
<code class="o">}</code></pre></div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Java 8 introduced a generic <code>java.util.function.Predicate&lt;T&gt;</code> inferface, which would be a great fit for the problem at hand. However, this chapter introduces a new named interface to avoid introducing too much complexity early on in the book.<a data-type="indexterm" data-primary="java.util.function.Predicate&lt;T&gt; interface" id="idm45816832945848"/></p>
</div>

<p>The interface <code>BankTransactionFilter</code> models the concept of a selection criteria for a <code>BankTransaction</code>. You can now refactor the method <code>findTransactions()</code> to make use of it as shown in <a data-type="xref" href="#findTransactions_ocp">Example 3-5</a>. This refactoring is very important because you now have introduced a way to decouple the iteration logic from the business logic through this interface. Your method no longer depends on one specific implementation of a filter. You can introduce new implementations by passing them as an argument without modifying the body of this method. Hence, it is now open for extension and closed for modification. This reduces the scope for introducing new bugs because it minimizes cascading changes required to parts of code that have already been implemented and tested. In other words, old code still works and is untouched.<a data-type="indexterm" data-primary="open/closed principle (OCP)" data-secondary="flexible findTransactions method using" id="idm45816832907096"/></p>
<div id="findTransactions_ocp" data-type="example">
<h5><span class="label">Example 3-5. </span>Flexible findTransactions() method using Open/Closed Principle</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">findTransactions</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransactionFilter</code> <code class="n">bankTransactionFilter</code><code class="o">)</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">result</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
    <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code><code class="o">(</code><code class="n">bankTransactionFilter</code><code class="o">.</code><code class="na">test</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">))</code> <code class="o">{</code>
            <code class="n">result</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="n">result</code><code class="o">;</code>
<code class="o">}</code></pre></div>








<section data-type="sect2" data-pdf-bookmark="Creating an Instance of a Functional Interface"><div class="sect2" id="idm45816832850776">
<h2>Creating an Instance of a Functional Interface</h2>

<p>Mark Erbergzuck<a data-type="indexterm" data-primary="functional interface" data-secondary="creating instance of" id="idm45816832812888"/><a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="declaring class implementing BankTransactionFilter" id="idm45816832811944"/> is now happy as you can implement any new requirements by calling the method <code>findTransactions()</code> declared in the <code>BankTransactionProcessor</code> with appropriate implementations of a <code>BankTransactionFilter</code>. You can achieve this by implementing a  class as shown in <a data-type="xref" href="#transaction_filter_class">Example 3-6</a> and then passing an instance as argument to the <code>findTransactions()</code> method as shown in <a data-type="xref" href="#findTransactions_impl_class">Example 3-7</a>.</p>
<div id="transaction_filter_class" data-type="example">
<h5><span class="label">Example 3-6. </span>Declaring a class that implements the BankTransactionFilter</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">class</code> <code class="nc">BankTransactionIsInFebruaryAndExpensive</code> <code class="kd">implements</code> <code class="n">BankTransactionFilter</code> <code class="o">{</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">test</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="n">bankTransaction</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getDate</code><code class="o">().</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">Month</code><code class="o">.</code><code class="na">FEBRUARY</code>
               <code class="o">&amp;&amp;</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">()</code> <code class="o">&gt;=</code> <code class="mi">1_000</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>
<div id="findTransactions_impl_class" data-type="example">
<h5><span class="label">Example 3-7. </span>Calling findTransactions() with a specific implementation of BankTransactionFilter</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">transactions</code>
    <code class="o">=</code> <code class="n">bankStatementProcessor</code><code class="o">.</code><code class="na">findTransactions</code><code class="o">(</code><code class="k">new</code> <code class="n">BankTransactionIsInFebruaryAndExpensive</code><code class="o">());</code></pre></div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Lambda Expressions"><div class="sect2" id="idm45816832733752">
<h2>Lambda Expressions</h2>

<p>However, you’d need to create special classes every time you have a new requirement.<a data-type="indexterm" data-primary="lambda expressions" id="idm45816832732280"/> This process can add unnecessary boilerplate and can rapidly become cumbersome. Since Java 8, you can use a feature called <em>lambda expressions</em> as shown in <a data-type="xref" href="#findTransactions_impl_lambda">Example 3-8</a>. Don’t worry about this syntax and language feature for the time being.<a data-type="indexterm" data-primary="method references" id="idm45816832680104"/> We will learn about lambda expressions and a companion language feature called <em>method references</em> in more detail in <a data-type="xref" href="ch07.xhtml#chapter_07">Chapter 7</a>. For now, you can think of it as instead of passing in an object that implements an interface, we’re passing in a block of code—a function without a name. <code>bankTransaction</code> is the name of a parameter and the arrow <code>-&gt;</code> separates the parameter from the body of the lambda expression, which is just some code that is run to test whether or not the bank transaction should be selected.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="implementing BankTransactionFilter using lambda expression" id="idm45816832676904"/></p>
<div id="findTransactions_impl_lambda" data-type="example">
<h5><span class="label">Example 3-8. </span>Implementing BankTransactionFilter using a lambda expression</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">transactions</code>
    <code class="o">=</code> <code class="n">bankStatementProcessor</code><code class="o">.</code><code class="na">findTransactions</code><code class="o">(</code><code class="n">bankTransaction</code> <code class="o">-&gt;</code>
                <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getDate</code><code class="o">().</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">Month</code><code class="o">.</code><code class="na">FEBRUARY</code>
                <code class="o">&amp;&amp;</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">()</code> <code class="o">&gt;=</code> <code class="mi">1_000</code><code class="o">);</code></pre></div>

<p>To summarize, the Open/Closed Principle is a useful principle to follow because<a data-type="indexterm" data-primary="open/closed principle (OCP)" data-secondary="advantages of" id="idm45816832596696"/> it:</p>

<ul>
<li>
<p>Reduces fragility of code by not changing existing code</p>
</li>
<li>
<p>Promotes reusability of existing code and as a result avoids code duplication</p>
</li>
<li>
<p>Promotes decoupling, which leads to better code maintenance<a data-type="indexterm" data-primary="open/closed principle (OCP)" data-startref="ix_OCP" id="idm45816832634968"/></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Interfaces Gotchas"><div class="sect1" id="idm45816836774264">
<h1>Interfaces Gotchas</h1>

<p>So far you introduced a flexible method to search for transactions given a selection criterion.<a data-type="indexterm" data-primary="search" data-secondary="in bank statements analyzer" data-startref="ix_srch" id="idm45816832632120"/><a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="interface gotchas" id="ix_BSAextig"/><a data-type="indexterm" data-primary="interfaces" data-secondary="gotchas" id="ix_intgot"/> The refactoring you went through raises questions about what should happen to the other methods declared inside the <code>BankTransactionProcessor</code> class. Should they be part of an interface? Should they be included in a separate class? After all, there are three other related methods you implemented in the previous chapter:</p>

<ul>
<li>
<p><code>calculateTotalAmount()</code></p>
</li>
<li>
<p><code>calculateTotalInMonth()</code></p>
</li>
<li>
<p><code>calculateTotalForCategory()</code></p>
</li>
</ul>

<p>One approach that we discourage you to put in practice is to put everything into one single interface: the God Interface.</p>








<section data-type="sect2" data-pdf-bookmark="God Interface"><div class="sect2" id="idm45816832623256">
<h2>God Interface</h2>

<p>One extreme view you could take is that the class <code>BankTransactionProcessor</code> acts as an API.<a data-type="indexterm" data-primary="God interface" id="idm45816832621224"/><a data-type="indexterm" data-primary="interfaces" data-secondary="gotchas" data-tertiary="God interface" id="idm45816832620520"/> As a result, you may wish to define an interface that lets you decouple from multiple implementations of a bank transaction processor as shown in <a data-type="xref" href="#giant_interface_processor">Example 3-9</a>. This interface contains all the operations that the bank transaction processor needs to implement.</p>
<div id="giant_interface_processor" data-type="example">
<h5><span class="label">Example 3-9. </span>God Interface</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">interface</code> <code class="nc">BankTransactionProcessor</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="nf">calculateTotalAmount</code><code class="o">();</code>
    <code class="kt">double</code> <code class="nf">calculateTotalInMonth</code><code class="o">(</code><code class="n">Month</code> <code class="n">month</code><code class="o">);</code>
    <code class="kt">double</code> <code class="nf">calculateTotalInJanuary</code><code class="o">();</code>
    <code class="kt">double</code> <code class="nf">calculateAverageAmount</code><code class="o">();</code>
    <code class="kt">double</code> <code class="nf">calculateAverageAmountForCategory</code><code class="o">(</code><code class="n">Category</code> <code class="n">category</code><code class="o">);</code>
    <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">findTransactions</code><code class="o">(</code><code class="n">BankTransactionFilter</code> <code class="n">bankTransactionFilter</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>However, this approach displays several downsides. First, this interface becomes increasingly complex as every single helper operation is an integral part of the explicit API definition. Second, this interface acts more like a “God Class” as you saw in the previous chapter. In fact, the interface has now become a bag for all possible operations. Worse, you are actually introducing two forms of additional coupling:</p>

<ul>
<li>
<p>An interface in Java defines a contract that every single implementation has to adhere by. In other words, concrete implementations of this interface have to provide an implementation for each operation. This means that changing the interface means all concrete implementations have to be updated as well to support the change. The more operations you add, the more likely changes will happen, increasing the scope for potential problems down the line.</p>
</li>
<li>
<p>Concrete properties of a <code>BankTransaction</code> such as the month and the category have cropped up as part of method names; e.g., <code>calculateAverageForCategory()</code> and <code>calculateTotalInJanuary()</code>. This is more problematic with interfaces as they now depend on specific accessors of a domain object. If the internals of that domain object change, then this may cause changes to the interface as well and, as a consequence, to all its concrete implementations, too.</p>
</li>
</ul>

<p>All these reasons are why it is generally recommended to define smaller interfaces. The idea is to minimize dependency to multiple operations or internals of a domain object.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Too Granular"><div class="sect2" id="idm45816832615080">
<h2>Too Granular</h2>

<p>Since we’ve just argued that<a data-type="indexterm" data-primary="interfaces" data-secondary="gotchas" data-tertiary="too granular" id="idm45816832550824"/><a data-type="indexterm" data-primary="granularity, too granular interfaces" id="idm45816832549576"/> smaller is better, the other extreme view you could take is to define one interface for each operation, as shown in <a data-type="xref" href="#too_granular_interfaces">Example 3-10</a>. Your <code>BankTransactionProcessor</code> class would implement all these interfaces.</p>
<div id="too_granular_interfaces" data-type="example">
<h5><span class="label">Example 3-10. </span>Interfaces that are too granular</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">interface</code> <code class="nc">CalculateTotalAmount</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="nf">calculateTotalAmount</code><code class="o">();</code>
<code class="o">}</code>

<code class="kd">interface</code> <code class="nc">CalculateAverage</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="nf">calculateAverage</code><code class="o">();</code>
<code class="o">}</code>

<code class="kd">interface</code> <code class="nc">CalculateTotalInMonth</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="nf">calculateTotalInMonth</code><code class="o">(</code><code class="n">Month</code> <code class="n">month</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>This approach is also not useful for improving code maintenance. <a data-type="indexterm" data-primary="anti-cohesion" id="idm45816832532376"/><a data-type="indexterm" data-primary="code" data-secondary="maintainability" id="idm45816832544216"/>In fact, it introduces “anti-cohesion.” In other words, it becomes harder to discover the operations of interest as they are hiding in multiple separate interfaces. Part of promoting good maintenance is to help discoverability of common operations.<a data-type="indexterm" data-primary="discoverability" id="idm45816832487112"/> In addition, because the interfaces are too granular it adds overall complexity, as well as a lot of different new types introduced by the new interfaces to keep track of in your project.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="interface gotchas" data-startref="ix_BSAextig" id="idm45816832486104"/><a data-type="indexterm" data-primary="interfaces" data-secondary="gotchas" data-startref="ix_intgot" id="idm45816832484648"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Explicit Versus Implicit API"><div class="sect1" id="idm45816832483176">
<h1>Explicit Versus Implicit API</h1>

<p>So what is the pragmatic approach to take? <a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="explicit vs. implicit API for BankTransactionProcessor" id="ix_BSAextexpimp"/><a data-type="indexterm" data-primary="APIs" data-secondary="explicit vs. implicit API" id="ix_APIimex"/><a data-type="indexterm" data-primary="explicit versus implicit API" id="ix_expimp"/>We recommend following the Open/Closed Principle to add flexibility to your operations and define the most common cases as part of the class. They can be implemented with the more general methods. In this scenario, an interface is not particularly warranted as we don’t expect different implementations of a <code>BankTransactionProcessor</code>. There aren’t specializations of each of these methods that will benefit your overall application. As a result, there’s no need to over-engineer and add unnecessary abstractions in your codebase. The <code>BankTransactionProcessor</code> is simply a class that lets you perform statistical operations on bank transactions.</p>

<p>This also raises the question of whether methods such as <code>findTransactionsGreaterThanEqual()</code> should be declared given that they can easily be implemented by the more general <code>findTransactions()</code> method. This dilemma is often referred to as the problem of providing an explicit versus implicit API.<a data-type="indexterm" data-primary="implicit versus explicit API" id="idm45816832475160"/></p>

<p>In fact, there are two sides of the coin to consider. On one side a method like <code>findTransactionsGreaterThanEqual()</code> is self-explanatory and easy to use. You should not be worried about adding descriptive method names to help readability and comprehension of your API. However, this method is restricted to a particular case and you can easily have an explosion of new methods to cater for various multiple requirements. On the other side, a method like <code>findTransactions()</code> is initially more difficult to use and it needs to be well-documented. However, it provides a unified API for all cases where you need to look up transactions. There isn’t a rule of what is best; it depends on what kind of queries you expect. If <code>findTransactionsGreaterThanEqual()</code> is a very common operation, it makes sense to extract it into an explicit API to make it easier for users to understand and use.</p>

<p>The final implementation of the <code>BankTransactionProcessor</code> is shown in <a data-type="xref" href="#final_bank_transaction_processor">Example 3-11</a>.</p>
<div id="final_bank_transaction_processor" data-type="example">
<h5><span class="label">Example 3-11. </span>Key operations for the BankTransactionProcessor class</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@FunctionalInterface</code>
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">BankTransactionSummarizer</code> <code class="o">{</code>
    <code class="kt">double</code> <code class="nf">summarize</code><code class="o">(</code><code class="kt">double</code> <code class="n">accumulator</code><code class="o">,</code> <code class="n">BankTransaction</code> <code class="n">bankTransaction</code><code class="o">);</code>
<code class="o">}</code>


<code class="nd">@FunctionalInterface</code>
<code class="kd">public</code> <code class="kd">interface</code> <code class="nc">BankTransactionFilter</code> <code class="o">{</code>
    <code class="kt">boolean</code> <code class="nf">test</code><code class="o">(</code><code class="n">BankTransaction</code> <code class="n">bankTransaction</code><code class="o">);</code>
<code class="o">}</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">BankTransactionProcessor</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">BankStatementProcessor</code><code class="o">(</code><code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">bankTransactions</code> <code class="o">=</code> <code class="n">bankTransactions</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">summarizeTransactions</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransactionSummarizer</code> <code class="n">bankTransactionSummarizer</code><code class="o">)</code> <code class="o">{</code>
        <code class="kt">double</code> <code class="n">result</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>
        <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
            <code class="n">result</code> <code class="o">=</code> <code class="n">bankTransactionSummarizer</code><code class="o">.</code><code class="na">summarize</code><code class="o">(</code><code class="n">result</code><code class="o">,</code> <code class="n">bankTransaction</code><code class="o">);</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">result</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">calculateTotalInMonth</code><code class="o">(</code><code class="kd">final</code> <code class="n">Month</code> <code class="n">month</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="nf">summarizeTransactions</code><code class="o">((</code><code class="n">acc</code><code class="o">,</code> <code class="n">bankTransaction</code><code class="o">)</code> <code class="o">-&gt;</code>
                <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getDate</code><code class="o">().</code><code class="na">getMonth</code><code class="o">()</code> <code class="o">==</code> <code class="n">month</code> <code class="o">?</code> <code class="n">acc</code>  <code class="o">+</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">()</code> <code class="o">:</code> <code class="n">acc</code>
        <code class="o">);</code>
    <code class="o">}</code>

	<code class="c1">// ...</code>

    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">findTransactions</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransactionFilter</code> <code class="n">bankTransactionFilter</code><code class="o">)</code> <code class="o">{</code>
        <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="n">result</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>
        <code class="k">for</code><code class="o">(</code><code class="kd">final</code> <code class="n">BankTransaction</code> <code class="nl">bankTransaction:</code> <code class="n">bankTransactions</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">if</code><code class="o">(</code><code class="n">bankTransactionFilter</code><code class="o">.</code><code class="na">test</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">))</code> <code class="o">{</code>
                <code class="n">result</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">bankTransaction</code><code class="o">);</code>
            <code class="o">}</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="n">bankTransactions</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">BankTransaction</code><code class="o">&gt;</code> <code class="nf">findTransactionsGreaterThanEqual</code><code class="o">(</code><code class="kd">final</code> <code class="kt">int</code> <code class="n">amount</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="nf">findTransactions</code><code class="o">(</code><code class="n">bankTransaction</code> <code class="o">-&gt;</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">()</code> <code class="o">&gt;=</code> <code class="n">amount</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="c1">// ...</code>
<code class="o">}</code></pre></div>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A lot of the aggregation patterns that you have seen so far could be implemented using the Streams API introduced in Java 8 if you are familiar with it.<a data-type="indexterm" data-primary="aggregations" data-secondary="implementing with Streams API" id="idm45816832437960"/><a data-type="indexterm" data-primary="Streams API" id="idm45816832437016"/> For example, searching for transactions can be easily specified as shown here:</p>

<pre data-type="programlisting" data-code-language="java"><code class="n">bankTransactions</code>
    <code class="o">.</code><code class="na">stream</code><code class="o">()</code>
    <code class="o">.</code><code class="na">filter</code><code class="o">(</code><code class="n">bankTransaction</code> <code class="o">-&gt;</code> <code class="n">bankTransaction</code><code class="o">.</code><code class="na">getAmount</code><code class="o">()</code> <code class="o">&gt;=</code> <code class="mi">1_000</code><code class="o">)</code>
    <code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">toList</code><code class="o">());</code></pre>

<p>Nonetheless, the Streams API is implemented using the same foundation and principles that you’ve learned in this section.</p>
</div>








<section data-type="sect2" data-pdf-bookmark="Domain Class or Primitive Value?"><div class="sect2" id="idm45816832280296">
<h2>Domain Class or Primitive Value?</h2>

<p>While we kept the interface definition of <code>BankTransactionSummarizer</code> simple, it is often preferable to not return a primitive value like a <code>double</code> if you are looking at returning a result from an aggregation.<a data-type="indexterm" data-primary="primitive values, returned from aggregations" id="idm45816832278136"/><a data-type="indexterm" data-primary="aggregations" data-secondary="avoiding returning primitive values from" id="idm45816832277336"/> This is because it doesn’t give you the flexibility to later return multiple results. For example, the method <code>summarizeTransaction()</code> returns a <code>double</code>. If you were to change the signature of the result to include more results, you would need to change every single implementation of the <code>BankTransactionProcessor</code>.</p>

<p>A solution to this problem is to introduce a new domain class such as <code>Summary</code> that wraps the <code>double</code> value. <a data-type="indexterm" data-primary="double value, wrapping in domain class" id="idm45816832271080"/><a data-type="indexterm" data-primary="domain classes" id="idm45816832270488"/>This means that in the future you can add other fields and results to this class. This technique helps further decouple the various concepts in your domain and also helps minimize cascading changes when requirements change.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>A primitive <code>double</code> value has a limited number of bits, and as a result it has limited precision when storing decimal numbers.<a data-type="indexterm" data-primary="precision in decimal numbers" id="idm45816832267672"/><a data-type="indexterm" data-primary="java.math.BigDecimal" id="idm45816832267000"/><a data-type="indexterm" data-primary="BigDecimal class" id="idm45816832266328"/> An alternative to consider is <code>java.math.BigDecimal</code>, which has arbitrary precision. However, this precision comes at the cost of increased CPU and memory overhead.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="explicit vs. implicit API for BankTransactionProcessor" data-startref="ix_BSAextexpimp" id="idm45816832265016"/><a data-type="indexterm" data-primary="explicit versus implicit API" data-startref="ix_expimp" id="idm45816832263496"/><a data-type="indexterm" data-primary="APIs" data-secondary="explicit vs. implicit API" data-startref="ix_APIimex" id="idm45816832262536"/></p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Multiple Exporters"><div class="sect1" id="idm45816832261048">
<h1>Multiple Exporters</h1>

<p>In the previous section you learned about the Open/Closed Principle and delved further into the usage of interfaces in Java.<a data-type="indexterm" data-primary="exporters, multiple" id="ix_expmul"/><a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="exporting summary statistics in different formats" id="ix_BSAextexp"/> This knowledge is going to come handy as Mark Erbergzuck has a new requirement! You need to export summary statistics about a selected list of transactions into different formats including text, HTML, JSON, and so on. Where to start?</p>








<section data-type="sect2" data-pdf-bookmark="Introducing a Domain Object"><div class="sect2" id="idm45816832256632">
<h2>Introducing a Domain Object</h2>

<p>First, you need to define exactly what is it the user wants to export. There are various possibilities, which we explore together with their trade-offs:</p>
<dl>
<dt>A number</dt>
<dd>
<p>Perhaps the user is just interested in returning the result of an operation like <code>calculateAverageInMonth</code>. This means the result would be a <code>double</code>. While this is the most simple approach, as we noted earlier, this approach is somewhat inflexible as it doesn’t cope well with changing requirements. Imagine you create an exporter which takes the <code>double</code> as an input, this means that every places in your code that calls this exporter will need to be updated if you need to change the result type, possibly introducing new bugs.</p>
</dd>
<dt>A collection</dt>
<dd>
<p>Perhaps the user wishes to return a list of transactions, for example, returned by <code>findTransaction()</code>. You could even return an <code>Iterable</code> to provide further flexibility in what specific implementation is returned. While this gives you more flexibility it also ties you to only being able to return a collection. What if you need to return multiple results such as a list and other summary information?</p>
</dd>
<dt>A specialized domain object</dt>
<dd>
<p>You could introduce a new concept such as <code>SummaryStatistics</code> which represents summary information that the user is interested in exporting. A <em>domain object</em> is simply an instance of a class that is related to your domain. By introducing a domain object, you introduce a form of decoupling. In fact, if there are new requirements where you need to export additional information, you can just include it as part of this new class without having to introduce cascading changes.</p>
</dd>
<dt>A more complex domain object</dt>
<dd>
<p>You could introduce a concept such as <code>Report</code> which is more generic and could contain different kinds of fields storing various results including collection of transactions. Whether you need this or not depends on the user requirements and whether you are expecting more complex information. The benefit again is that you are able to decouple different parts of your applications that produce <code>Report</code> objects and other parts that consume <code>Report</code> objects.</p>
</dd>
</dl>

<p>For the purpose of our application, let’s introduce a domain object that stores summary statistics about a list of transactions. The code in <a data-type="xref" href="#summmary_statistics_object">Example 3-12</a> shows its <span class="keep-together">declaration</span>.</p>
<div id="summmary_statistics_object" data-type="example">
<h5><span class="label">Example 3-12. </span>A domain object storing statistical information</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">SummaryStatistics</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">sum</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">max</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">min</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">average</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">SummaryStatistics</code><code class="o">(</code><code class="kd">final</code> <code class="kt">double</code> <code class="n">sum</code><code class="o">,</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">max</code><code class="o">,</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">min</code><code class="o">,</code> <code class="kd">final</code> <code class="kt">double</code> <code class="n">average</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">sum</code> <code class="o">=</code> <code class="n">sum</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">max</code> <code class="o">=</code> <code class="n">max</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">min</code> <code class="o">=</code> <code class="n">min</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">average</code> <code class="o">=</code> <code class="n">average</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getSum</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">sum</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getMax</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">max</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getMin</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">min</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">getAverage</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">average</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Defining and Implementing the Appropriate Interface"><div class="sect2" id="idm45816832209752">
<h2>Defining and Implementing the Appropriate Interface</h2>

<p>Now that you know what you need to export, you will come up with an API to do it.<a data-type="indexterm" data-primary="interfaces" data-secondary="Exporter, defining and implementing" id="ix_intexp"/> You will need to define an interface called <code>Exporter</code>. The reason you introduce an interface is to let you decouple from multiple implementations of exporters. This goes in line with the Open/Closed Principle you learned in the previous section. In fact, if you need to substitute the implementation of an exporter to JSON with an exporter to XML this will be straightforward given they will both implement the same interface. Your first attempt at defining the interface may be as shown in <a data-type="xref" href="#exporter_void">Example 3-13</a>. The method <code>export()</code> takes a <code>SummaryStatistics</code> object and returns <code>void</code>.</p>
<div id="exporter_void" data-type="example">
<h5><span class="label">Example 3-13. </span>Bad Exporter interface</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Exporter</code> <code class="o">{</code>
    <code class="kt">void</code> <code class="nf">export</code><code class="o">(</code><code class="n">SummaryStatistics</code> <code class="n">summaryStatistics</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>This approach is to be avoided for several reasons:</p>

<ul>
<li>
<p>The return type <code>void</code> is not useful and is difficult to reason about. You don’t know what is returned.<a data-type="indexterm" data-primary="void return type" id="idm45816831933992"/> The signature of the <code>export()</code> method implies that some state change is happening somewhere or that this method will log or print information back to the screen. We don’t know!</p>
</li>
<li>
<p>Returning <code>void</code> makes it very hard to test the result with assertions. What is the actual result to compare with the expected result? Unfortunately, you can’t get a result with <code>void</code>.</p>
</li>
</ul>

<p>With this in mind, you come up with an alternative API that returns a <code>String</code>, as shown in <a data-type="xref" href="#exporter_string">Example 3-14</a>. It is now clear that the <code>Exporter</code> will return text and it’s then up to a separate part of the program to decide whether to print it, save it to a file, or even send it electronically. Text strings are also very useful for testing as you can directly compare them with assertions.</p>
<div id="exporter_string" data-type="example">
<h5><span class="label">Example 3-14. </span>Good Exporter interface</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Exporter</code> <code class="o">{</code>
    <code class="n">String</code> <code class="nf">export</code><code class="o">(</code><code class="n">SummaryStatistics</code> <code class="n">summaryStatistics</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>Now that you have defined an API to export information, you can implement various kinds of exporters that respect the contract of the <code>Exporter</code> interface. You can see an example of implementing a basic HTML exporter in <a data-type="xref" href="#exporter_impl">Example 3-15</a>.</p>
<div id="exporter_impl" data-type="example">
<h5><span class="label">Example 3-15. </span>Implementing the Exporter interface</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">HtmlExporter</code> <code class="kd">implements</code> <code class="n">Exporter</code> <code class="o">{</code>
    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">export</code><code class="o">(</code><code class="kd">final</code> <code class="n">SummaryStatistics</code> <code class="n">summaryStatistics</code><code class="o">)</code> <code class="o">{</code>

        <code class="n">String</code> <code class="n">result</code> <code class="o">=</code> <code class="s">"&lt;!doctype html&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;html lang='en'&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;head&gt;&lt;title&gt;Bank Transaction Report&lt;/title&gt;&lt;/head&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;body&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;ul&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;li&gt;&lt;strong&gt;The sum is&lt;/strong&gt;: "</code> <code class="o">+</code> <code class="n">summaryStatistics</code><code class="o">.</code><code class="na">getSum</code><code class="o">()</code> <code class="o">+</code> <code class="s">"&lt;/li&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;li&gt;&lt;strong&gt;The average is&lt;/strong&gt;: "</code> <code class="o">+</code> <code class="n">summaryStatistics</code><code class="o">.</code><code class="na">getAverage</code><code class="o">()</code> <code class="o">+</code> <code class="s">"&lt;/li&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;li&gt;&lt;strong&gt;The max is&lt;/strong&gt;: "</code> <code class="o">+</code> <code class="n">summaryStatistics</code><code class="o">.</code><code class="na">getMax</code><code class="o">()</code> <code class="o">+</code> <code class="s">"&lt;/li&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;li&gt;&lt;strong&gt;The min is&lt;/strong&gt;: "</code> <code class="o">+</code> <code class="n">summaryStatistics</code><code class="o">.</code><code class="na">getMin</code><code class="o">()</code> <code class="o">+</code> <code class="s">"&lt;/li&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;/ul&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;/body&gt;"</code><code class="o">;</code>
        <code class="n">result</code> <code class="o">+=</code> <code class="s">"&lt;/html&gt;"</code><code class="o">;</code>
        <code class="k">return</code> <code class="n">result</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Exception Handling"><div class="sect1" id="idm45816831911352">
<h1>Exception Handling</h1>

<p>So far we’ve not talked about what happens when things go wrong.<a data-type="indexterm" data-primary="interfaces" data-secondary="Exporter, defining and implementing" data-startref="ix_intexp" id="idm45816831909976"/><a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="exporting summary statistics in different formats" data-startref="ix_BSAextexp" id="idm45816831676696"/><a data-type="indexterm" data-primary="exporters, multiple" data-startref="ix_expmul" id="idm45816831675208"/> Can you think of situations where the bank analyzer software might fail? <a data-type="indexterm" data-primary="exception handling" id="ix_exc"/><a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="exception handling" id="ix_BSAextexc"/>For example:</p>

<ul>
<li>
<p>What if the data cannot be parsed properly?</p>
</li>
<li>
<p>What if the CSV file containing the bank transctions to import can’t be read?</p>
</li>
<li>
<p>What if the hardware running your applications runs out of resources such as RAM or disk space?</p>
</li>
</ul>

<p>In these scenarios you will be welcomed with a scary error message that includes a stack trace showing the origin of the problem. The snippets in <a data-type="xref" href="#unexpected_problems">Example 3-16</a> show examples of these unexpected errors.</p>
<div id="unexpected_problems" data-type="example">
<h5><span class="label">Example 3-16. </span>Unexpected problems</h5>

<pre data-type="programlisting" data-code-language="java"><code class="n">Exception</code> <code class="n">in</code> <code class="n">thread</code> <code class="s">"main"</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">ArrayIndexOutOfBoundsException</code><code class="o">:</code> <code class="mi">0</code>

<code class="n">Exception</code> <code class="n">in</code> <code class="n">thread</code> <code class="s">"main"</code> <code class="n">java</code><code class="o">.</code><code class="na">nio</code><code class="o">.</code><code class="na">file</code><code class="o">.</code><code class="na">NoSuchFileException</code><code class="o">:</code> <code class="n">src</code><code class="o">/</code><code class="n">main</code><code class="o">/</code><code class="n">resources</code><code class="o">/</code><code class="n">bank</code><code class="o">-</code><code class="n">data</code><code class="o">-</code><code class="n">simple</code><code class="o">.</code><code class="na">csv</code>

<code class="n">Exception</code> <code class="n">in</code> <code class="n">thread</code> <code class="s">"main"</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">OutOfMemoryError</code><code class="o">:</code> <code class="n">Java</code> <code class="n">heap</code> <code class="n">space</code></pre></div>








<section data-type="sect2" data-pdf-bookmark="Why Use Exceptions?"><div class="sect2" id="idm45816831664296">
<h2>Why Use Exceptions?</h2>

<p>Let’s focus on the <code>BankStatementCSVParser</code> for the moment.<a data-type="indexterm" data-primary="exception handling" data-secondary="reasons for using exceptions" id="idm45816831559320"/><a data-type="indexterm" data-primary="comma-separated values (CSV) format" data-secondary="problems with files" id="idm45816831558344"/> How do we handle parsing problems? For example, a CSV line in the file might not be written in the expected format:</p>

<ul>
<li>
<p>A CSV line may have more than the expected three columns.</p>
</li>
<li>
<p>A CSV line may have fewer than the expected three columns.</p>
</li>
<li>
<p>The data format of some of the columns may not be correct, e.g., the date may be incorrect.</p>
</li>
</ul>

<p>Back in the frightening days of the C programming language, you would add a lot of if-condition checks that would return a cryptic error code. This approach had several drawbacks. First, it relied on global shared mutable state to look up the most recent error. This made it harder to understand individual parts of your code in isolation. As a result, your code became harder to maintain. Second, this approach was error prone as you needed to distinguish between real values and errors encoded as values. The type system in this case was weak and could be more helpful to the programmer. Finally, the control flow was mixed with the business logic, which contributed to making the code harder to maintain and test in isolation.</p>

<p>To solve these issues, Java incorporated exceptions as a first-class language feature that introduced many benefits:</p>
<dl>
<dt>Documentation</dt>
<dd>
<p>The language supports exceptions as part of method signatures.</p>
</dd>
<dt>Type safety</dt>
<dd>
<p>The type system figures out whether you are handling the exceptional flow.</p>
</dd>
<dt>Separation of concern</dt>
<dd>
<p>Business logic and exception recovery are separated out with a try/catch block.</p>
</dd>
</dl>

<p>The problem is that exceptions as a language feature also add more complexity. You may be familiar with the fact that Java distinguishes between two kinds of exceptions:</p>
<dl>
<dt>Checked exceptions</dt>
<dd>
<p>These are errors that you are expected to be able to recover from.<a data-type="indexterm" data-primary="exceptions" data-secondary="checked and unchecked" id="idm45816831545752"/><a data-type="indexterm" data-primary="checked exceptions" id="idm45816831544776"/> In Java, you have to declare a method with a list of checked exceptions it can throw. If not, you have to provide a suitable try/catch block for that particular exception.</p>
</dd>
<dt>Unchecked exceptions</dt>
<dd>
<p>These are errors that can be thrown at any time during the program execution.<a data-type="indexterm" data-primary="unchecked exceptions" id="idm45816831542504"/> Methods don’t have to explicitly declare these exceptions in their signature and the caller doesn’t have to handle them explicitly, as it would with a checked exception.</p>
</dd>
</dl>

<p>Java exception classes are organized in a well-defined hierarchy.<a data-type="indexterm" data-primary="classes" data-secondary="exceptions hierarchy in Java" id="idm45816831540616"/><a data-type="indexterm" data-primary="exception handling" data-secondary="exceptions hierarchy in Java" id="idm45816831629096"/> <a data-type="xref" href="#exceptions_hiearchy">Figure 3-1</a> depicts that hierarchy in Java. The <code>Error</code> and <code>RuntimeException</code> classes are unchecked exceptions and are subclasses of <code>Throwable</code>.<a data-type="indexterm" data-primary="RuntimeException class" id="idm45816831625976"/><a data-type="indexterm" data-primary="Throwable class" id="idm45816831625240"/> You shouldn’t expect to catch and recover from them. The class <code>Exception</code> typically represents errors that a program should be able to recover from.<a data-type="indexterm" data-primary="Exception class" id="idm45816831623976"/><a data-type="indexterm" data-primary="Error class" id="idm45816831623272"/></p>

<figure><div id="exceptions_hiearchy" class="figure">
<img src="Images/rwsd_0301.png" alt="Exceptions Hiearchy in Java" width="817" height="513"/>
<h6><span class="label">Figure 3-1. </span>Exceptions hierarchy in Java</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Patterns and Anti-Patterns with Exceptions"><div class="sect2" id="idm45816831560424">
<h2>Patterns and Anti-Patterns with Exceptions</h2>

<p>Which category of exceptions should you use under what scenario? <a data-type="indexterm" data-primary="exception handling" data-secondary="patterns and anti-patterns with exceptions" id="ix_excpatt"/>You may also wonder how should you update the <code>BankStatementParser</code> API to support exceptions. Unfortunately, there isn’t a simple answer. It requires a bit of pragmatism when deciding what is the right approach for you.</p>

<p>There are <a data-type="indexterm" data-primary="comma-separated values (CSV) format" data-secondary="concerns in parsing files" id="idm45816831616792"/>two separate concerns when thinking about parsing the CSV file:</p>

<ul>
<li>
<p>Parsing the right syntax (e.g., CSV, JSON)</p>
</li>
<li>
<p>Validation of the data (e.g., text description should be less than 100 characters)</p>
</li>
</ul>

<p>You will focus on the syntax error first and then the validation of the data.</p>










<section data-type="sect3" data-pdf-bookmark="Deciding between unchecked and checked"><div class="sect3" id="idm45816831612792">
<h3>Deciding between unchecked and checked</h3>

<p>There are situations when the CSV file may not follow the correct syntax (for example, if separating commas are missing).<a data-type="indexterm" data-primary="exception handling" data-secondary="patterns and anti-patterns with exceptions" data-tertiary="choosing between checked and unchecked" id="idm45816831610888"/><a data-type="indexterm" data-primary="checked exceptions" data-secondary="choosing between unchecked exceptions and" id="idm45816831609592"/><a data-type="indexterm" data-primary="unchecked exceptions" data-secondary="choosing between checked exceptions and" id="idm45816831608616"/> Ignoring this problem will lead to confusing errors when the application runs. Part of the benefit of supporting exceptions in your code is to provide a clearer diagnosis to the user of your API in the event that a problem arises. Accordingly, you decide to add a simple check as shown in the code in <a data-type="xref" href="#csv_exception">Example 3-17</a>, which<a data-type="indexterm" data-primary="CSVSyntaxException" id="idm45816831606408"/> throws a <code>CSVSyntaxException</code>.</p>
<div id="csv_exception" data-type="example">
<h5><span class="label">Example 3-17. </span>Throwing a syntax exception</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">final</code> <code class="n">String</code><code class="o">[]</code> <code class="n">columns</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="na">split</code><code class="o">(</code><code class="s">","</code><code class="o">);</code>

<code class="k">if</code><code class="o">(</code><code class="n">columns</code><code class="o">.</code><code class="na">length</code> <code class="o">&lt;</code> <code class="n">EXPECTED_ATTRIBUTES_LENGTH</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">throw</code> <code class="k">new</code> <code class="nf">CSVSyntaxException</code><code class="o">();</code>
<code class="o">}</code></pre></div>

<p>Should <code>CSVSyntaxException</code> be a checked or an unchecked exception? To answer this question you need to ask yourself whether you require the user of your API to take a compulsory recovery action. For example, the user may implement a retry mechanism if it is a transient error or she may display a message back on the screen to add graceful responsiveness to the application. Typically, errors due to business logic validation (e.g., wrong format or arithmetic) should be unchecked exceptions, as they would add a lot of try/catch clutter in your code. It may also not be obvious what the right recovery mechanism is. Consequently, there’s no point enforcing it on the user of your API. In addition, system errors (e.g., disk ran out of space) should also be unchecked exceptions as there’s nothing the client can do. In a nutshell, the recommendation is to use unchecked exceptions and only use checked exceptions sparingly to avoid significant clutter in the code.</p>

<p>Let’s now tackle the problem of validating the data once you know it follows the correct CSV format. You will learn about two common anti-patterns with using exceptions for validation. Then, you will learn about the Notification pattern, which provides a maintainable solution to the problem.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Overly specific"><div class="sect3" id="idm45816831500776">
<h3>Overly specific</h3>

<p>The first question going through your mind is where should you add validation logic?<a data-type="indexterm" data-primary="exception handling" data-secondary="patterns and anti-patterns with exceptions" data-tertiary="overly specific exceptions" id="idm45816831490088"/> You could have it right at the construction time of the <code>BankStatement</code> object.<a data-type="indexterm" data-primary="validator, implementing using exceptions" id="idm45816831488328"/> However, we recommend creating a dedicated <code>Validator</code> class for several reasons:</p>

<ul>
<li>
<p>You don’t have to duplicate the validation logic when you need to reuse it.</p>
</li>
<li>
<p>You get confidence that different parts of your system validate the same way.</p>
</li>
<li>
<p>You can easily unit test this logic separately.</p>
</li>
<li>
<p>It follows the SRP, which leads to simpler maintenance and program comprehension.</p>
</li>
</ul>

<p>The are various approaches to implementing your validator using exceptions. One overly specific approach is shown in <a data-type="xref" href="#overlyspecific_exception">Example 3-18</a>. You have thought of every single edge case to validate the input and converted each edge case into a checked exception.<a data-type="indexterm" data-primary="overly specific exceptions" id="idm45816831481368"/> The exceptions <code>DescriptionTooLongException</code>, <code>InvalidDateFormat</code>, <code>DateInTheFutureException</code>, and <code>InvalidAmountException</code> are all user-defined checked exceptions (i.e., they extend the class <code>Exception</code>). While this approach lets you specify precise recovery mechanisms for each exception, it is clearly unproductive as it requires a lot of setup, declares multiple exceptions, and forces the user to explicitly deal with each of these exceptions. This is doing the opposite of helping the user understand and simply use your API. In addition, you can’t collect all the errors as a whole in case you want to provide a list to the user.</p>
<div id="overlyspecific_exception" data-type="example">
<h5><span class="label">Example 3-18. </span>Overly specific exceptions</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">OverlySpecificBankStatementValidator</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="n">String</code> <code class="n">description</code><code class="o">;</code>
    <code class="kd">private</code> <code class="n">String</code> <code class="n">date</code><code class="o">;</code>
    <code class="kd">private</code> <code class="n">String</code> <code class="n">amount</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">OverlySpecificBankStatementValidator</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">description</code><code class="o">,</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">date</code><code class="o">,</code> <code class="kd">final</code> <code class="n">String</code> <code class="n">amount</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">description</code> <code class="o">=</code> <code class="n">Objects</code><code class="o">.</code><code class="na">requireNonNull</code><code class="o">(</code><code class="n">description</code><code class="o">);</code>
        <code class="k">this</code><code class="o">.</code><code class="na">date</code> <code class="o">=</code> <code class="n">Objects</code><code class="o">.</code><code class="na">requireNonNull</code><code class="o">(</code><code class="n">description</code><code class="o">);</code>
        <code class="k">this</code><code class="o">.</code><code class="na">amount</code> <code class="o">=</code> <code class="n">Objects</code><code class="o">.</code><code class="na">requireNonNull</code><code class="o">(</code><code class="n">description</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">validate</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">DescriptionTooLongException</code><code class="o">,</code>
                                     <code class="n">InvalidDateFormat</code><code class="o">,</code>
                                     <code class="n">DateInTheFutureException</code><code class="o">,</code>
                                     <code class="n">InvalidAmountException</code> <code class="o">{</code>

        <code class="k">if</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">description</code><code class="o">.</code><code class="na">length</code><code class="o">()</code> <code class="o">&gt;</code> <code class="mi">100</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">DescriptionTooLongException</code><code class="o">();</code>
        <code class="o">}</code>

        <code class="kd">final</code> <code class="n">LocalDate</code> <code class="n">parsedDate</code><code class="o">;</code>
        <code class="k">try</code> <code class="o">{</code>
            <code class="n">parsedDate</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">parse</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">date</code><code class="o">);</code>
        <code class="o">}</code>
        <code class="k">catch</code> <code class="o">(</code><code class="n">DateTimeParseException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">InvalidDateFormat</code><code class="o">();</code>
        <code class="o">}</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">parsedDate</code><code class="o">.</code><code class="na">isAfter</code><code class="o">(</code><code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">()))</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">DateInTheFutureException</code><code class="o">();</code>

        <code class="k">try</code> <code class="o">{</code>
            <code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">amount</code><code class="o">);</code>
        <code class="o">}</code>
        <code class="k">catch</code> <code class="o">(</code><code class="n">NumberFormatException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
            <code class="k">throw</code> <code class="k">new</code> <code class="nf">InvalidAmountException</code><code class="o">();</code>
        <code class="o">}</code>
        <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre></div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Overly apathetic"><div class="sect3" id="idm45816831433560">
<h3>Overly apathetic</h3>

<p>The other end of the spectrum is making everything an unchecked exception; for example, by using <code>IllegalArgumentException</code>.<a data-type="indexterm" data-primary="IllegalArgumentException" id="idm45816831431896"/><a data-type="indexterm" data-primary="exception handling" data-secondary="patterns and anti-patterns with exceptions" data-tertiary="overly apathetic exceptions" id="idm45816831431176"/> The code in <a data-type="xref" href="#illegal_exception">Example 3-19</a> shows the implementation of the <code>validate()</code> method following this approach. The problem with this approach is that you can’t have specific recovery logic because all the exceptions are the same! In addition, you still can’t collect all the errors as a whole.</p>
<div id="illegal_exception" data-type="example">
<h5><span class="label">Example 3-19. </span>IllegalArgument exceptions everywhere</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">validate</code><code class="o">()</code> <code class="o">{</code>

    <code class="k">if</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">description</code><code class="o">.</code><code class="na">length</code><code class="o">()</code> <code class="o">&gt;</code> <code class="mi">100</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">"The description is too long"</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">final</code> <code class="n">LocalDate</code> <code class="n">parsedDate</code><code class="o">;</code>
    <code class="k">try</code> <code class="o">{</code>
        <code class="n">parsedDate</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">parse</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">date</code><code class="o">);</code>
    <code class="o">}</code>
    <code class="k">catch</code> <code class="o">(</code><code class="n">DateTimeParseException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">"Invalid format for date"</code><code class="o">,</code> <code class="n">e</code><code class="o">);</code>
    <code class="o">}</code>
    <code class="k">if</code> <code class="o">(</code><code class="n">parsedDate</code><code class="o">.</code><code class="na">isAfter</code><code class="o">(</code><code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">()))</code> <code class="k">throw</code> <code class="k">new</code> <code class="n">IllegalArgumentException</code><code class="o">(</code><code class="s">"date cannot be in the future"</code><code class="o">);</code>

    <code class="k">try</code> <code class="o">{</code>
        <code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">amount</code><code class="o">);</code>
    <code class="o">}</code>
    <code class="k">catch</code> <code class="o">(</code><code class="n">NumberFormatException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">throw</code> <code class="k">new</code> <code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">"Invalid format for amount"</code><code class="o">,</code> <code class="n">e</code><code class="o">);</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>
<code class="o">}</code></pre></div>

<p>Next, you will learn about the Notification pattern, which provides a solution to the downsides highlighted with the overly specific and overly apathetic anti-patterns.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Notification Pattern"><div class="sect3" id="idm45816831275464">
<h3>Notification Pattern</h3>

<p>The Notification pattern aims to provide a solution for the situation in which you are using too many unchecked exceptions.<a data-type="indexterm" data-primary="exception handling" data-secondary="patterns and anti-patterns with exceptions" data-tertiary="notification pattern" id="idm45816831228232"/><a data-type="indexterm" data-primary="notification pattern" id="idm45816831227240"/> The solution is to introduce a domain class to collect errors.<sup><a data-type="noteref" id="idm45816831226440-marker" href="ch03.xhtml#idm45816831226440">1</a></sup></p>

<p>The first thing you need is a <code>Notification</code> class whose responsibility is to collect errors. <a data-type="indexterm" data-primary="domain classes" data-secondary="Notification" id="idm45816831225048"/>The code in <a data-type="xref" href="#notification_declaration">Example 3-20</a> shows its declaration.</p>
<div id="notification_declaration" data-type="example">
<h5><span class="label">Example 3-20. </span>Introducing the domain class Notification to collect errors</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Notification</code> <code class="o">{</code>
    <code class="kd">private</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">errors</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">addError</code><code class="o">(</code><code class="kd">final</code> <code class="n">String</code> <code class="n">message</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">errors</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">message</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">hasErrors</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="o">!</code><code class="n">errors</code><code class="o">.</code><code class="na">isEmpty</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">String</code> <code class="nf">errorMessage</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">errors</code><code class="o">.</code><code class="na">toString</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getErrors</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">this</code><code class="o">.</code><code class="na">errors</code><code class="o">;</code>
    <code class="o">}</code>

<code class="o">}</code></pre></div>

<p>The benefit of introducing such a class is that you can now declare a validator that is able to collect multiple errors in one pass. This wasn’t possible in the two previous approaches you explored. Instead of throwing exceptions, you can now simply add messages into the <code>Notification</code> object as shown in <a data-type="xref" href="#validator_notification">Example 3-21</a>.</p>
<div id="validator_notification" data-type="example">
<h5><span class="label">Example 3-21. </span>Notification pattern</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="n">Notification</code> <code class="nf">validate</code><code class="o">()</code> <code class="o">{</code>

    <code class="kd">final</code> <code class="n">Notification</code> <code class="n">notification</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Notification</code><code class="o">();</code>
    <code class="k">if</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">description</code><code class="o">.</code><code class="na">length</code><code class="o">()</code> <code class="o">&gt;</code> <code class="mi">100</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">notification</code><code class="o">.</code><code class="na">addError</code><code class="o">(</code><code class="s">"The description is too long"</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">final</code> <code class="n">LocalDate</code> <code class="n">parsedDate</code><code class="o">;</code>
    <code class="k">try</code> <code class="o">{</code>
        <code class="n">parsedDate</code> <code class="o">=</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">parse</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">date</code><code class="o">);</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">parsedDate</code><code class="o">.</code><code class="na">isAfter</code><code class="o">(</code><code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">()))</code> <code class="o">{</code>
            <code class="n">notification</code><code class="o">.</code><code class="na">addError</code><code class="o">(</code><code class="s">"date cannot be in the future"</code><code class="o">);</code>
        <code class="o">}</code>
    <code class="o">}</code>
    <code class="k">catch</code> <code class="o">(</code><code class="n">DateTimeParseException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">notification</code><code class="o">.</code><code class="na">addError</code><code class="o">(</code><code class="s">"Invalid format for date"</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">final</code> <code class="kt">double</code> <code class="n">amount</code><code class="o">;</code>
    <code class="k">try</code> <code class="o">{</code>
        <code class="n">amount</code> <code class="o">=</code> <code class="n">Double</code><code class="o">.</code><code class="na">parseDouble</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">amount</code><code class="o">);</code>
    <code class="o">}</code>
    <code class="k">catch</code> <code class="o">(</code><code class="n">NumberFormatException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">notification</code><code class="o">.</code><code class="na">addError</code><code class="o">(</code><code class="s">"Invalid format for amount"</code><code class="o">);</code>
    <code class="o">}</code>
    <code class="k">return</code> <code class="n">notification</code><code class="o">;</code>
<code class="o">}</code></pre></div>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Guidelines for Using Exceptions"><div class="sect2" id="idm45816830944392">
<h2>Guidelines for Using Exceptions</h2>

<p>Now that you’ve learned the situations for which you may <a data-type="indexterm" data-primary="exception handling" data-secondary="patterns and anti-patterns with exceptions" data-startref="ix_excpatt" id="idm45816830943016"/>use exceptions, let’s discuss some general guidelines to use them effectively in your application.<a data-type="indexterm" data-primary="exception handling" data-secondary="guidelines for using exceptions" id="idm45816830812728"/></p>










<section data-type="sect3" data-pdf-bookmark="Do not ignore an exception"><div class="sect3" id="idm45816830811688">
<h3>Do not ignore an exception</h3>

<p>It’s never a good idea to ignore an exception as you won’t be able to diagnose the root of the problem. If there isn’t an obvious handling mechanism, then throw an unchecked exception instead.<a data-type="indexterm" data-primary="unchecked exceptions" id="idm45816830810216"/> This way if you really need to handle the checked exception, you’ll be forced to come back and deal with it after seeing the problem at runtime.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Do not catch the generic Exception"><div class="sect3" id="idm45816830808968">
<h3>Do not catch the generic Exception</h3>

<p>Catch a specific exception as much as you can to improve readability and support more specific exception handling. <a data-type="indexterm" data-primary="generic Exception, not catching" id="idm45816830807528"/>If you catch the generic <code>Exception</code>, it also includes a <code>RuntimeException</code>. Some IDEs can generate a catch clause that is too general, so you may need to think about making the catch clause more specific.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Document exceptions"><div class="sect3" id="idm45816830805400">
<h3>Document exceptions</h3>

<p>Document exceptions at your API-level including unchecked exceptions to facilitate troubleshooting.<a data-type="indexterm" data-primary="documenting exceptions" id="idm45816830803960"/> In fact, unchecked exceptions report the root of an issue that should be addressed.<a data-type="indexterm" data-primary="@throws Javadoc syntax" id="idm45816830803128"/> The code in <a data-type="xref" href="#document_exception">Example 3-22</a> shows an example of documenting exceptions using the <code>@throws</code> Javadoc syntax.</p>
<div id="document_exception" data-type="example">
<h5><span class="label">Example 3-22. </span>Documenting exceptions</h5>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@throws</code>  <code class="n">NoSuchFileException</code> <code class="k">if</code> <code class="n">the</code> <code class="n">file</code> <code class="n">does</code> <code class="n">not</code> <code class="n">exist</code>
<code class="nd">@throws</code>  <code class="n">DirectoryNotEmptyException</code> <code class="k">if</code> <code class="n">the</code> <code class="n">file</code> <code class="n">is</code> <code class="n">a</code> <code class="n">directory</code> <code class="n">and</code>
<code class="n">could</code> <code class="n">not</code> <code class="n">otherwise</code> <code class="n">be</code> <code class="n">deleted</code> <code class="n">because</code> <code class="n">the</code> <code class="n">directory</code> <code class="n">is</code> <code class="n">not</code> <code class="n">empty</code>
<code class="nd">@throws</code>  <code class="n">IOException</code> <code class="k">if</code> <code class="n">an</code> <code class="n">I</code><code class="o">/</code><code class="n">O</code> <code class="n">error</code> <code class="n">occurs</code>
<code class="nd">@throws</code>  <code class="n">SecurityException</code> <code class="n">In</code> <code class="n">the</code> <code class="k">case</code> <code class="n">of</code> <code class="n">the</code> <code class="k">default</code> <code class="n">provider</code><code class="o">,</code>
<code class="n">and</code> <code class="n">a</code> <code class="n">security</code> <code class="n">manager</code> <code class="n">is</code> <code class="n">installed</code><code class="o">,</code> <code class="n">the</code> <code class="o">{</code><code class="nd">@link</code> <code class="n">SecurityManager</code><code class="err">#</code><code class="n">checkDelete</code><code class="o">(</code><code class="n">String</code><code class="o">)}</code>
<code class="n">method</code> <code class="n">is</code> <code class="n">invoked</code> <code class="n">to</code> <code class="n">check</code> <code class="n">delete</code> <code class="n">access</code> <code class="n">to</code> <code class="n">the</code> <code class="n">file</code></pre></div>
</div></section>













<section data-type="sect3" class="pagebreak-before less_space" data-pdf-bookmark="Watch out for implementation-specific exceptions"><div class="sect3" id="idm45816830797240">
<h3>Watch out for implementation-specific exceptions</h3>

<p>Do not throw implementation-specific exceptions as it breaks encapsulation of your API.<a data-type="indexterm" data-primary="implementation-specific exceptions, avoiding" id="idm45816830629336"/> For example, the definition of <code>read()</code> in <a data-type="xref" href="#implementation_specific_exception">Example 3-23</a> forces any future implementations to throw an <code>OracleException</code>, when clearly <code>read()</code> could support sources that are completely unrelated to Oracle!</p>
<div id="implementation_specific_exception" data-type="example">
<h5><span class="label">Example 3-23. </span>Avoid implementation-specific exceptions</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="n">String</code> <code class="nf">read</code><code class="o">(</code><code class="kd">final</code> <code class="n">Source</code> <code class="n">source</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">OracleException</code> <code class="o">{</code> <code class="o">...</code> <code class="o">}</code></pre></div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Exceptions versus Control flow"><div class="sect3" id="idm45816830564232">
<h3>Exceptions versus Control flow</h3>

<p>Do not use exceptions for control flow.<a data-type="indexterm" data-primary="control flow versus exceptions" id="idm45816830619672"/> The code in <a data-type="xref" href="#flow_exception">Example 3-24</a> exemplifies a bad use of exceptions in Java. The code relies on an exception to exit the reading loop.</p>
<div id="flow_exception" data-type="example">
<h5><span class="label">Example 3-24. </span>Using exceptions for control flow</h5>

<pre data-type="programlisting" data-code-language="java"><code class="k">try</code> <code class="o">{</code>
    <code class="k">while</code> <code class="o">(</code><code class="kc">true</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">source</code><code class="o">.</code><code class="na">read</code><code class="o">());</code>
    <code class="o">}</code>
<code class="o">}</code>
<code class="k">catch</code><code class="o">(</code><code class="n">NoDataException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>
<code class="o">}</code></pre></div>

<p>You should avoid this type of code for several reasons. First, it leads to poor code readability because the exception try/catch syntax adds unnecessary clutter. Second, it makes the intent of your code less comprehensible. Exceptions are meant as a feature to deal with errors and exceptional scenarios. Consequently, it’s good not to create an exception until you are sure that you need to throw it. Finally, there’s overhead associated with holding a stack trace in the event that an exception is thrown.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Alternatives to Exceptions"><div class="sect2" id="idm45816830591768">
<h2>Alternatives to Exceptions</h2>

<p>You’ve learned about using exceptions in Java for the purpose of making your Bank Statements Analyzer more robust and comprehensible for your users.<a data-type="indexterm" data-primary="exception handling" data-secondary="alternatives to exceptions" id="idm45816830535464"/> What are alternatives to exceptions, though? We briefly describe four alternative approaches together with their pros and cons.</p>










<section data-type="sect3" data-pdf-bookmark="Using null"><div class="sect3" id="idm45816830534152">
<h3>Using null</h3>

<p>Instead of throwing a specific exception, you may ask<a data-type="indexterm" data-primary="nulls" data-secondary="returning null instead of exception" id="idm45816830532792"/> why you can’t just return <code>null</code> as shown in <a data-type="xref" href="#exception_null">Example 3-25</a>.</p>
<div id="exception_null" data-type="example">
<h5><span class="label">Example 3-25. </span>Returning null instead of an exception</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">final</code> <code class="n">String</code><code class="o">[]</code> <code class="n">columns</code> <code class="o">=</code> <code class="n">line</code><code class="o">.</code><code class="na">split</code><code class="o">(</code><code class="s">","</code><code class="o">);</code>

<code class="k">if</code><code class="o">(</code><code class="n">columns</code><code class="o">.</code><code class="na">length</code> <code class="o">&lt;</code> <code class="n">EXPECTED_ATTRIBUTES_LENGTH</code><code class="o">)</code> <code class="o">{</code>
    <code class="k">return</code> <code class="kc">null</code><code class="o">;</code>
<code class="o">}</code></pre></div>

<p>This approach is to be absolutely avoided. In fact, <code>null</code> provides no useful information to the caller. It is also error prone as you have to explicitly remember to check for <code>null</code> as a result of your API. In practice, this leads to many <code>NullPointerException</code>s and a lot of unnecessary debugging!<a data-type="indexterm" data-primary="NullPointerException" id="idm45816830471080"/></p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="The Null Object pattern"><div class="sect3" id="idm45816830470328">
<h3>The Null Object pattern</h3>

<p>An approach <a data-type="indexterm" data-primary="null object pattern" id="idm45816830468808"/>you sometimes see adopted in Java is the <em>Null Object pattern</em>. In a nutshell, instead of returning a <code>null</code> reference to convey the absence of an object, you return an object that implements the expected interface but whose method bodies are empty. The advantage of this tactic is that you won’t deal with unexpected <code>NullPointer</code> exceptions and a long list of <code>null</code> checks. In fact, this empty object is very predictable because it does nothing functionally! Nonetheless, this pattern can also be problematic because you may hide potential issues in the data with an object that simply ignores the real problem, and as a result make troubleshooting more difficult.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Optional&lt;T&gt;"><div class="sect3" id="idm45816830465576">
<h3>Optional&lt;T&gt;</h3>

<p>Java 8 introduced a built-in data type <code>java.util.Optional&lt;T&gt;</code>, which is dedicated to representing the presence or absence of a value.<a data-type="indexterm" data-primary="java.util.Optional&lt;T&gt;" id="idm45816830463608"/><a data-type="indexterm" data-primary="Optional&lt;T&gt; type" id="idm45816830462904"/> The <code>Optional&lt;T&gt;</code> comes with a set of methods to explicitly deal with the absence of a value, which is useful to reduce the scope for bugs. It also allows you to compose various <code>Optional</code> objects together, which may be returned as a return type from different APIs you use. An example of that is the method <code>findAny()</code> in the Streams API. You will learn more about how you can use <code>Optional&lt;T&gt;</code> in <a data-type="xref" href="ch07.xhtml#chapter_07">Chapter 7</a>.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Try&lt;T&gt;"><div class="sect3" id="idm45816830459128">
<h3>Try&lt;T&gt;</h3>

<p>There’s another data type called <code>Try&lt;T&gt;</code>, which represents an operation that may succeed or fail.<a data-type="indexterm" data-primary="Try&lt;T&gt; type" id="idm45816830457160"/> In a way it is analogous to <code>Optional&lt;T&gt;</code>, but instead of values you work with operations. In other words, the <code>Try&lt;T&gt;</code> data type brings similar code composability benefits and also helps reduce the scope for errors in your code. Unfortunately, the <code>Try&lt;T&gt;</code> data type is not built in to the JDK but is supported by external libraries that you can look at.<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="exception handling" data-startref="ix_BSAextexc" id="idm45816830454856"/><a data-type="indexterm" data-primary="exception handling" data-startref="ix_exc" id="idm45816830453272"/></p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Using a Build Tool"><div class="sect1" id="idm45816830452200">
<h1>Using a Build Tool</h1>

<p>So far you’ve learned good programming practices and principles. But what about structuring, building, and running your application? <a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="using a build tool" id="ix_BSAextbld"/>This section focuses on why using a build tool for your project is a necessity and how you can use a build tool such as Maven and Gradle to build and run your application in a predictable manner. In <a data-type="xref" href="ch05.xhtml#chapter_05">Chapter 5</a>, you will learn more about a related topic of how to structure the application effectively using Java packages.</p>








<section data-type="sect2" data-pdf-bookmark="Why Use a Build Tool?"><div class="sect2" id="idm45816830447640">
<h2>Why Use a Build Tool?</h2>

<p>Let’s consider the problem of executing your application.<a data-type="indexterm" data-primary="build tools" id="ix_bld"/> There are several elements you need to take care of. First, once you have written the code for your project, you will need to compile it. To do this, you will have to use the Java compiler (javac). Do you remember all the commands required to compile multiple files? What about with multiple packages?<a data-type="indexterm" data-primary="dependencies" data-secondary="managing with a build tool" id="idm45816830445000"/> What about managing dependencies if you were to import other Java libraries? What about if the project needs to be packaged in a specific format such as WAR or JAR? Suddenly things get messy, and more and more pressure is put on the developer.</p>

<p>To automate all the commands required, you will need to create a script so you don’t have to repeat the commands every time. Introducing a new script means that all your current and future teammates will need to be familiar with your way of thinking to be able to maintain and change the script as requirements evolve. Second, the software development life cycle needs to be taken into consideration. It’s not just about developing and compiling the code. What about testing and deploying it?</p>

<p>The solution to these problems is using a build tool. You can think of a build tool as an assistant that can automate the repetitive tasks in the software development life cycle, including building, testing, and deploying your application.<a data-type="indexterm" data-primary="build tools" data-secondary="benefits of using" id="idm45816830419864"/> A build tool has many benefits:</p>

<ul>
<li>
<p>It provides you with a common structure to think about a project so your colleagues feel immediately at home with the project.</p>
</li>
<li>
<p>It sets you up with a repeatable and standardized process to build and run an application.</p>
</li>
<li>
<p>You spend more time on development, and less time on low-level configurations and setup.</p>
</li>
<li>
<p>You are reducing the scope for introducing errors due to bad configurations or missing steps in the build.</p>
</li>
<li>
<p>You save time by reusing common build tasks instead of reimplementing them.</p>
</li>
</ul>

<p>You will now explore two popular build tools used in the Java community: Maven and Gradle.<sup><a data-type="noteref" id="idm45816830413256-marker" href="ch03.xhtml#idm45816830413256">2</a></sup></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Using Maven"><div class="sect2" id="using_maven">
<h2>Using Maven</h2>

<p>Maven is highly popular in the Java community.<a data-type="indexterm" data-primary="build tools" data-secondary="using Maven" id="ix_bldMa"/><a data-type="indexterm" data-primary="Maven" id="ix_Mvn"/> It allows you to describe the build process for your software together with its dependencies. In addition, there’s a large community maintaining repositories that Maven can use to automatically download the libraries and dependencies used by your application. Maven was initially released in 2004 and as you might expect, XML was very popular back then! Consequently, the declaration of the build process in Maven is XML based.</p>










<section data-type="sect3" data-pdf-bookmark="Project structure"><div class="sect3" id="idm45816830407928">
<h3>Project structure</h3>

<p>The great thing about Maven is that from the get-go it comes with structure to help maintenance.<a data-type="indexterm" data-primary="Maven" data-secondary="project structure" id="idm45816830406344"/><a data-type="indexterm" data-primary="projects" data-secondary="Maven project structure" id="idm45816830405368"/> A Maven project starts with two main folders:</p>
<dl>
<dt><code>/src/main/java</code></dt>
<dd>
<p>This is where you will develop and find all the Java classes required for your project.</p>
</dd>
<dt><code>src/test/java</code></dt>
<dd>
<p>This where you will develop and find all the tests for your project.</p>
</dd>
</dl>

<p>There are two additional folders that are useful but not required:</p>
<dl>
<dt><code>src/main/resources</code></dt>
<dd>
<p>This is where you can include extra resources such as text files needed by your application.</p>
</dd>
<dt><code>src/test/resources</code></dt>
<dd>
<p>This is where you can include extra resources used by your tests.</p>
</dd>
</dl>

<p>Having this common directory layout allows anyone familiar with Maven to be immediately able to locate important files.
To specify the build process you will need to create a <em>pom.xml</em> file where you specify various XML declarations to document the steps required to build your application. <a data-type="xref" href="#maven_layout">Figure 3-2</a> summarizes the common Maven project layout.</p>

<figure><div id="maven_layout" class="figure">
<img src="Images/rwsd_0302.png" alt="Maven Standard Directory Layout" width="1325" height="411"/>
<h6><span class="label">Figure 3-2. </span>Maven standard directory layout</h6>
</div></figure>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Example build file"><div class="sect3" id="idm45816830392568">
<h3>Example build file</h3>

<p>The next step is to create the <em>pom.xml</em> that will dictate the build process.<a data-type="indexterm" data-primary="pom.xml files (Maven)" id="idm45816830390824"/><a data-type="indexterm" data-primary="Maven" data-secondary="example build file" id="idm45816830390120"/> The code snippet in <a data-type="xref" href="#maven_pom_simple">Example 3-26</a> shows a basic example that you can use for building the Bank Statements Analyzer project. You will see several elements in this file:</p>
<dl>
<dt><code>project</code></dt>
<dd>
<p>This is the top-level element in all <em>pom.xml</em> files.</p>
</dd>
<dt><code>groupId</code></dt>
<dd>
<p>This element indicates the unique identifier of the organization that created the project.</p>
</dd>
<dt><code>artifactId</code></dt>
<dd>
<p>This element specifies a unique base name for the  artifact generated by the build process.</p>
</dd>
<dt><code>packaging</code></dt>
<dd>
<p>This element indicates the package type to be used by this artifact (e.g., JAR, WAR, EAR, etc.). The default is JAR if the XML element <code>packaging</code> is omitted.</p>
</dd>
<dt><code>version</code></dt>
<dd>
<p>The version of the artifact generated by the project.</p>
</dd>
<dt><code>build</code></dt>
<dd>
<p>This element specifies various configurations to guide the build process such as plug-ins and resources.</p>
</dd>
<dt><code>dependencies</code></dt>
<dd>
<p>This element specifies a dependency list for the project.</p>
</dd>
</dl>
<div id="maven_pom_simple" data-type="example" class="pagebreak-before">
<h5><span class="label">Example 3-26. </span>Build file pom.xml in Maven</h5>

<pre data-type="programlisting" data-code-language="xml"><code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code>
<code class="nt">&lt;project</code> <code class="na">xmlns=</code><code class="s">"http://maven.apache.org/POM/4.0.0"</code>
         <code class="na">xmlns:xsi=</code><code class="s">"http://www.w3.org/2001/XMLSchema-instance"</code>
         <code class="na">xsi:schemaLocation=</code><code class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</code><code class="nt">&gt;</code>
    <code class="nt">&lt;modelVersion&gt;</code>4.0.0<code class="nt">&lt;/modelVersion&gt;</code>

    <code class="nt">&lt;groupId&gt;</code>com.iteratrlearning<code class="nt">&lt;/groupId&gt;</code>
    <code class="nt">&lt;artifactId&gt;</code>bankstatement_analyzer<code class="nt">&lt;/artifactId&gt;</code>
    <code class="nt">&lt;version&gt;</code>1.0-SNAPSHOT<code class="nt">&lt;/version&gt;</code>

    <code class="nt">&lt;build&gt;</code>
        <code class="nt">&lt;plugins&gt;</code>
            <code class="nt">&lt;plugin&gt;</code>
                <code class="nt">&lt;groupId&gt;</code>org.apache.maven.plugins<code class="nt">&lt;/groupId&gt;</code>
                <code class="nt">&lt;artifactId&gt;</code>maven-compiler-plugin<code class="nt">&lt;/artifactId&gt;</code>
                <code class="nt">&lt;version&gt;</code>3.7.0<code class="nt">&lt;/version&gt;</code>
                <code class="nt">&lt;configuration&gt;</code>
                    <code class="nt">&lt;source&gt;</code>9<code class="nt">&lt;/source&gt;</code>
                    <code class="nt">&lt;target&gt;</code>9<code class="nt">&lt;/target&gt;</code>
                <code class="nt">&lt;/configuration&gt;</code>
            <code class="nt">&lt;/plugin&gt;</code>
        <code class="nt">&lt;/plugins&gt;</code>
    <code class="nt">&lt;/build&gt;</code>

    <code class="nt">&lt;dependencies&gt;</code>
        <code class="nt">&lt;dependency&gt;</code>
            <code class="nt">&lt;groupId&gt;</code>junit<code class="nt">&lt;/groupId&gt;</code>
            <code class="nt">&lt;artifactId&gt;</code>junit<code class="nt">&lt;/artifactId&gt;</code>
            <code class="nt">&lt;version&gt;</code>4.12<code class="nt">&lt;/version&gt;</code>
            <code class="nt">&lt;scope&gt;</code>test<code class="nt">&lt;/scope&gt;</code>
        <code class="nt">&lt;/dependency&gt;</code>
    <code class="nt">&lt;/dependenciesn&gt;</code>
<code class="nt">&lt;/project&gt;</code></pre></div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Maven commands"><div class="sect3" id="idm45816830373272">
<h3>Maven commands</h3>

<p>Once you’ve set up a <em>pom.xml</em>, the next step is to use Maven to build and package your project!<a data-type="indexterm" data-primary="Maven" data-secondary="commands" id="idm45816829435480"/> There are various commands available. We only cover the fundamentals:</p>
<dl>
<dt><code>mvn clean</code></dt>
<dd>
<p>Cleans up any previously generated artifacts from a prior build</p>
</dd>
<dt><code>mvn compile</code></dt>
<dd>
<p>Compiles the source code of the project (by default in a generated <em>target</em> folder)</p>
</dd>
<dt><code>mvn test</code></dt>
<dd>
<p>Tests the compiled source code</p>
</dd>
<dt><code>mvn package</code></dt>
<dd>
<p>Packages the compiled code in a suitable format such as JAR</p>
</dd>
</dl>

<p>For example, running the command <code>mvn package</code> from the directory where the <em>pom.xml</em> file is located will produce an output similar to this:</p>

<pre data-type="programlisting">[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building bankstatement_analyzer 1.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.063 s
[INFO] Finished at: 2018-06-10T12:14:48+01:00
[INFO] Final Memory: 10M/47M</pre>

<p>You will see the generated JAR <em>bankstatement_analyzer-1.0-SNAPSHOT.jar</em> in the <span class="keep-together"><em>target</em></span> folder.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>If you want to run a main class in the generated artifact using the <code>mvn</code> command, you will need to <a data-type="indexterm" data-primary="exec plug-in (Maven)" id="idm45816826909192"/>take a look at the <a href="https://oreil.ly/uoPbv">exec plug-in</a>.</p>
</div>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Using Gradle"><div class="sect2" id="idm45816826907416">
<h2>Using Gradle</h2>

<p>Maven is not the only build tool solution available in the Java space.<a data-type="indexterm" data-primary="Maven" data-startref="ix_Mvn" id="idm45816826905944"/><a data-type="indexterm" data-primary="build tools" data-secondary="using Maven" data-startref="ix_bldMa" id="idm45816826904968"/><a data-type="indexterm" data-primary="Gradle" id="ix_Grdl"/><a data-type="indexterm" data-primary="build tools" data-secondary="using Gradle" id="ix_bldGr"/> Gradle is an alternative popular build tool to Maven. But you may wonder why use yet another build tool? Isn’t Maven the most widely adopted? One of Maven’s deficiencies is that the use of XML can make things less readable and more cumbersome to work with.<a data-type="indexterm" data-primary="XML files, benefits of using Gradle with" id="idm45816826901192"/><a data-type="indexterm" data-primary="Gradle" data-secondary="advantages of" id="idm45816826900552"/> For example, it is often necessary as part of the build process to provide various custom system commands, such as copying and moving files around. Specifying such commands using an XML syntax isn’t natural. In addition, XML is generally considered as a verbose language, which can increase the maintenance overhead. However, Maven introduced lots of good ideas such as standardization of project structure, which Gradle gets inspiration from. One of Gradle’s biggest advantages is that it uses a friendly Domain Specific Language (DSL) using the Groovy or Kotlin programming languages to specify the build process.<a data-type="indexterm" data-primary="domain-specific language (DSL), use by Gradle" id="idm45816826898840"/><a data-type="indexterm" data-primary="Kotlin programming language" id="idm45816826898200"/><a data-type="indexterm" data-primary="Groovy programming language" id="idm45816826897560"/> As a result, specifying the build is more natural, easier to customize, and simpler to understand. In addition, Gradle supports features such as cache and incremental compilation, which contribute to faster build time.<sup><a data-type="noteref" id="idm45816826896504-marker" href="ch03.xhtml#idm45816826896504">3</a></sup></p>










<section data-type="sect3" data-pdf-bookmark="Example build file"><div class="sect3" id="idm45816826894840">
<h3>Example build file</h3>

<p>Gradle follows a similar project structure to Maven. However, instead of a <em>pom.xml</em> file, you will declare a <em>build.gradle</em> file.<a data-type="indexterm" data-primary="projects" data-secondary="Gradle project structure" id="idm45816826880136"/><a data-type="indexterm" data-primary="Gradle" data-secondary="example build file" id="idm45816826879400"/><a data-type="indexterm" data-primary="build.gradle files" id="idm45816826878552"/><a data-type="indexterm" data-primary="settings.gradle files" id="idm45816826877944"/> There’s also a <em>settings.gradle</em> file that includes configuration variables and setup for a multiproject build. In the code snippet in <a data-type="xref" href="#gradle_simple">Example 3-27</a> you can find a small build file written in Gradle that is equivalent to the Maven example you saw in <a data-type="xref" href="#maven_pom_simple">Example 3-26</a>. You have to admit it’s a lot more concise!</p>
<div id="gradle_simple" data-type="example">
<h5><span class="label">Example 3-27. </span>Build file build.gradle in Gradle</h5>

<pre data-type="programlisting">apply plugin: 'java'
apply plugin: 'application'

group = 'com.iteratrlearning'
version = '1.0-SNAPSHOT'

sourceCompatibility = 9
targetCompatibility = 9

mainClassName = "com.iteratrlearning.MainApplication"

repositories {
    mavenCentral()
}
dependencies {
    testImplementation group: 'junit', name: 'junit', version:'4.12'
}</pre></div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Gradle commands"><div class="sect3" id="idm45816826872904">
<h3>Gradle commands</h3>

<p>Finally, you can now run the build process by running similar commands to what you learned with Maven.<a data-type="indexterm" data-primary="Gradle" data-secondary="commands" id="idm45816826871416"/> Each command in Gradle is a task. You can define your own tasks and execute them or use built-in tasks such as <code>test</code>, <code>build</code>, and <code>clean</code>:</p>
<dl>
<dt><code>gradle clean</code></dt>
<dd>
<p>Cleans up generated files during a previous build</p>
</dd>
<dt><code>gradle build</code></dt>
<dd>
<p>Packages the application</p>
</dd>
<dt><code>gradle test</code></dt>
<dd>
<p>Runs the tests</p>
</dd>
<dt><code>gradle run</code></dt>
<dd>
<p>Runs the main class specified in <code>mainClassName</code> provided the <code>application</code> plug-in is applied</p>
</dd>
</dl>

<p>For example, running <code>gradle build</code> will produce an output similar to this:</p>

<pre data-type="programlisting">BUILD SUCCESSFUL in 1s
2 actionable tasks: 2 executed</pre>

<p>You will find the generated JAR in the <code>build</code> folder that is created by Gradle during the build process.<a data-type="indexterm" data-primary="Gradle" data-startref="ix_Grdl" id="idm45816826860632"/><a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-tertiary="using a build tool" data-startref="ix_BSAextbld" id="idm45816826859784"/><a data-type="indexterm" data-primary="build tools" data-secondary="using Gradle" data-startref="ix_bldGr" id="idm45816826858312"/><a data-type="indexterm" data-primary="build tools" data-startref="ix_bld" id="idm45816826857016"/></p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Takeaways"><div class="sect1" id="idm45816826855816">
<h1>Takeaways</h1>

<ul>
<li>
<p>The Open/Closed Principle promotes the idea of being able to change the behavior of a method or class without having to modify the code.</p>
</li>
<li>
<p>The Open/Closed Principle reduces fragility of code by not changing existing code, promotes reusability of existing code, and promotes decoupling, which leads to better code maintenance.</p>
</li>
<li>
<p>God interfaces with many specific methods introduce complexity and coupling.</p>
</li>
<li>
<p>An interface that is too granular with single methods can introduce the opposite of cohesion.</p>
</li>
<li>
<p>You should not be worried about adding descriptive method names to help readability and comprehension of your API .</p>
</li>
<li>
<p>Returning <code>void</code> as a result of an operation makes it difficult to test its behavior.</p>
</li>
<li>
<p>Exceptions in Java contribute to documentation, type safety, and separation of concerns.</p>
</li>
<li>
<p>Use checked exceptions sparingly rather than the default as they can cause significant clutter.</p>
</li>
<li>
<p>Overly specific exceptions can make software development unproductive.</p>
</li>
<li>
<p>The Notification Pattern introduces a domain class to collect errors.</p>
</li>
<li>
<p>Do not ignore an exception or catch the generic <code>Exception</code> as you will lose the benefits of diagnosing the root of the problem.</p>
</li>
<li>
<p>A build tool automates the repetitive tasks in the software development life cycle including building, testing, and deploying your application.</p>
</li>
<li>
<p>Maven and Gradle are two popular build tools used in the Java community.</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Iterating on You"><div class="sect1" id="idm45816826840728">
<h1>Iterating on You</h1>

<p>If you want to extend and solidify the knowledge from this section you could try one of these activities:</p>

<ul>
<li>
<p>Add support for exporting in different data formats including JSON and XML</p>
</li>
<li>
<p>Develop a basic GUI around the Bank Statements Analyzer</p>
</li>
</ul>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Completing the Challenge"><div class="sect1" id="idm45816826836840">
<h1>Completing the Challenge</h1>

<p>Mark Erbergzuck is very happy with your final iteration of the Bank Statements Analyzer. A few days later, the world hit a new financial crisis and your application is going viral. Time to work on a new exciting project in the next chapter!<a data-type="indexterm" data-primary="bank statements analyzer (example)" data-secondary="extending" data-startref="ix_BSAext" id="idm45816826835288"/></p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idm45816831226440"><sup><a href="ch03.xhtml#idm45816831226440-marker">1</a></sup> This pattern was first put forward by Martin Fowler.</p><p data-type="footnote" id="idm45816830413256"><sup><a href="ch03.xhtml#idm45816830413256-marker">2</a></sup> Earlier in Java’s life there was another popular build tool, called Ant, but it is now considered end-of-life and should not be used anymore.</p><p data-type="footnote" id="idm45816826896504"><sup><a href="ch03.xhtml#idm45816826896504-marker">3</a></sup> For more information on Maven versus Gradle, see <a href="https://gradle.org/maven-vs-gradle/"><em class="hyperlink">https://gradle.org/maven-vs-gradle/</em></a>.</p></div></div></section></div>



  </body></html>