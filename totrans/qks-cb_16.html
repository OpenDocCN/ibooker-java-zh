<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 16. Additional Quarkus Features"><div class="chapter" id="additional-quarkus-features-chapter">
<h1><span class="label">Chapter 16. </span>Additional Quarkus Features</h1>


<p><a data-type="indexterm" data-primary="features, additional" id="feat_ch"/>This chapter contains features of Quarkus that don’t fit into any other chapter.
That, of course, doesn’t make them any less useful!
In this chapter, you’ll learn about the following topics:</p>

<ul>
<li>
<p>Quarkus’s templating solution, Qute</p>
</li>
<li>
<p>OpenAPI integration</p>
</li>
<li>
<p>Sending emails</p>
</li>
<li>
<p>Scheduling functions</p>
</li>
<li>
<p>Application data caching</p>
</li>
</ul>






<section data-type="sect1" data-pdf-bookmark="16.1 Creating Templates with the Qute Template Engine"><div class="sect1" id="templates_qute_template">
<h1>16.1 Creating Templates with the Qute Template Engine</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128489149448">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="Qute" data-secondary="creating templates with" id="idm45128489148248"/><a data-type="indexterm" data-primary="templates" id="idm45128489147272"/>You want to create templates and render them with specific data.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128489078904">
<h2>Solution</h2>

<p>Use the Qute template engine.</p>

<p>Qute is a templating engine designed specifically to meet the Quarkus needs of minimizing the usage of reflection and supporting the imperative and reactive style of coding.</p>

<p>Qute can be used as a standalone library (generating reports to disk or generating 
<span class="keep-together">e-mail</span> body messages) or together with JAX-RS to deliver HTML content.</p>

<p><a data-type="indexterm" data-primary="resteasy-qute extension" id="idm45128489075336"/>To start using Qute with JAX-RS, add the <code>resteasy-qute</code> extension:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw quarkus:add-extension -Dextensions<code class="o">=</code><code class="s2">"quarkus-resteasy-qute"</code></pre>

<p>By default, templates are stored at the <em>src/main/resources/templates</em> directory and its subdirectories.</p>

<p>The following might be a simple template as a plain-text file:</p>

<pre data-type="programlisting" data-code-language="text">Hello {name}!</pre>

<p>The template is a simple sentence parametrized with the <code>name</code> parameter.</p>

<p>To render the template with concrete data, you just need to inject the <code>io.quarkus.qute.Template</code> instance and provide the template parameters:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Inject</code><code>
</code><code class="n">io</code><code class="o">.</code><code class="na">quarkus</code><code class="o">.</code><code class="na">qute</code><code class="o">.</code><code class="na">Template</code><code> </code><code class="n">hello</code><code class="o">;</code><code> </code><a class="co" id="co_additional_quarkus_features_CO1-1" href="#callout_additional_quarkus_features_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code> </code><a class="co" id="co_additional_quarkus_features_CO1-2" href="#callout_additional_quarkus_features_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code class="nd">@GET</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">TemplateInstance</code><code> </code><code class="nf">hello</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_additional_quarkus_features_CO1-3" href="#callout_additional_quarkus_features_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>    </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">name</code><code> </code><code class="o">=</code><code> </code><code class="s">"Alex"</code><code class="o">;</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">hello</code><code class="o">.</code><code class="na">data</code><code class="o">(</code><code class="s">"name"</code><code class="o">,</code><code> </code><code class="n">name</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_additional_quarkus_features_CO1-4" href="#callout_additional_quarkus_features_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO1-1" href="#co_additional_quarkus_features_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>Template</code> instance defines the operations to do in a template</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO1-2" href="#co_additional_quarkus_features_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>By default, the field name is used to locate the template; in this case, the template path is <em>src/main/resources/templates/hello.txt</em></p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO1-3" href="#co_additional_quarkus_features_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Rendering is not necessary because RESTEasy integrates with the <code>TemplateInstance</code> object to render the content</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO1-4" href="#co_additional_quarkus_features_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p><code>data</code> method is used to set the template parameters</p></dd>
</dl>

<p>If you run the project, you’ll be able to see how the template is rendered:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw compile quarkus:dev</code>

<code class="go">curl http://localhost:8080/hello</code>

<code class="go">Hello Alex!</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128489078312">
<h2>Discussion</h2>

<p>Qute supports more syntax (e.g., <code>include</code> and <code>insert</code> fragments, injecting CDI beans directly, or variant templates) as well as integration with other Quarkus parts like email or schedule tasks.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128489847272">
<h2>See Also</h2>

<p>Visit the following website to learn more about Qute:</p>

<ul>
<li>
<p><a href="https://oreil.ly/R1A1S">Quarkus: Qute Reference Guide</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.2 Rending HTML Using Qute"><div class="sect1" id="idm45128489302344">
<h1>16.2 Rending HTML Using Qute</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128489301368">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="HTML, rending using Qute" id="idm45128489300136"/><a data-type="indexterm" data-primary="Qute" data-secondary="rending HTML using" id="idm45128489397480"/><a data-type="indexterm" data-primary="ending HTML using Qute" id="idm45128489396504"/>You want to render HTML using Qute.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128489395448">
<h2>Solution</h2>

<p>Qute will render HTML just as easily as text.
All that needs to happen is for Quarkus to find the template that matches your injection.
The actual content of the template doesn’t matter much.</p>

<p>Let’s render an HTML page with more complex structures on the template.
A simple HTML report is rendered in this case.
Create a POJO class containing the parameters of the report:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.ArrayList</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.List</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.qute.TemplateData</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@TemplateData</code><code> </code><a class="co" id="co_additional_quarkus_features_CO2-1" href="#callout_additional_quarkus_features_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">Movie</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="n">name</code><code class="o">;</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="n">year</code><code class="o">;</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="n">genre</code><code class="o">;</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="n">director</code><code class="o">;</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">characters</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ArrayList</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">float</code><code> </code><code class="n">ratings</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="nf">getStars</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_additional_quarkus_features_CO2-2" href="#callout_additional_quarkus_features_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">Math</code><code class="o">.</code><code class="na">round</code><code class="o">(</code><code class="n">ratings</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO2-1" href="#co_additional_quarkus_features_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This annotation allows Quarkus to avoid using reflection to access the object at runtime</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO2-2" href="#co_additional_quarkus_features_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Custom method</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128489663752">
<h2>Discussion</h2>

<p>The following are some details of the HTML template that are worth explaining.</p>

<p>The first part to look at is an optional header that you can put in any template to help Quarkus validate all the expressions at compile time:</p>

<pre data-type="programlisting" data-code-language="html"><code>{@org.acme.quickstart.Movie movie} </code><a class="co" id="co_additional_quarkus_features_CO3-1" href="#callout_additional_quarkus_features_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="cp">&lt;!DOCTYPE html&gt;</code><code>
</code><code class="nt">&lt;html</code><code class="nt">&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO3-1" href="#co_additional_quarkus_features_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Parameter declaration; this is not mandatory, but it helps Quarkus to validate your template for type safety</p></dd>
</dl>

<p>Basic syntax like conditionals or loops are supported:</p>

<pre data-type="programlisting" data-code-language="html"><code class="nt">&lt;div</code><code> </code><code class="na">class=</code><code class="s">"col-sm-12"</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;dl</code><code class="nt">&gt;</code><code>
        {#if movie.year == 0} </code><a class="co" id="co_additional_quarkus_features_CO4-1" href="#callout_additional_quarkus_features_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
            </code><code class="nt">&lt;dt</code><code class="nt">&gt;</code><code>Year:</code><code class="nt">&lt;/dt&gt;</code><code> Not Known
        {#else} </code><a class="co" id="co_additional_quarkus_features_CO4-2" href="#callout_additional_quarkus_features_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
            </code><code class="nt">&lt;dt</code><code class="nt">&gt;</code><code>Year:</code><code class="nt">&lt;/dt&gt;</code><code> {movie.year}
        {/if}
        {#if movie.genre is 'horror'} </code><a class="co" id="co_additional_quarkus_features_CO4-3" href="#callout_additional_quarkus_features_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;dt</code><code class="nt">&gt;</code><code>Genre:</code><code class="nt">&lt;/dt&gt;</code><code> Buuuh
        {#else}
        </code><code class="nt">&lt;dt</code><code class="nt">&gt;</code><code>Genre:</code><code class="nt">&lt;/dt&gt;</code><code> {movie.genre}
        {/if}
        </code><code class="nt">&lt;dt</code><code class="nt">&gt;</code><code>Director:</code><code class="nt">&lt;/dt&gt;</code><code> {movie.director ?: 'Unknown'} </code><a class="co" id="co_additional_quarkus_features_CO4-4" href="#callout_additional_quarkus_features_CO4-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;dt</code><code class="nt">&gt;</code><code>Main Characters:</code><code class="nt">&lt;/dt&gt;</code><code>
        {#for character in movie.characters} </code><a class="co" id="co_additional_quarkus_features_CO4-5" href="#callout_additional_quarkus_features_CO4-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
            {character} </code><a class="co" id="co_additional_quarkus_features_CO4-6" href="#callout_additional_quarkus_features_CO4-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
            {#if hasNext} </code><a class="co" id="co_additional_quarkus_features_CO4-7" href="#callout_additional_quarkus_features_CO4-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
             -
            {/if}
        {/for}
        </code><code class="nt">&lt;dt</code><code class="nt">&gt;</code><code>Rating:</code><code class="nt">&lt;/dt&gt;</code><code>
        </code><code class="nt">&lt;font</code><code> </code><code class="na">color=</code><code class="s">"red"</code><code class="nt">&gt;</code><code>
        {#for i in movie.stars} </code><a class="co" id="co_additional_quarkus_features_CO4-8" href="#callout_additional_quarkus_features_CO4-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a><code>
            </code><code class="nt">&lt;span</code><code> </code><code class="na">class=</code><code class="s">"fas fa-xs fa-star"</code><code class="nt">&gt;</code><code class="nt">&lt;/span&gt;</code><code>
        {/for}
        </code><code class="nt">&lt;/font&gt;</code><code>
    </code><code class="nt">&lt;/dl&gt;</code><code>
</code><code class="nt">&lt;/div&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO4-1" href="#co_additional_quarkus_features_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Conditional with a numeric type</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO4-2" href="#co_additional_quarkus_features_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Else part</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO4-3" href="#co_additional_quarkus_features_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Conditional with a string type using <code>is</code></p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO4-4" href="#co_additional_quarkus_features_CO4-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Elvis operator; if the parameter is <code>null</code>, the default value is used</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO4-5" href="#co_additional_quarkus_features_CO4-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Iterate over all characters</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO4-6" href="#co_additional_quarkus_features_CO4-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Show the character info</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO4-7" href="#co_additional_quarkus_features_CO4-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p><code>hasNext</code> is a special attribute that checks if there are more elements</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO4-8" href="#co_additional_quarkus_features_CO4-8"><img src="Images/8.png" alt="8" width="12" height="12"/></a></dt>
<dd><p>Method call defined in the POJO; iterates the number of times defined in the call</p></dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>Inside a loop, the following implicit variables can be used: <code>hasNext</code>, <code>count</code>, <code>index</code>, <code>odd</code>, and <code>even</code>.</p>
</div>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>At this time, it is possible to use only <code>Iterable</code>, <code>Map.Entry</code>, <code>Set</code>, <code>Integer</code>, and <code>Stream</code>.</p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.3 Changing the Location of Qute Templates"><div class="sect1" id="idm45128488994552">
<h1>16.3 Changing the Location of Qute Templates</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128488993512">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="location, changing for Qute templates" id="idm45128488992312"/><a data-type="indexterm" data-primary="Qute" data-secondary="changing location for templates" id="idm45128489943912"/>You want to change the location Qute uses to find templates.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128489942600">
<h2>Solution</h2>

<p>You can customize the template location (still within <em>src/main/resources/templates</em> and output to the <em>templates</em> directory in your application deployable) by using the <code>io.quarkus.qute.api.ResourcePath</code> annotation:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ResourcePath</code><code class="o">(</code><code class="s">"movies/detail.html"</code><code class="o">)</code><code> </code><a class="co" id="co_additional_quarkus_features_CO5-1" href="#callout_additional_quarkus_features_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">Template</code><code> </code><code class="n">movies</code><code class="o">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO5-1" href="#co_additional_quarkus_features_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets the path of the template to <em>src/main/resources/templates/movies/detail.html</em></p></dd>
</dl>

<p>Run the application again (or if already running, let live reloading do its job), and then open a browser and enter this URL: 
<span class="orm:hideurl"><a href="http://localhost:8080/movie"><em class="hyperlink">http://localhost:8080/movie</em></a></span>.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.4 Extending Qute Data Classes"><div class="sect1" id="idm45128489351080">
<h1>16.4 Extending Qute Data Classes</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128489350136">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="extensions" id="idm45128489348936"/><a data-type="indexterm" data-primary="Qute" data-secondary="extending data classes" id="idm45128489348232"/>You want to extend the functionality of a Qute data class.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128489346904">
<h2>Solution</h2>

<p>A template extension method must follow the following rules:</p>

<ul>
<li>
<p>Must be static.</p>
</li>
<li>
<p>Must not return void.</p>
</li>
<li>
<p>Must contain at least one parameter. The first parameter is used to match the base data object.</p>
</li>
</ul>
<div data-type="tip"><h6>Tip</h6>
<p>You can use <em>template extensions</em> to add methods specifically for reporting purposes when you do not have access to data object source code.</p>
</div>

<p><a data-type="indexterm" data-primary="@io.quarkus.qute.TemplateExtension annotation" id="idm45128489579560"/><a data-type="indexterm" data-primary="template extension methods" id="idm45128489578888"/>You can implement <em>template extension methods</em> by using the <code>@io.quarkus.qute.TemplateExtension</code> annotation.
In this case, let’s implement a method that rounds the <code>rating</code> number:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@TemplateExtension</code><code>
</code><code class="kd">static</code><code> </code><code class="kt">double</code><code> </code><code class="nf">roundStars</code><code class="o">(</code><code class="n">Movie</code><code> </code><code class="n">movie</code><code class="o">,</code><code> </code><code class="kt">int</code><code> </code><code class="n">decimals</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_additional_quarkus_features_CO6-1" href="#callout_additional_quarkus_features_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code> </code><a class="co" id="co_additional_quarkus_features_CO6-2" href="#callout_additional_quarkus_features_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="kt">double</code><code> </code><code class="n">scale</code><code> </code><code class="o">=</code><code> </code><code class="n">Math</code><code class="o">.</code><code class="na">pow</code><code class="o">(</code><code class="mi">10</code><code class="o">,</code><code> </code><code class="n">decimals</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">Math</code><code class="o">.</code><code class="na">round</code><code class="o">(</code><code class="n">movie</code><code class="o">.</code><code class="na">ratings</code><code> </code><code class="o">*</code><code> </code><code class="n">scale</code><code class="o">)</code><code> </code><code class="o">/</code><code> </code><code class="n">scale</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO6-1" href="#co_additional_quarkus_features_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>First parameter is the POJO data object</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO6-2" href="#co_additional_quarkus_features_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Custom parameters can be set</p></dd>
</dl>

<p>From the template engine, <code>movie</code> has a <code>roundStars</code> method with one argument, which is the number of decimals to round.</p>

<p>In a template you can now call the following:</p>

<pre data-type="programlisting" data-code-language="html"><code>({movie.roundStars(2)}) </code><a class="co" id="co_additional_quarkus_features_CO7-1" href="#callout_additional_quarkus_features_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO7-1" href="#co_additional_quarkus_features_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>Movie</code> class doesn’t define a <code>roundStars</code> method, but it is accessible because it is a template extension</p></dd>
</dl>

<p>Run the application again (or if already running, let live reloading do its job), and then open a browser and enter the URL: <em><a href="http://localhost:8080/movie"><em class="hyperlink">http://localhost:8080/movie</em></a></em>.</p>

<p>The output should be similar to the output shown in <a data-type="xref" href="#htmloutput">Figure 16-1</a>.</p>

<figure><div id="htmloutput" class="figure">
<img src="Images/qucb_1601.png" alt="qucb 1601" width="1440" height="563"/>
<h6><span class="label">Figure 16-1. </span>HTML output</h6>
</div></figure>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.5 Describing Endpoints with OpenAPI"><div class="sect1" id="endpoints_with_openapi">
<h1>16.5 Describing Endpoints with OpenAPI</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128488685480">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="endpoints" data-secondary="describing with OpenAPI" id="idm45128488684472"/><a data-type="indexterm" data-primary="OpenAPI" data-secondary="describing endpoints with" id="idm45128488683624"/>You want to describe your REST API with OpenAPI.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128488682392">
<h2>Solution</h2>

<p>Use the SmallRye OpenAPI extension.</p>

<p>Once you have a RESTful API created with Quarkus, all you need to do is add the <code>openapi</code> extension:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw quarkus:add-extension -Dextensions<code class="o">=</code><code class="s2">"openapi"</code></pre>

<p>Then restart the application for everything to take effect:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw compile quarkus:dev</pre>

<p>The specification of the API is available at <em>/openapi</em> by default.
To change this, use the <code>quarkus.smallrye-openapi.path</code> configuration:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.smallrye-openapi.path</code><code class="o">=</code><code class="s">/rest-api</code></pre>

<p>You can get to the specification at <em><a href="http://localhost:8080/openapi"><em class="hyperlink">http://localhost:8080/openapi</em></a></em>:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nt">openapi</code><code class="p">:</code> <code class="l-Scalar-Plain">3.0.1</code>
<code class="nt">info</code><code class="p">:</code>
  <code class="nt">title</code><code class="p">:</code> <code class="l-Scalar-Plain">Generated API</code>
  <code class="nt">version</code><code class="p">:</code> <code class="s">"1.0"</code>
<code class="nt">paths</code><code class="p">:</code>
  <code class="nt">/task</code><code class="p">:</code>
    <code class="nt">get</code><code class="p">:</code>
      <code class="nt">responses</code><code class="p">:</code>
        <code class="nt">200</code><code class="p">:</code>
          <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">OK</code>
          <code class="nt">content</code><code class="p">:</code>
            <code class="nt">application/json</code><code class="p">:</code>
              <code class="nt">schema</code><code class="p">:</code>
                <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/SetTask'</code>
    <code class="nt">post</code><code class="p">:</code>
      <code class="nt">requestBody</code><code class="p">:</code>
        <code class="nt">content</code><code class="p">:</code>
          <code class="nt">application/json</code><code class="p">:</code>
            <code class="nt">schema</code><code class="p">:</code>
              <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/Task'</code>
      <code class="nt">responses</code><code class="p">:</code>
        <code class="nt">200</code><code class="p">:</code>
          <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">OK</code>
          <code class="nt">content</code><code class="p">:</code>
            <code class="nt">application/json</code><code class="p">:</code>
              <code class="nt">schema</code><code class="p">:</code>
                <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/SetTask'</code>
    <code class="nt">delete</code><code class="p">:</code>
      <code class="nt">requestBody</code><code class="p">:</code>
        <code class="nt">content</code><code class="p">:</code>
          <code class="nt">application/json</code><code class="p">:</code>
            <code class="nt">schema</code><code class="p">:</code>
              <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/Task'</code>
      <code class="nt">responses</code><code class="p">:</code>
        <code class="nt">200</code><code class="p">:</code>
          <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">OK</code>
          <code class="nt">content</code><code class="p">:</code>
            <code class="nt">application/json</code><code class="p">:</code>
              <code class="nt">schema</code><code class="p">:</code>
                <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/SetTask'</code>
<code class="nt">components</code><code class="p">:</code>
  <code class="nt">schemas</code><code class="p">:</code>
    <code class="nt">Task</code><code class="p">:</code>
      <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">object</code>
      <code class="nt">properties</code><code class="p">:</code>
        <code class="nt">complete</code><code class="p">:</code>
          <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">boolean</code>
        <code class="nt">description</code><code class="p">:</code>
          <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">string</code>
        <code class="nt">reminder</code><code class="p">:</code>
          <code class="nt">format</code><code class="p">:</code> <code class="l-Scalar-Plain">date-time</code>
          <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">string</code>
    <code class="nt">SetTask</code><code class="p">:</code>
      <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">array</code>
      <code class="nt">items</code><code class="p">:</code>
        <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">object</code>
        <code class="nt">properties</code><code class="p">:</code>
          <code class="nt">complete</code><code class="p">:</code>
            <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">boolean</code>
          <code class="nt">description</code><code class="p">:</code>
            <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">string</code>
          <code class="nt">reminder</code><code class="p">:</code>
            <code class="nt">format</code><code class="p">:</code> <code class="l-Scalar-Plain">date-time</code>
            <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">string</code></pre>

<p>Based on the previous spec, there are GET, POST, and DELETE endpoints.
You can also see that there is a task object required for DELETE and POST.
The task requires a boolean, string, and a date-time.
This is simple and easy to understand.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128488681800">
<h2>Discussion</h2>

<p>It is very easy to create an OpenAPI specification using the SmallRye OpenAPI extension in Quarkus.
This gives you an easy-to-use and easy-to-read view into your RESTful APIs.</p>

<p>SmallRye OpenAPI is an implementation of the Eclipse MicroProfile OpenAPI.
The OpenAPI Specification is a standard, language-agnostic means of describing and discovering RESTful APIs.
It is readable by both humans and machines.
An OpenAPI document is defined either as JSON or YAML.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128488458312">
<h2>See Also</h2>

<p><a data-type="indexterm" data-primary="Eclipse MicroProfile OpenAPI" id="idm45128488457112"/>For more information, visit the following pages on GitHub:</p>

<ul>
<li>
<p><a href="https://oreil.ly/hczN4">Eclipse MicroProfile OpenAPI</a></p>
</li>
<li>
<p><a href="https://oreil.ly/ufzr6">MicroProfile OpenAPI Specification</a></p>
</li>
<li>
<p><a href="https://oreil.ly/uslyb">OpenAPI Specification</a></p>
</li>
</ul>

<p>In <a data-type="xref" href="#customizing_openapi">Recipe 16.6</a> you will learn how to use the annotations from SmallRye OpenAPI to customize the resulting spec.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.6 Customizing OpenAPI Spec"><div class="sect1" id="customizing_openapi">
<h1>16.6 Customizing OpenAPI Spec</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128488448760">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="OpenAPI" data-secondary="customizing" id="open_cus"/><a data-type="indexterm" data-primary="SmallRye OpenAPI" id="small_ab"/>You want to customize the generated API spec.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128488444984">
<h2>Solution</h2>

<p>Use OpenAPI annotations from the SmallRye OpenAPI extension.</p>

<p>Reusing the task API created in the previous recipe, <a data-type="xref" href="#endpoints_with_openapi">Recipe 16.5</a> it is easy to make use of the OpenAPI annotations to add customizations and further documentation to your API:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">openapi</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.time.LocalDateTime</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.Collections</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.LinkedHashMap</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.Set</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.ws.rs.Consumes</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.DELETE</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.GET</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.POST</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.Path</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.Produces</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">org.eclipse.microprofile.openapi.annotations.Operation</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">org.eclipse.microprofile.openapi.annotations.media.Content</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">org.eclipse.microprofile.openapi.annotations.parameters.Parameter</code><code class="o">;</code>

  <code class="nd">@Path</code><code class="o">(</code><code class="s">"/task"</code><code class="o">)</code>
  <code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code>
  <code class="nd">@Consumes</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code>
  <code class="kd">public</code> <code class="kd">class</code> <code class="nc">TaskResource</code> <code class="o">{</code>

    <code class="n">Set</code><code class="o">&lt;</code><code class="n">Task</code><code class="o">&gt;</code> <code class="n">tasks</code> <code class="o">=</code> <code class="n">Collections</code><code class="o">.</code><code class="na">newSetFromMap</code><code class="o">(</code>
        <code class="n">Collections</code><code class="o">.</code><code class="na">synchronizedMap</code><code class="o">(</code><code class="k">new</code> <code class="n">LinkedHashMap</code><code class="o">&lt;&gt;()));</code>

    <code class="kd">public</code> <code class="nf">TaskResource</code><code class="o">()</code> <code class="o">{</code>
      <code class="n">tasks</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Task</code><code class="o">(</code><code class="s">"First task"</code><code class="o">,</code>
            <code class="n">LocalDateTime</code><code class="o">.</code><code class="na">now</code><code class="o">().</code><code class="na">plusDays</code><code class="o">(</code><code class="mi">3</code><code class="o">),</code> <code class="kc">false</code><code class="o">));</code>
      <code class="n">tasks</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Task</code><code class="o">(</code><code class="s">"Second task"</code><code class="o">,</code>
            <code class="n">LocalDateTime</code><code class="o">.</code><code class="na">now</code><code class="o">().</code><code class="na">plusDays</code><code class="o">(</code><code class="mi">6</code><code class="o">),</code> <code class="kc">false</code><code class="o">));</code>
    <code class="o">}</code>

    <code class="nd">@GET</code>
    <code class="nd">@Operation</code><code class="o">(</code><code class="n">summary</code> <code class="o">=</code> <code class="s">"Get all tasks"</code><code class="o">,</code>
               <code class="n">description</code> <code class="o">=</code> <code class="s">"Get the full list of tasks."</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">Set</code><code class="o">&lt;</code><code class="n">Task</code><code class="o">&gt;</code> <code class="nf">list</code><code class="o">()</code> <code class="o">{</code>
      <code class="k">return</code> <code class="n">tasks</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@POST</code>
    <code class="nd">@Operation</code><code class="o">(</code><code class="n">summary</code> <code class="o">=</code> <code class="s">"Create a new task"</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">Set</code><code class="o">&lt;</code><code class="n">Task</code><code class="o">&gt;</code> <code class="nf">add</code><code class="o">(</code>
        <code class="nd">@Parameter</code><code class="o">(</code><code class="n">required</code> <code class="o">=</code> <code class="kc">true</code><code class="o">,</code> <code class="n">content</code> <code class="o">=</code>
          <code class="nd">@Content</code><code class="o">(</code><code class="n">schema</code> <code class="o">=</code> <code class="nd">@Schema</code><code class="o">(</code><code class="n">implementation</code> <code class="o">=</code> <code class="n">Task</code><code class="o">.</code><code class="na">class</code><code class="o">)))</code> <code class="n">Task</code> <code class="n">task</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">tasks</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">task</code><code class="o">);</code>
      <code class="k">return</code> <code class="n">tasks</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@DELETE</code>
    <code class="nd">@Operation</code><code class="o">(</code><code class="n">summary</code> <code class="o">=</code> <code class="s">"Remove the specified task"</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">Set</code><code class="o">&lt;</code><code class="n">Task</code><code class="o">&gt;</code> <code class="nf">delete</code><code class="o">(</code>
        <code class="nd">@Parameter</code><code class="o">(</code><code class="n">required</code> <code class="o">=</code> <code class="kc">true</code><code class="o">,</code>
        <code class="n">content</code> <code class="o">=</code> <code class="nd">@Content</code><code class="o">(</code><code class="n">schema</code> <code class="o">=</code> <code class="nd">@Schema</code><code class="o">(</code><code class="n">implementation</code> <code class="o">=</code> <code class="n">Task</code><code class="o">.</code><code class="na">class</code><code class="o">)))</code>
        <code class="n">Task</code> <code class="n">task</code><code class="o">)</code> <code class="o">{</code>
      <code class="n">tasks</code><code class="o">.</code><code class="na">removeIf</code><code class="o">(</code><code class="n">existingTask</code> <code class="o">-&gt;</code> <code class="n">existingTask</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">task</code><code class="o">));</code>
      <code class="k">return</code> <code class="n">tasks</code><code class="o">;</code>
    <code class="o">}</code>
  <code class="o">}</code></pre>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">openapi</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.time.LocalDateTime</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.Objects</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.json.bind.annotation.JsonbDateFormat</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">org.eclipse.microprofile.openapi.annotations.enums.SchemaType</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">org.eclipse.microprofile.openapi.annotations.media.Schema</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Task</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="n">String</code> <code class="n">description</code><code class="o">;</code>

    <code class="nd">@Schema</code><code class="o">(</code><code class="n">description</code> <code class="o">=</code> <code class="s">"Flag indicating the task is complete"</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">Boolean</code> <code class="n">complete</code><code class="o">;</code>

    <code class="nd">@JsonbDateFormat</code><code class="o">(</code><code class="s">"yyyy-MM-dd'T'HH:mm"</code><code class="o">)</code>
    <code class="nd">@Schema</code><code class="o">(</code><code class="n">example</code> <code class="o">=</code> <code class="s">"2019-12-25T06:30"</code><code class="o">,</code> <code class="n">type</code> <code class="o">=</code> <code class="n">SchemaType</code><code class="o">.</code><code class="na">STRING</code><code class="o">,</code>
            <code class="n">implementation</code> <code class="o">=</code> <code class="n">LocalDateTime</code><code class="o">.</code><code class="na">class</code><code class="o">,</code>
            <code class="n">pattern</code> <code class="o">=</code> <code class="s">"yyyy-MM-dd'T'HH:mm"</code><code class="o">,</code>
            <code class="n">description</code> <code class="o">=</code> <code class="s">"Date and time for the reminder."</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">LocalDateTime</code> <code class="n">reminder</code><code class="o">;</code>

    <code class="kd">public</code> <code class="nf">Task</code><code class="o">()</code> <code class="o">{</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="nf">Task</code><code class="o">(</code><code class="n">String</code> <code class="n">description</code><code class="o">,</code>
                <code class="n">LocalDateTime</code> <code class="n">reminder</code><code class="o">,</code>
                <code class="n">Boolean</code> <code class="n">complete</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">description</code> <code class="o">=</code> <code class="n">description</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">reminder</code> <code class="o">=</code> <code class="n">reminder</code><code class="o">;</code>
        <code class="k">this</code><code class="o">.</code><code class="na">complete</code> <code class="o">=</code> <code class="n">complete</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">boolean</code> <code class="nf">equals</code><code class="o">(</code><code class="n">Object</code> <code class="n">o</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="k">this</code> <code class="o">==</code> <code class="n">o</code><code class="o">)</code> <code class="k">return</code> <code class="kc">true</code><code class="o">;</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">o</code> <code class="o">==</code> <code class="kc">null</code> <code class="o">||</code> <code class="n">getClass</code><code class="o">()</code> <code class="o">!=</code> <code class="n">o</code><code class="o">.</code><code class="na">getClass</code><code class="o">())</code> <code class="k">return</code> <code class="kc">false</code><code class="o">;</code>
        <code class="n">Task</code> <code class="n">task</code> <code class="o">=</code> <code class="o">(</code><code class="n">Task</code><code class="o">)</code> <code class="n">o</code><code class="o">;</code>
        <code class="k">return</code> <code class="n">Objects</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">description</code><code class="o">,</code> <code class="n">task</code><code class="o">.</code><code class="na">description</code><code class="o">)</code> <code class="o">&amp;&amp;</code>
                <code class="n">Objects</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">reminder</code><code class="o">,</code> <code class="n">task</code><code class="o">.</code><code class="na">reminder</code><code class="o">)</code> <code class="o">&amp;&amp;</code>
                <code class="n">Objects</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">complete</code><code class="o">,</code> <code class="n">task</code><code class="o">.</code><code class="na">complete</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="nd">@Override</code>
    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">hashCode</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">Objects</code><code class="o">.</code><code class="na">hash</code><code class="o">(</code><code class="n">description</code><code class="o">,</code> <code class="n">reminder</code><code class="o">,</code> <code class="n">complete</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>The previous code will create the following spec:</p>

<pre data-type="programlisting" data-code-language="yaml"><code class="nn">---</code>
<code class="nt">openapi</code><code class="p">:</code> <code class="l-Scalar-Plain">3.0.1</code>
<code class="nt">info</code><code class="p">:</code>
  <code class="nt">title</code><code class="p">:</code> <code class="l-Scalar-Plain">Generated API</code>
  <code class="nt">version</code><code class="p">:</code> <code class="s">"1.0"</code>
<code class="nt">paths</code><code class="p">:</code>
  <code class="nt">/task</code><code class="p">:</code>
    <code class="nt">get</code><code class="p">:</code>
      <code class="nt">summary</code><code class="p">:</code> <code class="l-Scalar-Plain">Get all tasks</code>
      <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">Get the full list of tasks.</code>
      <code class="nt">responses</code><code class="p">:</code>
        <code class="nt">200</code><code class="p">:</code>
          <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">OK</code>
          <code class="nt">content</code><code class="p">:</code>
            <code class="nt">application/json</code><code class="p">:</code>
              <code class="nt">schema</code><code class="p">:</code>
                <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/SetTask'</code>
    <code class="nt">post</code><code class="p">:</code>
      <code class="nt">summary</code><code class="p">:</code> <code class="l-Scalar-Plain">Create a new task</code>
      <code class="nt">requestBody</code><code class="p">:</code>
        <code class="nt">content</code><code class="p">:</code>
          <code class="nt">application/json</code><code class="p">:</code>
            <code class="nt">schema</code><code class="p">:</code>
              <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/Task'</code>
      <code class="nt">responses</code><code class="p">:</code>
        <code class="nt">200</code><code class="p">:</code>
          <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">OK</code>
          <code class="nt">content</code><code class="p">:</code>
            <code class="nt">application/json</code><code class="p">:</code>
              <code class="nt">schema</code><code class="p">:</code>
                <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/SetTask'</code>
    <code class="nt">delete</code><code class="p">:</code>
      <code class="nt">summary</code><code class="p">:</code> <code class="l-Scalar-Plain">Remove the specified task</code>
      <code class="nt">requestBody</code><code class="p">:</code>
        <code class="nt">content</code><code class="p">:</code>
          <code class="nt">application/json</code><code class="p">:</code>
            <code class="nt">schema</code><code class="p">:</code>
              <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/Task'</code>
      <code class="nt">responses</code><code class="p">:</code>
        <code class="nt">200</code><code class="p">:</code>
          <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">OK</code>
          <code class="nt">content</code><code class="p">:</code>
            <code class="nt">application/json</code><code class="p">:</code>
              <code class="nt">schema</code><code class="p">:</code>
                <code class="nt">$ref</code><code class="p">:</code> <code class="s">'#/components/schemas/SetTask'</code>
<code class="nt">components</code><code class="p">:</code>
  <code class="nt">schemas</code><code class="p">:</code>
    <code class="nt">Task</code><code class="p">:</code>
      <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">object</code>
      <code class="nt">properties</code><code class="p">:</code>
        <code class="nt">complete</code><code class="p">:</code>
          <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">Flag indicating the task is complete</code>
          <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">boolean</code>
        <code class="nt">description</code><code class="p">:</code>
          <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">string</code>
        <code class="nt">reminder</code><code class="p">:</code>
          <code class="nt">format</code><code class="p">:</code> <code class="l-Scalar-Plain">date-time</code>
          <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">Date and time for the reminder.</code>
          <code class="nt">pattern</code><code class="p">:</code> <code class="l-Scalar-Plain">yyyy-MM-dd'T'HH:mm</code>
          <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">string</code>
          <code class="nt">example</code><code class="p">:</code> <code class="l-Scalar-Plain">2019-12-25T06:30</code>
    <code class="nt">SetTask</code><code class="p">:</code>
      <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">array</code>
      <code class="nt">items</code><code class="p">:</code>
        <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">object</code>
        <code class="nt">properties</code><code class="p">:</code>
          <code class="nt">complete</code><code class="p">:</code>
            <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">Flag indicating the task is complete</code>
            <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">boolean</code>
          <code class="nt">description</code><code class="p">:</code>
            <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">string</code>
          <code class="nt">reminder</code><code class="p">:</code>
            <code class="nt">format</code><code class="p">:</code> <code class="l-Scalar-Plain">date-time</code>
            <code class="nt">description</code><code class="p">:</code> <code class="l-Scalar-Plain">Date and time for the reminder.</code>
            <code class="nt">pattern</code><code class="p">:</code> <code class="l-Scalar-Plain">yyyy-MM-dd'T'HH:mm</code>
            <code class="nt">type</code><code class="p">:</code> <code class="l-Scalar-Plain">string</code>
            <code class="nt">example</code><code class="p">:</code> <code class="l-Scalar-Plain">2019-12-25T06:30</code></pre>

<p>Based on the previous spec, there are GET, POST, and DELETE endpoints.
You can also see that there is a task object required for DELETE and POST.
The task requires a boolean, string, and a date-time.
This is simple and easy to understand.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128487715992">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="OpenAPI" data-secondary="annotations" id="idm45128487714952"/>Various OpenAPI annotations are used to provide additional information about the API, including descriptions, summaries, and examples.
More information can be found about these annotations in the spec and at the links in the “See Also” section.</p>

<p>Further customization of the generated OpenAPI specification is very easy 
<span class="keep-together">with Quarkus.</span>
For ultimate customization, Quarkus supports serving a static file 
<span class="keep-together">OpenAPI spec.</span>
To do this, you need to place your valid OpenAPI spec file at 
<span class="keep-together"><em>META-INF/openapi.yml</em></span> or at <em>META-INF/openapi.json</em>.
Quarkus will then combine 
<span class="keep-together">the two and</span> serve a combined static and dynamic spec.
To disable the dynamic spec 
<span class="keep-together">generation,</span> just use the <code>mp.openapi.scan.disable=true</code> configuration in the 
<span class="keep-together"><em>applications.properties</em></span> file.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128487521208">
<h2>See Also</h2>

<p><a data-type="indexterm" data-primary="Eclipse MicroProfile OpenAPI" id="idm45128487520008"/><a data-type="indexterm" data-primary="" data-startref="open_cus" id="idm45128487519288"/><a data-type="indexterm" data-primary="" data-startref="small_ab" id="idm45128487518344"/>For more information, visit the following pages on GitHub:</p>

<ul>
<li>
<p><a href="https://oreil.ly/i47k_">Eclipse MicroProfile OpenAPI Specification</a></p>
</li>
<li>
<p><a href="https://oreil.ly/ITXQz">Eclipse MicroProfile OpenAPI: Annotation Samples</a></p>
</li>
<li>
<p><a href="https://oreil.ly/ol6nb">Swagger 2.X Annotations: OpenAPI Annotations</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.7 Sending Email Synchronously"><div class="sect1" id="email_synchronously">
<h1>16.7 Sending Email Synchronously</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128487511224">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="email" id="email_ab"/>You want to synchronously send an email.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128487508664">
<h2>Solution</h2>

<p>Make use of the Quarkus mailer extension.</p>

<p>Quarkus makes it very intuitive to send emails in both plain text and HTML, and to add attachments.
There is also an easy-to-use method for testing whether emails have been properly sent without having to setup your own relay.
Add the Email Quarkus extension to an existing project:</p>

<pre data-type="programlisting" data-code-language="bash">mvn quarkus:add-extensions -Dextensions<code class="o">=</code><code class="s2">"mailer"</code></pre>

<p>Quarkus uses the Vert.x Mail client, though there are two wrappers for ease of use:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Inject</code>
<code class="n">Mailer</code> <code class="n">mailer</code><code class="o">;</code>

<code class="nd">@Inject</code>
<code class="n">ReactiveMailer</code> <code class="n">reactiveMailer</code><code class="o">;</code></pre>

<p><a data-type="indexterm" data-primary="withText method" id="idm45128487497320"/><a data-type="indexterm" data-primary="withHtml method" id="idm45128487454440"/><a data-type="indexterm" data-primary="Mailer class" id="idm45128487453832"/>The <code>Mailer</code> class uses standard blocking and synchronous API calls, and the <code>ReactiveMailer</code>, as expected, uses nonblocking and asynchronous API calls.
The <code>ReactiveMailer</code> will be discussed in the following recipe; both classes offer the same features.
To send an email, simply use the <code>withText</code> or <code>withHtml</code> methods.
You will need to supply a recipient, a subject, and a body.
If you need to add things such as CC, BCC, and attachments, you can do so on the actual <code>Mail</code> instance.</p>

<p>You will also need to configure the SMTP provider (in this case, we’re using Gmail TLS):</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.mailer.from</code><code class="o">=</code><code class="s">quarkus-test@gmail.com</code><code>
</code><code class="na">quarkus.mailer.host</code><code class="o">=</code><code class="s">smtp.gmail.com</code><code>
</code><code class="na">quarkus.mailer.port</code><code class="o">=</code><code class="s">587</code><code>
</code><code class="na">quarkus.mailer.start-tls</code><code class="o">=</code><code class="s">REQUIRED</code><code>

</code><a class="co" id="co_additional_quarkus_features_CO8-1" href="#callout_additional_quarkus_features_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="na">quarkus.mailer.username</code><code class="o">=</code><code class="s">YOUREMAIL@gmail.com</code><code>
</code><code class="na">quarkus.mailer.password</code><code class="o">=</code><code class="s">YOURGENERATEDAPPLICATIONPASSWORD</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO8-1" href="#co_additional_quarkus_features_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>These can also be set with system properties and/or environment properties</p></dd>
</dl>

<p>Testing of the email component is done easily by making use of the <code>MockMailbox</code> component.
It is a simple component consisting of three methods:</p>

<ul>
<li>
<p><code>getMessagesSentTo</code></p>
</li>
<li>
<p><code>clear</code></p>
</li>
<li>
<p><code>getTotalMessagesSent</code></p>
</li>
</ul>

<p>The following test demonstrates all three of these methods:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">email</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.List</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.inject.Inject</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.mailer.Mail</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.mailer.Mailer</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.mailer.MockMailbox</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.junit.QuarkusTest</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.junit.jupiter.api.BeforeEach</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.junit.jupiter.api.Test</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">assertj</code><code class="o">.</code><code class="na">core</code><code class="o">.</code><code class="na">api</code><code class="o">.</code><code class="na">Assertions</code><code class="o">.</code><code class="na">assertThat</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@QuarkusTest</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">MailerTest</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="nd">@Inject</code><code>
</code><code>    </code><code class="n">Mailer</code><code> </code><code class="n">mailer</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="nd">@Inject</code><code>
</code><code>    </code><code class="n">MockMailbox</code><code> </code><code class="n">mbox</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="nd">@BeforeEach</code><code>
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">clearMBox</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">mbox</code><code class="o">.</code><code class="na">clear</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_additional_quarkus_features_CO9-1" href="#callout_additional_quarkus_features_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Test</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">assertBasicTextEmailSent</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">mailTo</code><code> </code><code class="o">=</code><code> </code><code class="s">"test@example.org"</code><code class="o">;</code><code>
</code><code>        </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">testingSubject</code><code> </code><code class="o">=</code><code> </code><code class="s">"Testing email"</code><code class="o">;</code><code>
</code><code>        </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">testingBody</code><code> </code><code class="o">=</code><code> </code><code class="s">"Hello World!"</code><code class="o">;</code><code>
</code><code>
</code><code>        </code><code class="n">mailer</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Mail</code><code class="o">.</code><code class="na">withText</code><code class="o">(</code><code class="n">mailTo</code><code class="o">,</code><code>
</code><code>                </code><code class="n">testingSubject</code><code class="o">,</code><code>
</code><code>                </code><code class="n">testingBody</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">mbox</code><code class="o">.</code><code class="na">getTotalMessagesSent</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_additional_quarkus_features_CO9-2" href="#callout_additional_quarkus_features_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">List</code><code class="o">&lt;</code><code class="n">Mail</code><code class="o">&gt;</code><code> </code><code class="n">emails</code><code> </code><code class="o">=</code><code> </code><code class="n">mbox</code><code class="o">.</code><code class="na">getMessagesSentTo</code><code class="o">(</code><code class="n">mailTo</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_additional_quarkus_features_CO9-3" href="#callout_additional_quarkus_features_CO9-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">emails</code><code class="o">)</code><code class="o">.</code><code class="na">hasSize</code><code class="o">(</code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">Mail</code><code> </code><code class="n">email</code><code> </code><code class="o">=</code><code> </code><code class="n">emails</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">email</code><code class="o">.</code><code class="na">getSubject</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">testingSubject</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">email</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">testingBody</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO9-1" href="#co_additional_quarkus_features_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>We clear out the mailbox before the start of each test</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO9-2" href="#co_additional_quarkus_features_CO9-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Use <code>getTotalMessagesSent</code> to verify how many messages Quarkus sent out</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO9-3" href="#co_additional_quarkus_features_CO9-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Verify the messages sent to a particular address</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128487508072">
<h2>Discussion</h2>

<p>Both regular attachments and inline attachments are supported.
Here is a simple example of an inline attachment:</p>

<pre data-type="programlisting" data-code-language="java"><code>    </code><code class="nd">@Test</code><code>
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">attachmentTest</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">Exception</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">mailTo</code><code> </code><code class="o">=</code><code> </code><code class="s">"test@example.org"</code><code class="o">;</code><code>
</code><code>        </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">testingSubject</code><code> </code><code class="o">=</code><code> </code><code class="s">"email with Attachment"</code><code class="o">;</code><code>
</code><code>        </code><code class="kd">final</code><code> </code><code class="n">String</code><code> </code><code class="n">html</code><code> </code><code class="o">=</code><code> </code><code class="s">"&lt;strong&gt;E-mail by:&lt;/strong&gt;"</code><code> </code><code class="o">+</code><code> </code><code class="s">"\n"</code><code> </code><code class="o">+</code><code>
</code><code>                </code><code class="s">"&lt;p&gt;&lt;img src=\"cid:logo@quarkus.io\"/&gt;&lt;/p&gt;"</code><code class="o">;</code><code>    </code><a class="co" id="co_additional_quarkus_features_CO10-1" href="#callout_additional_quarkus_features_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code>        </code><code class="n">sendEmail</code><code class="o">(</code><code class="n">mailTo</code><code class="o">,</code><code> </code><code class="n">testingSubject</code><code class="o">,</code><code> </code><code class="n">html</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>        </code><code class="n">Mail</code><code> </code><code class="n">email</code><code> </code><code class="o">=</code><code> </code><code class="n">mbox</code><code class="o">.</code><code class="na">getMessagesSentTo</code><code class="o">(</code><code class="n">mailTo</code><code class="o">)</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">List</code><code class="o">&lt;</code><code class="n">Attachment</code><code class="o">&gt;</code><code> </code><code class="n">attachments</code><code> </code><code class="o">=</code><code> </code><code class="n">email</code><code class="o">.</code><code class="na">getAttachments</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">email</code><code class="o">.</code><code class="na">getHtml</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">html</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">attachments</code><code class="o">)</code><code class="o">.</code><code class="na">hasSize</code><code class="o">(</code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">attachments</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">)</code><code class="o">.</code><code class="na">getFile</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code>
</code><code>                </code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="n">getAttachmentURI</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="kt">void</code><code> </code><code class="nf">sendEmail</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">to</code><code class="o">,</code><code> </code><code class="n">String</code><code> </code><code class="n">subject</code><code class="o">,</code><code> </code><code class="n">String</code><code> </code><code class="n">body</code><code class="o">)</code><code>
</code><code>          </code><code class="kd">throws</code><code> </code><code class="n">URISyntaxException</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="kd">final</code><code> </code><code class="n">File</code><code> </code><code class="n">logo</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="n">getAttachmentURI</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>        </code><code class="n">Mail</code><code> </code><code class="n">email</code><code> </code><code class="o">=</code><code> </code><code class="n">Mail</code><code class="o">.</code><code class="na">withHtml</code><code class="o">(</code><code class="n">to</code><code class="o">,</code><code> </code><code class="n">subject</code><code class="o">,</code><code> </code><code class="n">body</code><code class="o">)</code><code>
</code><code>                </code><code class="o">.</code><code class="na">addInlineAttachment</code><code class="o">(</code><code class="s">"quarkus-logo.svg"</code><code class="o">,</code><code>
</code><code>                        </code><code class="n">logo</code><code class="o">,</code><code>
</code><code>                        </code><code class="s">"image/svg+xml"</code><code class="o">,</code><code>
</code><code>                        </code><code class="s">"&lt;logo@quarkus.io&gt;"</code><code class="o">)</code><code class="o">;</code><code>   </code><a class="co" id="co_additional_quarkus_features_CO10-2" href="#callout_additional_quarkus_features_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>        </code><code class="n">mailer</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">email</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO10-1" href="#co_additional_quarkus_features_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Be sure to reference the inline attachment by the <code>content-id</code></p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO10-2" href="#co_additional_quarkus_features_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The <code>content-id</code> of the attachment</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128487292648">
<h2>See Also</h2>

<p>For more information, see the following:</p>

<ul>
<li>
<p><a data-type="xref" href="#email_reactively">Recipe 16.8</a></p>
</li>
<li>
<p><a href="https://oreil.ly/aqGZU">Vert.x Mail client (SMTP client implementation)</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.8 Sending Email Reactively"><div class="sect1" id="email_reactively">
<h1>16.8 Sending Email Reactively</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128487278184">
<h2>Problem</h2>

<p>You want to send an email in a nonblocking, reactive fashion.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128486823432">
<h2>Solution</h2>

<p>Make use of the Quarkus mailer extension.</p>

<p>The previous section details the basics.
To do this reactively, simply inject the <code>ReactiveMailer</code> component and use it instead.
The methods are the same; they simply return reactive counterparts instead of synchronous ones:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">email</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.util.List</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.concurrent.CountDownLatch</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.inject.Inject</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">io.quarkus.mailer.Mail</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">io.quarkus.mailer.MockMailbox</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">io.quarkus.mailer.reactive.ReactiveMailer</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">io.quarkus.test.junit.QuarkusTest</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">org.junit.jupiter.api.BeforeEach</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">org.junit.jupiter.api.Test</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">static</code> <code class="n">org</code><code class="o">.</code><code class="na">assertj</code><code class="o">.</code><code class="na">core</code><code class="o">.</code><code class="na">api</code><code class="o">.</code><code class="na">Assertions</code><code class="o">.</code><code class="na">assertThat</code><code class="o">;</code>

<code class="nd">@QuarkusTest</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">ReactiveMailerTest</code> <code class="o">{</code>
    <code class="nd">@Inject</code>
    <code class="n">ReactiveMailer</code> <code class="n">reactiveMailer</code><code class="o">;</code>

    <code class="nd">@Inject</code>
    <code class="n">MockMailbox</code> <code class="n">mbox</code><code class="o">;</code>

    <code class="nd">@BeforeEach</code>
    <code class="kt">void</code> <code class="nf">clearMbox</code><code class="o">()</code> <code class="o">{</code>
        <code class="n">mbox</code><code class="o">.</code><code class="na">clear</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="nd">@Test</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">testReactiveEmail</code><code class="o">()</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>
        <code class="kd">final</code> <code class="n">String</code> <code class="n">mailTo</code> <code class="o">=</code> <code class="s">"test@example.org"</code><code class="o">;</code>
        <code class="kd">final</code> <code class="n">String</code> <code class="n">testingSubject</code> <code class="o">=</code> <code class="s">"Testing email"</code><code class="o">;</code>
        <code class="kd">final</code> <code class="n">String</code> <code class="n">testingBody</code> <code class="o">=</code> <code class="s">"Hello World!"</code><code class="o">;</code>
        <code class="kd">final</code> <code class="n">CountDownLatch</code> <code class="n">latch</code> <code class="o">=</code> <code class="k">new</code> <code class="n">CountDownLatch</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>

        <code class="n">reactiveMailer</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Mail</code><code class="o">.</code><code class="na">withText</code><code class="o">(</code><code class="n">mailTo</code><code class="o">,</code>
                <code class="n">testingSubject</code><code class="o">,</code>
                <code class="n">testingBody</code><code class="o">)).</code><code class="na">subscribeAsCompletionStage</code><code class="o">().</code><code class="na">join</code><code class="o">();</code>

        <code class="n">assertThat</code><code class="o">(</code><code class="n">mbox</code><code class="o">.</code><code class="na">getTotalMessagesSent</code><code class="o">()).</code><code class="na">isEqualTo</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>
        <code class="n">List</code><code class="o">&lt;</code><code class="n">Mail</code><code class="o">&gt;</code> <code class="n">emails</code> <code class="o">=</code> <code class="n">mbox</code><code class="o">.</code><code class="na">getMessagesSentTo</code><code class="o">(</code><code class="n">mailTo</code><code class="o">);</code>

        <code class="n">assertThat</code><code class="o">(</code><code class="n">emails</code><code class="o">).</code><code class="na">hasSize</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>
        <code class="n">Mail</code> <code class="n">email</code> <code class="o">=</code> <code class="n">emails</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">0</code><code class="o">);</code>

        <code class="n">assertThat</code><code class="o">(</code><code class="n">email</code><code class="o">.</code><code class="na">getSubject</code><code class="o">()).</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">testingSubject</code><code class="o">);</code>
        <code class="n">assertThat</code><code class="o">(</code><code class="n">email</code><code class="o">.</code><code class="na">getText</code><code class="o">()).</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">testingBody</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This test is exactly the same as the one in the previous section; the only difference is turning the <code>CompletionStage</code> to a <code>CompletableFuture</code> and calling <code>join</code> to get back to an imperative style for the test.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128486816520">
<h2>Discussion</h2>

<p>Qute integrates with Mailer extension so the body content of the message is rendered from a template.</p>

<p>You need only the <code>qute</code> extension this time because no RESTEasy integration is required:</p>

<pre data-type="programlisting" data-code-language="bash">mvn quarkus:add-extensions -Dextensions<code class="o">=</code><code class="s2">"quarkus-qute"</code></pre>

<p>The main class is the <code>io.quarkus.mailer.MailTemplate</code>, and it is used in the same way as the <code>io.quarkus.qute.Template</code>, but the first one contains methods that are specific to mail logic:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ResourcePath</code><code class="o">(</code><code class="s">"mail/welcome.txt"</code><code class="o">)</code><code> </code><a class="co" id="co_additional_quarkus_features_CO11-1" href="#callout_additional_quarkus_features_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="n">MailTemplate</code><code> </code><code class="n">mailTemplate</code><code class="o">;</code><code>
</code><code>
</code><code class="n">CompletionStage</code><code class="o">&lt;</code><code class="n">Void</code><code class="o">&gt;</code><code> </code><code class="n">c</code><code> </code><code class="o">=</code><code> </code><code class="n">hello</code><code class="o">.</code><code class="na">to</code><code class="o">(</code><code class="s">"to@acme.org"</code><code class="o">)</code><code>
</code><code>     </code><code class="o">.</code><code class="na">subject</code><code class="o">(</code><code class="s">"Hello from Qute template"</code><code class="o">)</code><code>
</code><code>     </code><code class="o">.</code><code class="na">data</code><code class="o">(</code><code class="s">"name"</code><code class="o">,</code><code> </code><code class="s">"Alex"</code><code class="o">)</code><code>
</code><code>     </code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_additional_quarkus_features_CO11-2" href="#callout_additional_quarkus_features_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO11-1" href="#co_additional_quarkus_features_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Template placed at <em>src/main/resources/templates/mail/welcome.txt</em></p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO11-2" href="#co_additional_quarkus_features_CO11-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Sends the email rendering the body from the template file with provided data</p></dd>
</dl>

<p>The reactive way of sending emails follows the exact same method names and usage, instead using reactive classes.
This makes it very easy to switch and understand.<a data-type="indexterm" data-primary="" data-startref="email_ab" id="idm45128486550824"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128486549720">
<h2>See Also</h2>

<p>For more information, see the following:</p>

<ul>
<li>
<p><a data-type="xref" href="#email_synchronously">Recipe 16.7</a></p>
</li>
<li>
<p><a data-type="xref" href="#templates_qute_template">Recipe 16.1</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.9 Creating Scheduled Jobs"><div class="sect1" id="idm45128486527080">
<h1>16.9 Creating Scheduled Jobs</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128486525864">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="scheduled jobs, creating" id="idm45128486524632"/>You want some tasks to run on a schedule.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128486523576">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="Quartz" id="idm45128486522168"/>Scheduling tasks in Quarkus is fast and easy yet provides a high level of control and customization.
Quarkus has a <code>scheduler</code> extension that integrates with Quartz.</p>

<p>Creating scheduled jobs is very easy: simply add the <code>@io.quarkus.scheduler.Scheduled</code> annotation to an application-scoped bean.
There are two attributes available for specifying the schedule for the task: <code>cron</code> and <code>every</code>.</p>

<p>The <code>cron</code> attribute uses the Quartz cron syntax.
If you are not familiar with Quartz, please note that there are some differences to standard cron syntax.
You can learn more about this at the link in <a data-type="xref" href="#scheduled_jobs_see_also">“See Also”</a>.</p>

<p>The <code>every</code> attribute is probably the easiest to use, though it has some nuances.
<code>every</code> parses the string using <code>Duration#parse</code>.
If the expression starts with a digit, the <code>PT</code> prefix is automatically added.</p>

<p>Both <code>every</code> and <code>cron</code> will do a config look up for an expression started with <code>{</code> and ended with <code>}</code>.</p>

<p>There is a <code>delay</code> attribute that takes a long, and there is a <code>delayUnit</code> attribute that takes a <code>TimeUnit</code>.
Used together, these will specify a delay, after which the trigger is started.
By default, the trigger starts when it is registered.</p>

<p>Here is a demonstration of a very simple usage:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">scheduling</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.util.concurrent.atomic.AtomicInteger</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">io.quarkus.scheduler.Scheduled</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">io.quarkus.scheduler.ScheduledExecution</code><code class="o">;</code>

<code class="nd">@ApplicationScoped</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Scheduler</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="n">AtomicInteger</code> <code class="n">count</code> <code class="o">=</code> <code class="k">new</code> <code class="n">AtomicInteger</code><code class="o">();</code>

    <code class="kt">int</code> <code class="nf">get</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">count</code><code class="o">.</code><code class="na">get</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="nd">@Scheduled</code><code class="o">(</code><code class="n">every</code> <code class="o">=</code> <code class="s">"5s"</code><code class="o">)</code>
    <code class="kt">void</code> <code class="nf">fiveSeconds</code><code class="o">(</code><code class="n">ScheduledExecution</code> <code class="n">execution</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">count</code><code class="o">.</code><code class="na">incrementAndGet</code><code class="o">();</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Running counter: 'fiveSeconds'. Next fire: "</code>
                <code class="o">+</code> <code class="n">execution</code><code class="o">.</code><code class="na">getTrigger</code><code class="o">().</code><code class="na">getNextFireTime</code><code class="o">());</code>
    <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128486508088">
<h2>Discussion</h2>

<p>Qute can be used to periodically generate reports.</p>

<p>You need only the <code>qute</code> extension because no RESTEasy integration is required:</p>

<pre data-type="programlisting" data-code-language="bash">mvn quarkus:add-extensions -Dextensions<code class="o">=</code><code class="s2">"quarkus-qute"</code></pre>

<p>Now the <code>render()</code> method must be called manually to get the result:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ResourcePath</code><code class="o">(</code><code class="s">"reports/report_01.html"</code><code class="o">)</code>
<code class="n">Template</code> <code class="n">report</code><code class="o">;</code>

<code class="nd">@Scheduled</code><code class="o">(</code><code class="n">cron</code><code class="o">=</code><code class="s">"0 30 * * * ?"</code><code class="o">)</code>
<code class="kt">void</code> <code class="nf">generate</code><code class="o">()</code> <code class="o">{</code>
    <code class="kd">final</code> <code class="n">String</code> <code class="n">reportContent</code> <code class="o">=</code> <code class="n">report</code>
        <code class="o">.</code><code class="na">data</code><code class="o">(</code><code class="s">"sales"</code><code class="o">,</code> <code class="n">listOfSales</code><code class="o">)</code>
        <code class="o">.</code><code class="na">data</code><code class="o">(</code><code class="s">"now"</code><code class="o">,</code> <code class="n">java</code><code class="o">.</code><code class="na">time</code><code class="o">.</code><code class="na">LocalDateTime</code><code class="o">.</code><code class="na">now</code><code class="o">())</code>
        <code class="o">.</code><code class="na">render</code><code class="o">();</code>
    <code class="n">Files</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">reportOuput</code><code class="o">,</code> <code class="n">reportContent</code><code class="o">.</code><code class="na">getBytes</code><code class="o">());</code>
<code class="o">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="scheduled_jobs_see_also">
<h2>See Also</h2>

<p>For more information, see the following:</p>

<ul>
<li>
<p><a href="https://oreil.ly/XdQ7r">Quartz: Cron Trigger Tutorial</a></p>
</li>
<li>
<p><a data-type="xref" href="#templates_qute_template">Recipe 16.1</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="16.10 Using Application Data Caching"><div class="sect1" id="idm45128486149736">
<h1>16.10 Using Application Data Caching</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128486148760">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="applications" data-secondary="data caching" id="app_dc"/>You want to avoid waiting time when methods take a long time to respond.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128486145928">
<h2>Solution</h2>

<p>Use application data caching.</p>

<p>There are some cases in which a method might take more time than expected to respond, maybe because it is making a request to an external system or because the logic being executed takes a long time to execute.</p>

<p>One way to improve this situation is by using application data caches.
The idea is to save the result of a method call so that further calls with the same <em>inputs</em>  to that method return the previously calculated result.</p>

<p>Quarkus integrates with <a href="https://oreil.ly/1NjlX">Caffeine</a> as a caching provider.</p>

<p>To start using application data caching, add the <code>cache</code> extension:</p>

<pre data-type="programlisting" data-code-language="bash">./mvnw quarkus:add-extension -Dextensions<code class="o">=</code><code class="s2">"cache"</code></pre>

<p>Here is a method that simulates a long execution time:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@GET</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">hello</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="kt">long</code><code> </code><code class="n">initial</code><code> </code><code class="o">=</code><code> </code><code class="n">System</code><code class="o">.</code><code class="na">currentTimeMillis</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">String</code><code> </code><code class="n">msg</code><code> </code><code class="o">=</code><code> </code><code class="n">greetingProducer</code><code class="o">.</code><code class="na">getMessage</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_additional_quarkus_features_CO12-1" href="#callout_additional_quarkus_features_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="kt">long</code><code> </code><code class="n">end</code><code> </code><code class="o">=</code><code> </code><code class="n">System</code><code class="o">.</code><code class="na">currentTimeMillis</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">msg</code><code> </code><code class="o">+</code><code> </code><code class="s">" "</code><code> </code><code class="o">+</code><code> </code><code class="o">(</code><code class="n">end</code><code> </code><code class="o">-</code><code> </code><code class="n">initial</code><code class="o">)</code><code> </code><code class="o">+</code><code> </code><code class="s">"ms"</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO12-1" href="#co_additional_quarkus_features_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>This logic has a random sleep time</p></dd>
</dl>

<p>If you run the project, you’ll be able to see this delay:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw compile quarkus:dev</code>

<code class="go">curl http://localhost:8080/hello</code>
<code class="go">Hello World 4009ms</code>

<code class="go">curl http://localhost:8080/hello</code>
<code class="go">Hello World 3003ms</code></pre>

<p>Let’s cache the <code>getMessage()</code> method call by using the <code>@io.quarkus.cache.CacheResult</code> annotation:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@CacheResult</code><code class="o">(</code><code class="n">cacheName</code><code> </code><code class="o">=</code><code> </code><code class="s">"greeting-cache"</code><code class="o">)</code><code> </code><a class="co" id="co_additional_quarkus_features_CO13-1" href="#callout_additional_quarkus_features_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getMessage</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="k">try</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">TimeUnit</code><code class="o">.</code><code class="na">SECONDS</code><code class="o">.</code><code class="na">sleep</code><code class="o">(</code><code class="n">random</code><code class="o">.</code><code class="na">nextInt</code><code class="o">(</code><code class="mi">4</code><code class="o">)</code><code> </code><code class="o">+</code><code> </code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="s">"Hello World"</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code> </code><code class="k">catch</code><code> </code><code class="o">(</code><code class="n">InterruptedException</code><code> </code><code class="n">e</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nf">IllegalStateException</code><code class="o">(</code><code class="n">e</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO13-1" href="#co_additional_quarkus_features_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Creates a new cache for this method call</p></dd>
</dl>

<p>Run the application again (or if it is already running, let live reloading do its job) and repeat the calls to <em><a href="http://localhost:8080/hello"><em class="hyperlink">http://localhost:8080/hello</em></a></em>:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello</code>
<code class="go">Hello World 2004ms</code>

<code class="go">curl http://localhost:8080/hello</code>
<code class="go">Hello World 0ms</code></pre>

<p>The second time the method is called, the method is never invoked but is returned from the cache.
Quarkus computes for every call a cache key and checks for a hit in the cache system.</p>

<p>To calculate the cache key, Quarkus uses all argument values by default.
If there are no argument methods, the key is derived from the cache name.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128486145336">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="@io.quarkus.cache.CacheKey annotation" id="idm45128485941400"/>The <code>@io.quarkus.cache.CacheKey</code> annotation can be used in method arguments to specify exactly which arguments must be used for cache key calculation—for example the <code>public String myMethod(@CacheKey String keyElement1, String notPartOfTheKey)</code>.</p>
<div data-type="important"><h6>Important</h6>
<p>The @io.quarkus.cache.CacheKey annotation cannot be used on a method returning <code>void</code>.</p>
</div>

<p>The <code>@io.quarkus.cache.CacheInvalidate</code> annotation can be used to invalidate an entry from the cache.
When a method annotated with <code>@CacheInvalidate</code> is invoked, the cache key is calculated and used to remove an existing entry from the cache.</p>

<p>The <code>@io.quarkus.cache.CacheInvalidateAll</code> annotation is used to invalidate all cache entries.</p>

<p>Each of the data caching options can be configured individually in the <em>application.properties</em> file:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.cache.caffeine."greeting-cache".initial-capacity</code><code class="o">=</code><code class="s">10 </code><a class="co" id="co_additional_quarkus_features_CO14-1" href="#callout_additional_quarkus_features_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="na">quarkus.cache.caffeine."greeting-cache".expire-after-write</code><code class="o">=</code><code class="s">5S </code><a class="co" id="co_additional_quarkus_features_CO14-2" href="#callout_additional_quarkus_features_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_additional_quarkus_features_CO14-1" href="#co_additional_quarkus_features_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Minimum total size for the internal data structures of the <code>greeting-cache</code> cache</p></dd>
<dt><a class="co" id="callout_additional_quarkus_features_CO14-2" href="#co_additional_quarkus_features_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Sets the expiration time, counting after the write operation of <code>greeting-cache</code> cache</p></dd>
</dl>

<p>Run the application again (or if it is already running, let live reloading do its job) and repeat the calls to <em><a href="http://localhost:8080/hello"><em class="hyperlink">http://localhost:8080/hello</em></a></em>:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl http://localhost:8080/hello</code>
<code class="go">Hello World 2004ms</code>

<code class="go">curl http://localhost:8080/hello</code>
<code class="go">Hello World 0ms</code>

<code class="go">// Wait 5 seconds</code>

<code class="go">curl http://localhost:8080/hello</code>
<code class="go">Hello World 1011ms</code></pre>
<div data-type="tip"><h6>Tip</h6>
<p>The <code>quarkus.cache.caffeine."greeting-cache".expire-after-access</code> property can be used to set the expiration time of the cache to an amount of time after the most recent read or write of the cache value.<a data-type="indexterm" data-primary="" data-startref="feat_ch" id="idm45128485789032"/><a data-type="indexterm" data-primary="" data-startref="app_dc" id="idm45128485788088"/></p>
</div>
</div></section>





</div></section>







</div></section></div>



  </body></html>