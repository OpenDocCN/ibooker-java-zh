<html><head></head><body><section data-pdf-bookmark="Chapter 8. Object-Oriented Techniques" data-type="chapter" epub:type="chapter"><div class="chapter" id="javacook-oo">&#13;
<h1><span class="label">Chapter 8. </span>Object-Oriented Techniques</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.0 Introduction" data-type="sect1"><div class="sect1" id="javacook-oo-intro">&#13;
<h1>8.0 Introduction</h1>&#13;
&#13;
<p><a data-primary="object-oriented programming" data-type="indexterm" id="oop_ch"/><a data-primary="Java" data-secondary="object-oriented programming in" data-type="indexterm" id="ja_oop"/><a data-primary="object-oriented programming" data-secondary="in Java" data-type="indexterm" id="oop_ja"/>Java is an Object-Oriented (OO) language in the tradition of Simula-67, SmallTalk, and C++. It borrows syntax from C++ and ideas from SmallTalk. The Java API has been designed and built on the OO model. Design patterns (see the book of the same name), such as Factory and Delegate, are used throughout; an understanding of these patterns will help you better understand the use of the API and improve the design of your own classes.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Advice, or Mantras" data-type="sect2"><div class="sect2" id="javacook-oo-intro-3">&#13;
<h2>Advice, or Mantras</h2>&#13;
&#13;
<p>There are any number of short bits of advice that I could give. A few recurring themes arise when learning the basics of Java, and I suggest reviewing them when learning more Java.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use the API" data-type="sect3"><div class="sect3" id="javacook-oo-intro-4">&#13;
<h3>Use the API</h3>&#13;
&#13;
<p>I can’t say this often enough. A lot  of the things you need to do have already been done&#13;
by the good folks who develop the standard Java library (and third-party libraries).&#13;
And this grows with every release.  Learning the API well is a good grounds for avoiding that deadly “reinventing the flat tire” syndrome—coming up with a second-rate equivalent of a&#13;
first-rate product that was available to you the whole time. In fact, part of this book’s&#13;
mission is to prevent you from reinventing what’s already there. One example of this is&#13;
the <a data-primary="Collections API" data-type="indexterm" id="idm45290665068408"/>Collections API in <code>java.util</code>, discussed in <a data-type="xref" href="ch07.html#javacook-structure">Chapter 7</a>. The Collections&#13;
API has a high degree of generality and regularity, so there is often no need&#13;
to invent your own  data structuring code.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Exceptions to the rule" data-type="sect3"><div class="sect3" id="idm45290665065880">&#13;
<h3>Exceptions to the rule</h3>&#13;
&#13;
<p>There is one exception to the rule of using the API: the <a data-primary="clone() method" data-type="indexterm" id="idm45290665064360"/><code>clone()</code> method in <code>java.lang.Object</code> should generally <em>not</em>&#13;
be used. If you need to copy an object, just write a copy method, or a <em>copy constructor</em>.&#13;
<a data-primary="Bloch, Joshua" data-secondary="Effective Java" data-type="indexterm" id="idm45290665061960"/><a data-primary="Effective Java (Bloch)" data-type="indexterm" id="idm45290665060952"/>Joshua Bloch’s arguments against the <code>clone()</code> method in the book <em>Effective Java</em> (Addison-Wesley) are persuasive&#13;
and should be read by any dedicated Java programmer. While you’re at it, read that whole book.</p>&#13;
&#13;
<p>Another exception is the <a data-primary="finalize() method" data-type="indexterm" id="idm45290665058664"/><code>finalize()</code> method in <code>java.lang.Object()</code>. Don’t use it. It&#13;
has been deprecated since Java 9 because it&#13;
isn’t guaranteed to be invoked; but because it might get invoked, it will cause your dead&#13;
objects not to be garbage collected, resulting in a memory leak.  If you need some kind of&#13;
cleanup, you must take responsibility for defining a method and invoking it before you let&#13;
any object of that class go out of reference. You might call such a method <a data-primary="cleanUp() method" data-type="indexterm" id="idm45290665056696"/><code>cleanUp()</code>.&#13;
For application-level cleanup, see <a href="https://darwinsys.com/java/shutdownhook.html"><em class="hyperlink">https://darwinsys.com/java/shutdownhook.html</em></a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Generalize" data-type="sect3"><div class="sect3" id="javacook-oo-intro-5">&#13;
<h3>Generalize</h3>&#13;
&#13;
<p>There is a trade-off between generality (and the resulting  reusability), which is&#13;
emphasized here, and the convenience of application specificity. If you’re writing one&#13;
small part of a very large application designed according to OO design techniques, you’ll&#13;
have in mind a specific set of use cases. On the other hand, if you’re writing&#13;
toolkit-style code, you should write classes with few assumptions about how they’ll be&#13;
used. Making code easy to use from a variety of programs is the route to writing reusable code.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Read and write javadoc" data-type="sect3"><div class="sect3" id="javacook-oo-intro-6">&#13;
<h3>Read and write javadoc</h3>&#13;
&#13;
<p><a data-primary="javadoc" data-type="indexterm" id="idm45290665050440"/>You’ve no doubt looked at the Java online documentation in a browser, in part because I just told you to learn the API well. Do you think Sun/Oracle hired millions of tech writers to produce all that documentation? No. That documentation exists because the developers of the API took the time to write javadoc comments, those funny <code>/**</code> comments you’ve seen in code. So, one more bit of advice: use javadoc. The standard JDK provides a good, standard mechanism for API documentation. And use it as you write the code—don’t think you’ll come back and write it in later. That kind of tomorrow never comes.</p>&#13;
&#13;
<p>See <a data-type="xref" href="ch15.html#javacook-packages-javadoc">Recipe 15.2</a> for details on using javadoc.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use subclassing and delegation" data-type="sect3"><div class="sect3" id="javacook-oo-intro-7">&#13;
<h3>Use subclassing and delegation</h3>&#13;
&#13;
<p><a data-primary="subclassing" data-type="indexterm" id="idm45290665045576"/><a data-primary="delegation" data-type="indexterm" id="idm45290665044872"/>Use subclassing. But don’t overuse subclassing. It is one of the best ways not only for&#13;
avoiding code duplication, but for developing software that works. See any number of good&#13;
books on the topic of object-oriented design and programming for more details.</p>&#13;
&#13;
<p>There are several alternatives.  One alternative to subclassing is delegation.  Think about “is a” versus “has a.”&#13;
For example, instead of subclassing <code>NameAndAddress</code> to make <code>BusinessPartner</code> and <code>Customer</code>, make&#13;
<code>BusinessPartner</code> and <code>Customer</code> have instances of <code>NameAndAddress</code>. That is a clearer structure;&#13;
having <code>BusinessPartner</code>&#13;
<em>be a</em> <code>NameAndAddress</code> just because the partner <em>has a</em> name and address would not make sense.&#13;
And delegation also makes it easier for a <code>Customer</code> to have both a billing address and a shipping&#13;
address.  Another alternative is Aspect-Oriented Programming (AOP), which allows you to&#13;
bolt on extra functionality from the outside of your classes.  AOP is provided by the&#13;
Java EE using EJB Interception and by the Spring Framework AOP mechanism.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Use design patterns" data-type="sect3"><div class="sect3" id="javacook-oo-intro-8">&#13;
<h3>Use design patterns</h3>&#13;
&#13;
<p><a data-primary="design patterns" data-type="indexterm" id="idm45290665035992"/>In the <a data-type="xref" href="preface01.html#preface">Preface</a>, I mentioned <em>Design Patterns</em> as one of the Very Important Books on object-oriented programming.&#13;
Often called the <a data-primary="GoF (Gang of Four)" data-type="indexterm" id="idm45290665033752"/><a data-primary="Gang of Four (GoF)" data-type="indexterm" id="idm45290665033048"/>“Gang of Four” (GoF) book for its four authors,&#13;
it provides a powerful catalog of things that programmers often reinvent.&#13;
Some people find the GoF book to be somewhat academic in tone;&#13;
a less-formal presentation on patterns is<a data-primary="Head First Design Patterns (Bates)" data-type="indexterm" id="idm45290665032008"/><a data-primary="Bates, Bert" data-secondary="Head First Design Patterns" data-type="indexterm" id="idm45290665031320"/> <em>Head First Design Patterns</em> by Bert Bates et al. (O’Reilly); this covers the same two dozen patterns as the GoF book.&#13;
A design pattern provides a statement of a problem and its solution(s),&#13;
rather like the present book, but generally at a higher level of abstraction.&#13;
It is as important for giving a standard vocabulary of design as it is for&#13;
its clear explanations of how the basic patterns work and how they can be implemented.</p>&#13;
&#13;
<p><a data-type="xref" href="#javacook-oo-intro-table">Table 8-1</a> shows some example uses of design patterns in the standard API.</p>&#13;
<table id="javacook-oo-intro-table">&#13;
<caption><span class="label">Table 8-1. </span>Design patterns in the JavaSE API</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Pattern name</th>&#13;
<th>Meaning</th>&#13;
<th>Examples in Java API</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>Command</p></td>&#13;
<td><p>Encapsulate requests, allowing queues of requests, undoable operations, etc.</p></td>&#13;
<td><p><code>javax.swing.Action; javax.swing.undo.UndoableEdit</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Decorator</p></td>&#13;
<td><p>One class decorates another</p></td>&#13;
<td><p>Swing <code>Border</code>s</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Factory Method</p></td>&#13;
<td><p>One class makes up instances for you, controlled by subclasses</p></td>&#13;
<td><p><code>getInstance</code> (in <code>Calendar</code>, <code>Format</code>, <code>Locale</code>…); <code>SocketFactory</code>; RMI <code>InitialContext</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Iterator</p></td>&#13;
<td><p>Loop over all elements in a collection, visiting each exactly once</p></td>&#13;
<td><p><code>Iterator</code>; older <code>Enumeration</code>; <code>java.sql.ResultSet</code></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Model-View-Controller</p></td>&#13;
<td><p>Model represents data; View is what the user sees; Controller responds to user requests</p></td>&#13;
<td><p><code>ActionListener</code> and friends; <code>Observer/Observable</code>; used internally by all visible Swing components</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Proxy</p></td>&#13;
<td><p>One object stands in for another</p></td>&#13;
<td><p>RMI, AOP, Dynamic Proxy</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Singleton</p></td>&#13;
<td><p>Only one instance may exist</p></td>&#13;
<td><p><code>java.lang.Runtime, java.awt.Toolkit</code></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>I have written articles on the&#13;
<a href="https://blogs.oracle.com/javamagazine/the-state-pattern">State</a>,&#13;
<a href="https://blogs.oracle.com/javamagazine/the-proxy-pattern">Proxy</a>,&#13;
<a href="https://blogs.oracle.com/javamagazine/the-command-pattern-in-depth">Command</a>,&#13;
<a href="https://blogs.oracle.com/javamagazine/the-decorator-pattern-in-depth">Decorator</a>, and&#13;
<a href="https://blogs.oracle.com/javamagazine/the-visitor-design-pattern-in-depth">Visitor</a>&#13;
patterns for <em>Oracle Java Magazine</em>.<a data-primary="" data-startref="ja_oop" data-type="indexterm" id="idm45290664950232"/><a data-primary="" data-startref="oop_ja" data-type="indexterm" id="idm45290664949224"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.1 Object Methods: Formatting Objects with toString(), Comparing with Equals" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-1">&#13;
<h1>8.1 Object Methods: Formatting Objects with toString(), Comparing with Equals</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-1.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="object-oriented programming" data-secondary="object methods" data-type="indexterm" id="oop_om"/>You want your objects to have a useful default format and to behave themselves when placed in <code>Collections</code> classes.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-1.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>There are four overridable methods inherited from <code>java.lang.Object</code>;&#13;
of these, <code>toString()</code> provides default formatting, while <code>equals()</code> and <code>hashCode()</code>&#13;
provide equality testing and efficient usage in <code>Map</code> implementations.&#13;
The fourth, <code>clone()</code>, is not recommended for general use.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-1.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="toString()" data-type="sect3"><div class="sect3" id="idm45290664937160">&#13;
<h3>toString()</h3>&#13;
&#13;
<p><a data-primary="toString() method" data-type="indexterm" id="idm45290664935592"/>Whenever you pass an object to <code>System.out.println()</code> or any equivalent method or involve it in string concatenation, Java automatically calls its <code>toString()</code> method. Java knows that every object has a <code>toString()</code> method because <code>java.lang.Object</code>  has one and all classes are ultimately subclasses of <code>Object</code>. The default implementation, in <code>java.lang.Object</code>, is neither pretty nor interesting: it just prints the class name, an @ sign, and the object’s <code>hashCode()</code> value. For example, if you run the code</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ToStringWithout</code> <code class="o">{</code>&#13;
    <code class="kt">int</code> <code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** Simple constructor */</code>&#13;
    <code class="kd">public</code> <code class="nf">ToStringWithout</code><code class="o">(</code><code class="kt">int</code> <code class="n">anX</code><code class="o">,</code> <code class="kt">int</code> <code class="n">aY</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">x</code> <code class="o">=</code> <code class="n">anX</code><code class="o">;</code> <code class="n">y</code> <code class="o">=</code> <code class="n">aY</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Main just creates and prints an object */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="k">new</code> <code class="n">ToStringWithout</code><code class="o">(</code><code class="mi">42</code><code class="o">,</code> <code class="mi">86</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p class="pagebreak-before">you might see this uninformative output:</p>&#13;
&#13;
<pre data-type="programlisting">ToStringWithout@990c747b</pre>&#13;
&#13;
<p>To make it print better, you should provide an implementation of <code>toString()</code> that prints the class name and some of the important states in all but the most trivial classes. This gives you formatting control in <a data-primary="println() method" data-type="indexterm" id="idm45290664880712"/><code>println()</code>, in debuggers, and anywhere your objects get referred to in a <code>String</code> context. Here is the previous program rewritten with a <code>toString()</code> method:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ToStringWith</code> <code class="o">{</code>&#13;
    <code class="kt">int</code> <code class="n">x</code><code class="o">,</code> <code class="n">y</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** Simple constructor */</code>&#13;
    <code class="kd">public</code> <code class="nf">ToStringWith</code><code class="o">(</code><code class="kt">int</code> <code class="n">anX</code><code class="o">,</code> <code class="kt">int</code> <code class="n">aY</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">x</code> <code class="o">=</code> <code class="n">anX</code><code class="o">;</code> <code class="n">y</code> <code class="o">=</code> <code class="n">aY</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="nd">@Override</code>&#13;
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">toString</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="s">"ToStringWith["</code> <code class="o">+</code> <code class="n">x</code> <code class="o">+</code> <code class="s">","</code> <code class="o">+</code> <code class="n">y</code> <code class="o">+</code> <code class="s">"]"</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Main just creates and prints an object */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="k">new</code> <code class="n">ToStringWith</code><code class="o">(</code><code class="mi">42</code><code class="o">,</code> <code class="mi">86</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>This version produces the more useful output:</p>&#13;
&#13;
<pre data-type="programlisting">ToStringWith[42,86]</pre>&#13;
&#13;
<p>This example uses <code>String</code> concatenation, but you may also want&#13;
to use <code>String.format()</code> or <code>StringBuilder</code>; see <a data-type="xref" href="ch03.html#javacook-strings">Chapter 3</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="hashCode() and equals()" data-type="sect3"><div class="sect3" id="javacook-oo-SECT-2.x.1">&#13;
<h3>hashCode() and equals()</h3>&#13;
&#13;
<p><a data-primary="equals() method" data-type="indexterm" id="eq_m"/><a data-primary="hashCode() method" data-type="indexterm" id="hc_m"/>To ensure your classes work correctly when any client code calls <code>equals()</code> or&#13;
when these objects are stored in <code>Map</code> or other <code>Collection</code> classes,&#13;
outfit your class with <code>equals()</code> and <code>hashCode()</code> methods.</p>&#13;
&#13;
<p>How do you determine equality? For arithmetic or Boolean operands, the answer is simple: you test with the  equals operator (<code>==</code>). For  object references, though, Java provides both <code>==</code> and the <code>equals()</code> method inherited from <code>java.lang.Object</code>. The <code>equals</code> operator can be confusing because it simply compares two object references to see if they refer to the same object. This is not the same as comparing the values of the objects themselves.</p>&#13;
&#13;
<p>The inherited <code>equals()</code> method is also not as useful as you might imagine. Some people seem to start their lives as Java developers thinking that the default <code>equals()</code> magically does some kind of detailed, field-by-field or even binary comparison of objects. But it does <em>not</em> compare fields! It just does the simplest possible thing: it returns the value of an <code>==</code> comparison on the two objects involved! So, for any <em>value classes</em> you write, you probably have to write an <code>equals</code> method.<sup><a data-type="noteref" href="ch08.html#idm45290664734344" id="idm45290664734344-marker">1</a></sup> Note that both the <code>equals</code> and <code>hashCode</code> methods are used by <code>Map</code>s or hashes (such as <code>HashMap</code>; see <a data-type="xref" href="ch07.html#javacook-structure-SECT-6">Recipe 7.9</a>). So if you think somebody using your class might want to create instances and put them into a <code>Map</code>, or even compare your objects, you owe it to them (and to yourself!) to implement both <code>equals()</code> and <code>hashCode()</code> and to implement them properly.</p>&#13;
&#13;
<p>Most IDEs know how to generate correct <code>equals()</code> and <code>hashCode()</code> methods, but it’s worth your while&#13;
to understand what these are doing, for the occasional case where you need to tweak the generated code.&#13;
The Eclipse IDE (see <a data-type="xref" href="ch01.html#javacook-getstarted-SECT-3">Recipe 1.3</a>), for example, offers a <code>Source</code> menu item&#13;
<code>Generate hashCode() and equals()</code>; it will only do both at the same time, not let you generate <code>equals()</code> without <code>hashCode()</code> nor vice versa.</p>&#13;
&#13;
<p>Here are the rules for a correct <code>equals()</code> method:</p>&#13;
<dl>&#13;
<dt>It is reflexive</dt>&#13;
<dd>&#13;
<p><code>x.equals(x)</code> must be true.</p>&#13;
</dd>&#13;
<dt>It is symmetrical</dt>&#13;
<dd>&#13;
<p><code>x.equals(y)</code> must be true if and only if <code>y.equals(x)</code> is also true.</p>&#13;
</dd>&#13;
<dt>It is transitive</dt>&#13;
<dd>&#13;
<p>If <code>x.equals(y)</code> is true and <code>y.equals(z)</code> is true, then <code>x.equals(z)</code> must also be true.</p>&#13;
</dd>&#13;
<dt>It is idempotent (repeatable)</dt>&#13;
<dd>&#13;
<p>Multiple calls on <code>x.equals(y)</code> return the same value (unless state values used in the comparison are changed, as by calling a set method).</p>&#13;
</dd>&#13;
<dt>It is cautious</dt>&#13;
<dd>&#13;
<p><code>x.equals(null)</code> must return false rather than accidentally throwing a <code>NullPointerException</code>.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>In addition, beware of one common mistake: the argument to <code>equals()</code> must be&#13;
declared as <code>java.lang.Object</code>, not the class it is in; this is so that&#13;
polymorphism will work correctly (some classes may not have an <code>equals()</code> method of&#13;
their own). To prevent this mistake, the <code>@Override</code> annotation is usually added to&#13;
the <code>equals()</code> override, as mentioned in <a data-type="xref" href="ch15.html#javacook-packages-SECT-3">Recipe 15.3</a>.</p>&#13;
&#13;
<p>Here is a class that endeavors to implement these rules:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">EqualsDemo</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="kt">int</code><code> </code><code class="n">int1</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">SomeClass</code><code> </code><code class="n">obj1</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="cm">/** Constructor */</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="nf">EqualsDemo</code><code class="o">(</code><code class="kt">int</code><code> </code><code class="n">i</code><code class="o">,</code><code> </code><code class="n">SomeClass</code><code> </code><code class="n">o</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">int1</code><code> </code><code class="o">=</code><code> </code><code class="n">i</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">o</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>            </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nf">IllegalArgumentException</code><code class="o">(</code><code class="s">"Data Object may not be null"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="o">}</code><code>&#13;
</code><code>        </code><code class="n">obj1</code><code> </code><code class="o">=</code><code> </code><code class="n">o</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="cm">/** Default Constructor */</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="nf">EqualsDemo</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="k">this</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code><code> </code><code class="k">new</code><code> </code><code class="n">SomeClass</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="cm">/** Demonstration "equals" method */</code><code>&#13;
</code><code>    </code><code class="nd">@Override</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">boolean</code><code> </code><code class="nf">equals</code><code class="o">(</code><code class="n">Object</code><code> </code><code class="n">o</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">o</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="k">this</code><code class="o">)</code><code>                    </code><a class="co" href="#callout_object_oriented_techniques_CO1-1" id="co_object_oriented_techniques_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="kc">true</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">o</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code>                    </code><a class="co" href="#callout_object_oriented_techniques_CO1-2" id="co_object_oriented_techniques_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="kc">false</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="c1">// Of the correct class?&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">o</code><code class="o">.</code><code class="na">getClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="n">EqualsDemo</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code> </code><a class="co" href="#callout_object_oriented_techniques_CO1-3" id="co_object_oriented_techniques_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="kc">false</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">EqualsDemo</code><code> </code><code class="n">other</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">EqualsDemo</code><code class="o">)</code><code class="n">o</code><code class="o">;</code><code> </code><code class="c1">// OK, cast to this class&#13;
</code><code>&#13;
</code><code>        </code><code class="c1">// compare field-by-field         </code><a class="co" href="#callout_object_oriented_techniques_CO1-4" id="co_object_oriented_techniques_CO1-4"><img alt="4" src="assets/4.png"/></a><code class="c1">&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">int1</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="n">other</code><code class="o">.</code><code class="na">int1</code><code class="o">)</code><code>           </code><code class="c1">// compare primitives directly&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="kc">false</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="o">!</code><code class="n">obj1</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">other</code><code class="o">.</code><code class="na">obj1</code><code class="o">)</code><code class="o">)</code><code>     </code><code class="c1">// compare objects using their equals&#13;
</code><code>            </code><code class="k">return</code><code> </code><code class="kc">false</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="k">return</code><code> </code><code class="kc">true</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1">// ...</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_object_oriented_techniques_CO1-1" id="callout_object_oriented_techniques_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Optimization: if same object, true by definition.</p></dd>&#13;
<dt><a class="co" href="#co_object_oriented_techniques_CO1-2" id="callout_object_oriented_techniques_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>If other object null, false by definition.</p></dd>&#13;
<dt><a class="co" href="#co_object_oriented_techniques_CO1-3" id="callout_object_oriented_techniques_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>Compare class descriptors using !=; see following paragraph.</p></dd>&#13;
<dt><a class="co" href="#co_object_oriented_techniques_CO1-4" id="callout_object_oriented_techniques_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>Optimization: compare primitives first. May or may not be worthwhile; may be better to order by those most likely to differ—depends on the data and the usage.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Another common mistake to avoid: note the use of class descriptor equality&#13;
(i.e., <code>o.getClass() != EqualsDemo.class</code>) to ensure the correct class,&#13;
rather than via <code>instanceof</code>, as is sometimes erroneously done.&#13;
The reflexive requirement of the <code>equals()</code> method contract pretty much&#13;
makes it impossible to compare a subclass with a superclass correctly,&#13;
so we now use class equality (see <a data-type="xref" data-xrefstyle="chap-num-title" href="ch17.html#javacook-reflection">Chapter 17, <em>Reflection, or “A Class Named Class”</em></a> for details&#13;
on the class descriptor).</p>&#13;
&#13;
<p>Here is a basic JUnit test (see <a data-type="xref" href="ch01.html#javacook-getstarted-junit">Recipe 1.10</a>) for the <code>EqualsDemo</code> class:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/** Some JUnit test cases for EqualsDemo.</code>&#13;
<code class="cm"> * Writing a full set is left as "an exercise for the reader".</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">EqualsDemoTest</code> <code class="o">{</code>&#13;
&#13;
    <code class="cm">/** an object being tested */</code>&#13;
    <code class="n">EqualsDemo</code> <code class="n">d1</code><code class="o">;</code>&#13;
    <code class="cm">/** another object being tested */</code>&#13;
    <code class="n">EqualsDemo</code> <code class="n">d2</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** Method to be invoked before each test method */</code>&#13;
    <code class="nd">@Before</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setUp</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">d1</code> <code class="o">=</code> <code class="k">new</code> <code class="n">EqualsDemo</code><code class="o">();</code>&#13;
        <code class="n">d2</code> <code class="o">=</code> <code class="k">new</code> <code class="n">EqualsDemo</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="nd">@Test</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">testSymmetry</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">assertTrue</code><code class="o">(</code><code class="n">d1</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">d1</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="nd">@Test</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">testSymmetric</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">assertTrue</code><code class="o">(</code><code class="n">d1</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">d2</code><code class="o">)</code> <code class="o">&amp;&amp;</code> <code class="n">d2</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">d1</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="nd">@Test</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">testCaution</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">assertFalse</code><code class="o">(</code><code class="n">d1</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="kc">null</code><code class="o">));</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>With all that testing, what could go wrong? Well, some things still need care. What if the object is a <em>subclass</em> of <code>EqualsDemo</code>? We should test that it returns false in this case.</p>&#13;
&#13;
<p>What else could go wrong? Well, what if either <code>obj1</code> or <code>other.obj1</code> is null? You might have just earned a nice shiny new <code>NullPointerException</code>. So you also need to test for any possible null values. Good constructors can avoid these <code>NullPointerException</code>s, as I’ve tried to do in <code>EqualsDemo</code>, or else test for them explicitly.</p>&#13;
&#13;
<p>Finally, you should never override <code>equals()</code> without also overriding <code>hashCode()</code>, and the same&#13;
fields must take part in both computations.<a data-primary="" data-startref="eq_m" data-type="indexterm" id="idm45290664424040"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="hashCode()" data-type="sect3"><div class="sect3" id="idm45290664746648">&#13;
<h3>hashCode()</h3>&#13;
&#13;
<p>The <code>hashCode()</code> method is supposed to return an <code>int</code> that should uniquely identify any set of values in objects of its class.</p>&#13;
&#13;
<p>A properly written <code>hashCode()</code> method will follow these rules:</p>&#13;
<dl>&#13;
<dt>It is repeatable</dt>&#13;
<dd>&#13;
<p><code>hashCode(x)</code> must return the same <code>int</code> when called repeatedly, unless set methods have been called.</p>&#13;
</dd>&#13;
<dt>It is consistent with equality</dt>&#13;
<dd>&#13;
<p>If <code>x.equals(y)</code>, then <code>x.hashCode()</code> must == <code>y.hashCode()</code>.</p>&#13;
</dd>&#13;
<dt>Distinct objects should produce distinct hashCodes</dt>&#13;
<dd>&#13;
<p>If <code>!x.equals(y)</code>, it is not required that <code>x.hashCode()</code> != <code>y.hashCode()</code>, but doing so may improve performance of hash tables (i.e., hashes may call <code>hashCode()</code> before <code>equals()</code>).</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The default <code>hashCode()</code> on the standard JDK returns a machine address, which conforms to the first rule. Conformance to the second and third rules depends, in part, on your <code>equals()</code> method. Here is a program that prints the hashcodes of a small handful of objects:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">PrintHashCodes</code> <code class="o">{</code>&#13;
&#13;
    <code class="cm">/** Some objects to hashCode() on */</code>&#13;
    <code class="kd">protected</code> <code class="kd">static</code> <code class="n">Object</code><code class="o">[]</code> <code class="n">data</code> <code class="o">=</code> <code class="o">{</code>&#13;
        <code class="k">new</code> <code class="nf">PrintHashCodes</code><code class="o">(),</code>&#13;
        <code class="k">new</code> <code class="n">java</code><code class="o">.</code><code class="na">awt</code><code class="o">.</code><code class="na">Color</code><code class="o">(</code><code class="mh">0x44</code><code class="o">,</code> <code class="mh">0x88</code><code class="o">,</code> <code class="mh">0xcc</code><code class="o">),</code>&#13;
        <code class="k">new</code> <code class="nf">SomeClass</code><code class="o">()</code>&#13;
    <code class="o">};</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"About to hashCode "</code> <code class="o">+</code> <code class="n">data</code><code class="o">.</code><code class="na">length</code> <code class="o">+</code> <code class="s">" objects."</code><code class="o">);</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="kt">int</code> <code class="n">i</code><code class="o">=</code><code class="mi">0</code><code class="o">;</code> <code class="n">i</code><code class="o">&lt;</code><code class="n">data</code><code class="o">.</code><code class="na">length</code><code class="o">;</code> <code class="n">i</code><code class="o">++)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">data</code><code class="o">[</code><code class="n">i</code><code class="o">].</code><code class="na">toString</code><code class="o">()</code> <code class="o">+</code> <code class="s">" --&gt; "</code> <code class="o">+</code>&#13;
                <code class="n">data</code><code class="o">[</code><code class="n">i</code><code class="o">].</code><code class="na">hashCode</code><code class="o">());</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"All done."</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>What does it print?</p>&#13;
<pre data-type="programlisting" id="I_9_tt293">&gt; <strong>javac -d . oo/PrintHashCodes.java</strong>&#13;
&gt; <strong>java oo.PrintHashCodes</strong>&#13;
About to hashCode 3 objects.&#13;
PrintHashCodes@982741a0 --&gt; -1742257760&#13;
java.awt.Color[r=68,g=136,b=204] --&gt; -12285748&#13;
SomeClass@860b41ad --&gt; -2046082643&#13;
All done.&#13;
&gt;</pre>&#13;
&#13;
<p>The hashcode value for the <code>Color</code> object is interesting. It is actually computed as something like this:</p>&#13;
&#13;
<pre data-type="programlisting">alpha&lt;&lt;24 + r&lt;&lt;16 + g&lt;&lt;8 + b</pre>&#13;
&#13;
<p>In this formula, <code>r</code>, <code>g</code>, and <code>b</code> are the red, green, and blue components, respectively, and <code>alpha</code> is the transparency. Each of these quantities is stored in 8 bits of a 32-bit integer. If the alpha value is greater than 128, the high bit in this word—having been set by shifting into the sign bit of the word—causes the integer value to appear negative when printed as a signed integer. Hashcode values are of type <code>int</code>, so they are allowed to be negative.<a data-primary="" data-startref="hc_m" data-type="indexterm" id="idm45290664091208"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Difficulties and Alternatives to Clone" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-4.3.2">&#13;
<h2>Difficulties and Alternatives to Clone</h2>&#13;
&#13;
<p><a data-primary="clone() method" data-type="indexterm" id="idm45290664088776"/>The <code>java.util.Observable</code> class (designed to implement the Model-View-Controller pattern with AWT or Swing applications) contains a private <code>Vector</code> but no clone method to deep-clone it. Thus, <code>Observable</code> objects cannot safely be  cloned, ever!</p>&#13;
&#13;
<p>This and several other issues around <code>clone()</code>—such as the uncertainty of whether a given <code>clone()</code> implementation is deep or shallow—suggest that <code>clone()</code> was not as well thought out as might be. An alternative is simply to provide a copy constructor or similar method: <a data-primary="" data-startref="oop_om" data-type="indexterm" id="idm45290664084536"/></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">CopyConstructorDemo</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">CopyConstructorDemo</code> <code class="n">object1</code> <code class="o">=</code> <code class="k">new</code> <code class="n">CopyConstructorDemo</code><code class="o">(</code><code class="mi">123</code><code class="o">,</code> <code class="s">"Hello"</code><code class="o">);</code>&#13;
        <code class="n">CopyConstructorDemo</code> <code class="n">object2</code> <code class="o">=</code> <code class="k">new</code> <code class="n">CopyConstructorDemo</code><code class="o">(</code><code class="n">object1</code><code class="o">);</code>&#13;
        <code class="k">if</code> <code class="o">(!</code><code class="n">object1</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">object2</code><code class="o">))</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Something is terribly wrong..."</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"All done."</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kt">int</code> <code class="n">number</code><code class="o">;</code>&#13;
    <code class="kd">private</code> <code class="n">String</code> <code class="n">name</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** Default constructor */</code>&#13;
    <code class="kd">public</code> <code class="nf">CopyConstructorDemo</code><code class="o">()</code>  <code class="o">{</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Normal constructor */</code>&#13;
    <code class="kd">public</code> <code class="nf">CopyConstructorDemo</code><code class="o">(</code><code class="kt">int</code> <code class="n">number</code><code class="o">,</code> <code class="n">String</code> <code class="n">name</code><code class="o">)</code>  <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">number</code> <code class="o">=</code> <code class="n">number</code><code class="o">;</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">name</code> <code class="o">=</code> <code class="n">name</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Copy constructor */</code>&#13;
    <code class="kd">public</code> <code class="nf">CopyConstructorDemo</code><code class="o">(</code><code class="n">CopyConstructorDemo</code> <code class="n">other</code><code class="o">)</code>  <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">number</code> <code class="o">=</code> <code class="n">other</code><code class="o">.</code><code class="na">number</code><code class="o">;</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">name</code> <code class="o">=</code> <code class="n">other</code><code class="o">.</code><code class="na">name</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
    <code class="c1">// hashCode() and equals() not shown</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.2 Using Inner Classes" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-6">&#13;
<h1>8.2 Using Inner Classes</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-6.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="inner classes" data-type="indexterm" id="ic_a"/><a data-primary="object-oriented programming" data-secondary="inner classes" data-type="indexterm" id="oop_ic"/>You need to write a private class, or a class to be used in one other class at most.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-6.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use a nonpublic class or an inner class.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-6.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>A nonpublic class can be written as part of another class’s source file, but not inside that class. An inner class is Java terminology for a class defined inside another class. Inner classes were first popularized with early Java for use as event handlers for GUI applications, but they have a much wider application.</p>&#13;
&#13;
<p>Inner classes can, in fact, be constructed in several contexts. An inner class defined as a member of a class can be instantiated anywhere in that class. An inner class defined inside a method can be referred to later only in the same method. Inner classes can also be named or anonymous. A  named inner class has a full name that is compiler dependent; the standard JVM uses a name like <code>MainClass$InnerClass</code> for the resulting file. An anonymous inner class, similarly, has a compiler-dependent name; the JVM uses <code>MainClass$1</code>, <code>MainClass$2</code>, and so on.</p>&#13;
&#13;
<p>These classes cannot be instantiated in any other context; any explicit attempt to refer to, say, <code>OtherMainClass$InnerClass</code>, is caught at compile time:</p>&#13;
&#13;
<p><em>main/src/main/java/oo/AllClasses.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">AllClasses</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">Data</code><code> </code><code class="o">{</code><code>    </code><a class="co" href="#callout_object_oriented_techniques_CO2-1" id="co_object_oriented_techniques_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="kt">int</code><code> </code><code class="n">x</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="kt">int</code><code> </code><code class="n">y</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">getResults</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">JButton</code><code> </code><code class="n">b</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">JButton</code><code class="o">(</code><code class="s">"Press me"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">b</code><code class="o">.</code><code class="na">addActionListener</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">ActionListener</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_object_oriented_techniques_CO2-2" id="co_object_oriented_techniques_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>            </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">actionPerformed</code><code class="o">(</code><code class="n">ActionEvent</code><code> </code><code class="n">evt</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>                </code><code class="n">Data</code><code> </code><code class="n">loc</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Data</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>                </code><code class="n">loc</code><code class="o">.</code><code class="na">x</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="o">(</code><code class="n">Component</code><code class="o">)</code><code class="n">evt</code><code class="o">.</code><code class="na">getSource</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getX</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>                </code><code class="n">loc</code><code class="o">.</code><code class="na">x</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="o">(</code><code class="n">Component</code><code class="o">)</code><code class="n">evt</code><code class="o">.</code><code class="na">getSource</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getY</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>                </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Thanks for pressing me"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>            </code><code class="o">}</code><code>&#13;
</code><code>        </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="cm">/** Class contained in same file as AllClasses, but can be used&#13;
 * (with a warning) in other contexts.&#13;
 */</code><code>&#13;
</code><code class="kd">class</code><code> </code><code class="nc">AnotherClass</code><code> </code><code class="o">{</code><code>                    </code><a class="co" href="#callout_object_oriented_techniques_CO2-3" id="co_object_oriented_techniques_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="c1">// methods and fields here...&#13;
</code><code>    </code><code class="n">AnotherClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="c1">// Inner class from above cannot be used here, of course&#13;
</code><code>        </code><code class="c1">// Data d = new Data();    // EXPECT COMPILE ERROR&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_object_oriented_techniques_CO2-1" id="callout_object_oriented_techniques_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>This is an inner class, which can be used anywhere in class <code>AllClasses</code>.</p></dd>&#13;
<dt><a class="co" href="#co_object_oriented_techniques_CO2-2" id="callout_object_oriented_techniques_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>This shows the anonymous inner class syntax, which uses <code>new</code> with a type followed by <code>(){</code>, a class body, and <code>}</code>.&#13;
The compiler will assign a name; the class will extend or implement the given type, as appropriate.</p></dd>&#13;
<dt><a class="co" href="#co_object_oriented_techniques_CO2-3" id="callout_object_oriented_techniques_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>This is a nonpublic class; it can be used in the main class and (with warning) in other classes.</p></dd>&#13;
</dl>&#13;
&#13;
<p>One issue is that the inner class retains a reference to the outer class.&#13;
If you want to avoid memory leaks if the inner class will be held&#13;
for a longer time than the outer, you can make the inner class <code>static</code>.</p>&#13;
&#13;
<p>Inner classes implementing a single-method interface can be written in a much more concise fashion as lambda expressions (see <a data-type="xref" href="ch09.html#javacook-fp">Chapter 9</a>).</p>&#13;
<aside class="less_space pagebreak-before" data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="java-interface-default-static">&#13;
<h5>Interface Changes in Java: default and static</h5>&#13;
<p>Java 8 added two new capabilities to interfaces, default methods and static methods.</p>&#13;
&#13;
<p>Default methods are implicitly added to any implementing class.&#13;
They cannot directly access fields in the class.&#13;
They are useful in functional programming (see <a data-type="xref" href="ch09.html#javacook-fp">Chapter 9</a>).&#13;
They are also useful in adding functionality to an existing, widely used interface&#13;
without breaking all the implementing classes.&#13;
For example, in Java 8 the <code>List</code> interface gained a <a data-primary="forEach() method" data-type="indexterm" id="idm45290663846920"/><code>forEach()</code> instance method&#13;
for a measure of compatibility with <code>Streams</code>. It was important that&#13;
all the <code>List</code> implementations both in <code>java.util</code> and in applications&#13;
be able to provide this method without changing all the code,&#13;
which is why the mechanism was implemented as it was.</p>&#13;
&#13;
<p>Java also now allows <code>static</code> methods in interfaces.&#13;
These allow addition of methods, again without breaking existing implementations.&#13;
They become static methods in every implementing class.&#13;
For example, the <code>List</code> interface gained a static <code>of</code> method that allows&#13;
you to write code such as this:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">list</code> <code class="o">=</code> <code class="n">List</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"Hello"</code><code class="o">,</code> <code class="s">"World"</code><code class="o">,</code> <code class="s">"of"</code><code class="o">,</code> <code class="s">"Java"</code><code class="o">);</code></pre>&#13;
&#13;
<p>These two additions could not have been made without the addition of these two keywords to the syntax&#13;
of interfaces.&#13;
A trivial subset of <code>List</code>, called <code>MyList</code> in the <em>structure</em> directory,&#13;
demonstrates how these two sample methods—the instance <code>forEach()</code> and the static <code>of()</code>—could be implemented.</p>&#13;
</div></aside>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.3 Providing Callbacks via Interfaces" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-7">&#13;
<h1>8.3 Providing Callbacks via Interfaces</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-7.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p>You want to provide callbacks—that is, have unrelated classes call back into your code.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-7.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>One way is to use a Java interface.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-7.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>An interface is a class-like entity that can contain only abstract methods and final fields. As we’ve seen, interfaces are used a lot in Java! In the standard API, the following are a few of the commonly used interfaces:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><code>Runnable</code>, <code>Comparable</code>, and <code>Cloneable</code> (in <code>java.lang</code>).</p>&#13;
</li>&#13;
<li>&#13;
<p><code>List</code>, <code>Set</code>, <code>Map</code>, and <code>Enumeration/Iterator</code> (in the Collections API; as you’ll see in <a data-type="xref" href="ch07.html#javacook-structure">Chapter 7</a>).</p>&#13;
</li>&#13;
<li>&#13;
<p><code>ActionListener</code>, <code>WindowListener</code>, and others in the GUI layer.</p>&#13;
</li>&#13;
<li>&#13;
<p><code>Driver</code>, <code>Connection</code>, <code>Statement</code>, and <code>ResultSet</code> in JDBC; see&#13;
<a href="https://darwinsys.com/javadatabase"><em class="hyperlink">https://darwinsys.com/javadatabase</em></a>.</p>&#13;
</li>&#13;
<li>&#13;
<p>The <a data-primary="remote interface" data-type="indexterm" id="idm45290663655944"/><em>remote interface</em>—the contact between the client and the server—is specified as an <code>Interface</code> (in RMI, CORBA, and EJB).</p>&#13;
</li>&#13;
</ul>&#13;
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="javacook-oo-SIDEBAR-1">&#13;
<h5>Subclass, Abstract Class, or Interface?</h5>&#13;
<p>There is usually more than one way to solve a problem. Some problems can be solved by subclassing, by use of abstract classes, or by interfaces. The following general guidelines may help:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A class can only extend one other class, but it can implement any number of interfaces; keep this in mind when deciding to use abstract classes or interface.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-primary="abstract class" data-type="indexterm" id="idm45290663650168"/><em>Use an abstract class</em> when you want to provide a template for a series of subclasses, all of which may inherit some of their functionality from the parent class but are required to implement some of it themselves. (Any subclass of a geometric <code>Shapes</code> class might have to provide a <code>computeArea()</code> method; because the top-level <code>Shapes</code> class cannot do this, it would be abstract. This is implemented in <a data-type="xref" href="#javacook-oo-SECT-8">Recipe 8.4</a>.)</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Use an interface with default methods</em> for many of the same things you’d have used an abstract&#13;
class for prior to Java 8, which introduced default methods.&#13;
Default methods can be added to an interface without breaking existing code, such as <code>forEach</code>&#13;
and <code>of</code> methods being added to the <code>Collection</code> interface so that every <code>List</code> instance has a <code>forEach</code> method built in.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>*<a data-primary="subclassing" data-type="indexterm" id="idm45290663690712"/><em>Subclass</em>  when you need to extend a class and add some functionality to it, whether the parent class is abstract or not. See the standard Java APIs and the examples in <a data-type="xref" data-xrefstyle="select: labelnumber" href="ch01.html#javacook-getstarted-junit">Recipe 1.10</a>, <a data-type="xref" data-xrefstyle="select: labelnumber" href="#javacook-oo-SECT-12">Recipe 8.10</a>, and <a data-type="xref" data-xrefstyle="select: labelnumber" href="ch10.html#javacook-io-SECT-10">Recipe 10.10</a>.</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><em>Subclass</em> when you are required to extend a given class. Some APIs such as <em>servlets</em> use subclassing to ensure base functionality in classes that are dynamically loaded (see <a data-type="xref" href="ch17.html#javacook-reflection-SECT-3">Recipe 17.4</a>).</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Define an interface</em>  when there is no common parent class with the desired functionality and when you want only certain unrelated classes to have that functionality (see the <code>PowerSwitchable</code> interface in <a data-type="xref" href="#javacook-oo-SECT-6">Recipe 8.2</a>).&#13;
You should also choose this option if you know that you’ll need (or think there is a chance you might later need) to be able to pass in unrelated classes for testing purposes. Using mock objects is a very common strategy in unit testing. Some say that interfaces should be your first choice at least as often as subclassing.</p>&#13;
</li>&#13;
<li>&#13;
<p><em>Use interfaces as markers</em> to indicate something about a class. Marker interfaces commonly have no abstract methods. The standard API, for example, uses <code>Serializable</code> as a marker interface to indicate permission to serialize objects of the implementing class.&#13;
See <a data-type="xref" href="ch12.html#javacook-netclient-SECT-5.2">“Solution”</a> for information on serialization.</p>&#13;
</li>&#13;
</ul>&#13;
</div></aside>&#13;
&#13;
<p>Suppose we are generating a building management system. To be energy efficient, we want to be able to remotely turn off (at night and on weekends) such things as room lights and computer monitors, which use a lot of energy. Assume we have some kind of remote control technology. It could be a commercial version of BSR’s house-light control technology X10, it could be Bluetooth or 802.11—it doesn’t matter. What matters is that we have to be very careful what we turn off. It would cause great ire if we turned off computer processors automatically—people often leave things running overnight. It would be a matter of public safety if we ever turned off the building emergency&#13;
lighting.<sup><a data-type="noteref" href="ch08.html#idm45290663675912" id="idm45290663675912-marker">2</a></sup></p>&#13;
&#13;
<p>So we’ve come up with the design shown in <a data-type="xref" href="#javacook-oo-FIG-1">Figure 8-1</a>.</p>&#13;
&#13;
<figure><div class="figure" id="javacook-oo-FIG-1">&#13;
<img alt="jcb4 0801" src="assets/jcb4_0801.png"/>&#13;
<h6><span class="label">Figure 8-1. </span>Classes for a building management system</h6>&#13;
</div></figure>&#13;
&#13;
<p>The code for these data classes is not shown (it’s pretty trivial), but it’s in the <em>oo/interfaces</em> directory of the online source. The top-level classes (i.e., <code>BuildingLight</code> and <code>Asset</code>) are abstract classes. You can’t instantiate them, because they don’t have any specific functionality. To ensure—both at compile time and at runtime—that we can never switch off the emergency lighting, we need only ensure that the class representing it, <code>EmergencyLight</code>, does not implement the <code>PowerSwitchable</code> interface.</p>&#13;
&#13;
<p>Note that we can’t very well use direct inheritance here. No common ancestor class&#13;
includes both <code>ComputerMonitor</code> and <code>RoomLights</code> that doesn’t also include <code>ComputerCPU</code>&#13;
and <code>EmergencyLight</code>. Use interfaces to define functionality in unrelated classes.</p>&#13;
&#13;
<p>How we use these is demonstrated by the <code>BuildingManagement</code> class; this class is not part&#13;
of the hierarchy shown in <a data-type="xref" href="#javacook-oo-FIG-1">Figure 8-1</a>, but  it <em>uses</em> a collection of <code>Asset</code> objects&#13;
from that hierarchy.</p>&#13;
&#13;
<p>Items that can’t be switched must nonetheless be in the database, for various purposes&#13;
(auditing, insurance, etc.). In the method that turns things off, the code is careful&#13;
to check whether each object in the database is an instance of the <code>PowerSwitchable</code>&#13;
interface. If so, the object is casted to <code>PowerSwitchable</code> so that its <code>powerDown()</code>&#13;
method can be called. If not, the object is skipped, thus preventing any possibility of&#13;
turning out the emergency lights or shutting off a machine that is busy running SETI@Home,&#13;
downloading a big MP3 playlist, or performing system backups. The following code shows this set of classes in action:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">BuildingManagement</code> <code class="o">{</code>&#13;
&#13;
    <code class="n">List</code><code class="o">&lt;</code><code class="n">Asset</code><code class="o">&gt;</code> <code class="n">things</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>&#13;
&#13;
    <code class="cm">/** Scenario: goodNight() is called from a timer Thread at 2200, or when</code>&#13;
<code class="cm">     * we get the "shutdown" command from the security guard.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">goodNight</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">things</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">obj</code> <code class="o">-&gt;</code> <code class="o">{</code>&#13;
            <code class="k">if</code> <code class="o">(</code><code class="n">obj</code> <code class="k">instanceof</code> <code class="n">PowerSwitchable</code><code class="o">)</code>&#13;
                <code class="o">((</code><code class="n">PowerSwitchable</code><code class="o">)</code><code class="n">obj</code><code class="o">).</code><code class="na">powerDown</code><code class="o">();</code>&#13;
            <code class="o">});</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="c1">// tag::functional[]</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">goodNightFunctional</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">things</code><code class="o">.</code><code class="na">stream</code><code class="o">().</code><code class="na">filter</code><code class="o">(</code><code class="n">obj</code> <code class="o">-&gt;</code> <code class="n">obj</code> <code class="k">instanceof</code> <code class="n">PowerSwitchable</code><code class="o">)</code>&#13;
            <code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">obj</code> <code class="o">-&gt;</code> <code class="o">((</code><code class="n">PowerSwitchable</code><code class="o">)</code><code class="n">obj</code><code class="o">).</code><code class="na">powerDown</code><code class="o">());</code>&#13;
    <code class="o">}</code>&#13;
    <code class="c1">// end::functional[]</code>&#13;
&#13;
    <code class="c1">// goodMorning() would be similar, but call each one's powerUp().</code>&#13;
&#13;
    <code class="cm">/** Add a Asset to this building */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">add</code><code class="o">(</code><code class="n">Asset</code> <code class="n">thing</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Adding "</code> <code class="o">+</code> <code class="n">thing</code><code class="o">);</code>&#13;
        <code class="n">things</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">thing</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** The main program */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">av</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">BuildingManagement</code> <code class="n">b1</code> <code class="o">=</code> <code class="k">new</code> <code class="n">BuildingManagement</code><code class="o">();</code>&#13;
        <code class="n">b1</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">RoomLights</code><code class="o">(</code><code class="mi">101</code><code class="o">));</code>    <code class="c1">// control lights in room 101</code>&#13;
        <code class="n">b1</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">EmergencyLight</code><code class="o">(</code><code class="mi">101</code><code class="o">));</code>    <code class="c1">// and emerg. lights.</code>&#13;
        <code class="c1">// add the computer on desk#4 in room 101</code>&#13;
        <code class="n">b1</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">ComputerCPU</code><code class="o">(</code><code class="mi">10104</code><code class="o">));</code>&#13;
        <code class="c1">// and its monitor</code>&#13;
        <code class="n">b1</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">ComputerMonitor</code><code class="o">(</code><code class="mi">10104</code><code class="o">));</code>&#13;
&#13;
        <code class="c1">// time passes, and the sun sets...</code>&#13;
        <code class="n">b1</code><code class="o">.</code><code class="na">goodNight</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>When you run this program, it shows all the items being added but only the&#13;
<code>PowerSwitchable</code> ones being switched off: <a data-primary="" data-startref="ic_a" data-type="indexterm" id="idm45290663539624"/><a data-primary="" data-startref="oop_ic" data-type="indexterm" id="idm45290663538712"/></p>&#13;
<pre data-type="programlisting" id="I_9_tt301">&gt; <strong>java oo.interfaces.BuildingManagement</strong>&#13;
Adding RoomLights@2dc77f32&#13;
Adding EmergencyLight@2e3b7f32&#13;
Adding ComputerCPU@2e637f32&#13;
Adding ComputerMonitor@2f1f7f32&#13;
Dousing lights in room 101&#13;
Dousing monitor at desk 10104&#13;
&gt;</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.4 Polymorphism/Abstract Methods" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-8">&#13;
<h1>8.4 Polymorphism/Abstract Methods</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-8.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="object-oriented programming" data-secondary="abstract methods" data-type="indexterm" id="idm45290663376056"/><a data-primary="object-oriented programming" data-secondary="polymorphism" data-type="indexterm" id="idm45290663375016"/><a data-primary="polymorphism" data-type="indexterm" id="idm45290663374056"/><a data-primary="abstract methods" data-type="indexterm" id="idm45290663373384"/>You want each of a number of subclasses to provide its own version of one or more methods.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-8.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Make the method abstract in the parent class; this makes the compiler ensure that each subclass implements it.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-8.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>A hypothetical drawing program uses a <code>Shape</code> subclass for anything that is drawn. <code>Shape</code> has an abstract method called <a data-primary="computeArea() method" data-type="indexterm" id="idm45290663367448"/><code>computeArea()</code> that computes the exact area of the given shape:</p>&#13;
&#13;
<pre data-type="programlisting">public abstract class Shape {&#13;
    protected int x, y;&#13;
    public abstract double computeArea( );&#13;
}</pre>&#13;
&#13;
<p>A <code>Rectangle</code> subclass, for example, has a <code>computeArea()</code> that multiplies width times height and returns the result:</p>&#13;
&#13;
<pre data-type="programlisting">public class Rectangle extends Shape {&#13;
    double width, height;&#13;
    public double computeArea( ) {&#13;
        return width * height;&#13;
    }&#13;
}</pre>&#13;
&#13;
<p>A <code>Circle</code> subclass returns π<em>r</em><sup>2</sup>:</p>&#13;
&#13;
<pre data-type="programlisting">public class Circle extends Shape {&#13;
    double radius;&#13;
    public double computeArea( ) {&#13;
        return Math.PI * radius * radius;&#13;
    }&#13;
}</pre>&#13;
&#13;
<p>This system has a high degree of generality. In the main program, we can iterate over a collection of <code>Shape</code> objects and—here’s the real beauty—call <code>computeArea()</code> on any <code>Shape</code> subclass object without having to worry about what kind of shape it is. Java’s polymorphic methods automatically call the correct <code>computeArea()</code> method in the class of which the object was originally constructed:</p>&#13;
&#13;
<p><em>main/src/main/java/oo//shapes/ShapeDriver.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/** Part of a main program using Shape objects */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">ShapeDriver</code> <code class="o">{</code>&#13;
&#13;
    <code class="n">Collection</code><code class="o">&lt;</code><code class="n">Shape</code><code class="o">&gt;</code> <code class="n">allShapes</code><code class="o">;</code>    <code class="c1">// created in a Constructor, not shown</code>&#13;
&#13;
    <code class="cm">/** Iterate over all the Shapes, getting their areas;</code>&#13;
<code class="cm">     * this cannot use the Java 8 Collection.forEach because the</code>&#13;
<code class="cm">     * variable total would have to be final, which would defeat the purpose :-)</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kt">double</code> <code class="nf">totalAreas</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="kt">double</code> <code class="n">total</code> <code class="o">=</code> <code class="mf">0.0</code><code class="o">;</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="n">Shape</code> <code class="n">s</code> <code class="o">:</code> <code class="n">allShapes</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">total</code> <code class="o">+=</code> <code class="n">s</code><code class="o">.</code><code class="na">computeArea</code><code class="o">();</code>&#13;
        <code class="o">}</code>&#13;
        <code class="k">return</code> <code class="n">total</code><code class="o">;</code>&#13;
    <code class="o">}</code></pre>&#13;
&#13;
<p>Polymorphism is a great boon for software maintenance: if a new subclass is added, the code in the main program does not change. Further, all the code that is specific to, say, polygon handling, is all in one place: in the source file for the <code>Polygon</code> class. This is a big improvement over older languages, where type fields in a structure were used with case or switch statements scattered all across the software. Java makes software more reliable and maintainable with the use of polymorphism.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.5 Using Typesafe Enumerations" data-type="sect1"><div class="sect1" id="javacook-CHP-8-SECT-5">&#13;
<h1>8.5 Using Typesafe Enumerations</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-CHP-8-SECT-5.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="enumerations" data-type="indexterm" id="enu_ty"/><a data-primary="object-oriented programming" data-secondary="enumerations" data-type="indexterm" id="oop_enu"/>You need to manage a small list of discrete values within a program.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-CHP-8-SECT-5.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use the Java <code>enum</code> mechanism.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-CHP-8-SECT-5.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>To enumerate means to list all the values. You often know that a small list of possible values is all that’s wanted in a variable, such as the months of the year, the suits or ranks in a deck of cards, or the primary and secondary colors. The C programming language provided an <code>enum</code> keyword:</p>&#13;
&#13;
<pre data-type="programlisting">enum  { BLACK, RED, ORANGE} color;</pre>&#13;
&#13;
<p>Java was criticized in its early years for its lack of enumerations, which many developers have wished for. Many have had to develop custom classes to implement the <em>typesafe enumeration pattern</em>.</p>&#13;
&#13;
<p>But C enumerations are not typesafe; they simply define constants that can be used in any integer context. For example, this code compiles without warning, even on <em>gcc</em> 3 with <code>-Wall</code> (all warnings), whereas a C++ compiler catches the error:<sup><a data-type="noteref" href="ch08.html#idm45290663297016" id="idm45290663297016-marker">3</a></sup></p>&#13;
&#13;
<pre data-type="programlisting">enum { BLACK, RED, ORANGE} color;&#13;
enum { READ, UNREAD } state;&#13;
&#13;
/*ARGSUSED*/&#13;
int main(int argc, char *argv[]) {&#13;
        color = RED;&#13;
        color = READ; // In C this will compile, give bad results&#13;
        return 0;&#13;
}</pre>&#13;
&#13;
<p>To replicate this mistake in Java, one needs only to define a series&#13;
of <code>final int</code> values; it will still not be typesafe. By typesafe I&#13;
mean that you cannot accidentally use values other than those&#13;
defined for the given enumeration. The definitive statement on the&#13;
typesafe enumeration pattern is probably the version defined in&#13;
item 21 of <a data-primary="Bloch, Joshua" data-secondary="Effective Java" data-type="indexterm" id="idm45290663294040"/><a data-primary="Effective Java (Bloch)" data-type="indexterm" id="idm45290663293064"/>Joshua Bloch’s book <em>Effective Java</em> (Addison-Wesley).&#13;
All modern Java versions include enumerations in the language; it is no longer necessary to use the code from Bloch’s book. Bloch was one of the authors of the Typesafe Enumeration specification&#13;
(<code>enum</code> keyword), so you can be sure that Java now does a good job of&#13;
implementing his pattern. These <code>enum</code>s are implemented as classes,&#13;
subclassed (transparently, by the compiler) from the class&#13;
<code>java.lang.Enum</code>. Unlike C, and unlike a series of <code>final int</code>s, Java typesafe enumerations have the following qualities:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>They are printable (they print as the name, not as an underlying <code>int</code> implementation).</p>&#13;
</li>&#13;
<li>&#13;
<p>They are almost as fast as <code>int</code> constants, but the code is more readable.</p>&#13;
</li>&#13;
<li>&#13;
<p>They can be easily iterated over.</p>&#13;
</li>&#13;
<li>&#13;
<p>They use a separate namespace for each <code>enum</code> type, which means you don’t have to prefix each with some sort of constant name, like <code>ACCOUNT_SAVINGS</code>, <code class="keep-together">ACCOUNT_CHECKING</code>, etc.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p><a data-primary="enum constants" data-type="indexterm" id="idm45290663282936"/>Enum constants are not compiled into clients, giving you the freedom&#13;
to reorder the constants within your <code>enum</code> without recompiling the&#13;
client classes. That does not mean you should, however; think about the&#13;
case where objects that use them have been persisted, and the person&#13;
designing the database mapping used the numeric values of the enums.&#13;
Bad idea to reorder then!</p>&#13;
&#13;
<p>Additionally, an <code>enum</code> type is a class, so it can, for example, implement arbitrary&#13;
interfaces; and you can add constructors, fields, and methods to an&#13;
<code>enum</code> class.</p>&#13;
&#13;
<p>Compared to Bloch’s Typesafe Enum pattern in the book:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Java <code>enums</code> are simpler to use and more readable (those in the book require a lot of methods, making them cumbersome to write).</p>&#13;
</li>&#13;
<li>&#13;
<p>Enums can be used in switch statements.</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>So there are many benefits and few pitfalls.</p>&#13;
&#13;
<p>The <code>enum</code>  keyword is at the same level as the keyword <code>class</code> in declarations. That is, an <code>enum</code> may be declared in its own file with public or default access. It may also be declared inside classes, much like nested or inner classes (see <a data-type="xref" href="#javacook-oo-SECT-6">Recipe 8.2</a>). <em>Media.java</em>, shown in <a data-type="xref" href="#javacook-CHP-8-EX-7">Example 8-1</a>, is a code sample showing the definition of a typesafe <code>enum</code>.</p>&#13;
<div data-type="example" id="javacook-CHP-8-EX-7">&#13;
<h5><span class="label">Example 8-1. </span>structure/Media.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">Media</code> <code class="o">{</code>&#13;
    <code class="n">BOOK</code><code class="o">,</code> <code class="n">MUSIC_CD</code><code class="o">,</code> <code class="n">MUSIC_VINYL</code><code class="o">,</code> <code class="n">MOVIE_VHS</code><code class="o">,</code> <code class="n">MOVIE_DVD</code><code class="o">;</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>Notice that an <code>enum</code> class <em>is</em> a class; see what <em>javap</em> thinks of the <code>Media</code> class:</p>&#13;
<pre data-type="programlisting" id="I_8_tt280">C:&gt; <strong>javap Media</strong>&#13;
Compiled from "Media.java"&#13;
public class Media extends java.lang.Enum{&#13;
    public static final Media BOOK;&#13;
    public static final Media MUSIC_CD;&#13;
    public static final Media MUSIC_VINYL;&#13;
    public static final Media MOVIE_VHS;&#13;
    public static final Media MOVIE_DVD;&#13;
    public static final Media[] values( );&#13;
    public static Media valueOf(java.lang.String);&#13;
    public Media(java.lang.String, int);&#13;
    public int compareTo(java.lang.Enum);&#13;
    public int compareTo(java.lang.Object);&#13;
    static {};&#13;
}&#13;
C:&gt;</pre>&#13;
&#13;
<p><em>Product.java</em>, shown in <a data-type="xref" href="#javacook-CHP-8-EX-8">Example 8-2</a>, is a code sample that uses the <code>Media</code> enum.</p>&#13;
<div data-type="example" id="javacook-CHP-8-EX-8">&#13;
<h5><span class="label">Example 8-2. </span>main/src/main/java/structure/Product.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Product</code> <code class="o">{</code>&#13;
    <code class="n">String</code> <code class="n">title</code><code class="o">;</code>&#13;
    <code class="n">String</code> <code class="n">artist</code><code class="o">;</code>&#13;
    <code class="n">Media</code>  <code class="n">media</code><code class="o">;</code>&#13;
&#13;
    <code class="kd">public</code> <code class="nf">Product</code><code class="o">(</code><code class="n">String</code> <code class="n">artist</code><code class="o">,</code> <code class="n">String</code> <code class="n">title</code><code class="o">,</code> <code class="n">Media</code> <code class="n">media</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">title</code> <code class="o">=</code> <code class="n">title</code><code class="o">;</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">artist</code> <code class="o">=</code> <code class="n">artist</code><code class="o">;</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">media</code> <code class="o">=</code> <code class="n">media</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="nd">@Override</code>&#13;
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">toString</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">switch</code> <code class="o">(</code><code class="n">media</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">case</code> <code class="nl">BOOK:</code>&#13;
            <code class="k">return</code> <code class="n">title</code> <code class="o">+</code> <code class="s">" is a book"</code><code class="o">;</code>&#13;
        <code class="k">case</code> <code class="nl">MUSIC_CD:</code>&#13;
            <code class="k">return</code> <code class="n">title</code> <code class="o">+</code> <code class="s">" is a CD"</code><code class="o">;</code>&#13;
        <code class="k">case</code> <code class="nl">MUSIC_VINYL:</code>&#13;
            <code class="k">return</code> <code class="n">title</code> <code class="o">+</code> <code class="s">" is a relic of the age of vinyl"</code><code class="o">;</code>&#13;
        <code class="k">case</code> <code class="nl">MOVIE_VHS:</code>&#13;
            <code class="k">return</code> <code class="n">title</code> <code class="o">+</code> <code class="s">" is on old video tape"</code><code class="o">;</code>&#13;
        <code class="k">case</code> <code class="nl">MOVIE_DVD:</code>&#13;
            <code class="k">return</code> <code class="n">title</code> <code class="o">+</code> <code class="s">" is on DVD"</code><code class="o">;</code>&#13;
        <code class="k">default</code><code class="o">:</code>&#13;
            <code class="k">return</code> <code class="n">title</code> <code class="o">+</code> <code class="s">": Unknown media "</code> <code class="o">+</code> <code class="n">media</code><code class="o">;</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>In <a data-type="xref" href="#javacook-CHP-8-EX-9">Example 8-3</a>, <code>MediaFancy</code> shows how operations (methods) can be added to enumerations; the <a data-primary="toString() method" data-type="indexterm" id="idm45290663123464"/><code>toString()</code>  method is overridden for the <code>Book</code> value of this enum.</p>&#13;
<div data-type="example" id="javacook-CHP-8-EX-9">&#13;
<h5><span class="label">Example 8-3. </span>main/src/main/java/structure/MediaFancy.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/** An example of an enum with method overriding */</code>&#13;
<code class="kd">public</code> <code class="kd">enum</code> <code class="n">MediaFancy</code> <code class="o">{</code>&#13;
    <code class="cm">/** The enum constant for a book, with a method override */</code>&#13;
    <code class="n">BOOK</code> <code class="o">{</code>&#13;
        <code class="kd">public</code> <code class="n">String</code> <code class="nf">toString</code><code class="o">()</code> <code class="o">{</code> <code class="k">return</code> <code class="s">"Book"</code><code class="o">;</code> <code class="o">}</code>&#13;
    <code class="o">},</code>&#13;
    <code class="cm">/** The enum constant for a Music CD */</code>&#13;
    <code class="n">MUSIC_CD</code><code class="o">,</code>&#13;
    <code class="cm">/** ... */</code>&#13;
    <code class="n">MUSIC_VINYL</code><code class="o">,</code>&#13;
    <code class="n">MOVIE_VHS</code><code class="o">,</code>&#13;
    <code class="n">MOVIE_DVD</code><code class="o">;</code>&#13;
&#13;
    <code class="cm">/** It is generally disparaged to have a main() in an enum;</code>&#13;
<code class="cm">     * please forgive this tiny demo class for doing so.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">MediaFancy</code><code class="o">[]</code> <code class="n">data</code> <code class="o">=</code>  <code class="o">{</code> <code class="n">BOOK</code><code class="o">,</code> <code class="n">MOVIE_DVD</code><code class="o">,</code> <code class="n">MUSIC_VINYL</code> <code class="o">};</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="n">MediaFancy</code> <code class="n">mf</code> <code class="o">:</code> <code class="n">data</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">mf</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>Running the <code>MediaFancy</code> program produces this output:</p>&#13;
&#13;
<pre data-type="programlisting">Book&#13;
MOVIE_DVD&#13;
MUSIC_VINYL</pre>&#13;
&#13;
<p>That is, the <code>Book</code> values print in a user-friendly way compared to the default way the other values print. In real life you’d want to extend this to all the values in the <code>enum</code>.</p>&#13;
&#13;
<p>Finally, <code>EnumList</code>, in <a data-type="xref" href="#javacook-CHP-8-EX-10">Example 8-4</a>, shows how to list all the possible values that a given <code>enum</code> can take on; simply iterate over the array returned by the enumeration class’s inherited <a data-primary="value() method" data-type="indexterm" id="idm45290662864216"/><code>values()</code> method.</p>&#13;
<div data-type="example" id="javacook-CHP-8-EX-10">&#13;
<h5><span class="label">Example 8-4. </span>structure/EnumList.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">EnumList</code> <code class="o">{</code>&#13;
    <code class="kd">enum</code> <code class="n">State</code> <code class="o">{</code>&#13;
        <code class="n">ON</code><code class="o">,</code> <code class="n">OFF</code><code class="o">,</code> <code class="n">UNKNOWN</code>&#13;
    <code class="o">}</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">for</code> <code class="o">(</code><code class="n">State</code> <code class="n">i</code> <code class="o">:</code> <code class="n">State</code><code class="o">.</code><code class="na">values</code><code class="o">())</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">i</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>The output of the <code>EnumList</code> program is this, of course:  <a data-primary="" data-startref="enu_ty" data-type="indexterm" id="idm45290662738328"/><a data-primary="" data-startref="oop_enu" data-type="indexterm" id="idm45290662737592"/></p>&#13;
&#13;
<pre data-type="programlisting">ON&#13;
OFF&#13;
UNKNOWN</pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.6 Avoiding NPEs with Optional" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-Optionals">&#13;
<h1>8.6 Avoiding NPEs with Optional</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="idm45290662833368">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="object-oriented programming" data-secondary="NPEs" data-type="indexterm" id="idm45290662832168"/><a data-primary="NPEs" data-type="indexterm" id="idm45290662831224"/>You worry about null references causing a <code>NullPointerException</code> (NPE) in your code.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="idm45290662829720">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use <code>java.util.Optional</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discusssion" data-type="sect2"><div class="sect2" id="idm45290662827656">&#13;
<h2>Discusssion</h2>&#13;
&#13;
<p>The developer who invented the notion of null pointers,&#13;
and a key early contributor to our discipline, has described the null reference as&#13;
<a href="https://en.wikipedia.org/wiki/Tony_Hoare">“my billion-dollar mistake”</a>. However, use of <code>null</code> is not going away anytime soon.</p>&#13;
&#13;
<p>What we can do is make clear that we worry about null pointers in certain contexts.&#13;
For this purpose, Java 8 introduced the class <code>java.util.Optional</code>.&#13;
The <code>Optional</code> is an object wrapper around a possibly-null object reference.&#13;
The <code>Optional</code> wrapper has a long history;&#13;
a similar construct is found in LLVM’s ADT, where its <code>Optional</code> describes&#13;
itself in turn as “in the spirit of OCaml’s <em>opt</em> variant.”</p>&#13;
&#13;
<p><code>Optionals</code> can be created with one of the creational methods:</p>&#13;
<dl>&#13;
<dt><code>Optional.empty()</code></dt>&#13;
<dd>&#13;
<p>Returns an empty optional</p>&#13;
</dd>&#13;
<dt><code>Optional.of(T obj)</code></dt>&#13;
<dd>&#13;
<p>Returns a nonempty optional containing the given value</p>&#13;
</dd>&#13;
<dt><code>Optional.ofNullable(T obj)</code></dt>&#13;
<dd>&#13;
<p>Returns either an empty optional or one containing the given value</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>The basic operation of this class is to behave in one of two ways, depending on whether it is full or empty.&#13;
Optional objects are immutable, so they cannot transition&#13;
from one state to the other.</p>&#13;
&#13;
<p>The simplest use is to invoke <a data-primary="isEmpty() method" data-type="indexterm" id="idm45290662815160"/><code>isEmpty()</code> or its opposite <a data-primary="isPresent() method" data-type="indexterm" id="idm45290662814072"/><code>isPresent()</code>&#13;
and use program logic to behave differently.&#13;
This is not much different from using an <code>if</code> statement to check for null,&#13;
but it puts the choice in front of you,&#13;
making it less likely that you’ll forget to check:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">Optional</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">opt</code> <code class="o">=</code> <code class="n">Optional</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="s">"What a day!"</code><code class="o">);</code>&#13;
<code class="n">opt</code> <code class="o">==&gt;</code> <code class="n">Optional</code><code class="o">[</code><code class="n">What</code> <code class="n">a</code> <code class="n">day</code><code class="o">!]</code>&#13;
&#13;
<code class="n">jshell</code><code class="o">&gt;</code> <code class="nf">if</code> <code class="o">(</code><code class="n">opt</code><code class="o">.</code><code class="na">isPresent</code><code class="o">())</code> <code class="o">{</code>&#13;
   <code class="o">...&gt;</code>     <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Value is "</code> <code class="o">+</code> <code class="n">opt</code><code class="o">.</code><code class="na">get</code><code class="o">());</code>&#13;
   <code class="o">...&gt;</code> <code class="o">}</code> <code class="k">else</code> <code class="o">{</code>&#13;
   <code class="o">...&gt;</code>     <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Value is not present."</code><code class="o">);</code>&#13;
   <code class="o">...&gt;</code> <code class="o">}</code>&#13;
<code class="n">Value</code> <code class="n">is</code> <code class="n">What</code> <code class="n">a</code> <code class="n">day</code><code class="o">!</code></pre>&#13;
&#13;
<p>A better form would use the <a data-primary="orElse() method" data-type="indexterm" id="idm45290662809752"/><code>orElse</code> method:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">jshell</code><code class="o">&gt;</code> <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Value is "</code> <code class="o">+</code> <code class="n">opt</code><code class="o">.</code><code class="na">orElse</code><code class="o">(</code><code class="s">"not present"</code><code class="o">));</code>&#13;
<code class="n">Value</code> <code class="n">is</code> <code class="n">What</code> <code class="n">a</code> <code class="n">day</code><code class="o">!</code></pre>&#13;
&#13;
<p>A useful use case is that of passing values into methods.&#13;
The object can be wrapped in an <code>Optional</code> either before it is passed&#13;
to a method or after; the latter is useful when migrating from code&#13;
that didn’t use <code>Optional</code> from the start.&#13;
The <code>Item</code> demo in <a data-type="xref" href="#javacook-oo-ex-optional-item">Example 8-5</a> might represent part of a shipments tracking program,&#13;
a lending library manager, or anything else that has time-related data&#13;
which might be missing.</p>&#13;
<div data-type="example" id="javacook-oo-ex-optional-item">&#13;
<h5><span class="label">Example 8-5. </span>main/src/main/java/oo/OptionalDemo.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="n">List</code><code class="o">.</code><code class="na">of</code><code class="o">(</code>&#13;
            <code class="k">new</code> <code class="nf">Item</code><code class="o">(</code><code class="s">"Item 1"</code><code class="o">,</code> <code class="n">LocalDate</code><code class="o">.</code><code class="na">now</code><code class="o">().</code><code class="na">plusDays</code><code class="o">(</code><code class="mi">7</code><code class="o">)),</code>&#13;
            <code class="k">new</code> <code class="nf">Item</code><code class="o">(</code><code class="s">"Item 2"</code><code class="o">)).</code>&#13;
                <code class="n">forEach</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">::</code><code class="n">println</code><code class="o">);</code>&#13;
    <code class="kd">static</code> <code class="kd">class</code> <code class="nc">Item</code> <code class="o">{</code>&#13;
        <code class="n">String</code> <code class="n">name</code><code class="o">;</code>&#13;
        <code class="n">Optional</code><code class="o">&lt;</code><code class="n">LocalDate</code><code class="o">&gt;</code> <code class="n">dueDate</code><code class="o">;</code>&#13;
        <code class="n">Item</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">this</code><code class="o">(</code><code class="n">name</code><code class="o">,</code> <code class="kc">null</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">Item</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">,</code> <code class="n">LocalDate</code> <code class="n">dueDate</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="k">this</code><code class="o">.</code><code class="na">name</code> <code class="o">=</code> <code class="n">name</code><code class="o">;</code>&#13;
            <code class="k">this</code><code class="o">.</code><code class="na">dueDate</code> <code class="o">=</code> <code class="n">Optional</code><code class="o">.</code><code class="na">ofNullable</code><code class="o">(</code><code class="n">dueDate</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
&#13;
        <code class="kd">public</code> <code class="n">String</code> <code class="nf">toString</code><code class="o">()</code> <code class="o">{</code>&#13;
            <code class="k">return</code> <code class="n">String</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"%s %s"</code><code class="o">,</code> <code class="n">name</code><code class="o">,</code>&#13;
                <code class="n">dueDate</code><code class="o">.</code><code class="na">isPresent</code><code class="o">()</code> <code class="o">?</code>&#13;
                    <code class="s">"Item is due on "</code> <code class="o">+</code> <code class="n">dueDate</code><code class="o">.</code><code class="na">get</code><code class="o">()</code> <code class="o">:</code>&#13;
                    <code class="s">"Sorry, do not know when item is due"</code><code class="o">);</code>&#13;
        <code class="o">}</code>&#13;
    <code class="o">}</code></pre></div>&#13;
&#13;
<p>There are methods that throw exceptions, that return null, and so on.&#13;
There are also methods for interacting with the Streams mechanism (see&#13;
<a data-type="xref" href="ch09.html#javacook-fp-streams1-1">Recipe 9.3</a>).&#13;
A full list of <code>Optional</code>’s methods is at the start of the <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/util/Optional.html">javadoc page</a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.7 Enforcing the Singleton Pattern" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-10">&#13;
<h1>8.7 Enforcing the Singleton Pattern</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-10.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="object-oriented programming" data-secondary="singleton patterns" data-type="indexterm" id="oop_sp"/><a data-primary="singleton patterns" data-type="indexterm" id="sp_ab"/>You want to be sure there is only one instance of your class in a given Java Virtual Machine, or at least within your application.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-10.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>There are several methods of making&#13;
your class enforce the Singleton pattern:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>Enum implementation</p>&#13;
</li>&#13;
<li>&#13;
<p>Having only a private constructor (or multiple) and a <code>getInstance()</code> method</p>&#13;
</li>&#13;
<li>&#13;
<p>Use a framework such as Spring or CDI (<a data-type="xref" href="#javacook-oo-SECT-di">Recipe 8.9</a>) configured to give&#13;
Singleton-style instantiation of plain classes</p>&#13;
</li>&#13;
</ul>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-10.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>It is often useful to ensure that only one instance of a class gets created, usually to funnel all requests for some resource through a single point. An example of a Singleton from the standard API is <code>java.lang.Runtime</code>: you cannot create instances of <code>Runtime</code>; you simply ask for a reference by calling the static method <a data-primary="Runtime.getRuntime() method" data-type="indexterm" id="idm45290662407720"/><code>Runtime.getRuntime()</code>. Singleton is also an example of a design pattern that can be easily implemented.&#13;
In all forms, the point of the Singleton implementation is to provide an instance&#13;
in which certain methods can run, typically to control access to some <span class="keep-together">resource.</span></p>&#13;
&#13;
<p>The easiest implementation uses a Java <code>enum</code> to provide Singleton-ness.&#13;
The <code>enum</code> mechanism already guarantees that only one instance of each enum constant&#13;
will exist in a given JVM context, so this technique piggy-backs on that, as shown in <a data-type="xref" href="#javacook-oo-singleton-1">Example 8-6</a>.</p>&#13;
<div data-type="example" id="javacook-oo-singleton-1">&#13;
<h5><span class="label">Example 8-6. </span>main/src/main/java/oo/EnumSingleton.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">enum</code> <code class="n">EnumSingleton</code> <code class="o">{</code>&#13;
&#13;
    <code class="n">INSTANCE</code><code class="o">;</code>&#13;
&#13;
    <code class="c1">// instance methods protected by singleton-ness would be here...</code>&#13;
&#13;
    <code class="cm">/** A simple demo method */</code>&#13;
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">demoMethod</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="s">"demo"</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>Using it is simple:</p>&#13;
&#13;
<pre data-type="programlisting">        // Demonstrate the enum method:&#13;
        EnumSingleton.INSTANCE.demoMethod();</pre>&#13;
&#13;
<p>The next easiest implementation consists of a private constructor and a field to hold its result, as well as a static accessor method with a name like <code>getInstance()</code>.</p>&#13;
&#13;
<p>The private field can be assigned from within a static initializer block or, more simply, by using an initializer. The <a data-primary="getInstance() method" data-type="indexterm" id="idm45290662381112"/><code>getInstance()</code> method (which must be public) then simply returns this instance:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">Singleton</code> <code class="o">{</code>&#13;
&#13;
    <code class="cm">/**</code>&#13;
<code class="cm">     * Static Initializer is run before class is available to code, avoiding</code>&#13;
<code class="cm">     * broken anti-pattern of lazy initialization in instance method.</code>&#13;
<code class="cm">     * For more complicated construction, could use static block initializer.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="n">Singleton</code> <code class="n">instance</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Singleton</code><code class="o">();</code>&#13;
&#13;
    <code class="cm">/** A private Constructor prevents any other class from instantiating. */</code>&#13;
    <code class="kd">private</code> <code class="nf">Singleton</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="c1">// nothing to do this time</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Static 'instance' method */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="n">Singleton</code> <code class="nf">getInstance</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="n">instance</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="c1">// other methods protected by singleton-ness would be here...</code>&#13;
&#13;
    <code class="cm">/** A simple demo method */</code>&#13;
    <code class="kd">public</code> <code class="n">String</code> <code class="nf">demoMethod</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="s">"demo"</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Note that the method of using<a data-primary="lazy evaluation" data-type="indexterm" id="idm45290662377720"/> <em>lazy evaluation</em> in the <code>getInstance()</code> method (as in <em>Design Patterns</em>) is not necessary in Java because Java already uses <em>lazy loading</em>. Your <code>Singleton</code> class will probably not get loaded until its <code>getInstance()</code> is called, so there is no point in trying to defer the <code>Singleton</code> construction until it’s needed by having <code>getInstance()</code> test the <code>singleton</code> variable for null and creating the singleton there.</p>&#13;
&#13;
<p>Using this class is equally simple: simply get the instance reference, and invoke methods on it:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting">        <code class="c1">// Demonstrate the codeBased method:</code>&#13;
        <code class="n">Singleton</code><code class="o">.</code><code class="na">getInstance</code><code class="o">().</code><code class="na">demoMethod</code><code class="o">();</code></pre>&#13;
&#13;
<p>Some commentators believe that a code-based Singleton should also provide a <code>public final clone()</code>&#13;
method that just throws an exception, in order to avoid subclasses that cheat and <a data-primary="clone() method" data-type="indexterm" id="idm45290662215320"/><code>clone()</code> the&#13;
Singleton. However, it is clear that a class with only a private constructor cannot be&#13;
subclassed, so this paranoia does not appear to be <span class="keep-together">necessary.</span></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-10.5">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>The <code>Collections</code> class in <code>java.util</code> has methods <code>singletonList()</code>, <code>singletonMap()</code>, and <code>singletonSet()</code>, which give out an immutable <code>List</code>, <code>Map</code>, or <code>Set</code>, respectively, containing only the one object that is passed to the method. This does not, of course, convert the object into a Singleton in the sense of preventing that object from being cloned or other instances from being constructed.</p>&#13;
&#13;
<p>See page 127 of the original <em>Design Patterns</em> book.<a data-primary="" data-startref="oop_sp" data-type="indexterm" id="idm45290662251208"/><a data-primary="" data-startref="sp_ab" data-type="indexterm" id="idm45290662250200"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.8 Roll Your Own Exceptions" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-11">&#13;
<h1>8.8 Roll Your Own Exceptions</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-11.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="object-oriented programming" data-secondary="exceptions, custom" data-type="indexterm" id="idm45290662242808"/><a data-primary="exception handling, custom" data-type="indexterm" id="idm45290662241864"/>You’d like to use an application-specific exception class or two.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-11.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Go ahead and subclass <code>Exception</code>   or <code>RuntimeException</code>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-11.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>In theory, you could subclass <code>Throwable</code>  directly, but that’s considered rude. You normally subclass <code>Exception</code> (if you want a checked exception) or <code>RuntimeException</code> (if you want an  unchecked exception). Checked exceptions are those that an application developer is required to catch or throw upward by listing them in the <code>throws</code> clause of the invoking method.</p>&#13;
&#13;
<p>When subclassing either of these, it is customary to provide at least these <span class="keep-together">constructors:</span></p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A no-argument constructor</p>&#13;
</li>&#13;
<li>&#13;
<p>A one-string argument constructor</p>&#13;
</li>&#13;
<li>&#13;
<p>A two-argument constructor—a string message and a <code>Throwable</code> cause</p>&#13;
</li>&#13;
</ul>&#13;
&#13;
<p>The cause will appear if the code receiving the exception performs a stack trace operation on it,&#13;
with the prefix “Root Cause is” or similar. <a data-type="xref" href="#chessmoveexception">Example 8-7</a> shows these three constructors for an application-defined exception, <code>ChessMoveException</code>.</p>&#13;
<div data-type="example" id="chessmoveexception">&#13;
<h5><span class="label">Example 8-7. </span>main/src/main/java/oo/ChessMoveException.java</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/** A ChessMoveException is thrown  when the user makes an illegal move. */</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">ChessMoveException</code> <code class="kd">extends</code> <code class="n">Exception</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="kt">long</code> <code class="n">serialVersionUID</code> <code class="o">=</code> <code class="mi">802911736988179079L</code><code class="o">;</code>&#13;
&#13;
    <code class="kd">public</code> <code class="nf">ChessMoveException</code> <code class="o">()</code> <code class="o">{</code>&#13;
        <code class="kd">super</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="nf">ChessMoveException</code> <code class="o">(</code><code class="n">String</code> <code class="n">msg</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="kd">super</code><code class="o">(</code><code class="n">msg</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="kd">public</code> <code class="nf">ChessMoveException</code><code class="o">(</code><code class="n">String</code> <code class="n">msg</code><code class="o">,</code> <code class="n">Exception</code> <code class="n">cause</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="kd">super</code><code class="o">(</code><code class="n">msg</code><code class="o">,</code> <code class="n">cause</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-11.4">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>The javadoc documentation for <code>Exception</code> lists a large number of subclasses; you might look there first to see if there is one you can use.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.9 Using Dependency Injection" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-di">&#13;
<h1>8.9 Using Dependency Injection</h1>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Problem" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-di.1">&#13;
<h2>Problem</h2>&#13;
&#13;
<p><a data-primary="dependency injection" data-type="indexterm" id="di_ab"/><a data-primary="object-oriented programming" data-secondary="dependency injection" data-type="indexterm" id="oop_di"/>You want to avoid excessive coupling between classes, and you want to&#13;
avoid excessive code dedicated to object creation/lookup.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Solution" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-di.2">&#13;
<h2>Solution</h2>&#13;
&#13;
<p>Use a dependency injection framework.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Discussion" data-type="sect2"><div class="sect2" id="javacook-oo-SECT-di.3">&#13;
<h2>Discussion</h2>&#13;
&#13;
<p>A dependency injection framework allows you to have objects passed in to your&#13;
code instead of making you either create them explicitly (which ties your code&#13;
to the implementing class name, since you’re calling the constructor) or looking&#13;
for them (which requires use of a possibly cumbersome lookup API, such as JNDI, the&#13;
Java Naming and Directory Interface).</p>&#13;
&#13;
<p>Three of the best-known dependency injection frameworks are the<a data-primary="Spring Framework" data-type="indexterm" id="idm45290662109512"/><a data-primary="Java Enterprise Edition (Java EE)" data-type="indexterm" id="idm45290662108536"/><a data-primary="Context and Dependency Injection (CDI)" data-type="indexterm" id="idm45290662107896"/><a data-primary="CDI (Context and Dependency Injection)" data-type="indexterm" id="idm45290662107256"/><a data-primary="Google Guice" data-type="indexterm" id="idm45290662106568"/> <a href="http://springframework.org">Spring Framework</a>, the <a href="http://docs.oracle.com/javaee/6/tutorial/doc/giwhl.html">Java Enterprise Edition’s Context and Dependency Injection (CDI)</a>, and <a href="http://code.google.com/p/google-guice">Google Guice</a>. Suppose we have three classes, a <code>Model</code>, a <code>View</code>, and a <code>Controller</code>, implementing the traditional MVC pattern. Given that we may want to have different versions of some of these, especially the <code>View</code>, we’ll define Java interfaces for simple versions of the Model (in <a data-type="xref" href="#MVC_Model_interface">Example 8-8</a>) and View (in <a data-type="xref" href="#MVC_View_interface">Example 8-9</a>).</p>&#13;
<div data-type="example" id="MVC_Model_interface">&#13;
<h5><span class="label">Example 8-8. </span>MVC Model interface</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">Model</code> <code class="o">{</code>&#13;
	<code class="n">String</code> <code class="nf">getMessage</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
<div data-type="example" id="MVC_View_interface">&#13;
<h5><span class="label">Example 8-9. </span>main/src/main/java/di/View.java (MVC View interface)</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">interface</code> <code class="nc">View</code> <code class="o">{</code>&#13;
&#13;
    <code class="kt">void</code> <code class="nf">displayMessage</code><code class="o">();</code>&#13;
&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>The implementations of these are not shown, because they’re so trivial, but they are online.&#13;
The Controller in this example is a main program, no interface needed.&#13;
First, let’s see a version of the main program <em>not</em> using dependency injection.&#13;
Obviously the View requires the Model, to get the data to display:</p>&#13;
&#13;
<p><em>main/src/main/java/di/ControllerTightlyCoupled.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ControllerTightlyCoupled</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">Model</code> <code class="n">m</code> <code class="o">=</code> <code class="k">new</code> <code class="n">SimpleModel</code><code class="o">();</code>&#13;
        <code class="n">ConsoleViewer</code> <code class="n">v</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ConsoleViewer</code><code class="o">();</code>&#13;
        <code class="n">v</code><code class="o">.</code><code class="na">setModel</code><code class="o">(</code><code class="n">m</code><code class="o">);</code>&#13;
        <code class="n">v</code><code class="o">.</code><code class="na">displayMessage</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Here we have four tasks to undertake:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Create the Model.</p>&#13;
</li>&#13;
<li>&#13;
<p>Create the View.</p>&#13;
</li>&#13;
<li>&#13;
<p>Tie the Model into the View.</p>&#13;
</li>&#13;
<li>&#13;
<p>Ask the View to display some data.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>Now a version using dependency injection:</p>&#13;
&#13;
<p><em>main/src/main/java/di/spring/MainAndController.java - Spring Controller</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">MainAndController</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">ApplicationContext</code> <code class="n">ctx</code> <code class="o">=</code>&#13;
            <code class="k">new</code> <code class="nf">AnnotationConfigApplicationContext</code><code class="o">(</code><code class="s">"di.spring"</code><code class="o">);</code>&#13;
        <code class="n">View</code> <code class="n">v</code> <code class="o">=</code> <code class="n">ctx</code><code class="o">.</code><code class="na">getBean</code><code class="o">(</code><code class="s">"myView"</code><code class="o">,</code> <code class="n">View</code><code class="o">.</code><code class="na">class</code><code class="o">);</code>&#13;
        <code class="n">v</code><code class="o">.</code><code class="na">displayMessage</code><code class="o">();</code>&#13;
        <code class="o">((</code><code class="n">AbstractApplicationContext</code><code class="o">)</code> <code class="n">ctx</code><code class="o">).</code><code class="na">close</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>In this version, we have only three tasks:</p>&#13;
<ol>&#13;
<li>&#13;
<p>Set up the Spring context, which provides the dependency injection framework.</p>&#13;
</li>&#13;
<li>&#13;
<p>Get the View from the context; it already has the Model set into it!</p>&#13;
</li>&#13;
<li>&#13;
<p>Ask the View to display some data.</p>&#13;
</li>&#13;
&#13;
</ol>&#13;
&#13;
<p>Furthermore, we don’t depend on particular implementations of the interface.</p>&#13;
&#13;
<p>How does Spring know to inject, or provide, a Model to the View?&#13;
And how does it know what code to use for the View? There might be multiple&#13;
implementations of the View interface.&#13;
Of course we have to tell it these things, which we’ll do here with annotations:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Named</code><code class="o">(</code><code class="s">"myView"</code><code class="o">)</code>&#13;
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">ConsoleViewer</code> <code class="kd">implements</code> <code class="n">View</code> <code class="o">{</code>&#13;
&#13;
    <code class="n">Model</code> <code class="n">messageProvider</code><code class="o">;</code>&#13;
&#13;
    <code class="nd">@Override</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">displayMessage</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">messageProvider</code><code class="o">.</code><code class="na">getMessage</code><code class="o">());</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="nd">@Resource</code><code class="o">(</code><code class="n">name</code><code class="o">=</code><code class="s">"myModel"</code><code class="o">)</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setModel</code><code class="o">(</code><code class="n">Model</code> <code class="n">messageProvider</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="k">this</code><code class="o">.</code><code class="na">messageProvider</code> <code class="o">=</code> <code class="n">messageProvider</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>While Spring has provided its own annotations, it will also accept the&#13;
Java standard <code>@javax.annotation.Resource</code> annotation for injection&#13;
and <code>@java.inject.Named</code> to specify the injectee.</p>&#13;
&#13;
<p>Due to the persistence of information on the web, if you do a web search for Spring Injection,&#13;
you will probably find zillions of articles that refer to the older Spring 2.x way&#13;
of doing things, which is to use an XML configuration file.&#13;
You can still use this, but modern Spring practice is generally to use Java annotations&#13;
to configure the dependencies.</p>&#13;
&#13;
<p>Annotations&#13;
are also used in the <a data-primary="Java Enterprise Edition (Java EE)" data-type="indexterm" id="idm45290661794104"/><a data-primary="Context and Dependency Injection (CDI)" data-type="indexterm" id="idm45290661793400"/><a data-primary="CDI (Context and Dependency Injection)" data-type="indexterm" id="idm45290661792712"/>Java Enterprise Edition Contexts and Dependency Injection (CDI).&#13;
Although this is most widely used in web applications, we’ll reuse the same example,&#13;
using the open source Weld implementation of CDI.&#13;
CDI is quite a bit more powerful than Spring’s DI;&#13;
because in CDI we don’t even need to know the class from which a resource&#13;
is being injected, we don’t even need the interfaces from the Spring example!&#13;
First, the Controller, or main program, which requires a Weld-specific import or two because CDI was originally designed for use in enterprise applications:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">MainAndController</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">args</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="kd">final</code> <code class="n">Instance</code><code class="o">&lt;</code><code class="n">Object</code><code class="o">&gt;</code> <code class="n">weldInstance</code> <code class="o">=</code> <code class="k">new</code> <code class="n">Weld</code><code class="o">().</code><code class="na">initialize</code><code class="o">().</code><code class="na">instance</code><code class="o">();</code>&#13;
        <code class="n">weldInstance</code><code class="o">.</code><code class="na">select</code><code class="o">(</code><code class="n">ConsoleViewer</code><code class="o">.</code><code class="na">class</code><code class="o">).</code><code class="na">get</code><code class="o">().</code><code class="na">displayMessage</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>The <code>View</code> interface is shared between both implementations.&#13;
The <code>ConsoleViewer</code> implementation is similar too, except it isn’t coupled to the Model;&#13;
it just asks to have a <code>String</code> injected.&#13;
In this simple example there is only one <code>String</code> in the application; in a larger app&#13;
you would need one additional annotation to specify which string to inject.&#13;
Here is the CDI <code>ConsoleViewer</code>:</p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ConsoleViewer</code> <code class="kd">implements</code> <code class="n">View</code> <code class="o">{</code>&#13;
    <code class="nd">@Inject</code> <code class="nd">@MyModel</code>&#13;
    <code class="kd">private</code> <code class="n">String</code> <code class="n">message</code><code class="o">;</code>&#13;
&#13;
    <code class="nd">@Override</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">displayMessage</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="n">message</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Where does the injected <code>String</code> come from? From the Model, as before:</p>&#13;
&#13;
<p><em>main/src/main/java/di/cdi/ModelImpl.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">ModelImpl</code> <code class="o">{</code>&#13;
&#13;
    <code class="kd">public</code> <code class="nd">@Produces</code> <code class="nd">@MyModel</code> <code class="n">String</code> <code class="n">getMessage</code><code class="o">(</code><code class="n">InjectionPoint</code> <code class="n">ip</code><code class="o">)</code>&#13;
        <code class="kd">throws</code> <code class="n">IOException</code> <code class="o">{</code>&#13;
&#13;
        <code class="n">ResourceBundle</code> <code class="n">props</code> <code class="o">=</code> <code class="n">ResourceBundle</code><code class="o">.</code><code class="na">getBundle</code><code class="o">(</code><code class="s">"messages"</code><code class="o">);</code>&#13;
        <code class="k">return</code> <code class="n">props</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code>&#13;
            <code class="n">ip</code><code class="o">.</code><code class="na">getMember</code><code class="o">().</code><code class="na">getDeclaringClass</code><code class="o">().</code><code class="na">getSimpleName</code><code class="o">()</code> <code class="o">+</code> <code class="s">"."</code> <code class="o">+</code>&#13;
            <code class="n">ip</code><code class="o">.</code><code class="na">getMember</code><code class="o">().</code><code class="na">getName</code><code class="o">());</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="See Also" data-type="sect2"><div class="sect2" id="idm45290661685144">&#13;
<h2>See Also</h2>&#13;
&#13;
<p>Spring DI, Java EE CDI, and Guice all provide powerful <em>dependency injection</em>.&#13;
Spring’s is more widely used; Java EE’s has the same power and is built into every EE container.&#13;
All three can be used standalone or in a web application, with minor variations.&#13;
In the EE, Spring provides special support for web apps, and in EE containers, CDI is already set up so that the first statement in the <code>CDIMain</code> example is&#13;
not needed in an EE app. There are many books on Spring. One book specifically treats <a data-primary="JBoss Weld CDI for Java Platforms (Finnegan)" data-type="indexterm" id="idm45290661571528"/><a data-primary="Finnegan, Ken" data-secondary="JBoss Weld CDI for Java Platform" data-type="indexterm" id="idm45290661570728"/>Weld: <em><a class="orm:hideurl" href="http://shop.oreilly.com/product/9781782160182.do">JBoss Weld CDI for Java Platform</a></em>&#13;
by Ken Finnegan (O’Reilly).<a data-primary="" data-startref="di_ab" data-type="indexterm" id="idm45290661568536"/><a data-primary="" data-startref="oop_di" data-type="indexterm" id="idm45290661567624"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="8.10 Program: Plotter" data-type="sect1"><div class="sect1" id="javacook-oo-SECT-12">&#13;
<h1>8.10 Program: Plotter</h1>&#13;
&#13;
<p><a data-primary="object-oriented programming" data-secondary="Plotter program" data-type="indexterm" id="oop_pp"/><a data-primary="Plotter program" data-type="indexterm" id="pp_ab"/>Not  because it is very sophisticated, but because it is simple, this program serves as an&#13;
example of some of the things we’ve covered in this chapter, and also, in its subclasses,&#13;
provides a springboard for other discussions. This class describes a series of&#13;
old-fashioned (i.e., common in the 1970s and 1980s) pen plotters. A pen plotter, in case&#13;
you’ve never seen one, is a device that moves a pen around a piece of paper and draws&#13;
things. It can lift the pen off the paper or lower it, and it can draw lines, letters, and&#13;
so on. Before the rise of laser printers and ink-jet printers, pen plotters were the&#13;
dominant means of preparing charts of all sorts, as well as presentation slides (this was,&#13;
ah, well before the rise of programs like Harvard Presents and Microsoft PowerPoint).&#13;
Today, few, if any, companies still manufacture pen plotters, but I use them here because they are simple enough to be well understood from this brief description.  Today’s 3D printers&#13;
may be thought of as representing a resurgence of the pen plotter with just one additional&#13;
axis of motion. And a fancier pen.</p>&#13;
&#13;
<p>I’ll present a high-level class that abstracts the key characteristics of a series of such&#13;
plotters made by different vendors. It would be used, for example, in an analytical or&#13;
data-exploration program to draw colorful charts showing the relationships found in data.&#13;
But I don’t want my main program to worry about the gory details of any particular brand&#13;
of plotter, so I’ll abstract into a <code>Plotter</code> class, whose source is as follows:</p>&#13;
&#13;
<p><em>main/src/main/java/plotter/Plotter.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="cm">/**</code>&#13;
<code class="cm"> * Plotter abstract class. Must be subclassed</code>&#13;
<code class="cm"> * for X, DOS, Penman, HP plotter, etc.</code>&#13;
<code class="cm"> *</code>&#13;
<code class="cm"> * Coordinate space: X = 0 at left, increases to right.</code>&#13;
<code class="cm"> *        Y = 0 at top, increases downward (same as AWT).</code>&#13;
<code class="cm"> *</code>&#13;
<code class="cm"> * @author    Ian F. Darwin</code>&#13;
<code class="cm"> */</code>&#13;
<code class="kd">public</code> <code class="kd">abstract</code> <code class="kd">class</code> <code class="nc">Plotter</code> <code class="o">{</code>&#13;
    <code class="kd">public</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">MAXX</code> <code class="o">=</code> <code class="mi">800</code><code class="o">;</code>&#13;
    <code class="kd">public</code> <code class="kd">final</code> <code class="kt">int</code> <code class="n">MAXY</code> <code class="o">=</code> <code class="mi">600</code><code class="o">;</code>&#13;
    <code class="cm">/** Current X co-ordinate (same reference frame as AWT!) */</code>&#13;
    <code class="kd">protected</code> <code class="kt">int</code> <code class="n">curx</code><code class="o">;</code>&#13;
    <code class="cm">/** Current Y co-ordinate (same reference frame as AWT!) */</code>&#13;
    <code class="kd">protected</code> <code class="kt">int</code> <code class="n">cury</code><code class="o">;</code>&#13;
    <code class="cm">/** The current state: up or down */</code>&#13;
    <code class="kd">protected</code> <code class="kt">boolean</code> <code class="n">penUp</code><code class="o">;</code>&#13;
    <code class="cm">/** The current color */</code>&#13;
    <code class="kd">protected</code> <code class="kt">int</code> <code class="n">penColor</code><code class="o">;</code>&#13;
&#13;
    <code class="n">Plotter</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="n">penUp</code> <code class="o">=</code> <code class="kc">true</code><code class="o">;</code>&#13;
        <code class="n">curx</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code> <code class="n">cury</code> <code class="o">=</code> <code class="mi">0</code><code class="o">;</code>&#13;
    <code class="o">}</code>&#13;
    <code class="kd">abstract</code> <code class="kt">void</code> <code class="nf">rmoveTo</code><code class="o">(</code><code class="kt">int</code> <code class="n">incrx</code><code class="o">,</code> <code class="kt">int</code> <code class="n">incry</code><code class="o">);</code>&#13;
    <code class="kd">abstract</code> <code class="kt">void</code> <code class="nf">moveTo</code><code class="o">(</code><code class="kt">int</code> <code class="n">absx</code><code class="o">,</code> <code class="kt">int</code> <code class="n">absy</code><code class="o">);</code>&#13;
    <code class="kd">abstract</code> <code class="kt">void</code> <code class="nf">penUp</code><code class="o">();</code>&#13;
    <code class="kd">abstract</code> <code class="kt">void</code> <code class="nf">penDown</code><code class="o">();</code>&#13;
    <code class="kd">abstract</code> <code class="kt">void</code> <code class="nf">penColor</code><code class="o">(</code><code class="kt">int</code> <code class="n">c</code><code class="o">);</code>&#13;
&#13;
    <code class="kd">abstract</code> <code class="kt">void</code> <code class="nf">setFont</code><code class="o">(</code><code class="n">String</code> <code class="n">fName</code><code class="o">,</code> <code class="kt">int</code> <code class="n">fSize</code><code class="o">);</code>&#13;
    <code class="kd">abstract</code> <code class="kt">void</code> <code class="nf">drawString</code><code class="o">(</code><code class="n">String</code> <code class="n">s</code><code class="o">);</code>&#13;
&#13;
    <code class="cm">/* Concrete methods */</code>&#13;
&#13;
    <code class="cm">/** Draw a box of width w and height h */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">drawBox</code><code class="o">(</code><code class="kt">int</code> <code class="n">w</code><code class="o">,</code> <code class="kt">int</code> <code class="n">h</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">penDown</code><code class="o">();</code>&#13;
        <code class="n">rmoveTo</code><code class="o">(</code><code class="n">w</code><code class="o">,</code> <code class="mi">0</code><code class="o">);</code>&#13;
        <code class="n">rmoveTo</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="n">h</code><code class="o">);</code>&#13;
        <code class="n">rmoveTo</code><code class="o">(-</code><code class="n">w</code><code class="o">,</code> <code class="mi">0</code><code class="o">);</code>&#13;
        <code class="n">rmoveTo</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code> <code class="o">-</code><code class="n">h</code><code class="o">);</code>&#13;
        <code class="n">penUp</code><code class="o">();</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Draw a box given an AWT Dimension for its size */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">drawBox</code><code class="o">(</code><code class="n">java</code><code class="o">.</code><code class="na">awt</code><code class="o">.</code><code class="na">Dimension</code> <code class="n">d</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">drawBox</code><code class="o">(</code><code class="n">d</code><code class="o">.</code><code class="na">width</code><code class="o">,</code> <code class="n">d</code><code class="o">.</code><code class="na">height</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Draw a box given an AWT Rectangle for its location and size */</code>&#13;
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">drawBox</code><code class="o">(</code><code class="n">java</code><code class="o">.</code><code class="na">awt</code><code class="o">.</code><code class="na">Rectangle</code> <code class="n">r</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">moveTo</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="na">x</code><code class="o">,</code> <code class="n">r</code><code class="o">.</code><code class="na">y</code><code class="o">);</code>&#13;
        <code class="n">drawBox</code><code class="o">(</code><code class="n">r</code><code class="o">.</code><code class="na">width</code><code class="o">,</code> <code class="n">r</code><code class="o">.</code><code class="na">height</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
&#13;
    <code class="cm">/** Show the current location; useful for</code>&#13;
<code class="cm">     * testing, if nothing else.</code>&#13;
<code class="cm">     */</code>&#13;
    <code class="kd">public</code> <code class="n">Point</code> <code class="nf">getLocation</code><code class="o">()</code> <code class="o">{</code>&#13;
        <code class="k">return</code> <code class="k">new</code> <code class="nf">Point</code><code class="o">(</code><code class="n">curx</code><code class="o">,</code> <code class="n">cury</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>Note the variety of abstract methods. Those related to motion, pen control, or drawing are left abstract, due to the number of different ways of implementing motion on radically different devices. However, the method for drawing a rectangle (<code>drawBox</code>) has a default implementation, which simply puts the currently selected pen onto the paper at the last-moved-to location, draws the four sides, and raises the pen. Subclasses for smarter plotters will likely override this method, but subclasses for less-evolved plotters will probably use the default version. This method also has two overloaded convenience methods for cases where the client has an AWT Dimension for the size or an AWT Rectangle for the location and size.</p>&#13;
&#13;
<p>To demonstrate one of the subclasses of this program, consider the following simple driver program. This is intended to simulate a larger graphics application such as gnuplot.&#13;
The <a data-primary="Class.forName() method" data-type="indexterm" id="idm45290661549704"/><code>Class.forName()</code> near the beginning of <code>main</code> is discussed in <a data-type="xref" href="ch17.html#javacook-reflection-SECT-2">Recipe 17.2</a>; for now, you can take my word that it simply creates an instance of the given subclass, which we store in a <code>Plotter</code>  reference named <code>r</code> and use to draw the plot:</p>&#13;
&#13;
<p><em>main/src/main/java/plotter/PlotDriver.java</em></p>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code> <code class="kd">class</code> <code class="nc">PlotDriver</code> <code class="o">{</code>&#13;
&#13;
    <code class="cm">/** Construct a Plotter driver, and try it out. */</code>&#13;
    <code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code><code class="o">[]</code> <code class="n">argv</code><code class="o">)</code> <code class="o">{</code>&#13;
        <code class="n">Plotter</code> <code class="n">r</code> <code class="o">;</code>&#13;
        <code class="k">if</code> <code class="o">(</code><code class="n">argv</code><code class="o">.</code><code class="na">length</code> <code class="o">!=</code> <code class="mi">1</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Usage: PlotDriver driverclass"</code><code class="o">);</code>&#13;
            <code class="k">return</code><code class="o">;</code>&#13;
        <code class="o">}</code>&#13;
        <code class="k">try</code> <code class="o">{</code>&#13;
            <code class="n">Class</code><code class="o">&lt;?&gt;</code> <code class="n">c</code> <code class="o">=</code> <code class="n">Class</code><code class="o">.</code><code class="na">forName</code><code class="o">(</code><code class="n">argv</code><code class="o">[</code><code class="mi">0</code><code class="o">]);</code>&#13;
            <code class="n">Object</code> <code class="n">o</code> <code class="o">=</code> <code class="n">c</code><code class="o">.</code><code class="na">newInstance</code><code class="o">();</code>&#13;
            <code class="k">if</code> <code class="o">(!(</code><code class="n">o</code> <code class="k">instanceof</code> <code class="n">Plotter</code><code class="o">))</code>&#13;
                <code class="k">throw</code> <code class="k">new</code> <code class="nf">ClassNotFoundException</code><code class="o">(</code><code class="s">"Not instanceof Plotter"</code><code class="o">);</code>&#13;
            <code class="n">r</code> <code class="o">=</code> <code class="o">(</code><code class="n">Plotter</code><code class="o">)</code><code class="n">o</code><code class="o">;</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">ClassNotFoundException</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">System</code><code class="o">.</code><code class="na">err</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Sorry, class "</code> <code class="o">+</code> <code class="n">argv</code><code class="o">[</code><code class="mi">0</code><code class="o">]</code> <code class="o">+</code>&#13;
                    <code class="s">" not a plotter class"</code><code class="o">);</code>&#13;
            <code class="k">return</code><code class="o">;</code>&#13;
        <code class="o">}</code> <code class="k">catch</code> <code class="o">(</code><code class="n">Exception</code> <code class="n">e</code><code class="o">)</code> <code class="o">{</code>&#13;
            <code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">();</code>&#13;
            <code class="k">return</code><code class="o">;</code>&#13;
        <code class="o">}</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">penDown</code><code class="o">();</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">penColor</code><code class="o">(</code><code class="mi">1</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">moveTo</code><code class="o">(</code><code class="mi">200</code><code class="o">,</code> <code class="mi">200</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">penColor</code><code class="o">(</code><code class="mi">2</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">drawBox</code><code class="o">(</code><code class="mi">123</code><code class="o">,</code> <code class="mi">200</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">rmoveTo</code><code class="o">(</code><code class="mi">10</code><code class="o">,</code> <code class="mi">20</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">penColor</code><code class="o">(</code><code class="mi">3</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">drawBox</code><code class="o">(</code><code class="mi">123</code><code class="o">,</code> <code class="mi">200</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">penUp</code><code class="o">();</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">moveTo</code><code class="o">(</code><code class="mi">300</code><code class="o">,</code> <code class="mi">100</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">penDown</code><code class="o">();</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">setFont</code><code class="o">(</code><code class="s">"Helvetica"</code><code class="o">,</code> <code class="mi">14</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">drawString</code><code class="o">(</code><code class="s">"Hello World"</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">penColor</code><code class="o">(</code><code class="mi">4</code><code class="o">);</code>&#13;
        <code class="n">r</code><code class="o">.</code><code class="na">drawBox</code><code class="o">(</code><code class="mi">10</code><code class="o">,</code> <code class="mi">10</code><code class="o">);</code>&#13;
    <code class="o">}</code>&#13;
<code class="o">}</code></pre>&#13;
&#13;
<p>We don’t show any actual subclasses of this <code>Plotter</code> class in upcoming chapters, however there is a PlotterAWT proof-of-concept in the same source folder, and one could implement this for PostScript, PDF, or other output technologies.<a data-primary="" data-startref="oop_pp" data-type="indexterm" id="idm45290661224120"/><a data-primary="" data-startref="pp_ab" data-type="indexterm" id="idm45290661223240"/><a data-primary="" data-startref="oop_ch" data-type="indexterm" id="idm45290660950808"/></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<div data-type="footnotes"><p data-type="footnote" id="idm45290664734344"><sup><a href="ch08.html#idm45290664734344-marker">1</a></sup> A value class is one used mainly to hold state, rather than logic: a <code>Person</code> is a value class, whereas <code>java.lang.Math</code> is not. Many classes are somewhere in between.</p><p data-type="footnote" id="idm45290663675912"><sup><a href="ch08.html#idm45290663675912-marker">2</a></sup> Of course these lights wouldn’t have remote power-off. But the computers might, for maintenance purposes.</p><p data-type="footnote" id="idm45290663297016"><sup><a href="ch08.html#idm45290663297016-marker">3</a></sup> For Java folks not that familiar with C/C++, C is the older, non-OO language; C++ is an OO derivative of C; and Java is in part a portable, more strongly typesafe derivative of C++.</p></div></div></section></body></html>