<html><head></head><body><section data-pdf-bookmark="Chapter 5. Browser-Specific Manipulation" data-type="chapter" epub:type="chapter"><div class="chapter" id="ch05">&#13;
<h1><span class="label">Chapter 5. </span>Browser-Specific Manipulation</h1>&#13;
&#13;
&#13;
<p>As you have seen so far, many features of the Selenium WebDriver API are compatible across browsers, i.e., we can use Selenium WebDriver to control different types of browsers programmatically. Other parts of the Selenium WebDriver API are not interoperable among browsers. In other words, there are some WebDriver characteristics available for some browsers (e.g., Chrome or Edge) that are unavailable (or different) for others (e.g., Firefox). This chapter reviews these browser-specific features.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Browser Capabilities" data-type="sect1"><div class="sect1" id="browser-caps">&#13;
<h1>Browser Capabilities</h1>&#13;
&#13;
<p>Selenium WebDriver <a data-primary="browser-specific capabilities" data-secondary="Capabilities hierarchy and interface" data-type="indexterm" id="ch5_term1"/><a data-primary="Capabilities hierarchy and interface" data-type="indexterm" id="ch5_term6"/>allows specifying browser-specific aspects by using <em>capabilities</em>. Examples of capabilities are headless mode, page loading strategies, use of web extensions, or push notifications management, among many others. As <a data-type="xref" href="#capabilities-hierarchy">Figure 5-1</a> shows, the <a data-primary="Java" data-secondary="browser capabilities in" data-type="indexterm" id="ch5_term2"/><a data-primary="Chrome" data-secondary="capabilities, overview of" data-type="indexterm" id="ch5_term3"/><a data-primary="Firefox" data-secondary="capabilities, overview of" data-type="indexterm" id="ch5_term4"/><a data-primary="Edge" data-secondary="capabilities, overview of" data-type="indexterm" id="ch5_term5"/>Selenium WebDriver API provides a set of Java classes to define these capabilities. The <code>Capabilities</code> interface is at the top of this hierarchy. Internally, the capabilities interface handles data using key-value pairs that encapsulate specific aspects of a browser. Then, different Java classes implement this interface to specify capabilities for web browsers (Chrome, Edge, Firefox, etc.). <a data-type="xref" href="#capabilities-hierarchy-description">Table 5-1</a> summarizes the main classes of the <code>Capabilities</code> hierarchy and their <a data-primary="browser-specific capabilities" data-secondary="browser specification for" data-type="indexterm" id="idm45849722418896"/>corresponding target browsers.</p>&#13;
&#13;
<figure><div class="figure" id="capabilities-hierarchy">&#13;
<img alt="hosw 0501" src="assets/hosw_0501.png"/>&#13;
<h6><span class="label">Figure 5-1. </span>Capabilities hierarchy</h6>&#13;
</div></figure>&#13;
<table id="capabilities-hierarchy-description">&#13;
<caption><span class="label">Table 5-1. </span>Description of the Capabilities hierarchy</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Package</th>&#13;
<th>Class</th>&#13;
<th>Browser</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">MutableCapabilities</code></pre></div></td>&#13;
<td><p>Generic (cross-browser)</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code><code class="o">.</code><code class="na">chrome</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">ChromeOptions</code></pre></div></td>&#13;
<td><p>Chrome</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code><code class="o">.</code><code class="na">edge</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">EdgeOptions</code></pre></div></td>&#13;
<td><p>Edge</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code><code class="o">.</code><code class="na">firefox</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">FirefoxOptions</code></pre></div></td>&#13;
<td><p>Firefox</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code><code class="o">.</code><code class="na">safari</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">SafariOptions</code></pre></div></td>&#13;
<td><p>Safari</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code><code class="o">.</code><code class="na">opera</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">OperaOptions</code></pre></div></td>&#13;
<td><p>Opera</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code><code class="o">.</code><code class="na">ie</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">InternetExplorerOptions</code></pre></div></td>&#13;
<td><p>Internet Explorer</p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code><code class="o">.</code><code class="na">remote</code></pre></div></td>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">DesiredCapabilities</code></pre></div></td>&#13;
<td><p>Remote browsers (see <a data-type="xref" href="ch06.html#ch06">Chapter 6</a>)</p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>The following subsections <a data-startref="ch5_term1" data-type="indexterm" id="idm45849722062816"/><a data-startref="ch5_term6" data-type="indexterm" id="idm45849722061792"/>review the most relevant capabilities for the major web browsers discussed in this book, i.e., Chrome, Edge, and Firefox. As <a data-primary="Chromium" data-secondary="browser capabilities with" data-type="indexterm" id="idm45849722061056"/><a data-primary="Edge" data-secondary="as Chromium-based browser" data-secondary-sortas="Chromium-based browser" data-type="indexterm" id="idm45849722060208"/><a data-primary="ChromeOptions" data-type="indexterm" id="idm45849722059056"/><a data-primary="EdgeOptions" data-type="indexterm" id="idm45849722058384"/>Chrome and Edge are both Chromium-based browsers, the capabilities available for both browsers are equivalent. This fact is reflected in <a data-type="xref" href="#capabilities-hierarchy">Figure 5-1</a>, showing that capability classes <span class="keep-together"><code>ChromeOptions</code></span> and <code>EdgeOptions</code> both inherit from the same <a data-startref="ch5_term2" data-type="indexterm" id="idm45849722038912"/><a data-startref="ch5_term3" data-type="indexterm" id="idm45849722038208"/><a data-startref="ch5_term4" data-type="indexterm" id="idm45849722037536"/><a data-startref="ch5_term5" data-type="indexterm" id="idm45849722036864"/>parent (called <span class="keep-together"><code>ChromiumOptions</code></span>).</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Headless Browser" data-type="sect2"><div class="sect2" id="idm45849722062560">&#13;
<h2>Headless Browser</h2>&#13;
&#13;
<p>Browsers that do <a data-primary="browser-specific capabilities" data-secondary="headless browsers" data-type="indexterm" id="ch5_term9"/><a data-primary="headless browsers" data-type="indexterm" id="ch5_term10"/>not require a GUI to interact with web applications are known as <em>headless</em> browsers. One of the <a data-primary="end-to-end (E2E) testing" data-secondary="headless browsers for" data-type="indexterm" id="idm45849722014192"/>primary uses of these browsers is end-to-end testing, i.e., automated interaction with web applications. Current web browsers such as Chrome, Edge, or Firefox can operate as headless browsers. The Selenium WebDriver API allows starting these browsers in headless mode using capabilities. To that aim, first, you need to <a data-primary="Edge" data-secondary="WebDriver instantiation with" data-type="indexterm" id="idm45849722013216"/><a data-primary="Firefox" data-secondary="WebDriver instantiation with" data-type="indexterm" id="idm45849722012368"/><a data-primary="Chrome" data-secondary="WebDriver instantiation with" data-type="indexterm" id="ch5_term7"/>create an instance of the browser capabilities. In the major browsers, these <a data-primary="FirefoxOptions" data-type="indexterm" id="idm45849722010304"/>objects are instances of <code>ChromeOptions</code>, <code>EdgeOptions</code>, or <code>FirefoxOptions</code>, respectively. Then, you need to enable the headless mode by <a data-primary="setHeadless(true) method" data-type="indexterm" id="idm45849722008416"/>invoking the method <code>setHeadless(true)</code> in the browser capabilities object. Finally, you need to set these capabilities when creating a <code>WebDriver</code> object.</p>&#13;
&#13;
<p>As <a data-type="xref" href="ch03.html#webdriver-creation">“WebDriver Creation”</a> explained, we have <a data-primary="WebDriver" data-secondary="object creation for" data-type="indexterm" id="idm45849722005232"/><a data-primary="objects" data-secondary="WebDriver" data-type="indexterm" id="idm45849722004256"/>different ways to create <span class="keep-together"><code>WebDriver</code></span> objects. First, we can use a <code>WebDriver</code> constructor (e.g., <code>new ChromeDriver()</code>). Also, we can use a <a data-primary="builder in RemoteWebDriver" data-type="indexterm" id="idm45849722001536"/><a data-primary="RemoteWebDriver.builder" data-type="indexterm" id="idm45849722000784"/><a data-primary="RemoteWebDriver class" data-secondary="builder" data-type="indexterm" id="idm45849722000112"/><a data-primary="WebDriver" data-secondary="builder for" data-type="indexterm" id="idm45849721999168"/>builder provided by the Selenium WebDriver API (i.e., <code>RemoteWebDriver.builder()</code>). Finally, we can use the <a data-primary="WebDriver" data-secondary="and WebDriverManager" data-secondary-sortas="WebDriverManager" data-type="indexterm" id="idm45849721997664"/><a data-primary="WebDriverManager" data-secondary="and WebDriver" data-secondary-sortas="WebDriver" data-type="indexterm" id="idm45849721996448"/>WebDriverManager builder to resolve the driver and create the <code>WebDriver</code> instance in a single line of code. The following examples show these alternatives, used in conjunction with browser capabilities to enable the headless browser mode, namely:</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p><a data-type="xref" href="#caps_chrome_headless">Example 5-1</a> uses Chrome in headless mode. This example creates a <code>WebDriver</code> instance using the <a data-primary="ChromeDriver" data-startref="ch5_term8" data-type="indexterm" id="idm45849721992704"/>required constructor (<code>ChromeDriver</code> in this case).</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-type="xref" href="#caps_edge_headless">Example 5-2</a> uses Edge in headless mode. This example creates a <code>WebDriver</code> instance using the builder available in the Selenium WebDriver API.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-type="xref" href="#caps_firefox_headless">Example 5-3</a> uses Firefox in headless mode. This example creates a <code>WebDriver</code> instance using WebDriverManager. Notice that the setup method is not required in this case since WebDriverManager resolves the driver in the same line as the WebDriver instantiation.</p>&#13;
</li>&#13;
<li>&#13;
<p><a data-type="xref" href="#caps_chrome_headless_seljup">Example 5-4</a> uses Chrome <a data-primary="Selenium-Jupiter" data-secondary="WebDriver instantiation with" data-type="indexterm" id="idm45849721985232"/>in headless mode through Selenium-Jupiter. This example <a data-primary="parameter resolution extension" data-type="indexterm" id="idm45849721984112"/>uses the parameter resolution mechanism provided by Selenium-Jupiter, and so we simply declare a <code>ChromeDriver</code> parameter in the test method. Then, we decorate this parameter <a data-primary="@Arguments annotation" data-primary-sortas="Arguments annotation" data-type="indexterm" id="idm45849721982800"/>using the annotation <code>@Arguments</code> to specify the headless mode for this browser.</p>&#13;
</li>&#13;
</ul>&#13;
<div data-type="example" id="caps_chrome_headless">&#13;
<h5><span class="label">Example 5-1. </span>Test using Chrome in headless mode</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">HeadlessChromeJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeAll</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setupClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">setup</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO1-1" id="co_browser_specific_manipulation_CO1-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO1-2" id="co_browser_specific_manipulation_CO1-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setHeadless</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO1-3" id="co_browser_specific_manipulation_CO1-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeDriver</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO1-4" id="co_browser_specific_manipulation_CO1-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testHeadless</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO1-1" id="callout_browser_specific_manipulation_CO1-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We resolve the required driver (chromedriver in this case).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO1-2" id="callout_browser_specific_manipulation_CO1-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We create the browser capabilities <a data-primary="ChromeOptions" data-type="indexterm" id="idm45849721852032"/>using the <code>ChromeOptions</code> constructor.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO1-3" id="callout_browser_specific_manipulation_CO1-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We enable the headless mode. This line is equivalent to <code>options.add​Arguments("--headless");</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO1-4" id="callout_browser_specific_manipulation_CO1-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We set up the browser capabilities by passing the options as a constructor parameter <a data-startref="ch5_term7" data-type="indexterm" id="idm45849721845568"/><a data-startref="ch5_term8" data-type="indexterm" id="idm45849721792352"/><a data-primary="Edge" data-secondary="WebDriver instantiation with" data-type="indexterm" id="idm45849721791744"/>in the <code>ChromeDriver</code> constructor.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="caps_edge_headless">&#13;
<h5><span class="label">Example 5-2. </span>Test using Edge in headless mode</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">HeadlessEdgeJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeAll</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setupClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">edgedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">setup</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO2-1" id="co_browser_specific_manipulation_CO2-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">EdgeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">EdgeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO2-2" id="co_browser_specific_manipulation_CO2-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setHeadless</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO2-3" id="co_browser_specific_manipulation_CO2-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">RemoteWebDriver</code><code class="o">.</code><code class="na">builder</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">oneOf</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO2-4" id="co_browser_specific_manipulation_CO2-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testHeadless</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO2-1" id="callout_browser_specific_manipulation_CO2-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>As usual, we need to <a data-primary="Edge" data-secondary="and msedgedriver" data-secondary-sortas="msedgedriver" data-type="indexterm" id="idm45849721633152"/><a data-primary="msedgedriver" data-type="indexterm" id="idm45849721631872"/>resolve the required driver (msedgedriver in this case).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO2-2" id="callout_browser_specific_manipulation_CO2-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Since we aim to use Edge, we need to <a data-primary="EdgeOptions" data-type="indexterm" id="idm45849721653584"/>create an <code>EdgeOptions</code> instance to specify capabilities.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO2-3" id="callout_browser_specific_manipulation_CO2-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We enable the headless mode. Again, this line is equivalent to <code>options.add​Arguments("--headless");</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO2-4" id="callout_browser_specific_manipulation_CO2-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We use the WebDriver builder to create the <code>WebDriver</code> object, passing the options as a <a data-primary="Firefox" data-secondary="WebDriver instantiation with" data-type="indexterm" id="idm45849721591504"/>parameter.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="caps_firefox_headless">&#13;
<h5><span class="label">Example 5-3. </span>Test using Firefox in headless mode</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">HeadlessFirefoxJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">FirefoxOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">FirefoxOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO3-1" id="co_browser_specific_manipulation_CO3-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setHeadless</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO3-2" id="co_browser_specific_manipulation_CO3-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO3-3" id="co_browser_specific_manipulation_CO3-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testHeadless</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO3-1" id="callout_browser_specific_manipulation_CO3-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use Firefox in this test, and therefore, we <a data-primary="FirefoxOptions" data-type="indexterm" id="idm45849721457024"/>create a <code>FirefoxOptions</code> object to specify capabilities.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO3-2" id="callout_browser_specific_manipulation_CO3-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>In the same way as in the previous examples, we enable the headless mode.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO3-3" id="callout_browser_specific_manipulation_CO3-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>In this example, we use <a data-primary="browser-specific capabilities" data-secondary="browser specification for" data-type="indexterm" id="idm45849721474368"/><a data-primary="WebDriverManager" data-secondary="driver resolution by" data-type="indexterm" id="idm45849721473360"/><a data-primary="drivers" data-secondary="WebDriverManager resolution of" data-type="indexterm" id="idm45849721472416"/>WebDriverManager to resolve the required driver and create the <code>WebDriver</code> object while specifying the previously created browser <span class="keep-together">capabilities</span>.</p></dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>The strategy used to <a data-primary="WebDriver" data-secondary="object creation for" data-type="indexterm" id="idm45849721421648"/><a data-primary="objects" data-secondary="WebDriver" data-type="indexterm" id="idm45849721420640"/>create the <code>WebDriver</code> objects in these examples is interchangeable. In other words, for example, we can also use the  WebDriverManager builder for each <a data-primary="Selenium-Jupiter" data-secondary="WebDriver instantiation with" data-type="indexterm" id="idm45849721419152"/>browser in headless mode.</p>&#13;
</div>&#13;
<div data-type="example" id="caps_chrome_headless_seljup">&#13;
<h5><span class="label">Example 5-4. </span>Test using Chrome in headless mode with Selenium-Jupiter</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@ExtendWith</code><code class="o">(</code><code class="n">SeleniumJupiter</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code>&#13;
</code><code class="kd">class</code><code> </code><code class="nc">HeadlessChromeSelJupTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testHeadless</code><code class="o">(</code><code class="nd">@Arguments</code><code class="o">(</code><code class="s">"--headless"</code><code class="o">)</code><code> </code><code class="n">ChromeDriver</code><code> </code><code class="n">driver</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO4-1" id="co_browser_specific_manipulation_CO4-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO4-1" id="callout_browser_specific_manipulation_CO4-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the <a data-primary="@Arguments annotation" data-primary-sortas="Arguments annotation" data-type="indexterm" id="idm45849721366368"/>annotation <code>@Arguments</code> to specify the headless mode in <a data-startref="ch5_term9" data-type="indexterm" id="idm45849721364816"/><a data-startref="ch5_term10" data-type="indexterm" id="idm45849721364112"/>the browser (Chrome in this case).</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Page Loading Strategies" data-type="sect2"><div class="sect2" id="loading_strategies">&#13;
<h2>Page Loading Strategies</h2>&#13;
&#13;
<p>Selenium WebDriver allows <a data-primary="browser-specific capabilities" data-secondary="page loading strategies" data-type="indexterm" id="ch5_term11"/><a data-primary="page loading" data-type="indexterm" id="ch5_term12"/><a data-primary="web pages" data-secondary="loading strategies of" data-type="indexterm" id="ch5_term13"/>configuring different approaches for loading web pages. For that, the Selenium WebDriver API <a data-primary="PageLoadStrategy values" data-type="indexterm" id="idm45849721324256"/>provides the <code>PageLoadStrategy</code> enumeration. <a data-type="xref" href="#page-loading-enum">Table 5-2</a> describes the possible values of this enumeration and their purposes. Selenium WebDriver internally uses the property <code>document.readyState</code> of the DOM API to check the web page loading state.</p>&#13;
<table id="page-loading-enum">&#13;
<caption><span class="label">Table 5-2. </span>PageLoadStrategy values</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Loading strategy</th>&#13;
<th>Description</th>&#13;
<th>Readiness state</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">PageLoadStrategy</code><code class="o">.</code><code class="na">NORMAL</code></pre></div></td>&#13;
<td><p>Default mode. Selenium WebDriver <a data-primary="normal page loading strategy" data-type="indexterm" id="ch5_term14"/>waits until the entire page is loaded (i.e., the HTML content and subresources, such as stylesheets, images, JavaScript files, etc.).</p></td>&#13;
<td><div>&#13;
<pre data-type="programlisting">"complete"</pre></div></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">PageLoadStrategy</code><code class="o">.</code><code class="na">EAGER</code></pre></div></td>&#13;
<td><p>Selenium WebDriver <a data-primary="eager page loading strategy" data-type="indexterm" id="idm45849721256736"/>waits until the HTML document has finished loading and parsing, but subresources (scripts, images, stylesheets, etc.) are still loading.</p></td>&#13;
<td><div>&#13;
<pre data-type="programlisting">"interactive"</pre></div></td>&#13;
</tr>&#13;
<tr>&#13;
<td><div>&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">PageLoadStrategy</code><code class="o">.</code><code class="na">NONE</code></pre></div></td>&#13;
<td><p>Selenium WebDriver waits only <a data-primary="none page loading strategy" data-type="indexterm" id="idm45849721281360"/>until the HTML document is downloaded.</p></td>&#13;
<td><div>&#13;
<pre data-type="programlisting">"loading"</pre></div></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>We need to invoke the method <code>setPageLoadStrategy()</code> of the browser capabilities (e.g., <code>ChromeOptions</code>, <code>FirefoxOptions</code>, etc.) to set up these strategies (<code>NORMAL</code>, <code>EAGER</code>, or <code>NONE</code>). <a data-type="xref" href="#caps_chrome_load">Example 5-5</a> shows a test using <a data-primary="Chrome" data-secondary="page loading strategy in" data-type="indexterm" id="ch5_term15"/>Chrome and the <code>NORMAL</code> strategy. In the examples repository, you can find equivalent <a data-primary="Edge" data-secondary="page loading strategy with" data-type="indexterm" id="idm45849721251072"/><a data-primary="Firefox" data-secondary="page loading strategy with" data-type="indexterm" id="idm45849721250240"/>examples for Edge and Firefox using the other strategies (<code>EAGER</code> and <code>NONE</code>). In these examples, in addition to specifying a loading strategy in the test setup, the test logic calculates the required time to load the page, displaying this value in the standard output.</p>&#13;
<div data-type="example" id="caps_chrome_load">&#13;
<h5><span class="label">Example 5-5. </span>Test using a normal page loading strategy in Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="kd">class</code><code> </code><code class="nc">PageLoadChromeJupiterTest</code><code> </code><code class="o">{</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="n">Logger</code><code> </code><code class="n">log</code><code> </code><code class="o">=</code><code> </code><code class="n">getLogger</code><code class="o">(</code><code class="n">lookup</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">lookupClass</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">PageLoadStrategy</code><code> </code><code class="n">pageLoadStrategy</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@BeforeEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-1" id="co_browser_specific_manipulation_CO5-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>        </code><code class="n">pageLoadStrategy</code><code> </code><code class="o">=</code><code> </code><code class="n">PageLoadStrategy</code><code class="o">.</code><code class="na">NORMAL</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">options</code><code class="o">.</code><code class="na">setPageLoadStrategy</code><code class="o">(</code><code class="n">pageLoadStrategy</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-2" id="co_browser_specific_manipulation_CO5-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-3" id="co_browser_specific_manipulation_CO5-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@AfterEach</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="nd">@Test</code><code>&#13;
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">testPageLoad</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="kt">long</code><code> </code><code class="n">initMillis</code><code> </code><code class="o">=</code><code> </code><code class="n">System</code><code class="o">.</code><code class="na">currentTimeMillis</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-4" id="co_browser_specific_manipulation_CO5-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">Duration</code><code> </code><code class="n">elapsed</code><code> </code><code class="o">=</code><code> </code><code class="n">Duration</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">ofMillis</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">currentTimeMillis</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code> </code><code class="n">initMillis</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-5" id="co_browser_specific_manipulation_CO5-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">Capabilities</code><code> </code><code class="n">capabilities</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="o">(</code><code class="n">RemoteWebDriver</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">)</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">getCapabilities</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-6" id="co_browser_specific_manipulation_CO5-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>        </code><code class="n">Object</code><code> </code><code class="n">pageLoad</code><code> </code><code class="o">=</code><code> </code><code class="n">capabilities</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">getCapability</code><code class="o">(</code><code class="n">CapabilityType</code><code class="o">.</code><code class="na">PAGE_LOAD_STRATEGY</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-7" id="co_browser_specific_manipulation_CO5-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>        </code><code class="n">String</code><code> </code><code class="n">browserName</code><code> </code><code class="o">=</code><code> </code><code class="n">capabilities</code><code class="o">.</code><code class="na">getBrowserName</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code>&#13;
</code><code>                </code><code class="s">"The page took {} ms to be loaded using a '{}' strategy in {}"</code><code class="o">,</code><code>&#13;
</code><code>                </code><code class="n">elapsed</code><code class="o">.</code><code class="na">toMillis</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">pageLoad</code><code class="o">,</code><code> </code><code class="n">browserName</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-8" id="co_browser_specific_manipulation_CO5-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">pageLoad</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">pageLoadStrategy</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO5-9" id="co_browser_specific_manipulation_CO5-9"><img alt="9" src="assets/9.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-1" id="callout_browser_specific_manipulation_CO5-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Since we use <a data-primary="ChromeOptions" data-type="indexterm" id="idm45849720948000"/>Chrome in this test, we instantiate <code>ChromeOptions</code> to specify <span class="keep-together">capabilities</span>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-2" id="callout_browser_specific_manipulation_CO5-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We set up the page loading strategy to <code>NORMAL</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-3" id="callout_browser_specific_manipulation_CO5-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We use <a data-primary="drivers" data-secondary="WebDriverManager resolution of" data-type="indexterm" id="idm45849720977616"/><a data-primary="WebDriverManager" data-secondary="driver resolution by" data-type="indexterm" id="idm45849720976640"/><a data-primary="WebDriver" data-secondary="object creation for" data-type="indexterm" id="idm45849720975696"/><a data-primary="objects" data-secondary="WebDriver" data-type="indexterm" id="idm45849720974752"/>WebDriverManager to resolve the driver, create the <code>WebDriver</code> instance, and specify the capabilities.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-4" id="callout_browser_specific_manipulation_CO5-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We get the <a data-primary="timestamp, system" data-type="indexterm" id="idm45849720970912"/>system timestamp before loading the page.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-5" id="callout_browser_specific_manipulation_CO5-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We get the system timestamp after loading the page.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-6" id="callout_browser_specific_manipulation_CO5-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We read the <code>WebDriver</code> object capabilities.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-7" id="callout_browser_specific_manipulation_CO5-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>We read the used page loading strategy.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-8" id="callout_browser_specific_manipulation_CO5-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>We trace the time required to load the web page.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO5-9" id="callout_browser_specific_manipulation_CO5-9"><img alt="9" src="assets/9.png"/></a></dt>&#13;
<dd><p>We verify that the loading strategy is as initially <a data-startref="ch5_term11" data-type="indexterm" id="idm45849720880096"/><a data-startref="ch5_term12" data-type="indexterm" id="idm45849720879488"/><a data-startref="ch5_term13" data-type="indexterm" id="idm45849720878880"/><a data-startref="ch5_term14" data-type="indexterm" id="idm45849720878272"/><a data-startref="ch5_term15" data-type="indexterm" id="idm45849720877664"/>configured.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Device Emulation" data-type="sect2"><div class="sect2" id="sect-caps-device-emulation">&#13;
<h2>Device Emulation</h2>&#13;
&#13;
<p>Major web browsers use <a data-primary="browser-specific capabilities" data-secondary="device emulation" data-type="indexterm" id="ch5_term16"/><a data-primary="device emulation" data-type="indexterm" id="ch5_term17"/><a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="device emulation with" data-type="indexterm" id="ch5_term18"/><a data-primary="Chromium" data-secondary="browser capabilities with" data-type="indexterm" id="ch5_term19"/><a data-primary="Edge" data-secondary="as Chromium-based browser" data-secondary-sortas="Chromium-based browser" data-type="indexterm" id="ch5_term20"/><a data-primary="mobile devices, emulation of" data-type="indexterm" id="ch5_term21"/><a data-primary="simulation of mobile devices" data-type="indexterm" id="ch5_term22"/><a data-primary="emulation of mobile devices" data-type="indexterm" id="ch5_term23"/>development tools (i.e., DevTools in Chromium-based browsers and Developer Tools in Firefox) to simulate mobile devices in these ways:</p>&#13;
<dl>&#13;
<dt>Simulating a mobile viewport</dt>&#13;
<dd>&#13;
<p>To reduce user visible area of a web page using the width and height of a given mobile device</p>&#13;
</dd>&#13;
<dt>Throttling the network</dt>&#13;
<dd>&#13;
<p>To slow the connectivity speed to simulate mobile networks (e.g., 3G)</p>&#13;
</dd>&#13;
<dt>Throttling the CPU</dt>&#13;
<dd>&#13;
<p>To slow processing performance</p>&#13;
</dd>&#13;
<dt>Simulating geolocation</dt>&#13;
<dd>&#13;
<p>To set custom Global Positioning System (GPS) coordinates</p>&#13;
</dd>&#13;
<dt>Setting orientation</dt>&#13;
<dd>&#13;
<p>To rotate the screen</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#chrome-devtools-mobile-emulation">Figure 5-2</a> shows a screenshot of Chrome using mobile emulation through DevTools.</p>&#13;
&#13;
<figure><div class="figure" id="chrome-devtools-mobile-emulation">&#13;
<img alt="hosw 0502" src="assets/hosw_0502.png"/>&#13;
<h6><span class="label">Figure 5-2. </span>Mobile emulation in Chrome using DevTools</h6>&#13;
</div></figure>&#13;
&#13;
<p class="pagebreak-before">At the time of this writing, this mobile device emulation can be automated through the Selenium WebDriver API in Chromium-based browsers (Chrome and Edge) but not Firefox (since it is not implemented in geckodriver). For that, we need to set the experimental option <code>mobileEmulation</code> in <code>ChromeOptions</code> or <code>EdgeOptions</code>.</p>&#13;
&#13;
<p>Then, there are two alternatives to specify the mobile device to be emulated. First, we can specify a particular mobile device (e.g., Pixel 2, iPad Pro, or Galaxy Fold, to name a few). Since this list is updated in each Chromium release, the best way to check the possibilities is to inspect the available devices in DevTools (e.g., iPhone X is selected in <a data-type="xref" href="#chrome-devtools-mobile-emulation">Figure 5-2</a>). <a data-type="xref" href="#caps_chrome_device_emulation_1">Example 5-6</a> shows a test setup in which we specify a given mobile device using the label <code>iPhone 6/7/8</code>.</p>&#13;
<div data-type="example" id="caps_chrome_device_emulation_1">&#13;
<h5><span class="label">Example 5-6. </span>Test setup using mobile emulation by specifying a device</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">mobileEmulation</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO6-1" id="co_browser_specific_manipulation_CO6-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">mobileEmulation</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"deviceName"</code><code class="o">,</code><code> </code><code class="s">"iPhone 6/7/8"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO6-2" id="co_browser_specific_manipulation_CO6-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setExperimentalOption</code><code class="o">(</code><code class="s">"mobileEmulation"</code><code class="o">,</code><code> </code><code class="n">mobileEmulation</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO6-3" id="co_browser_specific_manipulation_CO6-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO6-4" id="co_browser_specific_manipulation_CO6-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO6-1" id="callout_browser_specific_manipulation_CO6-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We need to <a data-primary="HashMap object" data-type="indexterm" id="idm45849720773664"/>create a <code>HashMap</code> object to specify the mobile emulation options.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO6-2" id="callout_browser_specific_manipulation_CO6-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Then, we only need to select the device name (iPhone 6/7/8 in this case).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO6-3" id="callout_browser_specific_manipulation_CO6-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We set up device emulation using experimental options.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO6-4" id="callout_browser_specific_manipulation_CO6-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>As usual, we create a <code>WebDriver</code> object specifying these options.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The second alternative to set up mobile emulation is to specify the individual <a data-primary="device attributes" data-type="indexterm" id="idm45849720720992"/>attributes of the emulated device. These attributes are:</p>&#13;
<dl>&#13;
<dt><code>width</code></dt>&#13;
<dd>&#13;
<p>Device screen width (in pixels)</p>&#13;
</dd>&#13;
<dt><code>height</code></dt>&#13;
<dd>&#13;
<p>Device screen height (in pixels)</p>&#13;
</dd>&#13;
<dt><code>pixelRatio</code></dt>&#13;
<dd>&#13;
<p>Ratio between physical pixels and logical pixels</p>&#13;
</dd>&#13;
<dt><code>touch</code></dt>&#13;
<dd>&#13;
<p>Whether to emulate touch events; the default value is <code>true</code></p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p>In addition to these attributes, we <a data-primary="HTTP" data-secondary="user agent specification in" data-type="indexterm" id="idm45849720713152"/><a data-primary="user agent specification for device" data-type="indexterm" id="idm45849720712080"/>can specify the <em>user agent</em> of the emulated device. In HTTP, the user agent is a string specified in request headers that univocally identifies the type of web browser. It contains the development code name, version, platform, and other information. <a data-type="xref" href="#caps_chrome_device_emulation_2">Example 5-7</a> shows a test setup illustrating the use of this feature.</p>&#13;
<div data-type="example" id="caps_chrome_device_emulation_2">&#13;
<h5><span class="label">Example 5-7. </span>Test setup using device emulation by specifying individual attributes</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">EdgeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">EdgeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">mobileEmulation</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">deviceMetrics</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO7-1" id="co_browser_specific_manipulation_CO7-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">deviceMetrics</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"width"</code><code class="o">,</code><code> </code><code class="mi">360</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">deviceMetrics</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"height"</code><code class="o">,</code><code> </code><code class="mi">640</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">deviceMetrics</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"pixelRatio"</code><code class="o">,</code><code> </code><code class="mf">3.0</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">deviceMetrics</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"touch"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">mobileEmulation</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"deviceMetrics"</code><code class="o">,</code><code> </code><code class="n">deviceMetrics</code><code class="o">)</code><code class="o">;</code><code>  </code><a class="co" href="#callout_browser_specific_manipulation_CO7-2" id="co_browser_specific_manipulation_CO7-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">mobileEmulation</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"userAgent"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"Mozilla/5.0 (Linux; Android 4.2.1; en-us; Nexus 5 Build/JOP40D) "</code><code>&#13;
</code><code>                    </code><code class="o">+</code><code> </code><code class="s">"AppleWebKit/535.19 (KHTML, like Gecko) "</code><code>&#13;
</code><code>                    </code><code class="o">+</code><code> </code><code class="s">"Chrome/18.0.1025.166 Mobile Safari/535.19"</code><code class="o">)</code><code class="o">;</code><code>  </code><a class="co" href="#callout_browser_specific_manipulation_CO7-3" id="co_browser_specific_manipulation_CO7-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setExperimentalOption</code><code class="o">(</code><code class="s">"mobileEmulation"</code><code class="o">,</code><code> </code><code class="n">mobileEmulation</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">edgedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO7-1" id="callout_browser_specific_manipulation_CO7-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create a <a data-primary="HashMap object" data-type="indexterm" id="idm45849720542304"/>hashmap to store the individual attributes of an emulated mobile, namely, <code>width</code>, <code>height</code>, <code>pixelRatio</code>, and <code>touch</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO7-2" id="callout_browser_specific_manipulation_CO7-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We set these <a data-primary="deviceMetrics, setting attributes with" data-type="indexterm" id="idm45849720560272"/>attributes by setting the label <code>deviceMetrics</code> in the mobile emulation map.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO7-3" id="callout_browser_specific_manipulation_CO7-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We set a custom user agent for a <a data-startref="ch5_term16" data-type="indexterm" id="idm45849720556672"/><a data-startref="ch5_term17" data-type="indexterm" id="idm45849720555968"/><a data-startref="ch5_term18" data-type="indexterm" id="idm45849720555296"/><a data-startref="ch5_term19" data-type="indexterm" id="idm45849720494192"/><a data-startref="ch5_term20" data-type="indexterm" id="idm45849720493584"/><a data-startref="ch5_term21" data-type="indexterm" id="idm45849720492976"/><a data-startref="ch5_term22" data-type="indexterm" id="idm45849720492368"/><a data-startref="ch5_term23" data-type="indexterm" id="idm45849720491760"/>Chrome Mobile 18 in a Nexus 5 device.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Extensions" data-type="sect2"><div class="sect2" id="idm45849720876336">&#13;
<h2>Web Extensions</h2>&#13;
&#13;
<p>Web extensions (also called <em>add-ons</em> or <em>plug-ins</em>) are <a data-primary="add-ons" data-type="indexterm" id="ch5_term26"/><a data-primary="browser-specific capabilities" data-secondary="web extensions for" data-type="indexterm" id="ch5_term27"/><a data-primary="web extensions" data-type="indexterm" id="ch5_term28"/><a data-primary="plug-ins" data-type="indexterm" id="ch5_term29"/>programs that can modify or enhance the default operation of a web browser. Users typically install web extensions <a data-primary="web stores" data-type="indexterm" id="idm45849720484192"/>using web stores. These stores are web applications supported by <a data-primary="Firefox" data-secondary="web extensions for" data-type="indexterm" id="idm45849720483392"/><a data-primary="Chrome" data-secondary="web extensions for" data-type="indexterm" id="ch5_term24"/><a data-primary="Edge" data-secondary="web extensions for" data-type="indexterm" id="ch5_term25"/>browser maintainers for hosting public web extensions. <a data-type="xref" href="#web-stores">Table 5-3</a> summarizes the web stores for Chrome, Edge, and Firefox.</p>&#13;
<table class="pagebreak-before less_space" id="web-stores">&#13;
<caption><span class="label">Table 5-3. </span>Web stores for the major browsers</caption>&#13;
<thead>&#13;
<tr>&#13;
<th>Web Store</th>&#13;
<th>Browser</th>&#13;
<th>URL</th>&#13;
</tr>&#13;
</thead>&#13;
<tbody>&#13;
<tr>&#13;
<td><p>Chrome web store</p></td>&#13;
<td><p>Chrome</p></td>&#13;
<td><p><a href="https://chrome.google.com/webstore/category/extensions"><em class="hyperlink">https://chrome.google.com/webstore/category/extensions</em></a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Edge add-ons</p></td>&#13;
<td><p>Edge</p></td>&#13;
<td><p><a href="https://microsoftedge.microsoft.com/addons/Microsoft-Edge-Extensions-Home"><em class="hyperlink">https://microsoftedge.microsoft.com/addons/Microsoft-Edge-Extensions-Home</em></a></p></td>&#13;
</tr>&#13;
<tr>&#13;
<td><p>Firefox browser add-ons</p></td>&#13;
<td><p>Firefox</p></td>&#13;
<td><p><a href="https://addons.mozilla.org/en-US/firefox"><em class="hyperlink">https://addons.mozilla.org/en-US/firefox</em></a></p></td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
&#13;
<p>We can install web extensions in a WebDriver session using capabilities. For that, in Chromium-based browsers, like Chrome and Edge, we <a data-primary="addExtensions() method" data-type="indexterm" id="idm45849720465264"/>use the method <code>addExtensions()</code> of a <code>ChromeOptions</code> or <code>EdgeOptions</code> object. <a data-type="xref" href="#caps_chrome_ext">Example 5-8</a> shows a <a data-primary="ChromeOptions" data-type="indexterm" id="idm45849720462352"/><a data-primary="EdgeOptions" data-type="indexterm" id="idm45849720461648"/>test setup to install a local extension in Chrome.</p>&#13;
<div data-type="example" id="caps_chrome_ext">&#13;
<h5><span class="label">Example 5-8. </span>Test setup installing a web extension in Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">URISyntaxException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">extension</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">ClassLoader</code><code class="o">.</code><code class="na">getSystemResource</code><code class="o">(</code><code class="s">"dark-bg.crx"</code><code class="o">)</code><code class="o">.</code><code class="na">toURI</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO8-1" id="co_browser_specific_manipulation_CO8-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addExtensions</code><code class="o">(</code><code class="n">extension</code><code class="o">.</code><code class="na">toFile</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO8-2" id="co_browser_specific_manipulation_CO8-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO8-1" id="callout_browser_specific_manipulation_CO8-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We install a web extension <a data-primary="Chrome Extension (CRX) file" data-type="indexterm" id="idm45849720387728"/><a data-primary="web pages" data-secondary="changing from light to dark" data-type="indexterm" id="idm45849720386960"/>packed as a Chrome Extension (CRX) file. This file is a test resource (located in the folder <code>src\test\resources</code> of the Java project). This extension changes the website look and feel to use light text on a dark background. <a data-type="xref" href="#dark-bg">Figure 5-3</a> shows a screenshot of the practice website when loaded by a WebDriver test using this extension.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO8-2" id="callout_browser_specific_manipulation_CO8-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We add the extension in the Chrome options, passing the extension as a Java <code>File</code>.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="dark-bg">&#13;
<img alt="hosw 0503" src="assets/hosw_0503.png"/>&#13;
<h6><span class="label">Figure 5-3. </span>Practice site when it is loaded using the dark-bg.crx extension</h6>&#13;
</div></figure>&#13;
&#13;
<p>Firefox also <a data-startref="ch5_term24" data-type="indexterm" id="idm45849720339664"/><a data-startref="ch5_term25" data-type="indexterm" id="idm45849720338928"/><a data-primary="Firefox" data-secondary="web extensions for" data-type="indexterm" id="idm45849720338256"/>allows loading web extensions when it is controlled with WebDriver. Nevertheless, the syntax is different. <a data-type="xref" href="#caps_firefox_ext">Example 5-9</a> illustrates this.</p>&#13;
<div data-type="example" id="caps_firefox_ext">&#13;
<h5><span class="label">Example 5-9. </span>Test setup installing a web extension in Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">URISyntaxException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">extension</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">ClassLoader</code><code class="o">.</code><code class="na">getSystemResource</code><code class="o">(</code><code class="s">"dark-bg.xpi"</code><code class="o">)</code><code class="o">.</code><code class="na">toURI</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO9-1" id="co_browser_specific_manipulation_CO9-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">FirefoxOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">FirefoxOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">FirefoxProfile</code><code> </code><code class="n">profile</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">FirefoxProfile</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO9-2" id="co_browser_specific_manipulation_CO9-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">profile</code><code class="o">.</code><code class="na">addExtension</code><code class="o">(</code><code class="n">extension</code><code class="o">.</code><code class="na">toFile</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO9-3" id="co_browser_specific_manipulation_CO9-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setProfile</code><code class="o">(</code><code class="n">profile</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO9-4" id="co_browser_specific_manipulation_CO9-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO9-1" id="callout_browser_specific_manipulation_CO9-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the same extension as in Chrome/Edge, but in this case, the packaging is specific for Firefox. Notice that the file is different. This time, it is <a data-primary="XPInstall file" data-type="indexterm" id="idm45849720218944"/>packaged as an <em>XPInstall</em> file, i.e., a zipped archive containing the web extension source code, resources (e.g., images), and metadata.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO9-2" id="callout_browser_specific_manipulation_CO9-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We need to create a custom Firefox profile (i.e., the store where custom settings are configured).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO9-3" id="callout_browser_specific_manipulation_CO9-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We add the extension as a Java <code>File</code> to the Firefox profile.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO9-4" id="callout_browser_specific_manipulation_CO9-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We set the profile in the Firefox options.</p></dd>&#13;
</dl>&#13;
&#13;
<p>Chromium-based <a data-primary="Chrome" data-secondary="web extensions for" data-type="indexterm" id="idm45849720184160"/><a data-primary="Edge" data-secondary="web extensions for" data-type="indexterm" id="idm45849720183152"/><a data-primary="Chromium" data-secondary="browser capabilities with" data-type="indexterm" id="idm45849720182208"/><a data-primary="source code" data-secondary="loading extensions from" data-type="indexterm" id="ch5_term30"/>browsers (e.g., Chrome, Edge) also allow loading an extension from its source code (i.e., not packaged as a CRX file). This feature can be very convenient for automated testing of web extensions during their development. <a data-type="xref" href="#caps_edge_ext">Example 5-10</a> shows a test setup that illustrates this feature.</p>&#13;
<div data-type="example" id="caps_edge_ext">&#13;
<h5><span class="label">Example 5-10. </span>Test setup installing a web extension from its source code in Edge</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">URISyntaxException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">extension</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">ClassLoader</code><code class="o">.</code><code class="na">getSystemResource</code><code class="o">(</code><code class="s">"web-extension"</code><code class="o">)</code><code class="o">.</code><code class="na">toURI</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO10-1" id="co_browser_specific_manipulation_CO10-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">EdgeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">EdgeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addArguments</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"--load-extension="</code><code> </code><code class="o">+</code><code> </code><code class="n">extension</code><code class="o">.</code><code class="na">toAbsolutePath</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO10-2" id="co_browser_specific_manipulation_CO10-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">edgedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO10-1" id="callout_browser_specific_manipulation_CO10-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>The extension used in this example is located in the folder <code>web-extension</code>; it is a test resource folder (stored in <code>src\test\resources</code> of the Java project). This <a data-primary="Browser Extensions API" data-type="indexterm" id="idm45849720097504"/>extension follows the <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions">Browser Extensions API</a>. It uses JavaScript to change the content of first-level headers (<code>h1</code> tags) with a custom message. <a data-type="xref" href="#load-ext">Figure 5-4</a> shows a screenshot of the practice website when using this extension.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO10-2" id="callout_browser_specific_manipulation_CO10-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We specify the <a data-primary="load-extension argument" data-type="indexterm" id="idm45849720092384"/>extension path using the <code>--load-extension</code> argument.</p></dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Selenium WebDriver creates a new browser profile in each execution. For this reason, the installation of web extensions through Selenium WebDriver is not permanent in the target browsers.</p>&#13;
</div>&#13;
&#13;
<figure><div class="figure" id="load-ext">&#13;
<img alt="hosw 0504" src="assets/hosw_0504.png"/>&#13;
<h6><span class="label">Figure 5-4. </span>Practice site when it is loaded using the local extension</h6>&#13;
</div></figure>&#13;
&#13;
<p>As of Selenium 4.1, Firefox <a data-primary="Selenium 4 (version)" data-primary-sortas="Selenium four (version)" data-type="indexterm" id="idm45849720045968"/><a data-primary="Firefox" data-secondary="web extensions for" data-type="indexterm" id="idm45849720044992"/><a data-primary="FirefoxDriver" data-type="indexterm" id="idm45849720044048"/><a data-primary="HasExtensions interface" data-type="indexterm" id="idm45849720043376"/><a data-primary="installExtension() method" data-type="indexterm" id="idm45849720042704"/>also allows installing web extensions from its source code. To that aim, <code>FirefoxDriver</code> extends the interface <code>HasExtensions</code>, providing the method <code>installExtension</code>. <a data-type="xref" href="#caps_firefox_ext_src">Example 5-11</a> shows a test setup using this feature.</p>&#13;
<div data-type="example" id="caps_firefox_ext_src">&#13;
<h5><span class="label">Example 5-11. </span>Test setup installing a web extension from its source code in Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">URISyntaxException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">extensionFolder</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">ClassLoader</code><code class="o">.</code><code class="na">getSystemResource</code><code class="o">(</code><code class="s">"web-extension"</code><code class="o">)</code><code class="o">.</code><code class="na">toURI</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO11-1" id="co_browser_specific_manipulation_CO11-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">zippedExtension</code><code> </code><code class="o">=</code><code> </code><code class="n">zipFolder</code><code class="o">(</code><code class="n">extensionFolder</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO11-2" id="co_browser_specific_manipulation_CO11-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">(</code><code class="o">(</code><code class="n">FirefoxDriver</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">)</code><code class="o">.</code><code class="na">installExtension</code><code class="o">(</code><code class="n">zippedExtension</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO11-3" id="co_browser_specific_manipulation_CO11-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO11-1" id="callout_browser_specific_manipulation_CO11-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use the source code (located in the project classpath) of a web extension.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO11-2" id="callout_browser_specific_manipulation_CO11-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The method <code>installExtension</code> requires that the extension installed from its source code is zipped. WebDriverManager <a data-primary="zipFolder(Path) method" data-type="indexterm" id="idm45849719963136"/>provides the static helper method called <code>zipFolder(Path)</code> to ease this <a data-startref="ch5_term30" data-type="indexterm" id="idm45849719961920"/>process.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO11-3" id="callout_browser_specific_manipulation_CO11-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We install the zipped extension as a temporal add-on in <a data-startref="ch5_term26" data-type="indexterm" id="idm45849719918064"/><a data-startref="ch5_term27" data-type="indexterm" id="idm45849719917424"/><a data-startref="ch5_term28" data-type="indexterm" id="idm45849719916752"/><a data-startref="ch5_term29" data-type="indexterm" id="idm45849719916080"/>Firefox.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Geolocation" data-type="sect2"><div class="sect2" id="idm45849720490432">&#13;
<h2>Geolocation</h2>&#13;
&#13;
<p>The <a href="https://www.w3.org/TR/geolocation">Geolocation API</a> is a <a data-primary="W3C specifications" data-secondary="Geolocation API" data-type="indexterm" id="idm45849719912800"/><a data-primary="browser-specific capabilities" data-secondary="geolocation, permission for" data-type="indexterm" id="ch5_term33"/><a data-primary="geolocation" data-secondary="permission for access to" data-type="indexterm" id="ch5_term34"/><a data-primary="location context" data-type="indexterm" id="ch5_term35"/>W3C specification that allows access to the geographical location information associated with the hosting device (e.g., laptop or mobile) of the web browser. Usual geolocation data sources include GPS data and the location inferred from the network, such as the IP address. The Geolocation API is available in a web browser <a data-primary="navigator.geolocation object" data-type="indexterm" id="idm45849719908336"/><a data-primary="JavaScript" data-secondary="geolocation and" data-type="indexterm" id="idm45849719907648"/>calling the JavaScript object <span class="keep-together"><code>navigator.geolocation</code></span>. When using this statement, and for privacy reasons, a pop-up prompts the user for permission to report location data.</p>&#13;
&#13;
<p>The practice site contains a web page using geolocation. <a data-type="xref" href="#geolocation">Figure 5-5</a> shows a screenshot of this page. This figure shows the permission pop-up shown to the user when clicking the button “Get coordinates.” To handle this dialog using the Selenium WebDriver API, we use capabilities. Like other occasions, the required capabilities to <a data-primary="Chrome" data-secondary="geolocation access in" data-type="indexterm" id="ch5_term31"/><a data-primary="Edge" data-secondary="geolocation access in" data-type="indexterm" id="ch5_term32"/><a data-primary="Firefox" data-secondary="geolocation access in" data-type="indexterm" id="idm45849719901888"/>grant access to the geolocation data are different in Chrome/Edge than in Firefox. The following code snippets show the difference. First, <a data-type="xref" href="#caps_chrome_geo">Example 5-12</a> shows a test setup where geolocation access is granted in Chrome. The same experimental preference (<code>profile.default_content_setting_values.geolocation</code>) would be used in Edge (as usual, you can find the complete test in the examples repository). Then, <a data-type="xref" href="#caps_firefox_geo">Example 5-13</a> shows the equivalent test setup, but using Firefox.</p>&#13;
&#13;
<figure><div class="figure" id="geolocation">&#13;
<img alt="hosw 0505" src="assets/hosw_0505.png"/>&#13;
<h6><span class="label">Figure 5-5. </span>Practice site showing the geolocation permission pop-up</h6>&#13;
</div></figure>&#13;
<div data-type="example" id="caps_chrome_geo">&#13;
<h5><span class="label">Example 5-12. </span>Test setup to allow geolocation in Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">prefs</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO12-1" id="co_browser_specific_manipulation_CO12-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">prefs</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"profile.default_content_setting_values.geolocation"</code><code class="o">,</code><code> </code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO12-2" id="co_browser_specific_manipulation_CO12-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setExperimentalOption</code><code class="o">(</code><code class="s">"prefs"</code><code class="o">,</code><code> </code><code class="n">prefs</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO12-3" id="co_browser_specific_manipulation_CO12-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO12-1" id="callout_browser_specific_manipulation_CO12-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create a <a data-primary="HashMap object" data-type="indexterm" id="idm45849719818096"/>hashmap for experimental options.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO12-2" id="callout_browser_specific_manipulation_CO12-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We set to <code>1</code> the experimental <a data-primary="profile.default_content_setting_values.geolocation option" data-type="indexterm" id="idm45849719814192"/>option <code>profile.default_content_setting_​val⁠ues.geolocation</code> to allow accessing the geolocation position. The other <span class="keep-together">possible</span> values are: <code>0</code> for the default behavior and <code>2</code> for blocking access to the geolocation data.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO12-3" id="callout_browser_specific_manipulation_CO12-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We set the experimental options using the label <code>prefs</code> in the Chrome options.</p></dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>Suppose you need to <a data-primary="macOS, geolocation access with" data-type="indexterm" id="idm45849719766208"/>access the geolocation coordinates using Chrome or Edge in a macOS machine. In that case, you will also need to enable the location services for these browsers in the macOS preferences (System Preferences → Security &amp; Privacy → Location Services). <a data-type="xref" href="#geolocation-macos">Figure 5-6</a> shows <a data-startref="ch5_term31" data-type="indexterm" id="idm45849719764576"/><a data-startref="ch5_term32" data-type="indexterm" id="idm45849719763872"/>this configuration.</p>&#13;
</div>&#13;
&#13;
<figure><div class="figure" id="geolocation-macos">&#13;
<img alt="hosw 0506" src="assets/hosw_0506.png"/>&#13;
<h6><span class="label">Figure 5-6. </span>Enabling location services for Chrome and Edge in macOS</h6>&#13;
</div></figure>&#13;
<div data-type="example" id="caps_firefox_geo">&#13;
<h5><span class="label">Example 5-13. </span>Test setup to allow geolocation in Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">FirefoxOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">FirefoxOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"geo.enabled"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO13-1" id="co_browser_specific_manipulation_CO13-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"geo.prompt.testing"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO13-2" id="co_browser_specific_manipulation_CO13-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"geo.provider.use_corelocation"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO13-3" id="co_browser_specific_manipulation_CO13-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO13-1" id="callout_browser_specific_manipulation_CO13-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>To enable the <a data-primary="Firefox" data-secondary="geolocation access in" data-type="indexterm" id="idm45849719688896"/>Geolocation API</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO13-2" id="callout_browser_specific_manipulation_CO13-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>To grant access to the geolocation data (i.e., click on <code>allow</code> in the access pop-up)</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO13-3" id="callout_browser_specific_manipulation_CO13-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>To gather data using all the available components in the device, such as GPS, WiFi, or <a data-startref="ch5_term33" data-type="indexterm" id="idm45849719682288"/><a data-startref="ch5_term34" data-type="indexterm" id="idm45849719681584"/><a data-startref="ch5_term35" data-type="indexterm" id="idm45849719641184"/>Bluetooth</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Notifications" data-type="sect2"><div class="sect2" id="push_notifications">&#13;
<h2>Notifications</h2>&#13;
&#13;
<p>The <a href="https://notifications.spec.whatwg.org">Notifications API</a> is a <a data-primary="browser-specific capabilities" data-secondary="notifications, permission for" data-type="indexterm" id="ch5_term36"/><a data-primary="notifications, permission for" data-type="indexterm" id="ch5_term37"/>standard web API that allows websites to send notifications displayed at the operating system desktop. This API is available through the JavaScript object <code>Notification</code>. Before a website can send notifications, the user must grant permission. This consent is prompted to the user in a dialog pop-up similar to geolocation data. The practice site contains a web page using the Notification API. <a data-type="xref" href="#notifications">Figure 5-7</a> shows a screenshot of the notification permission pop-up for this page. <a data-type="xref" href="#notification-fullscreen">Figure 5-8</a> shows the message sent by this web page on a <a data-primary="Linux" data-type="indexterm" id="idm45849719632912"/>Linux host.</p>&#13;
&#13;
<figure><div class="figure" id="notifications">&#13;
<img alt="hosw 0507" src="assets/hosw_0507.png"/>&#13;
<h6><span class="label">Figure 5-7. </span>Practice site showing the notification permission pop-up</h6>&#13;
</div></figure>&#13;
&#13;
<figure><div class="figure" id="notification-fullscreen">&#13;
<img alt="hosw 0508" src="assets/hosw_0508.png"/>&#13;
<h6><span class="label">Figure 5-8. </span>Practice site showing a notification in a Linux desktop</h6>&#13;
</div></figure>&#13;
&#13;
<p>The Selenium WebDriver API allows granting notifications by using capabilities. <span class="keep-together">Like in other</span> features, the syntax of these capabilities is different <a data-primary="Chrome" data-secondary="notifications permission in" data-type="indexterm" id="idm45849719626656"/><a data-primary="Edge" data-secondary="notifications permission in" data-type="indexterm" id="idm45849719625664"/><a data-primary="Firefox" data-secondary="notifications permission in" data-type="indexterm" id="idm45849719624704"/>in Chrome/Edge and Firefox. <a data-type="xref" href="#caps_chrome_notifications">Example 5-14</a> shows the test setup to enable notifications as Chrome <span class="keep-together">options. We</span> use the <a data-primary="profile.default_content_setting_values.geolocation option" data-type="indexterm" id="idm45849719622096"/>same preference (<code>profile.default_content_setting_values.notifications</code>) to allow notifications in Edge. <a data-type="xref" href="#caps_firefox_notifications">Example 5-15</a> shows the equivalent test setup for Firefox. The <a data-primary="permissions.default.desktop-notification label" data-type="indexterm" id="idm45849719619776"/>preference label (<code>permissions.default.desktop-notification</code>) is different in this case, although its value (<code>1</code>) is the same for allowing notifications. The other possible value is <code>2</code>, which is used to block notifications (both in Chrome/Edge and Firefox).</p>&#13;
<div data-type="example" id="caps_chrome_notifications">&#13;
<h5><span class="label">Example 5-14. </span>Test setup to allow notifications in Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code>&#13;
<code class="kt">void</code> <code class="nf">setup</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="n">ChromeOptions</code> <code class="n">options</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ChromeOptions</code><code class="o">();</code>&#13;
    <code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code> <code class="n">Object</code><code class="o">&gt;</code> <code class="n">prefs</code> <code class="o">=</code> <code class="k">new</code> <code class="n">HashMap</code><code class="o">&lt;&gt;();</code>&#13;
    <code class="n">prefs</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"profile.default_content_setting_values.notifications"</code><code class="o">,</code> <code class="mi">1</code><code class="o">);</code>&#13;
    <code class="n">options</code><code class="o">.</code><code class="na">setExperimentalOption</code><code class="o">(</code><code class="s">"prefs"</code><code class="o">,</code> <code class="n">prefs</code><code class="o">);</code>&#13;
&#13;
    <code class="n">driver</code> <code class="o">=</code> <code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">().</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">).</code><code class="na">create</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
<div data-type="example" id="caps_firefox_notifications">&#13;
<h5><span class="label">Example 5-15. </span>Test setup to allow notifications in Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code>&#13;
<code class="kt">void</code> <code class="nf">setup</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="n">FirefoxOptions</code> <code class="n">options</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FirefoxOptions</code><code class="o">();</code>&#13;
    <code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"permissions.default.desktop-notification"</code><code class="o">,</code> <code class="mi">1</code><code class="o">);</code>&#13;
&#13;
    <code class="n">driver</code> <code class="o">=</code> <code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">().</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code>&#13;
            <code class="o">.</code><code class="na">create</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p><a data-type="xref" href="#test_notifications">Example 5-16</a> shows the test logic used with the previous setup. As usual, you can find the complete test case in the examples repository. This test is an <a data-primary="asynchronous JavascriptExecutor scripts" data-type="indexterm" id="idm45849719502752"/><a data-primary="JavascriptExecutor methods" data-secondary="asynchronous scripts" data-type="indexterm" id="idm45849719502144"/>example of asynchronous script execution. This script overrides the original <code>Notification</code> JavaScript object. The new implementation of this object gets the title of the notification message, which is <a data-primary="callbacks" data-type="indexterm" id="idm45849719500656"/>returned in the script callback to the WebDriver test.</p>&#13;
<div data-type="example" id="test_notifications">&#13;
<h5><span class="label">Example 5-16. </span>Test handling notifications</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testNotifications</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/notifications.html"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">JavascriptExecutor</code><code> </code><code class="n">js</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">JavascriptExecutor</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">script</code><code> </code><code class="o">=</code><code> </code><code class="n">String</code><code class="o">.</code><code class="na">join</code><code class="o">(</code><code class="s">"\n"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"const callback = arguments[arguments.length - 1];"</code><code class="o">,</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO14-1" id="co_browser_specific_manipulation_CO14-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>            </code><code class="s">"const OldNotify = window.Notification;"</code><code class="o">,</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO14-2" id="co_browser_specific_manipulation_CO14-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>            </code><code class="s">"function newNotification(title, options) {"</code><code class="o">,</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO14-3" id="co_browser_specific_manipulation_CO14-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>            </code><code class="s">"    callback(title);"</code><code class="o">,</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO14-4" id="co_browser_specific_manipulation_CO14-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>            </code><code class="s">"    return new OldNotify(title, options);"</code><code class="o">,</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO14-5" id="co_browser_specific_manipulation_CO14-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>            </code><code class="s">"}"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"newNotification.requestPermission = "</code><code> </code><code class="o">+</code><code>&#13;
</code><code>                    </code><code class="s">"OldNotify.requestPermission.bind(OldNotify);"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"Object.defineProperty(newNotification, 'permission', {"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"    get: function() {"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"        return OldNotify.permission;"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"    }"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"});"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"window.Notification = newNotification;"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="s">"document.getElementById('notify-me').click();"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO14-6" id="co_browser_specific_manipulation_CO14-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>    </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"Executing the following script asynchronously:\n{}"</code><code class="o">,</code><code> </code><code class="n">script</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">Object</code><code> </code><code class="n">notificationTitle</code><code> </code><code class="o">=</code><code> </code><code class="n">js</code><code class="o">.</code><code class="na">executeAsyncScript</code><code class="o">(</code><code class="n">script</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO14-7" id="co_browser_specific_manipulation_CO14-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">notificationTitle</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="s">"This is a notification"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO14-8" id="co_browser_specific_manipulation_CO14-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO14-1" id="callout_browser_specific_manipulation_CO14-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>As usual in asynchronous script execution, the last argument is the callback function used to signal the script termination.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO14-2" id="callout_browser_specific_manipulation_CO14-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We store a copy of the original <code>Notification</code> constructor.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO14-3" id="callout_browser_specific_manipulation_CO14-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We create a new constructor for notifications.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO14-4" id="callout_browser_specific_manipulation_CO14-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We pass the message title as an argument in the callback. As a result, the title is returned to the WebDriver call (Java in this case).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO14-5" id="callout_browser_specific_manipulation_CO14-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We use the old constructor to create an original <code>Notification</code> object.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO14-6" id="callout_browser_specific_manipulation_CO14-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We click on the button that triggers the notification on the web page.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO14-7" id="callout_browser_specific_manipulation_CO14-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>We get the returned object after the script execution.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO14-8" id="callout_browser_specific_manipulation_CO14-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>We verify the notification title is as <a data-startref="ch5_term36" data-type="indexterm" id="idm45849719258704"/><a data-startref="ch5_term37" data-type="indexterm" id="idm45849719258000"/>expected.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Browser Binary" data-type="sect2"><div class="sect2" id="idm45849719639664">&#13;
<h2>Browser Binary</h2>&#13;
&#13;
<p>Selenium WebDriver detects the path of controlled web browsers (Chrome, Firefox, etc.) out of the box. Nevertheless, <a data-primary="binary paths, browser" data-type="indexterm" id="idm45849719255840"/><a data-primary="browser-specific capabilities" data-secondary="binary path specification" data-type="indexterm" id="idm45849719255136"/><a data-primary="Chrome" data-secondary="binary path for" data-type="indexterm" id="idm45849719254256"/>we can specify a custom path for the browser executable file using capabilities. This feature can be helpful when the installation path of the browser is not standard (for instance, in the case of beta/development/canary browsers).</p>&#13;
&#13;
<p>We use the same capabilities syntax to specify the binary path for Chrome, Edge, and Firefox. <a data-type="xref" href="#caps_chrome_binary">Example 5-17</a> shows a test setup using Chrome beta.</p>&#13;
<div data-type="example" id="caps_chrome_binary">&#13;
<h5><span class="label">Example 5-17. </span>Test setup setting a custom binary path for Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">browserBinary</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"/usr/bin/google-chrome-beta"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO15-1" id="co_browser_specific_manipulation_CO15-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">browserBinary</code><code class="o">)</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO15-2" id="co_browser_specific_manipulation_CO15-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setBinary</code><code class="o">(</code><code class="n">browserBinary</code><code class="o">.</code><code class="na">toFile</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO15-3" id="co_browser_specific_manipulation_CO15-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO15-1" id="callout_browser_specific_manipulation_CO15-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We use a Java <code>Path</code> to get the browser binary path (in this case, Chrome beta in Linux).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO15-2" id="callout_browser_specific_manipulation_CO15-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We use assumptions to conditionally skip this test when the previous path does not exist (e.g., in the CI server).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO15-3" id="callout_browser_specific_manipulation_CO15-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We use the method <code>setBinary</code> of the Chrome options to set the binary path (as a Java <code>File</code>).</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Proxies" data-type="sect2"><div class="sect2" id="idm45849719172048">&#13;
<h2>Web Proxies</h2>&#13;
&#13;
<p>In computer networking, a <em>proxy</em> is a server that acts as an intermediary between a client and a server. A <a data-primary="browser-specific capabilities" data-secondary="web proxies for" data-type="indexterm" id="ch5_term38"/><a data-primary="web proxies" data-type="indexterm" id="ch5_term39"/><a data-primary="HTTP" data-secondary="web proxies and" data-type="indexterm" id="ch5_term40"/><a data-primary="proxies, web" data-type="indexterm" id="ch5_term41"/>web proxy is a proxy between a browser and a web server, and it can serve multiple purposes, such as:</p>&#13;
<dl>&#13;
<dt>Access region-specific information</dt>&#13;
<dd>&#13;
<p>The proxy is typically located in a different region than the client, and the server consequently replies to that region.</p>&#13;
</dd>&#13;
<dt>Avoiding restrictions</dt>&#13;
<dd>&#13;
<p>A proxy can help access blocked websites, for example, by an intermediate <span class="keep-together">firewall</span>.</p>&#13;
</dd>&#13;
<dt>Capture network traffic</dt>&#13;
<dd>&#13;
<p>A proxy can gather HTTP requests and responses.</p>&#13;
</dd>&#13;
<dt>Caching</dt>&#13;
<dd>&#13;
<p>A proxy can allow faster website retrieval.</p>&#13;
</dd>&#13;
</dl>&#13;
&#13;
<p><a data-type="xref" href="#proxy-arch">Figure 5-9</a> represents the location of a web proxy in the <a data-primary="Selenium WebDriver API" data-secondary="architecture of" data-type="indexterm" id="idm45849719117520"/><a data-primary="Selenium WebDriver API" data-secondary="web proxies in" data-type="indexterm" id="idm45849719116576"/>Selenium WebDriver architecture compared to the typical scenario in which a web proxy is not used. As you can see, the web proxy is placed in the middle of the browser and the web application under test, and it works at the HTTP level. This way, the web proxy allows implementing the previously mentioned purposes (e.g., capturing HTTP network traffic) in Selenium WebDriver tests.</p>&#13;
&#13;
<figure><div class="figure" id="proxy-arch">&#13;
<img alt="hosw 0509" src="assets/hosw_0509.png"/>&#13;
<h6><span class="label">Figure 5-9. </span>Selenium WebDriver architecture with and without a web proxy</h6>&#13;
</div></figure>&#13;
&#13;
<p>The Selenium WebDriver API <a data-primary="Proxy class" data-type="indexterm" id="idm45849719112928"/>provides a <code>Proxy</code> class to configure a web proxy. This class is <a data-primary="objects" data-secondary="WebDriver" data-type="indexterm" id="idm45849719111616"/>configured into a <code>WebDriver</code> object using capabilities. <a data-type="xref" href="#http_proxies">Example 5-18</a> illustrates how.</p>&#13;
<div data-type="example" id="http_proxies">&#13;
<h5><span class="label">Example 5-18. </span>Test setup to configure a web proxy</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">Proxy</code><code> </code><code class="n">proxy</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Proxy</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO16-1" id="co_browser_specific_manipulation_CO16-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">proxyStr</code><code> </code><code class="o">=</code><code> </code><code class="s">"proxy:port"</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO16-2" id="co_browser_specific_manipulation_CO16-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">proxy</code><code class="o">.</code><code class="na">setHttpProxy</code><code class="o">(</code><code class="n">proxyStr</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO16-3" id="co_browser_specific_manipulation_CO16-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">proxy</code><code class="o">.</code><code class="na">setSslProxy</code><code class="o">(</code><code class="n">proxyStr</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO16-4" id="co_browser_specific_manipulation_CO16-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setAcceptInsecureCerts</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO16-5" id="co_browser_specific_manipulation_CO16-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setProxy</code><code class="o">(</code><code class="n">proxy</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO16-6" id="co_browser_specific_manipulation_CO16-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO16-1" id="callout_browser_specific_manipulation_CO16-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create an instance of the class <code>Proxy</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO16-2" id="callout_browser_specific_manipulation_CO16-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>The syntax required to specify a proxy is <code>host:port</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO16-3" id="callout_browser_specific_manipulation_CO16-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We specify the proxy is used for HTTP connections.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO16-4" id="callout_browser_specific_manipulation_CO16-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We also specify the proxy is <a data-primary="HTTPS" data-type="indexterm" id="idm45849718957520"/>used for HTTPS connections.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO16-5" id="callout_browser_specific_manipulation_CO16-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>Although not mandatory, it is typically required to accept insecure certificates.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO16-6" id="callout_browser_specific_manipulation_CO16-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We set the proxy as a capability. This line is equivalent to <code>options.setCapability(CapabilityType.PROXY, proxy);</code>.</p></dd>&#13;
</dl>&#13;
<div data-type="tip"><h6>Tip</h6>&#13;
<p><a data-type="xref" href="ch09.html#capture_network_traffic">“Capture Network Traffic”</a> shows how to use a third-party library to capture network traffic by using a web proxy in a <a data-startref="ch5_term38" data-type="indexterm" id="idm45849718949696"/><a data-startref="ch5_term39" data-type="indexterm" id="idm45849718949024"/><a data-startref="ch5_term40" data-type="indexterm" id="idm45849718948352"/><a data-startref="ch5_term41" data-type="indexterm" id="idm45849718947680"/>Selenium WebDriver test.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Log Gathering" data-type="sect2"><div class="sect2" id="log-gathering">&#13;
<h2>Log Gathering</h2>&#13;
&#13;
<p>The Selenium WebDriver API allows <a data-primary="browser log" data-type="indexterm" id="ch5_term42"/><a data-primary="browser-specific capabilities" data-secondary="log gathering" data-type="indexterm" id="ch5_term43"/><a data-primary="log gathering" data-type="indexterm" id="ch5_term44"/><a data-primary="driver.manage().logs()" data-type="indexterm" id="ch5_term45"/>gathering different log sources. This feature is enabled using capabilities, although it is supported only in Chromium-based browsers at the time of this writing. <a data-type="xref" href="#log_gather">Example 5-19</a> presents a test setup <a data-primary="Chrome" data-secondary="log gathering in" data-type="indexterm" id="ch5_term46"/><a data-primary="Chromium" data-secondary="browser capabilities with" data-type="indexterm" id="idm45849718938400"/>that enables gathering browser logs (i.e., console messages). This snippet also contains the test logic, in which we need to invoke <code>driver.manage().logs()</code> to gather the log list.</p>&#13;
<div data-type="example" id="log_gather">&#13;
<h5><span class="label">Example 5-19. </span>Test gathering browser log using Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">LoggingPreferences</code><code> </code><code class="n">logs</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">LoggingPreferences</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">logs</code><code class="o">.</code><code class="na">enable</code><code class="o">(</code><code class="n">LogType</code><code class="o">.</code><code class="na">BROWSER</code><code class="o">,</code><code> </code><code class="n">Level</code><code class="o">.</code><code class="na">ALL</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO17-1" id="co_browser_specific_manipulation_CO17-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setCapability</code><code class="o">(</code><code class="n">CapabilityType</code><code class="o">.</code><code class="na">LOGGING_PREFS</code><code class="o">,</code><code> </code><code class="n">logs</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO17-2" id="co_browser_specific_manipulation_CO17-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testBrowserLogs</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/console-logs.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO17-3" id="co_browser_specific_manipulation_CO17-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">LogEntries</code><code> </code><code class="n">browserLogs</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">manage</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">logs</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">LogType</code><code class="o">.</code><code class="na">BROWSER</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO17-4" id="co_browser_specific_manipulation_CO17-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">Assertions</code><code class="o">.</code><code class="na">assertThat</code><code class="o">(</code><code class="n">browserLogs</code><code class="o">.</code><code class="na">getAll</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isNotEmpty</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO17-5" id="co_browser_specific_manipulation_CO17-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>    </code><code class="n">browserLogs</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">l</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"{}"</code><code class="o">,</code><code> </code><code class="n">l</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO17-6" id="co_browser_specific_manipulation_CO17-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO17-1" id="callout_browser_specific_manipulation_CO17-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We enable gathering all levels of browser logs.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO17-2" id="callout_browser_specific_manipulation_CO17-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We set <a data-primary="loggingPrefs capability" data-type="indexterm" id="idm45849718785312"/>the <code>loggingPrefs</code> capability.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO17-3" id="callout_browser_specific_manipulation_CO17-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We open a practice page that logs several traces in the browser console.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO17-4" id="callout_browser_specific_manipulation_CO17-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We gather all the logs and filter them by browser (console traces).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO17-5" id="callout_browser_specific_manipulation_CO17-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We verify the number of traces is not zero.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO17-6" id="callout_browser_specific_manipulation_CO17-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We display each log in the standard output.</p></dd>&#13;
</dl>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>Log gathering is not available in the W3C WebDriver specification at the time of writing. Nevertheless, it has been <a data-primary="Edge" data-secondary="log gathering in" data-type="indexterm" id="idm45849718707376"/><a data-primary="Edge" data-secondary="and msedgedriver" data-secondary-sortas="msedgedriver" data-type="indexterm" id="idm45849718706400"/><a data-primary="msedgedriver" data-type="indexterm" id="idm45849718705184"/>implemented in some drivers such as chromedriver or msedgedriver (i.e., Chrome and Edge), but it is unavailable in others, such as <a data-startref="ch5_term42" data-type="indexterm" id="idm45849718704384"/><a data-startref="ch5_term43" data-type="indexterm" id="idm45849718703712"/><a data-startref="ch5_term44" data-type="indexterm" id="idm45849718703040"/><a data-startref="ch5_term45" data-type="indexterm" id="idm45849718702368"/><a data-startref="ch5_term46" data-type="indexterm" id="idm45849718701696"/>geckodriver (i.e., Firefox).</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Get User Media" data-type="sect2"><div class="sect2" id="idm45849718700768">&#13;
<h2>Get User Media</h2>&#13;
&#13;
<p><a href="https://webrtc.org">WebRTC</a> is a set of <a data-primary="WebRTC" data-type="indexterm" id="idm45849718698320"/><a data-primary="browser-specific capabilities" data-secondary="user media, access to" data-type="indexterm" id="ch5_term47"/><a data-primary="get user media" data-type="indexterm" id="ch5_term48"/><a data-primary="media, access to user" data-type="indexterm" id="ch5_term49"/><a data-primary="user media, access to" data-type="indexterm" id="ch5_term50"/>standard technologies that allow exchanging real-time media using web browsers. This technology allows the creation of audio- and video conferencing web applications using JavaScript APIs on the client side. The practice site contains a web page that <a data-primary="JavaScript" data-secondary="getUserMedia in" data-type="indexterm" id="idm45849718693440"/>gets user media (microphone and webcam) using the <span class="keep-together"><em>getUserMedia</em></span> JavaScript API. Like in other APIs, and for the sake of security and privacy, a browser pop-up asks for permission before accessing the user media. <a data-type="xref" href="#get-user-media-popup">Figure 5-10</a> shows the sample web page when prompting this dialog.</p>&#13;
&#13;
<figure><div class="figure" id="get-user-media-popup">&#13;
<img alt="hosw 0510" src="assets/hosw_0510.png"/>&#13;
<h6><span class="label">Figure 5-10. </span>Practice site prompting the user media permission pop-up</h6>&#13;
</div></figure>&#13;
&#13;
<p>We use capabilities to <a data-primary="Chrome" data-secondary="media permissions in" data-type="indexterm" id="ch5_term51"/><a data-primary="Edge" data-secondary="media permissions in" data-type="indexterm" id="ch5_term52"/><a data-primary="synthetic user media" data-type="indexterm" id="ch5_term53"/>grant access to the user media in the Selenium WebDriver API. The syntax of these capabilities is the same in Chrome and Edge (see <a data-type="xref" href="#caps_chrome_get_user_media">Example 5-20</a>) but different in Firefox (see <a data-type="xref" href="#caps_firefox_get_user_media">Example 5-21</a>).</p>&#13;
<div data-type="example" id="caps_chrome_get_user_media">&#13;
<h5><span class="label">Example 5-20. </span>Test setup granting synthetic user media in Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addArguments</code><code class="o">(</code><code class="s">"--use-fake-ui-for-media-stream"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO18-1" id="co_browser_specific_manipulation_CO18-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addArguments</code><code class="o">(</code><code class="s">"--use-fake-device-for-media-stream"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO18-2" id="co_browser_specific_manipulation_CO18-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO18-1" id="callout_browser_specific_manipulation_CO18-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Argument to allow accessing user media (audio and video).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO18-2" id="callout_browser_specific_manipulation_CO18-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Argument to fake user media using a synthetic video (green spinner) and audio (a beep per second). You can see this video in <a data-type="xref" href="#get-user-media-chrome">Figure 5-11</a>.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="get-user-media-chrome">&#13;
<img alt="hosw 0511" src="assets/hosw_0511.png"/>&#13;
<h6><span class="label">Figure 5-11. </span>Practice site using synthetic user media in Chrome</h6>&#13;
</div></figure>&#13;
<div data-type="example" id="caps_firefox_get_user_media">&#13;
<h5><span class="label">Example 5-21. </span>Test setup granting synthetic user media in Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">FirefoxOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">FirefoxOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"media.navigator.permission.disabled"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO19-1" id="co_browser_specific_manipulation_CO19-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"media.navigator.streams.fake"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO19-2" id="co_browser_specific_manipulation_CO19-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO19-1" id="callout_browser_specific_manipulation_CO19-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>Preference to <a data-startref="ch5_term51" data-type="indexterm" id="idm45849718528208"/><a data-startref="ch5_term52" data-type="indexterm" id="idm45849718527472"/><a data-primary="Firefox" data-secondary="media permissions in" data-type="indexterm" id="idm45849718526800"/>access the user media.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO19-2" id="callout_browser_specific_manipulation_CO19-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>Preference to fake the user media using a synthetic video (with changing color background) and audio (constant beep). You can see this video in <a data-type="xref" href="#get-user-media-firefox">Figure 5-12</a>.</p></dd>&#13;
</dl>&#13;
&#13;
<figure><div class="figure" id="get-user-media-firefox">&#13;
<img alt="hosw 0512" src="assets/hosw_0512.png"/>&#13;
<h6><span class="label">Figure 5-12. </span>Practice site using synthetic user media in Firefox</h6>&#13;
</div></figure>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Loading Insecure Pages" data-type="sect2"><div class="sect2" id="idm45849718700176">&#13;
<h2>Loading Insecure Pages</h2>&#13;
&#13;
<p>When web <a data-startref="ch5_term47" data-type="indexterm" id="idm45849718482304"/><a data-startref="ch5_term48" data-type="indexterm" id="idm45849718481600"/><a data-startref="ch5_term49" data-type="indexterm" id="idm45849718480896"/><a data-startref="ch5_term50" data-type="indexterm" id="idm45849718480224"/><a data-startref="ch5_term53" data-type="indexterm" id="idm45849718479552"/><a data-primary="HTTPS" data-type="indexterm" id="idm45849718478880"/><a data-primary="browser-specific capabilities" data-secondary="insecure pages, loading" data-type="indexterm" id="ch5_term54"/><a data-primary="insecure pages, loading" data-type="indexterm" id="ch5_term55"/><a data-primary="certificate checks, disabling" data-type="indexterm" id="ch5_term56"/><a data-primary="loading insecure pages" data-type="indexterm" id="ch5_term57"/><a data-primary="security checks, disabling" data-type="indexterm" id="ch5_term58"/>browsers try to load a web page using HTTPS (Hypertext Transfer Protocol Secure) but the <a data-primary="certificates, invalid" data-type="indexterm" id="idm45849718473024"/>certificate on the server side is invalid, the browser warns the user about it. Examples of invalid certificates are self-signed, revoked, or cryptographically unsafe certificates. <a data-type="xref" href="#insecure-cert">Figure 5-13</a> shows a screenshot of this warning in Chrome.</p>&#13;
&#13;
<figure><div class="figure" id="insecure-cert">&#13;
<img alt="hosw 0513" src="assets/hosw_0513.png"/>&#13;
<h6><span class="label">Figure 5-13. </span>Web page using an insecure certificate</h6>&#13;
</div></figure>&#13;
&#13;
<p>This issue does not necessarily imply a security concern. It might happen during the development of a website, for example, when using a self-signed certificate. For this reason, the Selenium WebDriver API allows <a data-primary="acceptInsecureCerts capability" data-type="indexterm" id="idm45849718468944"/>disabling the certificate checks using the <code>acceptInsecureCerts</code> capability. This <a data-primary="Chrome" data-secondary="loading insecure pages in" data-type="indexterm" id="idm45849718467648"/><a data-primary="Edge" data-secondary="loading insecure pages in" data-type="indexterm" id="idm45849718466624"/><a data-primary="Firefox" data-secondary="loading insecure pages in" data-type="indexterm" id="idm45849718465664"/>capability is the same in Chrome, Edge, and Firefox. <a data-type="xref" href="#caps_chrome_insecure">Example 5-22</a> shows a test setup in which this capability is enabled using Chrome. This snippet also contains a test opening an insecure website.</p>&#13;
<div data-type="example" id="caps_chrome_insecure">&#13;
<h5><span class="label">Example 5-22. </span>Test of a web application that uses an insecure certificate</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setAcceptInsecureCerts</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO20-1" id="co_browser_specific_manipulation_CO20-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testInsecure</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://self-signed.badssl.com/"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO20-2" id="co_browser_specific_manipulation_CO20-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">bgColor</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">getCssValue</code><code class="o">(</code><code class="s">"background-color"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Color</code><code> </code><code class="n">red</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Color</code><code class="o">(</code><code class="mi">255</code><code class="o">,</code><code> </code><code class="mi">0</code><code class="o">,</code><code> </code><code class="mi">0</code><code class="o">,</code><code> </code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">Color</code><code class="o">.</code><code class="na">fromString</code><code class="o">(</code><code class="n">bgColor</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">red</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO20-3" id="co_browser_specific_manipulation_CO20-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO20-1" id="callout_browser_specific_manipulation_CO20-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We enable the capability to allow insecure certificates.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO20-2" id="callout_browser_specific_manipulation_CO20-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We open a website using an insecure certificate (self-signed in this case).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO20-3" id="callout_browser_specific_manipulation_CO20-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>If the website is loaded, the body background should be <a data-startref="ch5_term54" data-type="indexterm" id="idm45849718341520"/><a data-startref="ch5_term55" data-type="indexterm" id="idm45849718340816"/><a data-startref="ch5_term56" data-type="indexterm" id="idm45849718340144"/><a data-startref="ch5_term57" data-type="indexterm" id="idm45849718339472"/><a data-startref="ch5_term58" data-type="indexterm" id="idm45849718338800"/>red.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Localization" data-type="sect2"><div class="sect2" id="idm45849718337872">&#13;
<h2>Localization</h2>&#13;
&#13;
<p>In software <a data-primary="browsers" data-secondary="local languages in" data-type="indexterm" id="ch5_term59"/><a data-primary="browser-specific capabilities" data-secondary="localization for end users" data-type="indexterm" id="ch5_term60"/><a data-primary="languages of locale, browsers and" data-type="indexterm" id="ch5_term61"/><a data-primary="localization testing" data-type="indexterm" id="ch5_term63"/><a data-primary="testing" data-secondary="for localization" data-secondary-sortas="localization" data-type="indexterm" id="ch5_term64"/>engineering, <em>localization</em> refers to the process of adapting an application to meet the culture and the language (called <em>locale</em>) of its end users. Localization is <a data-primary="L10 (localization)" data-primary-sortas="Lten (localization)" data-type="indexterm" id="idm45849718277056"/>sometimes written as <em>l10n</em> (10 is the number of letters between <em>l</em> and <em>n</em> in the English word localization). The most <a data-primary="UI (User Interface)" data-secondary="localization in" data-type="indexterm" id="idm45849718274672"/>usual localization activity is translating the text displayed in an application UI to different languages. In addition, other UI aspects can be adjusted depending on the locale, such as the currencies (euros, dollars, etc.), systems of measurement (e.g., metric or imperial systems), or number and date format.</p>&#13;
&#13;
<p>L10n is part of a <a data-primary="internationalization (i18n)" data-type="indexterm" id="idm45849718273440"/><a data-primary="i18n (internationalization)" data-primary-sortas="ieighteen (internationalization)" data-type="indexterm" id="idm45849718272768"/>broader concept called <em>internationalization</em> (i18n), which is the process of designing and developing an application that enables easy l10n for heterogeneous target audiences. Common practices to enable i18n are using Unicode for text encoding or adding CSS support for vertical text or non-Latin typographies.</p>&#13;
&#13;
<p><em>Localization testing</em> is a form of nonfunctional testing where a SUT is verified for specific locale settings. The Selenium WebDriver API allows us to make localization testing based on the browser language by <a data-primary="intl.accept_languages capability" data-type="indexterm" id="ch5_term62"/>setting the capability <code>intl.accept_languages</code>. This capability allows you to specify the locale identifier, such as <em>en_US</em> for American English or <em>es_ES</em> for European Spanish, to name a few. <a data-type="xref" href="#caps_chrome_accept_lang">Example 5-23</a> shows a test setup that <a data-primary="Chrome" data-secondary="localization test in" data-type="indexterm" id="idm45849718267056"/><a data-primary="Edge" data-secondary="localization test in" data-type="indexterm" id="idm45849718266112"/>configures this capability in Chrome. We can use the same syntax in Edge, although we specify this capability as a preference in Firefox (see <a data-type="xref" href="#caps_firefox_accept_lang">Example 5-24</a>).</p>&#13;
<div data-type="example" id="caps_chrome_accept_lang">&#13;
<h5><span class="label">Example 5-23. </span>Test that uses a preferred locale for Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code> </code><code class="n">lang</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">lang</code><code> </code><code class="o">=</code><code> </code><code class="s">"es-ES"</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">ChromeOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ChromeOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">prefs</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">prefs</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"intl.accept_languages"</code><code class="o">,</code><code> </code><code class="n">lang</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO21-1" id="co_browser_specific_manipulation_CO21-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">setExperimentalOption</code><code class="o">(</code><code class="s">"prefs"</code><code class="o">,</code><code> </code><code class="n">prefs</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testAcceptLang</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/multilanguage.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO21-2" id="co_browser_specific_manipulation_CO21-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ResourceBundle</code><code> </code><code class="n">strings</code><code> </code><code class="o">=</code><code> </code><code class="n">ResourceBundle</code><code class="o">.</code><code class="na">getBundle</code><code class="o">(</code><code class="s">"strings"</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Locale</code><code class="o">.</code><code class="na">forLanguageTag</code><code class="o">(</code><code class="n">lang</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO21-3" id="co_browser_specific_manipulation_CO21-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">home</code><code> </code><code class="o">=</code><code> </code><code class="n">strings</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"home"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">content</code><code> </code><code class="o">=</code><code> </code><code class="n">strings</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"content"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">about</code><code> </code><code class="o">=</code><code> </code><code class="n">strings</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"about"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">contact</code><code> </code><code class="o">=</code><code> </code><code class="n">strings</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"contact"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">bodyText</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">bodyText</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="n">home</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="n">content</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="n">about</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="n">contact</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO21-4" id="co_browser_specific_manipulation_CO21-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO21-1" id="callout_browser_specific_manipulation_CO21-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We specify European Spanish as the preferred language in Chrome.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO21-2" id="callout_browser_specific_manipulation_CO21-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We open a practice page that supports multilanguage (English and Spanish).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO21-3" id="callout_browser_specific_manipulation_CO21-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We read the text translations using a resource bundle. You can find these strings in the file <code>strings_es.properties</code> (and <code>strings_en.properties</code>) in the project folder <code>src/test/resources</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO21-4" id="callout_browser_specific_manipulation_CO21-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We assert that the document body contains all the expected strings.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="caps_firefox_accept_lang">&#13;
<h5><span class="label">Example 5-24. </span>Test setup that specifies a preferred locale for Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code>&#13;
<code class="kt">void</code> <code class="nf">setup</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="n">lang</code> <code class="o">=</code> <code class="s">"es-ES"</code><code class="o">;</code>&#13;
    <code class="n">FirefoxOptions</code> <code class="n">options</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FirefoxOptions</code><code class="o">();</code>&#13;
    <code class="n">options</code><code class="o">.</code><code class="na">addPreference</code><code class="o">(</code><code class="s">"intl.accept_languages"</code><code class="o">,</code> <code class="n">lang</code><code class="o">);</code>&#13;
&#13;
    <code class="n">driver</code> <code class="o">=</code> <code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">().</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code>&#13;
            <code class="o">.</code><code class="na">create</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
&#13;
<p>There is a second <a data-primary="Selenium WebDriver API" data-secondary="setting browser language with" data-type="indexterm" id="idm45849717945504"/>alternative to practice localization testing with Selenium WebDriver. Instead of changing the preferred language (which determines the HTTP header <code>accept-language</code>), we can change the default language of the web browser. If that HTTP header is not present, multilanguage applications will use the browser language alternatively. The Selenium WebDriver API allows <a data-primary="lang argument" data-type="indexterm" id="idm45849717914112"/>changing the browser <span class="keep-together">language</span> with a simple argument called <code>--lang</code>, specified as browser capability. This <a data-primary="Chrome" data-secondary="localization test in" data-type="indexterm" id="idm45849717912240"/><a data-primary="Edge" data-secondary="localization test in" data-type="indexterm" id="idm45849717911264"/><a data-primary="Firefox" data-secondary="localization test in" data-type="indexterm" id="idm45849717910320"/>argument is interoperable in Chrome, Edge, and Firefox. <a data-type="xref" href="#caps_chrome_lang">Example 5-25</a> shows how to set the browser language to American English using WebDriver capabilities.</p>&#13;
<div data-type="example" id="caps_chrome_lang">&#13;
<h5><span class="label">Example 5-25. </span>Test setup that changes the browser language in Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code>&#13;
<code class="kt">void</code> <code class="nf">setup</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="n">lang</code> <code class="o">=</code> <code class="s">"en-US"</code><code class="o">;</code>&#13;
    <code class="n">ChromeOptions</code> <code class="n">options</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ChromeOptions</code><code class="o">();</code>&#13;
    <code class="n">options</code><code class="o">.</code><code class="na">addArguments</code><code class="o">(</code><code class="s">"--lang="</code> <code class="o">+</code> <code class="n">lang</code><code class="o">);</code>&#13;
&#13;
    <code class="n">driver</code> <code class="o">=</code> <code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">().</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">).</code><code class="na">create</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Incognito" data-type="sect2"><div class="sect2" id="idm45849717870880">&#13;
<h2>Incognito</h2>&#13;
&#13;
<p>Incognito mode ensures <a data-startref="ch5_term59" data-type="indexterm" id="idm45849717831856"/><a data-startref="ch5_term60" data-type="indexterm" id="idm45849717830768"/><a data-startref="ch5_term61" data-type="indexterm" id="idm45849717830096"/><a data-startref="ch5_term62" data-type="indexterm" id="idm45849717829424"/><a data-startref="ch5_term63" data-type="indexterm" id="idm45849717828752"/><a data-startref="ch5_term64" data-type="indexterm" id="idm45849717828080"/><a data-primary="browser-specific capabilities" data-secondary="incognito mode" data-type="indexterm" id="idm45849717827408"/><a data-primary="incognito argument and mode" data-type="indexterm" id="idm45849717826496"/>that browsers run in a clean state. This mode allows private browsing, i.e., running isolated from the main session and user data. The Selenium WebDriver API enables the execution of browsers in incognito mode using capabilities. <a data-primary="Chrome" data-secondary="incognito mode in" data-type="indexterm" id="idm45849717825728"/><a data-primary="Edge" data-secondary="incognito mode in" data-type="indexterm" id="idm45849717824784"/><a data-primary="Firefox" data-secondary="incognito mode in" data-type="indexterm" id="idm45849717815872"/>For Chrome and Edge, this mode is activated using the <code>--incognito</code> argument (see <a data-type="xref" href="#caps_chrome_incognito">Example 5-26</a>), while in Firefox, <a data-primary="private preference" data-type="indexterm" id="idm45849717813680"/>we use the <code>-private</code> preference (see <a data-type="xref" href="#caps_firefox_incognito">Example 5-27</a>).</p>&#13;
<div data-type="example" id="caps_chrome_incognito">&#13;
<h5><span class="label">Example 5-26. </span>Test setup for using Chrome in incognito mode</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code>&#13;
<code class="kt">void</code> <code class="nf">setup</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="n">ChromeOptions</code> <code class="n">options</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ChromeOptions</code><code class="o">();</code>&#13;
    <code class="n">options</code><code class="o">.</code><code class="na">addArguments</code><code class="o">(</code><code class="s">"--incognito"</code><code class="o">);</code>&#13;
&#13;
    <code class="n">driver</code> <code class="o">=</code> <code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">().</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">).</code><code class="na">create</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
<div data-type="example" id="caps_firefox_incognito">&#13;
<h5><span class="label">Example 5-27. </span>Test setup for using Firefox in incognito mode</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeEach</code>&#13;
<code class="kt">void</code> <code class="nf">setup</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="n">FirefoxOptions</code> <code class="n">options</code> <code class="o">=</code> <code class="k">new</code> <code class="n">FirefoxOptions</code><code class="o">();</code>&#13;
    <code class="n">options</code><code class="o">.</code><code class="na">addArguments</code><code class="o">(</code><code class="s">"-private"</code><code class="o">);</code>&#13;
&#13;
    <code class="n">driver</code> <code class="o">=</code> <code class="n">WebDriverManager</code><code class="o">.</code><code class="na">firefoxdriver</code><code class="o">().</code><code class="na">capabilities</code><code class="o">(</code><code class="n">options</code><code class="o">)</code>&#13;
            <code class="o">.</code><code class="na">create</code><code class="o">();</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Edge in Internet Explorer Mode" data-type="sect2"><div class="sect2" id="idm45849717696368">&#13;
<h2>Edge in Internet Explorer Mode</h2>&#13;
&#13;
<p>Edge offers built-in <a data-primary="browser-specific capabilities" data-secondary="of Edge in IE mode" data-secondary-sortas="Edge in IE mode" data-type="indexterm" id="ch5_term65"/><a data-primary="Edge" data-secondary="in Internet Explorer mode" data-secondary-sortas="Internet Explorer mode" data-type="indexterm" id="ch5_term66"/><a data-primary="Internet Explorer" data-type="indexterm" id="ch5_term67"/><a data-primary="legacy software" data-type="indexterm" id="ch5_term68"/><a data-primary="Microsoft compatibility" data-type="indexterm" id="ch5_term69"/><a data-primary="browsers" data-secondary="legacy" data-type="indexterm" id="ch5_term99"/>support for the Microsoft legacy browser, i.e., Internet Explorer (IE). This way, to create a Selenium WebDriver test that uses Edge in IE mode, we need first to enable the IE mode in Edge. As shown in <a data-type="xref" href="#edge-iemode-config">Figure 5-14</a>, this option is enabled in Edge settings → Default browser → Allow sites to be reloaded in Internet Explorer mode. Then, we can use the Selenium WebDriver API as illustrated in <a data-type="xref" href="#setup_edge_iemode">Example 5-28</a>.</p>&#13;
&#13;
<figure><div class="figure" id="edge-iemode-config">&#13;
<img alt="hosw 0514" src="assets/hosw_0514.png"/>&#13;
<h6><span class="label">Figure 5-14. </span>Browser setup to enable Edge in IE mode</h6>&#13;
</div></figure>&#13;
<div data-type="example" id="setup_edge_iemode">&#13;
<h5><span class="label">Example 5-28. </span>Test setup to use Edge in IE mode</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@BeforeAll</code><code>&#13;
</code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setupClass</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">IS_OS_WINDOWS</code><code class="o">)</code><code class="o">.</code><code class="na">isTrue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO22-1" id="co_browser_specific_manipulation_CO22-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">iedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">setup</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO22-2" id="co_browser_specific_manipulation_CO22-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">Optional</code><code class="o">&lt;</code><code class="n">Path</code><code class="o">&gt;</code><code> </code><code class="n">browserPath</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">edgedriver</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">getBrowserPath</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO22-3" id="co_browser_specific_manipulation_CO22-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">assumeThat</code><code class="o">(</code><code class="n">browserPath</code><code class="o">)</code><code class="o">.</code><code class="na">isPresent</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">InternetExplorerOptions</code><code> </code><code class="n">options</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">InternetExplorerOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">attachToEdgeChrome</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO22-4" id="co_browser_specific_manipulation_CO22-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">withEdgeExecutablePath</code><code class="o">(</code><code class="n">browserPath</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO22-5" id="co_browser_specific_manipulation_CO22-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">InternetExplorerDriver</code><code class="o">(</code><code class="n">options</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO22-6" id="co_browser_specific_manipulation_CO22-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO22-1" id="callout_browser_specific_manipulation_CO22-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We assume that the test is executed in Windows since IE mode is not supported on other operating systems.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO22-2" id="callout_browser_specific_manipulation_CO22-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We use WebDriverManager to manage IEDriver (the driver required by Internet Explorer).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO22-3" id="callout_browser_specific_manipulation_CO22-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We use WebDriverManager to discover the path of Edge.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO22-4" id="callout_browser_specific_manipulation_CO22-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We use IE options to specify that we use Edge in IE mode.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO22-5" id="callout_browser_specific_manipulation_CO22-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We set the previously discovered Edge path on the IE options.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO22-6" id="callout_browser_specific_manipulation_CO22-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We create the driver instance to use Internet <a data-startref="ch5_term65" data-type="indexterm" id="idm45849717494752"/><a data-startref="ch5_term66" data-type="indexterm" id="idm45849717494048"/><a data-startref="ch5_term67" data-type="indexterm" id="idm45849717493376"/><a data-startref="ch5_term68" data-type="indexterm" id="idm45849717492704"/><a data-startref="ch5_term69" data-type="indexterm" id="idm45849717492032"/><a data-startref="ch5_term99" data-type="indexterm" id="idm45849717491360"/>Explorer (which will actually be Edge in IE mode).</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="The Chrome DevTools Protocol" data-type="sect1"><div class="sect1" id="the-chrome-devtools-protocol">&#13;
<h1>The Chrome DevTools Protocol</h1>&#13;
&#13;
<p><a href="https://developer.chrome.com/docs/devtools">Chrome DevTools</a> is a set <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="about" data-type="indexterm" id="idm45849717488512"/><a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="with Chromium" data-secondary-sortas="Chromium" data-type="indexterm" id="idm45849717487536"/><a data-primary="Chromium" data-secondary="Chrome DevTools with" data-type="indexterm" id="idm45849717486352"/><a data-primary="Edge" data-secondary="as Chromium-based browser" data-secondary-sortas="Chromium-based browser" data-type="indexterm" id="idm45849717485408"/><a data-primary="Edge" data-secondary="CDP and" data-seealso="Chrome DevTools Protocol (CDP)" data-type="indexterm" id="idm45849717484224"/>of web developer tools for Chromium-based web browsers, such as Chrome and Edge. These tools allow inspecting, debugging, or profiling these browsers, among other functions. The <a href="https://chromedevtools.github.io/devtools-protocol">Chrome DevTools Protocol (CDP)</a> is a communication protocol that allows the manipulation of the Chrome DevTools by external clients. <a data-primary="Firefox" data-secondary="CDP and" data-type="indexterm" id="idm45849717482112"/>Firefox implements a subset of the CDP to support automation tools like Selenium WebDriver.</p>&#13;
&#13;
<p>There are two ways to <a data-primary="Selenium WebDriver API" data-secondary="CDP with" data-type="indexterm" id="idm45849717480448"/>use CDP in Selenium WebDriver. As of <a data-primary="HasDevTools interface" data-type="indexterm" id="idm45849717479344"/><a data-primary="Selenium WebDriver 4 (version)" data-secondary="CDP protocol in" data-type="indexterm" id="idm45849717478640"/>version 4, Selenium WebDriver provides the interface <code>HasDevTools</code> for sending CDP commands to the browser. This <a data-primary="ChromeDriver" data-type="indexterm" id="idm45849717477152"/><a data-primary="FirefoxDriver" data-type="indexterm" id="idm45849717476448"/><a data-primary="WebDriverManager" data-secondary="for Edge in IE mode" data-secondary-sortas="Edge in IE mode" data-type="indexterm" id="idm45849717475776"/>interface is implemented by <code>ChromiumDriver</code> (used for Chrome and Edge) and <code>FirefoxDriver</code> (for Firefox). This mechanism is quite powerful since it provides direct access to the CDP with Selenium WebDriver. Nevertheless, it has a relevant limitation since it is tied to both the browser type and version.</p>&#13;
&#13;
<p>For this reason, the Selenium WebDriver API provides a second way to use the CDP, based on a set of wrapper classes built on top of CDP for advanced manipulation of the browsers. These wrappers allow different operations, such as network traffic interception or basic and digest authentication. The following subsection explains these wrappers. After that, I present several examples for using the CDP commands directly.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="CDP Selenium Wrappers" data-type="sect2"><div class="sect2" id="idm45849717473248">&#13;
<h2>CDP Selenium Wrappers</h2>&#13;
&#13;
<p>The Selenium WebDriver API <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="Selenium wrappers in" data-type="indexterm" id="ch5_term70"/><a data-primary="wrappers" data-type="indexterm" id="ch5_term71"/>contains a group of helper classes that wraps some of the CDP commands. These classes aim to provide a friendly API enabling advanced features for Selenium WebDriver tests.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Network interceptor" data-type="sect3"><div class="sect3" id="network-interceptor">&#13;
<h3>Network interceptor</h3>&#13;
&#13;
<p>The first wrapper class built on <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="network interceptor in" data-type="indexterm" id="idm45849717467456"/><a data-primary="NetworkInterceptor class" data-type="indexterm" id="idm45849717466464"/><a data-primary="network traffic" data-secondary="intercepting" data-type="indexterm" id="idm45849717465776"/>top of CDP is called <code>NetworkInterceptor</code>. This class allows stubbing the backend requests, intercepting network traffic, and returning pre-canned responses. This feature might help to simplify complex end-to-end tests by mocking external calls with fast, straightforward responses. To instantiate <code>Network ​In⁠terceptor</code>, we need to specify parameters in its constructor (see <a data-type="xref" href="#network_interceptor">Example 5-29</a>):</p>&#13;
&#13;
<ul>&#13;
<li>&#13;
<p>A <code>WebDriver</code> object that implements the CDP (i.e., <code>ChromeDriver</code> or <code>EdgeDriver</code>)</p>&#13;
</li>&#13;
<li>&#13;
<p>A <code>Route</code> object to map the network requests to responses</p>&#13;
</li>&#13;
</ul>&#13;
<div data-type="example" id="network_interceptor">&#13;
<h5><span class="label">Example 5-29. </span>Test intercepting network traffic using NetworkInterceptor</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testNetworkInterceptor</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">Exception</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">img</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="n">ClassLoader</code><code class="o">.</code><code class="na">getSystemResource</code><code class="o">(</code><code class="s">"tools.png"</code><code class="o">)</code><code class="o">.</code><code class="na">toURI</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO23-1" id="co_browser_specific_manipulation_CO23-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="kt">byte</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">bytes</code><code> </code><code class="o">=</code><code> </code><code class="n">Files</code><code class="o">.</code><code class="na">readAllBytes</code><code class="o">(</code><code class="n">img</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="k">try</code><code> </code><code class="o">(</code><code class="n">NetworkInterceptor</code><code> </code><code class="n">interceptor</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">NetworkInterceptor</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Route</code><code class="o">.</code><code class="na">matching</code><code class="o">(</code><code class="n">req</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">req</code><code class="o">.</code><code class="na">getUri</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">endsWith</code><code class="o">(</code><code class="s">".png"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>                    </code><code class="o">.</code><code class="na">to</code><code class="o">(</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">req</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="k">new</code><code> </code><code class="n">HttpResponse</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>                            </code><code class="o">.</code><code class="na">setContent</code><code class="o">(</code><code class="n">Contents</code><code class="o">.</code><code class="na">bytes</code><code class="o">(</code><code class="n">bytes</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO23-2" id="co_browser_specific_manipulation_CO23-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO23-3" id="co_browser_specific_manipulation_CO23-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>        </code><code class="kt">int</code><code> </code><code class="n">width</code><code> </code><code class="o">=</code><code> </code><code class="n">Integer</code><code class="o">.</code><code class="na">parseInt</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"img"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>                </code><code class="o">.</code><code class="na">getAttribute</code><code class="o">(</code><code class="s">"width"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">width</code><code class="o">)</code><code class="o">.</code><code class="na">isGreaterThan</code><code class="o">(</code><code class="mi">80</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO23-4" id="co_browser_specific_manipulation_CO23-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="o">}</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO23-1" id="callout_browser_specific_manipulation_CO23-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We load a local image stored as a test resource in the Java project.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO23-2" id="callout_browser_specific_manipulation_CO23-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We create a network interceptor instance, creating a route for all the requests ending in <code>.png</code>, and stubbing this request with a new response, in this case sending the content of the previous picture.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO23-3" id="callout_browser_specific_manipulation_CO23-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We open the practice site.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO23-4" id="callout_browser_specific_manipulation_CO23-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>If the interception works as expected, the image on the page should have a width higher than the original logo.</p></dd>&#13;
</dl>&#13;
<div data-type="note" epub:type="note"><h6>Note</h6>&#13;
<p>A <code>DevToolsException</code> will be <a data-primary="DevToolsException exception" data-type="indexterm" id="idm45849717294960"/>thrown if a browser different than Chrome or Edge (such as Firefox) is used with previous code.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Basic and digest authentication" data-type="sect3"><div class="sect3" id="basic-and-digest-auth">&#13;
<h3>Basic and digest authentication</h3>&#13;
&#13;
<p>HTTP provides two <a data-primary="authentication, approaches to" data-type="indexterm" id="idm45849717228256"/><a data-primary="basic authentication" data-type="indexterm" id="idm45849717227648"/><a data-primary="digest authentication" data-type="indexterm" id="idm45849717227040"/><a data-primary="credentials, authentication" data-type="indexterm" id="idm45849717226432"/><a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="authentication with" data-type="indexterm" id="idm45849717225824"/>built-in mechanisms for recognizing a user’s identity, called <em>basic</em> and <em>digest</em> authentication. Both methods allow specifying the user’s credential using a pair of values: username and password. The difference between them is how they communicate the credentials. On the one hand, the digest authentication method sends encrypted credentials by applying a hash function to username and password. On the other hand, <a data-primary="Base64" data-type="indexterm" id="idm45849717224080"/>basic authentication uses Base64 to encode (not encrypt) the <span class="keep-together">credentials</span>.</p>&#13;
&#13;
<p>Selenium WebDriver provides <a data-primary="HasAuthentication interface" data-type="indexterm" id="idm45849717222080"/><a data-primary="Selenium WebDriver 4 (version)" data-secondary="authentication in" data-type="indexterm" id="idm45849717221408"/><a data-primary="username and password" data-type="indexterm" id="idm45849717220448"/>the interface <code>HasAuthentication</code> to seamlessly implement basic and digest authentication. <a data-type="xref" href="#basic_auth">Example 5-30</a> shows a test using Chrome and basic authentication. You can use the exact mechanism with Edge and digest authentication (see the complete test in the <a href="https://github.com/bonigarcia/selenium-webdriver-java">example repository</a>).</p>&#13;
<div data-type="example" id="basic_auth">&#13;
<h5><span class="label">Example 5-30. </span>Test using basic authentication with Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testBasicAuth</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="o">(</code><code class="o">(</code><code class="n">HasAuthentication</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">register</code><code class="o">(</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="k">new</code><code> </code><code class="n">UsernameAndPassword</code><code class="o">(</code><code class="s">"guest"</code><code class="o">,</code><code> </code><code class="s">"guest"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO24-1" id="co_browser_specific_manipulation_CO24-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://jigsaw.w3.org/HTTP/Basic/"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO24-2" id="co_browser_specific_manipulation_CO24-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebElement</code><code> </code><code class="n">body</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">body</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Your browser made it!"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO24-3" id="co_browser_specific_manipulation_CO24-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO24-1" id="callout_browser_specific_manipulation_CO24-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We cast the driver object to <code>HasAuthentication</code> and register the credentials (username and password).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO24-2" id="callout_browser_specific_manipulation_CO24-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We open a website protected with basic authentication.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO24-3" id="callout_browser_specific_manipulation_CO24-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We verify the page content is available.</p></dd>&#13;
</dl>&#13;
&#13;
<p>When using other browsers (such as Firefox), we cannot cast the driver object to <code>HasAuthentication</code>. Nevertheless, there is a general way to send the credentials in the URL using <a data-primary="protocol://username:password@domain" data-type="indexterm" id="idm45849717136688"/>the syntax <code>protocol://username:password@domain</code>. <a data-type="xref" href="#basic_auth_generic">Example 5-31</a> demonstrates this use.</p>&#13;
<div data-type="example" id="basic_auth_generic">&#13;
<h5><span class="label">Example 5-31. </span>Test using basic authentication and Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code>&#13;
<code class="kt">void</code> <code class="nf">testGenericAuth</code><code class="o">()</code> <code class="o">{</code>&#13;
    <code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://guest:guest@jigsaw.w3.org/HTTP/Basic/"</code><code class="o">);</code>&#13;
&#13;
    <code class="n">WebElement</code> <code class="n">body</code> <code class="o">=</code> <code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">));</code>&#13;
    <code class="n">assertThat</code><code class="o">(</code><code class="n">body</code><code class="o">.</code><code class="na">getText</code><code class="o">()).</code><code class="na">contains</code><code class="o">(</code><code class="s">"Your browser made it!"</code><code class="o">);</code>&#13;
<code class="o">}</code></pre></div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="CDP Raw Commands" data-type="sect2"><div class="sect2" id="idm45849717034688">&#13;
<h2>CDP Raw Commands</h2>&#13;
&#13;
<p>As of <a data-startref="ch5_term70" data-type="indexterm" id="idm45849717068720"/><a data-startref="ch5_term71" data-type="indexterm" id="idm45849717067632"/><a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="raw commands in" data-type="indexterm" id="ch5_term72"/><a data-primary="Selenium WebDriver 4 (version)" data-secondary="CDP protocol in" data-type="indexterm" id="idm45849717065776"/><a data-primary="HasDevTools interface" data-type="indexterm" id="idm45849717064864"/><a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="with Chromium" data-secondary-sortas="Chromium" data-type="indexterm" id="idm45849717063872"/><a data-primary="Chromium" data-secondary="Chrome DevTools with" data-type="indexterm" id="idm45849717062688"/><a data-primary="ChromeDriver" data-type="indexterm" id="idm45849717061744"/>version 4, Selenium WebDriver provides the interface <code>HasDevTools</code> for using the CDP directly. This <a data-primary="Edge" data-secondary="as Chromium-based browser" data-secondary-sortas="Chromium-based browser" data-type="indexterm" id="idm45849717060560"/><a data-primary="Firefox" data-secondary="CDP and" data-type="indexterm" id="idm45849717059344"/><a data-primary="FirefoxDriver" data-type="indexterm" id="idm45849717058400"/>interface is implemented by <code>ChromiumDriver</code> (used for Chrome and Edge) and <code>FirefoxDriver</code> (for Firefox). To use this feature, we <a data-primary="createSession() method" data-type="indexterm" id="idm45849717056800"/>first need to open a CDP session (i.e., a WebSocket connection between the client and the browser) using the method <code>createSession()</code> of a <code>DevTools</code> instance. <a data-type="xref" href="#cdp_open_close">Example 5-32</a> shows the recommended structure for using CDP in Selenium WebDriver tests. As you can see, the CDP session is created in the test setup and closed in the teardown. Each <a data-primary="devTools class attribute" data-type="indexterm" id="idm45849717054144"/>test will use the class attribute <code>devTools</code> to interact with the Chrome DevTools.</p>&#13;
<div data-type="example" id="cdp_open_close">&#13;
<h5><span class="label">Example 5-32. </span>Test structure to use Chrome DevTools</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="n">WebDriver</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code class="n">DevTools</code><code> </code><code class="n">devTools</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO25-1" id="co_browser_specific_manipulation_CO25-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code class="nd">@BeforeEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">setup</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">WebDriverManager</code><code class="o">.</code><code class="na">chromedriver</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">create</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="o">(</code><code class="n">ChromeDriver</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">)</code><code class="o">.</code><code class="na">getDevTools</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO25-2" id="co_browser_specific_manipulation_CO25-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">createSession</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO25-3" id="co_browser_specific_manipulation_CO25-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="nd">@AfterEach</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">teardown</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">close</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO25-4" id="co_browser_specific_manipulation_CO25-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">quit</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO25-1" id="callout_browser_specific_manipulation_CO25-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We declare a <code>DevTools</code> class attribute.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO25-2" id="callout_browser_specific_manipulation_CO25-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We get the <code>DevTools</code> instance from the driver object. In this example (and the rest), I use <code>ChromeDriver</code> (although <code>EdgeDriver</code> instances would also be valid).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO25-3" id="callout_browser_specific_manipulation_CO25-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We create a CDP session to interact with Chrome DevTools in the test logic.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO25-4" id="callout_browser_specific_manipulation_CO25-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>After each test and before quitting the WebDriver session, we terminate the CDP session.</p></dd>&#13;
</dl>&#13;
&#13;
<p>The following subsections present several examples that illustrate the potential of DevTools in WebDriver tests. In these examples, we use an instance of <code>DevTools</code> for sending CDP commands <a data-primary="send() method" data-type="indexterm" id="idm45849716878576"/>using the method <code>send()</code>. The Selenium WebDriver API provides various commands that allow different operations for testing web applications, such as emulating network conditions, handling HTTP headers, blocking URLs, etc.</p>&#13;
<div data-type="warning" epub:type="warning"><h6>Warning</h6>&#13;
<p>The Selenium WebDriver <a data-primary="browsers" data-secondary="CDP and versions of" data-type="indexterm" id="idm45849716876320"/>tests using the raw CDP commands (<span class="keep-together">as explained</span> in the following subsections) are tied to a given browser version. You can see this version by inspecting the import clauses (e.g., <code>import org.openqa.selenium.devtools.v96.*;</code>) in the complete tests available in the examples repository.</p>&#13;
</div>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Emulate network conditions" data-type="sect3"><div class="sect3" id="idm45849716873856">&#13;
<h3>Emulate network conditions</h3>&#13;
&#13;
<p>The CDP allows the <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="network emulation with" data-type="indexterm" id="ch5_term73"/><a data-primary="emulation of network conditions, CDP for" data-type="indexterm" id="ch5_term74"/><a data-primary="network emulation with CDP" data-type="indexterm" id="ch5_term75"/>emulation of different networks (such as mobile 2G/3G/4G, WiFi, or Bluetooth, among others) and conditions (e.g., latency or throughput). This feature can be helpful to test the behavior of web applications under specific connectivity parameters. <a data-type="xref" href="#cdp_emulate_network">Example 5-33</a> shows a test using this feature. As you can see, this test <a data-primary="Network.enable() command" data-type="indexterm" id="idm45849716868064"/>sends two CDP commands:</p>&#13;
<dl>&#13;
<dt><code>Network.enable()</code></dt>&#13;
<dd>&#13;
<p>To activate network tracking. This command has three optional arguments:</p>&#13;
<dl>&#13;
<dt><code>Optional&lt;Integer&gt; maxTotalBufferSize</code></dt>&#13;
<dd>&#13;
<p>Maximum buffer size (in bytes) for network payloads.</p>&#13;
</dd>&#13;
<dt><code>Optional&lt;Integer&gt; maxResourceBufferSize</code></dt>&#13;
<dd>&#13;
<p>Maximum buffer size (in bytes) for single resources.</p>&#13;
</dd>&#13;
<dt><code>Optional&lt;Integer&gt; maxPostDataSize</code></dt>&#13;
<dd>&#13;
<p>Longest post body size (in bytes).</p>&#13;
</dd>&#13;
</dl>&#13;
</dd>&#13;
<dt><code>Network.emulateNetworkConditions()</code></dt>&#13;
<dd>&#13;
<p>To activate <a data-primary="Network.emulateNetworkConditions() command" data-type="indexterm" id="idm45849716859088"/>network emulation. The emulated conditions are specified using the following parameters:</p>&#13;
<dl>&#13;
<dt><code>Boolean offline</code></dt>&#13;
<dd>&#13;
<p>To emulate no connection to the internet.&#13;
<code>Number latency</code>: Minimum latency (in ms) from request to response.</p>&#13;
</dd>&#13;
<dt><code>Number downloadThroughput</code></dt>&#13;
<dd>&#13;
<p>Maximal download throughput (in bytes/sec). <code>-1</code> disables download <span class="keep-together">throttling</span>.</p>&#13;
</dd>&#13;
<dt><code>Number uploadThroughput</code></dt>&#13;
<dd>&#13;
<p>Maximal upload throughput (in bytes/sec). <code>-1</code> disables upload throttling.</p>&#13;
</dd>&#13;
<dt><code>Optional&lt;ConnectionType&gt; connectionType</code></dt>&#13;
<dd>&#13;
<p>Emulated connection technology. The enumeration <code>ConnectionType</code> accepts the following options: <code>NONE</code>, <code>CELLULAR2G</code>, <code>CELLULAR3G</code>, <code>CELLULAR4G</code>, <code>BLUETOOTH</code>, <code>ETHERNET</code>, <code>WIFI</code>, <code>WIMAX</code>, and <code>OTHER</code>.</p>&#13;
</dd>&#13;
</dl>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="example" id="cdp_emulate_network">&#13;
<h5><span class="label">Example 5-33. </span>Test emulating network conditions</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testEmulateNetworkConditions</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">enable</code><code class="o">(</code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO26-1" id="co_browser_specific_manipulation_CO26-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">emulateNetworkConditions</code><code class="o">(</code><code class="kc">false</code><code class="o">,</code><code> </code><code class="mi">100</code><code class="o">,</code><code> </code><code class="mi">50</code><code> </code><code class="o">*</code><code> </code><code class="mi">1024</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="mi">50</code><code> </code><code class="o">*</code><code> </code><code class="mi">1024</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">ConnectionType</code><code class="o">.</code><code class="na">CELLULAR3G</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO26-2" id="co_browser_specific_manipulation_CO26-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kt">long</code><code> </code><code class="n">initMillis</code><code> </code><code class="o">=</code><code> </code><code class="n">System</code><code class="o">.</code><code class="na">currentTimeMillis</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO26-3" id="co_browser_specific_manipulation_CO26-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO26-4" id="co_browser_specific_manipulation_CO26-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">Duration</code><code> </code><code class="n">elapsed</code><code> </code><code class="o">=</code><code> </code><code class="n">Duration</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">ofMillis</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">currentTimeMillis</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code> </code><code class="n">initMillis</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO26-5" id="co_browser_specific_manipulation_CO26-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>    </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"The page took {} ms to be loaded"</code><code class="o">,</code><code> </code><code class="n">elapsed</code><code class="o">.</code><code class="na">toMillis</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO26-1" id="callout_browser_specific_manipulation_CO26-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We activate <a data-primary="network traffic" data-secondary="activating tracking of" data-type="indexterm" id="idm45849716682688"/>network tracking (without tuning any network parameter).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO26-2" id="callout_browser_specific_manipulation_CO26-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We emulate a mobile 3G network with 50 KBps as download and upload <span class="keep-together">bandwidth</span>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO26-3" id="callout_browser_specific_manipulation_CO26-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We get a system timestamp before loading a web page.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO26-4" id="callout_browser_specific_manipulation_CO26-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We load the index page of the practice site.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO26-5" id="callout_browser_specific_manipulation_CO26-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We calculate the <a data-primary="timestamp, system" data-type="indexterm" id="idm45849716632064"/>required time to load this page.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Network monitoring" data-type="sect3"><div class="sect3" id="section-network-monitoring">&#13;
<h3>Network monitoring</h3>&#13;
&#13;
<p>We can also use the <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="network monitoring with" data-type="indexterm" id="idm45849716629360"/><a data-primary="network traffic" data-secondary="monitoring" data-type="indexterm" id="idm45849716628416"/><a data-primary="listeners" data-secondary="for network monitoring" data-secondary-sortas="network monitoring" data-type="indexterm" id="idm45849716627440"/>CDP to monitor network traffic when interacting with web pages. <a data-type="xref" href="#cdp_network_monitoring">Example 5-34</a> shows a test using this feature. This <a data-primary="addListener() method" data-type="indexterm" id="idm45849716625296"/><a data-primary="HTTP" data-secondary="requests and responses, monitoring" data-type="indexterm" id="idm45849716624624"/>test uses the method <code>add​Lis⁠tener()</code> of a <code>DevTools</code> object to trace HTTP requests and responses.</p>&#13;
<div data-type="example" id="cdp_network_monitoring">&#13;
<h5><span class="label">Example 5-34. </span>Test monitoring HTTP requests and responses</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testNetworkMonitoring</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">enable</code><code class="o">(</code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">addListener</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">requestWillBeSent</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">request</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"Request {}"</code><code class="o">,</code><code> </code><code class="n">request</code><code class="o">.</code><code class="na">getRequestId</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"\t Method: {}"</code><code class="o">,</code><code> </code><code class="n">request</code><code class="o">.</code><code class="na">getRequest</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getMethod</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"\t URL: {}"</code><code class="o">,</code><code> </code><code class="n">request</code><code class="o">.</code><code class="na">getRequest</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getUrl</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">logHeaders</code><code class="o">(</code><code class="n">request</code><code class="o">.</code><code class="na">getRequest</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getHeaders</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO27-1" id="co_browser_specific_manipulation_CO27-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">addListener</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">responseReceived</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">response</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"Response {}"</code><code class="o">,</code><code> </code><code class="n">response</code><code class="o">.</code><code class="na">getRequestId</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"\t URL: {}"</code><code class="o">,</code><code> </code><code class="n">response</code><code class="o">.</code><code class="na">getResponse</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getUrl</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"\t Status: {}"</code><code class="o">,</code><code> </code><code class="n">response</code><code class="o">.</code><code class="na">getResponse</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getStatus</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">logHeaders</code><code class="o">(</code><code class="n">response</code><code class="o">.</code><code class="na">getResponse</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getHeaders</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO27-2" id="co_browser_specific_manipulation_CO27-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code><code>&#13;
</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">logHeaders</code><code class="o">(</code><code class="n">Headers</code><code> </code><code class="n">headers</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"\t Headers:"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">headers</code><code class="o">.</code><code class="na">toJson</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="o">(</code><code class="n">k</code><code class="o">,</code><code> </code><code class="n">v</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"\t\t{}:{}"</code><code class="o">,</code><code> </code><code class="n">k</code><code class="o">,</code><code> </code><code class="n">v</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO27-1" id="callout_browser_specific_manipulation_CO27-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create a <a data-primary="listeners" data-secondary="for console event monitoring" data-secondary-sortas="console event monitoring" data-type="indexterm" id="idm45849716294592"/>listener for HTTP requests and log the captured data in the console.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO27-2" id="callout_browser_specific_manipulation_CO27-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We create a listener for HTTP responses and log the captured data in <a data-startref="ch5_term73" data-type="indexterm" id="idm45849716609296"/><a data-startref="ch5_term74" data-type="indexterm" id="idm45849716608592"/><a data-startref="ch5_term75" data-type="indexterm" id="idm45849716607920"/>the console.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Full-page screenshot" data-type="sect3"><div class="sect3" id="fullpage-screenshot">&#13;
<h3>Full-page screenshot</h3>&#13;
&#13;
<p>Another possible use of the <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="full page screenshots with" data-type="indexterm" id="ch5_term76"/><a data-primary="full page screenshots with CDP" data-type="indexterm" id="ch5_term77"/><a data-primary="screenshots" data-secondary="full page" data-type="indexterm" id="ch5_term78"/>CDP is making screenshots of a full page (i.e., capture the content page beyond the viewport). <a data-type="xref" href="#fullpage-screenshot-chrome">Example 5-35</a> demonstrates this feature in Chrome.</p>&#13;
<div data-type="example" id="fullpage-screenshot-chrome">&#13;
<h5><span class="label">Example 5-35. </span>Test making a full-page screenshot using CDP in Chrome</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testFullPageScreenshotChrome</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">IOException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/long-page.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO28-1" id="co_browser_specific_manipulation_CO28-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">WebDriverWait</code><code> </code><code class="n">wait</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">WebDriverWait</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">Duration</code><code class="o">.</code><code class="na">ofSeconds</code><code class="o">(</code><code class="mi">10</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">wait</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code class="n">ExpectedConditions</code><code class="o">.</code><code class="na">presenceOfNestedElementsLocatedBy</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="n">By</code><code class="o">.</code><code class="na">className</code><code class="o">(</code><code class="s">"container"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"p"</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO28-2" id="co_browser_specific_manipulation_CO28-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">GetLayoutMetricsResponse</code><code> </code><code class="n">metrics</code><code> </code><code class="o">=</code><code> </code><code class="n">devTools</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Page</code><code class="o">.</code><code class="na">getLayoutMetrics</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Rect</code><code> </code><code class="n">contentSize</code><code> </code><code class="o">=</code><code> </code><code class="n">metrics</code><code class="o">.</code><code class="na">getContentSize</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO28-3" id="co_browser_specific_manipulation_CO28-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">screenshotBase64</code><code> </code><code class="o">=</code><code> </code><code class="n">devTools</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Page</code><code class="o">.</code><code class="na">captureScreenshot</code><code class="o">(</code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>                    </code><code class="n">Optional</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">Viewport</code><code class="o">(</code><code class="mi">0</code><code class="o">,</code><code> </code><code class="mi">0</code><code class="o">,</code><code> </code><code class="n">contentSize</code><code class="o">.</code><code class="na">getWidth</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>                            </code><code class="n">contentSize</code><code class="o">.</code><code class="na">getHeight</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="mi">1</code><code class="o">)</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>                    </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO28-4" id="co_browser_specific_manipulation_CO28-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">destination</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"fullpage-screenshot-chrome.png"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Files</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">destination</code><code class="o">,</code><code> </code><code class="n">Base64</code><code class="o">.</code><code class="na">getDecoder</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">decode</code><code class="o">(</code><code class="n">screenshotBase64</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO28-5" id="co_browser_specific_manipulation_CO28-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">destination</code><code class="o">)</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO28-6" id="co_browser_specific_manipulation_CO28-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO28-1" id="callout_browser_specific_manipulation_CO28-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We load the practice page containing a long text (and therefore, its content goes beyond the standard viewport).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO28-2" id="callout_browser_specific_manipulation_CO28-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We wait until the paragraphs are loaded.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO28-3" id="callout_browser_specific_manipulation_CO28-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We get the <a data-primary="page layout metrics" data-type="indexterm" id="idm45849716066464"/>page layout metrics (to calculate the page dimensions).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO28-4" id="callout_browser_specific_manipulation_CO28-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We send the CDP command to make a screenshot beyond the page viewport. As a result, we obtain the screenshot as a <a data-primary="Base64" data-type="indexterm" id="idm45849716063120"/>string in Base64.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO28-5" id="callout_browser_specific_manipulation_CO28-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We decode the Base64 content <a data-primary="PNG format, screenshots with" data-type="indexterm" id="idm45849715978560"/>into a PNG file.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO28-6" id="callout_browser_specific_manipulation_CO28-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We assert the PNG file exists at the end of the test.</p></dd>&#13;
</dl>&#13;
&#13;
<p>This feature is available in other browsers with a full implementation of the CDP, such as Chrome or Edge. Nevertheless, it might not be available in others like Firefox. Luckily, <a data-primary="Firefox" data-secondary="full page screenshots in" data-type="indexterm" id="idm45849715975296"/><a data-primary="getFullPageScreenshotAs() method" data-type="indexterm" id="idm45849715974448"/>Firefox supports the same characteristic through the method <code>getFullPageScreenshotAs()</code> available <a data-primary="FirefoxDriver" data-type="indexterm" id="idm45849715973328"/>in <code>FirefoxDriver</code> objects. <a data-type="xref" href="#fullpage-screenshot-firefox">Example 5-36</a> shows a test using this method and Firefox.</p>&#13;
<div data-type="example" id="fullpage-screenshot-firefox">&#13;
<h5><span class="label">Example 5-36. </span>Test making a full-page screenshot using Firefox</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testFullPageScreenshotFirefox</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">IOException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/long-page.html"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">WebDriverWait</code><code> </code><code class="n">wait</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">WebDriverWait</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">Duration</code><code class="o">.</code><code class="na">ofSeconds</code><code class="o">(</code><code class="mi">10</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">wait</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code class="n">ExpectedConditions</code><code class="o">.</code><code class="na">presenceOfNestedElementsLocatedBy</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="n">By</code><code class="o">.</code><code class="na">className</code><code class="o">(</code><code class="s">"container"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"p"</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kt">byte</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">imageBytes</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="o">(</code><code class="n">FirefoxDriver</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">getFullPageScreenshotAs</code><code class="o">(</code><code class="n">OutputType</code><code class="o">.</code><code class="na">BYTES</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO29-1" id="co_browser_specific_manipulation_CO29-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">destination</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"fullpage-screenshot-firefox.png"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Files</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">destination</code><code class="o">,</code><code> </code><code class="n">imageBytes</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">destination</code><code class="o">)</code><code class="o">.</code><code class="na">exists</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO29-1" id="callout_browser_specific_manipulation_CO29-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We make the whole page screenshot. As with the regular screenshots (see <a data-type="xref" href="ch04.html#output-types-for-screenshots">Table 4-2</a> in <a data-type="xref" href="ch04.html#ch04">Chapter 4</a>), the output type can be <code>FILE</code>, <code>BASE64</code>, or <code>BYTES</code>. We use the latter to get the screenshot as a <a data-startref="ch5_term76" data-type="indexterm" id="idm45849715863616"/><a data-startref="ch5_term77" data-type="indexterm" id="idm45849715862912"/><a data-startref="ch5_term78" data-type="indexterm" id="idm45849715862240"/>byte array.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Performance metrics" data-type="sect3"><div class="sect3" id="idm45849715861312">&#13;
<h3>Performance metrics</h3>&#13;
&#13;
<p>CDP allows <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="performance metrics with" data-type="indexterm" id="idm45849715860016"/><a data-primary="performance metrics with CDP" data-type="indexterm" id="idm45849715859072"/><a data-primary="runtime performance metrics with CDP" data-type="indexterm" id="idm45849715858432"/><a data-primary="metrics, collecting performance" data-type="indexterm" id="idm45849715857792"/>gathering runtime performance metrics, such as number of documents loaded, number of DOM nodes, time to load DOM, and script duration, among many others. <a data-type="xref" href="#cdp_performance_metrics">Example 5-37</a> shows a test gathering these metrics and showing them in the standard output.</p>&#13;
<div data-type="example" id="cdp_performance_metrics">&#13;
<h5><span class="label">Example 5-37. </span>Test gathering performance metrics</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testPerformanceMetrics</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Performance</code><code class="o">.</code><code class="na">enable</code><code class="o">(</code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO30-1" id="co_browser_specific_manipulation_CO30-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">Metric</code><code class="o">&gt;</code><code> </code><code class="n">metrics</code><code> </code><code class="o">=</code><code> </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Performance</code><code class="o">.</code><code class="na">getMetrics</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO30-2" id="co_browser_specific_manipulation_CO30-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">metrics</code><code class="o">)</code><code class="o">.</code><code class="na">isNotEmpty</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">metrics</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">metric</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"{}: {}"</code><code class="o">,</code><code> </code><code class="n">metric</code><code class="o">.</code><code class="na">getName</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">metric</code><code class="o">.</code><code class="na">getValue</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO30-1" id="callout_browser_specific_manipulation_CO30-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We enable collecting metrics.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO30-2" id="callout_browser_specific_manipulation_CO30-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We gather all metrics.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Extra headers" data-type="sect3"><div class="sect3" id="idm45849715717520">&#13;
<h3>Extra headers</h3>&#13;
&#13;
<p>CDP allows <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="extra headers with" data-type="indexterm" id="idm45849715716032"/><a data-primary="headers, additional" data-type="indexterm" id="idm45849715715184"/><a data-primary="HTTP" data-secondary="and headers" data-secondary-sortas="headers" data-type="indexterm" id="idm45849715714576"/><a data-primary="Network.setExtraHTTPHeaders() command" data-type="indexterm" id="idm45849715713488"/>additional headers at the HTTP level. To that aim, we need to send the command <code>Network.setExtraHTTPHeaders()</code> in a CDP session. <a data-type="xref" href="#cdp_extra_headers">Example 5-38</a> shows a test that <a data-primary="authentication, approaches to" data-type="indexterm" id="idm45849715663552"/><a data-primary="basic authentication" data-type="indexterm" id="idm45849715662944"/><a data-primary="credentials, authentication" data-type="indexterm" id="idm45849715662336"/><a data-primary="username and password" data-type="indexterm" id="idm45849715661728"/>uses this command to add the HTTP header <code>Authorization</code>, for sending credentials (username and password) in a web page that requires basic authentication to log in.</p>&#13;
<div data-type="example" id="cdp_extra_headers">&#13;
<h5><span class="label">Example 5-38. </span>Test adding extra HTTP headers</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testExtraHeaders</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">enable</code><code class="o">(</code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">userName</code><code> </code><code class="o">=</code><code> </code><code class="s">"guest"</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">password</code><code> </code><code class="o">=</code><code> </code><code class="s">"guest"</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">headers</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">basicAuth</code><code> </code><code class="o">=</code><code> </code><code class="s">"Basic "</code><code> </code><code class="o">+</code><code> </code><code class="k">new</code><code> </code><code class="n">String</code><code class="o">(</code><code class="n">Base64</code><code class="o">.</code><code class="na">getEncoder</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">encode</code><code class="o">(</code><code class="n">String</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"%s:%s"</code><code class="o">,</code><code> </code><code class="n">userName</code><code class="o">,</code><code> </code><code class="n">password</code><code class="o">)</code><code class="o">.</code><code class="na">getBytes</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">headers</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"Authorization"</code><code class="o">,</code><code> </code><code class="n">basicAuth</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO31-1" id="co_browser_specific_manipulation_CO31-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">setExtraHTTPHeaders</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">Headers</code><code class="o">(</code><code class="n">headers</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO31-2" id="co_browser_specific_manipulation_CO31-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://jigsaw.w3.org/HTTP/Basic/"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO31-3" id="co_browser_specific_manipulation_CO31-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">bodyText</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">getText</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">bodyText</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Your browser made it!"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO31-4" id="co_browser_specific_manipulation_CO31-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO31-1" id="callout_browser_specific_manipulation_CO31-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We encode the username and password <a data-primary="Base64" data-type="indexterm" id="idm45849715640624"/>in Base64.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO31-2" id="callout_browser_specific_manipulation_CO31-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We create the authorization header.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO31-3" id="callout_browser_specific_manipulation_CO31-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We open a web page protected with basic authentication.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO31-4" id="callout_browser_specific_manipulation_CO31-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We verify that the page is correctly displayed.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Block URLs" data-type="sect3"><div class="sect3" id="idm45849715619344">&#13;
<h3>Block URLs</h3>&#13;
&#13;
<p>CDP provides the <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="blocking URLs with" data-type="indexterm" id="idm45849715618160"/><a data-primary="URLs, blocking" data-type="indexterm" id="idm45849715426960"/>ability to block given URLs in a session. <a data-type="xref" href="#cdp_block_urls">Example 5-39</a> provides a test blocking the practice web page logo URL. If you run this test and inspect the browser during the execution, you will discover that this logo is not displayed on the page.</p>&#13;
<div data-type="example" id="cdp_block_urls">&#13;
<h5><span class="label">Example 5-39. </span>Test blocking a URL</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testBlockUrl</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">enable</code><code class="o">(</code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">urlToBlock</code><code> </code><code class="o">=</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/img/hands-on-icon.png"</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">setBlockedURLs</code><code class="o">(</code><code class="n">ImmutableList</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="n">urlToBlock</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO32-1" id="co_browser_specific_manipulation_CO32-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">addListener</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">loadingFailed</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">loadingFailed</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">BlockedReason</code><code> </code><code class="n">reason</code><code> </code><code class="o">=</code><code> </code><code class="n">loadingFailed</code><code class="o">.</code><code class="na">getBlockedReason</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"Blocking reason: {}"</code><code class="o">,</code><code> </code><code class="n">reason</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">assertThat</code><code class="o">(</code><code class="n">reason</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">BlockedReason</code><code class="o">.</code><code class="na">INSPECTOR</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO32-2" id="co_browser_specific_manipulation_CO32-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO32-1" id="callout_browser_specific_manipulation_CO32-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We block a given URL.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO32-2" id="callout_browser_specific_manipulation_CO32-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We create a listener to trace the failed events.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Device emulation" data-type="sect3"><div class="sect3" id="sect-cdp-device-emulation">&#13;
<h3>Device emulation</h3>&#13;
&#13;
<p>Another feature provided by CDP is the <a data-primary="browser-specific capabilities" data-secondary="device emulation" data-type="indexterm" id="idm45849715278960"/><a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="device emulation with" data-type="indexterm" id="idm45849715278016"/><a data-primary="device emulation" data-type="indexterm" id="idm45849715277104"/><a data-primary="Emulation.setDeviceMetricsOverride command" data-type="indexterm" id="idm45849715276432"/><a data-primary="mobile devices, emulation of" data-type="indexterm" id="idm45849715275792"/><a data-primary="Network.setUserAgentOverride() command" data-type="indexterm" id="idm45849715275152"/><a data-primary="simulation of mobile devices" data-type="indexterm" id="idm45849715274512"/><a data-primary="emulation of mobile devices" data-type="indexterm" id="idm45849715273872"/>ability to emulate mobile devices (e.g., smartphones, tablets). <a data-type="xref" href="#cdp_device_emulation">Example 5-40</a> illustrates this usage. This test first overrides the user agent by sending the command <code>Network.setUserAgentOverride()</code>. Then, it emulates the device metrics sending the command <code>Emulation.setDeviceMetrics​O⁠verride</code>.</p>&#13;
<div data-type="example" id="cdp_device_emulation">&#13;
<h5><span class="label">Example 5-40. </span>Test emulating a mobile device</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testDeviceEmulation</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="c1">// 1. Override user agent (Apple iPhone 6)&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">userAgent</code><code> </code><code class="o">=</code><code> </code><code class="s">"Mozilla/5.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X)"</code><code>&#13;
</code><code>            </code><code class="o">+</code><code> </code><code class="s">"AppleWebKit/600.1.3 (KHTML, like Gecko)"</code><code>&#13;
</code><code>            </code><code class="o">+</code><code> </code><code class="s">"Version/8.0 Mobile/12A4345d Safari/600.1.4"</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">setUserAgentOverride</code><code class="o">(</code><code class="n">userAgent</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO33-1" id="co_browser_specific_manipulation_CO33-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1">// 2. Emulate device dimension&#13;
</code><code>    </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">Object</code><code class="o">&gt;</code><code> </code><code class="n">deviceMetrics</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">deviceMetrics</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"width"</code><code class="o">,</code><code> </code><code class="mi">375</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">deviceMetrics</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"height"</code><code class="o">,</code><code> </code><code class="mi">667</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">deviceMetrics</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"mobile"</code><code class="o">,</code><code> </code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">deviceMetrics</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"deviceScaleFactor"</code><code class="o">,</code><code> </code><code class="mi">2</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">(</code><code class="o">(</code><code class="n">ChromeDriver</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">)</code><code class="o">.</code><code class="na">executeCdpCommand</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"Emulation.setDeviceMetricsOverride"</code><code class="o">,</code><code> </code><code class="n">deviceMetrics</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO33-2" id="co_browser_specific_manipulation_CO33-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">driver</code><code class="o">.</code><code class="na">getTitle</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"Selenium WebDriver"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO33-1" id="callout_browser_specific_manipulation_CO33-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We override the user agent for emulating an Apple iPhone 6.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO33-2" id="callout_browser_specific_manipulation_CO33-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We override the device screen parameters.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Console listeners" data-type="sect3"><div class="sect3" id="idm45849715065536">&#13;
<h3>Console listeners</h3>&#13;
&#13;
<p>CDP allows you to <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="console listeners with" data-type="indexterm" id="idm45849715064016"/><a data-primary="console listeners" data-type="indexterm" id="idm45849715063040"/><a data-primary="event listeners" data-type="indexterm" id="idm45849715062368"/>implement listeners to monitor console events, i.e., a web page JavaScript log and error traces. <a data-type="xref" href="#cdp_console_listener">Example 5-41</a> shows the test. This test uses a web page in the practice site that intentionally traces several JavaScript messages (using the commands <code>console.log()</code>, <code>console.error()</code>, etc.) and also throws a JavaScript exception.</p>&#13;
<div data-type="example" id="cdp_console_listener">&#13;
<h5><span class="label">Example 5-41. </span>Test listening to console events</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testConsoleListener</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">Exception</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">CompletableFuture</code><code class="o">&lt;</code><code class="n">ConsoleEvent</code><code class="o">&gt;</code><code> </code><code class="n">futureEvents</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">CompletableFuture</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">getDomains</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">events</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">addConsoleListener</code><code class="o">(</code><code class="nl">futureEvents:</code><code class="o">:</code><code class="n">complete</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO34-1" id="co_browser_specific_manipulation_CO34-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">CompletableFuture</code><code class="o">&lt;</code><code class="n">JavascriptException</code><code class="o">&gt;</code><code> </code><code class="n">futureJsExc</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">CompletableFuture</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">getDomains</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">events</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">addJavascriptExceptionListener</code><code class="o">(</code><code class="nl">futureJsExc:</code><code class="o">:</code><code class="n">complete</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO34-2" id="co_browser_specific_manipulation_CO34-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/console-logs.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO34-3" id="co_browser_specific_manipulation_CO34-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">ConsoleEvent</code><code> </code><code class="n">consoleEvent</code><code> </code><code class="o">=</code><code> </code><code class="n">futureEvents</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">5</code><code class="o">,</code><code> </code><code class="n">TimeUnit</code><code class="o">.</code><code class="na">SECONDS</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO34-4" id="co_browser_specific_manipulation_CO34-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"ConsoleEvent: {} {} {}"</code><code class="o">,</code><code> </code><code class="n">consoleEvent</code><code class="o">.</code><code class="na">getTimestamp</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">consoleEvent</code><code class="o">.</code><code class="na">getType</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">consoleEvent</code><code class="o">.</code><code class="na">getMessages</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO34-5" id="co_browser_specific_manipulation_CO34-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">JavascriptException</code><code> </code><code class="n">jsException</code><code> </code><code class="o">=</code><code> </code><code class="n">futureJsExc</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="mi">5</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">TimeUnit</code><code class="o">.</code><code class="na">SECONDS</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO34-6" id="co_browser_specific_manipulation_CO34-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>    </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"JavascriptException: {} {}"</code><code class="o">,</code><code> </code><code class="n">jsException</code><code class="o">.</code><code class="na">getMessage</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">jsException</code><code class="o">.</code><code class="na">getSystemInformation</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO34-1" id="callout_browser_specific_manipulation_CO34-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create a listener for console events.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO34-2" id="callout_browser_specific_manipulation_CO34-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We create another listener for JavaScript errors.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO34-3" id="callout_browser_specific_manipulation_CO34-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We open the practice page that writes messages in the browser console.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO34-4" id="callout_browser_specific_manipulation_CO34-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We wait a maximum of five seconds until a console event is received.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO34-5" id="callout_browser_specific_manipulation_CO34-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We write the information on the received console event in the standard output.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO34-6" id="callout_browser_specific_manipulation_CO34-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We repeat the same procedure for the JavaScript exceptions.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Geolocation override" data-type="sect3"><div class="sect3" id="idm45849714809968">&#13;
<h3>Geolocation override</h3>&#13;
&#13;
<p>Another feature provided by CDP is the <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="geolocation override with" data-type="indexterm" id="idm45849714749600"/><a data-primary="geolocation" data-secondary="override of" data-type="indexterm" id="idm45849714748752"/><a data-primary="Emulation.setGeolocationOverride() command" data-type="indexterm" id="idm45849714747840"/><a data-primary="location coordinates, overriding" data-type="indexterm" id="idm45849714747136"/>ability to override the geolocation coordinates handled by the hosting device.  <a data-type="xref" href="#cdp_geolocation_override">Example 5-42</a> demonstrates how to do it. This test sends the command <code>Emulation.setGeolocationOverride()</code>, which accepts three optional arguments: latitude, longitude, and accuracy.</p>&#13;
<div class="pagebreak-before less_space" data-type="example" id="cdp_geolocation_override">&#13;
<h5><span class="label">Example 5-42. </span>Test overriding location coordinates</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testGeolocationOverride</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Emulation</code><code class="o">.</code><code class="na">setGeolocationOverride</code><code class="o">(</code><code class="n">Optional</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="mf">48.8584</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Optional</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="mf">2.2945</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">of</code><code class="o">(</code><code class="mi">100</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO35-1" id="co_browser_specific_manipulation_CO35-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/geolocation.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO35-2" id="co_browser_specific_manipulation_CO35-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"get-coordinates"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriverWait</code><code> </code><code class="n">wait</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">WebDriverWait</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">Duration</code><code class="o">.</code><code class="na">ofSeconds</code><code class="o">(</code><code class="mi">5</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">WebElement</code><code> </code><code class="n">coordinates</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"coordinates"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">wait</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code class="n">ExpectedConditions</code><code class="o">.</code><code class="na">visibilityOf</code><code class="o">(</code><code class="n">coordinates</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO35-1" id="callout_browser_specific_manipulation_CO35-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We override the geographical location using the coordinates of the Eiffel Tower (Paris, France).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO35-2" id="callout_browser_specific_manipulation_CO35-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We open a practice web page that accesses the device location and displays the coordinates to the user.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Manage cookies" data-type="sect3"><div class="sect3" id="idm45849714633168">&#13;
<h3>Manage cookies</h3>&#13;
&#13;
<p>CDP also allows <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="cookie management with" data-type="indexterm" id="idm45849714631872"/><a data-primary="cookies, management of" data-type="indexterm" id="idm45849714630896"/>managing web cookies. <a data-type="xref" href="#cdp_cookies">Example 5-43</a> shows a test reading the cookies of a practice page that manages some cookies.</p>&#13;
<div data-type="example" id="cdp_cookies">&#13;
<h5><span class="label">Example 5-43. </span>Test managing cookies</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testManageCookies</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">enable</code><code class="o">(</code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">Optional</code><code class="o">.</code><code class="na">empty</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/cookies.html"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1">// Read cookies&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">Cookie</code><code class="o">&gt;</code><code> </code><code class="n">cookies</code><code> </code><code class="o">=</code><code> </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">getAllCookies</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO36-1" id="co_browser_specific_manipulation_CO36-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">cookies</code><code class="o">.</code><code class="na">forEach</code><code class="o">(</code><code class="n">cookie</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"{}={}"</code><code class="o">,</code><code> </code><code class="n">cookie</code><code class="o">.</code><code class="na">getName</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>            </code><code class="n">cookie</code><code class="o">.</code><code class="na">getValue</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">cookieName</code><code> </code><code class="o">=</code><code> </code><code class="n">cookies</code><code class="o">.</code><code class="na">stream</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">map</code><code class="o">(</code><code class="n">cookie</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">cookie</code><code class="o">.</code><code class="na">getName</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sorted</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toList</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Set</code><code class="o">&lt;</code><code class="n">org</code><code class="o">.</code><code class="na">openqa</code><code class="o">.</code><code class="na">selenium</code><code class="o">.</code><code class="na">Cookie</code><code class="o">&gt;</code><code> </code><code class="n">seleniumCookie</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">manage</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">getCookies</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">selCookieName</code><code> </code><code class="o">=</code><code> </code><code class="n">seleniumCookie</code><code class="o">.</code><code class="na">stream</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">map</code><code class="o">(</code><code class="n">selCookie</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">selCookie</code><code class="o">.</code><code class="na">getName</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sorted</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">collect</code><code class="o">(</code><code class="n">Collectors</code><code class="o">.</code><code class="na">toList</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">cookieName</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">selCookieName</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO36-2" id="co_browser_specific_manipulation_CO36-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="c1">// Clear cookies&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">clearBrowserCookies</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO36-3" id="co_browser_specific_manipulation_CO36-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">Cookie</code><code class="o">&gt;</code><code> </code><code class="n">cookiesAfterClearing</code><code> </code><code class="o">=</code><code> </code><code class="n">devTools</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Network</code><code class="o">.</code><code class="na">getAllCookies</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">cookiesAfterClearing</code><code class="o">)</code><code class="o">.</code><code class="na">isEmpty</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO36-4" id="co_browser_specific_manipulation_CO36-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"refresh-cookies"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO36-1" id="callout_browser_specific_manipulation_CO36-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We read all the cookies of a web page.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO36-2" id="callout_browser_specific_manipulation_CO36-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We verify that the cookies read using the CDP command and the cookies read with the Selenium WebDriver<a data-primary="getCookies() method" data-type="indexterm" id="idm45849714567424"/> API (using <code>getCookies();</code>) are the same.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO36-3" id="callout_browser_specific_manipulation_CO36-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We remove all cookies.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO36-4" id="callout_browser_specific_manipulation_CO36-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We verify there are no cookies at this point.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Load insecure pages" data-type="sect3"><div class="sect3" id="idm45849714559696">&#13;
<h3>Load insecure pages</h3>&#13;
&#13;
<p>CDP also allows you to <a data-primary="Chrome DevTools Protocol (CDP)" data-secondary="loading insecure pages with" data-type="indexterm" id="idm45849714249984"/><a data-primary="loading insecure pages" data-type="indexterm" id="idm45849714249040"/><a data-primary="insecure pages, loading" data-type="indexterm" id="idm45849714248368"/><a data-primary="HTTPS" data-type="indexterm" id="idm45849714247696"/>load unsafe web pages (i.e., web pages that use HTTPS, but whose certificate is not valid). <a data-type="xref" href="#cdp_insecure">Example 5-44</a> illustrates this feature.</p>&#13;
<div data-type="example" id="cdp_insecure">&#13;
<h5><span class="label">Example 5-44. </span>Test loading an insecure web page</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testLoadInsecure</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Security</code><code class="o">.</code><code class="na">enable</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO37-1" id="co_browser_specific_manipulation_CO37-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">devTools</code><code class="o">.</code><code class="na">send</code><code class="o">(</code><code class="n">Security</code><code class="o">.</code><code class="na">setIgnoreCertificateErrors</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO37-2" id="co_browser_specific_manipulation_CO37-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://expired.badssl.com/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">bgColor</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"body"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">getCssValue</code><code class="o">(</code><code class="s">"background-color"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Color</code><code> </code><code class="n">red</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Color</code><code class="o">(</code><code class="mi">255</code><code class="o">,</code><code> </code><code class="mi">0</code><code class="o">,</code><code> </code><code class="mi">0</code><code class="o">,</code><code> </code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">Color</code><code class="o">.</code><code class="na">fromString</code><code class="o">(</code><code class="n">bgColor</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="n">red</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO37-3" id="co_browser_specific_manipulation_CO37-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO37-1" id="callout_browser_specific_manipulation_CO37-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We enable tracking security.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO37-2" id="callout_browser_specific_manipulation_CO37-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We ignore <a data-primary="certificate checks, disabling" data-type="indexterm" id="idm45849714167280"/><a data-primary="security checks, disabling" data-type="indexterm" id="idm45849714166576"/>certificate errors.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO37-3" id="callout_browser_specific_manipulation_CO37-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We verify the page is correctly <a data-startref="ch5_term72" data-type="indexterm" id="idm45849714163424"/>loaded.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Location Context" data-type="sect1"><div class="sect1" id="location-context">&#13;
<h1>Location Context</h1>&#13;
&#13;
<p>The Selenium WebDriver API <a data-primary="browsers, noninteroperable features of" data-secondary="location context" data-type="indexterm" id="idm45849714112160"/><a data-primary="Chrome" data-secondary="geolocation access in" data-type="indexterm" id="idm45849714110896"/><a data-primary="ChromeDriver" data-type="indexterm" id="idm45849714110048"/><a data-primary="Edge" data-secondary="geolocation access in" data-type="indexterm" id="idm45849714109440"/><a data-primary="EdgeDriver" data-type="indexterm" id="idm45849714108592"/><a data-primary="geolocation" data-secondary="custom coordinates of" data-type="indexterm" id="idm45849714107984"/><a data-primary="location context" data-type="indexterm" id="idm45849714107136"/><a data-primary="Opera" data-type="indexterm" id="idm45849714106528"/><a data-primary="OperaDriver" data-type="indexterm" id="idm45849714105920"/><a data-primary="setLocation() method" data-type="indexterm" id="idm45849714105312"/>provides the interface <code>LocationContext</code> for mocking the geolocation coordinates of the user device. This interface is implemented by <span class="keep-together"><code>ChromeDriver</code></span>, <code>EdgeDriver</code>, and <code>OperaDriver</code>. Therefore, these drivers can invoke the method <code>setLocation()</code> to specify custom coordinates (latitude, longitude, and altitude). <a data-type="xref" href="#location_context">Example 5-45</a> shows a basic test using this feature.</p>&#13;
<div data-type="example" id="location_context">&#13;
<h5><span class="label">Example 5-45. </span>Test setting custom geolocation coordinates through LocationContext</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testLocationContext</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">LocationContext</code><code> </code><code class="n">location</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">LocationContext</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO38-1" id="co_browser_specific_manipulation_CO38-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">location</code><code class="o">.</code><code class="na">setLocation</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">Location</code><code class="o">(</code><code class="mf">27.5916</code><code class="o">,</code><code> </code><code class="mf">86.5640</code><code class="o">,</code><code> </code><code class="mi">8850</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO38-2" id="co_browser_specific_manipulation_CO38-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/geolocation.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO38-3" id="co_browser_specific_manipulation_CO38-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"get-coordinates"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebDriverWait</code><code> </code><code class="n">wait</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">WebDriverWait</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">Duration</code><code class="o">.</code><code class="na">ofSeconds</code><code class="o">(</code><code class="mi">5</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">WebElement</code><code> </code><code class="n">coordinates</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"coordinates"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">wait</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code class="n">ExpectedConditions</code><code class="o">.</code><code class="na">visibilityOf</code><code class="o">(</code><code class="n">coordinates</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO38-4" id="co_browser_specific_manipulation_CO38-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO38-1" id="callout_browser_specific_manipulation_CO38-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We cast the driver object to <code>LocationContext</code> (only possible for Chrome, Edge, or Opera).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO38-2" id="callout_browser_specific_manipulation_CO38-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We open a practice page where the geolocation coordinates are displayed to the end user.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO38-3" id="callout_browser_specific_manipulation_CO38-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We set a custom location, in this case, the coordinates of Mount Everest (on the Nepal-China border).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO38-4" id="callout_browser_specific_manipulation_CO38-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We assert the coordinates are visible on the page.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Web Authentication" data-type="sect1"><div class="sect1" id="idm45849713990000">&#13;
<h1>Web Authentication</h1>&#13;
&#13;
<p>The Web Authentication <a data-primary="authentication, approaches to" data-type="indexterm" id="ch5_term79"/><a data-primary="browsers, noninteroperable features of" data-secondary="web authentication" data-type="indexterm" id="ch5_term80"/><a data-primary="credentials, authentication" data-type="indexterm" id="ch5_term81"/><a data-primary="public-key cryptography" data-type="indexterm" id="ch5_term84"/><a data-primary="W3C specifications" data-secondary="Web Authentication API (WebAuthn) and" data-type="indexterm" id="ch5_term86"/><a data-primary="Web Authentication API (WebAuthn)" data-type="indexterm" id="ch5_term87"/>API (also known as <em>WebAuthn</em>) is a <a href="https://www.w3.org/TR/webauthn-2">W3C specification</a> that allows servers to register and authenticate users using public key cryptography instead of passwords. Major browsers (Chrome, Firefox, Edge, and Safari) have supported WebAuthn since January 2019. These browsers allow credential creation and assertion using U2F (Universal 2nd Factor) tokens, which are Universal Serial Bus (USB) or Near-Field Communication (NFC) secure devices.</p>&#13;
&#13;
<p>In the classic web authentication approach, users <a data-primary="username and password" data-type="indexterm" id="idm45849713926704"/>send their username and password to the server using a web form. In WebAuthn, the web server uses the Web Authentication API to <a data-primary="private-public key pair (credential)" data-type="indexterm" id="ch5_term83"/>prompt the user to create a private-public key pair (known as a <span class="keep-together"><em>credential</em></span>). The private key is stored securely on the user’s device, and the public key is sent to the server. Then, the server can use that public key to validate user identity.</p>&#13;
&#13;
<p>As of version 4, <a data-primary="Selenium WebDriver 4 (version)" data-secondary="authentication in" data-type="indexterm" id="idm45849713923632"/>Selenium WebDriver supports <em>WebAuthn</em> out of the box. To that aim, the Selenium WebDriver API <a data-primary="HasVirtualAuthenticator interface" data-type="indexterm" id="ch5_term82"/><a data-primary="virtual authenticators" data-type="indexterm" id="ch5_term85"/>provides the interface <code>HasVirtualAuthenticator</code>. Instead of using secure physical devices, this interface allows us to use virtual authenticators. Although the <code>RemoteWebDriver</code> class implements this interface, at the time of this writing, this <a data-primary="Chromium" data-secondary="web authentication with" data-type="indexterm" id="idm45849713919552"/><a data-primary="Edge" data-secondary="as Chromium-based browser" data-secondary-sortas="Chromium-based browser" data-type="indexterm" id="idm45849713918704"/>mechanism is supported only in Chromium-based browsers, i.e., Chrome and Edge. <a data-type="xref" href="#webauthn_test">Example 5-46</a> shows a test using the Web Authentication API.</p>&#13;
<div data-type="example" id="webauthn_test">&#13;
<h5><span class="label">Example 5-46. </span>Test using WebAuthn</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testWebAuthn</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://webauthn.io/"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO39-1" id="co_browser_specific_manipulation_CO39-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">HasVirtualAuthenticator</code><code> </code><code class="n">virtualAuth</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">HasVirtualAuthenticator</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO39-2" id="co_browser_specific_manipulation_CO39-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>    </code><code class="n">VirtualAuthenticator</code><code> </code><code class="n">authenticator</code><code> </code><code class="o">=</code><code> </code><code class="n">virtualAuth</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">addVirtualAuthenticator</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">VirtualAuthenticatorOptions</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO39-3" id="co_browser_specific_manipulation_CO39-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">randomId</code><code> </code><code class="o">=</code><code> </code><code class="n">UUID</code><code class="o">.</code><code class="na">randomUUID</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"input-email"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">sendKeys</code><code class="o">(</code><code class="n">randomId</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO39-4" id="co_browser_specific_manipulation_CO39-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">WebDriverWait</code><code> </code><code class="n">wait</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">WebDriverWait</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">Duration</code><code class="o">.</code><code class="na">ofSeconds</code><code class="o">(</code><code class="mi">20</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"register-button"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO39-5" id="co_browser_specific_manipulation_CO39-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>    </code><code class="n">wait</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code class="n">ExpectedConditions</code><code class="o">.</code><code class="na">textToBePresentInElementLocated</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="n">By</code><code class="o">.</code><code class="na">className</code><code class="o">(</code><code class="s">"popover-body"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="s">"Success! Now try logging in"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">id</code><code class="o">(</code><code class="s">"login-button"</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">click</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO39-6" id="co_browser_specific_manipulation_CO39-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code>    </code><code class="n">wait</code><code class="o">.</code><code class="na">until</code><code class="o">(</code><code class="n">ExpectedConditions</code><code class="o">.</code><code class="na">textToBePresentInElementLocated</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="n">By</code><code class="o">.</code><code class="na">className</code><code class="o">(</code><code class="s">"main-content"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="s">"You're logged in!"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO39-7" id="co_browser_specific_manipulation_CO39-7"><img alt="7" src="assets/7.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">virtualAuth</code><code class="o">.</code><code class="na">removeVirtualAuthenticator</code><code class="o">(</code><code class="n">authenticator</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO39-8" id="co_browser_specific_manipulation_CO39-8"><img alt="8" src="assets/8.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO39-1" id="callout_browser_specific_manipulation_CO39-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We open a website protected with the Web Authentication API.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO39-2" id="callout_browser_specific_manipulation_CO39-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We cast the driver object to <code>HasVirtualAuthenticator</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO39-3" id="callout_browser_specific_manipulation_CO39-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We create and register a new virtual authenticator.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO39-4" id="callout_browser_specific_manipulation_CO39-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We send a random identifier in the web form.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO39-5" id="callout_browser_specific_manipulation_CO39-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We submit that identifier and wait until it is received.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO39-6" id="callout_browser_specific_manipulation_CO39-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We click the button to log in.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO39-7" id="callout_browser_specific_manipulation_CO39-7"><img alt="7" src="assets/7.png"/></a></dt>&#13;
<dd><p>We verify the authentication has been correctly performed.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO39-8" id="callout_browser_specific_manipulation_CO39-8"><img alt="8" src="assets/8.png"/></a></dt>&#13;
<dd><p>We remove the virtual <a data-startref="ch5_term79" data-type="indexterm" id="idm45849713647920"/><a data-startref="ch5_term80" data-type="indexterm" id="idm45849713647184"/><a data-startref="ch5_term81" data-type="indexterm" id="idm45849713646512"/><a data-startref="ch5_term83" data-type="indexterm" id="idm45849713645840"/><a data-startref="ch5_term84" data-type="indexterm" id="idm45849713645168"/><a data-startref="ch5_term86" data-type="indexterm" id="idm45849713644496"/><a data-startref="ch5_term87" data-type="indexterm" id="idm45849713643824"/>authenticator.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Print Page" data-type="sect1"><div class="sect1" id="print-pdf">&#13;
<h1>Print Page</h1>&#13;
&#13;
<p>Selenium WebDriver allows <a data-primary="browsers, noninteroperable features of" data-secondary="printing web pages" data-type="indexterm" id="idm45849713641120"/><a data-primary="PDF documents, printing web pages to" data-type="indexterm" id="idm45849713640176"/><a data-primary="printing web pages" data-type="indexterm" id="idm45849713639536"/><a data-primary="PrintsPage interface" data-type="indexterm" id="idm45849713638864"/>printing web pages to PDF documents. To do that, the Selenium WebDriver API provides the interface <code>PrintsPage</code>. This interface is inherited by the class <code>RemoteWebDriver</code>, and therefore, it is available for all browsers supported by Selenium WebDriver. Nevertheless, there are <a data-primary="Chrome" data-secondary="printing pages in" data-type="indexterm" id="idm45849713637024"/><a data-primary="Edge" data-secondary="printing pages in" data-type="indexterm" id="idm45849713636048"/><a data-primary="Firefox" data-secondary="printing pages in" data-type="indexterm" id="idm45849713635104"/>slight differences when using one or another browser. For instance, printing pages is possible when using Chrome and Edge only if the browser is started in headless mode. For Firefox, this restriction is not required, and we can use Firefox as usual. <a data-type="xref" href="#print_page">Example 5-47</a> shows the test logic for printing a web page to PDF. You can find the complete tests for Firefox and headless Chrome/Edge in the <a href="https://github.com/bonigarcia/selenium-webdriver-java">examples repository</a>.</p>&#13;
<div data-type="example" id="print_page">&#13;
<h5><span class="label">Example 5-47. </span>Test printing a web page to PDF</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testPrint</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">IOException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">PrintsPage</code><code> </code><code class="n">pg</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">PrintsPage</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO40-1" id="co_browser_specific_manipulation_CO40-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">PrintOptions</code><code> </code><code class="n">printOptions</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">PrintOptions</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Pdf</code><code> </code><code class="n">pdf</code><code> </code><code class="o">=</code><code> </code><code class="n">pg</code><code class="o">.</code><code class="na">print</code><code class="o">(</code><code class="n">printOptions</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO40-2" id="co_browser_specific_manipulation_CO40-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">pdfBase64</code><code> </code><code class="o">=</code><code> </code><code class="n">pdf</code><code class="o">.</code><code class="na">getContent</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO40-3" id="co_browser_specific_manipulation_CO40-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">pdfBase64</code><code class="o">)</code><code class="o">.</code><code class="na">contains</code><code class="o">(</code><code class="s">"JVBER"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO40-4" id="co_browser_specific_manipulation_CO40-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="kt">byte</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">decodedImg</code><code> </code><code class="o">=</code><code> </code><code class="n">Base64</code><code class="o">.</code><code class="na">getDecoder</code><code class="o">(</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">decode</code><code class="o">(</code><code class="n">pdfBase64</code><code class="o">.</code><code class="na">getBytes</code><code class="o">(</code><code class="n">StandardCharsets</code><code class="o">.</code><code class="na">UTF_8</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO40-5" id="co_browser_specific_manipulation_CO40-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code>    </code><code class="n">Path</code><code> </code><code class="n">destinationFile</code><code> </code><code class="o">=</code><code> </code><code class="n">Paths</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"my-pdf.pdf"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">Files</code><code class="o">.</code><code class="na">write</code><code class="o">(</code><code class="n">destinationFile</code><code class="o">,</code><code> </code><code class="n">decodedImg</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO40-6" id="co_browser_specific_manipulation_CO40-6"><img alt="6" src="assets/6.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO40-1" id="callout_browser_specific_manipulation_CO40-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We cast the driver object to <code>PrintsPage</code>.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO40-2" id="callout_browser_specific_manipulation_CO40-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We print the current web page to PDF using the default configuration.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO40-3" id="callout_browser_specific_manipulation_CO40-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We get the content of the PDF <a data-primary="Base64" data-type="indexterm" id="idm45849713502048"/>in Base64.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO40-4" id="callout_browser_specific_manipulation_CO40-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We verify this content contains the file signature (the “magic word” <code>JVBER</code>).</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO40-5" id="callout_browser_specific_manipulation_CO40-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We convert the Base64 to a raw byte array.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO40-6" id="callout_browser_specific_manipulation_CO40-6"><img alt="6" src="assets/6.png"/></a></dt>&#13;
<dd><p>We write the PDF content (byte array) to a local file.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="WebDriver BiDi" data-type="sect1"><div class="sect1" id="web-bidi">&#13;
<h1>WebDriver BiDi</h1>&#13;
&#13;
<p>The <a href="https://w3c.github.io/webdriver-bidi">WebDriver BiDi</a> is a W3C draft that defines the <a data-primary="BiDi, WebDriver" data-type="indexterm" id="ch5_term90"/><a data-primary="bidirectional communication" data-type="indexterm" id="ch5_term91"/><a data-primary="browsers, noninteroperable features of" data-secondary="bidirectional communication (BiDi)" data-type="indexterm" id="ch5_term92"/><a data-primary="communication, bidirectional" data-type="indexterm" id="ch5_term93"/><a data-primary="W3C specifications" data-secondary="WebDriver BiDi and" data-type="indexterm" id="ch5_term97"/><a data-primary="WebDriver BiDi" data-type="indexterm" id="ch5_term98"/>bidirectional WebDriver protocol. Instead of the strict command/response format of the WebDriver protocol, BiDi introduces a WebSocket connection between driver and browser to enable bidirectional communication. This way, WebDriver BiDi will allow different operations using a fast bidirectional transport (i.e., without polling the browser to get responses).</p>&#13;
&#13;
<p>In Selenium WebDriver, the aim is that BiDi will be a standardized replacement in the long run for advanced operations currently supported by CDP. For example, the <a data-primary="event listeners" data-type="indexterm" id="ch5_term94"/><a data-primary="HasLogEvents interface" data-type="indexterm" id="ch5_term95"/><a data-primary="listeners" data-secondary="in WebDriver BiDi" data-secondary-sortas="WebDriver BiDi" data-type="indexterm" id="ch5_term96"/>Selenium WebDriver API supports implementing event listeners through the <code>HasLog​E⁠vents</code> interface. This interface works on top of CDP at the time of this writing. Nevertheless, it will use BiDi internally in future Selenium WebDriver releases, providing more robust cross-browser compatibility. <code>HasLogEvents</code> allows implementing listeners for the following events:</p>&#13;
<dl>&#13;
<dt><code>domMutation</code></dt>&#13;
<dd>&#13;
<p>To capture <a data-primary="DOM (Document Object Model)" data-secondary="listener for event changes in" data-type="indexterm" id="ch5_term88"/><a data-primary="domMutation events" data-type="indexterm" id="ch5_term89"/>events about changes in the DOM. <a data-type="xref" href="#webdriver_bidi_1">Example 5-48</a> shows a test implementing a listener for these events.</p>&#13;
</dd>&#13;
<dt><code>consoleEvent</code></dt>&#13;
<dd>&#13;
<p>To capture <a data-primary="consoleEvent events" data-type="indexterm" id="idm45849713417008"/><a data-primary="console listeners" data-type="indexterm" id="idm45849713416272"/>events about changes in the browser console, such as JavaScript traces. <a data-type="xref" href="#webdriver_bidi_2">Example 5-49</a> shows a second test implementing this type of listener.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="example" id="webdriver_bidi_1">&#13;
<h5><span class="label">Example 5-48. </span>Test implementing a listener for DOM mutation events</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testDomMutation</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">InterruptedException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/"</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">HasLogEvents</code><code> </code><code class="n">logger</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">HasLogEvents</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO41-1" id="co_browser_specific_manipulation_CO41-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>    </code><code class="n">JavascriptExecutor</code><code> </code><code class="n">js</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">JavascriptExecutor</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">AtomicReference</code><code class="o">&lt;</code><code class="n">DomMutationEvent</code><code class="o">&gt;</code><code> </code><code class="n">seen</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">AtomicReference</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">CountDownLatch</code><code> </code><code class="n">latch</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">CountDownLatch</code><code class="o">(</code><code class="mi">1</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">logger</code><code class="o">.</code><code class="na">onLogEvent</code><code class="o">(</code><code class="n">CdpEventTypes</code><code class="o">.</code><code class="na">domMutation</code><code class="o">(</code><code class="n">mutation</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">seen</code><code class="o">.</code><code class="na">set</code><code class="o">(</code><code class="n">mutation</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">latch</code><code class="o">.</code><code class="na">countDown</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO41-2" id="co_browser_specific_manipulation_CO41-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">WebElement</code><code> </code><code class="n">img</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">.</code><code class="na">findElement</code><code class="o">(</code><code class="n">By</code><code class="o">.</code><code class="na">tagName</code><code class="o">(</code><code class="s">"img"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">newSrc</code><code> </code><code class="o">=</code><code> </code><code class="s">"img/award.png"</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">String</code><code> </code><code class="n">script</code><code> </code><code class="o">=</code><code> </code><code class="n">String</code><code class="o">.</code><code class="na">format</code><code class="o">(</code><code class="s">"arguments[0].src = '%s';"</code><code class="o">,</code><code> </code><code class="n">newSrc</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">js</code><code class="o">.</code><code class="na">executeScript</code><code class="o">(</code><code class="n">script</code><code class="o">,</code><code> </code><code class="n">img</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO41-3" id="co_browser_specific_manipulation_CO41-3"><img alt="3" src="assets/3.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">latch</code><code class="o">.</code><code class="na">await</code><code class="o">(</code><code class="mi">10</code><code class="o">,</code><code> </code><code class="n">TimeUnit</code><code class="o">.</code><code class="na">SECONDS</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isTrue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO41-4" id="co_browser_specific_manipulation_CO41-4"><img alt="4" src="assets/4.png"/></a><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">seen</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getElement</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getAttribute</code><code class="o">(</code><code class="s">"src"</code><code class="o">)</code><code class="o">)</code><code>&#13;
</code><code>            </code><code class="o">.</code><code class="na">endsWith</code><code class="o">(</code><code class="n">newSrc</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO41-5" id="co_browser_specific_manipulation_CO41-5"><img alt="5" src="assets/5.png"/></a><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO41-1" id="callout_browser_specific_manipulation_CO41-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We cast the driver object to <code>HasLogEvents</code>. This <a data-primary="Chrome" data-secondary="event listeners with" data-type="indexterm" id="idm45849713182544"/><a data-primary="Edge" data-secondary="event listeners with" data-type="indexterm" id="idm45849713181536"/>cast is only possible for Chrome and Edge.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO41-2" id="callout_browser_specific_manipulation_CO41-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We create a listener for DOM mutation events. This test expects to capture only one event, synchronized using a countdown latch.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO41-3" id="callout_browser_specific_manipulation_CO41-3"><img alt="3" src="assets/3.png"/></a></dt>&#13;
<dd><p>We force a DOM mutation by executing JavaScript to change an image source.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO41-4" id="callout_browser_specific_manipulation_CO41-4"><img alt="4" src="assets/4.png"/></a></dt>&#13;
<dd><p>We verify the event occurs at most in 10 seconds.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO41-5" id="callout_browser_specific_manipulation_CO41-5"><img alt="5" src="assets/5.png"/></a></dt>&#13;
<dd><p>We check the image source has <a data-startref="ch5_term88" data-type="indexterm" id="idm45849713142000"/><a data-startref="ch5_term89" data-type="indexterm" id="idm45849713141392"/><a data-primary="consoleEvent events" data-type="indexterm" id="idm45849713140784"/><a data-primary="console listeners" data-type="indexterm" id="idm45849713140176"/>changed.</p></dd>&#13;
</dl>&#13;
<div data-type="example" id="webdriver_bidi_2">&#13;
<h5><span class="label">Example 5-49. </span>Test implementing a listener for console events</h5>&#13;
&#13;
<pre data-code-language="java" data-type="programlisting"><code class="nd">@Test</code><code>&#13;
</code><code class="kt">void</code><code> </code><code class="nf">testConsoleEvents</code><code class="o">(</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">InterruptedException</code><code> </code><code class="o">{</code><code>&#13;
</code><code>    </code><code class="n">HasLogEvents</code><code> </code><code class="n">logger</code><code> </code><code class="o">=</code><code> </code><code class="o">(</code><code class="n">HasLogEvents</code><code class="o">)</code><code> </code><code class="n">driver</code><code class="o">;</code><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">CountDownLatch</code><code> </code><code class="n">latch</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">CountDownLatch</code><code class="o">(</code><code class="mi">4</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="n">logger</code><code class="o">.</code><code class="na">onLogEvent</code><code class="o">(</code><code class="n">CdpEventTypes</code><code class="o">.</code><code class="na">consoleEvent</code><code class="o">(</code><code class="n">consoleEvent</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code>&#13;
</code><code>        </code><code class="n">log</code><code class="o">.</code><code class="na">debug</code><code class="o">(</code><code class="s">"{} {}: {}"</code><code class="o">,</code><code> </code><code class="n">consoleEvent</code><code class="o">.</code><code class="na">getTimestamp</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code>&#13;
</code><code>                </code><code class="n">consoleEvent</code><code class="o">.</code><code class="na">getType</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">consoleEvent</code><code class="o">.</code><code class="na">getMessages</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>        </code><code class="n">latch</code><code class="o">.</code><code class="na">countDown</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code>    </code><code class="o">}</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO42-1" id="co_browser_specific_manipulation_CO42-1"><img alt="1" src="assets/1.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code>&#13;
</code><code>            </code><code class="s">"https://bonigarcia.dev/selenium-webdriver-java/console-logs.html"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="#callout_browser_specific_manipulation_CO42-2" id="co_browser_specific_manipulation_CO42-2"><img alt="2" src="assets/2.png"/></a><code>&#13;
</code><code>&#13;
</code><code>    </code><code class="n">assertThat</code><code class="o">(</code><code class="n">latch</code><code class="o">.</code><code class="na">await</code><code class="o">(</code><code class="mi">10</code><code class="o">,</code><code> </code><code class="n">TimeUnit</code><code class="o">.</code><code class="na">SECONDS</code><code class="o">)</code><code class="o">)</code><code class="o">.</code><code class="na">isTrue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>&#13;
</code><code class="o">}</code></pre></div>&#13;
<dl class="calloutlist">&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO42-1" id="callout_browser_specific_manipulation_CO42-1"><img alt="1" src="assets/1.png"/></a></dt>&#13;
<dd><p>We create a listener for console events. This test expects to capture four events synchronized using a countdown latch.</p></dd>&#13;
<dt><a class="co" href="#co_browser_specific_manipulation_CO42-2" id="callout_browser_specific_manipulation_CO42-2"><img alt="2" src="assets/2.png"/></a></dt>&#13;
<dd><p>We open the practice web page, which logs several messages in the JavaScript <a data-startref="ch5_term90" data-type="indexterm" id="idm45849713027856"/><a data-startref="ch5_term91" data-type="indexterm" id="idm45849713027152"/><a data-startref="ch5_term92" data-type="indexterm" id="idm45849713026480"/><a data-startref="ch5_term93" data-type="indexterm" id="idm45849713025808"/><a data-startref="ch5_term94" data-type="indexterm" id="idm45849713025136"/><a data-startref="ch5_term95" data-type="indexterm" id="idm45849713024464"/><a data-startref="ch5_term96" data-type="indexterm" id="idm45849713023792"/><a data-startref="ch5_term97" data-type="indexterm" id="idm45849713023120"/><a data-startref="ch5_term98" data-type="indexterm" id="idm45849713022448"/>console.</p></dd>&#13;
</dl>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="pagebreak-before less_space" data-pdf-bookmark="Summary and Outlook" data-type="sect1"><div class="sect1" id="idm45849712972944">&#13;
<h1>Summary and Outlook</h1>&#13;
&#13;
<p>This chapter presented a <a data-primary="browsers, noninteroperable features of" data-secondary="summary of" data-type="indexterm" id="idm45849712971568"/>practical overview of the Selenium WebDriver API features that are not interoperable among browsers. First, you discovered how to use capabilities to run browsers in headless mode, change the page loading strategy, use web extensions, or manage browser pop-ups (e.g., geolocation, notifications, or getting user media), among other capabilities. Then, you learned that Selenium WebDriver provides different ways to interact with web browsers using the CDP. This mechanism allows incorporating a lot of powerful features in our Selenium WebDriver tests, such as emulating network conditions, basic and digest authentication, network monitoring, handling HTTP headers, or blocking URLs, to name a few. Then, you discovered other browser-specific features, such as location context, web authentication (WebAuthn), and printing web pages to PDF documents. Finally, you learned about WebDriver BiDi, a draft standardization that defines bidirectional communication with browsers for automation purposes. BiDi is in an early stage at the time of this writing. The aim is that Selenium WebDriver will support different standard features on top of BiDi in future releases.</p>&#13;
&#13;
<p>The next chapter concludes our journey with the Selenium WebDriver API. The chapter explains how to use this API to control remote browsers. These browsers can be hosted on Selenium Grid, a cloud provider (e.g., Sauce Labs, BrowserStack, or CrossBrowserTesting), or executed in Docker containers.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>