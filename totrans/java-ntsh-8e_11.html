<html><head></head><body>
<div id="sbo-rt-content"><section data-nutshell-tab="Common Data Formats" data-pdf-bookmark="Chapter 9. Handling Common Data Formats" data-type="chapter" epub:type="chapter"><div class="chapter" id="javanut8-CHP-9">
<h1><span class="label">Chapter 9. </span>Handling Common Data Formats</h1>
<p><a data-primary="data formats, handling of common" data-type="indexterm" id="ix_ch09-asciidoc0"/>Most of programming is handling data in various formats. In this
chapter, we will introduce Java’s support for handling two big classes
of data—text and numbers. The second half of the chapter will focus on
handling date and time information. This is of particular interest, as
Java 8 shipped a completely new API for handling date and time. We cover
this interface in some depth before finishing the chapter by
briefly discussing Java’s original date and time API.</p>
<p>Many applications are still using the legacy APIs, so developers need to
be aware of the old way of doing things, but the new APIs are so much
better that we recommend converting as soon as possible. Before we get
to those more complex formats, let’s get under way by talking about
textual data and strings.</p>
<section data-pdf-bookmark="Text" data-type="sect1"><div class="sect1" id="idm45927719587408">
<h1>Text</h1>
<p><a data-primary="data formats, handling of common" data-secondary="text" data-type="indexterm" id="ix_ch09-asciidoc1"/><a data-primary="strings" data-type="indexterm" id="ix_ch09-asciidoc2"/><a data-primary="text" data-type="indexterm" id="ix_ch09-asciidoc3"/><a data-primary="text" data-secondary="strings" data-seealso="strings" data-type="indexterm" id="ix_ch09-asciidoc4"/>We have already met Java’s strings on many occasions. They consist of
sequences of Unicode characters and are represented as instances of
the <code>String</code> class. Strings are one of the most common types of data
that Java programs process (a claim you can investigate for yourself by
using the <code>jmap</code> tool that we’ll meet in <a data-type="xref" href="ch13.xhtml#javanut8-CHP-13">Chapter 13</a>).</p>
<p>In this section, we’ll meet the <code>String</code> class in some more depth and
understand why it is in a rather unique position within the Java
language. Later in the section, we’ll introduce regular expressions, a
very common abstraction for searching text for patterns (and a classic
tool in the programmer’s arsenal, regardless of language).</p>
<section data-pdf-bookmark="Special Syntax for Strings" data-type="sect2"><div class="sect2" id="idm45927719578624">
<h2>Special Syntax for Strings</h2>
<p><a data-primary="String class" data-secondary="special syntax for" data-type="indexterm" id="ix_ch09-asciidoc5"/>The <code>String</code> class is handled in a somewhat special way by the Java
language. This is because, despite not being a primitive type, strings
are so common that it makes sense for Java to have a number of special
syntax features designed to make <span class="keep-together">handling</span> strings easy. Let’s look at
some examples of special syntax features for strings that Java provides.</p>
<section data-pdf-bookmark="String literals" data-type="sect3"><div class="sect3" id="idm45927719574560">
<h3>String literals</h3>
<p><a data-primary="string literals" data-type="indexterm" id="idm45927719573024"/><a data-primary="strings" data-secondary="literals" data-type="indexterm" id="idm45927719572320"/><a data-primary="strings" data-secondary="toString() method" data-type="indexterm" id="idm45927719571376"/><a data-primary="toString()" data-type="indexterm" id="idm45927719570432"/>As we saw in <a data-type="xref" href="ch02.xhtml#javanut8-CHP-2">Chapter 2</a>, Java allows a sequence
of characters to be placed in double quotes to create a literal string
object. Like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="w"> </code><code class="n">pet</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"Cat"</code><code class="p">;</code><code class="w"/></pre>
<p>Without this special syntax, we would have to write acres of horrible
code like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kt">char</code><code class="o">[]</code><code class="w"> </code><code class="n">pullingTeeth</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">{</code><code class="sc">'C'</code><code class="p">,</code><code class="w"> </code><code class="sc">'a'</code><code class="p">,</code><code class="w"> </code><code class="sc">'t'</code><code class="p">};</code><code class="w"/>
<code class="n">String</code><code class="w"> </code><code class="n">pet</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">String</code><code class="p">(</code><code class="n">pullingTeeth</code><code class="p">);</code><code class="w"/></pre>
<p>This would get tedious extremely quickly, so it’s no surprise that Java,
like all modern programming languages, provides a simple string literal
syntax. The string literals are perfectly sound objects, so code like
this is completely legal:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">"Dog"</code><code class="p">.</code><code class="na">length</code><code class="p">());</code><code class="w"/></pre>
<p><a data-primary="&quot;&quot;&quot; (quotes, double), enclosing text blocks" data-type="indexterm" id="idm45927719492624"/><a data-primary="text blocks" data-type="indexterm" id="idm45927719492016"/>Strings using basic double quotes cannot span multiple lines, but recent versions
of Java have included multiline text blocks with the <code>"""</code> syntax. The
resulting string objects are created at compile-time and are no different than a
<code>"</code> quoted string, just easier to express:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="w"> </code><code class="n">lyrics</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"""</code>
<code class="s">  This is the song that never ends</code>
<code class="s">  This song goes on and one my friend</code>
<code class="s">  ..."""</code><code class="p">;</code><code class="w"/></pre>
<p>See <a data-type="xref" href="ch02.xhtml#javanut8-CHP-2-SECT-7.5">“String literals”</a> for complete coverage of string literals in
Java.</p>
</div></section>
<section data-pdf-bookmark="toString()" data-type="sect3"><div class="sect3" id="idm45927719574064">
<h3>toString()</h3>
<p>This method is defined on <code>Object</code> and is designed to allow easy
conversion of any object to a string. <a data-primary="println()" data-type="indexterm" id="idm45927719437680"/><a data-primary="System.out.println()" data-type="indexterm" id="idm45927719436976"/>This makes it easy to print out
any object, by using the method <code>System.out.println()</code>. This method is
actually <code>PrintStream::println</code> because <code>System.out</code> is a static field
of type <code>PrintStream</code>. Let’s see how this method is defined:</p>
<pre data-code-language="java" data-type="programlisting"><code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="kt">void</code><code class="w"> </code><code class="nf">println</code><code class="p">(</code><code class="n">Object</code><code class="w"> </code><code class="n">x</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="n">String</code><code class="w"> </code><code class="n">s</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">String</code><code class="p">.</code><code class="na">valueOf</code><code class="p">(</code><code class="n">x</code><code class="p">);</code><code class="w"/>
<code class="w">        </code><code class="kd">synchronized</code><code class="w"> </code><code class="p">(</code><code class="k">this</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="n">print</code><code class="p">(</code><code class="n">s</code><code class="p">);</code><code class="w"/>
<code class="w">            </code><code class="n">newLine</code><code class="p">();</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/></pre>
<p>This creates a new string by using the static method
<code>String::valueOf()</code>:</p>
<pre data-code-language="java" data-type="programlisting"><code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="kd">static</code><code class="w"> </code><code class="n">String</code><code class="w"> </code><code class="nf">valueOf</code><code class="p">(</code><code class="n">Object</code><code class="w"> </code><code class="n">obj</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="p">(</code><code class="n">obj</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="kc">null</code><code class="p">)</code><code class="w"> </code><code class="o">?</code><code class="w"> </code><code class="s">"null"</code><code class="w"> </code><code class="p">:</code><code class="w"> </code><code class="n">obj</code><code class="p">.</code><code class="na">toString</code><code class="p">();</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The static <code>valueOf()</code> method is used instead of <code>toString()</code> directly,
to avoid a <code>NullPointerException</code> in the case where <code>obj</code> is <code>null</code>.</p>
</div>
<p>This construction means that <code>toString()</code> is always available for any
object, and this comes in very handy for another major
syntax feature that Java provides: string concatenation.</p>
</div></section>
<section data-pdf-bookmark="String concatenation" data-type="sect3"><div class="sect3" id="javanut8-CHP-9-string-concatenation">
<h3>String concatenation</h3>
<p><a data-primary="concatenation, of strings" data-type="indexterm" id="idm45927719258032"/><a data-primary="strings" data-secondary="concatenation" data-type="indexterm" id="idm45927719257168"/>Java allows us to create new strings by “adding” the characters from one string onto the end of another. <a data-primary="+ (plus sign)" data-secondary="string concatenation operator" data-type="indexterm" id="idm45927719255936"/><a data-primary="string concatenation operator (+)" data-type="indexterm" id="idm45927719255024"/>This is called <em>string concatenation</em> and uses the operator <code>+</code>.
<a data-primary="StringBuilder class" data-type="indexterm" id="idm45927719251568"/>In versions of Java up to and including Java 8, it works by first creating a “working area” in the form of a <code>StringBuilder</code> object that contains the same sequence of characters as the original string.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Java 9 introduced a new mechanism that uses the <code><span class="keep-together">invokedynamic</span></code> instruction instead of <code>StringBuilder</code> directly. This is an advanced piece of functionality and out of scope for this discussion, but it doesn’t change the behavior visible to the Java developer.</p>
</div>
<p>The builder object is then updated and the characters from the
additional string are added onto the end. Finally, <code>toString()</code> is
called on the <code>StringBuilder</code> object (which now contains the characters
from both strings). This gives us a new string with all the characters
in it. All of this code is created automatically by <code>javac</code> whenever we
use the <code>+</code> operator to concatenate strings.</p>
<p>The concatenation process returns a completely new <code>String</code> object, as
we can see in this example:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="w"> </code><code class="n">s1</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"AB"</code><code class="p">;</code><code class="w"/>
<code class="n">String</code><code class="w"> </code><code class="n">s2</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"CD"</code><code class="p">;</code><code class="w"/>

<code class="n">String</code><code class="w"> </code><code class="n">s3</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">s1</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">s1</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="n">s3</code><code class="p">);</code><code class="w"> </code><code class="c1">// Same object? Yes.</code><code class="w"/>

<code class="n">s3</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">s1</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">s2</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">s1</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="n">s3</code><code class="p">);</code><code class="w"> </code><code class="c1">// Still same? Nope!</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">s1</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">s3</code><code class="p">);</code><code class="w"/></pre>
<p>The concatenation example directly shows that the <code>+</code> operator is not
altering (or <em>mutating</em>) <code>s1</code> in place. This is an example of a more
general principle: Java’s strings are immutable. This means that once
the characters that make up the string have been chosen and the <code>String</code>
object has been created, the <code>String</code> cannot be changed. This is an
important language principle in Java, so let’s look at it in a little
more depth.<a data-startref="ix_ch09-asciidoc5" data-type="indexterm" id="idm45927719148672"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="String Immutability" data-type="sect2"><div class="sect2" id="idm45927719147968">
<h2>String Immutability</h2>
<p><a data-primary="immutability" data-secondary="string" data-type="indexterm" id="ix_ch09-asciidoc6"/><a data-primary="strings" data-secondary="immutability" data-type="indexterm" id="ix_ch09-asciidoc7"/>To “change” a string, as we saw when we discussed string
concatenation, we actually need to create an intermediate
<code>StringBuilder</code> object to act as a temporary scratch area, and then
call <code>toString()</code> on it, to bake it into a new instance of <code>String</code>.
Let’s see how this works in code:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="w"> </code><code class="n">pet</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"Cat"</code><code class="p">;</code><code class="w"/>
<code class="n">StringBuilder</code><code class="w"> </code><code class="n">sb</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">StringBuilder</code><code class="p">(</code><code class="n">pet</code><code class="p">);</code><code class="w"/>
<code class="n">sb</code><code class="p">.</code><code class="na">append</code><code class="p">(</code><code class="s">"amaran"</code><code class="p">);</code><code class="w"/>
<code class="n">String</code><code class="w"> </code><code class="n">boat</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">sb</code><code class="p">.</code><code class="na">toString</code><code class="p">();</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">boat</code><code class="p">);</code><code class="w"/></pre>
<p>Code like this behaves equivalently to the following, although in Java 9 and above the actual bytecode sequences will differ:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="w"> </code><code class="n">pet</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"Cat"</code><code class="p">;</code><code class="w"/>
<code class="n">String</code><code class="w"> </code><code class="n">boat</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">pet</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">"amaran"</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">boat</code><code class="p">);</code><code class="w"/></pre>
<p>Of course, as well as being used under the hood by <code>javac</code>, the
<code>StringBuilder</code> class can also be used directly in application code, as
we’ve seen.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p><a data-primary="StringBuffer class" data-type="indexterm" id="idm45927718992080"/>Along with <code>StringBuilder</code>, Java also has a <code>StringBuffer</code> class. This
comes from the oldest versions of Java and should not be used for new
development—use <code>StringBuilder</code> instead, unless you really need to share
the construction of a new string between multiple threads.</p>
</div>
<p>String immutability is an extremely useful language feature. For
example, suppose the <code>+</code> changed a string instead of creating a new one;
then, whenever any thread concatenated two strings, all other
threads would also see the change. This is unlikely to be a useful
behavior for most programs, and so immutability makes good sense.</p>
<section data-pdf-bookmark="Hash codes and effective immutability" data-type="sect3"><div class="sect3" id="idm45927718988656">
<h3>Hash codes and effective immutability</h3>
<p><a data-primary="hash codes" data-type="indexterm" id="idm45927718987248"/><a data-primary="hashCode()" data-secondary="and effective immutability" data-secondary-sortas="effective immutability" data-type="indexterm" id="idm45927718986320"/><a data-primary="hashCode()" data-secondary="String class" data-type="indexterm" id="idm45927718977344"/><a data-primary="immutability" data-secondary="hash codes and" data-type="indexterm" id="idm45927718976496"/><a data-primary="strings" data-secondary="hash codes and effective immutability" data-type="indexterm" id="idm45927718975648"/>We have already met the <code>hashCode()</code> method in
<a data-type="xref" href="ch05.xhtml#javanut8-CHP-5">Chapter 5</a>, where we described the contract that
the method must satisfy. Let’s take a look at the JDK source code and
see how the method <code>String::hashCode()</code> is defined:</p>
<pre data-code-language="java" data-type="programlisting"><code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="nf">hashCode</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="kt">int</code><code class="w"> </code><code class="n">h</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">hash</code><code class="p">;</code><code class="w"/>
<code class="w">        </code><code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="n">h</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="mi">0</code><code class="w"> </code><code class="o">&amp;&amp;</code><code class="w"> </code><code class="n">value</code><code class="p">.</code><code class="na">length</code><code class="w"> </code><code class="o">&gt;</code><code class="w"> </code><code class="mi">0</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="kt">char</code><code class="w"> </code><code class="n">val</code><code class="o">[]</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">value</code><code class="p">;</code><code class="w"/>

<code class="w">            </code><code class="k">for</code><code class="w"> </code><code class="p">(</code><code class="kt">int</code><code class="w"> </code><code class="n">i</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mi">0</code><code class="p">;</code><code class="w"> </code><code class="n">i</code><code class="w"> </code><code class="o">&lt;</code><code class="w"> </code><code class="n">value</code><code class="p">.</code><code class="na">length</code><code class="p">;</code><code class="w"> </code><code class="n">i</code><code class="o">++</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">                </code><code class="n">h</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mi">31</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="n">h</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">val</code><code class="o">[</code><code class="n">i</code><code class="o">]</code><code class="p">;</code><code class="w"/>
<code class="w">            </code><code class="p">}</code><code class="w"/>
<code class="w">            </code><code class="n">hash</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">h</code><code class="p">;</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">h</code><code class="p">;</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/></pre>
<p>The field <code>hash</code> holds the hash code of the string, and the field
<code>value</code> is a <code>char[]</code> that holds the characters that actually make up
the string. As we can see from the code, Java computes the hash by looping
over all the characters of the string. It therefore takes a number of
machine instructions proportional to the number of characters in the
string. For very large strings, this could take a bit of time. Rather
than precompute the hash value, Java calculates it only when it is
needed.</p>
<p>When the method runs, the hash is computed by stepping through the array
of characters. At the end of the array, we exit the <code>for</code> loop and write
the computed hash back into the field <code>hash</code>. Now, when this method is
called again, the value has already been computed, so we can just
use the cached value and subsequent calls to <code>hashCode()</code> return
immediately.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="benign data race" data-type="indexterm" id="idm45927718805696"/>The computation of a string’s hash code is an example of a <em>benign data
race</em>. In a program with multiple threads, they could race to compute
the hash code. However, they would all eventually arrive at exactly the
same answer—hence the term <em>benign</em>.</p>
</div>
<p>All of the fields of the <code>String</code> class are final, except for <code>hash</code>. So
Java’s strings are not, strictly speaking, immutable. However, because
the <code>hash</code> field is just a cache of a value that is deterministically
computed from the other fields, which are all immutable then, provided
<code>String</code> has been coded correctly, it will behave as if it were
immutable. <a data-primary="effectively immutable classes" data-type="indexterm" id="idm45927718801472"/>Classes that have this property are called <em>effectively
immutable</em>—they are quite rare in practice, and working programmers
can usually ignore the distinction between truly immutable and
effectively immutable data.<a data-startref="ix_ch09-asciidoc7" data-type="indexterm" id="idm45927718800288"/><a data-startref="ix_ch09-asciidoc6" data-type="indexterm" id="idm45927718799584"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="String Formatting" data-type="sect2"><div class="sect2" id="idm45927718798912">
<h2>String Formatting</h2>
<p><a data-primary="strings" data-secondary="formatting" data-type="indexterm" id="idm45927718797600"/>In <a data-type="xref" href="#javanut8-CHP-9-string-concatenation">“String concatenation”</a>, we saw how Java supports building
strings from smaller strings by joining them. While this works, it can
often be tedious and error prone when constructing more elaborate output
strings. Java provides a number of other methods and classes for doing richer
string formatting.</p>
<p>The static method <code>format</code> on the <code>String</code> class allows us to specify a
template and then dynamically plug in various values:</p>
<pre data-code-language="java" data-type="programlisting"><code class="c1">// Result is the string "The 1 pet is a cat: true?"</code><code class="w"/>
<code class="kd">var</code><code class="w"> </code><code class="n">s</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">String</code><code class="p">.</code><code class="na">format</code><code class="p">(</code><code class="s">"The %d pet is a %s: %b?%n"</code><code class="p">,</code><code class="w"> </code><code class="mi">1</code><code class="p">,</code><code class="w"> </code><code class="s">"cat"</code><code class="p">,</code><code class="w"> </code><code class="kc">true</code><code class="p">);</code><code class="w"/>

<code class="c1">// Same result, but called on string instance instead of statically</code><code class="w"/>
<code class="n">s</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"The %d pet is a %s: %b?%n"</code><code class="p">.</code><code class="na">formatted</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code><code class="w"> </code><code class="s">"cat"</code><code class="p">,</code><code class="w"> </code><code class="kc">true</code><code class="p">);</code><code class="w"/></pre>
<p>Placeholders in the format string where values will be introduced start with the
<code>%</code> character. In this example, we substitute an integer with <code>%d</code>, a string
with <code>%s</code>, a boolean with <code>%b</code>, and finally end the string with a newline via
<code>%n</code>.</p>
<p>Those with a background in C or similar languages will recognize this format
from the venerable <code>printf</code> function. Java supports many, though not all, of the
same formats with a wide variety of options. Java’s <code>printf</code> also provides more
sophisticated date and time formatting as seen in C’s <code>strftime</code> function. See
the Java documentation on <code>java.util.Formatter</code> for the full list of options
available.</p>
<p>Java also improves on the experience using these format strings by throwing
exceptions on invalid conditions such as mismatched numbers of placeholders to
values, or unrecognized <code>%</code> values.</p>
<p><code>String.format()</code> provides powerful tools for constructing complex strings but,
particularly when making output correct across countries, more assistance is
needed. <code>NumberFormat</code> is an example of classes Java provides to support more
complex, locale-aware formatting of values. Other formatters are also available
under <code>java.text</code>:</p>
<pre data-code-language="java" data-type="programlisting"><code class="c1">// Some common locales are available as constants</code><code class="w"/>
<code class="c1">// A much longer list can be accessed at runtime</code><code class="w"/>
<code class="kd">var</code><code class="w"> </code><code class="n">locale</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Locale</code><code class="p">.</code><code class="na">US</code><code class="p">;</code><code class="w"/>

<code class="n">NumberFormat</code><code class="p">.</code><code class="na">getNumberInstance</code><code class="p">(</code><code class="n">locale</code><code class="p">).</code><code class="na">format</code><code class="p">(</code><code class="mi">1_000_000_000L</code><code class="p">)</code><code class="w"/>
<code class="c1">// 1,000,000,000</code><code class="w"/>

<code class="n">NumberFormat</code><code class="p">.</code><code class="na">getCurrencyInstance</code><code class="p">(</code><code class="n">locale</code><code class="p">).</code><code class="na">format</code><code class="p">(</code><code class="mi">1_000_000_000L</code><code class="p">)</code><code class="w"/>
<code class="c1">// $1,000,000,000.00</code><code class="w"/>

<code class="n">NumberFormat</code><code class="p">.</code><code class="na">getPercentInstance</code><code class="p">(</code><code class="n">locale</code><code class="p">).</code><code class="na">format</code><code class="p">(</code><code class="mf">0.1</code><code class="p">)</code><code class="w"/>
<code class="c1">// 10%</code><code class="w"/>

<code class="n">NumberFormat</code><code class="p">.</code><code class="na">getCompactNumberInstance</code><code class="p">(</code><code class="n">locale</code><code class="w"> </code><code class="p">,</code><code class="w"> </code><code class="n">NumberFormat</code><code class="p">.</code><code class="na">Style</code><code class="p">.</code><code class="na">LONG</code><code class="p">)</code><code class="w"/>
<code class="w">            </code><code class="p">.</code><code class="na">format</code><code class="p">(</code><code class="mi">1_000_000_000L</code><code class="p">)</code><code class="w"/>
<code class="c1">// 1 billion</code><code class="w"/>

<code class="n">NumberFormat</code><code class="p">.</code><code class="na">getCompactNumberInstance</code><code class="p">(</code><code class="n">locale</code><code class="p">,</code><code class="w"> </code><code class="n">NumberFormat</code><code class="p">.</code><code class="na">Style</code><code class="p">.</code><code class="na">SHORT</code><code class="p">)</code><code class="w"/>
<code class="w">            </code><code class="p">.</code><code class="na">format</code><code class="p">(</code><code class="mi">1_000_000_000L</code><code class="p">)</code><code class="w"/>
<code class="c1">// 1B</code><code class="w"/></pre>
</div></section>
<section data-pdf-bookmark="Regular Expressions" data-type="sect2"><div class="sect2" id="idm45927718710640">
<h2>Regular Expressions</h2>
<p><a data-primary="regular expressions (regex)" data-type="indexterm" id="ix_ch09-asciidoc8"/><a data-primary="search" data-secondary="regular expressions and" data-type="indexterm" id="ix_ch09-asciidoc9"/><a data-primary="text" data-secondary="regular expressions and" data-type="indexterm" id="ix_ch09-asciidoc10"/>Java has support for <em>regular</em> <em>expressions</em> (often shortened to
<em>regex</em> or <em>regexp</em>). These are a representation of a search pattern
used to scan and match text. A regex is a sequence of characters that we
want to search for. They can be very simple—for example, <code>abc</code> means
that we’re looking for <em>a</em>, followed immediately by <em>b</em>, followed
immediately by <em>c</em>, anywhere within the text we’re searching.
Note that a search pattern may match an input text in zero, one, or more
places.</p>
<p>The simplest regexes are just sequences of literal characters, like
<code>abc</code>. However, the language of regexes can express more complex and
subtle ideas than just literal sequences. For example, a regex can
represent patterns to match like:</p>
<ul>
<li>
<p>A numeric digit</p>
</li>
<li>
<p>Any letter</p>
</li>
<li>
<p>Any number of letters, which must all be in the range <em>a</em> to <em>j</em> but
can be upper- or lowercase</p>
</li>
<li>
<p><em>a</em> followed by any four characters, followed by <em>b</em></p>
</li>
</ul>
<p>The syntax we use to write regular expressions is simple, but because we
can build complex patterns, it is often possible to write an
expression that does not implement precisely what we wanted. When using
regexes, it is very important to always test them fully. This should
include both test cases that should pass and cases that should fail.</p>
<p><a data-primary="metacharacters in regular expressions" data-type="indexterm" id="idm45927718587808"/>To express these more complex patterns, regexes use <em>metacharacters</em>.
These are special characters that indicate special processing is
required. This can be thought of as similar to the use of the <code>*</code>
character in operating system shells. In those circumstances, it is
understood that the <code>*</code> is not to be interpreted literally but instead
means “anything.” If we wanted to list all the Java source files in the
current directory on Unix, we would issue the command:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">ls</code><code class="w"> </code><code class="o">*</code><code class="p">.</code><code class="na">java</code><code class="w"/></pre>
<p>The metacharacters of regexes are similar, but there are far more of
them, and they are far more flexible than the set available in shells.
They also have different meanings than they do in shell scripts, so
don’t get confused.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>Many different flavors of regular expression patterns exist in the world. Java’s
is PCRE-compatible, supporting a common set of metacharacters popularized by the
Perl programming language. Be aware though that a random regex found online may
or may not actually work, whatever regex libraries you are using.</p>
</div>
<p>Let’s meet a couple of examples. Suppose we want to have a
spell-checking program that is relaxed about the difference in spelling
between British and American English. This means that <em>honor</em> and
<em>honour</em> should both be accepted as valid spelling choices. This is easy
to do with regular expressions.</p>
<p><a data-primary="java.util.regex package" data-type="indexterm" id="idm45927718558864"/>Java uses a class called <code>Pattern</code> (from the package
<code>java.util.regex</code>) to represent a regex. This class can’t be directly
instantiated, however. Instead, new instances are created by using a
static factory method, <code>compile()</code>. <a data-primary="Matcher class" data-type="indexterm" id="idm45927718556400"/>From a pattern, we then derive a
<code>Matcher</code> for a particular input string that we can use to explore the
input string. For example, let’s examine a bit of Shakespeare from the
play <em>Julius Caesar</em>:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">Pattern</code><code class="w"> </code><code class="n">p</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"honou?r"</code><code class="p">);</code><code class="w"/>

<code class="n">String</code><code class="w"> </code><code class="n">caesarUK</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"For Brutus is an honourable man"</code><code class="p">;</code><code class="w"/>
<code class="n">Matcher</code><code class="w"> </code><code class="n">mUK</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">matcher</code><code class="p">(</code><code class="n">caesarUK</code><code class="p">);</code><code class="w"/>

<code class="n">String</code><code class="w"> </code><code class="n">caesarUS</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"For Brutus is an honorable man"</code><code class="p">;</code><code class="w"/>
<code class="n">Matcher</code><code class="w"> </code><code class="n">mUS</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">matcher</code><code class="p">(</code><code class="n">caesarUS</code><code class="p">);</code><code class="w"/>

<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">"Matches UK spelling? "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">mUK</code><code class="p">.</code><code class="na">find</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">"Matches US spelling? "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">mUS</code><code class="p">.</code><code class="na">find</code><code class="p">());</code><code class="w"/></pre>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Be careful when using <code>Matcher</code>, as it has a method called <code>matches()</code>.
However, this method indicates whether the pattern can cover the entire
input string. It will return <code>false</code> if the pattern starts matching
only in the middle of the string.</p>
</div>
<p><a data-primary="? (question mark)" data-secondary="regular expression metacharacter" data-type="indexterm" id="idm45927718456208"/>The last example introduces our first regex metacharacter <code>?</code>, in the
pattern <code>honou?r</code>. This means “the preceding character is optional”—so
both <code>honour</code> and <code>honor</code> will match. Let’s look at another example.
Suppose we want to match both <em>minimize</em> and <em>minimise</em> (the latter
spelling is more common in British English). <a data-primary="[ ] (brackets)" data-secondary="in regular expressions" data-secondary-sortas="regular expressions" data-type="indexterm" id="idm45927718452416"/>We can use square brackets
to indicate that any character from a set (but only one alternative)
<code>[]</code> can be used—like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">Pattern</code><code class="w"> </code><code class="n">p</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"minimi[sz]e"</code><code class="p">);</code><code class="w"/></pre>
<p><a data-type="xref" href="#javanut8-CHP-9-TABLE-1">Table 9-1</a> provides an expanded list of metacharacters available
for Java regexes.</p>
<table id="javanut8-CHP-9-TABLE-1">
<caption><span class="label">Table 9-1. </span>Regex metacharacters</caption>
<thead>
<tr>
<th>Metacharacter</th>
<th>Meaning</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>?</code></p></td>
<td><p>Optional character—zero or one instance</p></td>
<td/>
</tr>
<tr>
<td><p><code>*</code></p></td>
<td><p>Zero or more of preceding character</p></td>
<td/>
</tr>
<tr>
<td><p><code>+</code></p></td>
<td><p>One or more of preceding character</p></td>
<td/>
</tr>
<tr>
<td><p><code>{M,N}</code></p></td>
<td><p>Between <code>M</code> and <code>N</code> instances of preceding character</p></td>
<td/>
</tr>
<tr>
<td><p><code>\d</code></p></td>
<td><p>A digit</p></td>
<td/>
</tr>
<tr>
<td><p><code>\D</code></p></td>
<td><p>A nondigit character</p></td>
<td/>
</tr>
<tr>
<td><p><code>\w</code></p></td>
<td><p>A word character</p></td>
<td><p>Digits, letters, and <code>_</code></p></td>
</tr>
<tr>
<td><p><code>\W</code></p></td>
<td><p>A nonword character</p></td>
<td/>
</tr>
<tr>
<td><p><code>\s</code></p></td>
<td><p>A whitespace character</p></td>
<td/>
</tr>
<tr>
<td><p><code>\S</code></p></td>
<td><p>A nonwhitespace character</p></td>
<td/>
</tr>
<tr>
<td><p><code>\n</code></p></td>
<td><p>Newline character</p></td>
<td/>
</tr>
<tr>
<td><p><code>\t</code></p></td>
<td><p>Tab character</p></td>
<td/>
</tr>
<tr>
<td><p><code>.</code></p></td>
<td><p>Any single character</p></td>
<td><p>Does not include newline in Java</p></td>
</tr>
<tr>
<td><p><code>[ ]</code></p></td>
<td><p>Any character contained with the brackets</p></td>
<td><p>Called a character
class</p></td>
</tr>
<tr>
<td><p><code>[^ ]</code></p></td>
<td><p>Any character not contained with the brackets</p></td>
<td><p>Called a negated
character class</p></td>
</tr>
<tr>
<td><p><code>( )</code></p></td>
<td><p>Build up a group of pattern elements</p></td>
<td><p>Called a group (or
capturing group)</p></td>
</tr>
<tr>
<td><p><code>|</code></p></td>
<td><p>Define alternative possibilities</p></td>
<td><p>Implements logical <code>OR</code></p></td>
</tr>
<tr>
<td><p><code>^</code></p></td>
<td><p>Start of string</p></td>
<td/>
</tr>
<tr>
<td><p><code>$</code></p></td>
<td><p>End of string</p></td>
<td/>
</tr>
<tr>
<td><p><code>\\</code></p></td>
<td><p>Literal escape (<code>\</code>) char</p></td>
<td/>
</tr>
</tbody>
</table>
<p>There are a few more, but this is the basic list. The <code>java.util.regex.Pattern</code>
Java documentation is a good source for all the details. From this, we can
construct more complex expressions for matching such as the examples
given earlier in this section:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="w"> </code><code class="n">text</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"Apollo 13"</code><code class="p">;</code><code class="w"/>

<code class="c1">// A numeric digit. Note we must use \\ because we need a literal \</code><code class="w"/>
<code class="c1">// and Java uses a single \ as an escape character, as per the table</code><code class="w"/>
<code class="n">Pattern</code><code class="w"> </code><code class="n">p</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"\\d"</code><code class="p">);</code><code class="w"/>
<code class="n">Matcher</code><code class="w"> </code><code class="n">m</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">matcher</code><code class="p">(</code><code class="n">text</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">print</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">" matches "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">text</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">"? "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">find</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">" ; match: "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">group</code><code class="p">());</code><code class="w"/>

<code class="c1">// A single letter</code><code class="w"/>
<code class="n">p</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"[a-zA-Z]"</code><code class="p">);</code><code class="w"/>
<code class="n">m</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">matcher</code><code class="p">(</code><code class="n">text</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">print</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">" matches "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">text</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">"? "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">find</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">" ; match: "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">group</code><code class="p">());</code><code class="w"/>

<code class="c1">// Any number of letters, which must all be in the range 'a' to 'j'</code><code class="w"/>
<code class="c1">// but can be upper- or lowercase</code><code class="w"/>
<code class="n">p</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"([a-jA-J]*)"</code><code class="p">);</code><code class="w"/>
<code class="n">m</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">matcher</code><code class="p">(</code><code class="n">text</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">print</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">" matches "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">text</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">"? "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">find</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">" ; match: "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">group</code><code class="p">());</code><code class="w"/>

<code class="c1">// 'a' followed by any four characters, followed by 'b'</code><code class="w"/>
<code class="n">text</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"abacab"</code><code class="p">;</code><code class="w"/>
<code class="n">p</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"a....b"</code><code class="p">);</code><code class="w"/>
<code class="n">m</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">matcher</code><code class="p">(</code><code class="n">text</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">print</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">" matches "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">text</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">"? "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">find</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">" ; match: "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">group</code><code class="p">());</code><code class="w"/></pre>
<p>Regexes are extremely useful for determining when a string matches a given
pattern, but they also allow for extracting bits and pieces from the strings as
well. This is done through the <em>group</em> mechanism, which is represented in the
patterns by <code>()</code>:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">String</code><code class="w"> </code><code class="n">text</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="s">"Apollo 13"</code><code class="p">;</code><code class="w"/>

<code class="n">Pattern</code><code class="w"> </code><code class="n">p</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"Apollo (\\d*)"</code><code class="p">);</code><code class="w"/>
<code class="n">Matcher</code><code class="w"> </code><code class="n">m</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">matcher</code><code class="p">(</code><code class="n">text</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">print</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">" matches "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">text</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="s">"? "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">find</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">"; mission: "</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">m</code><code class="p">.</code><code class="na">group</code><code class="p">(</code><code class="mi">1</code><code class="p">));</code><code class="w"/></pre>
<p>The call to <code>Matcher.group(1)</code> returns the text that the regex matched
in the <code>(\\d*)</code> of our pattern. Multiple groups are allowed, along with
syntax for naming groups rather than using them by position. See the Java
documentation for full details.</p>
<p>A common difficulty working with regular expressions is the need to use escape
characters for both the Java string and the regular expression. Where text
blocks have less escaping—such as quote characters—they can provide for less
cluttered expressions:</p>
<pre data-code-language="java" data-type="programlisting"><code class="c1">// Detect if there are any double-quoted passages in string</code><code class="w"/>
<code class="c1">// Note standard string literal requires escaping quotations</code><code class="w"/>
<code class="n">Pattern</code><code class="w"> </code><code class="n">oldQuoted</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">".*\".*\".*"</code><code class="p">);</code><code class="w"/>

<code class="n">Pattern</code><code class="w"> </code><code class="n">newQuoted</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"""</code>
<code class="s">                                    .*".*".*"""</code><code class="p">);</code><code class="w"/></pre>
<p><a data-primary="asPredicate()" data-type="indexterm" id="idm45927717805376"/><a data-primary="Predicate interface" data-secondary="converting regex to a Predicate" data-type="indexterm" id="idm45927717822448"/>Let’s conclude our quick tour of regular expressions by meeting a new
method that was added to <code>Pattern</code> as part of Java 8: <code>asPredicate()</code>.
This method is present to allow us to easily bridge from regular
expressions to the Java Collections and their new support for lambda
expressions.</p>
<p>For example, suppose we have a regex and a collection of strings. It’s
very natural to ask the question: “Which strings match against the
regex?” We do this by using the filter idiom and by converting the
regex to a <code>Predicate</code> using the helper method, like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="c1">// Contains a numeric digit</code><code class="w"/>
<code class="n">Pattern</code><code class="w"> </code><code class="n">p</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Pattern</code><code class="p">.</code><code class="na">compile</code><code class="p">(</code><code class="s">"\\d"</code><code class="p">);</code><code class="w"/>

<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code class="w"> </code><code class="n">ls</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">List</code><code class="p">.</code><code class="na">of</code><code class="p">(</code><code class="s">"Cat"</code><code class="p">,</code><code class="w"> </code><code class="s">"Dog"</code><code class="p">,</code><code class="w"> </code><code class="s">"Ice-9"</code><code class="p">,</code><code class="w"> </code><code class="s">"99 Luftballoons"</code><code class="p">);</code><code class="w"/>
<code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code class="w"> </code><code class="n">containDigits</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">ls</code><code class="p">.</code><code class="na">stream</code><code class="p">()</code><code class="w"/>
<code class="w">        </code><code class="p">.</code><code class="na">filter</code><code class="p">(</code><code class="n">p</code><code class="p">.</code><code class="na">asPredicate</code><code class="p">())</code><code class="w"/>
<code class="w">        </code><code class="p">.</code><code class="na">toList</code><code class="p">();</code><code class="w"/>

<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">containDigits</code><code class="p">);</code><code class="w"/></pre>
<p>Java’s built-in support for text processing is more than adequate for
the majority of text-processing tasks that business applications
normally require. More advanced tasks, such as the search and processing
of very large data sets, or complex parsing (including formal grammars),
are outside the scope of this book, but Java has a large ecosystem of
helpful libraries and bindings to specialized technologies for text
processing and analysis<a data-startref="ix_ch09-asciidoc10" data-type="indexterm" id="idm45927717752976"/><a data-startref="ix_ch09-asciidoc9" data-type="indexterm" id="idm45927717752368"/><a data-startref="ix_ch09-asciidoc8" data-type="indexterm" id="idm45927717698320"/>.<a data-startref="ix_ch09-asciidoc4" data-type="indexterm" id="idm45927717697520"/><a data-startref="ix_ch09-asciidoc3" data-type="indexterm" id="idm45927717696816"/><a data-startref="ix_ch09-asciidoc2" data-type="indexterm" id="idm45927717696144"/><a data-startref="ix_ch09-asciidoc1" data-type="indexterm" id="idm45927717695472"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Numbers and Math" data-type="sect1"><div class="sect1" id="idm45927718602048">
<h1>Numbers and Math</h1>
<p><a data-primary="data formats, handling of common" data-secondary="numbers and math" data-type="indexterm" id="ix_ch09-asciidoc11"/><a data-primary="numbers" data-type="indexterm" id="ix_ch09-asciidoc12"/>In this section, we will discuss Java’s support for numeric types in
some more detail. In particular, we’ll discuss the two’s complement
representation of integral types that Java uses. We’ll introduce
floating-point representations and touch on some of the problems they
can cause. We’ll also work through examples that use some of Java’s library
functions for standard mathematical operations.</p>
<section data-pdf-bookmark="How Java Represents Integer Types" data-type="sect2"><div class="sect2" id="idm45927717691616">
<h2>How Java Represents Integer Types</h2>
<p><a data-primary="integer types" data-type="indexterm" id="ix_ch09-asciidoc13"/><a data-primary="numbers" data-secondary="integer types" data-type="indexterm" id="ix_ch09-asciidoc14"/>Java’s integer types are all signed, as we first mentioned in
<a data-type="xref" href="ch02.xhtml#javanut8-CHP-2-SECT-3">“Primitive Data Types”</a>. This means that all integer
types can represent both positive and negative numbers. As computers
work with binary, this means that the only really logical way to
represent this is to split the possible bit patterns and use half of
them to represent negative numbers.</p>
<p>Let’s work with Java’s <code>byte</code> type to investigate how Java represents
integers. This has 8 bits so can represent 256 different numbers (i.e.,
128 negative and 128 nonnegative numbers). <a data-primary="0 (zero)" data-secondary="represented by integer types" data-type="indexterm" id="idm45927717665200"/>It’s logical to use the
pattern <code>0b0000_0000</code> to represent zero (recall that Java has the syntax
<code>0b&lt;binary digits&gt;</code> to represent numbers as binary), and then it’s easy
to figure out the bit patterns for the positive numbers:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kt">byte</code><code class="w"> </code><code class="n">b</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mb">0b0000_0001</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"> </code><code class="c1">// 1</code><code class="w"/>

<code class="n">b</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mb">0b0000_0010</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"> </code><code class="c1">// 2</code><code class="w"/>

<code class="n">b</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mb">0b0000_0011</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"> </code><code class="c1">// 3</code><code class="w"/>

<code class="c1">// ...</code><code class="w"/>

<code class="n">b</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mb">0b0111_1111</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"> </code><code class="c1">// 127</code><code class="w"/></pre>
<p>When we set the first bit of the byte, the sign should change (as we
have now used up all of the bit patterns that we’ve set aside for
nonnegative numbers). So the pattern <code>0b1000_0000</code> should represent
some negative number—but which one?</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>As a consequence of how we’ve defined things, in this representation we
have a very simple way to identify whether a bit pattern corresponds to
a negative number: if the high-end bit of a bit pattern is a <code>1</code>, then
the number being represented is negative.</p>
</div>
<p>Consider the bit pattern consisting of all set bits: <code>0b1111_1111</code>. If
we add <code>1</code> to this number, then the result will overflow the 8 bits of
storage that a <code>byte</code> has, resulting in <code>0b1_0000_0000</code>. If we want to
constrain this to fit within the <code>byte</code> data type, then we should ignore
the overflow, so this becomes <code>0b0000_0000</code>, otherwise known as zero. It is therefore
natural to adopt the representation that “all set bits represent <code>-1</code>.” This
allows for natural arithmetic behavior, like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">b</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">(</code><code class="kt">byte</code><code class="p">)</code><code class="w"> </code><code class="mb">0b1111_1111</code><code class="p">;</code><code class="w"> </code><code class="c1">// -1</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"/>
<code class="n">b</code><code class="o">++</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"/>

<code class="n">b</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">(</code><code class="kt">byte</code><code class="p">)</code><code class="w"> </code><code class="mb">0b1111_1110</code><code class="p">;</code><code class="w"> </code><code class="c1">// -2</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"/>
<code class="n">b</code><code class="o">++</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"/></pre>
<p>Finally, let’s look at the number that <code>0b1000_0000</code> represents. It’s
the most negative number that the type can represent, so for <code>byte</code>:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">b</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="p">(</code><code class="kt">byte</code><code class="p">)</code><code class="w"> </code><code class="mb">0b1000_0000</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">b</code><code class="p">);</code><code class="w"> </code><code class="c1">// -128</code><code class="w"/></pre>
<p><a data-primary="two's complement" data-type="indexterm" id="idm45927717430496"/>This representation, called <em>two’s complement</em>, is the most
common representation for signed integers. To use it effectively, you need to remember only two points:</p>
<ul>
<li>
<p>A bit pattern of all 1’s is the representation for −1.</p>
</li>
<li>
<p>If the high bit is set, the number is negative.</p>
</li>
</ul>
<p>Java’s other integer types (<code>short</code>, <code>int</code>, and <code>long</code>) behave in very
similar ways but with more bits in their representation. The <code>char</code>
data type is different because it represents a Unicode character, but in
some ways it behaves as an unsigned 16-bit numeric type. It is not normally
regarded as an integer type by Java programmers.<a data-startref="ix_ch09-asciidoc14" data-type="indexterm" id="idm45927717417248"/><a data-startref="ix_ch09-asciidoc13" data-type="indexterm" id="idm45927717416544"/></p>
</div></section>
<section data-pdf-bookmark="Java and Floating-Point Numbers" data-type="sect2"><div class="sect2" id="idm45927717691024">
<h2>Java and Floating-Point Numbers</h2>
<p><a data-primary="floating-point numbers" data-type="indexterm" id="ix_ch09-asciidoc15"/><a data-primary="numbers" data-secondary="floating-point" data-type="indexterm" id="ix_ch09-asciidoc16"/>Computers represent numbers using binary. We’ve seen how Java uses the
two’s complement representation for integers. But what about fractions
or decimals? Java, like almost all modern programming languages,
represents them using 
<span class="keep-together"><em>floating-point</em></span> <em>arithmetic</em>. Let’s take a look
at how this works, first in base-10 (regular decimal) and then in
binary. <a data-primary="java.lang.Math" data-type="indexterm" id="idm45927717410640"/>Java defines the two most important mathematical constants, <code>e</code>
and <code>π</code> (pi), as constants in <code>java.lang.Math</code> like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code class="w"> </code><code class="kd">static</code><code class="w"> </code><code class="kd">final</code><code class="w"> </code><code class="kt">double</code><code class="w"> </code><code class="n">E</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mf">2.7182818284590452354</code><code class="p">;</code><code class="w"/>
<code class="kd">public</code><code class="w"> </code><code class="kd">static</code><code class="w"> </code><code class="kd">final</code><code class="w"> </code><code class="kt">double</code><code class="w"> </code><code class="n">PI</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mf">3.14159265358979323846</code><code class="p">;</code><code class="w"/></pre>
<p><a data-primary="irrational numbers" data-type="indexterm" id="idm45927717345024"/>Of course, these constants are actually <em>irrational numbers</em> and cannot
be precisely expressed as a fraction, or by any finite decimal number.<sup><a data-type="noteref" href="ch09.xhtml#idm45927717366112" id="idm45927717366112-marker">1</a></sup> This means that whenever we try to represent them in a
computer, there is always rounding error. Let’s suppose we only want to
deal with eight digits of π, and we want to represent the digits as a
whole number. We can use a representation like this:</p>
<p><code>314159265 • 10<sup>–8</sup></code></p>
<pre data-type="programlisting"/>
<p>This starts to suggest the basis of how floating-point numbers work. We
use some of the bits to represent the significant digits (<code>314159265</code>,
in our example) of the number and some bits to represent the <em>exponent</em>
of the base (<code>-8</code>, in our example). The collection of significant digits
is called the <em>significand</em> and the exponent describes whether we need
to shift the significand up or down to get to the desired number.</p>
<p>Of course, in the examples we’ve met until now, we’ve been working in
base-10. Computers use binary, so we need to use this as the base in our
floating-point examples. This introduces some additional complications.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>The number <code>0.1</code> cannot be expressed as a finite sequence of binary
digits. This means that virtually all calculations that humans care
about will lose precision when performed in floating point, and rounding
error is essentially inevitable.</p>
</div>
<p>Let’s look at an example that shows the rounding problem:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code><code class="w"> </code><code class="n">d</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mf">0.3</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">d</code><code class="p">);</code><code class="w"> </code><code class="c1">// Special-cased to avoid ugly representation</code><code class="w"/>

<code class="kt">double</code><code class="w"> </code><code class="n">d2</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mf">0.2</code><code class="p">;</code><code class="w"/>
<code class="c1">// Should be -0.1 but prints -0.09999999999999998</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">d2</code><code class="w"> </code><code class="o">-</code><code class="w"> </code><code class="n">d</code><code class="p">);</code><code class="w"/></pre>
<p>The official standard that describes floating-point arithmetic is IEEE-754, and
Java’s support for floating point is based on that standard. The standard uses
24 binary digits for standard precision and 53 binary digits for double
precision.</p>
<p>As we mentioned briefly in <a data-type="xref" href="ch02.xhtml#javanut8-CHP-2">Chapter 2</a>, Java previously allowed deviation
from this standard, resulting in greater precision when some hardware features
were used to accelerate calculations. <a data-primary="IEEE-754 floating-point arithmetic standard" data-type="indexterm" id="idm45927717296000"/>As of Java 17, this is no longer allowed,
and all floating-point operations comply with the IEEE-754 standard.<a data-startref="ix_ch09-asciidoc16" data-type="indexterm" id="idm45927717295136"/><a data-startref="ix_ch09-asciidoc15" data-type="indexterm" id="idm45927717294464"/></p>
<section data-pdf-bookmark="BigDecimal" data-type="sect3"><div class="sect3" id="idm45927717293664">
<h3>BigDecimal</h3>
<p><a data-primary="BigDecimal" data-type="indexterm" id="idm45927717292144"/>Rounding error is a constant source of headaches for programmers who
work with floating-point numbers. In response, Java has a class
<code>java.math.BigDecimal</code> that provides arbitrary precision arithmetic, in
a decimal representation. This works around the problem of <code>0.1</code> not
having a finite representation in binary, but there are still some edge
conditions when converting to or from Java’s primitive types, as you can
see:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kt">double</code><code class="w"> </code><code class="n">d</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="mf">0.3</code><code class="p">;</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">d</code><code class="p">);</code><code class="w"/>

<code class="n">BigDecimal</code><code class="w"> </code><code class="n">bd</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">BigDecimal</code><code class="p">(</code><code class="n">d</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">bd</code><code class="p">);</code><code class="w"/>

<code class="n">bd</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">BigDecimal</code><code class="p">(</code><code class="s">"0.3"</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">bd</code><code class="p">);</code><code class="w"/></pre>
<p>However, even with all arithmetic performed in base-10, there are still
numbers, such as <code>1/3</code>, that do not have a terminating decimal
representation. Let’s see what happens when we try to represent such
numbers using <code>BigDecimal</code>:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">bd</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">BigDecimal</code><code class="p">(</code><code class="n">BigInteger</code><code class="p">.</code><code class="na">ONE</code><code class="p">);</code><code class="w"/>
<code class="n">bd</code><code class="p">.</code><code class="na">divide</code><code class="p">(</code><code class="k">new</code><code class="w"> </code><code class="n">BigDecimal</code><code class="p">(</code><code class="mf">3.0</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">bd</code><code class="p">);</code><code class="w"> </code><code class="c1">// Should be 1/3</code><code class="w"/></pre>
<p>As <code>BigDecimal</code> can’t represent <code>1/3</code> precisely, the call to <code>divide()</code>
blows up with <code>ArithmeticException</code>. When you are working with <code>BigDecimal</code>, it
is therefore necessary to be acutely aware of exactly which operations
could result in a nonterminating decimal result. To make matters worse,
<code>ArithmeticException</code> is an unchecked, runtime exception and so the Java
compiler does not even warn about possible exceptions of this type.</p>
<p>As a final note on floating-point numbers, the paper “What Every
Computer Scientist Should Know About Floating-Point Arithmetic” by David
Goldberg should be considered essential further reading for all
professional programmers. It is easily and freely obtainable on the
internet.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Java’s Standard Library of Mathematical Functions" data-type="sect2"><div class="sect2" id="idm45927717415408">
<h2>Java’s Standard Library of Mathematical Functions</h2>
<p><a data-primary="mathematical functions, standard library of" data-type="indexterm" id="ix_ch09-asciidoc17"/><a data-primary="numbers" data-secondary="library of mathematical functions" data-type="indexterm" id="ix_ch09-asciidoc18"/>To conclude this look at Java’s support for numeric data and math,
let’s take a quick tour of the standard library of functions that Java
ships with. These are mostly static helper methods that are located on
the class <code>java.lang.Math</code> and include functions like:</p>
<dl>
<dt><code>abs()</code></dt>
<dd>
<p><a data-primary="abs()" data-type="indexterm" id="idm45927717125264"/>Returns the absolute value of a number. Has overloaded forms for
various primitive types.</p>
</dd>
<dt>Trigonometric functions</dt>
<dd>
<p>Basic functions for computing the sine, cosine, tangent, and so on. Java
also includes hyperbolic versions and the inverse functions (such as
arc sine).</p>
</dd>
<dt><code>max()</code>, <code>min()</code></dt>
<dd>
<p><a data-primary="max()" data-type="indexterm" id="idm45927717086352"/><a data-primary="min()" data-type="indexterm" id="idm45927717085744"/>Overloaded functions to return the greater and smaller of two
arguments (both of the same numeric type).</p>
</dd>
<dt><code>ceil()</code>, <code>floor()</code></dt>
<dd>
<p><a data-primary="ceil()" data-type="indexterm" id="idm45927717083344"/><a data-primary="floor()" data-type="indexterm" id="idm45927717082672"/>Used for rounding to integers. <code>floor()</code> returns the largest
integer smaller than the argument (which is a double). <code>ceil()</code>
returns the smallest integer larger than the argument.</p>
</dd>
<dt><code>pow()</code>, <code>exp()</code>, <code>log()</code></dt>
<dd>
<p><a data-primary="exp()" data-type="indexterm" id="idm45927717078864"/><a data-primary="log()" data-type="indexterm" id="idm45927717078160"/><a data-primary="log10()" data-type="indexterm" id="idm45927717077488"/><a data-primary="pow()" data-type="indexterm" id="idm45927717076816"/>Functions for raising one number to the power of another and for
computing exponentials and natural logarithms. <code>log10()</code> provides
logarithms to base-10, rather than the natural base.</p>
</dd>
</dl>
<p>Let’s look at some simple examples of how to use these functions:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">abs</code><code class="p">(</code><code class="mi">2</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">abs</code><code class="p">(</code><code class="o">-</code><code class="mi">2</code><code class="p">));</code><code class="w"/>

<code class="kt">double</code><code class="w"> </code><code class="n">cosp3</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Math</code><code class="p">.</code><code class="na">cos</code><code class="p">(</code><code class="mf">0.3</code><code class="p">);</code><code class="w"/>
<code class="kt">double</code><code class="w"> </code><code class="n">sinp3</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Math</code><code class="p">.</code><code class="na">sin</code><code class="p">(</code><code class="mf">0.3</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">((</code><code class="n">cosp3</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="n">cosp3</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">sinp3</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="n">sinp3</code><code class="p">));</code><code class="w"> </code><code class="c1">// Always 1.0</code><code class="w"/>

<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">max</code><code class="p">(</code><code class="mf">0.3</code><code class="p">,</code><code class="w"> </code><code class="mf">0.7</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">max</code><code class="p">(</code><code class="mf">0.3</code><code class="p">,</code><code class="w"> </code><code class="o">-</code><code class="mf">0.3</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">max</code><code class="p">(</code><code class="o">-</code><code class="mf">0.3</code><code class="p">,</code><code class="w"> </code><code class="o">-</code><code class="mf">0.7</code><code class="p">));</code><code class="w"/>

<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">min</code><code class="p">(</code><code class="mf">0.3</code><code class="p">,</code><code class="w"> </code><code class="mf">0.7</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">min</code><code class="p">(</code><code class="mf">0.3</code><code class="p">,</code><code class="w"> </code><code class="o">-</code><code class="mf">0.3</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">min</code><code class="p">(</code><code class="o">-</code><code class="mf">0.3</code><code class="p">,</code><code class="w"> </code><code class="o">-</code><code class="mf">0.7</code><code class="p">));</code><code class="w"/>

<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">floor</code><code class="p">(</code><code class="mf">1.3</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">ceil</code><code class="p">(</code><code class="mf">1.3</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">floor</code><code class="p">(</code><code class="mf">7.5</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">ceil</code><code class="p">(</code><code class="mf">7.5</code><code class="p">));</code><code class="w"/>

<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">round</code><code class="p">(</code><code class="mf">1.3</code><code class="p">));</code><code class="w"> </code><code class="c1">// Returns long</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">round</code><code class="p">(</code><code class="mf">7.5</code><code class="p">));</code><code class="w"> </code><code class="c1">// Returns long</code><code class="w"/>

<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">pow</code><code class="p">(</code><code class="mf">2.0</code><code class="p">,</code><code class="w"> </code><code class="mf">10.0</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">exp</code><code class="p">(</code><code class="mi">1</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">exp</code><code class="p">(</code><code class="mi">2</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">log</code><code class="p">(</code><code class="mf">2.718281828459045</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">log10</code><code class="p">(</code><code class="mi">100_000</code><code class="p">));</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">log10</code><code class="p">(</code><code class="n">Integer</code><code class="p">.</code><code class="na">MAX_VALUE</code><code class="p">));</code><code class="w"/>

<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">random</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">"Let's toss a coin: "</code><code class="p">);</code><code class="w"/>
<code class="k">if</code><code class="w"> </code><code class="p">(</code><code class="n">Math</code><code class="p">.</code><code class="na">random</code><code class="p">()</code><code class="w"> </code><code class="o">&gt;</code><code class="w"> </code><code class="mf">0.5</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">"It's heads"</code><code class="p">);</code><code class="w"/>
<code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="s">"It's tails"</code><code class="p">);</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
<p><a data-primary="java.util.Random package" data-type="indexterm" id="idm45927716628528"/><a data-primary="Random class" data-type="indexterm" id="idm45927716627696"/><a data-primary="random()" data-type="indexterm" id="idm45927716627088"/>To conclude this section, let’s briefly discuss Java’s <code>random()</code>
function. When this is first called, it sets up a new instance of
<code>java.util.Random</code>. <a data-primary="PRNG (pseudorandom number generator)" data-type="indexterm" id="idm45927716625488"/><a data-primary="pseudorandom number generator (PRNG)" data-type="indexterm" id="idm45927716624784"/>This is a <em>pseudorandom number generator</em> (PRNG)—a
deterministic piece of code that produces numbers that <em>look</em> random
but are actually produced by a mathematical formula.<sup><a data-type="noteref" href="ch09.xhtml#idm45927716685824" id="idm45927716685824-marker">2</a></sup> In Java’s
case, the formula used for the PRNG is pretty simple, for example:</p>
<pre data-code-language="java" data-type="programlisting"><code class="w">    </code><code class="c1">// From java.util.Random</code><code class="w"/>
<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="kt">double</code><code class="w"> </code><code class="nf">nextDouble</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="p">(((</code><code class="kt">long</code><code class="p">)(</code><code class="n">next</code><code class="p">(</code><code class="mi">26</code><code class="p">))</code><code class="w"> </code><code class="o">&lt;&lt;</code><code class="w"> </code><code class="mi">27</code><code class="p">)</code><code class="w"> </code><code class="o">+</code><code class="w"> </code><code class="n">next</code><code class="p">(</code><code class="mi">27</code><code class="p">))</code><code class="w"> </code><code class="o">*</code><code class="w"> </code><code class="n">DOUBLE_UNIT</code><code class="p">;</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/></pre>
<p>If the sequence of pseudorandom numbers always starts at the same place,
then exactly the same stream of numbers will be produced. To get around
this problem, the PRNG is seeded by a value that should contain as much
true randomness as possible. For this source of randomness for the seed
value, Java uses a CPU counter value that is normally used for
high-precision timing.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>While Java’s built-in pseudorandom numbers are fine for most general
applications, some specialist applications (notably cryptography and
some types of simulations) have much more stringent requirements. If you
are working on an application of that sort, seek expert advice from
programmers who are already working in the area.</p>
</div>
<p>Now that we’ve looked at text and numeric data, let’s move on to look at
another of the most frequently encountered kinds of data: date and
time information<a data-startref="ix_ch09-asciidoc18" data-type="indexterm" id="idm45927716504784"/><a data-startref="ix_ch09-asciidoc17" data-type="indexterm" id="idm45927716504080"/>.<a data-startref="ix_ch09-asciidoc12" data-type="indexterm" id="idm45927716503280"/><a data-startref="ix_ch09-asciidoc11" data-type="indexterm" id="idm45927716502576"/></p>
</div></section>
</div></section>
<section data-pdf-bookmark="Date and Time" data-type="sect1"><div class="sect1" id="idm45927716500976">
<h1>Date and Time</h1>
<p><a data-primary="data formats, handling of common" data-secondary="date and time" data-type="indexterm" id="ix_ch09-asciidoc19"/><a data-primary="date and time API" data-type="indexterm" id="ix_ch09-asciidoc20"/><a data-primary="Java 8" data-primary-sortas="Java 08" data-secondary="Date and Time API" data-type="indexterm" id="ix_ch09-asciidoc21"/>Almost all business software applications have some notion of date
and time. When modeling real-world events or interactions, collecting a
point at which the event occurred is critical for future reporting or
comparison of domain objects. Java 8 brought a complete overhaul to the
way that developers work with date and time. This section introduces
those concepts. In earlier versions, the only support is via
classes such as <code>java.util.Date</code> that do not model the concepts. Code
that uses the older APIs should move as soon as possible.</p>
<section data-pdf-bookmark="Introducing the Java 8 Date and Time API" data-type="sect2"><div class="sect2" id="idm45927716495168">
<h2>Introducing the Java 8 Date and Time API</h2>
<p><a data-primary="java.time package" data-type="indexterm" id="idm45927716493760"/>Java 8 introduced the new package <code>java.time</code>, which contains the core
classes that most developers work with. It also contains four
subpackages:</p>
<dl>
<dt><code>java.time.chrono</code></dt>
<dd>
<p><a data-primary="java.time.chrono package" data-type="indexterm" id="idm45927716489872"/>Alternative chronologies that developers using calendaring systems
that do not follow the ISO standard will interact with. An example
would be a Japanese calendaring system.</p>
</dd>
<dt><code>java.time.format</code></dt>
<dd>
<p><a data-primary="java.time.format package" data-type="indexterm" id="idm45927716487984"/>Contains the <code>DateTimeFormatter</code> used for converting date and time
objects into a <code>String</code> and also for parsing strings into the data and
time objects.</p>
</dd>
<dt><code>java.time.temporal</code></dt>
<dd>
<p><a data-primary="java.time.temporal package" data-type="indexterm" id="idm45927716485328"/>Contains the interfaces required by the core date and time classes
and also abstractions (such as queries and adjusters) for advanced
operations with dates.</p>
</dd>
<dt><code>java.time.zone</code></dt>
<dd>
<p><a data-primary="java.time.zone package" data-type="indexterm" id="idm45927716483248"/>Classes used for the underlying time zone rules; most developers
won’t require this package.</p>
</dd>
</dl>
<p>One of the most important concepts when representing time is the idea of
an instantaneous point on the timeline of some entity. While this
concept is well defined within, for example, Special Relativity,
representing it within a computer requires us to make some
assumptions. <a data-primary="Instant class" data-type="indexterm" id="idm45927716481664"/>In Java, we represent a single point in time as an
<code>Instant</code>, which has these key assumptions:</p>
<ul>
<li>
<p>We cannot represent more seconds than can fit into a <code>long</code>.</p>
</li>
<li>
<p>We cannot represent time more precisely than nanosecond precision.</p>
</li>
</ul>
<p>This means that we are restricting ourselves to modeling time in a
manner that is consistent with the capabilities of current computer
systems. However, another fundamental concept should also
be introduced.</p>
<p>An <code>Instant</code> is about a single event in space-time. <a data-primary="java.time.Duration package" data-type="indexterm" id="idm45927716476480"/>However, it is far
from uncommon for programmers to have to deal with intervals between two
events, and so Java also contains the <code>java.time.Duration</code> class.
This class ignores calendar effects that might arise (e.g., from
daylight saving time). With this basic conception of instants and
durations between events, let’s move on to unpack the possible ways of
thinking about an instant.</p>
<section class="pagebreak-before" data-pdf-bookmark="The parts of a timestamp" data-type="sect3"><div class="sect3" id="idm45927716475168">
<h3>The parts of a timestamp</h3>
<p><a data-primary="date and time API" data-secondary="timestamp" data-type="indexterm" id="idm45927716473552"/><a data-primary="timestamp" data-type="indexterm" id="idm45927716472576"/>In <a data-type="xref" href="#javanut8-CHP-9-FIG-1">Figure 9-1</a>, we show the breakdown of the
different parts of a timestamp in a number of possible ways.</p>
<figure><div class="figure" id="javanut8-CHP-9-FIG-1">
<img alt="JN7 0901" height="384" src="assets/jns8_0901.png" width="600"/>
<h6><span class="label">Figure 9-1. </span>Breaking apart a timestamp</h6>
</div></figure>
<p>The key concept here is that a number of different
abstractions might be appropriate at different times. <a data-primary="LocalDate class" data-type="indexterm" id="idm45927716468304"/>For example,
there are applications where a <code>LocalDate</code> is key to business
processing, where the needed granularity is a business day.
Alternatively, some applications require subsecond, or even millisecond,
precision. Developers should be aware of their domain and use a suitable
representation within their application.</p>
</div></section>
<section data-pdf-bookmark="Example" data-type="sect3"><div class="sect3" id="idm45927716466896">
<h3>Example</h3>
<p><a data-primary="date and time API" data-secondary="diary class example" data-type="indexterm" id="idm45927716465696"/>The date and time API can be a lot to take in at first glance, so
let’s start by looking at an example and discussing a diary class that
keeps track of birthdays. If you happen to be very forgetful about
birthdays, then a class like this (and especially methods like
<code>getBirthdaysInNextMonth()</code>) might be very helpful:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code class="w"> </code><code class="kd">class</code> <code class="nc">BirthdayDiary</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="kd">private</code><code class="w"> </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="p">,</code><code class="w"> </code><code class="n">LocalDate</code><code class="o">&gt;</code><code class="w"> </code><code class="n">birthdays</code><code class="p">;</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="nf">BirthdayDiary</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="n">birthdays</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">HashMap</code><code class="o">&lt;&gt;</code><code class="p">();</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="n">LocalDate</code><code class="w"> </code><code class="nf">addBirthday</code><code class="p">(</code><code class="n">String</code><code class="w"> </code><code class="n">name</code><code class="p">,</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="n">day</code><code class="p">,</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="n">month</code><code class="p">,</code><code class="w"/>
<code class="w">                                 </code><code class="kt">int</code><code class="w"> </code><code class="n">year</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="n">LocalDate</code><code class="w"> </code><code class="n">birthday</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">of</code><code class="p">(</code><code class="n">year</code><code class="p">,</code><code class="w"> </code><code class="n">month</code><code class="p">,</code><code class="w"> </code><code class="n">day</code><code class="p">);</code><code class="w"/>
<code class="w">        </code><code class="n">birthdays</code><code class="p">.</code><code class="na">put</code><code class="p">(</code><code class="n">name</code><code class="p">,</code><code class="w"> </code><code class="n">birthday</code><code class="p">);</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">birthday</code><code class="p">;</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="n">LocalDate</code><code class="w"> </code><code class="nf">getBirthdayFor</code><code class="p">(</code><code class="n">String</code><code class="w"> </code><code class="n">name</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">birthdays</code><code class="p">.</code><code class="na">get</code><code class="p">(</code><code class="n">name</code><code class="p">);</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="nf">getAgeInYear</code><code class="p">(</code><code class="n">String</code><code class="w"> </code><code class="n">name</code><code class="p">,</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="n">year</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="n">Period</code><code class="w"> </code><code class="n">period</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Period</code><code class="p">.</code><code class="na">between</code><code class="p">(</code><code class="w"/>
<code class="w">              </code><code class="n">birthdays</code><code class="p">.</code><code class="na">get</code><code class="p">(</code><code class="n">name</code><code class="p">),</code><code class="w"/>
<code class="w">              </code><code class="n">birthdays</code><code class="p">.</code><code class="na">get</code><code class="p">(</code><code class="n">name</code><code class="p">).</code><code class="na">withYear</code><code class="p">(</code><code class="n">year</code><code class="p">));</code><code class="w"/>

<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">period</code><code class="p">.</code><code class="na">getYears</code><code class="p">();</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code class="w"> </code><code class="nf">getFriendsOfAgeIn</code><code class="p">(</code><code class="kt">int</code><code class="w"> </code><code class="n">age</code><code class="p">,</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="n">year</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">birthdays</code><code class="p">.</code><code class="na">keySet</code><code class="p">().</code><code class="na">stream</code><code class="p">()</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">filter</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="n">getAgeInYear</code><code class="p">(</code><code class="n">p</code><code class="p">,</code><code class="w"> </code><code class="n">year</code><code class="p">)</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="n">age</code><code class="p">)</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">collect</code><code class="p">(</code><code class="n">Collectors</code><code class="p">.</code><code class="na">toSet</code><code class="p">());</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="nf">getDaysUntilBirthday</code><code class="p">(</code><code class="n">String</code><code class="w"> </code><code class="n">name</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="n">Period</code><code class="w"> </code><code class="n">period</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">Period</code><code class="p">.</code><code class="na">between</code><code class="p">(</code><code class="w"/>
<code class="w">              </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">now</code><code class="p">(),</code><code class="w"/>
<code class="w">              </code><code class="n">birthdays</code><code class="p">.</code><code class="na">get</code><code class="p">(</code><code class="n">name</code><code class="p">));</code><code class="w"/>

<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">period</code><code class="p">.</code><code class="na">getDays</code><code class="p">();</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code class="w"> </code><code class="nf">getBirthdaysIn</code><code class="p">(</code><code class="n">Month</code><code class="w"> </code><code class="n">month</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">birthdays</code><code class="p">.</code><code class="na">entrySet</code><code class="p">().</code><code class="na">stream</code><code class="p">()</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">filter</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">getValue</code><code class="p">().</code><code class="na">getMonth</code><code class="p">()</code><code class="w"> </code><code class="o">==</code><code class="w"> </code><code class="n">month</code><code class="p">)</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">map</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="n">p</code><code class="p">.</code><code class="na">getKey</code><code class="p">())</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">collect</code><code class="p">(</code><code class="n">Collectors</code><code class="p">.</code><code class="na">toSet</code><code class="p">());</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="n">Set</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code class="w"> </code><code class="nf">getBirthdaysInCurrentMonth</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">getBirthdaysIn</code><code class="p">(</code><code class="n">LocalDate</code><code class="p">.</code><code class="na">now</code><code class="p">().</code><code class="na">getMonth</code><code class="p">());</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>

<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="nf">getTotalAgeInYears</code><code class="p">()</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">birthdays</code><code class="p">.</code><code class="na">keySet</code><code class="p">().</code><code class="na">stream</code><code class="p">()</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">mapToInt</code><code class="p">(</code><code class="n">p</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="n">getAgeInYear</code><code class="p">(</code><code class="n">p</code><code class="p">,</code><code class="w"/>
<code class="w">                      </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">now</code><code class="p">().</code><code class="na">getYear</code><code class="p">()))</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">sum</code><code class="p">();</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
<p>This class shows how to use the low-level API to build up useful
functionality. It also uses innovations such as the Java Streams API
and demonstrates how to use <code>LocalDate</code> as an immutable class and how
dates should be treated as values.</p>
</div></section>
</div></section>
<section data-pdf-bookmark="Queries" data-type="sect2"><div class="sect2" id="idm45927715948032">
<h2>Queries</h2>
<p><a data-primary="date and time API" data-secondary="queries" data-type="indexterm" id="ix_ch09-asciidoc22"/><a data-primary="queries" data-secondary="date and time" data-type="indexterm" id="ix_ch09-asciidoc23"/><a data-primary="queries" data-secondary="temporal" data-type="indexterm" id="ix_ch09-asciidoc24"/>Under a wide variety of circumstances, we may find ourselves wanting
to answer a question about a particular temporal object. Some example
questions we may want answers to are:</p>
<ul>
<li>
<p>Is the date before March 1st?</p>
</li>
<li>
<p>Is the date in a leap year?</p>
</li>
<li>
<p>How many days is it from today until my next birthday?</p>
</li>
</ul>
<p><a data-primary="TemporalQuery interface" data-type="indexterm" id="idm45927716042816"/>This is achieved by the use of the <code>TemporalQuery</code> interface, which is
defined like this:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code class="w"> </code><code class="kd">interface</code> <code class="nc">TemporalQuery</code><code class="o">&lt;</code><code class="n">R</code><code class="o">&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="n">R</code><code class="w"> </code><code class="nf">queryFrom</code><code class="p">(</code><code class="n">TemporalAccessor</code><code class="w"> </code><code class="n">temporal</code><code class="p">);</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
<p>The parameter to <code>queryFrom()</code> should not be <code>null</code>, but if the result
indicates that a value was not found, <code>null</code> could be used as a return
value.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-primary="Predicate interface" data-secondary="temporal queries vs." data-type="indexterm" id="idm45927716022496"/>The <code>Predicate</code> interface can be thought of as a query that can only
represent answers to yes-or-no questions. Temporal queries are more
general and can return a value of “How many?” or “Which?” instead of
just “yes” or “no.”</p>
</div>
<p>Let’s look at an example of a query in action, by considering a query
that answers the following question: “Which quarter of the year is this
date in?” Java does not support the concept of a quarter directly.
Instead, code like this is used:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">LocalDate</code><code class="w"> </code><code class="n">today</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">now</code><code class="p">();</code><code class="w"/>
<code class="n">Month</code><code class="w"> </code><code class="n">currentMonth</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">today</code><code class="p">.</code><code class="na">getMonth</code><code class="p">();</code><code class="w"/>
<code class="n">Month</code><code class="w"> </code><code class="n">firstMonthofQuarter</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">currentMonth</code><code class="p">.</code><code class="na">firstMonthOfQuarter</code><code class="p">();</code><code class="w"/></pre>
<p>This still doesn’t give quarter as a separate abstraction and instead
special case code is still needed. So let’s slightly extend the JDK
support by defining this enum type:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code class="w"> </code><code class="kd">enum</code><code class="w"> </code><code class="n">Quarter</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="n">FIRST</code><code class="p">,</code><code class="w"> </code><code class="n">SECOND</code><code class="p">,</code><code class="w"> </code><code class="n">THIRD</code><code class="p">,</code><code class="w"> </code><code class="n">FOURTH</code><code class="p">;</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
<p>Now, the query can be written as:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code class="w"> </code><code class="kd">class</code> <code class="nc">QuarterOfYearQuery</code><code class="w"> </code><code class="kd">implements</code><code class="w"> </code><code class="n">TemporalQuery</code><code class="o">&lt;</code><code class="n">Quarter</code><code class="o">&gt;</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nd">@Override</code><code class="w"/>
<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="n">Quarter</code><code class="w"> </code><code class="nf">queryFrom</code><code class="p">(</code><code class="n">TemporalAccessor</code><code class="w"> </code><code class="n">temporal</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="n">LocalDate</code><code class="w"> </code><code class="n">now</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">from</code><code class="p">(</code><code class="n">temporal</code><code class="p">);</code><code class="w"/>

<code class="w">        </code><code class="k">if</code><code class="p">(</code><code class="n">now</code><code class="p">.</code><code class="na">isBefore</code><code class="p">(</code><code class="n">now</code><code class="p">.</code><code class="na">with</code><code class="p">(</code><code class="n">Month</code><code class="p">.</code><code class="na">APRIL</code><code class="p">).</code><code class="na">withDayOfMonth</code><code class="p">(</code><code class="mi">1</code><code class="p">)))</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="k">return</code><code class="w"> </code><code class="n">Quarter</code><code class="p">.</code><code class="na">FIRST</code><code class="p">;</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="p">(</code><code class="n">now</code><code class="p">.</code><code class="na">isBefore</code><code class="p">(</code><code class="n">now</code><code class="p">.</code><code class="na">with</code><code class="p">(</code><code class="n">Month</code><code class="p">.</code><code class="na">JULY</code><code class="p">)</code><code class="w"/>
<code class="w">                               </code><code class="p">.</code><code class="na">withDayOfMonth</code><code class="p">(</code><code class="mi">1</code><code class="p">)))</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="k">return</code><code class="w"> </code><code class="n">Quarter</code><code class="p">.</code><code class="na">SECOND</code><code class="p">;</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="k">if</code><code class="p">(</code><code class="n">now</code><code class="p">.</code><code class="na">isBefore</code><code class="p">(</code><code class="n">now</code><code class="p">.</code><code class="na">with</code><code class="p">(</code><code class="n">Month</code><code class="p">.</code><code class="na">NOVEMBER</code><code class="p">)</code><code class="w"/>
<code class="w">                               </code><code class="p">.</code><code class="na">withDayOfMonth</code><code class="p">(</code><code class="mi">1</code><code class="p">)))</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="k">return</code><code class="w"> </code><code class="n">Quarter</code><code class="p">.</code><code class="na">THIRD</code><code class="p">;</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"> </code><code class="k">else</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">           </code><code class="k">return</code><code class="w"> </code><code class="n">Quarter</code><code class="p">.</code><code class="na">FOURTH</code><code class="p">;</code><code class="w"/>
<code class="w">        </code><code class="p">}</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
<p><code>TemporalQuery</code> objects can be used directly or indirectly. Let’s look
at an example of each:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">QuarterOfYearQuery</code><code class="w"> </code><code class="n">q</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">QuarterOfYearQuery</code><code class="p">();</code><code class="w"/>

<code class="c1">// Direct</code><code class="w"/>
<code class="n">Quarter</code><code class="w"> </code><code class="n">quarter</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">q</code><code class="p">.</code><code class="na">queryFrom</code><code class="p">(</code><code class="n">LocalDate</code><code class="p">.</code><code class="na">now</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">quarter</code><code class="p">);</code><code class="w"/>

<code class="c1">// Indirect</code><code class="w"/>
<code class="n">quarter</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">now</code><code class="p">().</code><code class="na">query</code><code class="p">(</code><code class="n">q</code><code class="p">);</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">quarter</code><code class="p">);</code><code class="w"/></pre>
<p>Under most circumstances, it is better to use the indirect approach,
where the query object is passed as a parameter to <code>query()</code>. This is
because it is normally a lot clearer to read in code.<a data-startref="ix_ch09-asciidoc24" data-type="indexterm" id="idm45927715447504"/><a data-startref="ix_ch09-asciidoc23" data-type="indexterm" id="idm45927715446896"/><a data-startref="ix_ch09-asciidoc22" data-type="indexterm" id="idm45927715446256"/></p>
</div></section>
<section data-pdf-bookmark="Adjusters" data-type="sect2"><div class="sect2" id="idm45927715947440">
<h2>Adjusters</h2>
<p><a data-primary="adjusters, date and time" data-type="indexterm" id="idm45927715444176"/><a data-primary="date and time API" data-secondary="adjusters" data-type="indexterm" id="idm45927715443504"/>Adjusters modify date and time objects. Suppose, for example, that
we want to return the first day of a quarter that contains a particular
timestamp:</p>
<pre data-code-language="java" data-type="programlisting"><code class="kd">public</code><code class="w"> </code><code class="kd">class</code> <code class="nc">FirstDayOfQuarter</code><code class="w"> </code><code class="kd">implements</code><code class="w"> </code><code class="n">TemporalAdjuster</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">    </code><code class="nd">@Override</code><code class="w"/>
<code class="w">    </code><code class="kd">public</code><code class="w"> </code><code class="n">Temporal</code><code class="w"> </code><code class="nf">adjustInto</code><code class="p">(</code><code class="n">Temporal</code><code class="w"> </code><code class="n">temporal</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">        </code><code class="kd">final</code><code class="w"> </code><code class="kt">int</code><code class="w"> </code><code class="n">currentQuarter</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">YearMonth</code><code class="p">.</code><code class="na">from</code><code class="p">(</code><code class="n">temporal</code><code class="p">)</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">get</code><code class="p">(</code><code class="n">IsoFields</code><code class="p">.</code><code class="na">QUARTER_OF_YEAR</code><code class="p">);</code><code class="w"/>

<code class="w">        </code><code class="kd">final</code><code class="w"> </code><code class="n">Month</code><code class="w"> </code><code class="n">firstMonthOfQuarter</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">switch</code><code class="w"> </code><code class="p">(</code><code class="n">currentQuarter</code><code class="p">)</code><code class="w"> </code><code class="p">{</code><code class="w"/>
<code class="w">            </code><code class="k">case</code><code class="w"> </code><code class="mi">1</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="n">Month</code><code class="p">.</code><code class="na">JANUARY</code><code class="p">;</code><code class="w"/>
<code class="w">            </code><code class="k">case</code><code class="w"> </code><code class="mi">2</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="n">Month</code><code class="p">.</code><code class="na">APRIL</code><code class="p">;</code><code class="w"/>
<code class="w">            </code><code class="k">case</code><code class="w"> </code><code class="mi">3</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="n">Month</code><code class="p">.</code><code class="na">JULY</code><code class="p">;</code><code class="w"/>
<code class="w">            </code><code class="k">case</code><code class="w"> </code><code class="mi">4</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="n">Month</code><code class="p">.</code><code class="na">OCTOBER</code><code class="p">;</code><code class="w"/>
<code class="w">            </code><code class="k">default</code><code class="w"> </code><code class="o">-&gt;</code><code class="w"> </code><code class="k">throw</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">IllegalArgumentException</code><code class="p">(</code><code class="s">"Impossible"</code><code class="p">);</code><code class="w"/>
<code class="w">        </code><code class="p">};</code><code class="w"/>

<code class="w">        </code><code class="k">return</code><code class="w"> </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">from</code><code class="p">(</code><code class="n">temporal</code><code class="p">)</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">withMonth</code><code class="p">(</code><code class="n">firstMonthOfQuarter</code><code class="p">.</code><code class="na">getValue</code><code class="p">())</code><code class="w"/>
<code class="w">                </code><code class="p">.</code><code class="na">with</code><code class="p">(</code><code class="n">TemporalAdjusters</code><code class="p">.</code><code class="na">firstDayOfMonth</code><code class="p">());</code><code class="w"/>
<code class="w">    </code><code class="p">}</code><code class="w"/>
<code class="p">}</code><code class="w"/></pre>
<p>Let’s look at an example of how to use an adjuster:</p>
<pre data-code-language="java" data-type="programlisting"><code class="n">LocalDate</code><code class="w"> </code><code class="n">now</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">now</code><code class="p">();</code><code class="w"/>
<code class="n">Temporal</code><code class="w"> </code><code class="n">fdoq</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">now</code><code class="p">.</code><code class="na">with</code><code class="p">(</code><code class="k">new</code><code class="w"> </code><code class="n">FirstDayOfQuarter</code><code class="p">());</code><code class="w"/>
<code class="n">System</code><code class="p">.</code><code class="na">out</code><code class="p">.</code><code class="na">println</code><code class="p">(</code><code class="n">fdoq</code><code class="p">);</code><code class="w"/></pre>
<p>The key here is the <code>with()</code> method, and the code should be read as
taking in one <code>Temporal</code> object and returning another object that has
been modified. This is completely normal for APIs that work with
immutable objects.</p>
</div></section>
<section data-pdf-bookmark="Timezones" data-type="sect2"><div class="sect2" id="idm45927715173344">
<h2>Timezones</h2>
<p><a data-primary="date and time API" data-secondary="timezones" data-type="indexterm" id="idm45927715172208"/><a data-primary="timezones" data-type="indexterm" id="idm45927715171232"/>If you work with code that cares about dates, you will almost certainly
encounter complications from timezones. Beyond the simple problems of presenting
information clearly to users, timezones cause problems because they change.
Whether from daylight savings moves or governments reassigning the zone for a
given territory, the definition of timezones today isn’t guaranteed to be the
same next month.</p>
<p>The JVM brings its own copy of the standard IANA timezone data, so getting
timezone updates typically requires a JDK upgrade. For those who need changes
more frequently, Oracle publishes a <a href="https://oreil.ly/RIMLr"><code>tzupdater</code> tool</a> that
can be used to modify a JDK installation in-place with newer data.</p>
</div></section>
<section data-pdf-bookmark="Legacy Date and Time" data-type="sect2"><div class="sect2" id="idm45927715168816">
<h2>Legacy Date and Time</h2>
<p><a data-primary="date and time API" data-secondary="legacy issues" data-type="indexterm" id="idm45927715167376"/>Unfortunately, many applications are not yet converted to use the
superior date and time libraries that shipped with Java 8. So, for
completeness, we briefly mention the legacy date and time support (which
is based on <code>java.util.Date</code>).</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>The legacy date and time classes, especially <code>java.util.Date</code>, should <em>not</em> be used in modern Java environments.
Consider refactoring or rewriting any code that still uses the legacy classes.</p>
</div>
<p>In older versions of Java, <code>java.time</code> is not available. Instead,
programmers rely upon the legacy and rudimentary support provided by
<code>java.util.Date</code>. Historically, this was the only way to represent
timestamps, and although named <code>Date</code> this class actually consisted of
both a date and a time component—and this led to a lot of confusion for
many programmers.</p>
<p>There are many problems with the legacy support provided by <code>Date</code>, for
example:</p>
<ul>
<li>
<p>The <code>Date</code> class is incorrectly factored. It doesn’t actually refer to
a date and instead is more like a timestamp. It turns out that we need
different representations for a date, versus a date and time, versus an
instantaneous timestamp.</p>
</li>
<li>
<p><code>Date</code> is mutable. We can obtain a reference to a date and then
change when it refers to.</p>
</li>
<li>
<p>The <code>Date</code> class doesn’t actually accept ISO-8601, the universal ISO
date standard, as being a valid date.</p>
</li>
<li>
<p><code>Date</code> has a very large number of deprecated methods.</p>
</li>
</ul>
<p>The current JDK uses two constructors for <code>Date</code>—the <code>void</code> constructor
that is intended to be the “now constructor,” and a constructor that
takes a number of milliseconds since epoch.</p>
<p>If you cannot avoid <code>java.util.Date</code>, you can still take advantage of the newer
APIs by converting with code like the following example:<a data-startref="ix_ch09-asciidoc21" data-type="indexterm" id="idm45927715117536"/><a data-startref="ix_ch09-asciidoc20" data-type="indexterm" id="idm45927715116832"/><a data-startref="ix_ch09-asciidoc19" data-type="indexterm" id="idm45927715116160"/></p>
<pre data-code-language="java" data-type="programlisting"><code class="c1">// Defaults to timestamp when called</code><code class="w"/>
<code class="kd">var</code><code class="w"> </code><code class="n">oldDate</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="k">new</code><code class="w"> </code><code class="n">java</code><code class="p">.</code><code class="na">util</code><code class="p">.</code><code class="na">Date</code><code class="p">();</code><code class="w"/>

<code class="c1">// Note both forms require specifying timezone -</code><code class="w"/>
<code class="c1">// part of the failing in the old API</code><code class="w"/>
<code class="kd">var</code><code class="w"> </code><code class="n">newDate</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">LocalDate</code><code class="p">.</code><code class="na">ofInstant</code><code class="p">(</code><code class="w"/>
<code class="w">                  </code><code class="n">oldDate</code><code class="p">.</code><code class="na">toInstant</code><code class="p">(),</code><code class="w"/>
<code class="w">                  </code><code class="n">ZoneId</code><code class="p">.</code><code class="na">systemDefault</code><code class="p">());</code><code class="w"/>

<code class="kd">var</code><code class="w"> </code><code class="n">newTime</code><code class="w"> </code><code class="o">=</code><code class="w"> </code><code class="n">LocalDateTime</code><code class="p">.</code><code class="na">ofInstant</code><code class="p">(</code><code class="w"/>
<code class="w">                  </code><code class="n">oldDate</code><code class="p">.</code><code class="na">toInstant</code><code class="p">(),</code><code class="w"/>
<code class="w">                  </code><code class="n">ZoneId</code><code class="p">.</code><code class="na">systemDefault</code><code class="p">());</code><code class="w"/></pre>
</div></section>
</div></section>
<section data-pdf-bookmark="Summary" data-type="sect1"><div class="sect1" id="idm45927715040192">
<h1>Summary</h1>
<p>In this chapter, we’ve met several different classes of data. Textual
and numeric data are the most obvious examples, but as working
programmers we will meet a large number of different sorts of data.
Let’s move on to look at whole files of data and new ways to work with
I/O and networking. Fortunately, Java provides good support for dealing
with many of these abstractions.<a data-startref="ix_ch09-asciidoc0" data-type="indexterm" id="idm45927715071680"/></p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm45927717366112"><sup><a href="ch09.xhtml#idm45927717366112-marker">1</a></sup> In fact, they are actually two of the known examples of <em>transcendental numbers</em>.</p><p data-type="footnote" id="idm45927716685824"><sup><a href="ch09.xhtml#idm45927716685824-marker">2</a></sup> It is very difficult to get computers to produce true random numbers, and in the rare cases where this is done, specialized hardware is usually necessary.</p></div></div></section></div></body></html>