<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. Continuous Integration"><div class="chapter" id="continuous_integration">
<h1><span class="label">Chapter 5. </span>Continuous Integration</h1>


<p class="byline">Melissa McKay</p>
  <blockquote data-type="epigraph" epub:type="epigraph">
    <p>Always make new mistakes.</p>
    <p data-type="attribution">Esther Dyson</p>
  </blockquote>

<p>Back in <a data-type="xref" href="ch02.xhtml#the_system_of_truth">Chapter 2</a>, you learned the <a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="about need for" id="idm45310209004576"/>value of source control and a common code repository. After you have organized and settled on your source control solution, you need to take a few more steps to reach an end result  where your users can bask in the perfect user experience of your delivered software.</p>

<p>Think about the process that you would take as an individual developer to progress your software through the entire software development lifecycle. After determining the acceptance criteria for a particular feature or bug fix for your software, you would proceed with adding the actual lines of code along with the related unit tests to the codebase. Then, you would compile and run all of the unit tests to ensure that your new code works as you expect (or at least as defined by your unit tests) and doesn’t break known existing functionality. After you find that all tests pass, you would build and package your application and verify functionality in the form of integration tests in a quality assurance (QA) environment. Finally, happy with the green light from your well-oiled and maintained test suites, you would deliver and/or deploy your software to a production environment.</p>

<p>If you have any development experience at all, you know as well as I do that software rarely falls into place so neatly. <a data-type="indexterm" data-primary="collaboration" data-secondary="continuous integration for" id="idm45310209002704"/><a data-type="indexterm" data-primary="concurrent development" data-see="continuous integration" id="idm45310209001760"/>Strict implementation of the ideal workflow described is too simplistic when you begin working on a larger project with a team of developers. Multiple complications are introduced that can gum up the gears of the software delivery lifecycle and throw your schedule into a lurch. This chapter discusses how continuous integration and the related best practices and toolsets will help you steer clear of or mitigate the most common hurdles and headaches that software development projects often encounter on the path to delivery.</p>






<section data-type="sect1" data-pdf-bookmark="Adopt Continuous Integration"><div class="sect1" id="adopt_continuous_integration">
<h1>Adopt Continuous Integration</h1>

<p><em>Continuous integration</em> (CI) is most commonly<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="about" id="idm45310208998128"/> described as frequently integrating code changes from multiple contributors into the main source code repository of a project. In practice, this definition by itself is a little vague. Exactly how often is <em>frequently</em>? What does integrating actually mean in this context? Is it enough just to coordinate pushing code changes to the source code repository? And most important, what problem does this process solve—for what benefit(s) should you adopt this practice?</p>

<p>The concept of CI has been around now for quite some time.<a data-type="indexterm" data-primary="Fowler, Martin" id="idm45310208996224"/><a data-type="indexterm" data-primary="Beck, Kent" id="idm45310208995520"/><a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="about need for" id="idm45310208994848"/> <a href="https://oreil.ly/3sYHE">According to Martin Fowler</a>, the term <em>continuous integration</em> originated with Kent Beck’s Extreme Programming development process, as one of its original 12 practices. In the DevOps community, the term itself is now as common as butter on toast. But the way it is implemented may vary from team to team and project to project. The benefits are hit-or-miss if there isn’t a thorough understanding of the original intent or if best practices are abandoned.</p>

<p>It’s interesting to see how our understanding of CI has changed over time. The way we talk about it now is much different from when it was initially introduced by Beck to address the issues of concurrent development. The problems we have today are more about keeping regular and frequent builds efficient while minimizing bugs, whereas initially, CI and the proliferation of build tools that spun out from it was more about getting a project to build <em>at all</em> after development was complete.<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="premise" id="idm45310208991776"/> Instead of trying to assemble a project only <em>after</em> all the coding has been completed by the team, CI required a change in mindset—to regularly build <em>during</em> development.</p>

<p>Today, CI is meant to identify bugs and compatibility issues as quickly as possible in the development cycle through regular and frequent builds. The basic premise of CI is that if developers integrate changes often, bugs can be found sooner in the process, and less time is spent hunting down when and where a problem was introduced. The longer a bug goes undiscovered, the greater the potential for it to become entrenched in the surrounding codebase.</p>

<p>It is much easier from a development perspective to find, catch, and fix bugs closer to when they are introduced rather than extract them from layers of code that have already moved to later stages of the delivery pipeline. Bugs that evade discovery until the latest acceptance phases, and especially those that escape all the way to release, directly translate to more money spent to fix and less time spent on new features. In the case of fixing a bug in production, in many instances, there is now a requirement to patch existing deployments in addition to including and documenting the fix in a new version. This inherently reduces the time the team has available to spend on the development of new features.</p>

<p>It’s important to understand that implementing a CI solution does <em>not</em> equate to software that never has any bugs. It would be foolish to use such a definitive measure to determine whether the implementation of CI is worthy. A more valuable metric might be the number of bugs or compatibility issues that were caught by CI. In much the same way that a vaccine is never 100% effective in a large population, CI is simply another level of protection to filter the most obvious bugs from a release. By itself, CI will never replace the well-known benefits of software development best practices that are in the purview of the initial design and development steps. It will, however, provide a better safety net for software as it is repeatedly handled and massaged by multiple developers over time. <a data-type="indexterm" data-primary="Fowler, Martin" id="idm45310208987536"/>Martin Fowler puts it this way: “Continuous integration doesn’t get rid of bugs, but it does make them dramatically easier to find and remove.”</p>

<p>My first experience with CI was during<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="example" id="idm45310208986320"/><a data-type="indexterm" data-primary="XP (Extreme Programming)" data-seealso="continuous integration" id="idm45310208985280"/><a data-type="indexterm" data-primary="Extreme Programming (XP)" data-seealso="continuous integration" id="idm45310208984320"/><a data-type="indexterm" data-primary="CI" data-see="continuous integration" id="idm45310208983360"/> an internship at a small company that adopted the software development methodology of Extreme Programming (XP), of which CI is an important aspect. We did not have an incredibly fancy system using all of the latest and greatest DevOps tools. What we did have was a common code repository, and a single build server located in a small closet in the office.</p>

<p>Unbeknownst to me when I first joined the development team, a speaker was set up on the build server that would erupt in the sound of emergency sirens if a fresh checkout from source control resulted in the failure of a build or any automated tests. We were a relatively young team, so this part of our CI was mostly in jest, but guess who learned <em>remarkably</em> quickly not to push code to the main repository without first verifying that the project built successfully and passed unit tests?</p>

<p>To this day, I feel exceptionally fortunate to have been exposed to this practice in this way. <a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="benefits" id="idm45310208980960"/>The simplicity of it underscored the most important aspects of CI. I want to call out three by-products of this simple setup:</p>
<dl>
<dt>Code integration was regular and rarely complicated</dt>
<dd>
<p>My team had agreed to follow XP practices, which encourage integration as often as <a href="https://oreil.ly/0A7P9">every few hours</a>. More important than a specific time interval was the amount of code requiring integration at any given point. When planning and breaking down actual development work, we focused our efforts on creating small, completable tasks, always beginning with the <a href="https://oreil.ly/Scb94">simplest thing that can possibly work</a>. By <em>completable</em>, I mean after the development task was complete, it could be integrated into the main code repository and the result would be expected to build successfully and pass all unit tests. This practice of organizing code updates in as small a package as possible made regular and frequent integration to the main source code repository a normal and unremarkable activity. Rarely was significant time spent on large integration efforts.</p>
</dd>
<dt>Build and test failures were relatively easy to troubleshoot</dt>
<dd>
<p>Because the project was built and<a data-type="indexterm" data-primary="testing" data-secondary="continuous integration" id="idm45310208975104"/> automated tests were run at regular intervals, it was readily apparent where to start troubleshooting any failures. A relatively small amount of code would have been touched since the latest successful build, and if the problem couldn’t immediately be identified and resolved, we would start with reverting the latest merge and work backward as needed to restore a clean build.</p>
</dd>
<dt>Bugs and compatibility issues introduced by integration and caught by the CI system were fixed immediately</dt>
<dd>
<p>The loud sound of the siren let <em>everyone</em> on the team know that a problem needed to be addressed, a problem that could not be ignored. Because our CI system halted progress whenever a build or test failure occurred, everyone was on board to figure out what was wrong and what to do to fix the problem. Team communication, coordination, and cooperation were all in top shape because no one would be able to move forward until the issue was resolved. A majority of the time, the offending code could be identified simply by analyzing the most recent merge, and the responsibility to fix was assigned to that developer or pair of developers. At times, a discussion with the entire team was necessary because of a compatibility issue around multiple recent merges, as changes in one part of the system negatively affected another seemingly unrelated part. These instances required our team to reevaluate the code changes being made holistically and then decide together the best plan of action.</p>
</dd>
</dl>

<p>These three factors were key to the success of our CI solution. You might have discerned that all three imply the prerequisites of a healthy codebase and a healthy development team. Without these, the initial implementation of a CI solution will undoubtedly be more difficult. However, implementing a CI solution will in turn have a positive impact on the codebase, and taking the first steps will provide a measure of benefit that will be well worth the effort.</p>

<p>It is true there is much more to an effective CI solution than simple coordination of code contribution to a shared repository and following a mandate to integrate at an agreed-upon frequency. The following sections will walk you through the essentials of a complete, practicable CI solution that will help unburden and accelerate the software development process.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Declaratively Script Your Build"><div class="sect1" id="declaratively_script_your_build">
<h1>Declaratively Script Your Build</h1>

<p>Regardless of the state of your project—whether it’s greenfield, legacy, a small individual library, or a large multimodule project—your<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="build script" id="ch04-script"/> first task in implementing a CI solution should be to <em>script your build</em>. Having a consistent and repeatable process that you can automate will help avoid the frustration of buggy build permutations due to the mismanagement of dependencies, forgetting to include needed resources when creating the distributable package, or unintentionally neglecting build steps, among other pitfalls.</p>

<p>You will reap a tremendous amount of time savings<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="build script" data-tertiary="build lifecycle" id="idm45310208967120"/> from scripting your build. Your project <em>build lifecycle</em> (all of the discrete steps required to build your project) can easily grow more complicated over time, especially as you consume more and more dependencies, include various resources, add modules, and add tests. You may also need to build your project differently depending on the intended deployment environment. For example, you might need to enable debugging capabilities in a development or QA environment, but disable debugging in a build intended for release to production as well as prevent test classes from being included in the distributable package. Manually performing all of the required steps involved in building a Java project, including consideration for configuration differences per environment, is a hotbed for human error. The first time you neglect a step like building an updated dependency and consequently must repeat a build of a huge multimodule project to correct your mistake, you will appreciate the value of a build script.</p>

<p>Whatever tool or framework you choose<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="build script" data-tertiary="declarative, not imperative" id="idm45310208964928"/> for scripting your build, take care to use a <em>declarative</em> approach rather than <em>imperative</em>. Here’s a quick reminder of the meaning of these terms:</p>
<dl>
<dt>Imperative</dt>
<dd>
<p>Defining an exact procedure with implementation details<a data-type="indexterm" data-primary="imperative approach" id="idm45310208961072"/></p>
</dd>
<dt>Declarative</dt>
<dd>
<p>Defining an action without implementation details<a data-type="indexterm" data-primary="declarative approach" id="idm45310208959024"/></p>
</dd>
</dl>

<p>In other words, keep your build script focused on <em>what</em> you need to do rather than <em>how</em> to do it. This will help keep your script understandable, maintainable, testable, and scalable by encouraging reuse on other projects or modules. To accomplish this, you may need to establish or conform to a known convention, or write plug-ins or other external code referenced from your build script that provides the implementation details. Some build tools are more apt to foster a declarative approach than others. This usually comes with the cost of conforming to a convention versus flexibility.</p>

<p>The Java ecosystem has several well-established build tools available, so I would be surprised if you are currently manually compiling your project with <code>javac</code> and packaging your class files into a JAR or other package type. You likely already have some sort of build process and script established, but in the unlikely scenario that you do not, you are starting a brand-new Java project, or you are looking to improve an existing script to utilize best practices, this section summarizes a few of the most common build tools/frameworks available in the Java ecosystem and what they provide you out of the box.</p>

<p>First, it is important to map out your build process, to determine what you need from your build script in order to gain the most benefit. <a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="build script" data-tertiary="specifications required" id="idm45310208955072"/>To build a Java project, at the bare minimum you need to specify the following:</p>
<dl>
<dt>Java version</dt>
<dd>
<p>The version of Java required to compile the project</p>
</dd>
<dt>Source directory path</dt>
<dd>
<p>The directory that includes all of the source code for the project</p>
</dd>
<dt>Destination directory path</dt>
<dd>
<p>The directory where compiled class files are expected to be placed</p>
</dd>
<dt>Names, locations, and versions of needed dependencies</dt>
<dd>
<p>The metadata necessary to locate and gather any dependencies required by your project</p>
</dd>
</dl>

<p>With this information, you should be able to execute a minimal build process with the following steps:</p>
<ol>
<li>
<p>Collect any needed dependencies.</p>
</li>
<li>
<p>Compile the code.</p>
</li>
<li>
<p>Run tests.</p>
</li>
<li>
<p>Package your application.</p>
</li>

</ol>

<p>The best way to show how to massage your build process into a build script is by example. The following examples demonstrate the use of three of the most common build tools to script the minimal build process described for a simple Hello World Java application. In no way do these examples explore all of the functionality available in these tools. They are simply meant as a crash course to help you either begin to understand your existing build script or write your first build script to benefit from a full CI solution.</p>

<p>In evaluating a build tool, bear in mind<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="build tools" data-tertiary="about evaluating" id="idm45310208941888"/><a data-type="indexterm" data-primary="build tools" data-secondary="continuous integration" data-tertiary="about evaluating" id="idm45310208940576"/> the actual process your project requires to complete a build. Your project may require scripting additional steps that are not shown here, and one build tool may be more suited than another to accomplish this. It is important that the tool you choose helps you programmatically define and accelerate the build process your project requires rather than arbitrarily force you to modify your process to fit the requirements of the tool. That said, when you learn the capabilities of a tool, reflect on your process and be mindful of changes that would benefit your team. This is most important with established projects. Changes to the process, however well-intentioned, can be painful for a development team. They should be made only intentionally, with a clear understanding of the reason for the change and, of course, a clear benefit.<a data-type="indexterm" data-startref="ch04-script" id="idm45310208939232"/></p>








<section data-type="sect2" data-pdf-bookmark="Build with Apache Ant"><div class="sect2" id="build_with_apache_ant">
<h2>Build with Apache Ant</h2>

<p><em>Apache Ant</em> is an open source project<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="build tools" data-tertiary="Apache Ant" id="ch05-Ant"/><a data-type="indexterm" data-primary="Apache Ant" id="ch05-Ant2"/><a data-type="indexterm" data-primary="build tools" data-secondary="continuous integration" data-tertiary="Apache Ant" id="ch05-Ant4"/> released under an Apache License by the Apache Software Foundation. <a data-type="indexterm" data-primary="Apache Ant" data-secondary="documentation" id="idm45310208932080"/><a data-type="indexterm" data-primary="Davidson, James Duncan" id="idm45310208931056"/>According to the <a href="https://ant.apache.org">Apache Ant documentation</a>, the name is an acronym for Another Neat Tool and was initially part of the Tomcat codebase, written by James Duncan Davidson for the purpose of building Tomcat. Its first initial release was in 2000.</p>

<p>Apache Ant is a build tool written in Java that provides a way to describe a build process as declarative steps within an XML file. This is the first build tool that I was exposed to in my Java career, and although Ant has heavy competition today, it is still an active project and widely used often in combination with other tools.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45310208929184">
<h5>Key Ant Terminology</h5>
<p>You will encounter the following terms when working with Apache Ant:<a data-type="indexterm" data-primary="Apache Ant" data-secondary="terminology" id="idm45310208927680"/></p>
<dl>
<dt>Ant task</dt>
<dd>
<p>A small unit of work, such as deleting a directory or copying a file. Under the covers, Ant tasks map to Java objects, which contain the implementation details for the task. Many built-in tasks are available in Ant as well as the ability to create custom tasks.</p>
</dd>
<dt>Ant target</dt>
<dd>
<p>Ant tasks are grouped into Ant targets. An Ant target is invoked by Ant directly. For example, for a target named <em>compile</em>, you would run the command <code>ant compile</code>. Ant targets can be configured to depend on each other in order to control the order of execution.</p>
</dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>Some Ant build files can grow to be quite large. In the same directory as <em>build.xml</em>, you can run the following command to get a list of available targets:</p>

<p><code>ant -projecthelp</code></p>
</div>
<dl>
<dt>Ant build file</dt>
<dd>
<p>An XML file used to configure all of the Ant tasks and targets utilized by a project. By default, this file is named <em>build.xml</em> and is found at the root of the project directory.<a data-type="indexterm" data-primary="Apache Ant" data-secondary="build files" id="ch05-antbld2"/></p>
</dd>
</dl>
</div></aside>

<p><a data-type="xref" href="#ant_build_script_example">Example 5-1</a> is a simple Ant build file I created and executed with Ant 1.10.8.</p>
<div id="ant_build_script_example" data-type="example">
<h5><span class="label">Example 5-1. </span>Ant build script (build.xml)</h5>

<pre data-type="programlisting" data-code-language="xml"><code class="nt">&lt;project</code><code> </code><code class="na">name=</code><code class="s">"my-app"</code><code> </code><code class="na">basedir=</code><code class="s">"."</code><code> </code><code class="na">default=</code><code class="s">"package"</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO1-1" href="#callout_continuous_integration_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>

    </code><code class="nt">&lt;property</code><code> </code><code class="na">name=</code><code class="s">"version"</code><code> </code><code class="na">value=</code><code class="s">"1.0-SNAPSHOT"</code><code class="nt">/&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO1-2" href="#callout_continuous_integration_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="nt">&lt;property</code><code> </code><code class="na">name=</code><code class="s">"finalName"</code><code> </code><code class="na">value=</code><code class="s">"${ant.project.name}-${version}"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;property</code><code> </code><code class="na">name=</code><code class="s">"src.dir"</code><code> </code><code class="na">value=</code><code class="s">"src/main/java"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;property</code><code> </code><code class="na">name=</code><code class="s">"build.dir"</code><code> </code><code class="na">value=</code><code class="s">"target"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;property</code><code> </code><code class="na">name=</code><code class="s">"output.dir"</code><code> </code><code class="na">value=</code><code class="s">"${build.dir}/classes"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;property</code><code> </code><code class="na">name=</code><code class="s">"test.src.dir"</code><code> </code><code class="na">value=</code><code class="s">"src/test/java"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;property</code><code> </code><code class="na">name=</code><code class="s">"test.output.dir"</code><code> </code><code class="na">value=</code><code class="s">"${build.dir}/test-classes"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;property</code><code> </code><code class="na">name=</code><code class="s">"lib.dir"</code><code> </code><code class="na">value=</code><code class="s">"lib"</code><code class="nt">/&gt;</code><code>

    </code><code class="nt">&lt;path</code><code> </code><code class="na">id=</code><code class="s">"classpath"</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO1-3" href="#callout_continuous_integration_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;fileset</code><code> </code><code class="na">dir=</code><code class="s">"${lib.dir}"</code><code> </code><code class="na">includes=</code><code class="s">"**/*.jar"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;/path&gt;</code><code>

    </code><code class="nt">&lt;target</code><code> </code><code class="na">name=</code><code class="s">"clean"</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;delete</code><code> </code><code class="na">dir=</code><code class="s">"${build.dir}"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;/target&gt;</code><code>

    </code><code class="nt">&lt;target</code><code> </code><code class="na">name=</code><code class="s">"compile"</code><code> </code><code class="na">depends=</code><code class="s">"clean"</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO1-4" href="#callout_continuous_integration_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;mkdir</code><code> </code><code class="na">dir=</code><code class="s">"${output.dir}"</code><code class="nt">/&gt;</code><code>
        </code><code class="nt">&lt;javac</code><code> </code><code class="na">srcdir=</code><code class="s">"${src.dir}"</code><code>
               </code><code class="na">destdir=</code><code class="s">"${output.dir}"</code><code>
               </code><code class="na">target=</code><code class="s">"11"</code><code> </code><code class="na">source=</code><code class="s">"11"</code><code>
               </code><code class="na">classpathref=</code><code class="s">"classpath"</code><code>
               </code><code class="na">includeantruntime=</code><code class="s">"false"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;/target&gt;</code><code>

    </code><code class="nt">&lt;target</code><code> </code><code class="na">name=</code><code class="s">"compile-test"</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;mkdir</code><code> </code><code class="na">dir=</code><code class="s">"${test.output.dir}"</code><code class="nt">/&gt;</code><code>
        </code><code class="nt">&lt;javac</code><code> </code><code class="na">srcdir=</code><code class="s">"${test.src.dir}"</code><code>
               </code><code class="na">destdir=</code><code class="s">"${test.output.dir}"</code><code>
               </code><code class="na">target=</code><code class="s">"11"</code><code> </code><code class="na">source=</code><code class="s">"11"</code><code>
               </code><code class="na">classpathref=</code><code class="s">"classpath"</code><code>
               </code><code class="na">includeantruntime=</code><code class="s">"false"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;/target&gt;</code><code>

    </code><code class="nt">&lt;target</code><code> </code><code class="na">name=</code><code class="s">"test"</code><code> </code><code class="na">depends=</code><code class="s">"compile-test"</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO1-5" href="#callout_continuous_integration_CO1-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;junit</code><code> </code><code class="na">printsummary=</code><code class="s">"yes"</code><code> </code><code class="na">fork=</code><code class="s">"true"</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;classpath</code><code class="nt">&gt;</code><code>
                </code><code class="nt">&lt;path</code><code> </code><code class="na">refid=</code><code class="s">"classpath"</code><code class="nt">/&gt;</code><code>
                </code><code class="nt">&lt;pathelement</code><code> </code><code class="na">location=</code><code class="s">"${output.dir}"</code><code class="nt">/&gt;</code><code>
                </code><code class="nt">&lt;pathelement</code><code> </code><code class="na">location=</code><code class="s">"${test.output.dir}"</code><code class="nt">/&gt;</code><code>
            </code><code class="nt">&lt;/classpath&gt;</code><code>

            </code><code class="nt">&lt;batchtest</code><code class="nt">&gt;</code><code>
                </code><code class="nt">&lt;fileset</code><code> </code><code class="na">dir=</code><code class="s">"${test.src.dir}"</code><code> </code><code class="na">includes=</code><code class="s">"**/*Test.java"</code><code class="nt">/&gt;</code><code>
            </code><code class="nt">&lt;/batchtest&gt;</code><code>
        </code><code class="nt">&lt;/junit&gt;</code><code>
    </code><code class="nt">&lt;/target&gt;</code><code>

    </code><code class="nt">&lt;target</code><code> </code><code class="na">name=</code><code class="s">"package"</code><code> </code><code class="na">depends=</code><code class="s">"compile,test"</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO1-6" href="#callout_continuous_integration_CO1-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
        </code><code class="nt">&lt;mkdir</code><code> </code><code class="na">dir=</code><code class="s">"${build.dir}"</code><code class="nt">/&gt;</code><code>
        </code><code class="nt">&lt;jar</code><code> </code><code class="na">jarfile=</code><code class="s">"${build.dir}/${finalName}.jar"</code><code>
              </code><code class="na">basedir=</code><code class="s">"${output.dir}"</code><code class="nt">/&gt;</code><code>
    </code><code class="nt">&lt;/target&gt;</code><code>

</code><code class="nt">&lt;/project&gt;</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_continuous_integration_CO1-1" href="#co_continuous_integration_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The value of the <code>default</code> attribute of the project can be set to the name of a default target to run when Ant is invoked without a target. For this project, the command <code>ant</code> without any arguments will run the <em>package</em> target.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO1-2" href="#co_continuous_integration_CO1-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Property elements are hardcoded, immutable values that may be used more than once in the rest of the build script. Using them helps with both readability and maintainability.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO1-3" href="#co_continuous_integration_CO1-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>This path element is how I chose to manage the location of needed dependencies for this project. In this case, both the <em>junit</em> and <em>hamcrest-core</em> JARs are manually placed in the directory configured here. This technique implies that dependencies would be checked into source control along with the project. Although it was simple to do for this example, this is not a recommended practice. <a data-type="xref" href="ch06.xhtml#package_management">Chapter 6</a> discusses package management in detail.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO1-4" href="#co_continuous_integration_CO1-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The <code>compile</code> target is responsible for the compilation of the source code (this project specifies Java 11) and placement of the resulting class files in the configured location. This target depends on the <em>clean</em> target, meaning the clean target will be run first, to ensure that compiled class files are fresh and not left over from an old build.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO1-5" href="#co_continuous_integration_CO1-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The <code>test</code> target configures the JUnit Ant task that will run all of the available unit tests and print the results to the screen.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO1-6" href="#co_continuous_integration_CO1-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>The <code>package</code> target will assemble and place a final JAR file in the configured location.</p></dd>
</dl>

<p>Executing the one-line command <code>ant package</code> will take our Java project, compile it, run unit tests, and then assemble a JAR file for us. Ant is flexible, rich in functionality, and satisfies our goal of scripting a minimal build. The XML configuration file is a clean, straightforward way of documenting the project’s build lifecycle. By itself, Ant is lacking in the way of dependency management. However, tools like <a href="https://oreil.ly/7t5v5">Apache Ivy</a> have been developed to extend this functionality to Ant.<a data-type="indexterm" data-startref="ch05-Ant" id="idm45310208659920"/><a data-type="indexterm" data-startref="ch05-Ant2" id="idm45310208659216"/><a data-type="indexterm" data-startref="ch05-Ant4" id="idm45310208658544"/><a data-type="indexterm" data-startref="ch05-antbld2" id="idm45310208657872"/></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Build with Apache Maven"><div class="sect2" id="build_with_apache_maven">
<h2>Build with Apache Maven</h2>

<p>According to the <a href="https://oreil.ly/CziRT">Apache Maven Project documentation</a>, <em>maven</em> is a<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="build tools" data-tertiary="Apache Maven" id="ch05-maven"/><a data-type="indexterm" data-primary="build tools" data-secondary="continuous integration" data-tertiary="Apache Maven" id="ch05-maven2"/><a data-type="indexterm" data-primary="Maven (Apache)" id="ch05-maven3"/><a data-type="indexterm" data-primary="Apache Maven" id="ch05-maven4"/><a data-type="indexterm" data-primary="Apache Maven" data-secondary="documentation online" id="idm45310208578624"/><a data-type="indexterm" data-primary="Maven (Apache)" data-secondary="documentation online" id="idm45310208577776"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="Apache Maven" data-tertiary="documentation" id="idm45310208576928"/> Yiddish word meaning <em>accumulator of knowledge</em>. Like Apache Ant, Maven is also an open source project of the Apache Software Foundation. It began as an improvement to the Jakarta turbine project build that was utilizing varied configurations of Ant for each subproject. Its first official release was in 2004.</p>

<p>Like Apache Ant, Maven uses an XML document, (a POM file) to describe and manage Java projects. This document records information about the project, including a unique identifier for the project, the required compiler version, configuration property values, and metadata on all required dependencies and their versions. One of the most powerful features of Maven is its dependency management and the ability to use repositories to share dependencies with other projects.</p>

<p>Maven relies heavily on convention in order to provide a uniform method of managing and documenting a project that can easily scale across all projects using Maven. A project is expected to be laid out on the filesystem in a specific way. To keep the script declarative, customized implementations require building custom plug-ins. Although it can be extensively customized to override expected defaults, Maven works out of the box with little configuration if you conform to the expected project structure.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45310208574288">
<h5>Key Maven Terminology</h5>
<p>You will encounter the following terms when working with Maven:<a data-type="indexterm" data-primary="Maven (Apache)" data-secondary="terminology" id="idm45310208573024"/><a data-type="indexterm" data-primary="Apache Maven" data-secondary="terminology" id="idm45310208572048"/></p>
<dl>
<dt>Lifecycle phase</dt>
<dd>
<p>A discrete step in a project’s build lifecycle. Maven defines a list of default phases that are executed sequentially during a build. The default phases are <em>validate</em>, <em>compile</em>, <em>test</em>, <em>package</em>, <em>verify</em>, <em>install</em>, and <em>deploy</em>. Two other Maven lifecycles consist of phases that handle cleaning and documentation for the project. Invoking Maven with a lifecycle phase will execute all of the lifecycle phases in order, up to and including the given lifecycle phase.</p>
</dd>
<dt>Maven goal</dt>
<dd>
<p>Handles the implementation details of the execution of a lifecycle phase. A goal can be configured to be associated with multiple lifecycle phases.</p>
</dd>
<dt>Maven plug-in</dt>
<dd>
<p>A collection of common Maven goals with a common purpose. Goals are provided by plug-ins to be executed in the lifecycle phase they are bound to.</p>
</dd>
<dt>POM file</dt>
<dd>
<p>The Maven <em>Project Object Model</em>, or POM, is<a data-type="indexterm" data-primary="Maven (Apache)" data-secondary="POM file" id="ch05-pom"/><a data-type="indexterm" data-primary="Apache Maven" data-secondary="POM file" id="ch05-pom2"/><a data-type="indexterm" data-primary="POM file (Apache Maven)" id="ch05-pom3"/> implemented as an XML configuration file that includes the configuration for all of the Maven lifecycle phases, goals, and plug-ins required for the project’s build lifecycle. The name of this file is <em>pom.xml</em> and is found at the root of a project. In multimodule projects, a POM file at the root of the project is potentially a <em>parent</em> POM that provides inherited configuration to POMs that specify the parent POM. All project POM files extend Maven’s <em>Super POM</em>, which is provided by the Maven installation itself and includes default configuration.</p>
</dd>
</dl>
</div></aside>

<p><a data-type="xref" href="#maven_pom_file_example">Example 5-2</a> is a simple POM file I configured for my Java 11 environment using Maven 3.6.3.</p>
<div id="maven_pom_file_example" data-type="example">
<h5><span class="label">Example 5-2. </span>Maven POM file (pom.xml)</h5>

<pre data-type="programlisting" data-code-language="xml"><code class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</code><code>

</code><code class="nt">&lt;project</code><code> </code><code class="na">xmlns=</code><code class="s">"http://maven.apache.org/POM/4.0.0"</code><code>
         </code><code class="na">xmlns:xsi=</code><code class="s">"http://www.w3.org/2001/XMLSchema-instance"</code><code>
         </code><code class="na">xsi:schemaLocation=</code><code>
            </code><code class="s">"http://maven.apache.org/POM/4.0.0
            http://maven.apache.org/xsd/maven-4.0.0.xsd"</code><code class="nt">&gt;</code><code>
  </code><code class="nt">&lt;modelVersion</code><code class="nt">&gt;</code><code>4.0.0</code><code class="nt">&lt;/modelVersion&gt;</code><code>

  </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>com.mycompany.app</code><code class="nt">&lt;/groupId&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO2-1" href="#callout_continuous_integration_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
  </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>my-app</code><code class="nt">&lt;/artifactId&gt;</code><code>
  </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>1.0-SNAPSHOT</code><code class="nt">&lt;/version&gt;</code><code>

  </code><code class="nt">&lt;name</code><code class="nt">&gt;</code><code>my-app</code><code class="nt">&lt;/name&gt;</code><code>
  </code><code class="cm">&lt;!-- FIXME change it to the project's website --&gt;</code><code>
  </code><code class="nt">&lt;url</code><code class="nt">&gt;</code><code>http://www.example.com</code><code class="nt">&lt;/url&gt;</code><code>

  </code><code class="nt">&lt;properties</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO2-2" href="#callout_continuous_integration_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
    </code><code class="nt">&lt;project.build.sourceEncoding</code><code class="nt">&gt;</code><code>UTF-8</code><code class="nt">&lt;/project.build.sourceEncoding&gt;</code><code>
    </code><code class="nt">&lt;maven.compiler.release</code><code class="nt">&gt;</code><code>11</code><code class="nt">&lt;/maven.compiler.release&gt;</code><code>
  </code><code class="nt">&lt;/properties&gt;</code><code>

  </code><code class="nt">&lt;dependencies</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO2-3" href="#callout_continuous_integration_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
    </code><code class="nt">&lt;dependency</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;groupId</code><code class="nt">&gt;</code><code>junit</code><code class="nt">&lt;/groupId&gt;</code><code>
      </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>junit</code><code class="nt">&lt;/artifactId&gt;</code><code>
      </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>4.11</code><code class="nt">&lt;/version&gt;</code><code>
      </code><code class="nt">&lt;scope</code><code class="nt">&gt;</code><code>test</code><code class="nt">&lt;/scope&gt;</code><code>
    </code><code class="nt">&lt;/dependency&gt;</code><code>
  </code><code class="nt">&lt;/dependencies&gt;</code><code>

  </code><code class="nt">&lt;build</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO2-4" href="#callout_continuous_integration_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
    </code><code class="nt">&lt;pluginManagement</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;plugins</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;plugin</code><code class="nt">&gt;</code><code> </code><a class="co" id="co_continuous_integration_CO2-5" href="#callout_continuous_integration_CO2-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
          </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>maven-compiler-plugin</code><code class="nt">&lt;/artifactId&gt;</code><code>
          </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>3.8.0</code><code class="nt">&lt;/version&gt;</code><code>
        </code><code class="nt">&lt;/plugin&gt;</code><code>
      </code><code class="nt">&lt;/plugins&gt;</code><code>
    </code><code class="nt">&lt;/pluginManagement&gt;</code><code>
  </code><code class="nt">&lt;/build&gt;</code><code>
</code><code class="nt">&lt;/project&gt;</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_continuous_integration_CO2-1" href="#co_continuous_integration_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Every project is uniquely identified by its configured <code>groupId</code>, <code>artifactId</code>, and <code>version</code>.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO2-2" href="#co_continuous_integration_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Properties are hardcoded values that can potentially be used in multiple places in the POM file. They can be either custom properties or built-in properties used by plug-ins or goals.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO2-3" href="#co_continuous_integration_CO2-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>In the <code>dependencies</code> block, all direct dependencies of the project are identified. This project relies on JUnit to run the unit tests, so the <em>junit</em> dependency is specified here. JUnit has a dependency itself on <em>hamcrest-core</em>, but Maven is smart enough to figure that out without having to include it here. By default, Maven will pull these dependencies from Maven Central.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO2-4" href="#co_continuous_integration_CO2-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The <code>build</code> block is where plug-ins are configured. Unless there is configuration you want to override, this block isn’t required.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO2-5" href="#co_continuous_integration_CO2-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Default plug-in bindings exist for all of the lifecycle phases, but in this case, I wanted to configure <code>maven-compiler-plugin</code> to use Java version 11 rather than the default. The property that controls this for the plug-in is <code>maven​.com⁠piler.release</code> in the <code>properties</code> block. This configuration could have been put in the <code>plugins</code> block, but it makes sense to move it to the <code>properties</code> block for better visibility toward the top of the file. This property replaces <code>maven.compiler.source</code> and <code>maven.compiler.target</code> that is usually seen when using older versions of Java.</p></dd>
</dl>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>It is a good idea to lock down all of your Maven plug-in versions to avoid using Maven defaults. Specifically, pay special attention to Maven instructions for configuring your build script when using older versions of Maven and Java versions 9 or greater. The default plug-in versions of your Maven installation might not be compatible with later versions of Java.</p>
</div>

<p>Because of the strong reliance on convention, this Maven build script is quite brief. With this small POM file, I am able to execute <code>mvn package</code> to compile, run tests, and assemble a JAR file, all utilizing default settings. If you spend any time with Maven, you will quickly realize that it is much more than just a build tool and is chock-full of powerful features. For someone new to Maven, its potential complexity can be overwhelming. Also, customization through creating a new Maven plug-in is <span class="keep-together">daunting</span> when the customization is minor. <a data-type="indexterm" data-primary="Maven (Apache)" data-secondary="documentation online" data-tertiary="Maven in 5 Minutes guide" id="idm45310208385120"/><a data-type="indexterm" data-primary="Apache Maven" data-secondary="documentation online" data-tertiary="Maven in 5 Minutes guide" id="idm45310208383904"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="Apache Maven" data-tertiary="Maven in 5 Minutes guide" id="idm45310208382672"/>At the time of this writing, the <a href="https://oreil.ly/CziRT">Apache Maven Project</a> documentation contains excellent resources, including a <a href="https://oreil.ly/dkxa6">Maven in 5 Minutes</a> guide. I highly recommend starting with these resources if you are unfamiliar with Maven.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Although the <a href="https://oreil.ly/DOg5K">Apache Maven Ant Plugin</a> is no longer maintained,<a data-type="indexterm" data-primary="Maven (Apache)" data-secondary="POM file" data-tertiary="Ant build file from" id="idm45310208378064"/><a data-type="indexterm" data-primary="Apache Maven" data-secondary="POM file" data-tertiary="Ant build file from" id="idm45310208376784"/><a data-type="indexterm" data-primary="Apache Ant" data-secondary="build files" data-tertiary="Maven POM file for" id="idm45310208375568"/><a data-type="indexterm" data-primary="POM file (Apache Maven)" data-secondary="Ant build file from" id="idm45310208374352"/> it is possible to generate an Ant build file from a Maven POM file. Doing this will help you appreciate everything you get out of the box with Maven’s convention and defaults! In the same directory as your <em>pom.xml</em> file, invoke the Maven plug-in with the command <code>mvn ant:ant</code>.<a data-type="indexterm" data-startref="ch05-pom" id="idm45310208372480"/><a data-type="indexterm" data-startref="ch05-pom2" id="idm45310208371744"/><a data-type="indexterm" data-startref="ch05-pom3" id="idm45310208371072"/><a data-type="indexterm" data-startref="ch05-maven" id="idm45310208370400"/><a data-type="indexterm" data-startref="ch05-maven2" id="idm45310208369728"/><a data-type="indexterm" data-startref="ch05-maven3" id="idm45310208369056"/><a data-type="indexterm" data-startref="ch05-maven4" id="idm45310208368384"/></p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Build with Gradle"><div class="sect2" id="build_with_gradle">
<h2>Build with Gradle</h2>

<p><em>Gradle</em> is an open source build tool<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="build tools" data-tertiary="Gradle" id="ch05-gradle"/><a data-type="indexterm" data-primary="Gradle" id="ch05-gradle2"/><a data-type="indexterm" data-primary="build tools" data-secondary="continuous integration" data-tertiary="Gradle" id="ch05-gradle3"/><a data-type="indexterm" data-primary="Dockter, Hans" id="idm45310208361440"/> under the Apache 2.0 license. Hans Dockter, the founder of Gradle,<a data-type="indexterm" data-primary="Gradle" data-secondary="Gradle Forums" id="idm45310208360640"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="Gradle" data-tertiary="forums" id="idm45310208359696"/> <a href="https://oreil.ly/1mEwy">explained in the Gradle Forums</a> that his original idea was to call the project Cradle with a <em>C</em>. He ultimately decided on the name Gradle with a <em>G</em> since it <a data-type="indexterm" data-primary="Apache Groovy" id="idm45310208356784"/>used Apache Groovy for the domain-specific language (DSL). Gradle 1.0 was released in 2012, so in comparison to Apache Ant and Apache Maven, Gradle is the new kid on the block.</p>

<p>One of the biggest differences between Gradle and Maven and Ant is that the Gradle build script is not XML based. Instead, Gradle build scripts can be written with either a Groovy or Kotlin DSL. Like Maven, Gradle also utilizes convention, but is more flexible compared to Maven. <a data-type="indexterm" data-primary="Gradle" data-secondary="documentation online" id="idm45310208355664"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="Gradle" data-tertiary="documentation" id="idm45310208354688"/>The <a href="https://oreil.ly/Vvhch">Gradle documentation</a> touts the flexibility of the tool and includes instructions on how to easily customize your build.</p>
<div data-type="tip"><h6>Tip</h6>
<p>Gradle has extensive online documentation on<a data-type="indexterm" data-primary="Gradle" data-secondary="migrating from Maven" id="idm45310208351536"/><a data-type="indexterm" data-primary="Maven (Apache)" data-secondary="migrating to Gradle" id="idm45310208350560"/><a data-type="indexterm" data-primary="Apache Maven" data-secondary="migrating to Gradle" id="idm45310208349616"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="Gradle" data-tertiary="migrating from Maven" id="idm45310208348672"/> <a href="https://oreil.ly/RqR1s">migrating Maven builds to Gradle</a>. You can generate a Gradle build file from an existing Maven POM.</p>
</div>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45310208346384">
<h5>Key Gradle Terminology</h5>
<p>You will encounter the following terms when working with Gradle:<a data-type="indexterm" data-primary="Gradle" data-secondary="terminology" id="idm45310208345008"/></p>
<dl>
<dt>Domain-specific language (DSL)</dt>
<dd>
<p>Gradle scripts use a DSL specific to Gradle.<a data-type="indexterm" data-primary="Gradle" data-secondary="build language reference online" id="idm45310208342064"/><a data-type="indexterm" data-primary="resources for learning" data-secondary="Gradle" data-tertiary="build language reference" id="idm45310208341024"/> With the Gradle DSL, you can write a Gradle script using either Kotlin or Groovy language features. The <a href="https://oreil.ly/Q6bQH">Gradle Build Language Reference</a> documents the Gradle DSL.</p>
</dd>
<dt>Gradle task</dt>
<dd>
<p>A discrete step in your build lifecycle that can include implementations of units of work like copying files, inputs that the implementation uses, and outputs that the implementation affects. Tasks can specify dependencies on other tasks to control the order of execution. Your project build will consist of multiple tasks that a Gradle build will configure and then execute in the appropriate order.</p>
</dd>
<dt>Gradle lifecycle tasks</dt>
<dd>
<p>Common tasks provided by Gradle’s Base plug-in, including <em>clean</em>, <em>check</em>, <em>assemble</em>, and <em>build</em>. Other plug-ins can apply the Base plug-in for access to these tasks.</p>
</dd>
<dt>Gradle plug-in</dt>
<dd>
<p>A collection of Gradle tasks and the mechanism for adding extensions to existing functionality, features, conventions, configuration, and other customizations to your build.</p>
</dd>
<dt>Gradle build phase</dt>
<dd>
<p>Gradle build phases are not to be confused with Maven phases. A Gradle build will move through three fixed build phases: <em>initialization</em>, <em>configuration</em>, and <em>execution</em>.</p>
</dd>
</dl>
</div></aside>

<p><a data-type="xref" href="#gradle_build_script_example">Example 5-3</a> is a<a data-type="indexterm" data-primary="Gradle" data-secondary="build file" id="idm45310208328976"/> simple Gradle build file that I generated from the content of <a data-type="xref" href="#maven_pom_file_example">Example 5-2</a> in the previous section.</p>
<div id="gradle_build_script_example" data-type="example">
<h5><span class="label">Example 5-3. </span>Gradle build script (build.gradle)</h5>

<pre data-type="programlisting" data-code-language="groovy"><code class="cm">/*
 * This file was generated by the Gradle 'init' task.
 */</code><code>
</code><code>
</code><code class="n">plugins</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">id</code><code> </code><code class="s1">'java'</code><code> </code><a class="co" id="co_continuous_integration_CO3-1" href="#callout_continuous_integration_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">id</code><code> </code><code class="s1">'maven-publish'</code><code>
</code><code class="o">}</code><code>
</code><code>
</code><code class="n">repositories</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_continuous_integration_CO3-2" href="#callout_continuous_integration_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">mavenLocal</code><code class="o">(</code><code class="o">)</code><code>
</code><code>    </code><code class="n">maven</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">url</code><code> </code><code class="o">=</code><code> </code><code class="n">uri</code><code class="o">(</code><code class="s1">'https://repo.maven.apache.org/maven2'</code><code class="o">)</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code><code>
</code><code>
</code><code class="n">dependencies</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">testImplementation</code><code> </code><code class="s1">'junit:junit:4.11'</code><code> </code><a class="co" id="co_continuous_integration_CO3-3" href="#callout_continuous_integration_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code class="o">}</code><code>
</code><code>
</code><code class="n">group</code><code> </code><code class="o">=</code><code> </code><code class="s1">'com.mycompany.app'</code><code>
</code><code class="n">version</code><code> </code><code class="o">=</code><code> </code><code class="s1">'1.0-SNAPSHOT'</code><code>
</code><code class="n">description</code><code> </code><code class="o">=</code><code> </code><code class="s1">'my-app'</code><code>
</code><code class="n">sourceCompatibility</code><code> </code><code class="o">=</code><code> </code><code class="s1">'11'</code><code> </code><a class="co" id="co_continuous_integration_CO3-4" href="#callout_continuous_integration_CO3-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>
</code><code class="n">publishing</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">publications</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">maven</code><code class="o">(</code><code class="n">MavenPublication</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="n">from</code><code class="o">(</code><code class="n">components</code><code class="o">.</code><code class="na">java</code><code class="o">)</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code><code>
</code><code>
</code><code class="n">tasks</code><code class="o">.</code><code class="na">withType</code><code class="o">(</code><code class="n">JavaCompile</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_continuous_integration_CO3-5" href="#callout_continuous_integration_CO3-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">options</code><code class="o">.</code><code class="na">encoding</code><code> </code><code class="o">=</code><code> </code><code class="s1">'UTF-8'</code><code>
</code><code class="o">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_continuous_integration_CO3-1" href="#co_continuous_integration_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Gradle plug-ins are applied by adding their <em>plug-in ID</em> to the <code>plugins</code> block. The <code>java</code> plug-in is a Gradle Core plug-in that provides compilation, testing, packaging, and other functionality for Java projects.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO3-2" href="#co_continuous_integration_CO3-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Repositories for dependencies are provided in the <code>repositories</code> block. Dependencies are resolved using these settings.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO3-3" href="#co_continuous_integration_CO3-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Gradle handles dependencies similarly to Maven. The JUnit dependency is required for our unit tests, so it is included in the <code>dependencies</code> block.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO3-4" href="#co_continuous_integration_CO3-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The <code>sourceCompatibility</code> configuration setting is provided by the <code>java</code> plug-in and maps to the <code>source</code> option of <code>javac</code>. There is also a <code>targetCompatibility</code> configuration setting. Its default value is the value of <code>sourceCompatibility</code>, so there was no reason to add it to the build script.</p></dd>
<dt><a class="co" id="callout_continuous_integration_CO3-5" href="#co_continuous_integration_CO3-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>The flexibility of Gradle allows me to add explicit encoding for the Java compiler. A task provided by the <code>java</code> plug-in, called <code>compileJava</code>, is of the type <code>Java​Com⁠piler</code>. This code block sets the encoding property on this compile task.</p></dd>
</dl>

<p>This Gradle build script allows me to compile, run tests, and assemble a JAR file for my project by executing the single command <code>gradle build</code>. Because Gradle builds are based on well-known conventions, build scripts contain only what is needed that differentiates the build, helping to keep them small and maintainable. This simple script shows how powerful and flexible Gradle can be, especially for Java projects that have a more complicated build process. In that case, the up-front investment required to understand the Gradle DSL for customization is well worth the time.</p>

<p>All three of these tools for building your Java project have their own strengths and weaknesses. Choose a tool based on the needs of your project, the experience of your team, and the flexibility required. Wrangling together a build script—however you choose to do it—and with whatever tool you choose to do it, will increase your efficiency by leaps and bounds. Building a Java project is a repetitive process consisting of numerous steps, ripe for human error, and marvelously suitable for automation. Reducing your project build to a single command saves ramp-up time for new developers, increases efficiency during development tasks in a local development environment, and paves the way for build automation, an integral component of an effective CI solution.<a data-type="indexterm" data-startref="ch05-gradle" id="idm45310208142304"/><a data-type="indexterm" data-startref="ch05-gradle2" id="idm45310208141568"/><a data-type="indexterm" data-startref="ch05-gradle3" id="idm45310208140896"/></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Continuously Build"><div class="sect1" id="continuosly_build">
<h1>Continuously Build</h1>

<p>The most telltale sign that code integration<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="continuously build" id="idm45310208138528"/><a data-type="indexterm" data-primary="build continuously" id="idm45310208137584"/> was unsuccessful is the failure of a build. Therefore, it stands to reason that a project should be built often in order to detect and resolve any issues as soon as possible. In fact, <em>every contribution to the mainline codebase should be expected to result in a build that compiles successfully and passes all unit tests</em>.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>When referring to building a project after code is merged into the mainline source code repository,<a data-type="indexterm" data-primary="collaboration" data-secondary="contributions versus commits or check-ins" id="idm45310208135024"/> I intentionally use the word <em>contribution</em> as opposed to <em>commit</em> or <em>check-in</em>. This is simply because your development team may have agreed to follow multiple development processes (all valid), and in some of these, a <em>contribution</em> to the mainline may be the merge of a branch or the merge of a pull request—both of which potentially consist of one or more commits.</p>
</div>

<p>The following is a typical developer workflow<a data-type="indexterm" data-primary="workflows" data-secondary="test-driven development" id="idm45310208131424"/><a data-type="indexterm" data-primary="testing" data-secondary="test-driven development workflow" id="idm45310208130416"/> using test-driven development:</p>
<ol>
<li>
<p>Check out the latest code from source control to a local workspace.</p>
</li>
<li>
<p>Build and run all tests for the project to ensure a clean start. (There should be a build script for this. Refer to <a data-type="xref" href="#declaratively_script_your_build">“Declaratively Script Your Build”</a>.)</p>
</li>
<li>
<p>Write the code and related unit tests for the new feature or bug fix.</p>
</li>
<li>
<p>Run the new unit tests to ensure that they pass.</p>
</li>
<li>
<p>Build and run <em>all</em> unit tests for the project to ensure that the new code doesn’t result in negative side effects when integrated with the existing code. (Again, use a build script for this.)</p>
</li>
<li>
<p>Commit the new code along with the new tests to the codebase.</p>
</li>

</ol>

<p>This process aims to prevent issues (including the introduction of bugs or loss of functionality) with integrating code before it leaves your local development workspace. However, problems can manifest during this workflow that will cause pain down the road. Some will be caused by the realities of human nature, and others arise because, regardless of how much effort is put into advanced planning, it is nearly impossible to prevent every potential incompatibility introduced by concurrent development. Do not misunderstand; I am <em>not</em> saying that this process is wrong and should be discarded altogether. Instead, this section explains how an automated CI implementation helps mitigate the problems that can arise during this workflow and bolster your efficiency and productivity as a developer.</p>

<p>It isn’t enough for a developer to successfully build a project in their own local environment. Even if every developer diligently abides by the agreed-upon process and commits code changes only after all tests pass, you shouldn’t rely on this alone. The simplest reason is that a developer might not have the latest changes from the mainline (an even more likely scenario when many developers are working in the same codebase). This could result in an incompatibility that isn’t discovered until after the code is merged.</p>

<p>Sometimes issues with tests might surface only when someone else attempts to do a build or run tests in their own local development environment. For example, more than once I’ve embarrassingly forgotten to commit a new file or resource that I’ve created to the codebase. This means that the next developer who collects these changes gets to suffer through the annoyance of having either the build or tests fail immediately. Another issue I’ve seen is code written in such a way that it works in only a specific environment or a specific OS.</p>

<p>We all have bad days, and these problems slip by us from time to time even in the most ideal circumstances. But rather than let broken builds spread through the team like a virus, strategies can be put in place to help to mitigate integration issues like this. The most common is using automatic build servers, or CI servers. These servers are shared by development teams responsible for performing full builds, including running tests, and reporting the result of the build after code changes have been committed.</p>

<p>Popular CI servers you might recognize include Jenkins, CircleCI, TeamCity, Bamboo, and GitLab. More options are coming on the scene like JFrog Pipelines, and some have more features and capabilities than others, but the primary objective is to establish a referee for the code changes coming in to the shared repository by building frequently and reporting when a problem occurs. Utilizing a CI server for the purpose of running builds automatically is the best way to ensure that builds are happening regularly, revealing any integrations issues early.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Automate Tests"><div class="sect1" id="automate_tests">
<h1>Automate Tests</h1>

<p>Outside of running individual tests<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="tests automated" id="idm45310208117760"/><a data-type="indexterm" data-primary="testing" data-secondary="automated tests" id="idm45310208116768"/> during development, most often within an IDE, a developer should have a quick method of running the full suite of automated tests prior to checking in new code to the codebase.</p>

<p>The minimal build process outlined in <a data-type="xref" href="#declaratively_script_your_build">“Declaratively Script Your Build”</a> includes a step for automatically running unit tests. Each build script example also includes this unit test step. This is no accident. In fact, this part of your build is absolutely essential for a healthy CI solution and is worthy of a decent amount of time and attention. One of the primary purposes of CI is having the ability to catch integration issues as early in the development process as possible.</p>

<p>Unit tests alone will not expose every single issue—that’s an unrealistic expectation. But writing a strong set of unit tests is one of the best proactive approaches to detecting the most obvious problems early on. Because unit tests can be run even prior to the first stages of formal quality assurance, they are an extremely valuable part of the development cycle. They are the first set of safety measures that you can take to ensure that your software will behave correctly in production.</p>

<p>This section does not go into specifics on how to write unit tests in Java. I assume that you understand and accept their importance, that your project has unit tests, and that you utilize a framework that facilitates automatically running them like JUnit or TestNG. If you do not, immediately stop and write a simple unit test for your project that can be automatically run during your build for the sake of having this step available to expand on in your CI solution. Then, schedule a time to sit down with your development team and strategize how you will write and maintain unit tests moving forward.</p>

<p>Numerous test tools are available in the Java ecosystem, and this section is not meant to be an exhaustive comparison or an endorsement of one over another. Instead, I discuss how test automation should fit into your CI process, the qualities of your test suite to strive for, and how to avoid common pitfalls in the context of CI that will eat away at your efficiency.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Monitor and Maintain Tests"><div class="sect1" id="monitor_and_maintain_tests">
<h1>Monitor and Maintain Tests</h1>

<p>Checking out the latest code to your local<a data-type="indexterm" data-primary="continuous integration (CI)" data-secondary="tests monitored and maintained" id="idm45310208110784"/><a data-type="indexterm" data-primary="testing" data-secondary="monitoring and maintaining tests" id="idm45310208109728"/> development workspace is pretty straightforward. Compiling and running all of the unit tests is straightforward as well. But as you add more modules, and your project becomes more complicated, doing a complete build and running all of the tests will begin to take more time. The longer your development process takes, the more likely that other code changes have been introduced to the mainline ahead of yours.</p>

<p>To prevent a potential break, you would have to check out the newest changes and run all of the tests again—not a very efficient process. Frustration can lead to developers taking shortcuts and skipping running the tests in an effort to commit code to the mainline before it is changed out from under them. Obviously, this is a slippery slope that is guaranteed to result in broken code in the mainline more often, slowing the entire team.</p>

<p>It takes time to maintain tests, and this time should be regularly built in to the development schedule. Just like the rest of your codebase, tests require improvements and adjustments over time. When they become obsolete, they should be removed. When they break, they should be fixed. Often when browsing through various codebases, I’ll come across test cases that are commented out. This happens for a few reasons; none of them good. Sometimes it’s simply because a team was short on time and felt the need to force through a build to meet a deadline, with the promise of revisiting the tests at a later time. Sometimes, it’s because a particular test case inconsistently fails, known as a <em>flaky</em> test. This could be due to a race condition or a dynamic value that the test erroneously expects to be static.</p>

<p>In either case, manipulating tests not to run is a dangerous business and indicates bigger problems afoot with the development team. A review of priorities is in order. Not addressing stale or brittle tests, or even worse, not writing them at all, removes the guardrails for your project and defeats the purpose of the CI process you have carefully put in place.</p>

<p>Sometimes tests are not run because it is determined they take too much time. Use your CI server to regularly record how long test runs take and determine your acceptable threshold. As your project grows and you see the amount of time for builds increase beyond your acceptable threshold, stop to review your tests. Look for obsolete tests, duplicates, and tests that could be run in parallel. Considering how often you expect your build server to run (potentially after every code change), every second counts.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm45310208105872">
<h1>Summary</h1>

<p>This chapter presented continuous integration as an essential practice for a development team. Tools have developed over time that have helped increase our efficiency in building software projects. Automatically triggering builds as well as automatically running tests has helped developers better concentrate on coding and catch errant code earlier in the development process. It is easy to take for granted and enjoy the effort saved by automation, but it is important to understand the details underneath, especially when it comes to your test suite. Don’t let poorly maintained tests take away the benefit of your continuous integration system.</p>
</div></section>







</div></section></div></body></html>