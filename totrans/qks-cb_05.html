<html><head></head><body><div id="sbo-rt-content"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. Programming Model"><div class="chapter" id="programming_model">
<h1><span class="label">Chapter 5. </span>Programming Model</h1>


<p><a data-type="indexterm" data-primary="programming model" data-secondary="about" id="idm45128526445992"/><a data-type="indexterm" data-primary="programming model" id="pro_ch"/>In this chapter, you’ll learn about topics related to the programming model of Quarkus.
Quarkus is unique in the programming model it follows.
Unlike some other frameworks, Quarkus allows you to mix and match both an imperative model, using CDI, and a reactive model, using SmallRye Mutiny.
<a data-type="xref" href="ch15.xhtml#working_with_a_reactive_programming_model_chapter">Chapter 15</a> is dedicated to using the reactive approach.
At times, you may find yourself needing both approaches, so it is good to know how to utilize each.</p>

<p>In this chapter, we’re focusing on the imperative model, so you’ll learn the 
<span class="keep-together">following:</span></p>

<ul>
<li>
<p>How to marshal/unmarshal JSON and XML documents</p>
</li>
<li>
<p>How to validate request parameters</p>
</li>
<li>
<p>How to use the CDI spec as a context and dependency injection solution</p>
</li>
<li>
<p>How to write tests for a Quarkus service</p>
</li>
</ul>






<section data-type="sect1" data-pdf-bookmark="5.1 Marshalling/Unmarshalling JSON"><div class="sect1" id="idm45128526477384">
<h1>5.1 Marshalling/Unmarshalling JSON</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128526476136">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="programming model" data-secondary="marshalling JSON" id="pro_ma"/><a data-type="indexterm" data-primary="programming model" data-secondary="unmarshalling JSON" id="pro_un"/><a data-type="indexterm" data-primary="JSON" id="json_ab"/><a data-type="indexterm" data-primary="marshalling" data-secondary="JSON" id="ma_json"/><a data-type="indexterm" data-primary="unmarshalling" data-secondary="JSON" id="un_json"/>You want to marshall/unmarshall JSON documents to/from Java objects.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128526427640">
<h2>Solution</h2>

<p>Use the <code>JSON-B</code> specification or Jackson project to marshall and unmarshall JSON documents from/to Java objects.</p>

<p>When you are creating a REST API, you <em>usually</em> use JSON as a data format 
<span class="keep-together">to exchange</span> information.
So far, you’ve seen examples of returning only simple 
<span class="keep-together">plain-text</span> responses; but in this recipe, you’ll learn how to start using JSON as the data 
<span class="keep-together">format</span> for the body of the request and as a response.</p>

<p><a data-type="indexterm" data-primary="JSON-B (Jakarta JSON Binding)" data-secondary="extension" id="idm45128526422680"/>The first thing you need to do is register the <em>JSON-B</em> extension in the <em>pom.xml</em>. Open a terminal window, and from the root directory of the project run the following:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="quarkus-resteasy-jsonb"</code>

<code class="go">[INFO] --- quarkus-maven-plugin:1.4.1.Final:add-extension (default-cli)</code>
<code class="go">     @ custom-config ---</code>
<code class="go">✅ Adding extension io.quarkus:quarkus-resteasy-jsonb</code></pre>

<p>This effectively adds <code>io.quarkus:quarkus-resteasy-jsonb</code> into the build tool.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In Gradle, you can use <code>./gradlew addExtension</code> 
<span class="keep-together"><code>--extensions="quarkus-resteasy-jsonb"</code></span> to add the extension.</p>
</div>

<p><a data-type="indexterm" data-primary="developer class" id="idm45128526417176"/>The next step is to create a <code>developer</code> class that will be marshalled and unmarshalled in the endpoint. Create a new class named <code>org.acme.quickstart.Developer.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kd">public</code> <code class="kd">class</code> <code class="nc">Developer</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="n">String</code> <code class="n">name</code><code class="o">;</code>
    <code class="kd">private</code> <code class="n">String</code> <code class="n">favoriteLanguage</code><code class="o">;</code>
    <code class="kd">private</code> <code class="kt">int</code> <code class="n">age</code><code class="o">;</code>

    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getName</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">name</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setName</code><code class="o">(</code><code class="n">String</code> <code class="n">name</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">name</code> <code class="o">=</code> <code class="n">name</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getFavoriteLanguage</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">favoriteLanguage</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setFavoriteLanguage</code><code class="o">(</code><code class="n">String</code> <code class="n">favoriteLanguage</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">favoriteLanguage</code> <code class="o">=</code> <code class="n">favoriteLanguage</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">int</code> <code class="nf">getAge</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">age</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">setAge</code><code class="o">(</code><code class="kt">int</code> <code class="n">age</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">this</code><code class="o">.</code><code class="na">age</code> <code class="o">=</code> <code class="n">age</code><code class="o">;</code>
    <code class="o">}</code>

<code class="o">}</code></pre>

<p><a data-type="indexterm" data-primary="endpoints" data-secondary="creating" id="idm45128526412456"/>Finally, you can create a Rest API endpoint for implementing <code>developer</code> operations. Create a new class named <code>org.acme.quickstart.DeveloperResource.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.util.ArrayList</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.List</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.ws.rs.Consumes</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.GET</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.POST</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.Path</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.Produces</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.core.Response</code><code class="o">;</code>

<code class="nd">@Path</code><code class="o">(</code><code class="s">"/developer"</code><code class="o">)</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">DeveloperResource</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Developer</code><code class="o">&gt;</code> <code class="n">developers</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>

    <code class="nd">@POST</code>
    <code class="nd">@Consumes</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">Response</code> <code class="nf">addDeveloper</code><code class="o">(</code><code class="n">Developer</code> <code class="n">developer</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">developers</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">developer</code><code class="o">);</code>
        <code class="k">return</code> <code class="n">Response</code><code class="o">.</code><code class="na">ok</code><code class="o">().</code><code class="na">build</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="nd">@GET</code>
    <code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Developer</code><code class="o">&gt;</code> <code class="nf">getDevelopers</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">developers</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>Try it by opening a new terminal window, starting the Quarkus application, and sending requests for <code>POST</code> and <code>GET</code> methods:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile quarkus:dev</code>

<code class="go">curl -d '{"name":"Alex","age":39, "favoriteLanguage":"java"}' \</code>
<code class="go">  -H "Content-Type: application/json" -X POST http://localhost:8080/developer</code>

<code class="go">curl localhost:8080/developer</code>
<code class="go">[{"age":39,"favoriteLanguage":"java","name":"Alex"}]</code></pre>

<p>Notice that each Java field is mapped directly to a JSON field.
If you want to change that, you can use the <code>javax.json.bind.annotation.JsonbProperty</code> annotation to set a different mapping name:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@JsonbProperty</code><code class="o">(</code><code class="s">"favorite-language"</code><code class="o">)</code>
<code class="n">String</code> <code class="n">favoriteLanguage</code><code class="o">;</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128526427144">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="Jackson" id="idm45128526128536"/><a data-type="indexterm" data-primary="Jackson-Extension" id="idm45128526127832"/>You can use the Jackson project to marshall/unmarshall JSON documents to/from Java objects instead of JSON-B as well.
You need to register the <code>Jackson-Extension</code> to use it as a JSON solution:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="quarkus-resteasy-jackson"</code></pre>

<p>By default, a <code>com.fasterxml.jackson.databind.ObjectMapper</code> is provided, but you can provide a custom <code>ObjectMapper</code> using CDI:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">com.fasterxml.jackson.databind.ObjectMapper</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">io.quarkus.jackson.ObjectMapperCustomizer</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.inject.Singleton</code><code class="o">;</code>

<code class="nd">@Singleton</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">RegisterCustomModuleCustomizer</code>
    <code class="kd">implements</code> <code class="n">ObjectMapperCustomizer</code> <code class="o">{</code>

    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">customize</code><code class="o">(</code><code class="n">ObjectMapper</code> <code class="n">mapper</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">objectMapper</code><code class="o">.</code><code class="na">configure</code><code class="o">(</code>
            <code class="n">DeserializationFeature</code><code class="o">.</code><code class="na">FAIL_ON_NULL_FOR_PRIMITIVES</code><code class="o">,</code> <code class="kc">false</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128526122056">
<h2>See Also</h2>

<p>You can learn more about JSON-B and Jackson at the following web pages<a data-type="indexterm" data-primary="JSON-B (Jakarta JSON Binding)" data-secondary="website" id="idm45128525964264"/><a data-type="indexterm" data-primary="" data-startref="pro_ma" id="idm45128525963352"/><a data-type="indexterm" data-primary="" data-startref="pro_un" id="idm45128525962408"/><a data-type="indexterm" data-primary="" data-startref="json_ab" id="idm45128525961464"/><a data-type="indexterm" data-primary="" data-startref="ma_json" id="idm45128525960520"/><a data-type="indexterm" data-primary="" data-startref="un_json" id="idm45128525959576"/>:</p>

<ul>
<li>
<p><a href="http://json-b.net">Jakarta JSON Binding (JSON-B)</a></p>
</li>
<li>
<p><a href="https://oreil.ly/U3hwH">Jackson Project Home @GitHub</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.2 Marshalling/Unmarshalling XML"><div class="sect1" id="idm45128525955240">
<h1>5.2 Marshalling/Unmarshalling XML</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128525954024">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="XML, marshalling/unmarshalling" id="idm45128525952824"/><a data-type="indexterm" data-primary="programming model" data-secondary="marshalling XML" id="idm45128525952104"/><a data-type="indexterm" data-primary="programming model" data-secondary="unmarshalling XML" id="idm45128525951160"/><a data-type="indexterm" data-primary="marshalling" data-secondary="XML" id="idm45128525950216"/><a data-type="indexterm" data-primary="unmarshalling" data-secondary="XML" id="idm45128525949272"/>You want to marshall/unmarshall XML documents to/from Java objects.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128525947944">
<h2>Solution</h2>

<p>Use the JAX-B specification to marshall and unmarshall XML documents from/to Java objects.</p>

<p>When you are creating a REST API, you might want to use XML as a data format to exchange information.
So far, you’ve seen how to do it in JSON format, but in this section, you’ll learn how to start using XML as the data format for the body of the request and as a response.</p>

<p>The first thing you need to do is register the JAX-B extension in the <em>pom.xml</em>. Open a terminal window, and from the root directory of the project run the following:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="quarkus-resteasy-jaxb"</code>

<code class="go">[INFO] --- quarkus-maven-plugin:1.4.1.Final:add-extension (default-cli)</code>
<code class="go">    @ custom-config ---</code>
<code class="go">✅ Adding extension io.quarkus:quarkus-resteasy-jaxb</code></pre>

<p>This effectively adds <code>io.quarkus:quarkus-resteasy-jaxb</code> into the build tool.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In Gradle, you can use <code>./gradlew addExtension</code> 
<span class="keep-together"><code>--extensions="quarkus-resteasy-jaxb"</code></span> to add the extension.</p>
</div>

<p><a data-type="indexterm" data-primary="computer class" id="idm45128525938968"/>The next step is to create a <code>computer</code> class that will be marshalled and unmarshalled in the endpoint. Create a new class named <code>org.acme.quickstart.Computer.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.xml.bind.annotation.XmlRootElement</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@XmlRootElement</code><code> </code><a class="co" id="co_programming_model_CO1-1" href="#callout_programming_model_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">Computer</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">brand</code><code class="o">;</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">serialNumber</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getBrand</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">brand</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setBrand</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">brand</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">brand</code><code> </code><code class="o">=</code><code> </code><code class="n">brand</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getSerialNumber</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">serialNumber</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">setSerialNumber</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">serialNumber</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">serialNumber</code><code> </code><code class="o">=</code><code> </code><code class="n">serialNumber</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO1-1" href="#co_programming_model_CO1-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>XmlRootElement</code> sets this as XML document</p></dd>
</dl>

<p><a data-type="indexterm" data-primary="endpoints" data-secondary="creating REST API" id="idm45128525716712"/><a data-type="indexterm" data-primary="REST APIs" data-secondary="creating endpoints" id="idm45128525715976"/>Finally, you can create a REST API endpoint for implementing <code>computer</code> operations. Create a new class named <code>org.acme.quickstart.ComputerResource.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.util.ArrayList</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.List</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.ws.rs.Consumes</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.GET</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.POST</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.Path</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.Produces</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.ws.rs.core.Response</code><code class="o">;</code>

<code class="nd">@Path</code><code class="o">(</code><code class="s">"/computer"</code><code class="o">)</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">ComputerResource</code> <code class="o">{</code>

    <code class="kd">private</code> <code class="kd">static</code> <code class="kd">final</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Computer</code><code class="o">&gt;</code> <code class="n">computers</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>

    <code class="nd">@POST</code>
    <code class="nd">@Consumes</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_XML</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">Response</code> <code class="nf">addComputer</code><code class="o">(</code><code class="n">Computer</code> <code class="n">computer</code><code class="o">)</code> <code class="o">{</code>
        <code class="n">computers</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">computer</code><code class="o">);</code>
        <code class="k">return</code> <code class="n">Response</code><code class="o">.</code><code class="na">ok</code><code class="o">().</code><code class="na">build</code><code class="o">();</code>
    <code class="o">}</code>

    <code class="nd">@GET</code>
    <code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_XML</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Computer</code><code class="o">&gt;</code> <code class="nf">getComputers</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">computers</code><code class="o">;</code>
    <code class="o">}</code>

<code class="o">}</code></pre>

<p><a data-type="indexterm" data-primary="GET method" id="idm45128525801720"/><a data-type="indexterm" data-primary="POST method" id="idm45128525801112"/>Try it by opening a new terminal window, starting the Quarkus application, and sending requests for <code>POST</code> and <code>GET</code> methods:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile quarkus:dev</code>

<code class="go">curl \</code>
<code class="go">    -d '&lt;computer&gt;&lt;brand&gt;iMac&lt;/brand&gt;</code>
<code class="go">        &lt;serialNumber&gt;111-111-111&lt;/serialNumber&gt;&lt;/computer&gt;'</code>
<code class="go">    -H "Content-Type: application/xml" -X POST http://localhost:8080/computer</code>

<code class="go">curl localhost:8080/computer</code>
<code class="go">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;&lt;collection&gt;&lt;computer&gt;</code>
<code class="go">&lt;brand&gt;iMac&lt;/brand&gt;&lt;serialNumber&gt;111-111-111&lt;/serialNumber&gt;</code>
<code class="go">&lt;/computer&gt;&lt;/collection&gt;</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128525947480">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="@XmlAttribute" id="idm45128525613176"/><a data-type="indexterm" data-primary="@XmlElement" id="idm45128525612472"/><a data-type="indexterm" data-primary="@XmlRootElement" id="idm45128525611800"/><a data-type="indexterm" data-primary="@XmlTransient" id="idm45128525611128"/><a data-type="indexterm" data-primary="@XmlType" id="idm45128525610456"/>Apart from <code>@XmlRootElement</code>, there are other important annotations in the JAX-B spec:</p>
<dl>
<dt><code>@XmlRootElement</code></dt>
<dd>
<p>Sets the root XML document. You can also use it to set the name of the element or the namespace.</p>
</dd>
<dt><code>@XmlType</code></dt>
<dd>
<p>Defines the order in which the fields are written.</p>
</dd>
<dt><code>@XmlElement</code></dt>
<dd>
<p>Defines the actual XML element name among other attributes like <code>namespace</code>, <code>nillable</code>, or <code>required</code>.</p>
</dd>
<dt><code>@XmlAttribute</code></dt>
<dd>
<p>Defines the field to be mapped as an attribute instead of as an element.</p>
</dd>
<dt><code>@XmlTransient</code></dt>
<dd>
<p>Indicates fields not to be included in XML.</p>
</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128525593768">
<h2>See Also</h2>

<p>You can learn more about JAX-B at the following web page:</p>

<ul>
<li>
<p><a href="https://oreil.ly/r9FKb">Oracle: Lesson: Introduction to JAXB (The Java Tutorials)</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.3 Validating Input and Output Values"><div class="sect1" id="idm45128525581816">
<h1>5.3 Validating Input and Output Values</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128525580600">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="input values, validating" id="in_val"/><a data-type="indexterm" data-primary="output values, validating" id="out_val"/><a data-type="indexterm" data-primary="programming model" data-secondary="validating input and output values" id="pm_val"/><a data-type="indexterm" data-primary="validating" data-secondary="input/output values" id="val_io"/>You want to validate the input and output values of your REST and business services.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128525574616">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="Bean Validation" data-secondary="about" id="idm45128525573048"/>Use the Bean Validation specification to add validations to your model.</p>

<p>Usually, your model might contain some constraints, whether or not the model is semantically valid—for example, that a <code>name</code> is not null, or an <code>email</code> is a valid email. Quarkus integrates with Bean Validation to express constraints on object models via annotations.</p>

<p><a data-type="indexterm" data-primary="Bean Validation" data-secondary="extension" id="idm45128525570136"/>The first thing you need to do is register the Bean Validation extension in the <em>pom.xml</em>. Open a terminal window, and from the root directory of the project run the following:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw quarkus:add-extension -Dextensions="quarkus-hibernate-validator"</code>

<code class="go">[INFO] --- quarkus-maven-plugin:1.4.1.Final:add-extension (default-cli)</code>
<code class="go">     @ custom-config ---</code>
<code class="go">✅ Adding extension io.quarkus:quarkus-resteasy-jsonb</code></pre>

<p>This effectively adds <code>io.quarkus:quarkus-hibernate-validator</code> into the build tool.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In Gradle, you can use <code>./gradlew addExtension</code> 
<span class="keep-together"><code>--extensions="quarkus-hibernate-validator"</code></span> to add the 
<span class="keep-together">extension.</span></p>
</div>

<p><a data-type="indexterm" data-primary="developer class" id="idm45128525541272"/>The next step is to update the <code>developer</code> class and annotate it with some constraints. Open the <code>org.acme.quickstart.Developer.java</code> class and annotate some of the fields:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Size</code><code class="o">(</code><code class="n">min</code><code> </code><code class="o">=</code><code> </code><code class="mi">4</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO2-1" href="#callout_programming_model_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">name</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@NotBlank</code><code> </code><a class="co" id="co_programming_model_CO2-2" href="#callout_programming_model_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="kd">private</code><code> </code><code class="n">String</code><code> </code><code class="n">favoriteLanguage</code><code class="o">;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO2-1" href="#co_programming_model_CO2-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The minimum size of the string is 4</p></dd>
<dt><a class="co" id="callout_programming_model_CO2-2" href="#co_programming_model_CO2-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The field is mandatory</p></dd>
</dl>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p><a data-type="indexterm" data-primary="javax packages" id="idm45128525480520"/>Either of the available packages is sufficient, but if you want to use only the spec APIs, use the <code>javax</code> packages.</p>
</div>

<p>Finally, you need to annotate with <code>javax.validation.Valid</code> that a parameter must be verified.
Open the <code>org.acme.quickstart.DeveloperResource.java</code> class and annotate the <code>developer</code> parameter:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@POST</code><code>
</code><code class="nd">@Consumes</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">Response</code><code> </code><code class="nf">addDeveloper</code><code class="o">(</code><code class="nd">@Valid</code><code> </code><code class="n">Developer</code><code> </code><code class="n">developer</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO3-1" href="#callout_programming_model_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">developers</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">developer</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">Response</code><code class="o">.</code><code class="na">ok</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO3-1" href="#co_programming_model_CO3-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>@Valid</code> is mandatory to validate the object</p></dd>
</dl>

<p>Try it by opening a new terminal window, starting the Quarkus application, and executing requests for the POST method:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile quarkus:dev</code>

<code class="go">curl -d '{"name":"Ada","age":7, "favoriteLanguage":"java"}' \</code>
<code class="go">     -H "Content-Type: application/json" \</code>
<code class="go">     -X POST http://localhost:8080/developer -v</code>

<code class="go">&lt; HTTP/1.1 400 Bad Request</code>
<code class="go">&lt; Content-Length: 89</code>
<code class="go">&lt; validation-exception: true</code>
<code class="go">&lt; Content-Type: text/plain;charset=UTF-8</code>

<code class="go">curl -d '{"name":"Alexandra","age":5, "favoriteLanguage":"java"}' \</code>
<code class="go">     -H "Content-Type: application/json" \</code>
<code class="go">     -X POST http://localhost:8080/developer -v</code>

<code class="go">&lt; HTTP/1.1 200 OK</code>
<code class="go">&lt; Content-Length: 0</code></pre>

<p>It is important to note that in the first request, the name has an incorrect size, hence a 400 Bad Request HTTP code is returned.
In the second request, because the request body is correct, the method works as expected.</p>

<p>But notice that if there is an error, the response does not contain any information about what has failed.
That’s fine because it is important to show the internals not directly, but in a controlled way.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128525574024">
<h2>Discussion</h2>

<p>If you want to provide a better response message, you can provide an implementation of <code>ExceptionMapper</code>.</p>

<p>Create a new class named <code>org.acme.quickstart.BeanValidationExceptionMapper.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.json.Json</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.json.JsonArray</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.json.JsonArrayBuilder</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.ConstraintViolation</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.ConstraintViolationException</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.Response</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.ext.ExceptionMapper</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.ext.Provider</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Provider</code><code> </code><a class="co" id="co_programming_model_CO4-1" href="#callout_programming_model_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">BeanValidationExceptionMapper</code><code>
</code><code>  </code><code class="kd">implements</code><code> </code><code class="n">ExceptionMapper</code><code class="o">&lt;</code><code class="n">ConstraintViolationException</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO4-2" href="#callout_programming_model_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">Response</code><code> </code><code class="nf">toResponse</code><code class="o">(</code><code class="n">ConstraintViolationException</code><code> </code><code class="n">exception</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>      </code><code class="k">return</code><code> </code><code class="n">Response</code><code class="o">.</code><code class="na">status</code><code class="o">(</code><code class="n">Response</code><code class="o">.</code><code class="na">Status</code><code class="o">.</code><code class="na">BAD_REQUEST</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">entity</code><code class="o">(</code><code class="n">createErrorMessage</code><code class="o">(</code><code class="n">exception</code><code class="o">)</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">type</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">JsonArray</code><code> </code><code class="nf">createErrorMessage</code><code class="o">(</code><code class="n">ConstraintViolationException</code><code> </code><code class="n">exc</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>      </code><code class="n">JsonArrayBuilder</code><code> </code><code class="n">errors</code><code> </code><code class="o">=</code><code> </code><code class="n">Json</code><code class="o">.</code><code class="na">createArrayBuilder</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO4-3" href="#callout_programming_model_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>      </code><code class="k">for</code><code> </code><code class="o">(</code><code class="n">ConstraintViolation</code><code class="o">&lt;</code><code class="o">?</code><code class="o">&gt;</code><code> </code><code class="n">violation</code><code> </code><code class="o">:</code><code> </code><code class="n">exc</code><code class="o">.</code><code class="na">getConstraintViolations</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO4-4" href="#callout_programming_model_CO4-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">errors</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code>
</code><code>            </code><code class="n">Json</code><code class="o">.</code><code class="na">createObjectBuilder</code><code class="o">(</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO4-5" href="#callout_programming_model_CO4-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>            </code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="s">"path"</code><code class="o">,</code><code> </code><code class="n">violation</code><code class="o">.</code><code class="na">getPropertyPath</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code>
</code><code>            </code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="s">"message"</code><code class="o">,</code><code> </code><code class="n">violation</code><code class="o">.</code><code class="na">getMessage</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code>
</code><code>            </code><code class="o">)</code><code class="o">;</code><code>
</code><code>      </code><code class="o">}</code><code>
</code><code>      </code><code class="k">return</code><code> </code><code class="n">errors</code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO4-1" href="#co_programming_model_CO4-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>@Provider</code> set an implementation of an extension interface discoverable by the 
<span class="keep-together">JAX-RS</span> runtime</p></dd>
<dt><a class="co" id="callout_programming_model_CO4-2" href="#co_programming_model_CO4-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>javax.ws.rs.ext.ExceptionMapper</code> is used to transform an exception into a <code>javax.ws.rs.core.Response</code></p></dd>
<dt><a class="co" id="callout_programming_model_CO4-3" href="#co_programming_model_CO4-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Creates an array of constraint violations</p></dd>
<dt><a class="co" id="callout_programming_model_CO4-4" href="#co_programming_model_CO4-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Iterates over each of the constraint violations</p></dd>
<dt><a class="co" id="callout_programming_model_CO4-5" href="#co_programming_model_CO4-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Creates a JSON object</p></dd>
</dl>

<p>Now you can send a request for the POST method again:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">curl -d '{"name":"Ada","age":7, "favoriteLanguage":"java"}' \</code>
<code class="go">     -H "Content-Type: application/json" \</code>
<code class="go">     -X POST http://localhost:8080/developer -v</code>

<code class="go">&lt; HTTP/1.1 400 Bad Request</code>
<code class="go">&lt; Content-Length: 90</code>
<code class="go">&lt; Content-Type: application/json</code>

<code class="go">[{"path":"addDeveloper.developer.name",</code>
<code class="go">  "message":"size must be between 4 and 2147483647"}]%</code></pre>

<p>The output is now slightly different.
The error code is still the same, a 400 Bad Request, but now the body content of the response contains the JSON document that we created in the exception mapper.</p>

<p>You can also validate the output parameters (the parameters you send back to the caller) by adding <code>@Valid</code> annotation in the return type:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@GET</code>
<code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code>
<code class="kd">public</code> <code class="nd">@Valid</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Developer</code><code class="o">&gt;</code> <code class="n">getDevelopers</code><code class="o">()</code> <code class="o">{</code>
    <code class="k">return</code> <code class="n">developers</code><code class="o">;</code>
<code class="o">}</code></pre>

<p>Moreover, sometimes you don’t want to add validation rules at the endpoint but at the business service layer.
Bean Validation can be used in your business service if you’re using CDI.
See the following example:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@ApplicationScoped</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">DeveloperService</code> <code class="o">{</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">promoteDeveloper</code><code class="o">(</code><code class="nd">@Valid</code> <code class="n">Developer</code> <code class="n">developer</code><code class="o">)</code> <code class="o">{</code>
    <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128524994040">
<h2>See Also</h2>

<p><a data-type="indexterm" data-primary="" data-startref="in_val" id="idm45128524999752"/><a data-type="indexterm" data-primary="" data-startref="out_val" id="idm45128524998616"/><a data-type="indexterm" data-primary="" data-startref="pm_val" id="idm45128524997672"/><a data-type="indexterm" data-primary="" data-startref="val_io" id="idm45128524969928"/>If you want to learn more about Bean Validations and what constraints are implemented by default (i.e., <code>@Min</code>, <code>@Max</code>, <code>@AssertTrue</code>, <code>@Email</code>, and so on), you can find the information at the following website:</p>

<ul>
<li>
<p><a href="https://oreil.ly/YHR_X">Jakarta Bean Validation</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.4 Creating Custom Validations"><div class="sect1" id="idm45128524965128">
<h1>5.4 Creating Custom Validations</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128524963880">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="custom validations" id="idm45128524962680"/><a data-type="indexterm" data-primary="programming model" data-secondary="creating custom validations" id="idm45128524961976"/>You want to create custom validations.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128524960680">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="Bean Validation" data-secondary="extension" id="idm45128524959112"/>Use the Bean Validation extension model by implementing the <code>javax.validation.ConstraintValidator</code> interface.</p>

<p>Sometimes the default constraints provided by the Bean Validation specification are not enough, and you will want to implement constraints that more closely align with your business model.
Bean Validation allows you to do that by creating a class that implements the <code>javax.validation.ConstraintValidator</code> interface and the annotation for annotating the field to be validated.</p>

<p>Let’s validate that your favorite language can only be a JVM-based language.
First of all, you need to create the annotation.
Create a new class named <code>org.acme.quickstart.JvmLanguage.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.Documented</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.ElementType</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.Retention</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.RetentionPolicy</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.Target</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.Constraint</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.Payload</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Target</code><code class="o">(</code><code class="o">{</code><code> </code><code class="n">ElementType</code><code class="o">.</code><code class="na">METHOD</code><code class="o">,</code><code> </code><code class="n">ElementType</code><code class="o">.</code><code class="na">FIELD</code><code class="o">,</code><code> </code><code class="n">ElementType</code><code class="o">.</code><code class="na">ANNOTATION_TYPE</code><code class="o">,</code><code>
</code><code>          </code><code class="n">ElementType</code><code class="o">.</code><code class="na">CONSTRUCTOR</code><code class="o">,</code><code> </code><code class="n">ElementType</code><code class="o">.</code><code class="na">PARAMETER</code><code class="o">,</code><code> </code><code class="n">ElementType</code><code class="o">.</code><code class="na">TYPE_USE</code><code> </code><code class="o">}</code><code class="o">)</code><code>
</code><code class="nd">@Retention</code><code class="o">(</code><code class="n">RetentionPolicy</code><code class="o">.</code><code class="na">RUNTIME</code><code class="o">)</code><code>
</code><code class="nd">@Documented</code><code>
</code><code class="nd">@Constraint</code><code class="o">(</code><code class="n">validatedBy</code><code> </code><code class="o">=</code><code> </code><code class="o">{</code><code> </code><code class="n">JvmLanguageValidator</code><code class="o">.</code><code class="na">class</code><code class="o">}</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO5-1" href="#callout_programming_model_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="nd">@interface</code><code> </code><code class="n">JvmLanguage</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">String</code><code> </code><code class="nf">message</code><code class="o">(</code><code class="o">)</code><code> </code><code class="k">default</code><code> </code><code class="s">"You need to provide a Jvm based-language"</code><code class="o">;</code><code>
</code><code>    </code><code class="n">Class</code><code class="o">&lt;</code><code class="o">?</code><code class="o">&gt;</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">groups</code><code class="o">(</code><code class="o">)</code><code> </code><code class="k">default</code><code> </code><code class="o">{</code><code> </code><code class="o">}</code><code class="o">;</code><code>
</code><code>    </code><code class="n">Class</code><code class="o">&lt;</code><code class="o">?</code><code> </code><code class="kd">extends</code><code> </code><code class="n">Payload</code><code class="o">&gt;</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">payload</code><code class="o">(</code><code class="o">)</code><code> </code><code class="k">default</code><code> </code><code class="o">{</code><code> </code><code class="o">}</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO5-1" href="#co_programming_model_CO5-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Raises the constraint as a normal compilation error</p></dd>
</dl>

<p>Then you need to create the logic to detect any constraint violation.
This new class must implement the <code>javax.validation.ConstraintValidator</code> interface.</p>

<p>Next, create a class named <code>org.acme.quickstart.JvmLanguageValidator.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Arrays</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.List</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.ConstraintValidator</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.ConstraintValidatorContext</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">JvmLanguageValidator</code><code>
</code><code>    </code><code class="kd">implements</code><code> </code><code class="n">ConstraintValidator</code><code class="o">&lt;</code><code class="n">JvmLanguage</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO6-1" href="#callout_programming_model_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code> </code><a class="co" id="co_programming_model_CO6-2" href="#callout_programming_model_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>        </code><code class="kd">private</code><code> </code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">favoriteLanguages</code><code> </code><code class="o">=</code><code> </code><code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="s">"java"</code><code class="o">,</code><code>                                                             </code><code class="s">"groovy"</code><code class="o">,</code><code> </code><code class="s">"kotlin"</code><code class="o">,</code><code> </code><code class="s">"scala"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">boolean</code><code> </code><code class="nf">isValid</code><code class="o">(</code><code class="n">String</code><code> </code><code class="n">value</code><code class="o">,</code><code> </code><code class="n">ConstraintValidatorContext</code><code> </code><code class="n">context</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">favoriteLanguages</code><code class="o">.</code><code class="na">stream</code><code class="o">(</code><code class="o">)</code><code>
</code><code>            </code><code class="o">.</code><code class="na">anyMatch</code><code class="o">(</code><code class="n">l</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">l</code><code class="o">.</code><code class="na">equalsIgnoreCase</code><code class="o">(</code><code class="n">value</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO6-3" href="#callout_programming_model_CO6-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO6-1" href="#co_programming_model_CO6-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The annotation defined in previous step</p></dd>
<dt><a class="co" id="callout_programming_model_CO6-2" href="#co_programming_model_CO6-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The type of object that the validation applies</p></dd>
<dt><a class="co" id="callout_programming_model_CO6-3" href="#co_programming_model_CO6-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Checks if the provided favorite language (<code>value</code>) is a JVM-based language</p></dd>
</dl>

<p>Finally, you need to annotate the <code>favoriteLanguage</code> field from <code>org.acme.quickstart.Developer</code> class:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@JvmLanguage</code>
<code class="nd">@NotBlank</code>
<code class="kd">private</code> <code class="n">String</code> <code class="n">favoriteLanguage</code><code class="o">;</code></pre>

<p>Try it by opening a new terminal window, starting the Quarkus application, and sending some requests to the POST method:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile quarkus:dev</code>

<code class="go">curl -d '{"name":"Alexadra","age":7, "favoriteLanguage":"python"}' \</code>
<code class="go">     -H "Content-Type: application/json"</code>
<code class="go">     -X POST http://localhost:8080/developer -v</code>

<code class="go">&lt; HTTP/1.1 400 Bad Request</code>
<code class="go">&lt; Content-Length: 89</code>
<code class="go">&lt; validation-exception: true</code>
<code class="go">&lt; Content-Type: text/plain;charset=UTF-8</code>

<code class="go">curl -d '{"name":"Alexandra","age":5, "favoriteLanguage":"java"}' \</code>
<code class="go">     -H "Content-Type: application/json"</code>
<code class="go">     -X POST http://localhost:8080/developer -v</code>

<code class="go">&lt; HTTP/1.1 200 OK</code>
<code class="go">&lt; Content-Length: 106</code>
<code class="go">&lt; Content-Type: application/json</code>
<code class="go">&lt;</code>

<code class="go">[{"path":"addDeveloper.developer.favoriteLanguage",</code>
<code class="go">  "message":"You need to provide a Jvm based-language"}]</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128524573208">
<h2>Discussion</h2>

<p>Any validations following the Bean Validation specification on your REST endpoints, services methods, and ultimately any CDI-scoped object will be automatically 
<span class="keep-together">executed</span> during the run of your application.
If you need something with more control, see the next recipe, <a data-type="xref" href="#validate-objects-programmatically">Recipe 5.5</a>, for additional means of validating objects.</p>

<p>It is also good to know that, by default, constraint violation messages will be returned using the system locale.
If you would like to change this, you can do so in the 
<span class="keep-together"><em>application.properties</em></span> file by setting the <code>quarkus.default-locale</code> setting:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.default-locale</code><code class="o">=</code><code class="s">es-ES</code></pre>

<p>For REST endpoints, the locale will be based on the <code>Accept-Language</code> HTTP header.
You can specify a list of supported locales in the <em>application.properties</em> file:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.locales</code><code class="o">=</code><code class="s">en-US, es-ES</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128524534568">
<h2>See Also</h2>

<p>For more information, visit the following websites:</p>

<ul>
<li>
<p><a href="https://oreil.ly/R6L4d">Jakarta Bean Validation</a></p>
</li>
<li>
<p><a href="https://oreil.ly/O7BNR">Hibernate Validator</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.5 Validating Objects Programmatically"><div class="sect1" id="validate-objects-programmatically">
<h1>5.5 Validating Objects Programmatically</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128524516312">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="objects, validating programmatically" id="idm45128524515112"/><a data-type="indexterm" data-primary="programming model" data-secondary="validating objects programmatically" id="idm45128524514440"/><a data-type="indexterm" data-primary="validating" data-secondary="objects programmatically" id="idm45128524513528"/>You want to validate objects programmatically.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128524526360">
<h2>Solution</h2>

<p>Use the Bean Validation <code>javax.validation.Validator</code> class.</p>

<p>In some circumstances (for example, in non-CDI beans) you want to control when the validation process is executed.
For this reason, <code>javax.validation.Validator</code> class is provided.</p>

<p>Let’s create an endpoint that validates the input using <code>javax.validation.Validator</code> instead of using a declarative way with <code>@Valid</code> annotations.
Open the <code>org.acme.quickstart.DeveloperResource.java</code> class and inject <code>Validator</code> instance:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Inject</code><code>
</code><code class="n">Validator</code><code> </code><code class="n">validator</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO7-1" href="#callout_programming_model_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code class="nd">@POST</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/programmaticvalidation"</code><code class="o">)</code><code>
</code><code class="nd">@Consumes</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code>
</code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">APPLICATION_JSON</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="n">Response</code><code> </code><code class="nf">addProgrammaticValidation</code><code class="o">(</code><code class="n">Developer</code><code> </code><code class="n">developer</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO7-2" href="#callout_programming_model_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">Set</code><code class="o">&lt;</code><code class="n">ConstraintViolation</code><code class="o">&lt;</code><code class="n">Developer</code><code class="o">&gt;</code><code class="o">&gt;</code><code> </code><code class="n">violations</code><code> </code><code class="o">=</code><code>
</code><code>      </code><code class="n">validator</code><code class="o">.</code><code class="na">validate</code><code class="o">(</code><code class="n">developer</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO7-3" href="#callout_programming_model_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">violations</code><code class="o">.</code><code class="na">isEmpty</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO7-4" href="#callout_programming_model_CO7-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">developers</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="n">developer</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">Response</code><code class="o">.</code><code class="na">ok</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code> </code><code class="k">else</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">JsonArrayBuilder</code><code> </code><code class="n">errors</code><code> </code><code class="o">=</code><code> </code><code class="n">Json</code><code class="o">.</code><code class="na">createArrayBuilder</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">for</code><code> </code><code class="o">(</code><code class="n">ConstraintViolation</code><code class="o">&lt;</code><code class="n">Developer</code><code class="o">&gt;</code><code> </code><code class="n">violation</code><code> </code><code class="o">:</code><code> </code><code class="n">violations</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO7-5" href="#callout_programming_model_CO7-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>            </code><code class="n">errors</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code>
</code><code>                </code><code class="n">Json</code><code class="o">.</code><code class="na">createObjectBuilder</code><code class="o">(</code><code class="o">)</code><code>
</code><code>                </code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="s">"path"</code><code class="o">,</code><code> </code><code class="n">violation</code><code class="o">.</code><code class="na">getPropertyPath</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code>
</code><code>                </code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="s">"message"</code><code class="o">,</code><code> </code><code class="n">violation</code><code class="o">.</code><code class="na">getMessage</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code>
</code><code>                </code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">Response</code><code class="o">.</code><code class="na">status</code><code class="o">(</code><code class="n">Response</code><code class="o">.</code><code class="na">Status</code><code class="o">.</code><code class="na">BAD_REQUEST</code><code class="o">)</code><code>
</code><code>                       </code><code class="o">.</code><code class="na">entity</code><code class="o">(</code><code class="n">errors</code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code>
</code><code>                       </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO7-1" href="#co_programming_model_CO7-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Inject <code>Validator</code> class from Bean Validation spec</p></dd>
<dt><a class="co" id="callout_programming_model_CO7-2" href="#co_programming_model_CO7-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>@Valid</code> is not required</p></dd>
<dt><a class="co" id="callout_programming_model_CO7-3" href="#co_programming_model_CO7-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Validate the object programmatically</p></dd>
<dt><a class="co" id="callout_programming_model_CO7-4" href="#co_programming_model_CO7-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>If there are no errors, proceed</p></dd>
<dt><a class="co" id="callout_programming_model_CO7-5" href="#co_programming_model_CO7-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>If there are errors, then build the output</p></dd>
</dl>

<p>Try it by opening a new terminal window, starting the Quarkus application, and sending a request for the new POST method:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile quarkus:dev</code>

<code class="go">curl -d '{"name":"Ada","age":7, "favoriteLanguage":"java"}' \</code>
<code class="go">     -H "Content-Type: application/json" \</code>
<code class="go">     -X POST http://localhost:8080/developer/programmaticvalidation -v</code>

<code class="go">&lt; HTTP/1.1 400 Bad Request</code>
<code class="go">&lt; Content-Length: 89</code>
<code class="go">&lt; validation-exception: true</code>
<code class="go">&lt; Content-Type: text/plain;charset=UTF-8</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128524526056">
<h2>Discussion</h2>

<p>Quarkus will automatically create an instance of the <code>javax.validation.ValidatorFactory</code>.
You can tweak this a little by creating your own replacement beans.
An instance of the following types in your application will automatically be injected into the <code>ValidatorFactory</code>:</p>

<ul>
<li>
<p><code>javax.validation.ClockProvider</code></p>
</li>
<li>
<p><code>javax.validation.ConstraintValidator</code></p>
</li>
<li>
<p><code>javax.validation.ConstraintValidatorFactory</code></p>
</li>
<li>
<p><code>javax.validation.MessageInterpolator</code></p>
</li>
<li>
<p><code>javax.validation.ParameterNameProvider</code></p>
</li>
<li>
<p><code>javax.validation.TraversableResolver</code></p>
</li>
<li>
<p><code>org.hibernate.validator.spi.properties.GetterPropertySelectionStrategy</code></p>
</li>
<li>
<p><code>org.hibernate.validator.spi.scripting.ScriptEvaluatorFactory</code></p>
</li>
</ul>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>You may have only one instance of a particular type in the preceding list, and classes should be declared as <code>@ApplicationScoped</code>.</p>
</div>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.6 Injecting Dependencies"><div class="sect1" id="idm45128524517576">
<h1>5.6 Injecting Dependencies</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128524193784">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="programming model" data-secondary="injecting dependencies" id="idm45128524192552"/><a data-type="indexterm" data-primary="injecting dependencies" id="idm45128524191576"/><a data-type="indexterm" data-primary="dependencies, injecting" id="idm45128524190904"/>You want to inject dependencies into your classes.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128524189848">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="CDI (Contexts and Dependency Injection)" id="idm45128524188680"/>Use Contexts and Dependency Injection (CDI).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128524187624">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="DI (dependency injection)" id="idm45128524186056"/>Dependency injection (DI) in Quarkus, which is based on the <a href="https://oreil.ly/VcDnN">Contexts and Dependency Injection 2.0 specification</a>, is pretty standard, with only a few modifications needed for the basic use case.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>Quarkus implements most of the specification, except for some corner cases that should not affect your code.
The Quarkus website maintains a list of supported features and limitations, including more advanced features that are not covered here in the book.
You can find those lists in the <a href="https://oreil.ly/-LPAd">Quarkus CDI Reference Guide</a>.</p>
</div>

<p><a data-type="indexterm" data-primary="@Inject annotation" id="idm45128524182168"/>Injection happens just as you would expect in any other application using CDI:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.inject.Inject</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.GET</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Path</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.Produces</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.ws.rs.core.MediaType</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Path</code><code class="o">(</code><code class="s">"/hello"</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingResource</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="nd">@Inject</code><code>                     </code><a class="co" id="co_programming_model_CO8-1" href="#callout_programming_model_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">GreetingService</code><code> </code><code class="n">service</code><code class="o">;</code><code>    </code><a class="co" id="co_programming_model_CO8-2" href="#callout_programming_model_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="nd">@GET</code><code>
</code><code>    </code><code class="nd">@Produces</code><code class="o">(</code><code class="n">MediaType</code><code class="o">.</code><code class="na">TEXT_PLAIN</code><code class="o">)</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">hello</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">service</code><code class="o">.</code><code class="na">getGreeting</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO8-1" href="#co_programming_model_CO8-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Use of the <code>@Inject</code> annotation is required</p></dd>
<dt><a class="co" id="callout_programming_model_CO8-2" href="#co_programming_model_CO8-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Due to restrictions on reflection, package-private injection fields are preferred</p></dd>
</dl>

<p>The injected service is pretty standard and without any surprises:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Locale</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.inject.Inject</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.inject.Named</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@ApplicationScoped</code><code>                  </code><a class="co" id="co_programming_model_CO9-1" href="#callout_programming_model_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingService</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">getGreeting</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="s">"Hello"</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO9-1" href="#co_programming_model_CO9-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>As mentioned in the following, you should include a bean-defining annotation that allows classes to be found</p></dd>
</dl>

<p>Bean discovery in Quarkus follows a simplified process from standard CDI.
In short, if your application classes do not have a <a href="https://oreil.ly/jm4QF">bean-defining annotation</a>, they will not be picked up by Quarkus.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128524187032">
<h2>See Also</h2>

<p>To learn more, see the following web pages:</p>

<ul>
<li>
<p><a href="https://oreil.ly/clOD4">JBoss: JSR 365: Contexts and Dependency Injection for Java 2.0</a></p>
</li>
<li>
<p><a href="https://oreil.ly/7sgPm">GitHub: GraalVM Native Image Compatibility and Optimization Guide</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.7 Creating Factories"><div class="sect1" id="creating_factories">
<h1>5.7 Creating Factories</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128523946488">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="factories" id="idm45128523945480"/><a data-type="indexterm" data-primary="programming model" data-secondary="creating factories" id="idm45128523944872"/>You want to create a factory for an object.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128523943640">
<h2>Solution</h2>

<p>Use the <code>javax.enterise.inject.Produces</code> concept from CDI.</p>

<p><a data-type="indexterm" data-primary="CDI (Contexts and Dependency Injection)" id="idm45128523941864"/><a data-type="indexterm" data-primary="producers" id="idm45128523941256"/>CDI has a concept called <em>producers</em> that allows you to do any sort of object creation necessary to add a new bean or class to the list of resolvable instances, like this:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.util.Locale</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.enterprise.inject.Produces</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.inject.Named</code><code class="o">;</code>

<code class="nd">@ApplicationScoped</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">LocaleProducer</code> <code class="o">{</code>
    <code class="nd">@Produces</code>
    <code class="kd">public</code> <code class="n">Locale</code> <code class="nf">getDefaultLocale</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">Locale</code><code class="o">.</code><code class="na">getDefault</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128523912488">
<h2>Discussion</h2>

<p>Quarkus takes the producers concept a little further. Quarkus does so by adding the 
<span class="keep-together"><code>@io.quarkus.arc.DefaultBean</code></span> annotation.
In terms of CDI, this is like an enabled default alternative.
Because Quarkus does not allow for alternatives, a class annotated with <code>DefaultBean</code> gives you a way to create a default instance of a bean.
The following code is an example pulled from the Quarkus website:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Dependent</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">TracerConfiguration</code> <code class="o">{</code>

    <code class="nd">@Produces</code>
    <code class="kd">public</code> <code class="n">Tracer</code> <code class="nf">tracer</code><code class="o">(</code><code class="n">Reporter</code> <code class="n">reporter</code><code class="o">,</code> <code class="n">Configuration</code> <code class="n">configuration</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">new</code> <code class="nf">Tracer</code><code class="o">(</code><code class="n">reporter</code><code class="o">,</code> <code class="n">configuration</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="nd">@Produces</code>
    <code class="nd">@DefaultBean</code>
    <code class="kd">public</code> <code class="n">Configuration</code> <code class="nf">configuration</code><code class="o">()</code> <code class="o">{</code>
        <code class="c1">// create a Configuration</code>
    <code class="o">}</code>

    <code class="nd">@Produces</code>
    <code class="nd">@DefaultBean</code>
    <code class="kd">public</code> <code class="n">Reporter</code> <code class="nf">reporter</code><code class="o">(){</code>
        <code class="c1">// create a Reporter</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>The following excerpt allows your application or library to inject a tracer wherever necessary.
It also allows for customization by creating a new producer:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@Dependent</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">CustomTracerConfiguration</code> <code class="o">{</code>

    <code class="nd">@Produces</code>
    <code class="kd">public</code> <code class="n">Reporter</code> <code class="nf">reporter</code><code class="o">(){</code>
        <code class="c1">// create a custom Reporter</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>With this code in your application, the <code>Reporter</code> created from the <code>CustomTracerConfiguration</code> class will be used instead of the default.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128523800984">
<h2>See Also</h2>

<p>To learn more, visit the following web page:</p>

<ul>
<li>
<p><a href="https://oreil.ly/4-OrV">JBoss: JSR 365: Contexts and Dependency Injection for Java 2.0</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.8 Executing Object Life Cycle Events"><div class="sect1" id="executing-obj-lifecycle-events">
<h1>5.8 Executing Object Life Cycle Events</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128523791224">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="object life cycle events, executing" id="idm45128523790024"/><a data-type="indexterm" data-primary="programming model" data-secondary="executing object life cycle events" id="idm45128523789256"/>You want to execute logic before and/or after objection creation/destruction.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128523787912">
<h2>Solution</h2>

<p>CDI makes use of the <code>@javax.annotation.PostConstruct</code> and <code>@javax.annotation.PreDestroy</code> annotations for life cycle management.
The methods annotated with those annotations will be called after object creation for <code>PostConstruct</code> and before the object is destroyed for <code>PreDestroy</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.util.Arrays</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.List</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.annotation.PostConstruct</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.annotation.PreDestroy</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code>

<code class="nd">@ApplicationScoped</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">RecommendationService</code> <code class="o">{</code>
    <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="n">products</code><code class="o">;</code>

    <code class="nd">@PostConstruct</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">init</code><code class="o">()</code> <code class="o">{</code>
        <code class="n">products</code> <code class="o">=</code> <code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="s">"Orange"</code><code class="o">,</code> <code class="s">"Apple"</code><code class="o">,</code> <code class="s">"Mango"</code><code class="o">);</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Products initialized"</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="nd">@PreDestroy</code>
    <code class="kd">public</code> <code class="kt">void</code> <code class="nf">cleanup</code><code class="o">()</code> <code class="o">{</code>
        <code class="n">products</code> <code class="o">=</code> <code class="kc">null</code><code class="o">;</code>
        <code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Products cleaned up"</code><code class="o">);</code>
    <code class="o">}</code>

    <code class="kd">public</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code> <code class="nf">getProducts</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">products</code><code class="o">;</code>
    <code class="o">}</code>
<code class="o">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128523735192">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="@PostConstruct annotation" id="idm45128523734184"/>If there is logic that needs to happen after the constructor is called and after all the injections happen, it should go into a method annotated with the <code>@PostConstruct</code> annotation.
This is guaranteed to be called only once in the lifetime of an object instance.</p>

<p><a data-type="indexterm" data-primary="@PreDestroy annotation" id="idm45128523651496"/>Similarly, if logic needs to be executed before the object is destroyed, place it in a method annotated with the <code>@PreDestroy</code> annotation.
Ideas for this would include closing connections, cleaning up resources, and finalizing logging.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128523649768">
<h2>See Also</h2>

<p>To learn more, see the following pages on GitHub:</p>

<ul>
<li>
<p><a href="https://oreil.ly/UxdG2">Common Annotations API: PostConstruct.java</a></p>
</li>
<li>
<p><a href="https://oreil.ly/qsZUC">Common Annotations API: PreDestroy.java</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.9 Executing Application Life Cycle Events"><div class="sect1" id="idm45128523645112">
<h1>5.9 Executing Application Life Cycle Events</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128523643896">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="applications" data-secondary="executing lifecycle events" id="idm45128523642696"/><a data-type="indexterm" data-primary="programming model" data-secondary="executing application lifecycle events" id="idm45128523641656"/>You want to execute logic at application startup and/or after application shutdown.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128523640312">
<h2>Solution</h2>

<p>Observe the <code>io.quarkus.runtime.StartupEvent</code> and the <code>io.quarkus.runtime.ShutdownEvent</code>.
<a data-type="indexterm" data-primary="ShutdownEvent" id="idm45128523637688"/><a data-type="indexterm" data-primary="StartupEvent" id="idm45128523636984"/>During application startup, Quarkus will fire the <code>StartupEvent</code>; and during shutdown, the <code>ShutdownEvent</code>, like this:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.event.Observes</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.runtime.ShutdownEvent</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.runtime.StartupEvent</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.slf4j.Logger</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.slf4j.LoggerFactory</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@ApplicationScoped</code><code>                                  </code><a class="co" id="co_programming_model_CO10-1" href="#callout_programming_model_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">ApplicationEventListener</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="kd">static</code><code> </code><code class="kd">final</code><code> </code><code class="n">Logger</code><code> </code><code class="n">LOGGER</code><code> </code><code class="o">=</code><code>
</code><code>            </code><code class="n">LoggerFactory</code><code class="o">.</code><code class="na">getLogger</code><code class="o">(</code><code class="n">ApplicationEventListener</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">onStart</code><code class="o">(</code><code class="nd">@Observes</code><code> </code><code class="n">StartupEvent</code><code> </code><code class="n">event</code><code class="o">)</code><code> </code><code class="o">{</code><code>    </code><a class="co" id="co_programming_model_CO10-2" href="#callout_programming_model_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">LOGGER</code><code class="o">.</code><code class="na">info</code><code class="o">(</code><code class="s">"Application starting..."</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kt">void</code><code> </code><code class="nf">onStop</code><code class="o">(</code><code class="nd">@Observes</code><code> </code><code class="n">ShutdownEvent</code><code> </code><code class="n">event</code><code class="o">)</code><code> </code><code class="o">{</code><code>    </code><a class="co" id="co_programming_model_CO10-3" href="#callout_programming_model_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">LOGGER</code><code class="o">.</code><code class="na">info</code><code class="o">(</code><code class="s">"Application shutting down..."</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO10-1" href="#co_programming_model_CO10-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>You must add a bean-defining annotation</p></dd>
<dt><a class="co" id="callout_programming_model_CO10-2" href="#co_programming_model_CO10-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The startup event that is fired</p></dd>
<dt><a class="co" id="callout_programming_model_CO10-3" href="#co_programming_model_CO10-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The shutdown event that Quarkus fires</p></dd>
</dl>

<p>Neither of these event objects carry any additional information, so there is not 
<span class="keep-together">anything</span> else to cover.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128523473000">
<h2>Discussion</h2>

<p>Event observation is a very powerful way in Quarkus (and in other CDI frameworks) to decouple concerns with minimal overhead.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128523471240">
<h2>See Also</h2>

<p>For more, see <a data-type="xref" href="#executing-obj-lifecycle-events">Recipe 5.8</a>.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.10 Using a Named Qualifier"><div class="sect1" id="named_qualifier">
<h1>5.10 Using a Named Qualifier</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128523428568">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="programming model" data-secondary="using named qualifiers" id="idm45128523427560"/><a data-type="indexterm" data-primary="named qualifiers" id="idm45128523426840"/>You want to qualify an injection with a name.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128523425848">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="@javax.inject.Named annotation" id="idm45128523424600"/>Use the <code>@javax.inject.Named</code> annotation.</p>

<p><a data-type="indexterm" data-primary="qualifier" id="idm45128523423224"/><a data-type="indexterm" data-primary="CDI (Contexts and Dependency Injection)" id="idm45128523422392"/><a data-type="indexterm" data-primary="@Retention(RUNTIME)" id="idm45128523421784"/>In CDI, a <em>qualifier</em> is any annotation defined as <code>@Retention(RUNTIME)</code> and annotated with <code>@javax.inject.Qualifier</code>.
Qualifiers are typically defined so that they can be used everywhere you need them as <code>@Target({METHOD, FIELD, PARAMETER, TYPE})</code>.</p>

<p>CDI comes with a useful qualifier: <code>@javax.inject.Named</code>.
The value isn’t required, but it doesn’t make sense to use <code>@Named</code> without an actual name.
When resolving an injection point, CDI will look for any beans of the correct type that also contain the same qualifier.
In the case of <code>@Named</code>, the value part of the annotation must match as well.</p>

<p>This is very useful if you have multiple instances of a type, but they are not the same object.
CDI doesn’t take into consideration the actual instance of the object because that isn’t known until it is created and will be different each time anyway.
To get around this problem, CDI uses qualifiers:</p>

<pre data-type="programlisting" data-code-language="java">    <code class="nd">@Inject</code>
    <code class="nd">@Named</code><code class="o">(</code><code class="s">"en_US"</code><code class="o">)</code>
    <code class="n">Locale</code> <code class="n">en_US</code><code class="o">;</code>

    <code class="nd">@Inject</code>
    <code class="nd">@Named</code><code class="o">(</code><code class="s">"es_ES"</code><code class="o">)</code>
    <code class="n">Locale</code> <code class="n">es_ES</code><code class="o">;</code>

    <code class="kd">public</code> <code class="n">String</code> <code class="nf">getGreeting</code><code class="o">(</code><code class="n">String</code> <code class="n">locale</code><code class="o">)</code> <code class="o">{</code>
        <code class="k">if</code> <code class="o">(</code><code class="n">locale</code><code class="o">.</code><code class="na">startsWith</code><code class="o">(</code><code class="s">"en"</code><code class="o">))</code>
            <code class="k">return</code> <code class="s">"Hello from "</code> <code class="o">+</code> <code class="n">en_US</code><code class="o">.</code><code class="na">getDisplayCountry</code><code class="o">();</code>

        <code class="k">if</code> <code class="o">(</code><code class="n">locale</code><code class="o">.</code><code class="na">startsWith</code><code class="o">(</code><code class="s">"es"</code><code class="o">))</code>
            <code class="k">return</code> <code class="s">"Hola desde "</code> <code class="o">+</code> <code class="n">es_ES</code><code class="o">.</code><code class="na">getDisplayCountry</code><code class="o">();</code>

        <code class="k">return</code> <code class="s">"Unknown locale"</code><code class="o">;</code>
    <code class="o">}</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128523416104">
<h2>Discussion</h2>

<p>For completeness, this is a way to produce named beans:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.util.Locale</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.enterprise.inject.Produces</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.inject.Named</code><code class="o">;</code>

<code class="nd">@ApplicationScoped</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">LocaleProducer</code> <code class="o">{</code>
    <code class="nd">@Produces</code>
    <code class="kd">public</code> <code class="n">Locale</code> <code class="nf">getDefaultLocale</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">Locale</code><code class="o">.</code><code class="na">getDefault</code><code class="o">();</code>
    <code class="o">}</code>
    <code class="nd">@Produces</code>
    <code class="nd">@Named</code><code class="o">(</code><code class="s">"en_US"</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">Locale</code> <code class="nf">getEnUSLocale</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="n">Locale</code><code class="o">.</code><code class="na">US</code><code class="o">;</code>
    <code class="o">}</code>

    <code class="nd">@Produces</code>
    <code class="nd">@Named</code><code class="o">(</code><code class="s">"es_ES"</code><code class="o">)</code>
    <code class="kd">public</code> <code class="n">Locale</code> <code class="nf">getEsESLocale</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">new</code> <code class="nf">Locale</code><code class="o">(</code><code class="s">"es"</code><code class="o">,</code> <code class="s">"ES"</code><code class="o">);</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p><code>@Named</code> qualification, though weak—which is one of the things CDI tries to avoid—can be a useful trick during integrations.
We recommend using strongly typed annotations where possible.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128523336008">
<h2>See Also</h2>

<p>For more information, visit the following web page:</p>

<ul>
<li>
<p><a href="https://oreil.ly/5NydQ">JBoss: qualifier @Named at injection points</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.11 Using Custom Qualifiers"><div class="sect1" id="idm45128523231176">
<h1>5.11 Using Custom Qualifiers</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128523229960">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="custom qualifiers" id="idm45128523228728"/><a data-type="indexterm" data-primary="programming model" data-secondary="custom qualifiers" id="idm45128523228024"/>You want to qualify an injection with some other qualifier annotation.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128523226696">
<h2>Solution</h2>

<p>Develop and use qualifier annotations.</p>

<p>In <a data-type="xref" href="#named_qualifier">Recipe 5.10</a>, you were introduced to the idea of a qualifier:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.lang.annotation.Retention</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.lang.annotation.RetentionPolicy</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.lang.annotation.Target</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.inject.Qualifier</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">FIELD</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">METHOD</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">PARAMETER</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">TYPE</code><code class="o">;</code>

<code class="nd">@Qualifier</code>
<code class="nd">@Retention</code><code class="o">(</code><code class="n">RetentionPolicy</code><code class="o">.</code><code class="na">RUNTIME</code><code class="o">)</code>
<code class="nd">@Target</code><code class="o">({</code><code class="n">METHOD</code><code class="o">,</code> <code class="n">FIELD</code><code class="o">,</code> <code class="n">PARAMETER</code><code class="o">,</code> <code class="n">TYPE</code><code class="o">})</code>
<code class="kd">public</code> <code class="nd">@interface</code> <code class="n">SpainLocale</code> <code class="o">{</code>
<code class="o">}</code></pre>

<p>Producing the bean is exactly as you would expect:</p>

<pre data-type="programlisting" data-code-language="java">    <code class="nd">@Produces</code>
    <code class="nd">@SpainLocale</code>
    <code class="kd">public</code> <code class="n">Locale</code> <code class="nf">getSpainLocale</code><code class="o">()</code> <code class="o">{</code>
        <code class="k">return</code> <code class="k">new</code> <code class="nf">Locale</code><code class="o">(</code><code class="s">"es"</code><code class="o">,</code> <code class="s">"ES"</code><code class="o">);</code>
    <code class="o">}</code></pre>

<p>Then, of course, injecting the newly qualified instance is just as easy:</p>

<pre data-type="programlisting" data-code-language="java">    <code class="nd">@Inject</code>
    <code class="nd">@SpainLocale</code>
    <code class="n">Locale</code> <code class="n">spain</code><code class="o">;</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128523102744">
<h2>Discussion</h2>

<p>Using qualifier annotations is the preferred way to use qualified CDI injections both in a normal CDI application and in Quarkus.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128523038312">
<h2>See Also</h2>

<p>For more information, visit the following web page:</p>

<ul>
<li>
<p><a href="https://oreil.ly/MOfwa">JBoss: Qualifiers</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.12 Qualifying and Configuring Annotations"><div class="sect1" id="idm45128523071192">
<h1>5.12 Qualifying and Configuring Annotations</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128523070184">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="annotations" data-seealso="specific annotations" id="idm45128523068984"/><a data-type="indexterm" data-primary="configuration" data-secondary="annotations" id="idm45128523068008"/><a data-type="indexterm" data-primary="programming model" data-secondary="configuring annotations" id="idm45128523067064"/><a data-type="indexterm" data-primary="programming model" data-secondary="qualifying annotations" id="idm45128523046056"/>You want to qualify and configure a dependency using annotations.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128523044728">
<h2>Solution</h2>

<p>Using a combination of <code>InjectionPoint</code> in a producer and nonbinding attributes on the qualifier annotation, it is possible to both qualify and configure a bean.</p>

<p>This is an interesting, albeit atypical, use case for qualifiers and producers.
Take a look at the following code to see it in action:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.Retention</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.Target</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.util.Nonbinding</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.inject.Qualifier</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">TYPE</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">FIELD</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">METHOD</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">PARAMETER</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">RetentionPolicy</code><code class="o">.</code><code class="na">RUNTIME</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Qualifier</code><code>
</code><code class="nd">@Retention</code><code class="o">(</code><code class="n">RUNTIME</code><code class="o">)</code><code>
</code><code class="nd">@Target</code><code class="o">(</code><code class="o">{</code><code class="n">TYPE</code><code class="o">,</code><code> </code><code class="n">METHOD</code><code class="o">,</code><code> </code><code class="n">FIELD</code><code class="o">,</code><code> </code><code class="n">PARAMETER</code><code class="o">}</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="nd">@interface</code><code> </code><code class="n">Quote</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="nd">@Nonbinding</code><code> </code><code class="n">String</code><code> </code><code class="n">msg</code><code class="o">(</code><code class="o">)</code><code> </code><code class="k">default</code><code> </code><code class="s">""</code><code class="o">;</code><code>        </code><a class="co" id="co_programming_model_CO11-1" href="#callout_programming_model_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="nd">@Nonbinding</code><code> </code><code class="n">String</code><code> </code><code class="n">source</code><code class="o">(</code><code class="o">)</code><code> </code><code class="k">default</code><code> </code><code class="s">""</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO11-1" href="#co_programming_model_CO11-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>The attributes are listed as nonbinding, so injections actually work.</p></dd>
</dl>

<p>Normally, the attributes of a qualifier are considered for injections, so if the attributes don’t match, the qualified object will not be injected:</p>

<pre data-type="programlisting" data-code-language="java"><code>    </code><code class="nd">@Produces</code><code>
</code><code>    </code><code class="nd">@Quote</code><code>                                                          </code><a class="co" id="co_programming_model_CO12-1" href="#callout_programming_model_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">Message</code><code> </code><code class="nf">getQuote</code><code class="o">(</code><code class="n">InjectionPoint</code><code> </code><code class="n">msg</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">Quote</code><code> </code><code class="n">q</code><code> </code><code class="o">=</code><code> </code><code class="n">msg</code><code class="o">.</code><code class="na">getAnnotated</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getAnnotation</code><code class="o">(</code><code class="n">Quote</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code class="o">;</code><code>    </code><a class="co" id="co_programming_model_CO12-2" href="#callout_programming_model_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="k">new</code><code> </code><code class="nf">Message</code><code class="o">(</code><code class="n">q</code><code class="o">.</code><code class="na">msg</code><code class="o">(</code><code class="o">)</code><code class="o">,</code><code> </code><code class="n">q</code><code class="o">.</code><code class="na">source</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>                    </code><a class="co" id="co_programming_model_CO12-3" href="#callout_programming_model_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>    </code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO12-1" href="#co_programming_model_CO12-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Only the default attributes on the producer</p></dd>
<dt><a class="co" id="callout_programming_model_CO12-2" href="#co_programming_model_CO12-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Get the instance of the qualifier to pull configuration from the attributes</p></dd>
<dt><a class="co" id="callout_programming_model_CO12-3" href="#co_programming_model_CO12-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Return the newly configured object</p></dd>
</dl>

<p>Usage is exactly the same as any other qualifier:</p>

<pre data-type="programlisting" data-code-language="java">    <code class="nd">@Quote</code><code class="o">(</code><code class="n">msg</code> <code class="o">=</code> <code class="s">"Good-bye and hello, as always."</code><code class="o">,</code> <code class="n">source</code> <code class="o">=</code> <code class="s">"Roger Zelazny"</code><code class="o">)</code>
    <code class="n">Message</code> <code class="n">myQuote</code><code class="o">;</code></pre>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128522761288">
<h2>See Also</h2>

<p>For more information, visit the following web page:</p>

<ul>
<li>
<p><a href="https://oreil.ly/BVmV2">JBoss: Injection point metadata</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.13 Creating Interceptors"><div class="sect1" id="idm45128522759864">
<h1>5.13 Creating Interceptors</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128522758648">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="interceptors" id="idm45128522757416"/><a data-type="indexterm" data-primary="programming model" data-secondary="creating interceptors" id="idm45128522756712"/>You want to implement cross-cutting concerns.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128522755384">
<h2>Solution</h2>

<p>A <em>cross-cutting concern</em> is an aspect that affects other concerns of a program.
The textbook example of this is <em>transaction control</em>.
It is an action that affects the use of data in your program and must always be addressed, often in the same or similar manner.</p>

<p>Create <code>@javax.inject.AroundInvoke</code> and <code>@javax.inject.AroundConstruct</code> interceptors with the corresponding interceptor bindings.
You are also able to create CDI stereotypes to better compose concerns into a single annotation.</p>

<p>To start, create an annotation with the <code>@javax.interceptor.InterceptorBinding</code> annotation.
This will be used to link up the actual interceptor code and to annotate any of the methods or classes you wish to be intercepted:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.lang.annotation.Inherited</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.lang.annotation.Retention</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.lang.annotation.Target</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.interceptor.InterceptorBinding</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">METHOD</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">ElementType</code><code class="o">.</code><code class="na">TYPE</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">static</code> <code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">annotation</code><code class="o">.</code><code class="na">RetentionPolicy</code><code class="o">.</code><code class="na">RUNTIME</code><code class="o">;</code>

<code class="nd">@Inherited</code>
<code class="nd">@InterceptorBinding</code>
<code class="nd">@Retention</code><code class="o">(</code><code class="n">RUNTIME</code><code class="o">)</code>
<code class="nd">@Target</code><code class="o">({</code><code class="n">METHOD</code><code class="o">,</code> <code class="n">TYPE</code><code class="o">})</code>
<code class="kd">public</code> <code class="nd">@interface</code> <code class="n">LogEvent</code> <code class="o">{</code>
<code class="o">}</code></pre>

<p>Nothing special going on there.
Next, you need to create the interceptor:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code> <code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">java.util.ArrayList</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.Arrays</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">java.util.List</code><code class="o">;</code>

<code class="kn">import</code> <code class="nn">javax.interceptor.AroundInvoke</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.interceptor.Interceptor</code><code class="o">;</code>
<code class="kn">import</code> <code class="nn">javax.interceptor.InvocationContext</code><code class="o">;</code>

<code class="nd">@LogEvent</code>
<code class="nd">@Interceptor</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">LogEventInterceptor</code> <code class="o">{</code>
    <code class="kd">static</code> <code class="n">List</code><code class="o">&lt;</code><code class="n">Event</code><code class="o">&gt;</code> <code class="n">events</code> <code class="o">=</code> <code class="k">new</code> <code class="n">ArrayList</code><code class="o">&lt;&gt;();</code>

    <code class="nd">@AroundInvoke</code>
    <code class="kd">public</code> <code class="n">Object</code> <code class="nf">logEvent</code><code class="o">(</code><code class="n">InvocationContext</code> <code class="n">ctx</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>
        <code class="n">events</code><code class="o">.</code><code class="na">add</code><code class="o">(</code><code class="k">new</code> <code class="n">Event</code><code class="o">(</code><code class="n">ctx</code><code class="o">.</code><code class="na">getMethod</code><code class="o">().</code><code class="na">getName</code><code class="o">(),</code>
                             <code class="n">Arrays</code><code class="o">.</code><code class="na">deepToString</code><code class="o">(</code><code class="n">ctx</code><code class="o">.</code><code class="na">getParameters</code><code class="o">())));</code>
        <code class="k">return</code> <code class="n">ctx</code><code class="o">.</code><code class="na">proceed</code><code class="o">();</code>
    <code class="o">}</code>
<code class="o">}</code></pre>

<p>This is a pretty contrived example, but it is easy to understand what is happening.
Lastly, you simply need to annotate a method or class with the binding annotation:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@LogEvent</code>
<code class="kd">public</code> <code class="kt">void</code> <code class="nf">executeOrder</code><code class="o">(</code><code class="n">Order</code> <code class="n">order</code><code class="o">)</code> <code class="o">{</code>
    <code class="c1">// ...</code>
<code class="o">}</code></pre>

<p><a data-type="indexterm" data-primary="executeOrder method" id="idm45128522440888"/>Every time the <code>executeOrder</code> method is called, the method in the interceptor that is annotated with <code>@javax.interceptor.AroundInvoke</code>, <code>logEvent</code> in this case, will be called before the actual <code>executeOrder</code> method is called.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128522754792">
<h2>Discussion</h2>

<p>Interceptors are very easy to implement in Quarkus using the standard CDI mechanism.
This provides a simple way to define and utilize cross-cutting actions in your application.</p>

<p><a data-type="indexterm" data-primary="AOP (aspect-oriented programming)" id="idm45128522436712"/><a data-type="indexterm" data-primary="Kiczales, Gregor" id="idm45128522436040"/><a data-type="indexterm" data-primary="Enterprise JavaBeans" id="idm45128522427080"/><a data-type="indexterm" data-primary="Spring" id="idm45128522426408"/><a data-type="indexterm" data-primary="AspectJ" id="idm45128522425736"/>Aspect-oriented programming (AOP) has been around for quite some time, since 1997 to be exact.
A team at Xerox PARC lead by Gregor Kiczales created and termed cross-cutting and aspect-oriented programming.
Some claim the Microsoft Transaction Server was the first widely adopted instance of AOP.
Eventually, Enterprise JavaBeans developed AOP aspects.
There’s also Spring and AspectJ in the Java ecosystem.</p>

<p>However, we are talking about CDI and Quarkus.
Quarkus ArC (the dependency 
<span class="keep-together">injection</span> flavor in Quarkus), the name of which is a play on arc welding, makes use of the same concepts.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128522423064">
<h2>See Also</h2>

<p><a data-type="indexterm" data-primary="Box, Don" data-secondary="Essential.NET, Vol. 1: The Common Language Runtime" id="idm45128522421864"/><a data-type="indexterm" data-primary="Sells, Chris" data-secondary="Essential.NET, Vol. 1: The Common Language Runtime" id="idm45128522420792"/><a data-type="indexterm" data-primary="Essential.NET, Vol. 1: The Common Language Runtime (Box and Sells)" id="idm45128522419816"/>For more information, check out the following:</p>

<ul>
<li>
<p><em>Essential.NET, Volume 1: The Common Language Runtime</em> by Don Box and Chris Sells (Addison-Wesley Professional)</p>
</li>
<li>
<p><a href="https://oreil.ly/QlAGP">JBoss: Interceptor bindings</a></p>
</li>
<li>
<p><a href="https://oreil.ly/0BpNz">Stack Overflow: What does ArC mean?</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.14 Writing Behavioral Tests"><div class="sect1" id="behavioral_tests">
<h1>5.14 Writing Behavioral Tests</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128522412952">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="behavioral tests, writing" id="bb_wr"/><a data-type="indexterm" data-primary="programming model" data-secondary="writing behavioral tests" id="pm_bb"/>You want to write behavioral tests to verify the correctness of service without 
<span class="keep-together">verifying</span> its internals.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128522389928">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="JUnit 5" id="idm45128522388296"/><a data-type="indexterm" data-primary="REST-Assured" id="idm45128522387592"/>Quarkus’s testing solution is based on <a href="https://oreil.ly/bh494">JUnit 5</a>, the de facto testing tool in the Java ecosystem, and provides tight integration with <a href="http://rest-assured.io">REST-Assured</a> testing framework for validating RESTful Web APIs.</p>
<div data-type="important"><h6>Important</h6>
<p>Using REST-Assured is not mandatory; it is just a recommendation or best practice, so you can use any other framework that you prefer for testing endpoints.</p>
</div>

<p><a data-type="indexterm" data-primary="@QuarkusTest annotation" id="idm45128522383848"/>The most important part of the Quarkus testing framework is an annotation called <code>QuarkusTest</code>.
When you annotate a test class with this annotation, you are effectively marking that test to be executed within the Quarkus test framework, which instructs the test to follow the following life cycle:</p>
<ol>
<li>
<p>The Quarkus application is automatically started once. When the application has been booted up and is ready to start serving requests, the test execution is started.</p>
</li>
<li>
<p>Each test is executed against this running instance.</p>
</li>
<li>
<p>The Quarkus application is stopped.</p>
</li>

</ol>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>To minimize the impact of running tests in terms of performance, the Quarkus application is started only once, and then all test classes defined in the testing plan are executed against this running instance, so the application is not restarted for each test class 
<span class="keep-together">execution.</span></p>
</div>

<p>Open the <code>org.acme.quickstart.GreetingResourceTest.java</code> class located at <em>src/test/java</em> directory:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.junit.QuarkusTest</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.junit.jupiter.api.Test</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">io</code><code class="o">.</code><code class="na">restassured</code><code class="o">.</code><code class="na">RestAssured</code><code class="o">.</code><code class="na">given</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">hamcrest</code><code class="o">.</code><code class="na">CoreMatchers</code><code class="o">.</code><code class="na">is</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@QuarkusTest</code><code> </code><a class="co" id="co_programming_model_CO13-1" href="#callout_programming_model_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingResourceTest</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="nd">@Test</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">testHelloEndpoint</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">given</code><code class="o">(</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO13-2" href="#callout_programming_model_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>          </code><code class="o">.</code><code class="na">when</code><code class="o">(</code><code class="o">)</code><code>
</code><code>          </code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"/hello"</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO13-3" href="#callout_programming_model_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>          </code><code class="o">.</code><code class="na">then</code><code class="o">(</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO13-4" href="#callout_programming_model_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>             </code><code class="o">.</code><code class="na">statusCode</code><code class="o">(</code><code class="mi">200</code><code class="o">)</code><code>
</code><code>             </code><code class="o">.</code><code class="na">body</code><code class="o">(</code><code class="n">is</code><code class="o">(</code><code class="s">"hello"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO13-1" href="#co_programming_model_CO13-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets this test as a Quarkus test</p></dd>
<dt><a class="co" id="callout_programming_model_CO13-2" href="#co_programming_model_CO13-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>REST-Assured static method to start the validation</p></dd>
<dt><a class="co" id="callout_programming_model_CO13-3" href="#co_programming_model_CO13-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Sends a request using GET HTTP method to <code>/hello</code> path</p></dd>
<dt><a class="co" id="callout_programming_model_CO13-4" href="#co_programming_model_CO13-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Starts the assertion section</p></dd>
</dl>

<p>You can run the test from your IDE as well, as shown in <a data-type="xref" href="#testvscode">Figure 5-1</a>.</p>

<figure class="width-75"><div id="testvscode" class="figure">
<img src="Images/qucb_0501.png" alt="qucb 0501" width="651" height="675"/>
<h6><span class="label">Figure 5-1. </span>Visual Studio Code with Java integration</h6>
</div></figure>

<p>Or if you want to run the test in a terminal window, run the following:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile test
</code><code class="go">
</code><code class="go">[INFO] -------------------------------------------------------
</code><code class="go">[INFO]  T E S T S
</code><code class="go">[INFO] -------------------------------------------------------
</code><code class="go">[INFO] Running org.acme.quickstart.GreetingResourceTest
</code><code class="go">  INFO  [io.qua.dep.QuarkusAugmentor] (main) Beginning quarkus augmentation
</code><code class="go">  INFO  [io.qua.resteasy] (build-13) Resteasy running without servlet container.
</code><code class="go">  INFO  [io.qua.resteasy] (build-13) - Add quarkus-undertow to run Resteasy
</code><code class="go">                                       within a servlet container
</code><code class="go">  INFO  [io.qua.dep.QuarkusAugmentor] (main) Quarkus augmentation completed
</code><code class="go">                                             in 803ms
</code><code class="go">  INFO  [io.quarkus] (main) Quarkus 1.4.1.Final started in 0.427s.
</code><code class="go">                            Listening on: http://0.0.0.0:8081 </code><a class="co" id="co_programming_model_CO14-1" href="#callout_programming_model_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="go">
</code><code class="go">  INFO  [io.quarkus] (main) Profile test activated. </code><a class="co" id="co_programming_model_CO14-2" href="#callout_programming_model_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code class="go">
</code><code class="go">  INFO  [io.quarkus] (main) Installed features: [cdi, resteasy]
</code><code class="go">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.586 s
</code><code class="go">     - in org.acme.quickstart.GreetingResourceTest
</code><code class="go">2019-11-06 13:02:43,431 INFO  [io.quarkus] (main) Quarkus stopped in 0.053s
</code><code class="go">[INFO]
</code><code class="go">[INFO] Results:
</code><code class="go">[INFO]
</code><code class="go">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO14-1" href="#co_programming_model_CO14-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Quarkus listens on port 8081 when running tests</p></dd>
<dt><a class="co" id="callout_programming_model_CO14-2" href="#co_programming_model_CO14-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The <code>test</code> profile is activated</p></dd>
</dl>

<p>As you’ve seen in the previous example, port 8081 is the default port used when tests are executed.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128522389272">
<h2>Discussion</h2>

<p>You can change the port used by tests by setting the <code>quarkus.http.test-port</code> property to a different value:</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.http.test-port</code><code class="o">=</code><code class="s">8083</code></pre>

<p>Because Quarkus offers nice integration with REST-Assured, it automatically updates the port used, so no additional configuration is required in that part.</p>
<div data-type="tip"><h6>Tip</h6>
<p>In some scenarios, you might want to run tests in a random port instead of a specific one.
This is also supported by Quarkus; the only thing you need to set is the <code>quarkus.http.test-port</code> property to zero (<code>0</code>):</p>

<pre data-type="programlisting" data-code-language="properties"><code class="na">quarkus.http.test-port</code><code class="o">=</code><code class="s">0</code></pre>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile test</code>

<code class="go">INFO  [io.quarkus] (main) Quarkus 1.4.1.Final started in 0.442s.</code>
<code class="go">                          Listening on: http://0.0.0.0:49661</code>
<code class="go">INFO  [io.quarkus] (main) Profile test activated.</code>
<code class="go">INFO  [io.quarkus] (main) Installed features: [cdi, resteasy]</code></pre>
</div>

<p>Quarkus supports writing behavioral tests, which are tests that validate the functionality of a service without knowing or verifying the internals of the service.
 <a data-type="xref" href="#behavioral-testing-fig">Figure 5-2</a> shows the nature of behavioral testing.</p>

<p>In the case of REST APIs and microservices in general, you can understand a behavioral test as a form of test that follows the schema of sending a request to a running instance of the service and validating that the response is the expected one.</p>

<figure><div id="behavioral-testing-fig" class="figure">
<img src="Images/qucb_0502.png" alt="qucb 0502" width="526" height="159"/>
<h6><span class="label">Figure 5-2. </span>Behavioral testing</h6>
</div></figure>

<p>If you have scaffolded the project using any of the methods explained in <a data-type="xref" href="ch01.xhtml#quarkus_overview_chapter">Chapter 1</a>, you should already have a completed behavioral test, including the required dependencies registered at your build tool script.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128522081144">
<h2>See Also</h2>

<p><a data-type="indexterm" data-primary="" data-startref="bb_wr" id="idm45128522120920"/><a data-type="indexterm" data-primary="" data-startref="pm_bb" id="idm45128522120056"/><a data-type="indexterm" data-primary="JUnit 5" id="idm45128522119112"/><a data-type="indexterm" data-primary="REST-Assured" id="idm45128522118440"/>If you want to learn more about the underlying technologies used by the Quarkus testing framework, you can visit the following websites:</p>

<ul>
<li>
<p><a href="https://oreil.ly/oahZK">JBoss: JUnit 5 User Guide</a></p>
</li>
<li>
<p><a href="http://rest-assured.io">REST-Assured</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.15 Writing Unit Tests"><div class="sect1" id="writing_unit_tests">
<h1>5.15 Writing Unit Tests</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128522061112">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="unit tests, writing" id="idm45128522059880"/><a data-type="indexterm" data-primary="programming model" data-secondary="writing unit tests" id="idm45128522059176"/>You want to write unit tests to verify the correctness of the internals of the service.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128522057848">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="JUnit 5" id="idm45128522056280"/>Use the Quarkus testing solution based on <a href="https://oreil.ly/oahZK">JUnit 5</a> and its integration with CDI.</p>

<p>Quarkus allows you to inject CDI beans into your tests via the <code>@Inject</code> annotation.
In fact, under the covers, a test in Quarkus is just a CDI bean, so everything that it is valid in a bean is also valid in a test.</p>

<p><a data-type="indexterm" data-primary="Bean Validation" data-secondary="about" id="idm45128522053512"/>Let’s create a Greeting Service bean that uses Bean Validation to verify its input parameters.
Remember to add the <code>quarkus-hibernate-validator</code> extension.
Create a new class <code>org.acme.quickstart.GreetingService.java</code>:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.context.ApplicationScoped</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.constraints.Min</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@ApplicationScoped</code><code> </code><a class="co" id="co_programming_model_CO15-1" href="#callout_programming_model_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingService</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">greetingMessage</code><code class="o">(</code><code class="nd">@Min</code><code class="o">(</code><code class="n">value</code><code> </code><code class="o">=</code><code> </code><code class="mi">16</code><code class="o">)</code><code> </code><code class="kt">int</code><code> </code><code class="n">age</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO15-2" href="#callout_programming_model_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">age</code><code> </code><code class="o">&lt;</code><code> </code><code class="mi">19</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="k">return</code><code> </code><code class="s">"Hey boys and girls"</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code> </code><code class="k">else</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="k">return</code><code> </code><code class="s">"Hey ladies and gentlemen"</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO15-1" href="#co_programming_model_CO15-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets service as CDI bean</p></dd>
<dt><a class="co" id="callout_programming_model_CO15-2" href="#co_programming_model_CO15-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Adds validation in the method</p></dd>
</dl>

<p>Now, you want to test that Greeting Service works as expected in the next three cases:</p>

<ul>
<li>
<p>When the user age is less than 16, an exception is thrown.</p>
</li>
<li>
<p>When the user age is between 16 and 18, the teenager’s message is returned.</p>
</li>
<li>
<p>When the user age is greater than 18, return the message for adults.</p>
</li>
</ul>

<p><a data-type="indexterm" data-primary="AssertJ" id="idm45128521942776"/>We recommend that you use the <a href="https://oreil.ly/d5tI2">AssertJ</a> project to write readable assertions.
To use it, you need to register the AssertJ dependency in the build script:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="nt">&lt;dependency&gt;</code>
  <code class="nt">&lt;groupId&gt;</code>org.assertj<code class="nt">&lt;/groupId&gt;</code>
  <code class="nt">&lt;artifactId&gt;</code>assertj-core<code class="nt">&lt;/artifactId&gt;</code>
  <code class="nt">&lt;version&gt;</code>3.14.0<code class="nt">&lt;/version&gt;</code>
  <code class="nt">&lt;scope&gt;</code>test<code class="nt">&lt;/scope&gt;</code>
<code class="nt">&lt;/dependency&gt;</code></pre>

<p>Create a new class <code>org.acme.quickstart.GreetingService.java</code> at <em>src/test/java</em> directory:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.inject.Inject</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.validation.ConstraintViolationException</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.assertj.core.api.Assertions</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.junit.jupiter.api.Test</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.junit.QuarkusTest</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@QuarkusTest</code><code> </code><a class="co" id="co_programming_model_CO16-1" href="#callout_programming_model_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingServiceTest</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>  </code><code class="nd">@Inject</code><code> </code><a class="co" id="co_programming_model_CO16-2" href="#callout_programming_model_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>  </code><code class="n">GreetingService</code><code> </code><code class="n">greetingService</code><code class="o">;</code><code>
</code><code>
</code><code>  </code><code class="nd">@Test</code><code> </code><a class="co" id="co_programming_model_CO16-3" href="#callout_programming_model_CO16-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">testGreetingServiceForYoungers</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="n">Assertions</code><code class="o">.</code><code class="na">assertThatExceptionOfType</code><code class="o">(</code><code class="n">ConstraintViolationException</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO16-4" href="#callout_programming_model_CO16-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>      </code><code class="o">.</code><code class="na">isThrownBy</code><code class="o">(</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">-</code><code class="o">&gt;</code><code> </code><code class="n">greetingService</code><code class="o">.</code><code class="na">greetingMessage</code><code class="o">(</code><code class="mi">15</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="nd">@Test</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">testGreetingServiceForTeenagers</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">String</code><code> </code><code class="n">message</code><code> </code><code class="o">=</code><code> </code><code class="n">greetingService</code><code class="o">.</code><code class="na">greetingMessage</code><code class="o">(</code><code class="mi">18</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">Assertions</code><code class="o">.</code><code class="na">assertThat</code><code class="o">(</code><code class="n">message</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="s">"Hey boys and girls"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code>  </code><code class="nd">@Test</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">testGreetingServiceForAdult</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">String</code><code> </code><code class="n">message</code><code> </code><code class="o">=</code><code> </code><code class="n">greetingService</code><code class="o">.</code><code class="na">greetingMessage</code><code class="o">(</code><code class="mi">21</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">Assertions</code><code class="o">.</code><code class="na">assertThat</code><code class="o">(</code><code class="n">message</code><code class="o">)</code><code class="o">.</code><code class="na">isEqualTo</code><code class="o">(</code><code class="s">"Hey female and male"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO16-1" href="#co_programming_model_CO16-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Sets this test as a Quarkus test</p></dd>
<dt><a class="co" id="callout_programming_model_CO16-2" href="#co_programming_model_CO16-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Injects <code>GreetingService</code> instance</p></dd>
<dt><a class="co" id="callout_programming_model_CO16-3" href="#co_programming_model_CO16-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Executes tests using the Greeting Service instance created by CDI container</p></dd>
<dt><a class="co" id="callout_programming_model_CO16-4" href="#co_programming_model_CO16-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Uses AssertJ assertions</p></dd>
</dl>

<p>Try it by opening a new terminal window and running tests:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile test</code>

<code class="go">[INFO] Running org.acme.quickstart.GreetingResourceTest</code>
<code class="go"> INFO  [io.qua.dep.QuarkusAugmentor] (main) Beginning quarkus augmentation</code>
<code class="go"> INFO  [io.qua.resteasy] (build-3) Resteasy running without servlet container.</code>
<code class="go"> INFO  [io.qua.resteasy] (build-3) - Add quarkus-undertow to run Resteasy</code>
<code class="go">                                        within a servlet container</code>
<code class="go"> INFO  [io.qua.dep.QuarkusAugmentor] (main) Quarkus augmentation completed</code>
<code class="go">                                            in 813ms</code>
<code class="go"> INFO  [io.quarkus] (main) Quarkus 1.4.1.Final started in 0.715s.</code>
<code class="go">                     Listening on: http://0.0.0.0:51581</code>
<code class="go"> INFO  [io.quarkus] (main) Profile test activated.</code>
<code class="go"> INFO  [io.quarkus] (main) Installed features:</code>
<code class="go">                            [cdi, hibernate-validator, resteasy]</code>
<code class="go">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.614 s</code>
<code class="go">          - in org.acme.quickstart.GreetingResourceTest</code>
<code class="go">[INFO] Running org.acme.quickstart.GreetingServiceTest</code>
<code class="go">[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.086 s</code>
<code class="go">          - in org.acme.quickstart.GreetingServiceTest</code>
<code class="go">2019-11-06 16:16:11,503 INFO  [io.quarkus] (main) Quarkus stopped in 0.029s</code></pre>

<p>Notice that the Quarkus application is started once but both test classes are executed.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128522057256">
<h2>Discussion</h2>

<p>In the <a data-type="xref" href="#behavioral_tests">Recipe 5.14</a> recipe, you learned how to write tests using a behavioral approach in which you care only about requests and responses of the service.
However, more often than not, you want to validate what’s happening inside the service, or you want to validate how some pieces are behaving inside a running instance without having to mock the environment.
This is typically required when you want to validate that a business object works as expected, which includes its integration with the features provided by Quarkus (Bean Validation, CDI, etc.).</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128521689896">
<h2>See Also</h2>

<p>To learn more about AssertJ, visit the following web page:</p>

<ul>
<li>
<p><a href="https://oreil.ly/d5tI2">AssertJ: fluent assertions java library</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.16 Creating Mock Objects"><div class="sect1" id="idm45128521686600">
<h1>5.16 Creating Mock Objects</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128521737944">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="programming model" data-secondary="creating mock objects" id="idm45128521736712"/><a data-type="indexterm" data-primary="mock objects" id="idm45128521735736"/>You want to test classes that require extra processing time or need to communicate with external systems.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128521734552">
<h2>Solution</h2>

<p>Use mock support in Quarkus to provide CDI objects that mimic the behavior of real objects by replacing the default ones.</p>

<p><em>Mock objects</em> are simulated objects that simulate the behavior of real objects by providing some canned answer to a method call.</p>

<p>Let’s mock the Greeting Service that was created in the <a data-type="xref" href="#writing_unit_tests">Recipe 5.15</a> recipe.</p>

<p>Create a new class <code>org.acme.quickstart.MockedGreetingService.java</code> at <em>src/test/java</em> directory:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.Mock</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@Mock</code><code> </code><a class="co" id="co_programming_model_CO17-1" href="#callout_programming_model_CO17-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">MockedGreetingService</code><code>
</code><code>    </code><code class="kd">extends</code><code> </code><code class="n">GreetingService</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO17-2" href="#callout_programming_model_CO17-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>        </code><code class="nd">@Override</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="n">String</code><code> </code><code class="nf">greetingMessage</code><code class="o">(</code><code class="kt">int</code><code> </code><code class="n">age</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="k">return</code><code> </code><code class="s">"Hello World"</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO17-3" href="#callout_programming_model_CO17-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO17-1" href="#co_programming_model_CO17-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Mark POJO as a mocked class (alternative class) in CDI</p></dd>
<dt><a class="co" id="callout_programming_model_CO17-2" href="#co_programming_model_CO17-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The class must extend or implement the base service</p></dd>
<dt><a class="co" id="callout_programming_model_CO17-3" href="#co_programming_model_CO17-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Canned answer</p></dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128521540104">
<h2>Discussion</h2>

<p>Creating mocks is not only a great way to bypass external services and longer running processes, but also a simple way of testing particular scenarios.
In the previous solution, there could be two tests: one using the mock and the other using the actual object.
One would demonstrate the expected behavior by the service, and the other could demonstrate an expected failure.
This technique is especially useful for testing external service failures.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.17 Creating Mock Objects with Mockito"><div class="sect1" id="idm45128521537928">
<h1>5.17 Creating Mock Objects with Mockito</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128521505640">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="Mockito" id="idm45128521504632"/><a data-type="indexterm" data-primary="programming model" data-secondary="creating mock objects with Mockito" id="idm45128521504024"/>Using Mockito, you want to test classes that require extra processing time or need to communicate with external systems.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128521502648">
<h2>Solution</h2>

<p>Use the Mockito library to provide CDI objects that mimic the behavior of real objects by replacing the default ones.</p>

<p>Using Mockito, let’s mock the Greeting Service that was created in the <a data-type="xref" href="#writing_unit_tests">Recipe 5.15</a> recipe.</p>

<p>The first thing to do is add the Quarkus Mockito extension:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="nt">&lt;dependency&gt;</code>
  <code class="nt">&lt;groupId&gt;</code>io.quarkus<code class="nt">&lt;/groupId&gt;</code>
  <code class="nt">&lt;artifactId&gt;</code>quarkus-junit5-mockito<code class="nt">&lt;/artifactId&gt;</code>
  <code class="nt">&lt;scope&gt;</code>test<code class="nt">&lt;/scope&gt;</code>
<code class="nt">&lt;/dependency&gt;</code></pre>

<p>Create a new class <code>org.acme.quickstart.GreetingResourceTest.java</code> at <em>src/main/java</em> directory:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.junit.mockito.InjectMock</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.junit.jupiter.api.BeforeEach</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">static</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">mockito</code><code class="o">.</code><code class="na">Mockito</code><code class="o">.</code><code class="na">when</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@QuarkusTest</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">GreetingResourceTest</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>    </code><code class="nd">@InjectMock</code><code> </code><a class="co" id="co_programming_model_CO18-1" href="#callout_programming_model_CO18-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>    </code><code class="n">GreetingService</code><code> </code><code class="n">greetingService</code><code class="o">;</code><code>
</code><code>
</code><code>    </code><code class="nd">@BeforeEach</code><code> </code><a class="co" id="co_programming_model_CO18-2" href="#callout_programming_model_CO18-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">prepareMocks</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">when</code><code class="o">(</code><code class="n">greetingService</code><code class="o">.</code><code class="na">message</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code>
</code><code>                </code><code class="o">.</code><code class="na">thenReturn</code><code class="o">(</code><code class="s">"Aloha from Mockito"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Test</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">testHelloEndpoint</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">given</code><code class="o">(</code><code class="o">)</code><code>
</code><code>          </code><code class="o">.</code><code class="na">when</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">get</code><code class="o">(</code><code class="s">"/greeting"</code><code class="o">)</code><code>
</code><code>          </code><code class="o">.</code><code class="na">then</code><code class="o">(</code><code class="o">)</code><code>
</code><code>             </code><code class="o">.</code><code class="na">statusCode</code><code class="o">(</code><code class="mi">200</code><code class="o">)</code><code>
</code><code>             </code><code class="o">.</code><code class="na">body</code><code class="o">(</code><code class="n">is</code><code class="o">(</code><code class="s">"Aloha from Mockito"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO18-3" href="#callout_programming_model_CO18-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO18-1" href="#co_programming_model_CO18-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>InjectMock</code> makes this field a Mockito mock</p></dd>
<dt><a class="co" id="callout_programming_model_CO18-2" href="#co_programming_model_CO18-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Before each test execution, the mock expectations are recorded</p></dd>
<dt><a class="co" id="callout_programming_model_CO18-3" href="#co_programming_model_CO18-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>The message that is returned is the mocked one</p></dd>
</dl>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.18 Grouping Several Annotations into One with a Meta-Annotation"><div class="sect1" id="idm45128521359864">
<h1>5.18 Grouping Several Annotations into One <br/>with a Meta-Annotation</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128521358712">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="programming model" data-secondary="grouping annotations with meta-annotation" id="idm45128521357512"/><a data-type="indexterm" data-primary="annotations" id="idm45128521356568"/><a data-type="indexterm" data-primary="meta-annotation" id="idm45128521355896"/>You want to avoid the population of annotations in your application.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128521354840">
<h2>Solution</h2>

<p>Use meta-annotations to group several annotations into one.</p>

<p><a data-type="indexterm" data-primary="TransactionalQuarkusTest annotation" id="idm45128521353016"/><a data-type="indexterm" data-primary="@QuarkusTest annotation" id="idm45128521352152"/><a data-type="indexterm" data-primary="@Transactional annotation" id="idm45128521351448"/>You can develop a meta-annotation that contains all the annotations required by 
<span class="keep-together">the tests</span> or other portions of your application.
For example, you could create a 
<span class="keep-together"><code>TransactionalQuarkusTest</code></span> annotation that contains both <code>@QuarkusTest</code> and <code>@Transactional</code> annotations, making a Quarkus test transactional by default if this newly 
<span class="keep-together">created</span> annotation is used.</p>

<p>Create a new class called <code>org.acme.quickstart.TransactionalQuarkusTest.java</code> in the <em>src/test/java</em> directory:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.ElementType</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.Retention</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.RetentionPolicy</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.annotation.Target</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.enterprise.inject.Stereotype</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">javax.transaction.Transactional</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.junit.QuarkusTest</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@QuarkusTest</code><code> </code><a class="co" id="co_programming_model_CO19-1" href="#callout_programming_model_CO19-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="nd">@Transactional</code><code>
</code><code class="nd">@Stereotype</code><code> </code><a class="co" id="co_programming_model_CO19-2" href="#callout_programming_model_CO19-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code class="nd">@Retention</code><code class="o">(</code><code class="n">RetentionPolicy</code><code class="o">.</code><code class="na">RUNTIME</code><code class="o">)</code><code>
</code><code class="nd">@Target</code><code class="o">(</code><code class="n">ElementType</code><code class="o">.</code><code class="na">TYPE</code><code class="o">)</code><code>
</code><code class="kd">public</code><code> </code><code class="nd">@interface</code><code> </code><code class="n">TransactionalQuarkusTest</code><code> </code><code class="o">{</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO19-1" href="#co_programming_model_CO19-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Adds the annotations that this meta-annotation might “inherit”</p></dd>
<dt><a class="co" id="callout_programming_model_CO19-2" href="#co_programming_model_CO19-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Sets the annotation as a stereotype (meta-annotation)</p></dd>
</dl>

<p>If you then apply this annotation to a class, it will be like you had applied both the <code>@QuarkusTest</code> and the <code>@Transactional</code> annotations:</p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@TransactionalQuarkusTest</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">DeveloperDAO</code> <code class="o">{</code>
<code class="o">}</code></pre>

<p>Notice that now the test is more readable and the annotations are reusable.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128521200184">
<h2>Discussion</h2>

<p>Quarkus tests are CDI beans, and for this reason, you can apply CDI interceptors.
For example, you could make your test become transactional by using the transactional interceptor.
This interceptor is enabled by annotating the test class with <code>@javax.transaction.Transactional</code>.
So, a transactional test might look like the 
<span class="keep-together">following:</span></p>

<pre data-type="programlisting" data-code-language="java"><code class="nd">@QuarkusTest</code>
<code class="nd">@Transactional</code>
<code class="kd">public</code> <code class="kd">class</code> <code class="nc">DeveloperDAO</code> <code class="o">{</code>
<code class="o">}</code></pre>

<p>Of course, this is perfectly valid, but there are two scenarios in which multiple annotations on the class might impact the readability of your test:</p>
<ol>
<li>
<p>Your test requires more annotations—for example, JUnit 5 annotations like <code>@TestMethodOrder</code> to define the order execution of tests, or you need to enable other interceptors for the test. In these cases, you can end up setting more annotations than code.</p>
</li>
<li>
<p>You have a lot of tests that require the same annotations, so you continuously annotate, in most of the cases, all tests with the same annotations.</p>
</li>

</ol>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.19 Executing Code Before or After a Test"><div class="sect1" id="idm45128521173960">
<h1>5.19 Executing Code Before or After a Test</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128521172712">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="programming model" data-secondary="executing code before/after tests" id="pm_cod"/>You want to execute some logic before/after the test suite to start/stop/configure a resource for the test.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128521169784">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="Quarkus Test Resource extension" id="idm45128521168216"/>Use the <em>Quarkus Test Resource</em> extension mechanism to define the required resources to execute the tests.</p>

<p>Quarkus provides an extension mechanism that allows you to execute Java code before the test suite is started and after the test suite has finished.
Furthermore, it allows you to create/override configuration properties programmatically so that any parameter required by the resource can be set in the test resource class instead of having to modify the <em>application.properties</em> file.</p>

<p>Let’s write a simple Quarkus Test Resource that just prints some messages.</p>

<p>Create a new class named <code>org.acme.quickstart.HelloWorldQuarkusTestResourceLifecycleManager</code> implementing <code>io.quarkus.test.common.QuarkusTestResourceLifecycleManager</code> interface at <em>src/test/java</em> directory:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Collections</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Map</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.common.QuarkusTestResourceLifecycleManager</code><code class="o">;</code><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">HelloWorldQuarkusTestResourceLifecycleManager</code><code>
</code><code>    </code><code class="kd">implements</code><code> </code><code class="n">QuarkusTestResourceLifecycleManager</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO20-1" href="#callout_programming_model_CO20-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">start</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO20-2" href="#callout_programming_model_CO20-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Start Test Suite execution"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">Collections</code><code class="o">.</code><code class="na">emptyMap</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO20-3" href="#callout_programming_model_CO20-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">stop</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO20-4" href="#callout_programming_model_CO20-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Stop Test Suite execution"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">inject</code><code class="o">(</code><code class="n">Object</code><code> </code><code class="n">testInstance</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO20-5" href="#callout_programming_model_CO20-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Executing "</code><code> </code><code class="o">+</code><code> </code><code class="n">testInstance</code><code class="o">.</code><code class="na">getClass</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getName</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">int</code><code> </code><code class="nf">order</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO20-6" href="#callout_programming_model_CO20-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="mi">0</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO20-1" href="#co_programming_model_CO20-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Must implement <code>QuarkusTestResourceLifecycleManager</code></p></dd>
<dt><a class="co" id="callout_programming_model_CO20-2" href="#co_programming_model_CO20-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The method that is executed before the test suite</p></dd>
<dt><a class="co" id="callout_programming_model_CO20-3" href="#co_programming_model_CO20-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p><code>Map</code> object with system properties to be used</p></dd>
<dt><a class="co" id="callout_programming_model_CO20-4" href="#co_programming_model_CO20-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>The method that is executed after the test suite</p></dd>
<dt><a class="co" id="callout_programming_model_CO20-5" href="#co_programming_model_CO20-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>For each test class execution, this method is invoked, passing the test instance so that you can inject specific fields</p></dd>
<dt><a class="co" id="callout_programming_model_CO20-6" href="#co_programming_model_CO20-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Sets the order of execution in case multiple resources are defined</p></dd>
</dl>

<p>Finally, you need to register this extension to be executed during the test suite execution.
To do that, you need to use the <code>QuarkusTestResource</code> annotation in any class placed within the <em>src/test/java</em> directory and set the test resource to be started.
Although it could be any test class responsible for registering the resource, we recommend you create a specific empty class that registers the test resource.</p>

<p>Create a new class <code>org.acme.quickstart.HelloWorldTestResource</code> in <em>src/test/java</em> with the following content:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.common.QuarkusTestResource</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@QuarkusTestResource</code><code class="o">(</code><code class="n">HelloWorldQuarkusTestResourceLifecycleManager</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO21-1" href="#callout_programming_model_CO21-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">HelloWorldTestResource</code><code> </code><code class="o">{</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO21-1" href="#co_programming_model_CO21-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Registers the test resource</p></dd>
</dl>

<p>Then run the tests in a terminal, and you’ll see something similar as terminal output:</p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean compile test
</code><code class="go">
</code><code class="go">INFO] -------------------------------------------------------
</code><code class="go">[INFO]  T E S T S
</code><code class="go">[INFO] -------------------------------------------------------
</code><code class="go">[INFO] Running org.acme.quickstart.GreetingResourceTest
</code><code class="go">Start Test Suite execution </code><a class="co" id="co_programming_model_CO22-1" href="#callout_programming_model_CO22-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="go">
</code><code class="go"> INFO  [io.qua.dep.QuarkusAugmentor] (main) Beginning quarkus augmentation
</code><code class="go"> INFO  [io.qua.dep.QuarkusAugmentor] (main) Quarkus augmentation completed
</code><code class="go">                                            in 756ms
</code><code class="go"> INFO  [io.quarkus] (main) Quarkus 1.4.1.Final started in 0.381s.
</code><code class="go">                    Listening on: http://0.0.0.0:8081
</code><code class="go"> INFO  [io.quarkus] (main) Profile test activated.
</code><code class="go"> INFO  [io.quarkus] (main) Installed features: [cdi, resteasy]
</code><code class="go">Executing org.acme.quickstart.GreetingResourceTest </code><a class="co" id="co_programming_model_CO22-2" href="#callout_programming_model_CO22-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code class="go">
</code><code class="go">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.058 s
</code><code class="go">        - in org.acme.quickstart.GreetingResourceTest
</code><code class="go">Stop Test Suite execution </code><a class="co" id="co_programming_model_CO22-3" href="#callout_programming_model_CO22-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code class="go">
</code><code class="go">2019-11-08 16:57:01,020 INFO  [io.quarkus] (main) Quarkus stopped in 0.027s</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO22-1" href="#co_programming_model_CO22-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p><code>start</code> method is invoked before Quarkus is started</p></dd>
<dt><a class="co" id="callout_programming_model_CO22-2" href="#co_programming_model_CO22-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p><code>inject</code> method is invoked before <code>GreetingResourceTest</code> is run</p></dd>
<dt><a class="co" id="callout_programming_model_CO22-3" href="#co_programming_model_CO22-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p><code>stop</code> method is invoked after all tests have been executed</p></dd>
</dl>

<p>This example is not very usable; however, it is simple to understand the test life cycle, but nothing more.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128521169192">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="Keycloak" id="idm45128520784968"/>As you move forward, the complexity of your tests (integration tests, end-to-end tests, etc.) and the required dependencies to run them increases.
For example, the tests might require a database instance, a Kafka broker, a JMS queue, or an identity provider like Keycloak.</p>

<p>With this background, let’s write a more interesting test resource that uses Docker to boot up a MariaDB Docker container.</p>

<p><a data-type="indexterm" data-primary="Testcontainers" id="idm45128520783160"/>For this example, you are going to use the <a href="https://oreil.ly/aEeAV">Testcontainers</a> test framework; at the time of writing, the latest version is 1.14.3.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm45128520781672">
<h5>About Test Containers</h5>
<p>Testcontainers is a Java library that supports JUnit tests, providing lightweight, throwaway instances of Docker containers.
Testcontainers manages the life cycle of each of these containers, so you can start and stop them programmatically.</p>

<p><a data-type="indexterm" data-primary="Docker containers" data-secondary="about" id="idm45128520780024"/>You might use Docker containers in tests in the following circumstances:</p>

<ul>
<li>
<p>Data access layer integration tests in which you containerize the database servers (i.e., PostgreSQL, MySQL, or Oracle)</p>
</li>
<li>
<p>Application integration tests requiring some external dependencies such as web-servers or messaging systems like Kafka</p>
</li>
<li>
<p>UI/Acceptance tests where you containerize the web browsers so every test runs in a fresh instance of the browser</p>
</li>
</ul>
</div></aside>

<p><a data-type="indexterm" data-primary="MariaDB" id="idm45128520775592"/>Before running tests, you need to have Docker installed in your machine so Testcontainers can boot up the MariaDB container locally.</p>

<p>The first step in developing the Testcontainers Quarkus Test Resource is registering the Testcontainers dependency in your build tool for using the MariaDB Docker 
<span class="keep-together">container</span> in your test:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="nt">&lt;dependency&gt;</code>
  <code class="nt">&lt;groupId&gt;</code>org.testcontainers<code class="nt">&lt;/groupId&gt;</code>
  <code class="nt">&lt;artifactId&gt;</code>mariadb<code class="nt">&lt;/artifactId&gt;</code>
  <code class="nt">&lt;version&gt;</code>${testcontainers.version}<code class="nt">&lt;/version&gt;</code>
  <code class="nt">&lt;scope&gt;</code>test<code class="nt">&lt;/scope&gt;</code>
<code class="nt">&lt;/dependency&gt;</code>
<code class="nt">&lt;dependency&gt;</code>
  <code class="nt">&lt;groupId&gt;</code>io.quarkus<code class="nt">&lt;/groupId&gt;</code>
  <code class="nt">&lt;artifactId&gt;</code>quarkus-jdbc-mariadb<code class="nt">&lt;/artifactId&gt;</code>
<code class="nt">&lt;/dependency&gt;</code></pre>

<p>The implementation of <code>QuarkusTestResourceLifecycleManager</code> is as 
<span class="keep-together">follows:</span></p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.HashMap</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.Map</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.acme.quickstart.MariaDbTestResource.Initializer</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.testcontainers.containers.MariaDBContainer</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.common.QuarkusTestResource</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.common.QuarkusTestResourceLifecycleManager</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@QuarkusTestResource</code><code class="o">(</code><code class="n">Initializer</code><code class="o">.</code><code class="na">class</code><code class="o">)</code><code> </code><a class="co" id="co_programming_model_CO23-1" href="#callout_programming_model_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">MariaDbTestResource</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>  </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kd">class</code><code> </code><code class="nc">Initializer</code><code>
</code><code>      </code><code class="kd">implements</code><code> </code><code class="n">QuarkusTestResourceLifecycleManager</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO23-2" href="#callout_programming_model_CO23-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">MariaDBContainer</code><code> </code><code class="n">mariaDBContainer</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO23-3" href="#callout_programming_model_CO23-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">start</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>
</code><code>      </code><code class="k">this</code><code class="o">.</code><code class="na">mariaDBContainer</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">MariaDBContainer</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="s">"mariadb:10.4.4"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO23-4" href="#callout_programming_model_CO23-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a><code>
</code><code>      </code><code class="k">this</code><code class="o">.</code><code class="na">mariaDBContainer</code><code class="o">.</code><code class="na">start</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><a class="co" id="co_programming_model_CO23-5" href="#callout_programming_model_CO23-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a><code>
</code><code>
</code><code>      </code><code class="k">return</code><code> </code><code class="nf">getConfigurationParameters</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">getConfigurationParameters</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO23-6" href="#callout_programming_model_CO23-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a><code>
</code><code>      </code><code class="kd">final</code><code> </code><code class="n">Map</code><code class="o">&lt;</code><code class="n">String</code><code class="o">,</code><code> </code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">conf</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HashMap</code><code class="o">&lt;</code><code class="o">&gt;</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>      </code><code class="n">conf</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"quarkus.datasource.url"</code><code class="o">,</code><code> </code><code class="k">this</code><code class="o">.</code><code class="na">mariaDBContainer</code><code class="o">.</code><code class="na">getJdbcUrl</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>      </code><code class="n">conf</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"quarkus.datsource.username"</code><code class="o">,</code><code> </code><code class="k">this</code><code class="o">.</code><code class="na">mariaDBContainer</code><code>
</code><code>                                                  </code><code class="o">.</code><code class="na">getUsername</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>      </code><code class="n">conf</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"quarkus.datasource.password"</code><code class="o">,</code><code> </code><code class="k">this</code><code class="o">.</code><code class="na">mariaDBContainer</code><code>
</code><code>                                                    </code><code class="o">.</code><code class="na">getPassword</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>      </code><code class="n">conf</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"quarkus.datasource.driver"</code><code class="o">,</code><code> </code><code class="k">this</code><code class="o">.</code><code class="na">mariaDBContainer</code><code>
</code><code>                                                  </code><code class="o">.</code><code class="na">getDriverClassName</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>
</code><code>      </code><code class="k">return</code><code> </code><code class="n">conf</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="nd">@Override</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">stop</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>      </code><code class="k">if</code><code> </code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">mariaDBContainer</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">this</code><code class="o">.</code><code class="na">mariaDBContainer</code><code class="o">.</code><code class="na">close</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_programming_model_CO23-7" href="#callout_programming_model_CO23-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a><code>
</code><code>      </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>  </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO23-1" href="#co_programming_model_CO23-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Registers the test resource</p></dd>
<dt><a class="co" id="callout_programming_model_CO23-2" href="#co_programming_model_CO23-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Defines the test resource interface</p></dd>
<dt><a class="co" id="callout_programming_model_CO23-3" href="#co_programming_model_CO23-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Sets MariaDB container object</p></dd>
<dt><a class="co" id="callout_programming_model_CO23-4" href="#co_programming_model_CO23-4"><img src="Images/4.png" alt="4" width="12" height="12"/></a></dt>
<dd><p>Instantiate MariaDB container with required Docker image</p></dd>
<dt><a class="co" id="callout_programming_model_CO23-5" href="#co_programming_model_CO23-5"><img src="Images/5.png" alt="5" width="12" height="12"/></a></dt>
<dd><p>Starts the container and waits until the container is accepting connections</p></dd>
<dt><a class="co" id="callout_programming_model_CO23-6" href="#co_programming_model_CO23-6"><img src="Images/6.png" alt="6" width="12" height="12"/></a></dt>
<dd><p>Overrides Quarkus’s configuration to point database connection to the container one</p></dd>
<dt><a class="co" id="callout_programming_model_CO23-7" href="#co_programming_model_CO23-7"><img src="Images/7.png" alt="7" width="12" height="12"/></a></dt>
<dd><p>Stops the container</p></dd>
</dl>

<p>Finally, run the tests in a terminal. You’ll see something like this in the terminal 
<span class="keep-together">output:</span></p>

<pre data-type="programlisting" data-code-language="shell-session"><code class="go">./mvnw clean test
</code><code class="go">
</code><code class="go">[INFO] -------------------------------------------------------
</code><code class="go">[INFO]  T E S T S
</code><code class="go">[INFO] -------------------------------------------------------
</code><code class="go">[INFO] Running org.acme.quickstart.GreetingResourceTest
</code><code class="go">        ℹ︎ Checking the system...
</code><code class="go">        ✔ Docker version should be at least 1.6.0
</code><code class="go">        ✔ Docker environment should have more than 2GB free disk space
</code><code class="go">Start Test Suite execution
</code><code class="go"> INFO  [org.tes.doc.DockerClientProviderStrategy] (main)
</code><code class="go">        Loaded org.testcontainers.dockerclient
</code><code class="go">                     .UnixSocketClientProviderStrategy
</code><code class="go">        from ~/.testcontainers.properties, will try it first
</code><code class="go">...
</code><code class="go"> INFO  [ߐ㠮4.4]] (main) Creating container for image: mariadb:10.4.4 </code><a class="co" id="co_programming_model_CO24-1" href="#callout_programming_model_CO24-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code class="go">
</code><code class="go"> INFO  [ߐ㠮4.4]] (main) Starting container with ID:
</code><code class="go">        0d07d45111b1103fd7e64ac2050320ee329ca14eb46a72d525f61bc5e433dc69
</code><code class="go"> INFO  [ߐ㠮4.4]] (main) Container mariadb:10.4.4 is starting:
</code><code class="go">        0d07d45111b1103fd7e64ac2050320ee329ca14eb46a72d525f61bc5e433dc69
</code><code class="go"> INFO  [ߐ㠮4.4]] (main) Waiting for database connection to become available at
</code><code class="go">        jdbc:mariadb://localhost:32773/test using query 'SELECT 1'
</code><code class="go"> INFO  [ߐ㠮4.4]] (main) Container is started
</code><code class="go">        (JDBC URL: jdbc:mariadb://localhost:32773/test)
</code><code class="go"> INFO  [ߐ㠮4.4]] (main) Container mariadb:10.4.4 started </code><a class="co" id="co_programming_model_CO24-2" href="#callout_programming_model_CO24-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code class="go">
</code><code class="go"> INFO  [io.qua.dep.QuarkusAugmentor] (main) Beginning quarkus augmentation
</code><code class="go"> INFO  [io.qua.dep.QuarkusAugmentor] (main) Quarkus augmentation completed
</code><code class="go">                                                 in 1461ms
</code><code class="go"> INFO  [io.quarkus] (main) Quarkus 1.4.1.Final started in 0.909s.
</code><code class="go">                        Listening on: http://0.0.0.0:8081
</code><code class="go"> INFO  [io.quarkus] (main) Profile test activated.
</code><code class="go"> INFO  [io.quarkus] (main) Installed features: [cdi, jdbc-mariadb, resteasy]
</code><code class="go">Executing org.acme.quickstart.GreetingResourceTest
</code><code class="go">[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 32.666 s
</code><code class="go">        - in org.acme.quickstart.GreetingResourceTest
</code><code class="go">Stop Test Suite execution
</code><code class="go">2019-11-12 11:57:27,758 INFO  [io.quarkus] (main) Quarkus stopped in 0.043s</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO24-1" href="#co_programming_model_CO24-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>MariaDB Docker container is created</p></dd>
<dt><a class="co" id="callout_programming_model_CO24-2" href="#co_programming_model_CO24-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Container is up and running and ready to receive incoming requests</p></dd>
</dl>
<div data-type="tip"><h6>Tip</h6>
<p>You can develop Quarkus Test Resources in a separate project and package them as an external JAR library. You can then reuse them in as many projects as required.</p>
</div>

<p>Quarkus provides the following default Quarkus Test Resource implementations:</p>
<dl>
<dt><code>H2DatabaseTestResource</code></dt>
<dd>
<p>For starting/stopping H2 database in server mode</p>
</dd>
<dt><code>DerbyDatabaseTestResource</code></dt>
<dd>
<p>For starting/stopping Derby database in server mode</p>
</dd>
<dt><code>InfinispanEmbeddedTestResource</code></dt>
<dd>
<p>For starting/stopping Infinispan in embedded mode</p>
</dd>
<dt><code>InfinispanServerTestResource</code></dt>
<dd>
<p>For starting/stopping Infinispan in server mode</p>
</dd>
<dt><code>KeycloakTestResource</code></dt>
<dd>
<p>For starting/stopping Keycloak identity provider</p>
</dd>
<dt><code>ArtemisTestResource</code></dt>
<dd>
<p>For starting/stopping Embedded ActiveMQ</p>
</dd>
<dt><code>KafkaTestResource</code></dt>
<dd>
<p>For starting/stopping a Kafka cluster using Debezium classes</p>
</dd>
<dt><code>KubernetesMockServerTestResource</code></dt>
<dd>
<p>For starting/stopping Kubernetes Mock server</p>
</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="See Also"><div class="sect2" id="idm45128520809256">
<h2>See Also</h2>

<p><a data-type="indexterm" data-primary="Testcontainers" id="idm45128520421944"/><a data-type="indexterm" data-primary="" data-startref="pm_cod" id="idm45128520421240"/>You can learn more about how to install Docker in your local machine and find more examples about Testcontainers test framework at the following:</p>

<ul>
<li>
<p><a href="https://oreil.ly/WrfY8">Docker: Get Docker</a></p>
</li>
<li>
<p><a href="https://oreil.ly/aEeAV">Testcontainers</a></p>
</li>
</ul>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="5.20 Testing the Native Executable"><div class="sect1" id="idm45128520395848">
<h1>5.20 Testing the Native Executable</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="idm45128520394840">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="native executable files" id="nef_ch"/><a data-type="indexterm" data-primary="programming model" data-secondary="testing native executable" id="pm_nef"/><a data-type="indexterm" data-primary="testing" data-secondary="native executable files" id="tes_nef"/>You want to test that the native executable is correct.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="idm45128520389784">
<h2>Solution</h2>

<p><a data-type="indexterm" data-primary="NativeImageTest annotation" id="idm45128520388216"/>Use <code>NativeImageTest</code> annotation to start the application from the native file instead of using the JVM.</p>

<p>If you plan to produce a native executable of your application, it is always a good idea to write some behavioral tests against the application running in the native 
<span class="keep-together">executable.</span></p>

<p>Quarkus provides the <code>NativeImageTest</code> annotation to start the application from the native file instead of using the JVM.
It is important to note that you must generate the native executable before running the tests or using the <code>quarkus.package.type</code> system property to generate the native executable before running the tests.
You can learn more about how to generate a native executable in the <a data-type="xref" href="ch06.xhtml#native_executable">Recipe 6.4</a> recipe.</p>

<p>If the project is scaffolded using any of the methods explained before, a native 
<span class="keep-together">executable</span> test is already provided.</p>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p><a data-type="indexterm" data-primary="JVM mode" id="idm45128520380984"/>It is not possible to mix JVM and native image tests in the same test suite.
The JVM tests must be run in a different cycle than the native tests (e.g., in Maven, this would be <code>surefire</code> for JVM tests and <code>failsafe</code> for native tests).</p>
</div>

<p>This configuration is provided by default when a project is scaffolded by any of the methods explained earlier:</p>

<pre data-type="programlisting" data-code-language="xml"><code class="nt">&lt;profile</code><code class="nt">&gt;</code><code>
  </code><code class="nt">&lt;id</code><code class="nt">&gt;</code><code>native</code><code class="nt">&lt;/id&gt;</code><code>
  </code><code class="nt">&lt;activation</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;property</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;name</code><code class="nt">&gt;</code><code>native</code><code class="nt">&lt;/name&gt;</code><code>
    </code><code class="nt">&lt;/property&gt;</code><code>
  </code><code class="nt">&lt;/activation&gt;</code><code>
  </code><code class="nt">&lt;build</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;plugins</code><code class="nt">&gt;</code><code>
      </code><code class="nt">&lt;plugin</code><code class="nt">&gt;</code><code>
        </code><code class="nt">&lt;artifactId</code><code class="nt">&gt;</code><code>maven-failsafe-plugin</code><code class="nt">&lt;/artifactId&gt;</code><code>
        </code><code class="nt">&lt;version</code><code class="nt">&gt;</code><code>${surefire-plugin.version}</code><code class="nt">&lt;/version&gt;</code><code>
        </code><code class="nt">&lt;executions</code><code class="nt">&gt;</code><code>
          </code><code class="nt">&lt;execution</code><code class="nt">&gt;</code><code>
            </code><code class="nt">&lt;goals</code><code class="nt">&gt;</code><code>
              </code><code class="nt">&lt;goal</code><code class="nt">&gt;</code><code>integration-test</code><code class="nt">&lt;/goal&gt;</code><code>
              </code><code class="nt">&lt;goal</code><code class="nt">&gt;</code><code>verify</code><code class="nt">&lt;/goal&gt;</code><code> </code><a class="co" id="co_programming_model_CO25-1" href="#callout_programming_model_CO25-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
            </code><code class="nt">&lt;/goals&gt;</code><code>
            </code><code class="nt">&lt;configuration</code><code class="nt">&gt;</code><code>
              </code><code class="nt">&lt;systemProperties</code><code class="nt">&gt;</code><code>
                </code><code class="nt">&lt;native.image.path</code><code class="nt">&gt;</code><code>
                  ${project.build.directory}/
                  ${project.build.finalName}-runner
                </code><code class="nt">&lt;/native.image.path&gt;</code><code> </code><a class="co" id="co_programming_model_CO25-2" href="#callout_programming_model_CO25-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
              </code><code class="nt">&lt;/systemProperties&gt;</code><code>
            </code><code class="nt">&lt;/configuration&gt;</code><code>
          </code><code class="nt">&lt;/execution&gt;</code><code>
        </code><code class="nt">&lt;/executions&gt;</code><code>
      </code><code class="nt">&lt;/plugin&gt;</code><code>
    </code><code class="nt">&lt;/plugins&gt;</code><code>
  </code><code class="nt">&lt;/build&gt;</code><code>
  </code><code class="nt">&lt;properties</code><code class="nt">&gt;</code><code>
    </code><code class="nt">&lt;quarkus.package.type</code><code class="nt">&gt;</code><code>
        native
    </code><code class="nt">&lt;/quarkus.package.type&gt;</code><code> </code><a class="co" id="co_programming_model_CO25-3" href="#callout_programming_model_CO25-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a><code>
  </code><code class="nt">&lt;/properties&gt;</code><code>
</code><code class="nt">&lt;/profile&gt;</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO25-1" href="#co_programming_model_CO25-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Native tests are run in <code>verify</code> goal (<code>./mvnw verify</code>)</p></dd>
<dt><a class="co" id="callout_programming_model_CO25-2" href="#co_programming_model_CO25-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>The location of the produced native executable (the line should not be split in the pom)</p></dd>
<dt><a class="co" id="callout_programming_model_CO25-3" href="#co_programming_model_CO25-3"><img src="Images/3.png" alt="3" width="12" height="12"/></a></dt>
<dd><p>Produces a native executable before running tests</p></dd>
</dl>

<p>Open the <code>org.acme.quickstart.NativeGreetingResourceIT.java</code> class located at <em>src/test/java</em> directory:</p>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">org</code><code class="o">.</code><code class="na">acme</code><code class="o">.</code><code class="na">quickstart</code><code class="o">;</code><code>
</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">io.quarkus.test.junit.NativeImageTest</code><code class="o">;</code><code>
</code><code>
</code><code class="nd">@NativeImageTest</code><code> </code><a class="co" id="co_programming_model_CO26-1" href="#callout_programming_model_CO26-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">NativeGreetingResourceIT</code><code>
</code><code>    </code><code class="kd">extends</code><code> </code><code class="n">GreetingResourceTest</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_programming_model_CO26-2" href="#callout_programming_model_CO26-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a><code>
</code><code>
</code><code>    </code><code class="c1">// Execute the same tests but in native mode.
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_programming_model_CO26-1" href="#co_programming_model_CO26-1"><img src="Images/1.png" alt="1" width="12" height="12"/></a></dt>
<dd><p>Starts the native executable located at <code>native.image.path</code>.</p></dd>
<dt><a class="co" id="callout_programming_model_CO26-2" href="#co_programming_model_CO26-2"><img src="Images/2.png" alt="2" width="12" height="12"/></a></dt>
<dd><p>Extends JVM tests to make them run against native executable. This is not mandatory; you can write your tests, but remember to annotate them with 
<span class="keep-together"><code>@QuarkusTest</code>.</span> This will run the same test but against the native executable.</p></dd>
</dl>
<div data-type="warning" epub:type="warning"><h6>Warning</h6>
<p>All testing features showed in this section are valid except injecting into tests.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="idm45128520389192">
<h2>Discussion</h2>

<p>There are some things that you need to take into consideration when writing native tests<a data-type="indexterm" data-primary="" data-startref="pro_ch" id="idm45128520098232"/><a data-type="indexterm" data-primary="" data-startref="nef_ch" id="idm45128520070872"/><a data-type="indexterm" data-primary="" data-startref="pm_nef" id="idm45128520070024"/><a data-type="indexterm" data-primary="" data-startref="tes_nef" id="idm45128520069176"/>:</p>
<ol>
<li>
<p>Quarkus waits for 60 seconds for the native image to start before automatically failing the native tests. This duration can be changed using the <code>quarkus.test.native-image-wait-time</code> property (i.e., <code>./mvnw verify</code> 
<span class="keep-together"><code>-Pnative -Dquarkus.test.native-image-wait-time=200</code>).</span></p>
</li>
<li>
<p>Native tests run on <code>prod</code> profile; if you want to change that, you can use the <code>quarkus.test.native-image-profile</code> property to set an alternative profile.</p>
</li>
<li>
<p>You can disable certain test methods (or classes) to be able to run them in native tests by annotating them with the <code>io.quarkus.test.junit.DisabledOnNativeImage</code> annotation (i.e., <code>@DisabledOnNativeImage @Test public void</code> <code>n⁠o⁠n⁠N⁠a⁠t⁠i⁠v⁠e⁠T⁠e⁠s⁠t⁠(⁠)⁠{⁠}</code>).</p>
</li>

</ol>
</div></section>





</div></section>







</div></section></div>



  </body></html>