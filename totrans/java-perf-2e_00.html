<html><head></head><body><section data-pdf-bookmark="Preface" data-type="preface" epub:type="preface"><div class="preface" id="idm45775551327304">&#13;
<h1>Preface</h1>&#13;
&#13;
&#13;
<p>When O’Reilly first approached me about writing a book on Java performance&#13;
tuning, I was unsure. Java performance, I thought—aren’t we done&#13;
with that? Yes, I still work on improving the performance of Java (and other) applications&#13;
on a daily basis, but I like to think that I spend most of my time dealing&#13;
with algorithmic inefficiencies and external system bottlenecks rather&#13;
than on anything&#13;
directly related to Java tuning.</p>&#13;
&#13;
<p>A moment’s reflection convinced me that I was (as usual) kidding myself. It&#13;
is certainly true that end-to-end system performance takes up a lot of my&#13;
time, and that I sometimes come across code that uses an <math alttext="upper O left-parenthesis n squared right-parenthesis">&#13;
  <mrow>&#13;
    <mi>O</mi>&#13;
    <mo>(</mo>&#13;
    <msup><mrow><mi>n</mi></mrow> <mn>2</mn> </msup>&#13;
    <mo>)</mo>&#13;
  </mrow>&#13;
</math> algorithm&#13;
when it could use one with <em>O(logN)</em> performance. Still, it turns out that&#13;
every day I&#13;
think about garbage collection (GC) performance, or the performance of the JVM compiler, or how&#13;
to get the best performance from Java APIs.</p>&#13;
&#13;
<p>That is not to minimize the enormous progress that has been made in the&#13;
performance of Java and JVMs over the past 20-plus years. When I was a Java&#13;
evangelist at Sun during the late 1990s, the only real “benchmark” available&#13;
was CaffeineMark 2.0 from Pendragon software. For a variety of reasons,&#13;
the design of that benchmark quickly limited its value;&#13;
yet in its day, we were fond of telling&#13;
everyone that Java 1.1.8 performance was eight times faster than Java 1.0&#13;
performance based on that benchmark. And that was true—Java 1.1.8 had an&#13;
actual just-in-time compiler, whereas Java 1.0 was pretty much completely&#13;
interpreted.</p>&#13;
&#13;
<p>Then standards committees began to develop more rigorous benchmarks, and&#13;
Java performance began to be centered around them. The result was a&#13;
continuous improvement in all areas of the JVM—garbage collection,&#13;
compilations, and within the APIs. That process continues today, of&#13;
course, but one of the interesting facts about performance work is that it&#13;
gets successively harder. Achieving an eightfold increase in performance by&#13;
introducing a just-in-time compiler was a straightforward matter of&#13;
engineering, and even though the compiler continues to improve, we’re not&#13;
going to see an improvement like that again. Parallelizing the garbage&#13;
collector was a huge performance improvement, but more recent changes&#13;
have been more <span class="keep-together">&#13;
incremental.</span></p>&#13;
&#13;
<p>This is a typical process for applications (and the JVM itself is just&#13;
another application): in the beginning of a project, it’s easy enough&#13;
to find architectural changes (or code bugs) that, when addressed, yield&#13;
huge performance improvements. In a mature application, finding such&#13;
performance improvements is rare.</p>&#13;
&#13;
<p>That precept was behind my original concern that, to a large extent,&#13;
the engineering world might be done with Java performance. A few things&#13;
convinced me I was wrong. First is the number of questions I&#13;
see daily about how this or that aspect of the JVM performs under certain&#13;
circumstances. New engineers come to Java all the time, and JVM behavior&#13;
remains complex enough in certain areas that a guide to its operation&#13;
is still beneficial. Second is that environmental changes in computing&#13;
seem to have altered the performance concerns that engineers face today.</p>&#13;
&#13;
<p>Over the past few years, performance concerns have&#13;
become bifurcated. On the one hand, very large machines capable of running&#13;
JVMs with very large heaps are now commonplace. The JVM has moved to address&#13;
those concerns with a new garbage collector (G1), which—as a new&#13;
technology—requires a little more hand-tuning than traditional collectors.&#13;
At the same time, cloud computing has renewed the importance of small,&#13;
single-CPU&#13;
machines: you can go to Oracle or Amazon or a host of other companies and cheaply rent a  single CPU machine to run a small application&#13;
server. (You’re not actually getting a single-CPU machine: you’re&#13;
getting a virtual OS image on a very large machine, but the virtual&#13;
OS is limited to using a single CPU. From the perspective of Java, that&#13;
turns out to be the same as a single-CPU machine.) In those environments,&#13;
correctly managing small amounts of memory turns out to be quite important.</p>&#13;
&#13;
<p>The Java platform also continues to evolve. Each new edition of Java&#13;
provides new language features and new APIs that improve the productivity&#13;
of developers—if not always the performance of their applications. Best&#13;
practice use of these language features can help differentiate between&#13;
an application that sizzles and one that plods along. And the evolution&#13;
of the platform brings up interesting performance questions: there is no&#13;
question that using JSON to exchange information between&#13;
two programs is much simpler than coming up with a highly optimized&#13;
proprietary protocol. Saving time for developers is a big win—but making&#13;
sure that productivity win comes with a performance win (or at least breaks even) is the real goal.</p>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section class="less_space pagebreak-before" data-pdf-bookmark="Who Should (and Shouldn’t) Read This Book" data-type="sect1"><div class="sect1" id="idm45775551862008">&#13;
<h1>Who Should (and Shouldn’t) Read This Book</h1>&#13;
&#13;
<p>This book is designed for performance engineers and developers who are&#13;
looking to understand how various aspects of the JVM and the Java APIs&#13;
impact performance.</p>&#13;
&#13;
<p>If it is late Sunday night, your site is going live Monday morning, and&#13;
you’re looking for a quick fix for performance issues, this is&#13;
not the book for you.</p>&#13;
&#13;
<p>If you are new to performance analysis and are starting that analysis in&#13;
Java, this book can help you. Certainly my goal is to provide enough&#13;
information and context that novice engineers can understand how to apply&#13;
basic tuning and performance principles to a Java application. However,&#13;
system analysis is a broad field. There are a number of excellent&#13;
resources for system analysis in general (and those principles, of course,&#13;
apply to Java), and in that sense, this book will ideally be a useful&#13;
companion to those texts.</p>&#13;
&#13;
<p>At a fundamental level, though, making Java go really fast requires a deep&#13;
understanding of how the JVM (and Java APIs) actually work. Hundreds of Java tuning flags exist, and tuning the JVM has to be more&#13;
than an approach of blindly trying them and seeing what works. Instead,&#13;
my goal is to provide detailed knowledge about what the JVM and&#13;
APIs are doing, with the hope that if you understand how those things work,&#13;
you’ll be able to look at the specific behavior of an application and&#13;
understand <em>why</em> it is performing badly. Understanding that, it becomes&#13;
a simple (or at least simpler) task to get rid of undesirable&#13;
(badly performing) behavior.</p>&#13;
&#13;
<p>One interesting aspect to Java performance work is that developers often&#13;
have a very different background than engineers in a performance or QA group.&#13;
I know developers who can remember thousands of obscure method signatures on&#13;
little-used Java APIs but who have no idea what the flag <code>-Xmn</code> means.&#13;
And I know testing engineers who can get every last ounce of performance from&#13;
setting various flags for the garbage collector but who can barely write&#13;
a suitable “Hello, World” program in Java.</p>&#13;
&#13;
<p>Java performance covers both of these areas: tuning flags for the compiler&#13;
and garbage collector and so on, and best-practice uses of the APIs. So I&#13;
assume that you have a good understanding of how to write programs in Java.&#13;
Even if your primary interest is not in the programming aspects of Java, I&#13;
do spend a fair amount of time discussing programs, including the sample&#13;
programs used to provide a lot of the data points in the examples.</p>&#13;
&#13;
<p>Still, if your primary interest is in the performance of the JVM itself—meaning how to alter the behavior of the JVM without any coding—then large&#13;
sections of this book should still be beneficial to you. Feel free to skip&#13;
over the coding parts and focus on the areas that interest you. And&#13;
maybe along the way, you’ll pick up some insight into how Java applications&#13;
can affect JVM performance and start to suggest changes to developers&#13;
so they can make your performance-testing life easier.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="What’s New in the Second Edition" data-type="sect1"><div class="sect1" id="idm45775551344744">&#13;
<h1>What’s New in the Second Edition</h1>&#13;
&#13;
<p>Since the first edition, Java has adopted a six-month release cycle with&#13;
periodic long-term releases; that means the current supported releases that&#13;
coincide with publication are Java 8 and Java 11. Although the first edition&#13;
covered Java 8, it was quite new at the time. This edition focuses on a much&#13;
more mature Java 8 and Java 11, with major updates to the G1 garbage collector&#13;
and Java Flight Recorder. Attention is also given to changes in the way&#13;
Java behaves in containerized environments.</p>&#13;
&#13;
<p>This edition covers new features of the Java platform, including&#13;
a new microbenchmarking harness (<code>jmh</code>), new just-in-time compilers,&#13;
application class data sharing, and new performance tools—as well as coverage&#13;
of new Java 11 features like compact strings and string concatenation.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Conventions Used in This Book" data-type="sect1"><div class="sect1" id="idm45775565881384">&#13;
<h1>Conventions Used in This Book</h1>&#13;
&#13;
<p>The following typographical conventions are used in this book:</p>&#13;
<dl>&#13;
<dt><em>Italic</em></dt>&#13;
<dd>&#13;
<p>Indicates new terms, URLs, email addresses, filenames, and file extensions.</p>&#13;
</dd>&#13;
<dt><code>Constant width</code></dt>&#13;
<dd>&#13;
<p>Used for program listings, as well as within paragraphs to refer to program elements such as variable or function names, databases, data types, environment variables, statements, and keywords.</p>&#13;
</dd>&#13;
<dt><strong><code>Constant width bold</code></strong></dt>&#13;
<dd>&#13;
<p>Shows commands or other text that should be typed literally by the user.</p>&#13;
</dd>&#13;
<dt><em><code>Constant width italic</code></em></dt>&#13;
<dd>&#13;
<p>Shows text that should be replaced with user-supplied values or by values determined by context.</p>&#13;
</dd>&#13;
</dl>&#13;
<div data-type="tip">&#13;
<p>This element signifies a summary of main points.</p>&#13;
</div>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Using Code Examples" data-type="sect1"><div class="sect1" id="idm45775551816024">&#13;
<h1>Using Code Examples</h1>&#13;
<!--PROD: Please reach out to author to find out if they will be uploading code examples to oreilly.com or their own site (e.g., GitHub). If there is no code download, delete this whole section. If there is, when you email digidist with the link, let them know what you filled in for title_title (should be as close to book title as possible, i.e., learning_python_2e). This info will determine where digidist loads the files.-->&#13;
&#13;
<p>Supplemental material (code examples, exercises, etc.) is available for download at <a href="https://github.com/ScottOaks/JavaPerformanceTuning"><em class="hyperlink">https://github.com/ScottOaks/JavaPerformanceTuning</em></a>.</p>&#13;
&#13;
<p>This book is here to help you get your job done. In general, if example code is offered with this book, you may use it in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. Incorporating a significant amount of example code from this book into your product’s documentation does require <span class="keep-together">permission.</span></p>&#13;
&#13;
<p>We appreciate, but do not require, attribution. An attribution usually includes the title, author, publisher, and ISBN. For example: “<em>Java Performance</em> by Scott Oaks (O’Reilly). Copyright 2020 Scott Oaks, 978-1-492-05611-9.”</p>&#13;
&#13;
<p>If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at <a class="orm:hideurl" href="http://oreilly.com"><em>http://oreilly.com</em></a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="O’Reilly Online Learning" data-type="sect1"><div class="sect1" id="idm45775551898136">&#13;
<h1>O’Reilly Online Learning</h1>&#13;
<div class="ormenabled" data-type="note" epub:type="note">&#13;
<p>For more than 40 years, <a class="orm:hideurl" href="http://oreilly.com"><em class="hyperlink">O’Reilly Media</em></a> has provided technology and business training, knowledge, and insight to help companies succeed.</p>&#13;
</div>&#13;
&#13;
<p>Our unique network of experts and innovators share their knowledge and expertise through books, articles, conferences, and our online learning platform. O’Reilly’s online learning platform gives you on-demand access to live training courses, in-depth learning paths, interactive coding environments, and a vast collection of text and video from O’Reilly and 200+ other publishers. For more information, please visit <a class="orm:hideurl" href="http://oreilly.com"><em>http://oreilly.com</em></a>.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="How to Contact Us" data-type="sect1"><div class="sect1" id="idm45775565869608">&#13;
<h1>How to Contact Us</h1>&#13;
&#13;
<p>Please address comments and questions concerning this book to the publisher:</p>&#13;
<ul class="simplelist">&#13;
  <li>O’Reilly Media, Inc.</li>&#13;
  <li>1005 Gravenstein Highway North</li>&#13;
  <li>Sebastopol, CA 95472</li>&#13;
  <li>800-998-9938 (in the United States or Canada)</li>&#13;
  <li>707-829-0515 (international or local)</li>&#13;
  <li>707-829-0104 (fax)</li>&#13;
</ul>&#13;
&#13;
<p>We have a web page for this book, where we list errata, examples, and any additional information. You can access this page at <a href="https://oreil.ly/java-performance-2e"><em class="hyperlink">https://oreil.ly/java-performance-2e</em></a>.</p>&#13;
<!--Don't forget to update the link above.-->&#13;
&#13;
<p>Email <a class="email" href="mailto:bookquestions@oreilly.com"><em>bookquestions@oreilly.com</em></a> to comment or ask technical questions about this book.</p>&#13;
&#13;
<p>For more information about our books, courses, conferences, and news, see our website at <a href="http://www.oreilly.com"><em class="hyperlink">http://www.oreilly.com</em></a>.</p>&#13;
&#13;
<p>Find us on Facebook: <a href="http://facebook.com/oreilly"><em class="hyperlink">http://facebook.com/oreilly</em></a></p>&#13;
&#13;
<p>Follow us on Twitter: <a href="http://twitter.com/oreillymedia"><em class="hyperlink">http://twitter.com/oreillymedia</em></a></p>&#13;
&#13;
<p>Watch us on YouTube: <a href="http://www.youtube.com/oreillymedia"><em class="hyperlink">http://www.youtube.com/oreillymedia</em></a></p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
<section data-pdf-bookmark="Acknowledgments" data-type="sect1"><div class="sect1" id="idm45775566050232">&#13;
<h1>Acknowledgments</h1>&#13;
&#13;
<p>I would like to thank everyone who helped me as I worked on this book.&#13;
In many ways, this book is an accumulation of knowledge gained over&#13;
my past 20 years&#13;
in the Java&#13;
Performance Group and other engineering groups at Sun Microsystems and&#13;
Oracle, so the list of people&#13;
who have provided positive input into this book is quite broad. To all&#13;
the engineers I have worked with during that time, and particularly to those&#13;
who patiently answered my random questions over the past year, thank you!</p>&#13;
&#13;
<p>I would especially like to thank&#13;
Stanley Guan, Azeem Jiva, Kim LiChong, Deep Singh,&#13;
Martijn Verburg, and Edward Yue Shung Wong for their time reviewing&#13;
draft copies and providing valuable feedback. I am sure that&#13;
they were unable to find all my errors, though the material here is greatly&#13;
improved by their input. The second edition was improved greatly by the&#13;
thorough and thoughtful help offered by Ben Evans, Rod Hilton,&#13;
and Michael Hunger. My colleagues Eric Caspole, Charlie Hunt, and&#13;
Robert Strout in the Oracle HotSpot performance group patiently helped me&#13;
with a variety of issues in the second edition as well.</p>&#13;
&#13;
<p>The production staff at O’Reilly was, as always, very helpful. I was privileged&#13;
to work with editor Meg Blanchette on the first edition, and Amelia Blevins&#13;
thoughtfully and carefully guided the second edition. Thanks&#13;
for all your encouragement during the process!&#13;
Finally, I must thank my husband, James, for putting up with the long nights&#13;
and those weekend dinners where I was in a continual state of distraction.</p>&#13;
</div></section>&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
&#13;
</div></section></body></html>